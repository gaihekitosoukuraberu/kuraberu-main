<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ -->
  <script>
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã®iframeãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆæœ€å„ªå…ˆã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«é ­ã«é…ç½®ï¼‰
    window.addEventListener('message', function(event) {
      if (event.data === 'closeDetailOverlay') {
        console.log('ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒ³ãƒ‰ãƒ©ãƒ¼: closeDetailOverlayå—ä¿¡');
        const overlay = document.getElementById('detailOverlay');
        if (overlay) {
          overlay.remove();
          document.body.style.overflow = '';
          document.body.style.position = '';
          document.body.style.width = '';
          document.body.style.height = '';
        }
      }
    }, false);
  </script>
  <title>å¤–å£å¡—è£…ãã‚‰ã¹ã‚‹ - AIã§æœ€é©ãªæ¥­è€…ã‚’ç„¡æ–™ã§æ¯”è¼ƒ</title>
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- AIãƒœãƒƒãƒˆä¿®æ­£ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆAPIé€£æºç‰ˆï¼‰ -->
  <script src="api-bot.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'kuraberu-yellow': '#FFE600',
            'kuraberu-blue': '#0ea5e9',
            'kuraberu-dark': '#0f172a',
            'kuraberu-green': '#10b981',
            'kuraberu-red': '#ef4444',
          },
          fontFamily: {
            'sans': ['"Hiragino Sans"', '"Hiragino Kaku Gothic ProN"', 'Meiryo', 'sans-serif'],
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-out',
            'slide-up': 'slideUp 0.4s ease-out',
            'slide-in': 'slideIn 0.3s ease-out',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { transform: 'translateY(10px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            },
            slideIn: {
              '0%': { transform: 'translateX(10px)', opacity: '0' },
              '100%': { transform: 'translateX(0)', opacity: '1' },
            },
          },
        },
      },
    }
  </script>
  <style>
    @font-face {
      font-family: 'Hiragino Sans';
      src: local('Hiragino Sans');
      font-weight: normal;
    }
    
    body {
      font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
    }
    
    .diagonal-stripes {
      background-image: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, 
                        transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, 
                        transparent 75%, transparent);
      background-size: 40px 40px;
    }
    
    .bg-gradient-main {
      background: linear-gradient(135deg, #0ea5e9 0%, #10b981 100%);
    }
    
    /* å¹ãå‡ºã—ï¼ˆæ¥•å††å½¢ï¼‰ */
    .speech-bubble-left, .speech-bubble-right {
      position: relative;
      background: #ffffff;
      border-radius: 20px;
      padding: 8px 12px;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      z-index: 30;
      width: auto;
      display: inline-block;
    }
    
    /* PCç”¨ã®å¹ãå‡ºã—æ‹¡å¤§ã¨ã‚¹ãƒãƒ›ã®ä½ç½®èª¿æ•´ */
    @media (min-width: 768px) {
      .phone-mockup {
        width: 220px !important;
        height: 440px !important;
      }
      
      .speech-bubble-left, .speech-bubble-right {
        padding: 10px 18px;
        font-size: 1.1rem;
      }
      
      .pc-mockup-wrap {
        max-width: 320px;
        margin-left: auto;
        margin-right: auto;
        margin-top: 4.5rem;
        position: relative;
      }
    }
    
    .phone-mockup {
      border: 8px solid #333;
      border-radius: 30px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 15px 20px -5px rgba(0, 0, 0, 0.1), 0 8px 8px -5px rgba(0, 0, 0, 0.04);
      width: 180px;
      height: 360px;
      margin: 0 auto;
      background: #ffffff;
    }
    
    .phone-header {
      height: 20px;
      background: #333;
      position: relative;
    }
    
    .phone-notch {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 35%;
      height: 18px;
      background-color: #333;
      border-bottom-left-radius: 0.7rem;
      border-bottom-right-radius: 0.7rem;
      z-index: 40;
    }
    
    .mosaic-blur {
      position: relative;
    }
    
    .mosaic-blur::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23FFFFFF' fill-opacity='0.7'%3E%3Crect width='10' height='10' /%3E%3Crect x='10' y='10' width='10' height='10' /%3E%3C/g%3E%3C/svg%3E");
      backdrop-filter: blur(3px);
      -webkit-backdrop-filter: blur(3px);
      border-radius: inherit;
      z-index: 20;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .animate-pulse-slow {
      animation: pulse 3s infinite;
    }
    
    .free-badge {
      position: absolute;
      background: linear-gradient(135deg, #FF6B6B 0%, #FFA0A0 100%);
      color: white;
      font-weight: bold;
      border-radius: 9999px;
      padding: 0.3rem 0.8rem;
      font-size: 0.9rem;
      transform: rotate(5deg);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      z-index: 10;
      right: 12px;
      top: 16px;
    }
    
    /* ã‚¹ãƒãƒ›è¡¨ç¤ºæ™‚ã®èª¿æ•´ */
    @media (max-width: 768px) {
      .mobile-order-1 {
        order: 1;
      }
      
      .mobile-order-2 {
        order: 2;
      }
      
      .mobile-order-3 {
        order: 3;
      }
      
      .mobile-order-4 {
        order: 4;
      }
      
      .hero-section {
        min-height: 95vh;
        padding-bottom: 0;
      }
      
      .compact-content {
        margin-bottom: 0 !important;
        padding-bottom: 0 !important;
      }
      
      .form-container {
        margin-top: 0.5rem;
      }
      
      .phone-mockup {
        margin-top: 2px !important;
      }
      
      .speech-bubble-left {
        top: 50px !important;
        margin-left: 30px !important;
        font-size: 0.85rem !important;
      }
      
      .speech-bubble-right {
        bottom: 40px !important;
        margin-right: 30px !important;
        font-size: 0.85rem !important;
      }
    }
    
    /* ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }
    .typing-cursor {
      animation: blink 1s infinite;
    }
  </style>
</head>
<body class="bg-white">
  <!-- ãƒ¡ã‚¤ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆéƒµä¾¿ç•ªå·å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã®ã¿ï¼‰ -->
  <section class="bg-white relative py-8">
    
    <div class="container mx-auto px-4">
      <div class="max-w-2xl mx-auto text-center">
        <!-- ãƒ¡ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="bg-white rounded-3xl shadow-2xl p-6 md:p-8">
          <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
          <h1 class="text-xl md:text-2xl font-bold mb-6 text-kuraberu-dark">
            éƒµä¾¿ç•ªå·ã§ä»Šã™ãç›¸å ´ãƒã‚§ãƒƒã‚¯ï¼
          </h1>
          
          <!-- ãƒ•ã‚©ãƒ¼ãƒ  -->
          <div class="space-y-6">
            <div class="relative">
              <input 
                type="text" 
                id="postalCode" 
                placeholder="ä¾‹ï¼š123-4567" 
                maxlength="8"
                class="w-full py-4 px-6 text-2xl text-center border-3 border-kuraberu-red rounded-2xl shadow-lg focus:border-kuraberu-blue focus:outline-none focus:ring-4 focus:ring-kuraberu-blue/20 transition-all"
              >
            </div>
            
            <button 
              id="searchButton" 
              onclick="showAreaPrice();"
              class="w-full bg-kuraberu-blue hover:bg-blue-600 text-white font-bold py-4 px-8 rounded-2xl text-xl transition-all shadow-xl hover:shadow-2xl transform hover:-translate-y-1"
            >
              <span class="flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                ğŸ”ç„¡æ–™ã§ç›¸å ´ã‚’è¦‹ã‚‹
              </span>
            </button>
          </div>
          
          <p id="postalError" class="text-red-500 text-center mt-4 hidden text-lg font-medium">
            éƒµä¾¿ç•ªå·ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„
          </p>
          
          <!-- å®‰å…¨æ€§è¡¨ç¤º -->
          <div class="flex items-center justify-center mt-6 text-sm text-gray-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
            </svg>
            å€‹äººæƒ…å ±ä¿è­·ãƒ»SSLæš—å·åŒ–é€šä¿¡ã§å®‰å…¨
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ç›¸å ´è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆæœ€åˆã¯éè¡¨ç¤ºï¼‰ -->
  <section id="areaPrice" class="hidden bg-gradient-to-b from-kuraberu-yellow/20 to-white py-8">
    <div class="container mx-auto px-4">
      <!-- æ´¾æ‰‹ãªæ¼”å‡ºã‚¨ãƒªã‚¢ -->
      <div id="priceRevealAnimation" class="mb-6 text-center">
        <div class="text-2xl md:text-3xl font-extrabold mb-4 text-kuraberu-dark">ã‚ãªãŸã®åœ°åŸŸã®ç›¸å ´ã‚’<span class="text-kuraberu-blue">åˆ†æä¸­</span>...</div>
        <div class="relative h-4 bg-gray-200 rounded-full max-w-lg mx-auto mb-6 overflow-hidden">
          <div id="progressBar" class="absolute h-full bg-gradient-to-r from-kuraberu-blue to-kuraberu-green rounded-full" style="width: 0%;"></div>
        </div>
        <div class="flex flex-wrap justify-center gap-3 mb-6 animate-pulse">
          <div class="px-3 py-1 bg-white rounded-full shadow-sm text-sm text-gray-600">æ¡ä»¶åˆ†æä¸­...</div>
          <div class="px-3 py-1 bg-white rounded-full shadow-sm text-sm text-gray-600">æ¥­è€…æƒ…å ±å–å¾—ä¸­...</div>
          <div class="px-3 py-1 bg-white rounded-full shadow-sm text-sm text-gray-600">ç›¸å ´è¨ˆç®—ä¸­...</div>
        </div>
      </div>
      
      <!-- ç›¸å ´çµæœè¡¨ç¤º -->
      <div id="priceResult" class="bg-white rounded-xl shadow-lg p-4 mx-auto max-w-3xl relative mb-8 hidden">
        <h2 class="text-center text-lg font-bold mb-3 flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-kuraberu-blue mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          <span id="locationHeading">æ±äº¬éƒ½æ‰ä¸¦åŒºã®å¤–å£å¡—è£…ç›¸å ´</span>
        </h2>
        
        <div class="bg-gradient-to-r from-blue-50 to-green-50 p-4 rounded-xl mb-4 border border-blue-100">
          <p class="text-sm text-gray-600 mb-1 text-center">2Få»ºã¦æˆ¸å»ºã¦ç¯‰25å¹´ã®å ´åˆï¼ˆ30åªï¼‰</p>
          <div class="relative">
            <div class="text-3xl font-extrabold text-center mb-2">
              <span class="text-kuraberu-blue" id="priceRange">70ä¸‡ã€œ135ä¸‡å††</span>
            </div>
          </div>
          <p class="text-xs text-gray-500 text-center mb-3">â€»å»ºç‰©ã®çŠ¶æ…‹ã‚„ä½¿ç”¨ææ–™ã«ã‚ˆã‚Šä¾¡æ ¼ã¯å¤‰å‹•ã—ã¾ã™</p>
          <div class="text-center">
            <button id="showAccuratePrice" class="bg-kuraberu-blue hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 shadow-lg transform hover:-translate-y-1 hover:shadow-xl text-lg animate-pulse">
              ã‚ˆã‚Šæ­£ç¢ºãªç›¸å ´ã‚’è¦‹ã‚‹ï¼ˆç„¡æ–™ï¼‰
            </button>
          </div>
        </div>
        
        <!-- æ¥­è€…ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæœ€åˆã¯éè¡¨ç¤ºï¼‰ -->
        <div id="companyRankingSection" class="hidden mb-4 relative">
          <div class="flex justify-between items-center mb-4">
            <h3 class="font-bold text-lg">ãŠã™ã™ã‚æ¥­è€…ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h3>
            <div id="matchAccuracy" class="hidden">
              <div class="text-sm text-gray-600">ãƒãƒƒãƒç²¾åº¦</div>
              <div class="flex items-center">
                <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">
                  <div id="accuracyBar" class="bg-kuraberu-blue h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <span id="accuracyPercentage" class="text-sm font-bold text-kuraberu-blue">0%</span>
              </div>
            </div>
          </div>
          
          <!-- å…¨ä½“ãƒ¢ã‚¶ã‚¤ã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
          <div id="rankingMosaicOverlay" class="absolute top-8 -left-4 -right-4 bottom-0 bg-white/75 backdrop-blur rounded-lg flex items-start justify-center pt-16 z-30">
            <div class="text-center p-6">
              <div class="mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-kuraberu-blue mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                </svg>
              </div>
              <div class="text-kuraberu-blue font-bold text-lg mb-2">æ¥­è€…ã®æ¯”è¼ƒãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼</div>
              <div class="text-sm text-gray-600">è³ªå•ã«ç­”ãˆã‚‹ã¨å®Ÿéš›ã«ã“ã®åœ°åŸŸã§é¸ã°ã‚Œã¦ã„ã‚‹æ¥­è€…æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
            </div>
          </div>
          
          <!-- ã‚½ãƒ¼ãƒˆãƒœã‚¿ãƒ³ï¼ˆæœ€åˆã¯éè¡¨ç¤ºï¼‰ -->
          <div id="sortButtons" class="hidden mb-4">
            <div class="text-sm text-gray-600 mb-2">ä¸¦ã³æ›¿ãˆ</div>
            <div class="grid grid-cols-4 gap-2">
              <button id="sortRecommend" class="sort-btn bg-blue-100 border-2 border-blue-300 text-blue-800 py-2 px-3 rounded-lg text-xs font-medium transition-all hover:bg-blue-200 active-sort">
                <div class="flex flex-col items-center">
                  <span class="text-lg mb-1">â­</span>
                  <span>ãŠã™ã™ã‚é †</span>
                </div>
              </button>
              <button id="sortCheap" class="sort-btn bg-white border-2 border-gray-300 text-gray-700 py-2 px-3 rounded-lg text-xs font-medium transition-all hover:bg-orange-50">
                <div class="flex flex-col items-center">
                  <span class="text-lg mb-1">ğŸ’°</span>
                  <span>å®‰ã„é †</span>
                </div>
              </button>
              <button id="sortReview" class="sort-btn bg-white border-2 border-gray-300 text-gray-700 py-2 px-3 rounded-lg text-xs font-medium transition-all hover:bg-green-50">
                <div class="flex flex-col items-center">
                  <span class="text-lg mb-1">ğŸ’¬</span>
                  <span>å£ã‚³ãƒŸé †</span>
                </div>
              </button>
              <button id="sortQuality" class="sort-btn bg-white border-2 border-gray-300 text-gray-700 py-2 px-3 rounded-lg text-xs font-medium transition-all hover:bg-purple-50">
                <div class="flex flex-col items-center">
                  <span class="text-lg mb-1">âš¡</span>
                  <span>é«˜å“è³ªé †</span>
                </div>
              </button>
            </div>
          </div>
          
          <!-- æ¥­è€…ã‚«ãƒ¼ãƒ‰ -->
          <div class="space-y-3" id="companyCards">
            <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°1ä½ -->
            <div class="company-card relative bg-white p-4 rounded-lg border-2 border-gray-200 shadow-sm transition-all duration-300 min-h-[120px]">
              <div class="absolute -top-2 -left-2 w-6 h-6 rounded-full bg-yellow-500 flex items-center justify-center text-white font-bold text-sm">1</div>
              <div class="pl-4">
                <div class="flex justify-between items-start mb-2">
                  <div class="company-name font-bold text-lg">â– â– å¡—è£…å·¥æˆ¿</div>
                  <div class="rating flex items-center">
                    <span class="text-yellow-500">â˜…â˜…â˜…â˜…â˜…</span>
                    <span class="text-gray-500 text-sm ml-1">4.9</span>
                  </div>
                </div>
                <div class="tags flex gap-1 mb-2">
                  <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs">åœ°å…ƒå¯†ç€</span>
                  <span class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs">ä¿è¨¼å……å®Ÿ</span>
                </div>
                <div class="price-info text-kuraberu-blue font-bold">è¦‹ç©ã‚‚ã‚Šä¾¡æ ¼: â– â– ä¸‡å††ã€œ</div>
              </div>
            </div>
            
            <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°2ä½ -->
            <div class="company-card relative bg-white p-4 rounded-lg border-2 border-gray-200 shadow-sm transition-all duration-300 min-h-[120px]">
              <div class="absolute -top-2 -left-2 w-6 h-6 rounded-full bg-gray-500 flex items-center justify-center text-white font-bold text-sm">2</div>
              <div class="pl-4">
                <div class="flex justify-between items-start mb-2">
                  <div class="company-name font-bold text-lg">â– â– â– ãƒšã‚¤ãƒ³ãƒˆ</div>
                  <div class="rating flex items-center">
                    <span class="text-yellow-500">â˜…â˜…â˜…â˜…â˜†</span>
                    <span class="text-gray-500 text-sm ml-1">4.7</span>
                  </div>
                </div>
                <div class="tags flex gap-1 mb-2">
                  <span class="bg-purple-100 text-purple-700 px-2 py-1 rounded text-xs">æŠ€è¡“åŠ›</span>
                  <span class="bg-orange-100 text-orange-700 px-2 py-1 rounded text-xs">å®Ÿç¸¾è±Šå¯Œ</span>
                </div>
                <div class="price-info text-kuraberu-blue font-bold">è¦‹ç©ã‚‚ã‚Šä¾¡æ ¼: â– â– ä¸‡å††ã€œ</div>
              </div>
            </div>
            
            <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°3ä½ -->
            <div class="company-card relative bg-white p-4 rounded-lg border-2 border-gray-200 shadow-sm transition-all duration-300 min-h-[120px]">
              <div class="absolute -top-2 -left-2 w-6 h-6 rounded-full bg-orange-500 flex items-center justify-center text-white font-bold text-sm">3</div>
              <div class="pl-4">
                <div class="flex justify-between items-start mb-2">
                  <div class="company-name font-bold text-lg">â– â– å»ºè£…</div>
                  <div class="rating flex items-center">
                    <span class="text-yellow-500">â˜…â˜…â˜…â˜…â˜†</span>
                    <span class="text-gray-500 text-sm ml-1">4.5</span>
                  </div>
                </div>
                <div class="tags flex gap-1 mb-2">
                  <span class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs">ã‚¢ãƒ•ã‚¿ãƒ¼ä¸‡å…¨</span>
                  <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs">ä½ä¾¡æ ¼</span>
                </div>
                <div class="price-info text-kuraberu-blue font-bold">è¦‹ç©ã‚‚ã‚Šä¾¡æ ¼: â– â– ä¸‡å††ã€œ</div>
              </div>
            </div>
            
            <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°4ä½ -->
            <div class="company-card relative bg-white p-4 rounded-lg border-2 border-gray-200 shadow-sm transition-all duration-300 min-h-[120px]">
              <div class="absolute -top-2 -left-2 w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold text-sm">4</div>
              <div class="pl-4">
                <div class="flex justify-between items-start mb-2">
                  <div class="company-name font-bold text-lg">â– â– â– â– ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</div>
                  <div class="rating flex items-center">
                    <span class="text-yellow-500">â˜…â˜…â˜…â˜…â˜†</span>
                    <span class="text-gray-500 text-sm ml-1">4.3</span>
                  </div>
                </div>
                <div class="tags flex gap-1 mb-2">
                  <span class="bg-red-100 text-red-700 px-2 py-1 rounded text-xs">å¤§æ‰‹å®‰å¿ƒ</span>
                  <span class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded text-xs">è¿…é€Ÿå¯¾å¿œ</span>
                </div>
                <div class="price-info text-kuraberu-blue font-bold">è¦‹ç©ã‚‚ã‚Šä¾¡æ ¼: â– â– ä¸‡å††ã€œ</div>
              </div>
            </div>
            
            <!-- 5-8ä½ï¼ˆæœ€åˆã¯éè¡¨ç¤ºï¼‰ -->
            <div id="moreCompanies" class="hidden space-y-3">
              <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°5ä½ -->
              <div class="company-card relative bg-white p-4 rounded-lg border-2 border-gray-200 shadow-sm transition-all duration-300 min-h-[120px]">
                <div class="absolute -top-2 -left-2 w-6 h-6 rounded-full bg-purple-500 flex items-center justify-center text-white font-bold text-sm">5</div>
                <div class="pl-4">
                  <div class="flex justify-between items-start mb-2">
                    <div class="company-name font-bold text-lg">â– â– â– ä½å®…</div>
                    <div class="rating flex items-center">
                      <span class="text-yellow-500">â˜…â˜…â˜…â˜†â˜†</span>
                      <span class="text-gray-500 text-sm ml-1">4.1</span>
                    </div>
                  </div>
                  <div class="tags flex gap-1 mb-2">
                    <span class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded text-xs">å‰µæ¥­50å¹´</span>
                    <span class="bg-pink-100 text-pink-700 px-2 py-1 rounded text-xs">ä¸å¯§æ–½å·¥</span>
                  </div>
                  <div class="price-info text-kuraberu-blue font-bold">è¦‹ç©ã‚‚ã‚Šä¾¡æ ¼: â– â– ä¸‡å††ã€œ</div>
                </div>
              </div>
              
              <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°6ä½ -->
              <div class="company-card relative bg-white p-4 rounded-lg border-2 border-gray-200 shadow-sm transition-all duration-300 min-h-[120px]">
                <div class="absolute -top-2 -left-2 w-6 h-6 rounded-full bg-teal-500 flex items-center justify-center text-white font-bold text-sm">6</div>
                <div class="pl-4">
                  <div class="flex justify-between items-start mb-2">
                    <div class="company-name font-bold text-lg">â– â– ãƒ›ãƒ¼ãƒ </div>
                    <div class="rating flex items-center">
                      <span class="text-yellow-500">â˜…â˜…â˜…â˜†â˜†</span>
                      <span class="text-gray-500 text-sm ml-1">3.9</span>
                    </div>
                  </div>
                  <div class="tags flex gap-1 mb-2">
                    <span class="bg-cyan-100 text-cyan-700 px-2 py-1 rounded text-xs">ç’°å¢ƒé…æ…®</span>
                    <span class="bg-lime-100 text-lime-700 px-2 py-1 rounded text-xs">æ–°å·¥æ³•</span>
                  </div>
                  <div class="price-info text-kuraberu-blue font-bold">è¦‹ç©ã‚‚ã‚Šä¾¡æ ¼: â– â– ä¸‡å††ã€œ</div>
                </div>
              </div>
              
              <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°7ä½ -->
              <div class="company-card relative bg-white p-4 rounded-lg border-2 border-gray-200 shadow-sm transition-all duration-300 min-h-[120px]">
                <div class="absolute -top-2 -left-2 w-6 h-6 rounded-full bg-amber-500 flex items-center justify-center text-white font-bold text-sm">7</div>
                <div class="pl-4">
                  <div class="flex justify-between items-start mb-2">
                    <div class="company-name font-bold text-lg">â– â– â– ãƒªãƒ•ã‚©ãƒ¼ãƒ </div>
                    <div class="rating flex items-center">
                      <span class="text-yellow-500">â˜…â˜…â˜…â˜†â˜†</span>
                      <span class="text-gray-500 text-sm ml-1">3.8</span>
                    </div>
                  </div>
                  <div class="tags flex gap-1 mb-2">
                    <span class="bg-rose-100 text-rose-700 px-2 py-1 rounded text-xs">ç·åˆå·¥äº‹</span>
                    <span class="bg-emerald-100 text-emerald-700 px-2 py-1 rounded text-xs">ä¸€æ‹¬å¯¾å¿œ</span>
                  </div>
                  <div class="price-info text-kuraberu-blue font-bold">è¦‹ç©ã‚‚ã‚Šä¾¡æ ¼: â– â– ä¸‡å††ã€œ</div>
                </div>
              </div>
              
              <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°8ä½ -->
              <div class="company-card relative bg-white p-4 rounded-lg border-2 border-gray-200 shadow-sm transition-all duration-300 min-h-[120px]">
                <div class="absolute -top-2 -left-2 w-6 h-6 rounded-full bg-slate-500 flex items-center justify-center text-white font-bold text-sm">8</div>
                <div class="pl-4">
                  <div class="flex justify-between items-start mb-2">
                    <div class="company-name font-bold text-lg">â– â– å¡—è£…åº—</div>
                    <div class="rating flex items-center">
                      <span class="text-yellow-500">â˜…â˜…â˜…â˜†â˜†</span>
                      <span class="text-gray-500 text-sm ml-1">3.7</span>
                    </div>
                  </div>
                  <div class="tags flex gap-1 mb-2">
                    <span class="bg-violet-100 text-violet-700 px-2 py-1 rounded text-xs">è·äººç›´å–¶</span>
                    <span class="bg-sky-100 text-sky-700 px-2 py-1 rounded text-xs">æ ¼å®‰ä¾¡æ ¼</span>
                  </div>
                  <div class="price-info text-kuraberu-blue font-bold">è¦‹ç©ã‚‚ã‚Šä¾¡æ ¼: â– â– ä¸‡å††ã€œ</div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- ã‚‚ã£ã¨è¦‹ã‚‹ãƒœã‚¿ãƒ³ -->
          <div class="text-center mt-4">
            <button id="showMoreCompanies" class="text-kuraberu-blue hover:text-blue-600 text-sm font-medium transition-colors">
              ã‚‚ã£ã¨è¦‹ã‚‹
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- BOTä¸‹éƒ¨å›ºå®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div id="fixedBotSection" class="hidden fixed bottom-0 left-0 right-0 bg-white shadow-2xl border-t-2 border-kuraberu-blue z-50">
    <div class="container mx-auto px-4 py-3">
      <!-- é€²æ—è¡¨ç¤º -->
      <div id="stageProgress" class="mb-3">
        <div class="flex justify-between items-center mb-2">
          <div class="text-sm font-medium text-gray-600" id="stageTitle">ç‰©ä»¶è¨ºæ–­ä¸­...</div>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-1">
          <div id="progressBarBot" class="bg-kuraberu-blue h-1 rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>
      </div>
      
      <!-- è±†çŸ¥è­˜ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
      <div id="knowledgeTip" class="mb-3 p-3 bg-blue-50 rounded-lg border border-blue-200 hidden">
        <div class="flex items-start">
          <div class="text-blue-500 mr-2 mt-1">ğŸ’¡</div>
          <div>
            <div class="font-medium text-blue-900 text-sm" id="tipTitle">è±†çŸ¥è­˜</div>
            <div class="text-blue-800 text-xs" id="tipContent">ã“ã“ã«è±†çŸ¥è­˜ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
          </div>
        </div>
      </div>
      
      <!-- BOTè³ªå•ã‚¨ãƒªã‚¢ -->
      <div id="botQuestionArea" class="bg-gray-50 rounded-lg p-4">
        <div class="flex items-start mb-3">
          <div class="w-8 h-8 bg-kuraberu-blue rounded-full flex items-center justify-center mr-3 flex-shrink-0">
            <svg viewBox="0 0 24 24" class="w-5 h-5 text-white" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
          </div>
          <div class="flex-grow">
            <div class="font-medium text-gray-900 mb-2" id="currentQuestion">
              å»ºç‰©ã¯ä½•éšå»ºã¦ã§ã™ã‹ï¼Ÿ
            </div>
            <div class="grid grid-cols-2 gap-2" id="answerChoices">
              <button class="answer-btn bg-white border-2 border-gray-300 hover:border-kuraberu-blue hover:bg-blue-50 p-3 rounded-lg text-sm font-medium transition-all" data-value="1éšå»ºã¦">
                1éšå»ºã¦
              </button>
              <button class="answer-btn bg-white border-2 border-gray-300 hover:border-kuraberu-blue hover:bg-blue-50 p-3 rounded-lg text-sm font-medium transition-all" data-value="2éšå»ºã¦">
                2éšå»ºã¦
              </button>
              <button class="answer-btn bg-white border-2 border-gray-300 hover:border-kuraberu-blue hover:bg-blue-50 p-3 rounded-lg text-sm font-medium transition-all" data-value="3éšå»ºã¦">
                3éšå»ºã¦
              </button>
            </div>
          </div>
        </div>
        
        <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
        <div class="flex justify-between items-center">
          <button id="botBackBtn" class="hidden text-gray-600 hover:text-gray-800 text-sm flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            æˆ»ã‚‹
          </button>
        </div>
      </div>
      
      <!-- æ®µéšç§»è¡Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
      <div id="stageTransitionMessage" class="hidden p-4 bg-green-50 rounded-lg border border-green-200 mb-3">
        <div class="text-center">
          <div class="text-green-800 font-medium mb-2" id="transitionTitle">ç‰©ä»¶è¨ºæ–­å®Œäº†ï¼</div>
          <div class="text-green-700 text-sm mb-3" id="transitionContent">ç¶šã„ã¦ã€ã‚ãªãŸã«ãƒ”ãƒƒã‚¿ãƒªã®æ¥­è€…ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã€ã‚‚ã†å°‘ã—è©³ã—ããŠèã‹ã›ãã ã•ã„ã€‚</div>
          <button id="continueBtn" class="bg-kuraberu-blue hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg">
            è©³ç´°è¨ºæ–­ã‚’é–‹å§‹
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Google Apps Script Webã‚¢ãƒ—ãƒªã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¨­å®š
    // æœ¬ç•ªç’°å¢ƒã§ã¯ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸWebã‚¢ãƒ—ãƒªã®URLã«å¤‰æ›´ã™ã‚‹
    const SCRIPT_ENDPOINT = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec';
    
    // ã‚»ãƒƒã‚·ãƒ§ãƒ³é–¢é€£ã®å¤‰æ•°
    let sessionId = '';
    let dynamicQuestions = [];
    let currentQuestionIndex = 0;
    let userAnswers = [];
    let searchKeyword = '';
    
    // ãƒªãƒ•ã‚¡ãƒ©ãƒ¼ï¼ˆæ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼‰ã®æŠ½å‡º
    function extractSearchKeyword() {
      try {
        // document.referrerã‹ã‚‰æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã¨ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŠ½å‡º
        const referrer = document.referrer;
        if (!referrer) return '';
        
        const url = new URL(referrer);
        let keyword = '';
        
        // Googleæ¤œç´¢
        if (url.hostname.includes('google')) {
          keyword = new URLSearchParams(url.search).get('q') || '';
        }
        // Yahooæ¤œç´¢
        else if (url.hostname.includes('yahoo')) {
          keyword = new URLSearchParams(url.search).get('p') || '';
        }
        // Bingæ¤œç´¢
        else if (url.hostname.includes('bing')) {
          keyword = new URLSearchParams(url.search).get('q') || '';
        }
        
        console.log('æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ', keyword);
        return keyword;
      } catch (e) {
        console.error('ãƒªãƒ•ã‚¡ãƒ©ãƒ¼è§£æã‚¨ãƒ©ãƒ¼:', e);
        return '';
      }
    }
    
    // ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã®ç”Ÿæˆï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯IDã®ä½œæˆï¼‰
    function generateSessionId() {
      return 'session_' + Math.random().toString(36).substring(2, 15) + 
             Math.random().toString(36).substring(2, 15) + 
             '_' + new Date().getTime();
    }
    
    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰éƒµä¾¿ç•ªå·ã‚’å‡¦ç†ã™ã‚‹é–¢æ•°
    function handlePostalCodeFromURL(postalCode) {
      // éƒµä¾¿ç•ªå·ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
      let code = postalCode.trim().replace(/-/g, '');
      if (!/^\d{7}$/.test(code)) {
        console.log('ç„¡åŠ¹ãªéƒµä¾¿ç•ªå·:', postalCode);
        return;
      }
      
      // éƒµä¾¿ç•ªå·å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’éè¡¨ç¤º
      const heroSection = document.querySelector('section.bg-kuraberu-yellow');
      if (heroSection) {
        heroSection.style.display = 'none';
      }
      
      // å®‰å¿ƒãƒã‚¤ãƒ³ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤º
      const safetySection = document.querySelector('section.py-8.bg-white');
      if (safetySection) {
        safetySection.style.display = 'none';
      }
      
      // AIãƒãƒƒãƒãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤º
      const aiSection = document.querySelector('section.py-12.bg-gray-50');
      if (aiSection) {
        aiSection.style.display = 'none';
      }
      
      // ç›¸å ´è¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
      const areaPrice = document.getElementById('areaPrice');
      if (areaPrice) {
        areaPrice.classList.remove('hidden');
        areaPrice.style.display = 'block';
      }
      
      // éƒµä¾¿ç•ªå·ã«åŸºã¥ã„ã¦åœ°åŸŸæƒ…å ±ã‚’æ›´æ–°
      updateLocationInfo(postalCode);
      
      // ãƒšãƒ¼ã‚¸ãƒˆãƒƒãƒ—ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
      window.scrollTo(0, 0);
    }
    
    // åœ°åŸŸæƒ…å ±ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
    function updateLocationInfo(postalCode) {
      // ç°¡æ˜“çš„ãªåœ°åŸŸåˆ¤å®šï¼ˆå®Ÿéš›ã¯APIã¾ãŸã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–å¾—ï¼‰
      const locationMapping = {
        '150': 'æ±äº¬éƒ½æ¸‹è°·åŒº',
        '151': 'æ±äº¬éƒ½æ¸‹è°·åŒº',
        '152': 'æ±äº¬éƒ½ç›®é»’åŒº',
        '153': 'æ±äº¬éƒ½ç›®é»’åŒº',
        '154': 'æ±äº¬éƒ½ä¸–ç”°è°·åŒº',
        '155': 'æ±äº¬éƒ½ä¸–ç”°è°·åŒº',
        '156': 'æ±äº¬éƒ½ä¸–ç”°è°·åŒº',
        '157': 'æ±äº¬éƒ½ä¸–ç”°è°·åŒº'
      };
      
      const prefix = postalCode.substring(0, 3);
      const location = locationMapping[prefix] || 'æ±äº¬éƒ½æ‰ä¸¦åŒº';
      
      // åœ°åŸŸåã‚’æ›´æ–°
      const locationHeading = document.getElementById('locationHeading');
      if (locationHeading) {
        locationHeading.textContent = `${location}ã®å¤–å£å¡—è£…ç›¸å ´`;
      }
    }
    
    // ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–
    function initChatSession() {
      sessionId = generateSessionId();
      searchKeyword = extractSearchKeyword();
      
      // ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
      localStorage.setItem('kuraberu_session_id', sessionId);
      localStorage.setItem('kuraberu_search_keyword', searchKeyword);
      
      console.log('ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³åˆæœŸåŒ–: ', sessionId);
      console.log('æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ', searchKeyword);
    }
    
    // Google Apps Scriptã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹é–¢æ•°
    function callScriptApi(action, data = {}) {
      // ã“ã®é–¢æ•°ã¯ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™ã ã‘ã®ãƒ€ãƒŸãƒ¼é–¢æ•°ã«å¤‰æ›´
      console.log('APIå‘¼ã³å‡ºã—(ãƒ¢ãƒƒã‚¯): ', action, data);

      // ãƒ¢ãƒƒã‚¯æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™
      return {
        success: true,
        reply: "ãƒ€ãƒŸãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹",
        data: {}
      };
    }
    
    // ãƒ¢ãƒƒã‚¯APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
    function mockApiResponse(action, data) {
      // å®Ÿéš›ã®å®Ÿè£…ã§ã¯å‰Šé™¤ã—ã€æœ¬ç‰©ã®APIã¨æ¥ç¶šã™ã‚‹
      
      switch (action) {
        case 'getInitialMessage':
          // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å–å¾—
          const initialMessage = searchKeyword ? 
            `ã“ã‚“ã«ã¡ã¯ï¼ã€Œ${searchKeyword}ã€ã«ã¤ã„ã¦èˆˆå‘³ã‚’ãŠæŒã¡ã®ã‚ˆã†ã§ã™ã­ã€‚å¤–å£å¡—è£…ã«ã¤ã„ã¦ã€ã¾ãšã¯å¤–å£ã®çŠ¶æ…‹ã‚’æ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ` :
            "ã“ã‚“ã«ã¡ã¯ï¼å¤–å£å¡—è£…ãã‚‰ã¹ã‚‹ã¸ã‚ˆã†ã“ãã€‚ã¾ãšã¯å¤–å£ã®çŠ¶æ…‹ã«ã¤ã„ã¦æ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ";
            
          return {
            success: true,
            reply: initialMessage,
            sessionId: data.sessionId
          };
          
        case 'sendMessage':
          // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¯¾ã™ã‚‹å¿œç­”
          let reply = "ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚";
          
          if (data.message.includes('è‰¯å¥½') || data.message.includes('ã‚„ã‚„åŠ£åŒ–')) {
            reply = "ãã†ãªã‚“ã§ã™ã­ã€‚æ¬¡ã«æ–½å·¥æ™‚ã«é‡è¦–ã™ã‚‹ãƒã‚¤ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ";
          } else if (data.message.includes('ä¾¡æ ¼') || data.message.includes('å“è³ª')) {
            reply = "ã‚ã‹ã‚Šã¾ã—ãŸã€‚å¸Œæœ›ã™ã‚‹æ–½å·¥æ™‚æœŸã¯ã„ã¤é ƒã§ã—ã‚‡ã†ã‹ï¼Ÿ";
          } else if (data.message.includes('ã™ã') || data.message.includes('3ãƒ¶æœˆ')) {
            reply = "ã‹ã—ã“ã¾ã‚Šã¾ã—ãŸã€‚æœ€å¾Œã«å»ºç‰©ã®ç¨®é¡ã¨å¤§ãã•ã«ã¤ã„ã¦æ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ";
          } else if (userAnswers.length >= 3 && !data.retry) {
            // ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚°ã‚’è©¦ã¿ã‚‹
            reply = "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼ãŠå®¢æ§˜ã®æ¡ä»¶ã«åˆã£ãŸæœ€é©ãªæ¥­è€…ã‚’ã”ç´¹ä»‹ã§ãã¾ã™ã€‚ä»Šã™ãç„¡æ–™è¦‹ç©ã‚‚ã‚Šã‚’å—ã‘å–ã‚Šã¾ã™ã‹ï¼Ÿ";
          } else if (data.retry) {
            // 2å›ç›®ã®ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚°è©¦è¡Œ
            reply = "å¤–å£å¡—è£…ã¯æ—©ã‚ã«å¯¾å¿œã™ã‚‹ã“ã¨ã§ã€å°†æ¥çš„ãªä¿®ç¹•è²»ç”¨ã‚’å¤§ããæŠ‘ãˆã‚‰ã‚Œã¾ã™ã€‚æœ¬å½“ã«ç„¡æ–™è¦‹ç©ã‚‚ã‚Šã‚’å—ã‘å–ã‚‰ãªãã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ";
          }
          
          return {
            success: true,
            reply: reply,
            sessionId: data.sessionId
          };
          
        case 'getRecommendation':
          // æ¥­è€…ã®ææ¡ˆå–å¾—
          return {
            success: true,
            recommendation: `
              ã€ã‚ãªãŸã«ãŠã™ã™ã‚ã®æ¥­è€…ã€‘
              
              1. åŒ å¡—è£…å·¥æˆ¿
              - ç‰¹å¾´: å‰µæ¥­30å¹´ã®å®Ÿç¸¾ã€ç†Ÿç·´è·äººã«ã‚ˆã‚‹ä¸å¯§ãªæ–½å·¥
              - ä¾¡æ ¼å¸¯: 80ä¸‡å††ã€œ110ä¸‡å††
              - ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆ: ${userAnswers[1] === "å“è³ªé‡è¦–" ? "é«˜å“è³ªãªå¡—æ–™ã‚’ä½¿ç”¨ã—ã€ç¾ã—ã„ä»•ä¸ŠãŒã‚ŠãŒç‰¹å¾´" : "ä¾¡æ ¼ã¨å“è³ªã®ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ã„"}
              
              2. èª å®Ÿãƒšã‚¤ãƒ³ãƒˆ
              - ç‰¹å¾´: åœ°åŸŸå¯†ç€å‹ã€ä¿è¨¼å†…å®¹ãŒå……å®Ÿ
              - ä¾¡æ ¼å¸¯: 75ä¸‡å††ã€œ95ä¸‡å††
              - ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆ: ${userAnswers[0] === "ã‹ãªã‚ŠåŠ£åŒ–" ? "åŠ£åŒ–ãŒé€²ã‚“ã å¤–å£ã®è£œä¿®ãƒ»å¡—è£…ã«å®šè©•ã‚ã‚Š" : "ç„¡æ–™ç‚¹æ¤œã¨ä¸å¯§ãªã‚¢ãƒ•ã‚¿ãƒ¼ãƒ•ã‚©ãƒ­ãƒ¼"}
              
              3. ã‚°ãƒªãƒ¼ãƒ³ãƒšã‚¤ãƒ³ãƒˆ
              - ç‰¹å¾´: ç’°å¢ƒã«å„ªã—ã„å¡—æ–™ã‚’ä½¿ç”¨ã€çŸ­æœŸæ–½å·¥
              - ä¾¡æ ¼å¸¯: 68ä¸‡å††ã€œ90ä¸‡å††
              - ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆ: ${userAnswers[2] === "ç·Šæ€¥" ? "æœ€çŸ­2é€±é–“ã‹ã‚‰ã®æ–½å·¥å¯¾å¿œå¯èƒ½" : "ç’°å¢ƒã«é…æ…®ã—ãŸå¡—æ–™é¸å®šã¨ã‚³ã‚¹ãƒˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®é«˜ã•"}
            `,
            sessionId: data.sessionId
          };
          
        default:
          return {
            success: false,
            error: 'ä¸æ˜ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³',
            reply: "ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚"
          };
      }
    }
    
    // ç›¸å ´è¡¨ç¤ºé–¢æ•°
    function showAreaPrice() {
      // éƒµä¾¿ç•ªå·ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      const postalCode = document.getElementById('postalCode');
      const postalError = document.getElementById('postalError');
      
      if (!postalCode || !postalCode.value.trim()) {
        if (postalError) postalError.classList.remove('hidden');
        return;
      }
      
      // éƒµä¾¿ç•ªå·ã‚’æ­£è¦åŒ–ï¼ˆãƒã‚¤ãƒ•ãƒ³å‰Šé™¤ï¼‰
      let code = postalCode.value.trim().replace(/-/g, '');
      
      // éƒµä¾¿ç•ªå·ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¤œè¨¼ï¼ˆ7æ¡ã®æ•°å­—ï¼‰
      if (!/^\d{7}$/.test(code) && !/^\d{3}-\d{4}$/.test(postalCode.value.trim())) {
        if (postalError) postalError.classList.remove('hidden');
        return;
      }
      
      // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éè¡¨ç¤º
      if (postalError) postalError.classList.add('hidden');
      
      // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–
      initChatSession();
      
      // ç›¸å ´ã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
      const areaPrice = document.getElementById('areaPrice');
      if (areaPrice) {
        areaPrice.classList.remove('hidden');
        areaPrice.scrollIntoView({behavior: 'smooth'});
      }
      
      // æ¤œç´¢ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºã‚’å¤‰æ›´ï¼ˆèª­ã¿è¾¼ã¿ä¸­ï¼‰
      const searchButton = document.getElementById('searchButton');
      if (searchButton) {
        searchButton.disabled = true;
        searchButton.innerHTML = '<span class="flex items-center justify-center"><svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>æ¤œç´¢ä¸­...</span>';
      }
      
      // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
      let progress = 0;
      const progressInterval = setInterval(function() {
        progress += 3;
        const progressBar = document.getElementById('progressBar');
        if (progressBar) {
          progressBar.style.width = progress + '%';
        }
        
        if (progress >= 100) {
          clearInterval(progressInterval);
          
          // éƒµä¾¿ç•ªå·ã‚’APIã«é€ã‚‹ï¼ˆãƒ‡ãƒ¢ã§ã¯åœ°åŸŸåã ã‘æ›´æ–°ï¼‰
          updateLocationInfo(code);
          
          // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤ºã€çµæœã‚’è¡¨ç¤º
          const priceRevealAnimation = document.getElementById('priceRevealAnimation');
          const priceResult = document.getElementById('priceResult');
          
          if (priceRevealAnimation) priceRevealAnimation.classList.add('hidden');
          if (priceResult) priceResult.classList.remove('hidden');
          
          // æ¤œç´¢ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
          if (searchButton) {
            searchButton.disabled = false;
            searchButton.innerHTML = `
              <span class="flex items-center justify-center text-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                ç„¡æ–™ã§ç›¸å ´ã‚’è¦‹ã‚‹
              </span>
            `;
          }
        }
      }, 20);
    }
    
    // éƒµä¾¿ç•ªå·ã«åŸºã¥ãåœ°åŸŸæƒ…å ±æ›´æ–°ï¼ˆãƒ‡ãƒ¢ã§ã¯å›ºå®šãƒ‡ãƒ¼ã‚¿ï¼‰
    function updateLocationInfo(postalCode) {
      // éƒµä¾¿ç•ªå·ã®æœ€åˆã®3æ¡ã§åœ°åŸŸã‚’åˆ¤æ–­ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
      const locationHeading = document.getElementById('locationHeading');
      const priceRange = document.getElementById('priceRange');
      
      if (locationHeading && priceRange) {
        // éƒµä¾¿ç•ªå·ã®æœ€åˆã®3æ¡ã§åœ°åŸŸã‚’ç°¡æ˜“åˆ¤å®š
        const areaCode = postalCode.substring(0, 3);
        let location = 'æ±äº¬éƒ½æ–°å®¿åŒº';
        let price = '80ä¸‡ã€œ120ä¸‡å††';
        
        // ãƒ‡ãƒ¢ç”¨ã®ç°¡æ˜“ãƒãƒƒãƒ”ãƒ³ã‚°
        if (areaCode >= '100' && areaCode <= '105') {
          location = 'æ±äº¬éƒ½åƒä»£ç”°åŒº';
          price = '85ä¸‡ã€œ130ä¸‡å††';
        } else if (areaCode >= '150' && areaCode <= '152') {
          location = 'æ±äº¬éƒ½æ¸‹è°·åŒº';
          price = '90ä¸‡ã€œ135ä¸‡å††';
        } else if (areaCode >= '160' && areaCode <= '162') {
          location = 'æ±äº¬éƒ½æ–°å®¿åŒº';
          price = '80ä¸‡ã€œ125ä¸‡å††';
        } else if (areaCode >= '210' && areaCode <= '213') {
          location = 'ç¥å¥ˆå·çœŒå·å´å¸‚';
          price = '75ä¸‡ã€œ115ä¸‡å††';
        } else if (areaCode >= '220' && areaCode <= '232') {
          location = 'ç¥å¥ˆå·çœŒæ¨ªæµœå¸‚';
          price = '70ä¸‡ã€œ110ä¸‡å††';
        } else if (areaCode >= '330' && areaCode <= '332') {
          location = 'åŸ¼ç‰çœŒã•ã„ãŸã¾å¸‚';
          price = '65ä¸‡ã€œ105ä¸‡å††';
        } else if (areaCode >= '260' && areaCode <= '262') {
          location = 'åƒè‘‰çœŒåƒè‘‰å¸‚';
          price = '68ä¸‡ã€œ108ä¸‡å††';
        }
        
        // åœ°åŸŸã¨ä¾¡æ ¼ã‚’æ›´æ–°
        locationHeading.textContent = `${location}ã®å¤–å£å¡—è£…ç›¸å ´`;
        priceRange.textContent = price;
      }
    }
    
    // ãƒ’ã‚¢ãƒªãƒ³ã‚°ãƒœãƒƒãƒˆã®è³ªå•ã‚»ãƒƒãƒˆï¼ˆãƒ™ãƒ¼ã‚¹è³ªå•ã€‚APIã‹ã‚‰å‹•çš„ã«å¤‰æ›´ã•ã‚Œã‚‹å ´åˆã‚‚ã‚ã‚‹ï¼‰
    const baseQuestions = [
      {
        question: "Q1. å¤–å£ã®çŠ¶æ…‹ã¯ã©ã†ã§ã™ã‹ï¼Ÿ",
        options: [
          { text: "è‰¯å¥½ï¼ˆç›®ç«‹ã£ãŸåŠ£åŒ–ãªã—ï¼‰", value: "è‰¯å¥½" },
          { text: "ã‚„ã‚„åŠ£åŒ–ï¼ˆéƒ¨åˆ†çš„ãªæ±šã‚Œã‚ã‚Šï¼‰", value: "ã‚„ã‚„åŠ£åŒ–" },
          { text: "åŠ£åŒ–ï¼ˆã²ã³å‰²ã‚Œã‚ã‚Šï¼‰", value: "åŠ£åŒ–" },
          { text: "ã‹ãªã‚ŠåŠ£åŒ–ï¼ˆã¯ãŒã‚Œãƒ»æµ®ãã‚ã‚Šï¼‰", value: "ã‹ãªã‚ŠåŠ£åŒ–" }
        ]
      },
      {
        question: "Q2. æ–½å·¥æ™‚ã®é‡è¦–ãƒã‚¤ãƒ³ãƒˆã¯ï¼Ÿ",
        options: [
          { text: "ä¾¡æ ¼ã®å®‰ã•", value: "ä¾¡æ ¼é‡è¦–" },
          { text: "å“è³ªã®é«˜ã•", value: "å“è³ªé‡è¦–" },
          { text: "ä¿è¨¼ã®å……å®Ÿ", value: "ä¿è¨¼é‡è¦–" },
          { text: "å¯¾å¿œã®é€Ÿã•", value: "ã‚¹ãƒ”ãƒ¼ãƒ‰é‡è¦–" }
        ]
      },
      {
        question: "Q3. å¸Œæœ›ã™ã‚‹å¡—è£…å·¥äº‹ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯ï¼Ÿ",
        options: [
          { text: "ã™ãã«ã§ã‚‚ï¼ˆ1ãƒ¶æœˆä»¥å†…ï¼‰", value: "ç·Šæ€¥" },
          { text: "3ãƒ¶æœˆä»¥å†…", value: "3ãƒ¶æœˆä»¥å†…" },
          { text: "åŠå¹´ä»¥å†…", value: "åŠå¹´ä»¥å†…" },
          { text: "æ¤œè¨ä¸­ï¼ˆ1å¹´ä»¥å†…ï¼‰", value: "æ¤œè¨ä¸­" }
        ]
      },
      {
        question: "Q4. å¡—è£…é¢ç©ã¯ãŠã‚ˆãã©ã‚Œãã‚‰ã„ã§ã™ã‹ï¼Ÿ",
        options: [
          { text: "å°ã•ã‚ï¼ˆ15åªä»¥ä¸‹ï¼‰", value: "å°" },
          { text: "ã‚„ã‚„å°ã•ã‚ï¼ˆ16ã€œ25åªï¼‰", value: "ä¸­å°" },
          { text: "ä¸€èˆ¬çš„ï¼ˆ26ã€œ35åªï¼‰", value: "ä¸­" },
          { text: "å¤§ãã‚ï¼ˆ36åªä»¥ä¸Šï¼‰", value: "å¤§" }
        ]
      }
    ];
    
    // è¿½åŠ ã®è³ªå•ã‚»ãƒƒãƒˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å›ç­”ã«å¿œã˜ã¦å‹•çš„ã«è¡¨ç¤ºï¼‰
    const additionalQuestions = {
      // å¤–å£ãŒåŠ£åŒ–ã—ã¦ã„ã‚‹å ´åˆã®è¿½åŠ è³ªå•
      "åŠ£åŒ–": {
        question: "ã²ã³å‰²ã‚Œã¯ã©ã®ç¨‹åº¦ã§ã™ã‹ï¼Ÿ",
        options: [
          { text: "ç´°ã„ã²ã³å‰²ã‚ŒãŒå°‘ã—ã‚ã‚‹", value: "è»½å¾®ãªã²ã³å‰²ã‚Œ" },
          { text: "è¤‡æ•°ã®å ´æ‰€ã«ã²ã³å‰²ã‚ŒãŒã‚ã‚‹", value: "è¤‡æ•°ç®‡æ‰€ã®ã²ã³å‰²ã‚Œ" },
          { text: "å¤§ããªã²ã³å‰²ã‚ŒãŒã‚ã‚‹", value: "å¤§ããªã²ã³å‰²ã‚Œ" },
          { text: "ã‚ˆãã‚ã‹ã‚‰ãªã„", value: "ä¸æ˜" }
        ]
      },
      // ä¾¡æ ¼é‡è¦–ã®å ´åˆã®è¿½åŠ è³ªå•
      "ä¾¡æ ¼é‡è¦–": {
        question: "ãŠè€ƒãˆã®äºˆç®—ã¯ã©ã®ãã‚‰ã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ",
        options: [
          { text: "ã§ãã‚‹ã ã‘å®‰ãï¼ˆ60ä¸‡å††ä»¥ä¸‹ï¼‰", value: "æœ€ä½é™" },
          { text: "æ¨™æº–ã‚ˆã‚Šå®‰ã‚ï¼ˆ60ã€œ80ä¸‡å††ï¼‰", value: "å®‰ã‚" },
          { text: "ä¸€èˆ¬çš„ãªç›¸å ´ï¼ˆ80ã€œ100ä¸‡å††ï¼‰", value: "æ¨™æº–" },
          { text: "äºˆç®—ã¯æŸ”è»Ÿã«æ¤œè¨ã§ãã‚‹", value: "æŸ”è»Ÿ" }
        ]
      },
      // ç·Šæ€¥ã®å ´åˆã®è¿½åŠ è³ªå•
      "ç·Šæ€¥": {
        question: "æ€¥ã„ã§ã„ã‚‹ç†ç”±ã‚’æ•™ãˆã¦ãã ã•ã„",
        options: [
          { text: "é›¨æ¼ã‚ŠãŒã—ã¦ã„ã‚‹", value: "é›¨æ¼ã‚Š" },
          { text: "å¤–å£ã®å‰¥ãŒã‚ŒãŒæ¿€ã—ã„", value: "å‰¥ãŒã‚Œ" },
          { text: "è¿‘ã€…ã®å¼•ã£è¶Šã—ãƒ»å£²å´ã®ãŸã‚", value: "å£²å´äºˆå®š" },
          { text: "ä»–ã®äº‹æƒ…ï¼ˆãƒªãƒ•ã‚©ãƒ¼ãƒ ãªã©ï¼‰", value: "ãã®ä»–" }
        ]
      }
    };
    
    // è³ªå•è¡¨ç¤ºã®ãŸã‚ã®å‹•çš„é…åˆ—
    let questions = [...baseQuestions];
    
    // è³ªå•ã‚’åˆæœŸåŒ–ï¼ˆæœ€åˆã®ãƒ™ãƒ¼ã‚¹è³ªå•ã‚’è¨­å®šï¼‰
    function initQuestions() {
      questions = [...baseQuestions];
      currentQuestionIndex = 0;
      userAnswers = [];
    }
    
    // å‰ã®è³ªå•ã«æˆ»ã‚‹å‡¦ç†
    function goToPreviousQuestion() {
      if (currentQuestionIndex > 0) {
        // ç¾åœ¨ã®å›ç­”ã‚’å‰Šé™¤
        userAnswers.pop();
        
        // å›ç­”å±¥æ­´ã‹ã‚‰å‰Šé™¤
        const botHistory = document.getElementById('botHistory');
        const displayIndex = currentQuestionIndex + 1; // 1-indexedã®è¡¨ç¤ºç”¨
        const answerElement = document.getElementById(`answer${displayIndex}`);
        if (answerElement && answerElement.parentElement) {
          answerElement.parentElement.classList.add('hidden');
        }
        
        // å‰ã®è³ªå•ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«æˆ»ã‚‹
        currentQuestionIndex--;
        
        // å‰ã®è³ªå•ã‚’è¡¨ç¤º
        showQuestion(currentQuestionIndex);
      }
    }
    
    // è³ªå•è¡¨ç¤ºã‚’é–‹å§‹ã™ã‚‹é–¢æ•°ï¼ˆãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã®åˆæœŸåŒ–ï¼‰
    function initChatBot() {
      try {
        // è³ªå•ã‚’åˆæœŸåŒ–
        initQuestions();

        // APIã‚³ãƒ¼ãƒ«ã‚’ãªãã—ã¦ç›´æ¥è¡¨ç¤º
        console.log('ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆåˆæœŸåŒ–');

        // æœ€åˆã®è³ªå•ã‚’è¡¨ç¤º
        showQuestion(0);
      } catch (error) {
        console.error('ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
      }
    }
    
    // è³ªå•è¡¨ç¤ºé–¢æ•°ï¼ˆãƒ™ãƒ¼ã‚¹é–¢æ•°ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸæ©Ÿèƒ½å¼·åŒ–ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
    function showQuestion(index) {
      const botQuestion = document.getElementById('botQuestion');
      const botChoices = document.getElementById('botChoices');
      const typingContent = document.getElementById('typingContent');
      const backButton = document.getElementById('backButton');
      
      if (!botQuestion || !botChoices || !typingContent || !backButton) return;
      
      const question = questions[index];
      if (!question) return;
      
      // ãƒãƒƒã‚¯ãƒœã‚¿ãƒ³ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’è¨­å®š
      if (index > 0) {
        backButton.classList.remove('hidden');
      } else {
        backButton.classList.add('hidden');
      }
      
      // è³ªå•ç•ªå·ã®æ›´æ–°
      document.getElementById('currentQuestion').textContent = index + 1;
      
      // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
      startTypingAnimation(question.question);
      
      // é¸æŠè‚¢ã®æ›´æ–°
      botChoices.innerHTML = question.options.map(option => `
        <button class="botAnswer bg-gray-100 hover:bg-kuraberu-blue hover:text-white py-2 px-3 rounded-lg text-sm text-left transition-colors" data-answer="${option.value}">
          ${option.text}
        </button>
      `).join('');
      
      // é¸æŠè‚¢ã‚’éè¡¨ç¤ºã«
      botChoices.style.opacity = '0';
      
      // ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã¯ startTypingAnimation å†…ã§è¨­å®š
    }
    
    // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    function startTypingAnimation(questionText) {
      const typingContent = document.getElementById('typingContent');
      const botChoices = document.getElementById('botChoices');
      if (!typingContent || !botChoices) {
        return;
      }
      
      let currentText = "";
      let fullText = questionText || "Q1. å¤–å£ã®çŠ¶æ…‹ã¯ã©ã†ã§ã™ã‹ï¼Ÿ";
      let charIndex = 0;
      
      // åˆã‚ã¯ã‚«ãƒ¼ã‚½ãƒ«ã ã‘è¡¨ç¤º
      typingContent.innerHTML = '<span class="typing-cursor">|</span>';
      
      // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
      const typingInterval = setInterval(() => {
        if (charIndex < fullText.length) {
          currentText += fullText.charAt(charIndex);
          typingContent.innerHTML = currentText + '<span class="typing-cursor">|</span>';
          charIndex++;
        } else {
          clearInterval(typingInterval);
          
          // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°çµ‚äº†å¾Œã€é¸æŠè‚¢ã‚’è¡¨ç¤º
          setTimeout(() => {
            botChoices.style.display = 'grid';
            setTimeout(() => {
              botChoices.style.opacity = '1';
              
              // ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šï¼ˆå†è¨­å®šï¼‰
              const botAnswerButtons = document.querySelectorAll('.botAnswer');
              botAnswerButtons.forEach(button => {
                button.addEventListener('click', function() {
                  const answer = this.getAttribute('data-answer');
                  handleAnswer(currentQuestionIndex, answer);
                });
              });
            }, 50);
          }, 700);
        }
      }, 50);
    }
    
    // å›ç­”å‡¦ç†é–¢æ•°ï¼ˆå‹•çš„è³ªå•ã«å¯¾å¿œã—ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
    function handleAnswer(index, answer) {
      // å›ç­”ã‚’ä¿å­˜
      userAnswers.push(answer);

      // å›ç­”å±¥æ­´ã‚’è¡¨ç¤º
      updateAnswerHistory(index, answer);
      
      // ãƒœã‚¿ãƒ³ã‚’ä¸€æ™‚çš„ã«éè¡¨ç¤º
      const botChoices = document.getElementById('botChoices');
      if (botChoices) {
        botChoices.style.opacity = '0';
        setTimeout(() => {
          botChoices.style.display = 'none';
          
          // å›ç­”ã‚’APIã«é€ä¿¡ã—æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ±ºå®š
          processAnswer(index, answer);
        }, 300);
      }
    }
    
    // å›ç­”ã‚’å‡¦ç†ã—ã¦æ¬¡ã®è³ªå•ã‚’æ±ºå®šã™ã‚‹é–¢æ•°
    function processAnswer(index, answer) {
      try {
        console.log('å›ç­”ã‚’å‡¦ç†:', answer, 'for question', index);

        // å›ç­”ã«åŸºã¥ãè¿½åŠ è³ªå•ã®æŒ¿å…¥åˆ¤å®š
        if (additionalQuestions[answer] && index < questions.length - 1) {
          // è¿½åŠ è³ªå•ã‚’æ¬¡ã®è³ªå•ã¨ã—ã¦æŒ¿å…¥
          questions.splice(index + 1, 0, additionalQuestions[answer]);
          console.log('è¿½åŠ è³ªå•ã‚’æŒ¿å…¥:', additionalQuestions[answer].question);
        }

        // æ¬¡ã®è³ªå•ã¸é€²ã‚€
        currentQuestionIndex++;
        
        if (currentQuestionIndex < questions.length) {
          // ã¾ã è³ªå•ãŒæ®‹ã£ã¦ã„ã‚‹å ´åˆ
          setTimeout(() => {
            showQuestion(currentQuestionIndex);
          }, 300);
        } else {
          // å…¨ã¦ã®è³ªå•ãŒçµ‚ã‚ã£ãŸå ´åˆ
          completeHearing();
        }
      } catch (error) {
        console.error('å›ç­”å‡¦ç†ä¸­ã®ã‚¨ãƒ©ãƒ¼:', error);
      }
    }
    
    // å›ç­”å±¥æ­´ã®æ›´æ–°
    function updateAnswerHistory(index, answer) {
      const botHistory = document.getElementById('botHistory');
      const currentQuestion = questions[index];
      
      if (!botHistory || !currentQuestion) return;
      
      // å›ç­”å±¥æ­´ã‚’è¡¨ç¤º
      botHistory.classList.remove('hidden');
      
      // å¿…è¦ãªå±¥æ­´è¦ç´ ã‚’è¿½åŠ ï¼ˆæœ€å¤§4ã¤ã¾ã§ï¼‰
      let historyItemCount = botHistory.querySelectorAll('div.flex').length;
      const displayIndex = index + 1; // 1-indexedã®è¡¨ç¤ºç”¨
      
      // æ—¢å­˜ã®å›ç­”è¦ç´ ã‚’æ¤œç´¢
      let answerElement = document.getElementById(`answer${displayIndex}`);
      
      if (!answerElement) {
        // è¦ç´ ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯æ–°è¦ä½œæˆ
        const historyItem = document.createElement('div');
        historyItem.className = 'flex items-start mb-1';
        historyItem.innerHTML = `
          <span class="font-bold mr-2">Q${displayIndex}:</span>
          <span id="answer${displayIndex}">${answer}</span>
        `;
        botHistory.appendChild(historyItem);
      } else {
        // å­˜åœ¨ã™ã‚‹å ´åˆã¯æ›´æ–°
        answerElement.textContent = answer;
        answerElement.parentElement.classList.remove('hidden');
      }
    }
    
    // ãƒ’ã‚¢ãƒªãƒ³ã‚°å®Œäº†é–¢æ•°ï¼ˆAPIã§ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ï¼‰
    async function completeHearing() {
      try {
        // è³ªå•ã‚¨ãƒªã‚¢ã‚’å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¤‰æ›´
        const botQuestion = document.getElementById('botQuestion');
        if (botQuestion) {
          botQuestion.innerHTML = `
            <div class="text-center py-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-kuraberu-green mx-auto mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <p class="font-bold text-kuraberu-blue mb-1">ãƒ’ã‚¢ãƒªãƒ³ã‚°å®Œäº†ï¼</p>
              <p class="text-sm text-gray-600">ã‚ãªãŸã«ã´ã£ãŸã‚Šã®æ¥­è€…ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™</p>
            </div>
          `;
        }
        
        // ã‚¹ã‚­ãƒƒãƒ—ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
        const skipHearing = document.getElementById('skipHearing');
        if (skipHearing) {
          skipHearing.classList.add('hidden');
        }
        
        // ã‚½ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
        const sortButtons = document.getElementById('sortButtons');
        if (sortButtons) {
          sortButtons.classList.remove('hidden');
          
          // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€ŒãŠã™ã™ã‚é †ã€ã‚’é¸æŠçŠ¶æ…‹ã«ã™ã‚‹ï¼ˆBOTãŒå®Œäº†ã—ãŸã¨ãï¼‰
          const tabRecommend = document.getElementById('tabRecommend');
          if (tabRecommend) {
            // ä»–ã®ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçŠ¶æ…‹ã«
            document.querySelectorAll('#tabCheap, #tabReview, #tabQuality').forEach(btn => {
              if (btn.id === 'tabCheap') {
                btn.querySelector('div').className = 'absolute inset-0 bg-gradient-to-b from-red-300 to-red-400 z-0';
                btn.classList.remove('bg-red-600', 'hover:bg-red-700', 'border-red-700');
                btn.classList.add('bg-red-300', 'hover:bg-red-400', 'border-red-400');
              } else if (btn.id === 'tabReview') {
                btn.querySelector('div').className = 'absolute inset-0 bg-gradient-to-b from-lime-300 to-lime-400 z-0';
                btn.classList.remove('bg-green-600', 'hover:bg-green-700', 'border-green-700');
                btn.classList.add('bg-lime-300', 'hover:bg-lime-400', 'border-lime-400');
              } else if (btn.id === 'tabQuality') {
                btn.querySelector('div').className = 'absolute inset-0 bg-gradient-to-b from-purple-300 to-purple-400 z-0';
                btn.classList.remove('bg-purple-600', 'hover:bg-purple-700', 'border-purple-700');
                btn.classList.add('bg-purple-300', 'hover:bg-purple-400', 'border-purple-400');
              }
            });
            
            // ãŠã™ã™ã‚é †ãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
            tabRecommend.classList.remove('bg-white', 'border-gray-200');
            tabRecommend.classList.add('bg-blue-100', 'border-blue-300');
            
            // èƒŒæ™¯è‰²ã‚’è¨­å®š
            const allCompanies = document.getElementById('allCompanies');
            if (allCompanies) {
              allCompanies.style.backgroundColor = 'rgba(239, 246, 255, 0.5)'; // è–„ã„é’è‰²
            }
          }
        }
        
        // APIã‹ã‚‰æ¥­è€…ã®ææ¡ˆã‚’å–å¾—
        const recommendation = await callScriptApi('getRecommendation', {
          answers: userAnswers
        });
        
        if (recommendation.success) {
          console.log('æ¥­è€…ææ¡ˆ:', recommendation.recommendation);
        }
        
        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®é †åºã‚’å¤‰æ›´ï¼ˆã“ã“ã§ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«è¡¨ç¾ï¼‰
        setTimeout(() => {
          // è¿½åŠ ã®æ¥­è€…ã‚’è¡¨ç¤º
          const additionalCompanies = document.getElementById('additionalCompanies');
          if (additionalCompanies) {
            additionalCompanies.classList.remove('hidden');
          }
          
          // ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ææ¡ˆæ©Ÿèƒ½ã¯å‰Šé™¤ã•ã‚Œã¾ã—ãŸ
        }, 1000);
      } catch (error) {
        console.error('ãƒ’ã‚¢ãƒªãƒ³ã‚°å®Œäº†å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
      }
    }
    
    // ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³é–¢é€£ã®æ©Ÿèƒ½ã¯ã™ã¹ã¦å‰Šé™¤ã•ã‚Œã¾ã—ãŸ

    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‡¦ç†ã¨ãƒšãƒ¼ã‚¸åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      // URLã‹ã‚‰postalãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—
      const urlParams = new URLSearchParams(window.location.search);
      const postalCode = urlParams.get('postal');
      
      if (postalCode) {
        // éƒµä¾¿ç•ªå·ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯è‡ªå‹•çš„ã«ç›¸å ´è¡¨ç¤º
        handlePostalCodeFromURL(postalCode);
      }
      
      // æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      const backButton = document.getElementById('backButton');
      if (backButton) {
        backButton.addEventListener('click', function() {
          goToPreviousQuestion();
        });
      }
      
      // ç›¸å ´ç¢ºèªãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      const showAccuratePriceBtn = document.getElementById('showAccuratePrice');
      if (showAccuratePriceBtn) {
        showAccuratePriceBtn.addEventListener('click', function() {
          // æ¥­è€…ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
          const companyRankingSection = document.getElementById('companyRankingSection');
          if (companyRankingSection) {
            companyRankingSection.classList.remove('hidden');
          }
          
          // ç›¸å ´è¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆareaPriceï¼‰ã®ä¸Šéƒ¨ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
          const areaPrice = document.getElementById('areaPrice');
          if (areaPrice) {
            areaPrice.scrollIntoView({ 
              behavior: 'smooth',
              block: 'start'
            });
          }
          
          // ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚’é–‹å§‹
          if (typeof chatbot !== 'undefined' && chatbot.startBotMode) {
            chatbot.startBotMode();
          }
        });
      }
      
      // ã‚­ãƒ¼ãƒ—ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      const keepButtons = document.querySelectorAll('.keepButton');
      // æœ€åˆã®å¤ã„ã‚­ãƒ¼ãƒ—ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯å‰Šé™¤ï¼ˆæ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã§ä¸‹éƒ¨ã«å®Ÿè£…ï¼‰
      
      // ä¼šç¤¾ãƒ‡ãƒ¼ã‚¿ã®ã‚µãƒ³ãƒ—ãƒ«ï¼ˆå„ã‚½ãƒ¼ãƒˆç”¨ã«é †åºã‚’å¤‰ãˆã‚‹ï¼‰
      const companyData = {
        // ãŠã™ã™ã‚é †
        recommend: [
          { id: 1, name: 'Tç¤¾', rating: 4.9, price: '78ä¸‡å††ã€œ', features: ['åœ°å…ƒå¯†ç€', 'ä¿è¨¼å……å®Ÿ', 'å³æ—¥å¯¾å¿œ'], work: 1200 },
          { id: 2, name: 'Sç¤¾', rating: 4.7, price: '83ä¸‡å††ã€œ', features: ['æœ€ä½ä¾¡æ ¼ä¿è¨¼', 'è·äººç›´å–¶'], work: 980 },
          { id: 3, name: 'Kç¤¾', rating: 4.5, price: '85ä¸‡å††ã€œ', features: ['å®šæœŸç‚¹æ¤œä»˜', 'ç’°å¢ƒé…æ…®'], work: 850 },
          { id: 4, name: 'Pç¤¾', rating: 4.3, price: '92ä¸‡å††ã€œ', features: ['10å¹´ä¿è¨¼', 'é«˜ç´šå¡—æ–™ä½¿ç”¨'], work: 760 }
        ],
        // å®‰ã„é †
        cheap: [
          { id: 5, name: 'Mç¤¾', rating: 4.2, price: '76ä¸‡å††ã€œ', features: ['5å¹´ä¿è¨¼', 'ä¸å¯§æ–½å·¥'], work: 720 },
          { id: 1, name: 'Tç¤¾', rating: 4.9, price: '78ä¸‡å††ã€œ', features: ['åœ°å…ƒå¯†ç€', 'ä¿è¨¼å……å®Ÿ', 'å³æ—¥å¯¾å¿œ'], work: 1200 },
          { id: 2, name: 'Sç¤¾', rating: 4.7, price: '83ä¸‡å††ã€œ', features: ['æœ€ä½ä¾¡æ ¼ä¿è¨¼', 'è·äººç›´å–¶'], work: 980 },
          { id: 3, name: 'Kç¤¾', rating: 4.5, price: '85ä¸‡å††ã€œ', features: ['å®šæœŸç‚¹æ¤œä»˜', 'ç’°å¢ƒé…æ…®'], work: 850 }
        ],
        // å£ã‚³ãƒŸé †
        review: [
          { id: 1, name: 'Tç¤¾', rating: 4.9, price: '78ä¸‡å††ã€œ', features: ['åœ°å…ƒå¯†ç€', 'ä¿è¨¼å……å®Ÿ', 'å³æ—¥å¯¾å¿œ'], work: 1200 },
          { id: 2, name: 'Sç¤¾', rating: 4.7, price: '83ä¸‡å††ã€œ', features: ['æœ€ä½ä¾¡æ ¼ä¿è¨¼', 'è·äººç›´å–¶'], work: 980 },
          { id: 6, name: 'Qç¤¾', rating: 4.5, price: '96ä¸‡å††ã€œ', features: ['å®Ÿç¸¾å¤šæ•°', 'æ°´æ€§å¡—æ–™'], work: 680 },
          { id: 3, name: 'Kç¤¾', rating: 4.5, price: '85ä¸‡å††ã€œ', features: ['å®šæœŸç‚¹æ¤œä»˜', 'ç’°å¢ƒé…æ…®'], work: 850 }
        ],
        // é«˜å“è³ªé †
        quality: [
          { id: 4, name: 'Pç¤¾', rating: 4.3, price: '92ä¸‡å††ã€œ', features: ['10å¹´ä¿è¨¼', 'é«˜ç´šå¡—æ–™ä½¿ç”¨'], work: 760 },
          { id: 1, name: 'Tç¤¾', rating: 4.9, price: '78ä¸‡å††ã€œ', features: ['åœ°å…ƒå¯†ç€', 'ä¿è¨¼å……å®Ÿ', 'å³æ—¥å¯¾å¿œ'], work: 1200 },
          { id: 7, name: 'Aç¤¾', rating: 4.4, price: '98ä¸‡å††ã€œ', features: ['å®¶æ—çµŒå–¶', 'ç´¹ä»‹å‰²å¼•'], work: 510 },
          { id: 2, name: 'Sç¤¾', rating: 4.7, price: '83ä¸‡å††ã€œ', features: ['æœ€ä½ä¾¡æ ¼ä¿è¨¼', 'è·äººç›´å–¶'], work: 980 }
        ]
      };
      
      // ä¼šç¤¾ã‚«ãƒ¼ãƒ‰ã‚’ä½œæˆã™ã‚‹é–¢æ•°
      function createCompanyCard(company, index) {
        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºç”¨ã®è‰²ã¨ãƒ©ãƒ™ãƒ«
        const rankingColor = index === 0 ? 'bg-yellow-500' : 
                            index === 1 ? 'bg-gray-500' : 
                            index === 2 ? 'bg-orange-500' : 'bg-gray-400';
        const rankNumber = index + 1;
        
        // æ˜Ÿè©•ä¾¡ã‚’è¡¨ç¤º
        const stars = "â˜…".repeat(Math.floor(company.rating)) + "â˜†".repeat(5 - Math.floor(company.rating));
        
        // ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒãƒƒã‚¸ã®è‰²ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«
        const badgeColors = ['blue', 'green', 'red', 'orange', 'purple', 'yellow'];
        
        // ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒãƒƒã‚¸ã®ä½œæˆ
        const featureBadges = company.features.map(feature => {
          const color = badgeColors[Math.floor(Math.random() * badgeColors.length)];
          return `<span class="bg-${color}-100 text-${color}-700 px-1 py-0.5 rounded text-[10px]">${feature}</span>`;
        }).join('');
        
        // ã‚«ãƒ¼ãƒ‰ã®HTMLã‚’ä½œæˆ
        return `
          <div class="company-card bg-white p-3 rounded-lg mb-2 relative border border-gray-200 shadow-sm transition-all duration-300 hover:shadow-lg hover:border-yellow-300 hover:-translate-y-1">
            <div class="absolute -top-1 -left-1 w-5 h-5 rounded-full ${rankingColor} flex items-center justify-center text-white text-xs font-bold">${rankNumber}</div>
            <div class="pl-5">
              <div class="flex justify-between mb-1">
                <div class="font-bold">${company.name}</div><div class="text-xs text-gray-500">â€»é›»è©±ç•ªå·å…¥åŠ›å¾Œã«è©³ç´°é–‹ç¤º</div>
                <div class="text-yellow-500">${stars} <span class="text-gray-500 text-xs">${company.rating}</span></div>
              </div>
              <div class="flex gap-1 mb-1">
                ${featureBadges}
              </div>
              <div class="flex justify-between text-sm">
                <div>è¦‹ç©ã‚‚ã‚Šä¾¡æ ¼: <span class="text-kuraberu-blue font-bold">${company.price}</span></div>
                <div class="text-gray-500 text-xs">æ–½å·¥å®Ÿç¸¾: ${company.work}ä»¶</div>
              </div>
              <div class="flex justify-between mt-1">
                <div class="flex space-x-2 justify-end mt-2">
                  <button class="detailButton bg-kuraberu-blue hover:bg-blue-600 text-white text-sm px-3 py-1 rounded-md transition-colors shadow-sm font-medium" data-company="${company.id}">
                    è©³ç´°ã‚’è¦‹ã‚‹
                  </button>
                  <button class="keepButton bg-gray-200 hover:bg-kuraberu-yellow text-sm px-3 py-1 rounded-md transition-colors shadow-sm font-medium" data-company="${company.id}">
                    ã‚­ãƒ¼ãƒ—ã™ã‚‹
                  </button>
                </div>
              </div>
            </div>
          </div>
        `;
      }
      
      // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      const tabButtons = document.querySelectorAll('#tabRecommend, #tabCheap, #tabReview, #tabQuality');
      const allCompanies = document.getElementById('allCompanies');
      
      // åˆæœŸçŠ¶æ…‹ã§ã¯ãŠã™ã™ã‚é †ã‚’é¸æŠçŠ¶æ…‹ã«
      if (allCompanies) {
        allCompanies.style.backgroundColor = 'rgba(239, 246, 255, 0.5)'; // è–„ã„é’è‰²
        
        // ãŠã™ã™ã‚é †ãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
        const tabRecommend = document.getElementById('tabRecommend');
        if (tabRecommend) {
          tabRecommend.classList.remove('bg-white', 'border-gray-200');
          tabRecommend.classList.add('bg-blue-100', 'border-blue-300');
        }
      }
      
      tabButtons.forEach(button => {
        button.addEventListener('click', function() {
          // å…¨ã¦ã®ã‚¿ãƒ–ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã«æˆ»ã™
          tabButtons.forEach(btn => {
            btn.classList.remove('bg-blue-100', 'bg-orange-100', 'bg-green-100', 'bg-purple-100');
            btn.classList.remove('border-blue-300', 'border-orange-300', 'border-green-300', 'border-purple-300');
            btn.classList.remove('hover:bg-blue-100', 'hover:bg-orange-100', 'hover:bg-green-100', 'hover:bg-purple-100');
            btn.classList.add('bg-white', 'border-gray-200');
            
            // ãƒ›ãƒãƒ¼çŠ¶æ…‹ã‚’å…ƒã«æˆ»ã™
            if (btn.id === 'tabRecommend') {
              btn.classList.add('hover:bg-blue-50');
            } else if (btn.id === 'tabCheap') {
              btn.classList.add('hover:bg-orange-50');
            } else if (btn.id === 'tabReview') {
              btn.classList.add('hover:bg-green-50');
            } else if (btn.id === 'tabQuality') {
              btn.classList.add('hover:bg-purple-50');
            }
          });
          
          // ã‚«ãƒ¼ãƒ‰ã®èƒŒæ™¯è‰²ã‚’ãƒªã‚»ãƒƒãƒˆ
          const allCompanies = document.getElementById('allCompanies');
          if (allCompanies) {
            allCompanies.style.backgroundColor = 'white';
          }
          
          // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
          if (this.id === 'tabRecommend') {
            this.classList.remove('bg-white', 'border-gray-200', 'hover:bg-blue-50');
            this.classList.add('bg-blue-100', 'border-blue-300', 'hover:bg-blue-100');
            // ã‚«ãƒ¼ãƒ‰ã®èƒŒæ™¯è‰²ã‚’é€£å‹•
            if (allCompanies) {
              allCompanies.style.backgroundColor = 'rgba(239, 246, 255, 0.5)'; // è–„ã„é’è‰²
              
              // ã‚«ãƒ¼ãƒ‰ã®å†…å®¹ã‚’å…¥ã‚Œæ›¿ãˆï¼ˆãƒ‡ãƒ¢ç”¨ã‚³ãƒ¡ãƒ³ãƒˆï¼‰
              console.log('ãŠã™ã™ã‚é †ã«è¡¨ç¤º: ', companyData.recommend);
              
              // å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§è¡¨ç¤ºæ›´æ–°
              /*
              // HTMLã‚’ç”Ÿæˆ
              const companiesHTML = companyData.recommend.map(createCompanyCard).join('');
              // HTMLã‚’æŒ¿å…¥
              document.querySelector('#companyList').innerHTML = companiesHTML;
              */
            }
          } else if (this.id === 'tabCheap') {
            this.classList.remove('bg-white', 'border-gray-200', 'hover:bg-orange-50');
            this.classList.add('bg-orange-100', 'border-orange-300', 'hover:bg-orange-100');
            // ã‚«ãƒ¼ãƒ‰ã®èƒŒæ™¯è‰²ã‚’é€£å‹•
            if (allCompanies) {
              allCompanies.style.backgroundColor = 'rgba(255, 247, 237, 0.5)'; // è–„ã„ã‚ªãƒ¬ãƒ³ã‚¸è‰²
              
              // ã‚«ãƒ¼ãƒ‰ã®å†…å®¹ã‚’å…¥ã‚Œæ›¿ãˆï¼ˆãƒ‡ãƒ¢ç”¨ã‚³ãƒ¡ãƒ³ãƒˆï¼‰
              console.log('å®‰ã„é †ã«è¡¨ç¤º: ', companyData.cheap);
              
              // å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§è¡¨ç¤ºæ›´æ–°
              /*
              // HTMLã‚’ç”Ÿæˆ
              const companiesHTML = companyData.cheap.map(createCompanyCard).join('');
              // HTMLã‚’æŒ¿å…¥
              document.querySelector('#companyList').innerHTML = companiesHTML;
              */
            }
          } else if (this.id === 'tabReview') {
            this.classList.remove('bg-white', 'border-gray-200', 'hover:bg-green-50');
            this.classList.add('bg-green-100', 'border-green-300', 'hover:bg-green-100');
            // ã‚«ãƒ¼ãƒ‰ã®èƒŒæ™¯è‰²ã‚’é€£å‹•
            if (allCompanies) {
              allCompanies.style.backgroundColor = 'rgba(240, 253, 244, 0.5)'; // è–„ã„ç·‘è‰²
              
              // ã‚«ãƒ¼ãƒ‰ã®å†…å®¹ã‚’å…¥ã‚Œæ›¿ãˆï¼ˆãƒ‡ãƒ¢ç”¨ã‚³ãƒ¡ãƒ³ãƒˆï¼‰
              console.log('å£ã‚³ãƒŸé †ã«è¡¨ç¤º: ', companyData.review);
              
              // å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§è¡¨ç¤ºæ›´æ–°
              /*
              // HTMLã‚’ç”Ÿæˆ
              const companiesHTML = companyData.review.map(createCompanyCard).join('');
              // HTMLã‚’æŒ¿å…¥
              document.querySelector('#companyList').innerHTML = companiesHTML;
              */
            }
          } else if (this.id === 'tabQuality') {
            this.classList.remove('bg-white', 'border-gray-200', 'hover:bg-purple-50');
            this.classList.add('bg-purple-100', 'border-purple-300', 'hover:bg-purple-100');
            // ã‚«ãƒ¼ãƒ‰ã®èƒŒæ™¯è‰²ã‚’é€£å‹•
            if (allCompanies) {
              allCompanies.style.backgroundColor = 'rgba(250, 245, 255, 0.5)'; // è–„ã„ç´«è‰²
              
              // ã‚«ãƒ¼ãƒ‰ã®å†…å®¹ã‚’å…¥ã‚Œæ›¿ãˆï¼ˆãƒ‡ãƒ¢ç”¨ã‚³ãƒ¡ãƒ³ãƒˆï¼‰
              console.log('é«˜å“è³ªé †ã«è¡¨ç¤º: ', companyData.quality);
              
              // å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§è¡¨ç¤ºæ›´æ–°
              /*
              // HTMLã‚’ç”Ÿæˆ
              const companiesHTML = companyData.quality.map(createCompanyCard).join('');
              // HTMLã‚’æŒ¿å…¥
              document.querySelector('#companyList').innerHTML = companiesHTML;
              */
            }
          }
          
          // ã‚¿ãƒ–ã®å†…å®¹åˆ‡ã‚Šæ›¿ãˆå‡¦ç†ã¯çœç•¥ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
        });
      });
      
      // ã‚¹ãƒ­ãƒƒãƒˆãƒã‚·ãƒ³é¢¨ã®ä¾¡æ ¼è¡¨ç¤ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°
      function animatePriceDisplay(element, finalPrice, duration = 1500, steps = 30) {
        const priceText = element.textContent;
        const originalText = element.innerHTML;
        const finalText = finalPrice + 'ã€œ';
        const numbers = [];
        
        // æ•°å­—ã®ã¿ã‚’æŠ½å‡º
        const matches = priceText.match(/\d+/);
        if (!matches) return;
        
        const originalPrice = parseInt(matches[0]);
        const finalPriceNum = parseInt(finalPrice);
        
        // ã‚¹ãƒ­ãƒƒãƒˆãƒã‚·ãƒ³ã®ã‚ˆã†ã«å®Œå…¨ã«ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã‚’æœ€åˆã«è¡¨ç¤º
        for (let i = 0; i < Math.floor(steps * 0.7); i++) {
          // æœ€åˆã¯ã¾ã£ãŸãã®ãƒ©ãƒ³ãƒ€ãƒ å€¤
          const randomValue = Math.floor(Math.random() * 150) + 50; // 50ã€œ200ã®ç¯„å›²ã§ãƒ©ãƒ³ãƒ€ãƒ 
          numbers.push(randomValue);
        }
        
        // å¾ŒåŠã¯å¾ã€…ã«æœ€çµ‚å€¤ã«è¿‘ã¥ã
        for (let i = 0; i < Math.floor(steps * 0.3); i++) {
          const progress = i / (steps * 0.3);
          const randomOffset = Math.random() * (1 - progress) * 15;
          const stepValue = Math.round(numbers[numbers.length - 1] + (finalPriceNum - numbers[numbers.length - 1]) * progress + randomOffset);
          numbers.push(stepValue);
        }
        
        // æœ€å¾Œã®å€¤ã¯å¿…ãšæœ€çµ‚ä¾¡æ ¼
        numbers.push(finalPriceNum);
        
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
        let step = 0;
        const interval = duration / numbers.length;
        
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹å‰ã®å‡¦ç†
        element.style.transition = 'all 0.2s';
        element.style.fontWeight = 'bold';
        element.style.color = '#1A56DB'; // é’è‰²ã‚’å°‘ã—å¼·èª¿
        
        // æ•°å­—ã®å‘¨ã‚Šã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
        const highlight = document.createElement('span');
        highlight.className = 'absolute inset-0 bg-yellow-100 rounded-full animate-pulse';
        highlight.style.opacity = '0';
        highlight.style.zIndex = '-1';
        
        // è¦ªè¦ç´ ã‚’relativeã«
        const parent = element.parentElement;
        if (parent) {
          parent.style.position = 'relative';
          parent.insertBefore(highlight, element);
        }
        
        // ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’è¡¨ç¤º
        setTimeout(() => {
          highlight.style.opacity = '0.5';
          
          const timer = setInterval(() => {
            if (step >= numbers.length) {
              clearInterval(timer);
              element.innerHTML = originalText.replace(/\d+/, finalPrice);
              
              // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†æ™‚ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
              element.style.fontSize = '110%';
              setTimeout(() => {
                element.style.fontSize = '100%';
                
                // ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
                highlight.style.transition = 'opacity 0.5s';
                highlight.style.opacity = '0';
                setTimeout(() => {
                  if (parent && highlight.parentNode === parent) {
                    parent.removeChild(highlight);
                  }
                }, 500);
              }, 200);
              
              return;
            }
            
            element.textContent = numbers[step] + 'ä¸‡å††ã€œ';
            
            // ã‚¹ãƒ­ãƒƒãƒˆãƒã‚·ãƒ³ã£ã½ãæ•°å­—ã‚’ä¸Šä¸‹ã«æºã‚‰ã™
            if (step % 2 === 0) {
              element.style.transform = 'translateY(-1px)';
            } else {
              element.style.transform = 'translateY(1px)';
            }
            
            step++;
          }, interval);
        }, 100);
      }
      
      // ã€Œã‚ˆã‚Šæ­£ç¢ºãªç›¸å ´ã‚’è¦‹ã‚‹ã€ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’æ›´æ–°
      const revealCompaniesBtn = document.getElementById('revealCompaniesBtn');
      if (revealCompaniesBtn) {
        revealCompaniesBtn.addEventListener('click', function() {
          // ãƒ¢ã‚¶ã‚¤ã‚¯è§£é™¤
          document.getElementById('mosaicOverlay').classList.add('hidden');
          
          // ã‚½ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
          const sortButtons = document.getElementById('sortButtons');
          if (sortButtons) {
            sortButtons.classList.remove('hidden');
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€ŒãŠã™ã™ã‚é †ã€ã‚’é¸æŠçŠ¶æ…‹ã«ã™ã‚‹ï¼ˆãƒ¢ã‚¶ã‚¤ã‚¯è§£é™¤æ™‚ï¼‰
            const tabRecommend = document.getElementById('tabRecommend');
            if (tabRecommend) {
              // ä»–ã®ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçŠ¶æ…‹ã«
              document.querySelectorAll('#tabCheap, #tabReview, #tabQuality').forEach(btn => {
                if (btn.id === 'tabCheap') {
                  btn.querySelector('div').className = 'absolute inset-0 bg-gradient-to-b from-red-300 to-red-400 z-0';
                  btn.classList.remove('bg-red-600', 'hover:bg-red-700', 'border-red-700');
                  btn.classList.add('bg-red-300', 'hover:bg-red-400', 'border-red-400');
                } else if (btn.id === 'tabReview') {
                  btn.querySelector('div').className = 'absolute inset-0 bg-gradient-to-b from-lime-300 to-lime-400 z-0';
                  btn.classList.remove('bg-green-600', 'hover:bg-green-700', 'border-green-700');
                  btn.classList.add('bg-lime-300', 'hover:bg-lime-400', 'border-lime-400');
                } else if (btn.id === 'tabQuality') {
                  btn.querySelector('div').className = 'absolute inset-0 bg-gradient-to-b from-purple-300 to-purple-400 z-0';
                  btn.classList.remove('bg-purple-600', 'hover:bg-purple-700', 'border-purple-700');
                  btn.classList.add('bg-purple-300', 'hover:bg-purple-400', 'border-purple-400');
                }
              });
              
              // ãŠã™ã™ã‚é †ãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
              tabRecommend.classList.remove('bg-white', 'border-gray-200');
              tabRecommend.classList.add('bg-blue-100', 'border-blue-300');
              
              // èƒŒæ™¯è‰²ã‚’è¨­å®š
              const allCompanies = document.getElementById('allCompanies');
              if (allCompanies) {
                allCompanies.style.backgroundColor = 'rgba(239, 246, 255, 0.5)'; // è–„ã„é’è‰²
              }
            }
          }
          
          // ä¾¡æ ¼è¡¨ç¤ºã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
          setTimeout(() => {
            // ã™ã¹ã¦ã®ä¾¡æ ¼è¦ç´ ã«å¯¾ã—ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
            const priceElements = document.querySelectorAll('.text-kuraberu-blue.font-bold');
            
            // ãƒ‰ãƒ©ãƒ ãƒ­ãƒ¼ãƒ«åŠ¹æœéŸ³ï¼ˆå®Ÿéš›ã®ã‚µã‚¦ãƒ³ãƒ‰ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ©ã‚¦ã‚¶è¨­å®šã«ã‚ˆã‚Šå†ç”Ÿå¯èƒ½ãªå ´åˆã®ã¿ï¼‰
            try {
              const audio = new Audio();
              audio.volume = 0.3; // éŸ³é‡æ§ãˆã‚
              audio.play().catch(e => console.log('Audio autoplay prevented by browser'));
            } catch (e) {
              console.log('Audio not supported');
            }
            
            priceElements.forEach((element, index) => {
              // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«åŸºã¥ã„ã¦é–‹å§‹ã‚’é…å»¶ã•ã›ã‚‹ï¼ˆé †ç•ªã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã‚ˆã†ã«ï¼‰
              setTimeout(() => {
                // ç¾åœ¨ã®æ•°å€¤ã‚’å–å¾—
                const currentPrice = parseInt(element.textContent.match(/\d+/)[0]);
                // ç¾åœ¨ã®ä¾¡æ ¼ã‚’ç¶­æŒã—ãªãŒã‚‰ã‚¹ãƒ­ãƒƒãƒˆãƒã‚·ãƒ³æ¼”å‡º
                animatePriceDisplay(element, currentPrice, 1500 + index * 100, 30);
              }, index * 300); // ã‚ˆã‚Šé•·ã‚ã®é–“éš”ã§æ¬¡ã€…ã¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            });
          }, 500);
          
          // ãƒ’ã‚¢ãƒªãƒ³ã‚°ãƒœãƒƒãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
          document.getElementById('hearingBotSection').classList.remove('hidden');
          
          // ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚’åˆæœŸåŒ–ã—ã¦æœ€åˆã®è³ªå•ã‚’è¡¨ç¤º
          initChatBot();
        });
      }
    });
    
    // ã‚‚ã£ã¨è¦‹ã‚‹ãƒœã‚¿ãƒ³ã®æ©Ÿèƒ½
    document.addEventListener('DOMContentLoaded', function() {
      const showMoreBtn = document.getElementById('showMoreCompanies');
      const moreCompanies = document.getElementById('moreCompanies');
      
      if (showMoreBtn && moreCompanies) {
        showMoreBtn.addEventListener('click', function() {
          // 5-8ä½ã‚’è¡¨ç¤ºï¼ˆä¸€åº¦è¡¨ç¤ºã—ãŸã‚‰æˆ»ã•ãªã„ï¼‰
          moreCompanies.classList.remove('hidden');
          showMoreBtn.style.display = 'none';
        });
      }
    });
    
    // ã‚­ãƒ¼ãƒ—ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ©Ÿèƒ½ã¨ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã®è¨­å®š
    document.addEventListener('DOMContentLoaded', function() {
      let keepCount = 0;
      const keepBox = document.getElementById('keepFloatingBox');
      const keepCountBadge = document.getElementById('keepCountBadge');
      const keepCountBadge2 = document.getElementById('keepCountBadge2');
      const viewKeptCompaniesBtn = document.getElementById('viewKeptCompanies');
      
      // ã‚­ãƒ¼ãƒ—ãƒœã‚¿ãƒ³ã¨è©³ç´°ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
      const keepButtons = document.querySelectorAll('.keepButton');
      const detailButtons = document.querySelectorAll('.detailButton');
      
      // ã‚­ãƒ¼ãƒ—ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
      keepButtons.forEach(button => {
        button.addEventListener('click', function() {
          // ã‚­ãƒ¼ãƒ—çŠ¶æ…‹ã‚’ãƒˆã‚°ãƒ«
          if (this.classList.contains('bg-kuraberu-yellow')) {
            // ã‚­ãƒ¼ãƒ—è§£é™¤
            this.classList.remove('bg-kuraberu-yellow');
            this.classList.add('bg-gray-200');
            this.textContent = 'ã‚­ãƒ¼ãƒ—ã™ã‚‹';
            keepCount = Math.max(0, keepCount - 1);
          } else {
            // ã‚­ãƒ¼ãƒ—ã™ã‚‹
            this.classList.remove('bg-gray-200');
            this.classList.add('bg-kuraberu-yellow');
            this.textContent = 'ã‚­ãƒ¼ãƒ—ä¸­ï¼';
            keepCount++;
          }
          
          // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’æ›´æ–°
          updateKeepCounter();
        });
      });
      
      // è©³ç´°ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤ºï¼‰
      detailButtons.forEach(button => {
        button.addEventListener('click', function() {
          // è©³ç´°ãƒšãƒ¼ã‚¸ã‚’iframeã§è¡¨ç¤º
          const overlay = document.createElement('div');
          overlay.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
          overlay.style.backdropFilter = 'blur(2px)';
          overlay.id = 'detailOverlay';
          
          const frame = document.createElement('iframe');
          
          // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
          window.closeDetailOverlay = function() {
            const overlay = document.getElementById('detailOverlay');
            if (overlay) {
              // å®Œå…¨ã«å‰Šé™¤
              overlay.remove();
              // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¦æ­¢ã‚’è§£é™¤
              document.body.style.overflow = '';
              // ã‚‚ã—ä»–ã«ã‚‚ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ã¦ã„ãŸå ´åˆã¯ãƒªã‚»ãƒƒãƒˆ
              document.body.style.position = '';
              document.body.style.width = '';
              document.body.style.height = '';
              // ä»–ã®é–¢é€£è¦ç´ ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
              document.querySelectorAll('.modal-backdrop').forEach(el => el.remove());
            }
          };
          
          // iframeç”¨ã«windowã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«é–¢æ•°ã‚’è¿½åŠ ï¼ˆã‚¢ã‚¯ã‚»ã‚¹ã—ã‚„ã™ã„ã‚ˆã†ã«ï¼‰
          window.closeCompanyDetailIframe = function() {
            const overlay = document.getElementById('detailOverlay');
            if (overlay) {
              // å®Œå…¨ã«å‰Šé™¤
              overlay.remove();
              // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¦æ­¢ã‚’è§£é™¤
              document.body.style.overflow = '';
              // ã‚‚ã—ä»–ã«ã‚‚ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ã¦ã„ãŸå ´åˆã¯ãƒªã‚»ãƒƒãƒˆ
              document.body.style.position = '';
              document.body.style.width = '';
              document.body.style.height = '';
              // ä»–ã®é–¢é€£è¦ç´ ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
              document.querySelectorAll('.modal-backdrop').forEach(el => el.remove());
              // å±¥æ­´æ“ä½œ
              if (window.history && window.history.replaceState) {
                try {
                  window.history.replaceState(null, '', 'kuraberu-optimized-final-dynamic-new.html');
                } catch(e) {
                  console.error('å±¥æ­´æ“ä½œã‚¨ãƒ©ãƒ¼:', e);
                }
              }
            }
          };
          
          // iframe ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
          window.addEventListener('message', function(event) {
            if (event.data === 'closeDetailOverlay') {
              console.log('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡: closeDetailOverlay');
              window.closeCompanyDetailIframe();
            }
          }, false);
          
          // å…±é€šã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã¨ã—ã¦è¿½åŠ ï¼ˆãƒšãƒ¼ã‚¸å…¨ä½“ã§åˆ©ç”¨å¯èƒ½ã«ï¼‰
          if (!window._hasAddedMessageListener) {
            window._hasAddedMessageListener = true;
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒŠãƒ¼
            window.addEventListener('message', function(event) {
              if (event.data === 'closeDetailOverlay') {
                console.log('ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡: closeDetailOverlay');
                const overlay = document.getElementById('detailOverlay');
                if (overlay) {
                  overlay.remove();
                  document.body.style.overflow = '';
                }
              }
            }, false);
          }
          
          // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã«ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
          window.addEventListener('beforeunload', function() {
            const overlay = document.getElementById('detailOverlay');
            if (overlay) {
              overlay.remove();
            }
          });
          
          // iframeã®onloadã‚¤ãƒ™ãƒ³ãƒˆã§é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®å‡¦ç†ã‚’è¨­å®š
          frame.onload = function() {
            try {
              // iframeã®ä¸­ã®ã‚¯ãƒ­ãƒ¼ã‚ºãƒœã‚¿ãƒ³ã‚’æ¢ã—ã¦ã€ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
              const iframeDoc = frame.contentDocument || frame.contentWindow.document;
              if (iframeDoc) {
                const closeBtn = iframeDoc.getElementById('closeDetailBtn');
                if (closeBtn) {
                  closeBtn.onclick = function() {
                    // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’å®Œå…¨ã«å‰Šé™¤
                    const overlay = document.getElementById('detailOverlay');
                    if (overlay) {
                      // DOMã‹ã‚‰è¦ç´ ã‚’å®Œå…¨ã«å‰Šé™¤
                      overlay.remove();
                      // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¦æ­¢ã‚’è§£é™¤
                      document.body.style.overflow = '';
                      // ã‚‚ã—ä»–ã«ã‚‚ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ã¦ã„ãŸå ´åˆã¯ãƒªã‚»ãƒƒãƒˆ
                      document.body.style.position = '';
                      document.body.style.width = '';
                      document.body.style.height = '';
                    }
                    return false;
                  };
                }
              }
            } catch (e) {
              console.error('iframeã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼:', e);
            }
          };
          
          // iframeã«å®‰å…¨ãªãƒ•ãƒ¬ãƒ¼ãƒ è¨­å®šã‚’è¿½åŠ 
          frame.src = 'company-detail.html';
          frame.className = 'w-full h-full md:w-11/12 md:h-5/6 rounded-lg shadow-2xl';
          frame.style.border = 'none';
          frame.id = 'detailFrame';
          frame.name = 'detailFrame'; // åå‰ã‚’è¨­å®šã—ã¦å‚ç…§ã—ã‚„ã™ãã™ã‚‹
          frame.setAttribute('allowtransparency', 'true'); // é€éã‚’è¨±å¯
          frame.setAttribute('allowfullscreen', 'true'); // ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è¨±å¯ï¼ˆã‚ˆã‚Šå¤šãã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’ä»˜ä¸ï¼‰
          frame.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture'); // æ§˜ã€…ãªæ©Ÿèƒ½ã®ä½¿ç”¨ã‚’è¨±å¯
          
          overlay.appendChild(frame);
          document.body.appendChild(overlay);
          
          // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¦æ­¢
          document.body.style.overflow = 'hidden';
          
          // ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
          overlay.addEventListener('click', function(e) {
            if (e.target === overlay) {
              window.closeCompanyDetailIframe();
            }
          });
          
          // Reload the page if the iframe isn't loading properly
          frame.onerror = function() {
            console.error('iframeã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼');
            window.location.reload();
          };
          
          // ESCã‚­ãƒ¼ã§ã‚‚é–‰ã˜ã‚‰ã‚Œã‚‹ã‚ˆã†ã«
          const escKeyHandler = function(e) {
            if (e.key === 'Escape') {
              window.closeCompanyDetailIframe();
              // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’å‰Šé™¤
              document.removeEventListener('keydown', escKeyHandler);
            }
          };
          
          document.addEventListener('keydown', escKeyHandler);
        });
      });
      
      // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚’è¡¨ç¤º
      function showKeepFloatingBox() {
        keepBox.classList.remove('translate-y-full');
        keepBox.classList.add('translate-y-0');
      }
      
      // ã‚­ãƒ¼ãƒ—ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’æ›´æ–°
      function updateKeepCounter() {
        if (keepCount > 0) {
          // ä¸¡æ–¹ã®ãƒãƒƒã‚¸ã‚’æ›´æ–°
          keepCountBadge.textContent = keepCount;
          keepCountBadge2.textContent = keepCount;
          
          // ãƒãƒƒã‚¸ã‚’è¡¨ç¤º
          keepCountBadge.classList.remove('hidden');
          keepCountBadge2.classList.remove('hidden');
          
          // ã‚­ãƒ¼ãƒ—è©³ç´°ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
          viewKeptCompaniesBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          viewKeptCompaniesBtn.disabled = false;
          
          // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚’è¡¨ç¤º
          showKeepFloatingBox();
        } else {
          // ã‚­ãƒ¼ãƒ—ãŒãªã„å ´åˆ
          keepCountBadge.classList.add('hidden');
          keepCountBadge2.classList.add('hidden');
          
          // ã‚­ãƒ¼ãƒ—è©³ç´°ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
          viewKeptCompaniesBtn.classList.add('opacity-50', 'cursor-not-allowed');
          viewKeptCompaniesBtn.disabled = true;
        }
      }
      
      // ã‚­ãƒ¼ãƒ—è©³ç´°ãƒœã‚¿ãƒ³ã®åˆæœŸçŠ¶æ…‹ï¼ˆç„¡åŠ¹ï¼‰
      if (viewKeptCompaniesBtn) {
        viewKeptCompaniesBtn.classList.add('opacity-50', 'cursor-not-allowed');
        viewKeptCompaniesBtn.disabled = true;
        
        // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
        viewKeptCompaniesBtn.addEventListener('click', function() {
          if (keepCount > 0) {
            // ã‚­ãƒ¼ãƒ—ä¸­ã®æ¥­è€…ã‚’è¡¨ç¤ºã™ã‚‹ãƒ¢ãƒ¼ãƒ€ãƒ«
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            modal.innerHTML = `
              <div class="bg-white rounded-lg overflow-hidden shadow-xl max-w-2xl w-full mx-4">
                <div class="p-4 bg-gray-100 flex justify-between items-center">
                  <h3 class="font-bold text-lg">ã‚­ãƒ¼ãƒ—ä¸­ã®æ¥­è€…ï¼ˆ${keepCount}ç¤¾ï¼‰</h3>
                  <button id="closeKeptModal" class="text-gray-500 hover:text-gray-800">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
                <div class="p-4">
                  <div class="overflow-y-auto max-h-96">
                    <div id="keptCompaniesList" class="space-y-3">
                      <!-- ã‚­ãƒ¼ãƒ—ãƒªã‚¹ãƒˆ -->
                    </div>
                  </div>
                  <div class="mt-4 flex justify-end">
                    <button class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-md font-medium transition-colors shadow-sm">
                      ä¸€æ‹¬è¦‹ç©ã‚‚ã‚Šã‚’ä¾é ¼ã™ã‚‹
                    </button>
                  </div>
                </div>
              </div>
            `;
            
            // ã‚­ãƒ¼ãƒ—ä¸­ã®æ¥­è€…ãƒªã‚¹ãƒˆã‚’ä½œæˆ
            document.body.appendChild(modal);
            const keptCompaniesList = modal.querySelector('#keptCompaniesList');
            
            // ã‚­ãƒ¼ãƒ—ãƒœã‚¿ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            document.querySelectorAll('.keepButton.bg-kuraberu-yellow').forEach((btn, index) => {
              const companyId = btn.getAttribute('data-company');
              const companyCard = btn.closest('.company-card');
              if (companyCard) {
                // ä¼šç¤¾åã¨ãã®ä»–ã®æƒ…å ±ã‚’å–å¾—
                const companyName = companyCard.querySelector('.font-bold').textContent;
                const rating = companyCard.querySelector('.text-yellow-500').textContent;
                const price = companyCard.querySelector('.text-kuraberu-blue.font-bold').textContent;
                
                // ãƒªã‚¹ãƒˆã«è¿½åŠ 
                const listItem = document.createElement('div');
                listItem.className = 'p-3 border rounded bg-gray-50';
                listItem.innerHTML = `
                  <div class="flex justify-between">
                    <div>
                      <div class="font-medium">${companyName}</div>
                      <div class="text-sm">${rating}</div>
                      <div class="text-sm">è¦‹ç©ä¾¡æ ¼: ${price}</div>
                    </div>
                    <button class="text-red-500 hover:text-red-700" data-remove-keep="${companyId}">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                      </svg>
                    </button>
                  </div>
                `;
                keptCompaniesList.appendChild(listItem);
              }
            });
            
            // ã‚­ãƒ¼ãƒ—è§£é™¤ãƒœã‚¿ãƒ³ã®å‡¦ç†
            modal.querySelectorAll('[data-remove-keep]').forEach(btn => {
              btn.addEventListener('click', function() {
                const companyIdToRemove = this.getAttribute('data-remove-keep');
                // å¯¾å¿œã™ã‚‹ã‚­ãƒ¼ãƒ—ãƒœã‚¿ãƒ³ã‚’æ¢ã™
                const keepButtonToUpdate = document.querySelector(`.keepButton[data-company="${companyIdToRemove}"]`);
                if (keepButtonToUpdate) {
                  // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼
                  keepButtonToUpdate.click();
                }
                
                // ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤
                this.closest('.p-3').remove();
                
                // ã‚­ãƒ¼ãƒ—æ•°ãŒã‚¼ãƒ­ã«ãªã£ãŸã‚‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
                if (keepCount === 0) {
                  document.body.removeChild(modal);
                } else {
                  // ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
                  modal.querySelector('h3').textContent = `ã‚­ãƒ¼ãƒ—ä¸­ã®æ¥­è€…ï¼ˆ${keepCount}ç¤¾ï¼‰`;
                }
              });
            });
            
            // é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
            const closeButton = modal.querySelector('#closeKeptModal');
            closeButton.addEventListener('click', function() {
              document.body.removeChild(modal);
            });
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«è‡ªä½“ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚é–‰ã˜ã‚‹
            modal.addEventListener('click', function(e) {
              if (e.target === modal) {
                document.body.removeChild(modal);
              }
            });
          }
        });
      }
      
      // å‹•ç”»ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
      const videoButton = document.getElementById('videoButton');
      if (videoButton) {
        videoButton.addEventListener('click', function() {
          // å‹•ç”»ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹
          const modal = document.createElement('div');
          modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
          modal.innerHTML = `
            <div class="bg-white rounded-lg overflow-hidden shadow-xl max-w-4xl w-full mx-4">
              <div class="p-4 bg-gray-100 flex justify-between items-center">
                <h3 class="font-bold text-lg">å¤–å£å¡—è£…ã®è¦‹ç©ã‚‚ã‚Šã®æµã‚Œ</h3>
                <button id="closeVideoModal" class="text-gray-500 hover:text-gray-800">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>
              <div class="p-4">
                <div class="aspect-w-16 aspect-h-9 bg-gray-100 flex items-center justify-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <p class="mt-4 text-gray-600">å‹•ç”»ã¯ãƒ‡ãƒ¢ç”¨ã§ã™</p>
                </div>
                <div class="mt-4">
                  <p class="text-sm text-gray-600">1. ç„¡æ–™ã§ç›¸è¦‹ç©ã‚‚ã‚Šã‚’ä¾é ¼</p>
                  <p class="text-sm text-gray-600">2. æ¥­è€…ã‹ã‚‰ã®è¦‹ç©æ›¸ã‚’æ¯”è¼ƒæ¤œè¨</p>
                  <p class="text-sm text-gray-600">3. æœ€é©ãªæ¥­è€…ã‚’é¸ã‚“ã§å¥‘ç´„</p>
                  <p class="text-sm text-gray-600">4. é«˜å“è³ªãªæ–½å·¥ã¨é•·æœŸä¿è¨¼</p>
                </div>
              </div>
            </div>
          `;
          
          document.body.appendChild(modal);
          
          // é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
          const closeButton = modal.querySelector('#closeVideoModal');
          closeButton.addEventListener('click', function() {
            document.body.removeChild(modal);
          });
          
          // ãƒ¢ãƒ¼ãƒ€ãƒ«è‡ªä½“ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚é–‰ã˜ã‚‹
          modal.addEventListener('click', function(e) {
            if (e.target === modal) {
              document.body.removeChild(modal);
            }
          });
        });
      }
    });
    
    // BOTã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
    class ChatbotStateManager {
      constructor() {
        this.currentStage = 1;
        this.currentQuestionIndex = 0;
        this.answers = {};
        this.questionHistory = [];
        this.matchAccuracy = 0;
        this.basePrice = 800000;
        this.priceAdjustment = 1.0;
        
        // ãƒ€ãƒŸãƒ¼è³ªå•ãƒ‡ãƒ¼ã‚¿ï¼ˆæœ¬ç•ªã¯ã‚¹ãƒ—ã‚·ã‹ã‚‰å–å¾—ï¼‰
        this.questions = {
          1: [ // ç¬¬1æ®µéšï¼šåˆæœŸãƒ’ã‚¢ãƒªãƒ³ã‚°
            {id: 'Q001', text: 'å»ºç‰©ã¯ä½•éšå»ºã¦ã§ã™ã‹ï¼Ÿ', choices: ['1éšå»ºã¦', '2éšå»ºã¦', '3éšå»ºã¦'], tip: 'å¤–å£å¡—è£…ã¯éšæ•°ã«ã‚ˆã£ã¦ä¾¡æ ¼ãŒå¤§ããå¤‰ã‚ã‚Šã¾ã™ã€‚'},
            {id: 'Q002', text: 'ç¯‰å¹´æ•°ã¯ã©ã®ãã‚‰ã„ã§ã™ã‹ï¼Ÿ', choices: ['10å¹´æœªæº€', '10-20å¹´', '20-30å¹´', '30å¹´ä»¥ä¸Š'], tip: 'ç¯‰å¹´æ•°ãŒå¤ã„ã»ã©ä¸‹åœ°å‡¦ç†ãŒé‡è¦ã«ãªã‚Šã¾ã™ã€‚'},
            {id: 'Q003', text: 'å»ºç‰©ã®åªæ•°ã¯ã©ã®ãã‚‰ã„ã§ã™ã‹ï¼Ÿ', choices: ['20åªæœªæº€', '20-30åª', '30-40åª', '40åªä»¥ä¸Š'], tip: 'åªæ•°ã§å¿…è¦ãªå¡—æ–™é‡ã¨å·¥æœŸãŒæ±ºã¾ã‚Šã¾ã™ã€‚'},
            {id: 'Q004', text: 'ç¾åœ¨ã®å¤–å£æè³ªã¯ä½•ã§ã™ã‹ï¼Ÿ', choices: ['ã‚µã‚¤ãƒ‡ã‚£ãƒ³ã‚°', 'ãƒ¢ãƒ«ã‚¿ãƒ«', 'ã‚¿ã‚¤ãƒ«', 'ãã®ä»–'], tip: 'æè³ªã«ã‚ˆã£ã¦é©åˆ‡ãªå¡—æ–™ã¨å·¥æ³•ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚'},
            {id: 'Q005', text: 'å·¥äº‹ã®ç·Šæ€¥åº¦ã¯ã„ã‹ãŒã§ã™ã‹ï¼Ÿ', choices: ['ã™ãã«ã§ã‚‚', '3ãƒ¶æœˆä»¥å†…', 'åŠå¹´ä»¥å†…', '1å¹´ä»¥å†…'], tip: 'ç·Šæ€¥åº¦ã«ã‚ˆã£ã¦æ¥­è€…ã®å¯¾å¿œã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’é‡è¦–ã—ã¾ã™ã€‚'}
          ],
          2: [ // ç¬¬2æ®µéšï¼šãŠå®¢æ§˜è¨ºæ–­
            {id: 'Q201', text: 'äºˆç®—ã®ç›®å®‰ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', choices: ['50ä¸‡å††ä»¥ä¸‹', '50-100ä¸‡å††', '100-150ä¸‡å††', '150ä¸‡å††ä»¥ä¸Š'], tip: 'äºˆç®—ã«å¿œã˜ã¦æœ€é©ãªãƒ—ãƒ©ãƒ³ã‚’ã”ææ¡ˆã—ã¾ã™ã€‚'},
            {id: 'Q202', text: 'é‡è¦–ã™ã‚‹ç‚¹ã¯ä½•ã§ã™ã‹ï¼Ÿ', choices: ['ä¾¡æ ¼ã®å®‰ã•', 'å“è³ªã®é«˜ã•', 'å·¥æœŸã®çŸ­ã•', 'ã‚¢ãƒ•ã‚¿ãƒ¼ä¿è¨¼'], tip: 'ã‚ãªãŸã®å„ªå…ˆé †ä½ã§æ¥­è€…ã‚’ãƒãƒƒãƒãƒ³ã‚°ã—ã¾ã™ã€‚'},
            {id: 'Q203', text: 'å¤–å£ã®åŠ£åŒ–çŠ¶æ³ã¯ï¼Ÿ', choices: ['ã²ã³å‰²ã‚Œæœ‰', 'è‰²ã‚ã›ã®ã¿', 'ãƒãƒ§ãƒ¼ã‚­ãƒ³ã‚°æœ‰', 'å‰¥ãŒã‚Œæœ‰'], tip: 'åŠ£åŒ–çŠ¶æ³ã§å¿…è¦ãªå·¥ç¨‹ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚'}
          ],
          3: [ // ç¬¬3æ®µéšï¼šè©³ç´°ãƒãƒƒãƒãƒ³ã‚°
            {id: 'Q301', text: 'å·¥äº‹é–‹å§‹ã®å¸Œæœ›æ™‚æœŸã¯ï¼Ÿ', choices: ['1ãƒ¶æœˆä»¥å†…', '2-3ãƒ¶æœˆä»¥å†…', 'åŠå¹´ä»¥å†…', 'æ™‚æœŸã¯å•ã‚ãªã„'], tip: 'æ™‚æœŸã«ã‚ˆã£ã¦æ¥­è€…ã®ç©ºãçŠ¶æ³ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚'},
            {id: 'Q302', text: 'è¿‘éš£ã¸ã®é…æ…®ã§é‡è¦–ã™ã‚‹ã“ã¨ã¯ï¼Ÿ', choices: ['é¨’éŸ³å¯¾ç­–', 'é§è»Šå ´ç¢ºä¿', 'æŒ¨æ‹¶å›ã‚Š', 'å·¥äº‹æ™‚é–“èª¿æ•´'], tip: 'è¿‘éš£ãƒˆãƒ©ãƒ–ãƒ«ã‚’é¿ã‘ã‚‹ãŸã‚ã®é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚'},
            {id: 'Q303', text: 'è¿½åŠ å·¥äº‹ã®å¯èƒ½æ€§ã«ã¤ã„ã¦', choices: ['äºˆç®—å†…ã§æœ€å°é™', 'å¿…è¦ãªã‚‰è¿½åŠ OK', 'ææ¡ˆã‚’èã„ã¦ã‹ã‚‰', 'çµ¶å¯¾ã«è¿½åŠ ãªã—'], tip: 'å·¥äº‹ä¸­ã«ç™ºè¦‹ã•ã‚Œã‚‹å•é¡Œã¸ã®å¯¾å¿œæ–¹é‡ã§ã™ã€‚'}
          ]
        };
        
        this.stageInfo = {
          1: {title: 'ç‰©ä»¶è¨ºæ–­ä¸­...', total: 5},
          2: {title: 'ãŠå®¢æ§˜è¨ºæ–­ä¸­...', total: 3},
          3: {title: 'è©³ç´°ãƒãƒƒãƒãƒ³ã‚°ä¸­...', total: 3},
          4: {title: 'ç”³ã—è¾¼ã¿æ‰‹ç¶šã', total: 1}
        };
      }
      
      init() {
        this.bindEvents();
      }
      
      bindEvents() {
        // ã‚ˆã‚Šæ­£ç¢ºãªç›¸å ´ãƒœã‚¿ãƒ³
        const moreDetailBtn = document.getElementById('showAccuratePrice');
        if (moreDetailBtn) {
          moreDetailBtn.addEventListener('click', () => {
            this.startBotMode();
          });
        }
        
        // å›ç­”ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
        document.addEventListener('click', (e) => {
          if (e.target.classList.contains('answer-btn')) {
            this.handleAnswer(e.target.dataset.value);
          }
        });
        
        // ç¶šè¡Œãƒœã‚¿ãƒ³
        document.getElementById('continueBtn')?.addEventListener('click', () => {
          this.nextStage();
        });
        
        // æˆ»ã‚‹ãƒœã‚¿ãƒ³
        document.getElementById('botBackBtn')?.addEventListener('click', () => {
          this.goBack();
        });
      }
      
      startBotMode() {
        // æ¥­è€…ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
        document.getElementById('companyRankingSection').classList.remove('hidden');
        
        // BOTä¸‹éƒ¨å›ºå®šè¡¨ç¤º
        document.getElementById('fixedBotSection').classList.remove('hidden');
        
        // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ä¸‹ãƒãƒ¼ã‚¸ãƒ³è¿½åŠ 
        document.body.style.paddingBottom = '250px';
        
        // ç¬¬1æ®µéšé–‹å§‹
        this.showQuestion();
      }
      
      showQuestion() {
        const questions = this.questions[this.currentStage];
        if (!questions || this.currentQuestionIndex >= questions.length) {
          this.completeStage();
          return;
        }
        
        const question = questions[this.currentQuestionIndex];
        
        // è±†çŸ¥è­˜è¡¨ç¤º
        if (question.tip) {
          this.showKnowledgeTip('è±†çŸ¥è­˜', question.tip);
        }
        
        // è³ªå•è¡¨ç¤º
        document.getElementById('currentQuestion').textContent = question.text;
        
        // é¸æŠè‚¢è¡¨ç¤º
        const choicesContainer = document.getElementById('answerChoices');
        choicesContainer.innerHTML = '';
        
        question.choices.forEach(choice => {
          const button = document.createElement('button');
          button.className = 'answer-btn bg-white border-2 border-gray-300 hover:border-kuraberu-blue hover:bg-blue-50 p-3 rounded-lg text-sm font-medium transition-all';
          button.dataset.value = choice;
          button.textContent = choice;
          choicesContainer.appendChild(button);
        });
        
        // é€²æ—æ›´æ–°
        this.updateProgress();
        
        // æˆ»ã‚‹ãƒœã‚¿ãƒ³è¡¨ç¤ºåˆ¶å¾¡
        document.getElementById('botBackBtn').classList.toggle('hidden', this.questionHistory.length === 0);
      }
      
      handleAnswer(answer) {
        const questions = this.questions[this.currentStage];
        const question = questions[this.currentQuestionIndex];
        
        // å›ç­”ã‚’ä¿å­˜
        this.answers[question.id] = answer;
        this.questionHistory.push({
          stage: this.currentStage,
          questionIndex: this.currentQuestionIndex,
          questionId: question.id,
          answer: answer
        });
        
        // è¦–è¦šåŠ¹æœï¼ˆãƒœã‚¿ãƒ³ã‚’é¸æŠçŠ¶æ…‹ã«ï¼‰
        document.querySelectorAll('.answer-btn').forEach(btn => {
          btn.classList.remove('border-kuraberu-blue', 'bg-blue-50');
          if (btn.dataset.value === answer) {
            btn.classList.add('border-kuraberu-blue', 'bg-blue-50');
          }
        });
        
        // å‡¦ç†åŠ¹æœã‚’æ¼”å‡º
        setTimeout(() => {
          // é€²æ—ãƒãƒ¼ã‚’æ›´æ–°ï¼ˆå›ç­”å¾Œï¼‰
          this.updateProgressAfterAnswer();
          
          // ç›¸å ´æ›´æ–°
          this.updatePrice(question.id, answer);
          
          // ç¬¬1æ®µéšå®Œäº†å¾Œï¼ˆ5å•ç›®å›ç­”æ™‚ï¼‰ã¯ãƒ¢ã‚¶ã‚¤ã‚¯è§£é™¤
          if (this.currentStage === 1 && this.currentQuestionIndex + 1 >= this.questions[1].length) {
            this.removeMosaic();
          }
          
          // ç¬¬2æ®µéšä»¥é™ã¯ãƒãƒƒãƒç²¾åº¦æ›´æ–°
          if (this.currentStage >= 2) {
            this.updateMatchAccuracy();
          }
          
          // æ¬¡ã®è³ªå•ã¸
          this.currentQuestionIndex++;
          this.showQuestion();
        }, 500);
      }
      
      updatePrice(questionId, answer) {
        // ä¾¡æ ¼èª¿æ•´ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆç°¡æ˜“ç‰ˆï¼‰
        const adjustments = {
          'Q001': {'1éšå»ºã¦': 0.8, '2éšå»ºã¦': 1.0, '3éšå»ºã¦': 1.3},
          'Q002': {'10å¹´æœªæº€': 1.0, '30å¹´ä»¥ä¸Š': 1.2},
          'Q003': {'20åªæœªæº€': 0.7, '40åªä»¥ä¸Š': 1.4}
        };
        
        if (adjustments[questionId] && adjustments[questionId][answer]) {
          this.priceAdjustment *= adjustments[questionId][answer];
        }
        
        // ç›¸å ´è¡¨ç¤ºæ›´æ–°
        const finalPrice = Math.round(this.basePrice * this.priceAdjustment);
        const lowPrice = Math.round(finalPrice * 0.8 / 10000);
        const highPrice = Math.round(finalPrice * 1.1 / 10000);
        
        const priceElement = document.getElementById('priceRange');
        if (priceElement) {
          priceElement.textContent = `${lowPrice}ä¸‡ã€œ${highPrice}ä¸‡å††`;
        }
        
        // å»ºç‰©è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆã‚‚æ›´æ–°
        this.updateBuildingDescription();
      }
      
      updateBuildingDescription() {
        const floor = this.answers['Q001'] || '2Få»ºã¦';
        const age = this.answers['Q002'] || 'ç¯‰25å¹´';
        const size = this.answers['Q003'] || '30åª';
        
        const description = `${floor}æˆ¸å»ºã¦${age}ã®å ´åˆï¼ˆ${size}ï¼‰`;
        // å¿…è¦ã«å¿œã˜ã¦è¡¨ç¤ºã‚’æ›´æ–°
      }
      
      updateRankingVisibility() {
        // ä½•ã‚‚ã—ãªã„ï¼ˆå…¨ä½“ãƒ¢ã‚¶ã‚¤ã‚¯ã‚’ä¿æŒï¼‰
      }
      
      removeMosaic() {
        // ç¬¬1æ®µéšå®Œäº†æ™‚ã«ãƒ¢ã‚¶ã‚¤ã‚¯è§£é™¤
        const rankingMosaicOverlay = document.getElementById('rankingMosaicOverlay');
        if (rankingMosaicOverlay) {
          rankingMosaicOverlay.style.opacity = '0';
          setTimeout(() => {
            rankingMosaicOverlay.style.display = 'none';
          }, 500);
        }
      }
      
      updateMatchAccuracy() {
        // ãƒãƒƒãƒç²¾åº¦ã‚’æ®µéšçš„ã«ä¸Šã’ã‚‹
        const totalQuestions = this.questions[2].length;
        const answeredQuestions = Object.keys(this.answers).filter(id => id.startsWith('Q2')).length;
        this.matchAccuracy = Math.min(100, Math.round((answeredQuestions / totalQuestions) * 100));
        
        // ç²¾åº¦è¡¨ç¤ºã‚’æ›´æ–°
        document.getElementById('matchAccuracy').classList.remove('hidden');
        document.getElementById('accuracyPercentage').textContent = `${this.matchAccuracy}%`;
        document.getElementById('accuracyBar').style.width = `${this.matchAccuracy}%`;
        
        // ç¬¬2æ®µéšå®Œäº†æ™‚ã«ã‚½ãƒ¼ãƒˆãƒœã‚¿ãƒ³è¡¨ç¤º
        if (this.currentStage === 2 && this.matchAccuracy >= 100) {
          this.showSortButtons();
        }
      }
      
      updateProgress() {
        const stageInfo = this.stageInfo[this.currentStage];
        // è³ªå•è¡¨ç¤ºæ™‚ã¯ç¾åœ¨ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ™ãƒ¼ã‚¹ï¼ˆç­”ãˆã‚‹å‰ï¼‰
        const progress = (this.currentQuestionIndex / stageInfo.total) * 100;
        
        document.getElementById('stageTitle').textContent = stageInfo.title;
        // å„æ®µéšã§0-100%ã«ãƒªã‚»ãƒƒãƒˆ
        document.getElementById('progressBarBot').style.width = `${progress}%`;
      }
      
      updateProgressAfterAnswer() {
        const stageInfo = this.stageInfo[this.currentStage];
        // å›ç­”å¾Œã¯+1ã—ã¦é€²æ—ã‚’é€²ã‚ã‚‹
        const progress = ((this.currentQuestionIndex + 1) / stageInfo.total) * 100;
        document.getElementById('progressBarBot').style.width = `${progress}%`;
      }
      
      showKnowledgeTip(title, content) {
        document.getElementById('tipTitle').textContent = title;
        document.getElementById('tipContent').textContent = content;
        document.getElementById('knowledgeTip').classList.remove('hidden');
        
        // å‡ºã—ã£ã±ãªã—ã«ã™ã‚‹ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãªã—ï¼‰
      }
      
      completeStage() {
        if (this.currentStage === 1) {
          // ç¬¬1æ®µéšå®Œäº†
          this.showStageTransition(
            'ç‰©ä»¶è¨ºæ–­å®Œäº†ï¼',
            'ç¶šã„ã¦ã€ã‚ãªãŸã®æ¡ä»¶ã‚’ãŠèã‹ã›ãã ã•ã„ã€‚'
          );
        } else if (this.currentStage === 2) {
          // ç¬¬2æ®µéšå®Œäº†
          this.showStageTransition(
            'ãŠå®¢æ§˜è¨ºæ–­å®Œäº†ï¼',
            'æœ€å¾Œã«è©³ç´°ãƒãƒƒãƒãƒ³ã‚°ã®ãŸã‚ã®è³ªå•ã§ã™ã€‚'
          );
        } else if (this.currentStage === 3) {
          // ç¬¬3æ®µéšå®Œäº†
          this.showStageTransition(
            'è©³ç´°ãƒãƒƒãƒãƒ³ã‚°å®Œäº†ï¼',
            'ã‚ãªãŸã®æ¡ä»¶ã«æœ€é©ãªæ¥­è€…ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼è¦‹ç©ã‚‚ã‚Šä¾é ¼ã«é€²ã¿ã¾ã™ã‹ï¼Ÿ'
          );
        }
      }
      
      showStageTransition(title, content) {
        document.getElementById('botQuestionArea').style.display = 'none';
        document.getElementById('transitionTitle').textContent = title;
        document.getElementById('transitionContent').textContent = content;
        document.getElementById('stageTransitionMessage').classList.remove('hidden');
      }
      
      showSortButtons() {
        // ç¬¬2æ®µéšå®Œäº†æ™‚ã«ã‚½ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
        const sortButtons = document.getElementById('sortButtons');
        if (sortButtons) {
          sortButtons.classList.remove('hidden');
          this.initSortButtons();
        }
      }
      
      initSortButtons() {
        // ã‚½ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
        const sortBtns = ['sortRecommend', 'sortCheap', 'sortReview', 'sortQuality'];
        
        sortBtns.forEach(btnId => {
          const btn = document.getElementById(btnId);
          if (btn) {
            btn.addEventListener('click', () => {
              this.handleSort(btnId);
            });
          }
        });
      }
      
      handleSort(sortType) {
        // ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçŠ¶æ…‹ã«
        document.querySelectorAll('.sort-btn').forEach(btn => {
          btn.classList.remove('active-sort', 'bg-blue-100', 'border-blue-300', 'text-blue-800');
          btn.classList.add('bg-white', 'border-gray-300', 'text-gray-700');
        });
        
        // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
        const activeBtn = document.getElementById(sortType);
        if (activeBtn) {
          activeBtn.classList.add('active-sort', 'bg-blue-100', 'border-blue-300', 'text-blue-800');
          activeBtn.classList.remove('bg-white', 'border-gray-300', 'text-gray-700');
        }
        
        // ã‚½ãƒ¼ãƒˆå‡¦ç†ï¼ˆãƒ‡ãƒ¢ãªã®ã§ãƒ­ã‚°å‡ºåŠ›ã®ã¿ï¼‰
        console.log(`ã‚½ãƒ¼ãƒˆå®Ÿè¡Œ: ${sortType}`);
      }
      
      nextStage() {
        this.currentStage++;
        this.currentQuestionIndex = 0;
        document.getElementById('stageTransitionMessage').classList.add('hidden');
        document.getElementById('botQuestionArea').style.display = 'block';
        
        if (this.currentStage <= 3) {
          this.showQuestion();
        } else {
          // ç¬¬4æ®µéšï¼ˆé›»è©±ç•ªå·å…¥åŠ›ï¼‰
          this.showPhoneNumberForm();
        }
      }
      
      showPhoneNumberForm() {
        document.getElementById('botQuestionArea').innerHTML = `
          <div class="bg-green-50 rounded-lg p-6 text-center">
            <h3 class="font-bold text-xl text-green-800 mb-3">ğŸ‰ ãƒãƒƒãƒãƒ³ã‚°å®Œäº†ï¼</h3>
            <p class="text-green-700 mb-4">ã‚ãªãŸã®æ¡ä»¶ã«ãƒ”ãƒƒã‚¿ãƒªã®å„ªè‰¯æ¥­è€…ã‚’ã”ç´¹ä»‹ã§ãã¾ã™ã€‚</p>
            <p class="text-sm text-gray-600 mb-4">è¦‹ç©ã‚‚ã‚Šä¾é ¼ã®ãŸã‚ã€é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
            
            <div class="max-w-sm mx-auto">
              <input 
                type="tel" 
                id="phoneNumber" 
                placeholder="090-1234-5678" 
                class="w-full py-3 px-4 text-center border-2 border-green-300 rounded-lg focus:border-green-500 focus:outline-none text-lg mb-4"
                maxlength="13"
              >
              <button 
                id="submitPhoneBtn" 
                class="w-full bg-kuraberu-blue hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors"
              >
                è¦‹ç©ã‚‚ã‚Šä¾é ¼ã‚’é€ä¿¡
              </button>
              <p class="text-xs text-gray-500 mt-2">
                ğŸ“ æ¥­è€…ã‹ã‚‰ç¢ºèªã®ãŠé›»è©±ã‚’ã„ãŸã—ã¾ã™<br>
                ğŸ”’ å€‹äººæƒ…å ±ã¯å³é‡ã«ç®¡ç†ã•ã‚Œã¾ã™
              </p>
            </div>
          </div>
        `;
        
        // é›»è©±ç•ªå·å…¥åŠ›ã®åˆ¶å¾¡
        const phoneInput = document.getElementById('phoneNumber');
        if (phoneInput) {
          phoneInput.addEventListener('input', function(e) {
            // æ•°å­—ã¨ãƒã‚¤ãƒ•ãƒ³ä»¥å¤–ã‚’å‰Šé™¤
            this.value = this.value.replace(/[^\d-]/g, '');
            
            // XXX-XXXX-XXXXã®å½¢å¼ã«è‡ªå‹•æ•´å½¢
            let value = this.value.replace(/-/g, '');
            if (value.length > 3 && value.length <= 7) {
              this.value = value.slice(0, 3) + '-' + value.slice(3);
            } else if (value.length > 7) {
              this.value = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11);
            }
          });
        }
        
        // é€ä¿¡ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
        const submitBtn = document.getElementById('submitPhoneBtn');
        if (submitBtn) {
          submitBtn.addEventListener('click', () => {
            const phone = phoneInput.value.trim();
            if (phone && phone.length >= 10) {
              this.completeAllStages();
            } else {
              alert('æ­£ã—ã„é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            }
          });
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¸æƒ…å ±ã‚’æ›´æ–°
        document.getElementById('stageTitle').textContent = 'ç”³ã—è¾¼ã¿æ‰‹ç¶šã';
        document.getElementById('progressBarBot').style.width = '100%';
      }
      
      completeAllStages() {
        document.getElementById('fixedBotSection').innerHTML = `
          <div class="container mx-auto px-4 py-4 text-center">
            <div class="bg-green-50 rounded-lg p-6">
              <h3 class="font-bold text-xl text-green-800 mb-3">âœ… è¦‹ç©ã‚‚ã‚Šä¾é ¼å®Œäº†ï¼</h3>
              <p class="text-green-700 mb-2">ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚è¦‹ç©ã‚‚ã‚Šä¾é ¼ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚</p>
              <p class="text-sm text-gray-600 mb-4">2å–¶æ¥­æ—¥ä»¥å†…ã«æ¥­è€…ã‚ˆã‚Šç¢ºèªã®ãŠé›»è©±ã‚’ã„ãŸã—ã¾ã™ã€‚</p>
              <div class="text-xs text-gray-500">
                <p>ğŸ“§ è©³ç´°æƒ…å ±ã‚’ãƒ¡ãƒ¼ãƒ«ã§ã‚‚ãŠé€ã‚Šã—ã¾ã™</p>
                <p>ğŸ¢ å³é¸ã•ã‚ŒãŸå„ªè‰¯æ¥­è€…ã®ã¿ã‚’ã”ç´¹ä»‹</p>
              </div>
            </div>
          </div>
        `;
      }
      
      goBack() {
        if (this.questionHistory.length > 0) {
          const lastQuestion = this.questionHistory.pop();
          this.currentStage = lastQuestion.stage;
          this.currentQuestionIndex = lastQuestion.questionIndex;
          delete this.answers[lastQuestion.questionId];
          this.showQuestion();
        }
      }
    }
    
    // ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆåˆæœŸåŒ–
    const chatbot = new ChatbotStateManager();
    chatbot.init();
  </script>
  
  <!-- ã‚­ãƒ¼ãƒ—ç¢ºèªç”¨ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ -->
  <div id="keepFloatingBox" class="fixed bottom-0 left-0 right-0 bg-white shadow-lg border-t border-gray-200 p-3 transition-transform duration-300 transform translate-y-full z-50">
    <div class="container mx-auto">
      <!-- 3ã¤ã®ãƒœã‚¿ãƒ³ã‚’æ¨ªä¸¦ã³ã«ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ã‚’ä¸Šéƒ¨ã«é…ç½®ï¼‰ -->
      <div class="flex justify-between items-stretch gap-4">
        <div class="relative flex-1 min-w-0">
          <button id="videoButton" class="bg-blue-400 hover:bg-blue-500 text-white px-3 py-2 rounded-md font-medium transition-colors shadow-sm w-full flex flex-col items-center justify-center text-xs">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            è¦‹ç©ã‚‚ã‚Šã®æµã‚Œå‹•ç”»
          </button>
        </div>
        
        <div class="relative flex-1 min-w-0">
          <button id="viewKeptCompanies" class="bg-yellow-300 hover:bg-yellow-400 text-black px-3 py-2 rounded-md font-medium transition-colors shadow-sm w-full flex flex-col items-center justify-center text-xs">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
            </svg>
            ã‚­ãƒ¼ãƒ—ä¸­æ¥­è€…ã‚’è¦‹ã‚‹
          </button>
          <div id="keepCountBadge2" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold hidden">0</div>
        </div>
        
        <div class="relative flex-1 min-w-0">
          <button class="bg-orange-400 hover:bg-orange-500 text-white px-3 py-2 rounded-md font-medium transition-colors shadow-sm w-full flex flex-col items-center justify-center text-xs">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
            ç„¡æ–™è¦‹ç©ã‚‚ã‚Šã‚’ä¾é ¼
          </button>
          <div id="keepCountBadge" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold hidden">0</div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>