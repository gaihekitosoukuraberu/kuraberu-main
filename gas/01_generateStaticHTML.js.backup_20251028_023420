/**
 * =====================================
 * ğŸ”¥ ã¾ã£ã•ã‚‰æ–°è¦ä½œæˆç‰ˆ - é™çš„HTMLç”Ÿæˆæ©Ÿèƒ½ ğŸ”¥
 * =====================================
 *
 * ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼HTMLæ§‹é€ ã‚’ä¸€å­—ä¸€å¥å®Œå…¨ã‚³ãƒ”ãƒ¼
 * ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿å‹•çš„ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°å¯¾å¿œ
 */

/**
 * ğŸ”¥ Geminiåºƒå‘Šãƒ†ã‚­ã‚¹ãƒˆå®Œå…¨é™¤å»æ©Ÿèƒ½
 */
function removeGeminiText(text) {
  if (!text) return text;

  const geminiPatterns = [
    /ãŠæ°—ã«å…¥ã‚Šã®ã‚¢ãƒ—ãƒªã®ä¸­ã‹ã‚‰\s*AI\s*ã‚’ç›´æ¥ãŠè©¦ã—ãã ã•ã„ã€‚[^ã€‚]*Gemini\s*ã‚’ä½¿ç”¨ã—ã¦[^ã€‚]*ã€‚*/gi,
    /\s*Gemini\s*ã‚’ä½¿ç”¨ã—ã¦[^ã€‚]*ã€‚*/gi,
    /AI\s*ã‚’ç›´æ¥ãŠè©¦ã—ãã ã•ã„[^ã€‚]*ã€‚*/gi,
    /ãŠæ°—ã«å…¥ã‚Šã®ã‚¢ãƒ—ãƒªã®ä¸­ã‹ã‚‰[^ã€‚]*ã€‚*/gi
  ];

  let cleanText = text;
  geminiPatterns.forEach(function(pattern) {
    cleanText = cleanText.replace(pattern, '');
  });

  return cleanText.replace(/\s+/g, ' ').trim();
}

/**
 * ğŸ”¥ ãƒ¡ã‚¤ãƒ³é–¢æ•°ï¼šé™çš„HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
 */
function generateStaticHTML(data) {
  console.log('[generateStaticHTML] ğŸ”¥ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆã§HTMLç”Ÿæˆé–‹å§‹');
  console.log('[generateStaticHTML] ãƒ‡ãƒ¼ã‚¿:', JSON.stringify(data, null, 2));

  try {
    // ãƒ‡ãƒ¼ã‚¿ã®å®‰å…¨ãªå–å¾—ã¨Geminiãƒ†ã‚­ã‚¹ãƒˆé™¤å»
    const companyName = removeGeminiText(data['ä¼šç¤¾å'] || 'æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«');
    const prText = removeGeminiText(data['PRãƒ†ã‚­ã‚¹ãƒˆ'] || '');
    const establishedYear = data['è¨­ç«‹å¹´æœˆ'] || '';
    const representativeName = data['ä»£è¡¨è€…å'] || '';
    const phone = data['é›»è©±ç•ªå·'] || '';
    const email = data['ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹'] || '';
    const address = data['ä½æ‰€'] || '';
    const businessHours = data['å–¶æ¥­æ™‚é–“'] || '';
    const kuraberuScore = parseFloat(data['ãã‚‰ã¹ã‚‹ã‚¹ã‚³ã‚¢'] || '4.2');

    // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆç”¨è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†
    const ratings = {
      pricing: parseFloat(data['ã‚³ã‚¹ãƒˆãƒãƒ©ãƒ³ã‚¹'] || '4.3'),
      communication: parseFloat(data['äººæŸ„ãƒ»å¯¾å¿œåŠ›'] || '4.4'),
      technology: parseFloat(data['æŠ€è¡“ãƒ»å“è³ª'] || '4.2'),
      service: parseFloat(data['ã‚¢ãƒ•ã‚¿ãƒ¼ã‚µãƒãƒ¼ãƒˆ'] || '3.2'),
      schedule: parseFloat(data['å¯¾å¿œã‚¹ãƒ”ãƒ¼ãƒ‰'] || '4.3'),
      quality: parseFloat(data['é¡§å®¢æº€è¶³åº¦'] || '4.1')
    };

    // æ–½å·¥äº‹ä¾‹ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†
    let examplesHtml = '';
    const examplesData = data['æ–½å·¥äº‹ä¾‹'] || '';
    if (examplesData && examplesData !== '') {
      try {
        const examples = JSON.parse(examplesData);
        if (examples && examples.length > 0) {
          examplesHtml = generateConstructionExamplesHtml(examples);
        }
      } catch (e) {
        console.log('[generateStaticHTML] æ–½å·¥äº‹ä¾‹ã®ãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—:', e);
      }
    }

    // å¯¾å¿œå¯èƒ½ãªå·¥äº‹ã®å‡¦ç†
    const constructionTypes = data['å¯¾å¿œå¯èƒ½ãªå·¥äº‹'] || '';
    const servicesHtml = generateServicesHtml(constructionTypes);

    // ğŸ”¥ ä¿æœ‰è³‡æ ¼ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å‹•çš„å–å¾—ï¼‰
    const qualificationsData = data['ä¿æœ‰è³‡æ ¼'] || '';

    // ğŸ”¥ åŠ å…¥ä¿é™ºãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å‹•çš„å–å¾—ï¼‰
    const insuranceData = data['åŠ å…¥ä¿é™º'] || '';

    // ğŸ”¥ å¯¾å¿œã‚¨ãƒªã‚¢ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å‹•çš„å–å¾—ï¼‰
    const areasData = data['å¯¾å¿œéƒ½é“åºœçœŒ'] || '';
    const citiesData = data['å¯¾å¿œå¸‚åŒºç”ºæ‘'] || '';

    // ğŸ”¥ ã‚®ãƒ£ãƒ©ãƒªãƒ¼ç”»åƒãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å‹•çš„å–å¾—ï¼‰
    const galleryData = data['ã‚®ãƒ£ãƒ©ãƒªãƒ¼ç”»åƒ'] || '';

    // ğŸ”¥ æ”¯åº—æƒ…å ±ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å‹•çš„å–å¾—ï¼‰
    const branchesData = data['æ”¯åº—æƒ…å ±'] || data['åº—èˆ—æƒ…å ±'] || '';

    // ğŸ”¥ ç‰¹æ®Šå¯¾å¿œé …ç›®ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ï¼ˆè‡ªå‹•é…ä¿¡è¨­å®šã®ç‰¹æ®Šå¯¾å¿œé …ç›®â†’å½“ç¤¾ã®å¼·ã¿ï¼‰
    const specialServicesData = data['ç‰¹æ®Šå¯¾å¿œé …ç›®'] || data['appeal_points'] || data['special_services'] || '';

    // ğŸ”¥ prTextã®æœ€åˆã®ã€ã€‚ã€ã¾ã§ã‚’è‡ªå‹•å–å¾—ï¼ˆå®Œå…¨ä¸€è‡´å‡¦ç†ï¼‰
    const firstSentence = prText.indexOf('ã€‚') !== -1 ? prText.substring(0, prText.indexOf('ã€‚') + 1) : prText;

    // ğŸ”¥ heroSectionï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
    const heroSectionHtml = generateHeroSectionHtml(companyName, firstSentence, establishedYear);

    // ğŸ”¥ ãã‚‰ã¹ã‚‹ã‚¹ã‚³ã‚¢ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
    const scoreHtml = generateKuraberuScoreHtml(kuraberuScore, ratings);

    // ğŸ”¥ 9ã¤ã®ç„¡æ–™ç‰¹å…¸ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
    const nineBenefitsHtml = generateNineBenefitsHtml();

    // ğŸ”¥ å¯¾å¿œã‚¨ãƒªã‚¢HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆãƒ»å‹•çš„ãƒ‡ãƒ¼ã‚¿ï¼‰
    const areasHtml = generateAreasHtml(areasData, citiesData);

    // ğŸ”¥ å†™çœŸã‚®ãƒ£ãƒ©ãƒªãƒ¼HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆãƒ»å‹•çš„ãƒ‡ãƒ¼ã‚¿ï¼‰
    const galleryHtml = generateGalleryHtml(galleryData);

    // ğŸ”¥ ä¿æœ‰è³‡æ ¼HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆãƒ»å‹•çš„ãƒ‡ãƒ¼ã‚¿ï¼‰
    const qualificationsHtml = generateQualificationsHtml(qualificationsData);

    // ğŸ”¥ åŠ å…¥ä¿é™ºHTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆãƒ»å‹•çš„ãƒ‡ãƒ¼ã‚¿ï¼‰
    const insuranceHtml = generateInsuranceHtml(insuranceData);

    // ğŸ”¥ ä¼šç¤¾ã®ç‰¹å¾´ãƒ»å¼·ã¿HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
    const companyStrengthHtml = generateCompanyStrengthHtml(prText);

    // ğŸ”¥ æ”¯åº—ãƒãƒƒãƒ—HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆãƒ»å‹•çš„ãƒ‡ãƒ¼ã‚¿ï¼‰
    const branchMapsHtml = generateBranchMapsHtml(branchesData);

    // ğŸ”¥ ä¼šç¤¾æ¦‚è¦HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
    const basicInfoHtml = generateBasicInfoHtml(companyName, representativeName, address, establishedYear);

    // å®Œå…¨ãªHTMLã®çµ„ã¿ç«‹ã¦
    const html = '<!DOCTYPE html>' +
'<html lang="ja">' +
'<head>' +
'    <meta charset="UTF-8">' +
'    <meta name="viewport" content="width=device-width, initial-scale=1.0">' +
'    <title>' + companyName + ' | å¤–å£å¡—è£…ãƒ»ãƒªãƒ•ã‚©ãƒ¼ãƒ å°‚é–€åº—</title>' +
'    <meta name="description" content="' + companyName + 'ã¯å¤–å£å¡—è£…ãƒ»ãƒªãƒ•ã‚©ãƒ¼ãƒ ã®å°‚é–€åº—ã§ã™ã€‚' + prText.substring(0, 100) + '">' +
'    <script src="https://cdn.tailwindcss.com"></script>' +
'    <style>' +
'        body { font-family: "Hiragino Sans", "ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ã‚·ãƒƒã‚¯", "Yu Gothic", "æ¸¸ã‚´ã‚·ãƒƒã‚¯", "Meiryo", "ãƒ¡ã‚¤ãƒªã‚ª", sans-serif; }' +
'        .fade-in { opacity: 0; animation: fadeIn 0.6s ease-in forwards; }' +
'        @keyframes fadeIn { to { opacity: 1; } }' +
'        .hover-scale { transition: transform 0.2s ease; }' +
'        .hover-scale:hover { transform: scale(1.05); }' +
'        .gradient-text { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }' +
'        .shadow-custom { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }' +
'    </style>' +
'</head>' +
'<body class="bg-gray-50">' +
'    <div class="min-h-screen py-12 px-4">' +
'        <div class="bg-white rounded-2xl max-w-6xl mx-auto shadow-2xl">' +
'            <div class="p-8">' +

              // ğŸ”¥ heroSectionï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ï¼‰
              heroSectionHtml +

              // ğŸ”¥ ä¼šç¤¾ã®ç‰¹å¾´ãƒ»å¼·ã¿ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ï¼‰
              companyStrengthHtml +

              // ğŸ”¥ æ–½å·¥äº‹ä¾‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ï¼‰
              examplesHtml +

              // ğŸ”¥ ãã‚‰ã¹ã‚‹ã‚¹ã‚³ã‚¢ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ï¼‰
              scoreHtml +

              // ğŸ”¥ 9ã¤ã®ç„¡æ–™ç‰¹å…¸ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ï¼‰
              nineBenefitsHtml +

              // ğŸ”¥ ãŠå•ã„åˆã‚ã›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ï¼‰
'                <div class="mb-12">' +
'                    <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">' +
'                        <span class="w-1 h-6 bg-purple-600 mr-3 rounded"></span>' +
'                        ãŠå•ã„åˆã‚ã›' +
'                    </h3>' +
'                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">' +
'                        <div class="bg-white border rounded-xl p-4 hover:shadow-lg transition">' +
'                            <div class="flex items-center">' +
'                                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">' +
'                                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
'                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>' +
'                                    </svg>' +
'                                </div>' +
'                                <div>' +
'                                    <p class="text-sm text-gray-600">ãŠé›»è©±ã§ã®ãŠå•ã„åˆã‚ã›</p>' +
'                                    <a href="tel:' + phone + '" class="text-lg font-semibold text-blue-600 hover:text-blue-800 cursor-pointer transition-colors">' + phone + '</a>' +
'                                    <p class="text-xs text-gray-500">å—ä»˜æ™‚é–“: ' + businessHours + '</p>' +
'                                </div>' +
'                            </div>' +
'                        </div>' +
                        (email ? (
'                        <div class="bg-white border rounded-xl p-4 hover:shadow-lg transition">' +
'                            <div class="flex items-center">' +
'                                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4">' +
'                                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
'                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>' +
'                                    </svg>' +
'                                </div>' +
'                                <div class="overflow-hidden min-w-0">' +
'                                    <p class="text-sm text-gray-600">ãƒ¡ãƒ¼ãƒ«ã§ã®ãŠå•ã„åˆã‚ã›</p>' +
'                                    <a href="mailto:' + email + '" class="text-lg font-semibold text-green-600 hover:text-green-800 cursor-pointer transition-colors truncate block">' + email + '</a>' +
'                                    <p class="text-xs text-gray-500">24æ™‚é–“å—ä»˜ä¸­</p>' +
'                                </div>' +
'                            </div>' +
'                        </div>'
                        ) : '') +
'                    </div>' +
'                </div>' +

              // ğŸ”¥ å¯¾å¿œã‚¨ãƒªã‚¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ï¼‰
              areasHtml +

              // ğŸ”¥ å¯¾å¿œå¯èƒ½ãªå·¥äº‹ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ï¼‰
              servicesHtml +

              // ğŸ”¥ ä¼šç¤¾æ¦‚è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ï¼‰
              basicInfoHtml +

'            </div>' +
'        </div>' +
'    </div>' +
'</body>' +
'</html>';

    return html;

  } catch (error) {
    console.error('[generateStaticHTML] ã‚¨ãƒ©ãƒ¼:', error);
    return generateErrorHTML(error.toString());
  }
}

/**
 * ğŸ”¥ heroSection HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
 */
function generateHeroSectionHtml(companyName, firstSentence, establishedYear) {
  const establishedDisplay = establishedYear ? establishedYear : '';

  return '<div id="heroSection" class="relative bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-12 mb-12 text-white overflow-hidden">' +
'    <div class="absolute inset-0 bg-black opacity-10"></div>' +
'    <div class="relative z-10">' +
'        <h1 id="previewCompanyNameHero" class="text-2xl sm:text-4xl font-bold mb-2 text-center sm:text-left">' + companyName + '</h1>' +
'        <p id="previewTaglineHero" class="text-base sm:text-lg opacity-90 text-center sm:text-left">' + firstSentence + '</p>' +
'        <div class="flex flex-wrap gap-4 mt-6">' +
            (establishedDisplay ? (
'            <div class="flex items-center">' +
'                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">' +
'                    <path d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm3 1h6v4H7V5zm6 6H7v2h6v-2z"></path>' +
'                </svg>' +
'                <span id="previewEstablishedHero">' + establishedDisplay + '</span>' +
'            </div>'
            ) : '') +
'        </div>' +
'    </div>' +
'</div>';
}

/**
 * ğŸ”¥ ãã‚‰ã¹ã‚‹ã‚¹ã‚³ã‚¢HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
 */
function generateKuraberuScoreHtml(score, ratings) {
  const scoreValue = parseFloat(score) || 4.2;
  const finalRatings = ratings || {
    pricing: 4.3,
    communication: 4.4,
    technology: 4.2,
    service: 3.2,
    schedule: 4.3,
    quality: 4.1
  };

  return '<div id="preview-rating" class="mb-8 sm:mb-12 bg-gradient-to-br from-amber-50 via-orange-50 to-red-50 rounded-2xl p-4 sm:p-6 lg:p-8">' +
'    <div class="mb-4 sm:mb-6">' +
'        <h3 class="text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 mb-2 inline-flex items-center">' +
'            <span class="w-1 h-5 sm:h-6 bg-gradient-to-b from-amber-500 to-orange-600 mr-2 sm:mr-3 rounded"></span>' +
'            ãã‚‰ã¹ã‚‹ã‚¹ã‚³ã‚¢' +
'        </h3>' +
'        <p class="text-sm sm:text-base text-gray-600">å½“ç¤¾ç‹¬è‡ªã®ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢</p>' +
'    </div>' +
'    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 lg:gap-8">' +
        // ç·åˆè©•ä¾¡
'        <div class="bg-white rounded-xl shadow-lg border-2 border-amber-100 p-4 sm:p-5 lg:p-6">' +
'            <div class="text-center mb-4 sm:mb-5">' +
'                <h4 class="text-base sm:text-lg lg:text-xl font-bold text-gray-800 mb-2 sm:mb-3">ç·åˆè©•ä¾¡</h4>' +
'                <div class="flex items-center justify-center mb-2 sm:mb-3">' +
'                    <span class="text-3xl sm:text-4xl lg:text-5xl font-bold text-amber-600" id="overallRating">' + scoreValue.toFixed(1) + '</span>' +
'                    <span class="text-base sm:text-lg lg:text-xl text-gray-500 ml-1">/5.0</span>' +
'                </div>' +
'                <div class="flex justify-center mb-2 sm:mb-3 gap-1" id="overallStars">' +
                    generateStarsHtml(scoreValue) +
'                </div>' +
'                <p class="text-xs sm:text-sm text-gray-500">å½“ç¤¾ç‹¬è‡ªç®—å‡ºã‚¹ã‚³ã‚¢</p>' +
'            </div>' +

            // é …ç›®åˆ¥è©•ä¾¡
'            <div class="space-y-2 sm:space-y-3">' +
'                <div class="flex justify-between items-center py-1">' +
'                    <span class="text-sm sm:text-base font-medium text-gray-700">ã‚³ã‚¹ãƒˆãƒãƒ©ãƒ³ã‚¹</span>' +
'                    <div class="flex items-center">' +
'                        <div class="flex text-amber-400 mr-2 gap-0.5">' +
                            generateDetailStarsHtml(finalRatings.pricing) +
'                        </div>' +
'                        <span class="text-sm sm:text-base font-medium text-gray-800" id="pricingRating">' + finalRatings.pricing.toFixed(1) + '</span>' +
'                    </div>' +
'                </div>' +
'                <div class="flex justify-between items-center py-1">' +
'                    <span class="text-sm sm:text-base font-medium text-gray-700">äººæŸ„ãƒ»å¯¾å¿œåŠ›</span>' +
'                    <div class="flex items-center">' +
'                        <div class="flex text-amber-400 mr-2">' +
                            generateDetailStarsHtml(finalRatings.communication) +
'                        </div>' +
'                        <span class="text-sm sm:text-base font-medium text-gray-800" id="communicationRating">' + finalRatings.communication.toFixed(1) + '</span>' +
'                    </div>' +
'                </div>' +
'                <div class="flex justify-between items-center py-1">' +
'                    <span class="text-sm sm:text-base font-medium text-gray-700">æŠ€è¡“ãƒ»å“è³ª</span>' +
'                    <div class="flex items-center">' +
'                        <div class="flex text-amber-400 mr-2">' +
                            generateDetailStarsHtml(finalRatings.technology) +
'                        </div>' +
'                        <span class="text-sm sm:text-base font-medium text-gray-800" id="technologyRating">' + finalRatings.technology.toFixed(1) + '</span>' +
'                    </div>' +
'                </div>' +
'                <div class="flex justify-between items-center py-1">' +
'                    <span class="text-sm sm:text-base font-medium text-gray-700">å¯¾å¿œã‚¹ãƒ”ãƒ¼ãƒ‰</span>' +
'                    <div class="flex items-center">' +
'                        <div class="flex text-amber-400 mr-2">' +
                            generateDetailStarsHtml(finalRatings.schedule) +
'                        </div>' +
'                        <span class="text-sm sm:text-base font-medium text-gray-800" id="scheduleRating">' + finalRatings.schedule.toFixed(1) + '</span>' +
'                    </div>' +
'                </div>' +
'                <div class="flex justify-between items-center py-1">' +
'                    <span class="text-sm sm:text-base font-medium text-gray-700">ã‚¢ãƒ•ã‚¿ãƒ¼ã‚µãƒãƒ¼ãƒˆ</span>' +
'                    <div class="flex items-center">' +
'                        <div class="flex text-amber-400 mr-2">' +
                            generateDetailStarsHtml(finalRatings.service) +
'                        </div>' +
'                        <span class="text-sm sm:text-base font-medium text-gray-800" id="serviceRating">' + finalRatings.service.toFixed(1) + '</span>' +
'                    </div>' +
'                </div>' +
'                <div class="flex justify-between items-center py-1">' +
'                    <span class="text-sm sm:text-base font-medium text-gray-700">é¡§å®¢æº€è¶³åº¦</span>' +
'                    <div class="flex items-center">' +
'                        <div class="flex text-amber-400 mr-2">' +
                            generateDetailStarsHtml(finalRatings.quality) +
'                        </div>' +
'                        <span class="text-sm sm:text-base font-medium text-gray-800" id="qualityRating">' + finalRatings.quality.toFixed(1) + '</span>' +
'                    </div>' +
'                </div>' +
'            </div>' +
'        </div>' +

        // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆï¼ˆå³å´ï¼‰
        generateRadarChartHTML(finalRatings) +
'    </div>' +
'</div>';
}

/**
 * ğŸ”¥ è©³ç´°é …ç›®ç”¨æ˜Ÿè©•ä¾¡HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
 */
function generateDetailStarsHtml(score) {
  const fullStars = Math.floor(score);
  const hasHalfStar = score % 1 >= 0.5;
  let html = '';

  for (let i = 0; i < 5; i++) {
    if (i < fullStars) {
      html += '<svg class="w-4 h-4 sm:w-5 sm:h-5 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>';
    } else if (i === fullStars && hasHalfStar) {
      html += '<svg class="w-4 h-4 sm:w-5 sm:h-5 fill-current" viewBox="0 0 20 20"><defs><linearGradient id="half"><stop offset="50%" stop-color="currentColor"/><stop offset="50%" stop-color="#e5e7eb"/></linearGradient></defs><path fill="url(#half)" d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>';
    } else {
      html += '<svg class="w-4 h-4 sm:w-5 sm:h-5 text-gray-300 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>';
    }
  }

  return html;
}

/**
 * ğŸ”¥ æ˜Ÿè©•ä¾¡HTMLç”Ÿæˆ
 */
function generateStarsHtml(score) {
  const fullStars = Math.floor(score);
  const hasHalfStar = score % 1 >= 0.5;
  let html = '';

  for (let i = 0; i < 5; i++) {
    if (i < fullStars) {
      html += '<svg class="w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 text-amber-400 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>';
    } else if (i === fullStars && hasHalfStar) {
      html += '<svg class="w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 text-amber-400 fill-current" viewBox="0 0 20 20"><defs><linearGradient id="half"><stop offset="50%" stop-color="currentColor"/><stop offset="50%" stop-color="#e5e7eb"/></linearGradient></defs><path fill="url(#half)" d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>';
    } else {
      html += '<svg class="w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 text-gray-300 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>';
    }
  }

  return html;
}

/**
 * ğŸ”¥ 9ã¤ã®ç„¡æ–™ç‰¹å…¸HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
 */
function generateNineBenefitsHtml() {
  return '<div class="mb-8 sm:mb-12 bg-gradient-to-br from-orange-50 via-orange-100 to-red-50 rounded-2xl p-4 sm:p-6 lg:p-10">' +
'    <div class="text-center mb-4 sm:mb-6">' +
'        <h3 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900 mb-2">ğŸ ä»Šã ã‘ï¼9ã¤ã®ç„¡æ–™ç‰¹å…¸</h3>' +
'        <p class="text-sm sm:text-base text-gray-600">æœŸé–“é™å®šã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³å®Ÿæ–½ä¸­ï¼</p>' +
'    </div>' +

'    <div class="max-w-4xl mx-auto mb-4 sm:mb-6 px-2 sm:px-4">' +
'        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">' +
            // ç‰¹å…¸1: ç„¡æ–™ç‚¹æ¤œ
'            <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">' +
'                <div class="flex items-start">' +
'                    <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ğŸ”</span>' +
'                    <div class="min-w-0 flex-1">' +
'                        <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ç„¡æ–™ç‚¹æ¤œ</h4>' +
'                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">ãƒ—ãƒ­ã®ç›®ã§å¤–å£ãƒ»å±‹æ ¹ã‚’å¾¹åº•ãƒã‚§ãƒƒã‚¯ï¼ãŠå®¶ã®çŠ¶æ…‹ã‚’è©³ç´°ã«å ±å‘Š</p>' +
'                    </div>' +
'                </div>' +
'            </div>' +
            // ç‰¹å…¸2: ã‚¨ãƒªã‚¢æœ€ä½ä¾¡æ ¼ä¿è¨¼
'            <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">' +
'                <div class="flex items-start">' +
'                    <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ğŸ’°</span>' +
'                    <div class="min-w-0 flex-1">' +
'                        <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ã‚¨ãƒªã‚¢æœ€ä½ä¾¡æ ¼ä¿è¨¼</h4>' +
'                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">åœ°åŸŸæœ€å®‰å€¤ã‚’ãŠç´„æŸï¼ä»–ç¤¾ã‚ˆã‚Šé«˜ã‘ã‚Œã°å€¤å¼•ãå¯¾å¿œ</p>' +
'                    </div>' +
'                </div>' +
'            </div>' +
            // ç‰¹å…¸3: ãŠå€¤å¼•ãäº¤æ¸‰ä»£è¡Œ
'            <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">' +
'                <div class="flex items-start">' +
'                    <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ğŸ¤</span>' +
'                    <div class="min-w-0 flex-1">' +
'                        <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ãŠå€¤å¼•ãäº¤æ¸‰ä»£è¡Œ</h4>' +
'                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">ä»–ç¤¾è¦‹ç©ã‚‚ã‚Šã‚’ãŠæŒã¡ãªã‚‰ã€ä»£ã‚ã‚Šã«äº¤æ¸‰ã—ã¦æœ€å®‰å€¤ã‚’å®Ÿç¾</p>' +
'                    </div>' +
'                </div>' +
'            </div>' +
            // ç‰¹å…¸4: åŠ©æˆé‡‘ç”³è«‹ã‚µãƒãƒ¼ãƒˆ
'            <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">' +
'                <div class="flex items-start">' +
'                    <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ğŸ“</span>' +
'                    <div class="min-w-0 flex-1">' +
'                        <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">åŠ©æˆé‡‘ç”³è«‹ã‚µãƒãƒ¼ãƒˆ</h4>' +
'                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">æœ€å¤§10ï½70ä¸‡å††ï¼å„ç¨®åŠ©æˆé‡‘ã®ç”³è«‹æ‰‹ç¶šãã‚’å®Œå…¨ã‚µãƒãƒ¼ãƒˆ</p>' +
'                    </div>' +
'                </div>' +
'            </div>' +
            // ç‰¹å…¸5: ç«ç½ä¿é™ºç”³è«‹ã‚µãƒãƒ¼ãƒˆ
'            <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">' +
'                <div class="flex items-start">' +
'                    <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ğŸ›ï¸</span>' +
'                    <div class="min-w-0 flex-1">' +
'                        <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ç«ç½ä¿é™ºç”³è«‹ã‚µãƒãƒ¼ãƒˆ</h4>' +
'                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">å°é¢¨ãƒ»é›ªå®³ç­‰ã®æå®³ã«ç«ç½ä¿é™ºé©ç”¨å¯èƒ½ï¼ç„¡æ–™ã§èª¿æŸ»</p>' +
'                    </div>' +
'                </div>' +
'            </div>' +
            // ç‰¹å…¸6: ãŠæ–­ã‚Šä»£è¡Œã‚µãƒ¼ãƒ“ã‚¹
'            <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">' +
'                <div class="flex items-start">' +
'                    <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ğŸš«</span>' +
'                    <div class="min-w-0 flex-1">' +
'                        <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ãŠæ–­ã‚Šä»£è¡Œã‚µãƒ¼ãƒ“ã‚¹</h4>' +
'                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">æˆç´„æ™‚ã®ä»–ç¤¾ã¸ã®ãŠæ–­ã‚Šã‚‚ä»£è¡Œå¯èƒ½ï¼é¢å€’ãªã‚„ã‚Šå–ã‚Šä¸è¦</p>' +
'                    </div>' +
'                </div>' +
'            </div>' +
            // ç‰¹å…¸7: ç„¡æ–™ãŠé›»è©±ã‚µãƒãƒ¼ãƒˆ
'            <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">' +
'                <div class="flex items-start">' +
'                    <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ğŸ“</span>' +
'                    <div class="min-w-0 flex-1">' +
'                        <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ç„¡æ–™ãŠé›»è©±ã‚µãƒãƒ¼ãƒˆ</h4>' +
'                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">å·¥äº‹å®Œäº†å¾Œã‚‚å®‰å¿ƒï¼365æ—¥é›»è©±ã‚µãƒãƒ¼ãƒˆã§ãŠæ‚©ã¿è§£æ±º</p>' +
'                    </div>' +
'                </div>' +
'            </div>' +
            // ç‰¹å…¸8: è¨ªå•æ¥­è€…ãƒãƒ‹ãƒ¥ã‚¢ãƒ«é€²å‘ˆ
'            <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">' +
'                <div class="flex items-start">' +
'                    <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ğŸ“–</span>' +
'                    <div class="min-w-0 flex-1">' +
'                        <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">è¨ªå•æ¥­è€…ãƒãƒ‹ãƒ¥ã‚¢ãƒ«é€²å‘ˆ</h4>' +
'                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">æ‚ªå¾³æ¥­è€…ã®æ‰‹å£ã‚„å¯¾å‡¦æ³•ã‚’å®Œå…¨è§£èª¬ï¼å®‰å¿ƒã‚¬ã‚¤ãƒ‰</p>' +
'                    </div>' +
'                </div>' +
'            </div>' +
            // ç‰¹å…¸9: ãŠå‹é”ç´¹ä»‹ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³
'            <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">' +
'                <div class="flex items-start">' +
'                    <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ğŸ‘¥</span>' +
'                    <div class="min-w-0 flex-1">' +
'                        <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ãŠå‹é”ç´¹ä»‹ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³</h4>' +
'                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">ç´¹ä»‹ã§åŒæ–¹ã«ç‰¹å…¸ï¼æœ€å¤§30,000å††åˆ†ã®ã‚®ãƒ•ãƒˆã‚«ãƒ¼ãƒ‰</p>' +
'                    </div>' +
'                </div>' +
'            </div>' +
'        </div>' +
'    </div>' +
'    <div class="text-center mt-4 sm:mt-6">' +
'        <button class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 sm:px-8 lg:px-10 py-3 sm:py-4 rounded-lg hover:shadow-xl transition font-bold text-base sm:text-lg transform hover:scale-105 w-full sm:w-auto max-w-sm sm:max-w-none">' +
'            <span class="sm:hidden">ä»Šã™ãç„¡æ–™è¦‹ç©ã‚‚ã‚Šã‚’ä¾é ¼</span>' +
'            <span class="hidden sm:inline">ä»Šã™ãç„¡æ–™è¦‹ç©ã‚‚ã‚Šã‚’ä¾é ¼ã™ã‚‹</span>' +
'        </button>' +
'        <p class="text-xs sm:text-sm text-gray-500 mt-2">â€»24æ™‚é–“ä»¥å†…ã«ã”é€£çµ¡ã„ãŸã—ã¾ã™</p>' +
'    </div>' +
'</div>';
}

/**
 * ğŸ”¥ å¯¾å¿œå¯èƒ½ãªå·¥äº‹HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
 */
function generateServicesHtml(constructionTypes) {
  if (!constructionTypes || constructionTypes === '') {
    return '';
  }

  let services = [];
  try {
    if (typeof constructionTypes === 'string') {
      services = constructionTypes.split(',').map(function(s) { return s.trim(); }).filter(function(s) { return s !== ''; });
    } else if (Array.isArray(constructionTypes)) {
      services = constructionTypes;
    }
  } catch (e) {
    console.log('[generateServicesHtml] ãƒ‘ãƒ¼ã‚¹å¤±æ•—:', e);
  }

  if (services.length === 0) {
    return '';
  }

  const serviceIconMap = {
    'å¤–å£å¡—è£…': 'ğŸ¨',
    'å¤–å£ã‚«ãƒãƒ¼å·¥æ³•': 'ğŸ—ï¸',
    'å¤–å£å¼µæ›¿ãˆ': 'ğŸ”¨',
    'å±‹æ ¹å¡—è£…ï¼ˆå¤–å£å·¥äº‹å«ã‚€ï¼‰': 'ğŸ ',
    'å±‹æ ¹å¡—è£…': 'ğŸ ',
    'å±‹ä¸Šé˜²æ°´ï¼ˆå¤–å£å·¥äº‹å«ã‚€ï¼‰': 'ğŸ’§',
    'å±‹æ ¹è‘ºãæ›¿ãˆãƒ»å¼µã‚Šæ›¿ãˆâ€»ã‚¹ãƒ¬ãƒ¼ãƒˆãƒ»ã‚¬ãƒ«ãƒãƒªã‚¦ãƒ ç­‰': 'ğŸšï¸',
    'å±‹æ ¹è‘ºãæ›¿ãˆãƒ»å¼µã‚Šæ›¿ãˆâ€»ç“¦': 'ğŸ¯',
    'å±‹æ ¹ã‚«ãƒãƒ¼å·¥æ³•': 'ğŸ“',
    'å¤–å£è£œä¿®ï¼ˆå¤–å£å·¥äº‹å«ã‚€ï¼‰': 'ğŸ”§',
    'å±‹æ ¹è£œä¿®ï¼ˆå¤–å£å·¥äº‹å«ã‚€ï¼‰': 'ğŸ› ï¸',
    'ãƒ™ãƒ©ãƒ³ãƒ€é˜²æ°´ï¼ˆå¤–å£å·¥äº‹å«ã‚€ï¼‰': 'ğŸŒŠ',
    'å†…è£…æ°´å›ã‚Šï¼ˆãƒã‚¹ãƒ»ã‚­ãƒƒãƒãƒ³ãƒ»ãƒˆã‚¤ãƒ¬ï¼‰ï¼ˆå¤–å£å·¥äº‹å«ã‚€ï¼‰': 'ğŸš¿',
    'å†…è£…ï¼ˆãƒ•ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚„ç•³ãªã©ã®åºŠãƒ»ã‚¯ãƒ­ã‚¹ç­‰ï¼‰ï¼ˆå¤–å£å·¥äº‹å«ã‚€ï¼‰': 'ğŸ¡',
    'é›¨æ¨‹äº¤æ›ãƒ»ä¿®ç†': 'ğŸŒ§ï¸',
    'ã‚·ãƒ¼ãƒªãƒ³ã‚°å·¥äº‹': 'ğŸ”§',
    'ãƒ™ãƒ©ãƒ³ãƒ€é˜²æ°´': 'ğŸŠ',
    'è¶³å ´è¨­ç½®': 'âš™ï¸',
    'å†…è£…ãƒªãƒ•ã‚©ãƒ¼ãƒ ': 'ğŸª„',
    'ãã®ä»–': 'â­'
  };

  let html = '<div id="preview-services" class="mb-12">' +
'    <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">' +
'        <span class="w-1 h-6 bg-green-600 mr-3 rounded"></span>' +
'        å¯¾å¿œå¯èƒ½ãªå·¥äº‹' +
'    </h3>' +
'    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">';

  services.forEach(function(service) {
    const icon = serviceIconMap[service] || 'ğŸ”§';
    html += '        <div class="bg-white border border-green-200 rounded-lg p-3 flex items-center hover:shadow-md transition">' +
'            <span class="text-2xl mr-2">' + icon + '</span>' +
'            <span class="text-sm font-medium text-gray-800">' + service + '</span>' +
'        </div>';
  });

  html += '    </div>' +
'</div>';

  return html;
}

/**
 * ğŸ”¥ æ–½å·¥äº‹ä¾‹HTMLç”Ÿæˆ
 */
function generateConstructionExamplesHtml(examples) {
  if (!examples || examples.length === 0) {
    return '';
  }

  let html = '<div class="mb-12">' +
'    <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">' +
'        <span class="w-1 h-6 bg-pink-600 mr-3 rounded"></span>' +
'        æ–½å·¥äº‹ä¾‹' +
'    </h3>' +
'    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">';

  examples.forEach(function(example, index) {
    html += '        <div class="bg-white rounded-xl overflow-hidden shadow-md hover:shadow-lg transition">' +
'            <img src="' + (example.thumbnail || example.image || '') + '" alt="' + (example.title || 'æ–½å·¥äº‹ä¾‹' + (index + 1)) + '" class="w-full h-48 object-cover" onError="this.src=\'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgNTBIMTUwVjE1MEgxMDBWNTBaIiBmaWxsPSIjRDFENURLIi8+CjwvdGc+Cjwvc3ZnPg==\'">' +
'            <div class="p-4">' +
'                <h4 class="font-semibold text-gray-900 mb-2">' + (example.title || 'æ–½å·¥äº‹ä¾‹' + (index + 1)) + '</h4>' +
'                <p class="text-sm text-gray-600 mb-3">' + (example.description || '') + '</p>' +
'                <div class="flex justify-between items-center text-xs text-gray-500">' +
'                    <span>å·¥æœŸ: ' + (example.duration || '-') + '</span>' +
'                    <span>è²»ç”¨: ' + (example.cost || '-') + '</span>' +
'                </div>' +
'            </div>' +
'        </div>';
  });

  html += '    </div>' +
'</div>';

  return html;
}

/**
 * ğŸ”¥ ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆç”Ÿæˆï¼ˆ6è§’å½¢SVGï¼‰
 */
function generateRadarChartHTML(ratings) {
  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè©•ä¾¡å€¤ï¼ˆ5ç‚¹æº€ç‚¹ï¼‰
  const defaultRatings = {
    pricing: 4.3,          // ã‚³ã‚¹ãƒˆãƒãƒ©ãƒ³ã‚¹
    communication: 4.4,    // äººæŸ„ãƒ»å¯¾å¿œåŠ›
    technology: 4.2,       // æŠ€è¡“ãƒ»å“è³ª
    service: 3.2,         // ã‚¢ãƒ•ã‚¿ãƒ¼ã‚µãƒãƒ¼ãƒˆ
    schedule: 4.3,        // å¯¾å¿œã‚¹ãƒ”ãƒ¼ãƒ‰
    quality: 4.1          // é¡§å®¢æº€è¶³åº¦
  };

  // ratingsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã®å€¤å–å¾—ï¼ˆå­˜åœ¨ã—ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä½¿ç”¨ï¼‰
  const finalRatings = {
    pricing: ratings && ratings.pricing ? parseFloat(ratings.pricing) : defaultRatings.pricing,
    communication: ratings && ratings.communication ? parseFloat(ratings.communication) : defaultRatings.communication,
    technology: ratings && ratings.technology ? parseFloat(ratings.technology) : defaultRatings.technology,
    service: ratings && ratings.service ? parseFloat(ratings.service) : defaultRatings.service,
    schedule: ratings && ratings.schedule ? parseFloat(ratings.schedule) : defaultRatings.schedule,
    quality: ratings && ratings.quality ? parseFloat(ratings.quality) : defaultRatings.quality
  };

  // åº§æ¨™è¨ˆç®—ï¼ˆ6è§’å½¢ã€5ç‚¹æº€ç‚¹ã§æ­£è¦åŒ–ï¼‰
  const center = 200;
  const maxRadius = 100;

  const points = [
    { angle: 0, value: finalRatings.pricing / 5 },         // ã‚³ã‚¹ãƒˆãƒãƒ©ãƒ³ã‚¹ï¼ˆä¸Šï¼‰
    { angle: 60, value: finalRatings.communication / 5 },  // äººæŸ„ãƒ»å¯¾å¿œåŠ›ï¼ˆå³ä¸Šï¼‰
    { angle: 120, value: finalRatings.technology / 5 },    // æŠ€è¡“ãƒ»å“è³ªï¼ˆå³ä¸‹ï¼‰
    { angle: 180, value: finalRatings.service / 5 },       // ã‚¢ãƒ•ã‚¿ãƒ¼ã‚µãƒãƒ¼ãƒˆï¼ˆä¸‹ï¼‰
    { angle: 240, value: finalRatings.schedule / 5 },      // å¯¾å¿œã‚¹ãƒ”ãƒ¼ãƒ‰ï¼ˆå·¦ä¸‹ï¼‰
    { angle: 300, value: finalRatings.quality / 5 }        // é¡§å®¢æº€è¶³åº¦ï¼ˆå·¦ä¸Šï¼‰
  ];

  // SVGåº§æ¨™è¨ˆç®—
  const chartPoints = points.map(function(point) {
    var radian = (point.angle - 90) * Math.PI / 180;
    var radius = point.value * maxRadius;
    return {
      x: radius * Math.cos(radian),
      y: radius * Math.sin(radian)
    };
  });

  // polygonã®pointså±æ€§ç”¨æ–‡å­—åˆ—ç”Ÿæˆ
  const polygonPoints = chartPoints.map(function(point) {
    return point.x + ',' + point.y;
  }).join(' ');

  return '<!-- 6è§’å½¢ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ -->' +
'<div class="bg-white rounded-xl shadow-lg border-2 border-amber-100 p-4 sm:p-5 lg:p-6">' +
'    <h4 class="text-base sm:text-lg lg:text-xl font-bold text-gray-800 mb-3 sm:mb-4 text-center">é …ç›®åˆ¥è©•ä¾¡ãƒãƒ£ãƒ¼ãƒˆ</h4>' +
'    <div class="flex justify-center overflow-hidden">' +
'        <svg width="100%" height="320" viewBox="0 0 400 400" class="radarChart max-w-xs sm:max-w-sm lg:max-w-md" style="width: min(100%, 320px); height: auto;">' +
'            <!-- èƒŒæ™¯ã‚°ãƒªãƒƒãƒ‰ -->' +
'            <g id="radarGrid" transform="translate(200,200)">' +
'                <!-- 5æ®µéšã®ã‚°ãƒªãƒƒãƒ‰å†† -->' +
'                <circle cx="0" cy="0" r="20" fill="none" stroke="#f3f4f6" stroke-width="1"/>' +
'                <circle cx="0" cy="0" r="40" fill="none" stroke="#e5e7eb" stroke-width="1"/>' +
'                <circle cx="0" cy="0" r="60" fill="none" stroke="#d1d5db" stroke-width="1"/>' +
'                <circle cx="0" cy="0" r="80" fill="none" stroke="#9ca3af" stroke-width="1"/>' +
'                <circle cx="0" cy="0" r="100" fill="none" stroke="#6b7280" stroke-width="1"/>' +
'                <!-- è»¸ç·š -->' +
'                <line x1="0" y1="-100" x2="0" y2="100" stroke="#e5e7eb" stroke-width="1"/>' +
'                <line x1="-86.6" y1="-50" x2="86.6" y2="50" stroke="#e5e7eb" stroke-width="1"/>' +
'                <line x1="-86.6" y1="50" x2="86.6" y2="-50" stroke="#e5e7eb" stroke-width="1"/>' +
'            </g>' +
'            <!-- ãƒ‡ãƒ¼ã‚¿ãƒãƒªã‚´ãƒ³ -->' +
'            <g id="radarData" transform="translate(200,200)">' +
'                <polygon id="ratingPolygon" class="chart-data"' +
'                    points="' + polygonPoints + '"' +
'                    fill="rgba(245, 158, 11, 0.2)"' +
'                    stroke="#f59e0b"' +
'                    stroke-width="2"' +
'                    stroke-linejoin="round"/>' +
'                <!-- ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆ -->' +
'                <circle cx="' + chartPoints[0].x + '" cy="' + chartPoints[0].y + '" r="4" fill="#f59e0b" class="data-point-0"/>' +
'                <circle cx="' + chartPoints[1].x + '" cy="' + chartPoints[1].y + '" r="4" fill="#f59e0b" class="data-point-1"/>' +
'                <circle cx="' + chartPoints[2].x + '" cy="' + chartPoints[2].y + '" r="4" fill="#f59e0b" class="data-point-2"/>' +
'                <circle cx="' + chartPoints[3].x + '" cy="' + chartPoints[3].y + '" r="4" fill="#f59e0b" class="data-point-3"/>' +
'                <circle cx="' + chartPoints[4].x + '" cy="' + chartPoints[4].y + '" r="4" fill="#f59e0b" class="data-point-4"/>' +
'                <circle cx="' + chartPoints[5].x + '" cy="' + chartPoints[5].y + '" r="4" fill="#f59e0b" class="data-point-5"/>' +
'            </g>' +
'            <!-- ãƒ©ãƒ™ãƒ« -->' +
'            <g id="radarLabels" transform="translate(200,200)">' +
'                <text x="0" y="-125" text-anchor="middle" class="text-xs sm:text-sm font-semibold fill-gray-700">ã‚³ã‚¹ãƒˆãƒãƒ©ãƒ³ã‚¹</text>' +
'                <text x="115" y="-25" text-anchor="start" class="text-xs sm:text-sm font-semibold fill-gray-700">äººæŸ„ãƒ»å¯¾å¿œåŠ›</text>' +
'                <text x="115" y="65" text-anchor="start" class="text-xs sm:text-sm font-semibold fill-gray-700">æŠ€è¡“ãƒ»å“è³ª</text>' +
'                <text x="0" y="145" text-anchor="middle" class="text-xs sm:text-sm font-semibold fill-gray-700">ã‚¢ãƒ•ã‚¿ãƒ¼ã‚µãƒãƒ¼ãƒˆ</text>' +
'                <text x="-115" y="65" text-anchor="end" class="text-xs sm:text-sm font-semibold fill-gray-700">å¯¾å¿œã‚¹ãƒ”ãƒ¼ãƒ‰</text>' +
'                <text x="-115" y="-35" text-anchor="end" class="text-xs sm:text-sm font-semibold fill-gray-700">é¡§å®¢æº€è¶³åº¦</text>' +
'            </g>' +
'        </svg>' +
'    </div>' +
'</div>';
}

/**
 * ğŸ”¥ ã‚¨ãƒ©ãƒ¼HTMLç”Ÿæˆ
 */
function generateErrorHTML(errorMessage) {
  return '<!DOCTYPE html>' +
'<html lang="ja">' +
'<head>' +
'    <meta charset="UTF-8">' +
'    <meta name="viewport" content="width=device-width, initial-scale=1.0">' +
'    <title>ã‚¨ãƒ©ãƒ¼ - ãƒšãƒ¼ã‚¸ç”Ÿæˆå¤±æ•—</title>' +
'    <script src="https://cdn.tailwindcss.com"></script>' +
'</head>' +
'<body class="bg-gray-100 flex items-center justify-center min-h-screen">' +
'    <div class="bg-white p-8 rounded-lg shadow-md max-w-md w-full">' +
'        <div class="text-center">' +
'            <h1 class="text-2xl font-bold text-red-600 mb-4">ğŸš¨ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h1>' +
'            <p class="text-gray-600 mb-4">ãƒšãƒ¼ã‚¸ã®ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</p>' +
'            <div class="bg-red-50 border border-red-200 rounded p-4 mb-4">' +
'                <p class="text-sm text-red-800 font-mono">' + errorMessage + '</p>' +
'            </div>' +
'            <p class="text-sm text-gray-500">ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚</p>' +
'        </div>' +
'    </div>' +
'</body>' +
'</html>';
}

/**
 * ğŸ”¥ å¯¾å¿œã‚¨ãƒªã‚¢HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆãƒ»å‹•çš„ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼‰
 */
function generateAreasHtml(areasData, citiesData) {
  if ((!areasData || areasData === '') && (!citiesData || citiesData === '')) {
    return '';
  }

  let prefectures = [];
  let cities = [];

  try {
    if (areasData && areasData !== '') {
      if (typeof areasData === 'string') {
        prefectures = areasData.split(',').map(function(p) { return p.trim(); }).filter(function(p) { return p !== ''; });
      } else if (Array.isArray(areasData)) {
        prefectures = areasData;
      }
    }

    if (citiesData && citiesData !== '') {
      if (typeof citiesData === 'string') {
        cities = citiesData.split(',').map(function(c) { return c.trim(); }).filter(function(c) { return c !== ''; });
      } else if (Array.isArray(citiesData)) {
        cities = citiesData;
      }
    }
  } catch (e) {
    console.log('[generateAreasHtml] ãƒ‘ãƒ¼ã‚¹å¤±æ•—:', e);
  }

  if (prefectures.length === 0 && cities.length === 0) {
    return '';
  }

  let html = '<div id="preview-areas" class="mb-12" style="display: block;">' +
'    <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">' +
'        <span class="w-1 h-6 bg-orange-600 mr-3 rounded"></span>' +
'        å¯¾å¿œã‚¨ãƒªã‚¢' +
'    </h3>' +
'    <div class="bg-white rounded-xl p-6 border border-gray-200">';

  // éƒ½é“åºœçœŒè¡¨ç¤º
  if (prefectures.length > 0) {
    html += '        <div class="mb-6">' +
'            <h4 class="text-lg font-semibold text-gray-800 mb-3">å¯¾å¿œéƒ½é“åºœçœŒ</h4>' +
'            <div class="flex flex-wrap gap-2">';

    prefectures.forEach(function(prefecture) {
      html += '                <span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-lg text-sm font-medium">' + prefecture + '</span>';
    });

    html += '            </div>' +
'        </div>';
  }

  // å¸‚åŒºç”ºæ‘è¡¨ç¤º
  if (cities.length > 0) {
    html += '        <div id="previewCitiesContainer">' +
'            <h4 class="text-lg font-semibold text-gray-800 mb-3">å¯¾å¿œå¸‚åŒºç”ºæ‘</h4>' +
'            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">';

    cities.forEach(function(city) {
      html += '                <div class="bg-gray-50 border border-gray-200 rounded-lg p-3 text-center hover:shadow-md transition">' +
'                    <span class="text-sm font-medium text-gray-700">' + city + '</span>' +
'                </div>';
    });

    html += '            </div>' +
'        </div>';
  }

  // Google MapsåŸ‹ã‚è¾¼ã¿ï¼ˆæœ€åˆã®éƒ½é“åºœçœŒã¾ãŸã¯å¸‚åŒºç”ºæ‘ã‚’ä½¿ç”¨ï¼‰
  const mapLocation = prefectures.length > 0 ? prefectures[0] : (cities.length > 0 ? cities[0] : '');
  if (mapLocation) {
    html += '        <div class="mt-6">' +
'            <h4 class="text-lg font-semibold text-gray-800 mb-3">å¯¾å¿œã‚¨ãƒªã‚¢ãƒãƒƒãƒ—</h4>' +
'            <div class="w-full h-64 bg-gray-200 rounded-lg overflow-hidden">' +
'                <iframe width="100%" height="100%" frameborder="0" style="border:0" ' +
'                    src="https://www.google.com/maps?q=' + encodeURIComponent(mapLocation) + '&output=embed" allowfullscreen="">' +
'                </iframe>' +
'            </div>' +
'        </div>';
  }

  html += '    </div>' +
'</div>';

  return html;
}

/**
 * ğŸ”¥ å†™çœŸã‚®ãƒ£ãƒ©ãƒªãƒ¼HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ã‚³ãƒ”ãƒšãƒ»å‹•çš„ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼‰
 */
function generateGalleryHtml(galleryData) {
  if (!galleryData || galleryData === '') {
    return '';
  }

  let galleryImages = [];
  try {
    if (typeof galleryData === 'string') {
      // JSONæ–‡å­—åˆ—ã¾ãŸã¯å˜ç´”ãªã‚«ãƒ³ãƒåŒºåˆ‡ã‚ŠURLæ–‡å­—åˆ—ã®å ´åˆ
      if (galleryData.startsWith('[') || galleryData.startsWith('{')) {
        galleryImages = JSON.parse(galleryData);
      } else {
        const urls = galleryData.split(',').map(function(url) { return url.trim(); }).filter(function(url) { return url !== ''; });
        galleryImages = urls.map(function(url, index) {
          return {
            url: url,
            title: 'ã‚®ãƒ£ãƒ©ãƒªãƒ¼ç”»åƒ' + (index + 1),
            description: ''
          };
        });
      }
    } else if (Array.isArray(galleryData)) {
      galleryImages = galleryData;
    }
  } catch (e) {
    console.log('[generateGalleryHtml] ãƒ‘ãƒ¼ã‚¹å¤±æ•—:', e);
    // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã¨ã—ã¦å‡¦ç†
    if (typeof galleryData === 'string') {
      const urls = galleryData.split(',').map(function(url) { return url.trim(); }).filter(function(url) { return url !== ''; });
      galleryImages = urls.map(function(url, index) {
        return {
          url: url,
          title: 'ã‚®ãƒ£ãƒ©ãƒªãƒ¼ç”»åƒ' + (index + 1),
          description: ''
        };
      });
    }
  }

  if (galleryImages.length === 0) {
    return '';
  }

  let html = '<div id="preview-gallery" class="mb-12" style="display: block;">' +
'    <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">' +
'        <span class="w-1 h-6 bg-indigo-600 mr-3 rounded"></span>' +
'        å†™çœŸã‚®ãƒ£ãƒ©ãƒªãƒ¼' +
'    </h3>' +
'    <div class="relative">';

  // å·¦ãƒŠãƒ“ãƒœã‚¿ãƒ³
  if (galleryImages.length > 1) {
    html += '        <button onclick="scrollGallery(\'left\')" class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 z-10 bg-white shadow-lg rounded-full p-2 hover:bg-gray-50 transition">' +
'            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
'                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>' +
'            </svg>' +
'        </button>';
  }

  // ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‚«ãƒ«ãƒ¼ã‚»ãƒ«
  html += '        <div id="galleryCarousel" class="overflow-hidden" style="height: 288px;">' +
'            <div id="previewGalleryList" class="flex gap-4 transition-transform duration-300">';

  galleryImages.forEach(function(image, index) {
    const imageUrl = image.url || image.src || image;
    const imageTitle = image.title || ('ã‚®ãƒ£ãƒ©ãƒªãƒ¼ç”»åƒ' + (index + 1));
    const imageDesc = image.description || image.alt || '';

    html += '                <div class="flex-shrink-0 w-72 h-72 bg-white rounded-xl overflow-hidden shadow-md hover:shadow-lg transition group">' +
'                    <div class="relative w-full h-48 bg-gray-200 overflow-hidden">' +
'                        <img src="' + imageUrl + '" alt="' + imageTitle + '" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" onError="this.src=\'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgNTBIMTUwVjE1MEgxMDBWNTBaIiBmaWxsPSIjRDFENURLIi8+CjwvdGc+Cjwvc3ZnPg==\'">' +
'                    </div>' +
'                    <div class="p-4">' +
'                        <h4 class="font-semibold text-gray-900 text-sm mb-1 truncate">' + imageTitle + '</h4>' +
                        (imageDesc ? (
'                        <p class="text-xs text-gray-600 line-clamp-2">' + imageDesc + '</p>'
                        ) : '') +
'                    </div>' +
'                </div>';
  });

  html += '            </div>' +
'        </div>';

  // å³ãƒŠãƒ“ãƒœã‚¿ãƒ³
  if (galleryImages.length > 1) {
    html += '        <button onclick="scrollGallery(\'right\')" class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 z-10 bg-white shadow-lg rounded-full p-2 hover:bg-gray-50 transition">' +
'            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
'                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>' +
'            </svg>' +
'        </button>';
  }

  html += '    </div>';

  // ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼
  if (galleryImages.length > 1) {
    html += '    <div id="galleryIndicators" class="flex justify-center gap-1 mt-4">';
    for (let i = 0; i < Math.min(galleryImages.length, 10); i++) {
      html += '        <button onclick="goToGallerySlide(' + i + ')" class="w-2 h-2 rounded-full bg-gray-300 hover:bg-indigo-500 transition ' + (i === 0 ? 'bg-indigo-600' : '') + '"></button>';
    }
    html += '    </div>';
  }

  html += '    <script>' +
'        let currentGallerySlide = 0;' +
'        const totalGallerySlides = ' + galleryImages.length + ';' +
'        const slideWidth = 288;' +
'        function scrollGallery(direction) {' +
'            const container = document.getElementById("previewGalleryList");' +
'            if (direction === "left") {' +
'                currentGallerySlide = Math.max(0, currentGallerySlide - 1);' +
'            } else {' +
'                currentGallerySlide = Math.min(totalGallerySlides - 1, currentGallerySlide + 1);' +
'            }' +
'            container.style.transform = "translateX(-" + (currentGallerySlide * slideWidth) + "px)";' +
'            updateGalleryIndicators();' +
'        }' +
'        function goToGallerySlide(index) {' +
'            currentGallerySlide = index;' +
'            const container = document.getElementById("previewGalleryList");' +
'            container.style.transform = "translateX(-" + (currentGallerySlide * slideWidth) + "px)";' +
'            updateGalleryIndicators();' +
'        }' +
'        function updateGalleryIndicators() {' +
'            const indicators = document.querySelectorAll("#galleryIndicators button");' +
'            indicators.forEach((indicator, index) => {' +
'                if (index === currentGallerySlide) {' +
'                    indicator.classList.add("bg-indigo-600");' +
'                    indicator.classList.remove("bg-gray-300");' +
'                } else {' +
'                    indicator.classList.add("bg-gray-300");' +
'                    indicator.classList.remove("bg-indigo-600");' +
'                }' +
'            });' +
'        }' +
'    </script>' +
'</div>';

  return html;
}

/**
 * ğŸ”¥ ä¼šç¤¾æ¦‚è¦HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
 */
function generateBasicInfoHtml(companyName, representativeName, address, establishedYear) {
  return '<div id="preview-basicInfo" class="mb-12">' +
'    <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">' +
'        <span class="w-1 h-6 bg-blue-600 mr-3 rounded"></span>' +
'        ä¼šç¤¾æ¦‚è¦' +
'    </h3>' +
'    <div class="bg-gray-50 rounded-xl p-8">' +
'        <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">' +
'            <div id="basicInfo-companyName">' +
'                <dt class="text-sm font-medium text-gray-600">ä¼šç¤¾å</dt>' +
'                <dd id="previewCompanyNameFull" class="mt-1 text-base sm:text-lg text-gray-900 break-words">' + companyName + '</dd>' +
'            </div>' +
            (representativeName ? (
'            <div id="basicInfo-representative">' +
'                <dt class="text-sm font-medium text-gray-600">ä»£è¡¨è€…</dt>' +
'                <dd id="previewRepresentative" class="mt-1 text-lg text-gray-900">' + representativeName + '</dd>' +
'            </div>'
            ) : '') +
            (address ? (
'            <div id="basicInfo-address">' +
'                <dt class="text-sm font-medium text-gray-600">æ‰€åœ¨åœ°</dt>' +
'                <dd id="previewAddress" class="mt-1 text-lg text-gray-900">' + address + '</dd>' +
'            </div>'
            ) : '') +
            (establishedYear ? (
'            <div id="basicInfo-established">' +
'                <dt class="text-sm font-medium text-gray-600">è¨­ç«‹</dt>' +
'                <dd id="previewEstablishedDate" class="mt-1 text-lg text-gray-900">' + establishedYear + '</dd>' +
'            </div>'
            ) : '') +
'        </dl>' +
'    </div>' +
    (address ? (
'    <div class="mt-4" id="basicInfo-map">' +
'        <h4 class="text-sm font-medium text-gray-600 mb-2">ã‚¢ã‚¯ã‚»ã‚¹</h4>' +
'        <div id="googleMapContainer" class="w-full h-64 bg-gray-200 rounded-lg overflow-hidden">' +
'            <iframe width="100%" height="100%" frameborder="0" style="border:0" src="https://www.google.com/maps?q=' + encodeURIComponent(address) + '&output=embed" allowfullscreen="">' +
'            </iframe>' +
'        </div>' +
'    </div>'
    ) : '') +
'</div>';
}

/**
 * ğŸ”¥ ä¿æœ‰è³‡æ ¼HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆãƒ»å‹•çš„ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼‰
 */
function generateQualificationsHtml(qualificationsData) {
  if (!qualificationsData || qualificationsData === '') {
    return '';
  }

  let qualifications = [];
  try {
    if (typeof qualificationsData === 'string') {
      qualifications = qualificationsData.split(',').map(function(q) { return q.trim(); }).filter(function(q) { return q !== ''; });
    } else if (Array.isArray(qualificationsData)) {
      qualifications = qualificationsData;
    }
  } catch (e) {
    console.log('[generateQualificationsHtml] ãƒ‘ãƒ¼ã‚¹å¤±æ•—:', e);
  }

  if (qualifications.length === 0) {
    return '';
  }

  const qualificationIconMap = {
    'å»ºç¯‰å£«': 'ğŸ—ï¸',
    'ä¸€ç´šå»ºç¯‰å£«': 'ğŸ—ï¸',
    'äºŒç´šå»ºç¯‰å£«': 'ğŸ—ï¸',
    'ä¸€ç´šå»ºç¯‰æ–½å·¥ç®¡ç†æŠ€å£«': 'ğŸ‘·',
    'äºŒç´šå»ºç¯‰æ–½å·¥ç®¡ç†æŠ€å£«': 'ğŸ‘·',
    'ä¸€ç´šå¡—è£…æŠ€èƒ½å£«': 'ğŸ¨',
    'äºŒç´šå¡—è£…æŠ€èƒ½å£«': 'ğŸ¨',
    'å¤–å£è¨ºæ–­å£«': 'ğŸ”',
    'é›¨æ¼ã‚Šè¨ºæ–­å£«': 'â˜”',
    'å±‹æ ¹å¤–å£å¡—è£…æŠ€èƒ½å£«': 'ğŸ ',
    'é˜²æ°´æ–½å·¥æŠ€èƒ½å£«': 'ğŸ’§',
    'è¶³å ´çµ„ç«‹ä½œæ¥­ä¸»ä»»è€…': 'âš™ï¸',
    'ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‡ã‚£ãƒãƒ¼ã‚¿ãƒ¼': 'ğŸŒˆ',
    'æœ‰æ©Ÿæº¶å‰¤ä½œæ¥­ä¸»ä»»è€…': 'ğŸ§ª',
    'çŸ³ç¶¿ä½œæ¥­ä¸»ä»»è€…': 'âš ï¸',
    'è·é•·ãƒ»å®‰å…¨è¡›ç”Ÿè²¬ä»»è€…æ•™è‚²ä¿®äº†': 'ğŸ›¡ï¸',
    'ãã®ä»–': 'ğŸ“‹'
  };

  let html = '<div id="preview-qualifications-licenses" class="mb-12">' +
'    <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">' +
'        <span class="w-1 h-6 bg-purple-600 mr-3 rounded"></span>' +
'        ä¿æœ‰è³‡æ ¼' +
'    </h3>' +
'    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">';

  qualifications.forEach(function(qualification) {
    const icon = qualificationIconMap[qualification] || 'ğŸ“‹';
    html += '        <div class="bg-white border border-purple-200 rounded-lg p-4 flex items-center hover:shadow-md transition">' +
'            <span class="text-2xl mr-3 flex-shrink-0">' + icon + '</span>' +
'            <span class="text-sm font-medium text-gray-800">' + qualification + '</span>' +
'        </div>';
  });

  html += '    </div>' +
'</div>';

  return html;
}

/**
 * ğŸ”¥ åŠ å…¥ä¿é™ºHTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆãƒ»å‹•çš„ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼‰
 */
function generateInsuranceHtml(insuranceData) {
  if (!insuranceData || insuranceData === '') {
    return '';
  }

  let insuranceList = [];
  try {
    if (typeof insuranceData === 'string') {
      insuranceList = insuranceData.split(',').map(function(i) { return i.trim(); }).filter(function(i) { return i !== ''; });
    } else if (Array.isArray(insuranceData)) {
      insuranceList = insuranceData;
    }
  } catch (e) {
    console.log('[generateInsuranceHtml] ãƒ‘ãƒ¼ã‚¹å¤±æ•—:', e);
  }

  if (insuranceList.length === 0) {
    return '';
  }

  const insuranceIconMap = {
    'å»ºè¨­å·¥äº‹ä¿é™º': 'ğŸ—ï¸',
    'è«‹è² æ¥­è€…è³ å„Ÿè²¬ä»»ä¿é™º': 'ğŸ›¡ï¸',
    'ç”Ÿç”£ç‰©è³ å„Ÿè²¬ä»»ä¿é™º': 'ğŸ“¦',
    'æ–½è¨­è³ å„Ÿè²¬ä»»ä¿é™º': 'ğŸ¢',
    'ç«ç½ä¿é™º': 'ğŸ”¥',
    'åŠ´ç½ä¿é™º': 'ğŸ‘·',
    'é›‡ç”¨ä¿é™º': 'ğŸ’¼',
    'å¥åº·ä¿é™º': 'ğŸ¥',
    'åšç”Ÿå¹´é‡‘ä¿é™º': 'ğŸ’°',
    'PLä¿é™º': 'âš–ï¸',
    'æå®³ä¿é™º': 'ğŸ›¡ï¸',
    'ãã®ä»–': 'ğŸ“‹'
  };

  let html = '<div id="preview-insurance" class="mb-12">' +
'    <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">' +
'        <span class="w-1 h-6 bg-red-600 mr-3 rounded"></span>' +
'        åŠ å…¥ä¿é™º' +
'    </h3>' +
'    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">';

  insuranceList.forEach(function(insurance) {
    const icon = insuranceIconMap[insurance] || 'ğŸ“‹';
    html += '        <div class="bg-white border border-red-200 rounded-lg p-4 flex items-center hover:shadow-md transition">' +
'            <span class="text-2xl mr-3 flex-shrink-0">' + icon + '</span>' +
'            <span class="text-sm font-medium text-gray-800">' + insurance + '</span>' +
'        </div>';
  });

  html += '    </div>' +
'</div>';

  return html;
}

/**
 * ğŸ”¥ ä¼šç¤¾ã®ç‰¹å¾´ãƒ»å¼·ã¿HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆãƒ»å®Œå…¨å‹•çš„ï¼‰
 */
function generateCompanyStrengthHtml(prText) {
  if (!prText) return '';

  return '<div id="preview-company-strength" class="mb-12">' +
'    <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">' +
'        <span class="w-1 h-6 bg-yellow-500 mr-3 rounded"></span>' +
'        ä¼šç¤¾ã®ç‰¹å¾´ãƒ»å¼·ã¿' +
'    </h3>' +
'    <div class="bg-gradient-to-br from-yellow-50 to-orange-50 rounded-xl p-8 border border-yellow-200">' +
'        <p class="text-gray-700 leading-relaxed">' + prText + '</p>' +
'    </div>' +
'</div>';
}

/**
 * ğŸ”¥ å½“ç¤¾ã®å¼·ã¿9ã¤ã®ã‚«ãƒ¼ãƒ‰HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
 */
function generateCompanyStrengthsSection() {
  const strengths = [
    {
      icon: 'ğŸ‘¨â€ğŸ”§',
      title: 'æŠ€è¡“åŠ›ãƒ»è·äººã®æŠ€',
      description: 'é•·å¹´ã®çµŒé¨“ã‚’ç©ã‚“ã ç†Ÿç·´è·äººã«ã‚ˆã‚‹ç¢ºã‹ãªæŠ€è¡“ã§ã€é«˜å“è³ªãªæ–½å·¥ã‚’ãŠç´„æŸã—ã¾ã™ã€‚'
    },
    {
      icon: 'ğŸ’°',
      title: 'é©æ­£ä¾¡æ ¼ãƒ»é€æ˜æ€§',
      description: 'æ˜ç¢ºãªè¦‹ç©ã‚‚ã‚Šã¨é©æ­£ä¾¡æ ¼ã§ã€ãŠå®¢æ§˜ã«å®‰å¿ƒã—ã¦ã”ä¾é ¼ã„ãŸã ã‘ã‚‹æ–™é‡‘ä½“ç³»ã§ã™ã€‚'
    },
    {
      icon: 'ğŸ†',
      title: 'å®Ÿç¸¾ãƒ»ä¿¡é ¼',
      description: 'æ•°å¤šãã®æ–½å·¥å®Ÿç¸¾ã¨é«˜ã„ãŠå®¢æ§˜æº€è¶³åº¦ã§ã€åœ°åŸŸã§ã®ä¿¡é ¼ã‚’ç©ã¿é‡ã­ã¦ãã¾ã—ãŸã€‚'
    },
    {
      icon: 'ğŸ›¡ï¸',
      title: 'ä¿è¨¼ãƒ»ã‚¢ãƒ•ã‚¿ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹',
      description: 'æ–½å·¥å¾Œã®ä¿è¨¼æœŸé–“ã¨ã‚¢ãƒ•ã‚¿ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ã§ã€é•·æœŸã«ã‚ãŸã£ã¦ãŠå®¢æ§˜ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚'
    },
    {
      icon: 'ğŸ“',
      title: 'è¿…é€Ÿå¯¾å¿œãƒ»è¦ªèº«ãªç›¸è«‡',
      description: 'ãŠå®¢æ§˜ã®ã”ç›¸è«‡ã«ã¯è¿…é€Ÿã‹ã¤è¦ªèº«ã«å¯¾å¿œã—ã€æœ€é©ãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã”ææ¡ˆã—ã¾ã™ã€‚'
    },
    {
      icon: 'ğŸ”',
      title: 'è©³ç´°è¨ºæ–­ãƒ»ææ¡ˆåŠ›',
      description: 'å°‚é–€çš„ãªè¨ºæ–­æŠ€è¡“ã§å»ºç‰©ã®çŠ¶æ…‹ã‚’æ­£ç¢ºã«æŠŠæ¡ã—ã€æœ€é©ãªæ–½å·¥ãƒ—ãƒ©ãƒ³ã‚’ã”ææ¡ˆã—ã¾ã™ã€‚'
    },
    {
      icon: 'ğŸŒ±',
      title: 'ç’°å¢ƒé…æ…®ãƒ»çœã‚¨ãƒ',
      description: 'ç’°å¢ƒã«é…æ…®ã—ãŸææ–™é¸æŠã¨çœã‚¨ãƒåŠ¹æœã®é«˜ã„æ–½å·¥ã§ã€æŒç¶šå¯èƒ½ãªä½ç’°å¢ƒã‚’å®Ÿç¾ã—ã¾ã™ã€‚'
    },
    {
      icon: 'âš¡',
      title: 'æœ€æ–°æŠ€è¡“ãƒ»ææ–™',
      description: 'æ¥­ç•Œæœ€æ–°ã®æŠ€è¡“ã¨é«˜å“è³ªãªææ–™ã‚’ä½¿ç”¨ã—ã€è€ä¹…æ€§ã¨ç¾è¦³ã‚’å…¼ã­å‚™ãˆãŸæ–½å·¥ã‚’è¡Œã„ã¾ã™ã€‚'
    },
    {
      icon: 'ğŸ‘¥',
      title: 'åœ°åŸŸå¯†ç€ãƒ»é•·æœŸé–¢ä¿‚',
      description: 'åœ°åŸŸã«æ ¹ã–ã—ãŸä¼æ¥­ã¨ã—ã¦ã€ãŠå®¢æ§˜ã¨ã®é•·æœŸçš„ãªä¿¡é ¼é–¢ä¿‚ã‚’å¤§åˆ‡ã«ã—ã¦ã„ã¾ã™ã€‚'
    }
  ];

  let html = '<div id="preview-company-strengths-cards" class="mb-12">' +
'    <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">' +
'        <span class="w-1 h-6 bg-green-600 mr-3 rounded"></span>' +
'        å½“ç¤¾ã®å¼·ã¿' +
'    </h3>' +
'    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">';

  strengths.forEach(function(strength) {
    html += '        <div class="bg-white rounded-xl p-6 shadow-md hover:shadow-lg transition border border-green-100">' +
'            <div class="flex items-center mb-4">' +
'                <span class="text-3xl mr-3 flex-shrink-0">' + strength.icon + '</span>' +
'                <h4 class="font-bold text-gray-900 text-base">' + strength.title + '</h4>' +
'            </div>' +
'            <p class="text-sm text-gray-600 leading-relaxed">' + strength.description + '</p>' +
'        </div>';
  });

  html += '    </div>' +
'</div>';

  return html;
}

/**
 * ğŸ”¥ æ”¯åº—ãƒãƒƒãƒ—HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆãƒ»å‹•çš„ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼‰
 */
function generateBranchMapsHtml(branchesData) {
  if (!branchesData || branchesData === '') {
    return '';
  }

  let branches = [];
  try {
    if (typeof branchesData === 'string') {
      // JSONæ–‡å­—åˆ—ã®å ´åˆ
      if (branchesData.startsWith('[') || branchesData.startsWith('{')) {
        branches = JSON.parse(branchesData);
      } else {
        // ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã®å ´åˆã¯åŸºæœ¬çš„ãªæ”¯åº—åã®ã¿ã¨ä»®å®š
        const branchNames = branchesData.split(',').map(function(b) { return b.trim(); }).filter(function(b) { return b !== ''; });
        branches = branchNames.map(function(name) {
          return {
            name: name,
            address: name, // åœ°å›³æ¤œç´¢ç”¨
            phone: '',
            hours: ''
          };
        });
      }
    } else if (Array.isArray(branchesData)) {
      branches = branchesData;
    }
  } catch (e) {
    console.log('[generateBranchMapsHtml] ãƒ‘ãƒ¼ã‚¹å¤±æ•—:', e);
  }

  if (branches.length === 0) {
    return '';
  }

  let html = '<div id="preview-branch-maps" class="mb-12">' +
'    <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">' +
'        <span class="w-1 h-6 bg-teal-600 mr-3 rounded"></span>' +
'        æ”¯åº—ãƒ»åº—èˆ—ãƒãƒƒãƒ—' +
'    </h3>' +
'    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">';

  branches.forEach(function(branch) {
    const branchName = branch.name || branch.branchName || '';
    const branchAddress = branch.address || branch.location || branchName;
    const branchPhone = branch.phone || branch.tel || '';
    const branchHours = branch.hours || branch.businessHours || '';

    html += '        <div class="bg-white rounded-xl overflow-hidden shadow-md hover:shadow-lg transition border border-teal-100">' +
'            <div class="h-48 bg-gray-200 relative overflow-hidden">' +
'                <iframe width="100%" height="100%" frameborder="0" style="border:0" ' +
'                    src="https://www.google.com/maps?q=' + encodeURIComponent(branchAddress + ',ç¥å¥ˆå·çœŒ') + '&output=embed&z=15" allowfullscreen="">' +
'                </iframe>' +
'            </div>' +
'            <div class="p-4">' +
'                <h4 class="font-bold text-gray-900 text-lg mb-2 flex items-center">' +
'                    <span class="text-teal-600 mr-2">ğŸ“</span>' +
                    branchName +
'                </h4>' +
                (branchAddress && branchAddress !== branchName ? (
'                <p class="text-sm text-gray-600 mb-2">' +
'                    <span class="text-gray-500">ğŸ“</span> ' + branchAddress +
'                </p>'
                ) : '') +
                (branchPhone ? (
'                <p class="text-sm text-gray-600 mb-2">' +
'                    <span class="text-gray-500">ğŸ“</span> ' + branchPhone +
'                </p>'
                ) : '') +
                (branchHours ? (
'                <p class="text-sm text-gray-600 mb-3">' +
'                    <span class="text-gray-500">ğŸ•</span> ' + branchHours +
'                </p>'
                ) : '') +
'                <div class="flex gap-2">' +
'                    <a href="https://www.google.com/maps?q=' + encodeURIComponent(branchAddress + ',ç¥å¥ˆå·çœŒ') + '" target="_blank" ' +
'                       class="flex-1 bg-teal-100 hover:bg-teal-200 text-teal-800 text-xs px-3 py-2 rounded-md text-center transition font-medium">' +
'                        åœ°å›³ã‚’é–‹ã' +
'                    </a>' +
                    (branchPhone ? (
'                    <a href="tel:' + branchPhone + '" ' +
'                       class="flex-1 bg-blue-100 hover:bg-blue-200 text-blue-800 text-xs px-3 py-2 rounded-md text-center transition font-medium">' +
'                        é›»è©±ã™ã‚‹' +
'                    </a>'
                    ) : '') +
'                </div>' +
'            </div>' +
'        </div>';
  });

  html += '    </div>' +
'</div>';

  return html;
}

/**
 * ğŸ”¥ ãŠå•ã„åˆã‚ã›ã‚»ã‚¯ã‚·ãƒ§ãƒ³HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆãƒ»ã‚³ãƒ”ãƒšï¼‰
 */
function generateContactHtml(phone, email) {
  if (!phone && !email) return '';

  return '<div id="preview-contact" class="mb-12">' +
'        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">' +
'            <span class="w-1 h-6 bg-purple-600 mr-3 rounded"></span>' +
'            ãŠå•ã„åˆã‚ã›' +
'        </h3>' +
'        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">' +
(phone ? (
'            <div class="bg-white border rounded-xl p-4 hover:shadow-lg transition">' +
'                <div class="flex items-center mb-2">' +
'                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">' +
'                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
'                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>' +
'                        </svg>' +
'                    </div>' +
'                    <div>' +
'                        <p class="text-sm text-gray-600">ãŠé›»è©±ã§ã®ãŠå•ã„åˆã‚ã›</p>' +
'                        <a href="tel:' + phone + '" class="text-lg font-semibold text-blue-600 hover:text-blue-800 cursor-pointer transition-colors">' + phone + '</a>' +
'                        <p class="text-xs text-gray-500">å—ä»˜æ™‚é–“: 9:00-18:00ï¼ˆå¹´ä¸­ç„¡ä¼‘ï¼‰</p>' +
'                    </div>' +
'                </div>' +
'            </div>'
) : '') +
(email ? (
'            <div class="bg-white border rounded-xl p-4 hover:shadow-lg transition">' +
'                <div class="flex items-center mb-2">' +
'                    <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3">' +
'                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
'                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>' +
'                        </svg>' +
'                    </div>' +
'                    <div class="overflow-hidden min-w-0">' +
'                        <p class="text-sm text-gray-600">ãƒ¡ãƒ¼ãƒ«ã§ã®ãŠå•ã„åˆã‚ã›</p>' +
'                        <a href="mailto:' + email + '" class="text-sm sm:text-base font-semibold text-blue-600 hover:text-blue-800 break-all cursor-pointer transition-colors">' + email + '</a>' +
'                        <p class="text-xs text-gray-500">24æ™‚é–“å—ä»˜ä¸­</p>' +
'                    </div>' +
'                </div>' +
'            </div>'
) : '') +
'        </div>' +
'    </div>';
}

/**
 * ğŸ”¥ æ–½å·¥äº‹ä¾‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆãƒ»ã‚³ãƒ”ãƒšï¼‰
 */
function generateExamplesHtml(examplesData) {
  // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‹ã‚‰å®Œå…¨ã‚³ãƒ”ãƒšï¼ˆ6036-6065è¡Œï¼‰
  return '<div id="preview-examples" class="mb-12" style="display: block;">' +
'        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">' +
'            <span class="w-1 h-6 bg-pink-600 mr-3 rounded"></span>' +
'            æ–½å·¥äº‹ä¾‹' +
'        </h3>' +
'        <!-- ã‚«ãƒ«ãƒ¼ã‚»ãƒ«ã‚³ãƒ³ãƒ†ãƒŠ -->' +
'        <div class="relative">' +
'            <!-- å·¦çŸ¢å° -->' +
'            <button onclick="scrollExamples(\'left\')" class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 z-10 bg-white shadow-lg rounded-full p-2 hover:bg-gray-50 transition">' +
'                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
'                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>' +
'                </svg>' +
'            </button>' +
'            <!-- æ–½å·¥äº‹ä¾‹ã‚«ãƒ«ãƒ¼ã‚»ãƒ« -->' +
'            <div id="examplesCarousel" class="overflow-hidden" style="min-height: 400px;">' +
'                <div id="previewExamplesList" class="flex gap-4 transition-transform duration-300">' +
'                    <!-- æ–½å·¥äº‹ä¾‹ã¯ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å‹•çš„ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ -->' +
'                </div>' +
'            </div>' +
'            <!-- å³çŸ¢å° -->' +
'            <button onclick="scrollExamples(\'right\')" class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 z-10 bg-white shadow-lg rounded-full p-2 hover:bg-gray-50 transition">' +
'                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
'                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>' +
'                </svg>' +
'            </button>' +
'        </div>' +
'        <!-- ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->' +
'        <div id="examplesIndicators" class="flex justify-center gap-1 mt-4">' +
'            <button onclick="goToExample(0)" class="w-2 h-2 rounded-full transition bg-blue-600"></button>' +
'        </div>' +
'    </div>';
}
