# Feature Specification: 加盟店管理画面（管理者版）

**Feature Branch**: `001-franchise-admin-dashboard`  
**Created**: 2025-01-09  
**Status**: Draft  
**Input**: 加盟店向け管理画面（管理者アカウント用）- 案件管理、営業管理、請求管理、設定管理を含むレスポンシブWebアプリケーション

## Execution Flow (main)
```
1. Parse user description from Input
   → 加盟店管理者向けの総合管理画面
2. Extract key concepts from description
   → Actors: 管理者（代表者/管理責任者）、営業担当者、運営
   → Actions: 案件管理、営業管理、請求確認、設定変更
   → Data: 案件情報、営業実績、請求データ、会社情報
   → Constraints: 権限管理、月間上限、キャンセル制限
3. For each unclear aspect:
   → All aspects clearly defined in specification
4. Fill User Scenarios & Testing section
   → Complete user flows defined
5. Generate Functional Requirements
   → All requirements testable and specific
6. Identify Key Entities
   → 案件、営業アカウント、請求、会社情報
7. Run Review Checklist
   → All items checked
8. Return: SUCCESS (spec ready for planning)
```

---

## ⚡ Quick Guidelines
- ✅ Focus on WHAT users need and WHY
- ❌ Avoid HOW to implement (no tech stack, APIs, code structure)
- 👥 Written for business stakeholders, not developers

---

## User Scenarios & Testing

### Primary User Story
加盟店の管理者として、私は全ての案件状況を一元管理し、営業担当者への振り分けや進捗管理を行い、月次の請求確認と実績分析を通じて事業の最適化を図りたい。

### Acceptance Scenarios
1. **Given** ログイン画面を開いている, **When** 正しいメールアドレスとパスワードを入力, **Then** ダッシュボードにリダイレクトされ、ユーザー名が右上に表示される
2. **Given** 管理者としてログインしている, **When** ダッシュボードを開く, **Then** 本日の新規案件数、対応中案件数、今月の成約数、デポジット残高が表示される
2. **Given** 新規案件が届いた, **When** 案件管理画面を開く, **Then** 未対応案件としてリスト最上部に表示され、営業担当者を割り当てることができる
3. **Given** 営業担当者が退職した, **When** 営業管理画面でアカウントを停止, **Then** 担当案件が他の営業担当者に再割り当て可能になる
4. **Given** 月末になった, **When** 請求・実績画面を開く, **Then** 当月の紹介料と成約報酬が自動計算され、請求書がダウンロードできる
5. **Given** 対応エリアを変更したい, **When** 設定画面でエリアを追加/削除, **Then** 新規案件の配信エリアが即座に更新される

### Edge Cases
- 3日以上未対応の案件がある場合、ダッシュボードに緊急対応案件として赤色表示される
- デポジット残高が3件以下になった場合、入金申請を促す警告が表示される
- 月間キャンセルが3件を超えた場合、4件目から有料キャンセル扱いとなる警告が出る
- 営業担当者が全員離席中の場合、新規案件は管理者に直接通知される

## Requirements

### Functional Requirements

#### 認証・ログイン機能
- **FR-001**: システムはメールアドレスとパスワードによるログイン機能を提供しなければならない
- **FR-002**: システムは初回ログイン時にパスワード変更を要求しなければならない
- **FR-003**: システムはパスワードリセット機能（メール送信）を提供しなければならない
- **FR-004**: システムはセッションタイムアウト（30分無操作）を実装しなければならない
- **FR-005**: システムは「ログイン状態を保持」オプション（30日間）を提供しなければならない
- **FR-006**: システムは3回連続ログイン失敗時に5分間アカウントをロックしなければならない

#### ダッシュボード機能
- **FR-007**: システムは本日の新規案件数をリアルタイムで表示しなければならない
- **FR-008**: システムは対応中案件をステータス別にカウント表示しなければならない
- **FR-009**: システムは今月の成約数と成約金額を表示しなければならない
- **FR-010**: システムはデポジット残高を件数と金額で表示しなければならない
- **FR-011**: システムは直近7日間の案件推移をグラフ表示しなければならない
- **FR-012**: システムは3日以上未対応の案件を緊急対応案件として強調表示しなければならない

#### 案件管理機能
- **FR-013**: システムは案件をカード型/リスト型で切替表示できなければならない
- **FR-014**: システムは案件をステータス、営業担当、期間、エリアでフィルタリングできなければならない
- **FR-015**: システムは案件カードから直接電話発信ができなければならない（タップで電話アプリ起動）
- **FR-016**: システムは案件カードからSMS送信ができなければならない
- **FR-017**: システムは案件の担当者を変更できなければならない
- **FR-018**: システムは案件に5段階の温度感ラベルを設定できなければならない
- **FR-019**: システムは案件に最大500文字のメモを追加できなければならない
- **FR-020**: システムは案件に画像（JPG/PNG/HEIF）と書類（PDF/Excel）を最大10MBまで添付できなければならない
- **FR-021**: システムは全ての操作履歴（架電、SMS、ステータス変更）をタイムスタンプ付きで記録しなければならない

#### 案件ステータス管理
- **FR-022**: システムは以下の10種類のステータスを管理しなければならない：未対応、架電済_未アポ、アポ済、現調済、現調前キャンセル、見積提出済、成約、入金予定、入金済、失注
- **FR-023**: システムはステータス変更時に変更理由の入力を求めなければならない
- **FR-024**: システムはアポ済ステータス時にGoogleカレンダーと自動連携しなければならない

#### 営業管理機能
- **FR-019**: システムは営業担当者の一覧を表示し、各担当の案件数と成約数を表示しなければならない
- **FR-020**: システムは新規営業アカウントをメールアドレス入力で発行できなければならない
- **FR-021**: システムは営業アカウントの編集（名前、電話番号、通知設定）ができなければならない
- **FR-022**: システムは営業アカウントの停止/削除と同時に案件の再割り当てができなければならない
- **FR-023**: システムは案件をドラッグ&ドロップで営業担当者に割り当てできなければならない
- **FR-024**: システムは自動割り当てのON/OFF切替と、エリア別/順番のルール設定ができなければならない
- **FR-025**: システムは営業担当者1人あたりの最大案件数を設定できなければならない

#### 請求・実績管理機能
- **FR-026**: システムはデポジット残高と消費履歴を表示しなければならない
- **FR-027**: システムは入金申請フォームを提供しなければならない
- **FR-028**: システムは月次請求（紹介料2万円×成約数、成約報酬工事金額の10%）を自動計算しなければならない
- **FR-029**: システムは請求書をPDF形式でダウンロードできなければならない
- **FR-030**: システムは直近3ヶ月の平均成約金額、合計成約金額、成約率を表示しなければならない
- **FR-031**: システムは4種類のランキング（成約数、成約金額、成約率、対応速度）での順位を表示しなければならない

#### キャンセル申請機能
- **FR-032**: システムはアポ済以降のステータスでキャンセル申請を受け付けなければならない
- **FR-033**: システムはキャンセル理由の選択（顧客都合、他社決定、予算不適合、時期延期、その他）と詳細説明の入力を必須としなければならない
- **FR-034**: システムはキャンセル申請を運営に自動通知しなければならない
- **FR-035**: システムは月3件までのキャンセルを無料とし、4件目以降を有料として警告表示しなければならない

#### 案件パス機能
- **FR-036**: システムは案件を他の営業担当者にパス（引き継ぎ）できなければならない
- **FR-037**: システムはパス時に引き継ぎメモの入力を必須としなければならない
- **FR-038**: システムはパス先の営業担当者に承認依頼通知を送信しなければならない
- **FR-039**: システムは24時間以内の承認/拒否を管理しなければならない

#### 設定管理機能
- **FR-040**: システムは会社情報（会社名、代表者名、法人番号、所在地）を表示・編集できなければならない
- **FR-041**: システムは対応エリアの追加/削除と最優先エリア（最大3つ）の設定ができなければならない
- **FR-042**: システムは対応可能な築年数、施工内容、物件種別を設定できなければならない
- **FR-043**: システムは自動配信のON/OFF、月間上限、一時休止を設定できなければならない
- **FR-044**: システムは通知方法（SMS/LINE/メール）と通知タイミングを設定できなければならない

#### 自動化機能
- **FR-045**: システムは未対応案件が3日経過したら管理者と担当者に警告通知を送信しなければならない
- **FR-046**: システムはアポ確定時に前日と当日にリマインダーを送信しなければならない
- **FR-047**: システムは現調完了2時間後にステータス変更を促すポップアップを表示しなければならない
- **FR-048**: システムは現調後7日経過で見積未提出の警告を表示しなければならない
- **FR-049**: システムは成約時に運営への自動通知と請求処理の自動計算を実行しなければならない

#### レスポンシブ対応
- **FR-050**: システムはスマートフォン、タブレット、PCの各画面サイズに最適化された表示をしなければならない
- **FR-051**: システムはモバイル端末でスワイプ操作による画面遷移に対応しなければならない
- **FR-052**: システムはモバイル端末で電話番号タップによる直接発信に対応しなければならない

### Key Entities
- **案件（Case）**: 顧客からの問い合わせ情報、物件情報、ステータス、担当者、履歴を持つ
- **営業アカウント（SalesAccount）**: 営業担当者の情報、権限、担当案件、実績を持つ
- **管理者アカウント（AdminAccount）**: 全権限を持つ管理責任者、会社情報の編集権限を持つ
- **請求（Invoice）**: 月次の紹介料、成約報酬、デポジット消費の情報を持つ
- **会社情報（Company）**: 加盟店の基本情報、契約情報、対応エリア、設定情報を持つ
- **通知（Notification）**: 各種アラート、リマインダー、レポートの配信情報を持つ

---

## Review & Acceptance Checklist

### Content Quality
- [x] No implementation details (languages, frameworks, APIs)
- [x] Focused on user value and business needs
- [x] Written for non-technical stakeholders
- [x] All mandatory sections completed

### Requirement Completeness
- [x] No [NEEDS CLARIFICATION] markers remain
- [x] Requirements are testable and unambiguous
- [x] Success criteria are measurable
- [x] Scope is clearly bounded
- [x] Dependencies and assumptions identified

---

## Execution Status

- [x] User description parsed
- [x] Key concepts extracted
- [x] Ambiguities marked (none found)
- [x] User scenarios defined
- [x] Requirements generated
- [x] Entities identified
- [x] Review checklist passed

---