<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Â§ñÂ£ÅÂ°óË£Ö„Åè„Çâ„Åπ„Çã - „Ç≠„Éº„ÉØ„Éº„Éâ„ÉÜ„Çπ„ÉàLP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* „Éï„Ç©„É≥„ÉàË®≠ÂÆö */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700;800&display=swap');

        body {
            font-family: 'Noto Sans JP', 'Hiragino Sans', 'Yu Gothic', sans-serif;
            font-weight: 400;
            line-height: 1.6;
        }

        /* „Çø„Ç§„Éî„É≥„Ç∞„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        .typing-animation {
            border-right: 2px solid #7B9BF0;
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 50% { border-color: #7B9BF0; }
            51%, 100% { border-color: transparent; }
        }

        /* ÈÉµ‰æøÁï™Âè∑„Éï„Ç©„Éº„É† ÂÖâ„Çã„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.3), 0 0 40px rgba(59, 130, 246, 0.1);
            }
            50% {
                box-shadow: 0 0 30px rgba(59, 130, 246, 0.5), 0 0 60px rgba(59, 130, 246, 0.2);
            }
        }

        /* AI„É°„ÉÉ„Çª„Éº„Ç∏ */
        .ai-message {
            background: linear-gradient(135deg, #7B9BF0 0%, #9EBDFD 100%);
            color: white;
            border-radius: 24px 24px 24px 4px;
            padding: 16px 20px;
            margin: 0;
            margin-left: -4px;
            max-width: 80%;
            word-wrap: break-word;
            font-size: 16px;
            line-height: 1.6;
            font-weight: 400;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            position: relative;
        }

        .ai-message-container {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin: 20px 0;
            padding-left: 12px;
        }

        .ai-message-container.new-message {
            animation: fadeIn 1s ease-out;
        }

        .ai-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            object-fit: cover;
            object-position: center center;
            flex-shrink: 0;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            z-index: 1;
        }

        /* „É¢„Éê„Ç§„É´Áî®Ë™øÊï¥ */
        @media (max-width: 640px) {
            .ai-avatar {
                width: 48px;
                height: 48px;
            }
        }

        /* „É¶„Éº„Ç∂„Éº„É°„ÉÉ„Çª„Éº„Ç∏ */
        .user-message {
            background: #F5F5F5;
            color: #2D3748;
            border-radius: 24px 24px 4px 24px;
            padding: 16px 20px;
            margin: 20px 0;
            max-width: 80%;
            margin-left: auto;
            font-size: 16px;
            line-height: 1.6;
            font-weight: 400;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            position: relative;
        }

        /* „É¶„Éº„Ç∂„Éº„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÂ∞ªÂ∞æ */
        .user-message::after {
            content: '';
            position: absolute;
            right: -6px;
            top: 20px;
            width: 12px;
            height: 12px;
            background: #F5F5F5;
            transform: rotate(45deg);
            z-index: -1;
            box-shadow: 2px 2px 3px rgba(0,0,0,0.05);
        }

        /* Êó¢Ë™≠Ë°®Á§∫ */
        .message-read {
            font-size: 11px;
            color: #9CA3AF;
            text-align: right;
            margin-top: 4px;
            margin-right: 8px;
        }

        /* ÈÅ∏ÊäûËÇ¢„Éú„Çø„É≥ */
        .choice-btn {
            border: 2px solid #E2E8F0;
            background: white;
            color: #4A5568;
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            margin: 4px 0;
            min-height: 56px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            text-align: left;
            animation: fadeIn 1s ease-out;
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            pointer-events: auto;
        }

        .choice-btn:hover {
            background: #F7FAFC;
            border-color: #7B9BF0;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(123, 155, 240, 0.15);
        }

        .choice-btn:active {
            background: rgba(123, 155, 240, 0.1);
            transform: translateY(0);
            transition: all 0.1s ease;
        }

        .choice-btn.selected {
            background: rgba(123, 155, 240, 0.2);
            border-color: #7B9BF0;
            animation: buttonPress 1s ease-out;
        }

        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes buttonPress {
            0% { transform: scale(1); }
            50% { transform: scale(0.98); }
            100% { transform: scale(1); }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .choices-container {
            animation: fadeIn 1s ease-out;
            position: relative;
            z-index: 10;
            touch-action: manipulation;
        }

        /* „Çø„Ç§„Éî„É≥„Ç∞„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº */
        .typing-dots {
            display: inline-flex;
            gap: 2px;
        }

        .typing-dots span {
            width: 6px;
            height: 6px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            animation: typingDots 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingDots {
            0%, 60%, 100% {
                opacity: 0.3;
                transform: scale(0.8);
            }
            30% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* „Åù„ÅÆ‰ªñ */
        .mosaic {
            filter: blur(8px);
            transition: filter 0.5s ease;
        }

        /* ÈõªË©±Áï™Âè∑ÂÖ•Âäõ„Éü„Éã„Éï„Ç©„Éº„É† */
        .phone-mini-form {
            background: linear-gradient(135deg, #E0F2FE, #BAE6FD);
            border-radius: 16px;
            padding: 24px;
            margin: 20px 0;
            animation: fadeIn 0.5s ease-out;
        }

        /* ÁîªÂÉè„Çπ„É©„Ç§„Éâ„Ç∑„Éß„Éº */
        .elderly-slideshow {
            width: 100%;
            height: 170px;
            margin: 16px 0;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .elderly-slideshow img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            position: absolute;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .elderly-slideshow img.active {
            opacity: 1;
        }

        .phone-mini-form .form-title {
            font-size: 14px;
            font-weight: 600;
            color: #2D3748;
            margin-bottom: 16px;
        }

        .phone-input-wrapper {
            background: white;
            border: 3px solid #FFD700;
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 12px;
        }

        .phone-input {
            width: 100%;
            padding: 12px;
            font-size: 18px;
            border: none;
            outline: none;
            text-align: center;
            font-weight: 500;
        }

        .phone-input::placeholder {
            color: #D1D5DB;
        }

        .phone-submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #7B9BF0, #9EBDFD);
            color: white;
            padding: 14px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            outline: none;
        }

        .phone-submit-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #6B8BE0, #8EADED);
            transform: translateY(-1px);
        }

        .phone-submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ÂæÖÊ©ü‰∏≠„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        .waiting-animation {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            position: relative;
            height: 120px;
        }

        .waiting-character {
            width: 180px;
            height: auto;
            position: absolute;
            opacity: 0;
            animation: slideshow 3s infinite;
        }

        .waiting-character:nth-child(1) {
            animation-delay: 0s;
        }

        .waiting-character:nth-child(2) {
            animation-delay: 1s;
        }

        .waiting-character:nth-child(3) {
            animation-delay: 2s;
        }

        @keyframes slideshow {
            0% {
                opacity: 0;
                transform: scale(0.95);
            }
            10%, 30% {
                opacity: 1;
                transform: scale(1);
            }
            40% {
                opacity: 0;
                transform: scale(0.95);
            }
            100% {
                opacity: 0;
                transform: scale(0.95);
            }
        }

        .phone-error {
            color: #EF4444;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }

        .phone-error.show {
            display: block;
        }

        .ranking-card {
            transition: all 0.3s ease;
        }

        .ranking-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        /* „Ç≠„Éº„Éó„Éú„Çø„É≥ */
        .keep-btn {
            background: #FEF3C7;
            color: #92400E;
            transition: all 0.3s;
        }

        .keep-btn:hover {
            background: #FDE68A;
        }

        .keep-btn.active {
            background: #F59E0B;
            color: white;
            font-weight: 600;
        }

        .keep-btn.active .keep-text::before {
            content: '„Ç≠„Éº„Éó‰∏≠';
        }

        .keep-btn.active .keep-text > span {
            display: none;
        }

        /* „Éú„Çø„É≥„Çµ„Ç§„Ç∫Âõ∫ÂÆö */
        .keep-btn, .detail-btn {
            min-width: 80px;
            white-space: nowrap;
        }

        /* „Çπ„ÇØ„É≠„Éº„É´„ÇíÂº∑Âà∂ÁöÑ„Å´ÊúâÂäπÂåñ */
        html {
            overflow-y: scroll !important;
            height: auto !important;
        }

        body {
            overflow-y: visible !important;
            height: auto !important;
            position: relative !important;
        }

        /* Âõ∫ÂÆöË¶ãÁ©ç„ÇÇ„Çä„Éú„Çø„É≥ */
        .fixed-estimate-btn {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: linear-gradient(135deg, #3B82F6, #60A5FA);
            padding: 16px 32px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            color: white;
            font-weight: 600;
            font-size: 16px;
            border: none;
            cursor: pointer;
            display: none;
            animation: slideUp 0.3s ease-out;
        }

        .fixed-estimate-btn:hover {
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.3);
        }

        /* ÈÄöÁü•„Éê„ÉÉ„Ç∏ */
        .notification-badge {
            position: absolute;
            top: -12px;
            right: -12px;
            background: #EF4444;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* „ÉÜ„Éº„Éû„Ç´„É©„Éº */
        .ranking-section[data-theme="blue"] {
            background-color: #EBF8FF;
        }

        .ranking-section[data-theme="orange"] {
            background-color: #FFF5EB;
        }

        .ranking-section[data-theme="green"] {
            background-color: #F0FDF4;
        }

        .ranking-section[data-theme="purple"] {
            background-color: #FAF5FF;
        }

        /* „Ç≠„Éº„ÉØ„Éº„Éâ„É™„É≥„ÇØ„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´ */
        .keyword-link {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
            cursor: pointer;
            border: none;
            margin: 4px;
        }

        .keyword-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.5);
        }

        .keyword-link:active {
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- „É¢„Éê„Ç§„É´Áî®Âõ∫ÂÆö„Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº -->
    <div id="mobileProgressBar" class="fixed top-0 left-0 right-0 bg-white shadow-sm z-50 md:hidden hidden">
        <div class="px-4 py-2 flex items-center justify-between">
            <span class="text-sm font-medium text-gray-700">ÈÄ≤Ë°åÂ∫¶</span>
            <span id="mobileProgressPercentage" class="text-sm font-bold text-blue-600">0%</span>
        </div>
        <div class="h-1 bg-gray-200">
            <div id="mobileProgressBarFill" style="height: 100%; width: 0%; background: transparent; transition: all 0.3s;"></div>
        </div>
    </div>

    <!-- ÈÉµ‰æøÁï™Âè∑ÂÖ•Âäõ„Éï„Ç©„Éº„É†ÔºàPC:„ÇÑ„ÇÑÂè≥‰∏ã„ÄÅ„É¢„Éê„Ç§„É´:‰∏ãÈÉ®‰∏≠Â§ÆÂõ∫ÂÆöÔºâ -->
    <div id="postalFormSection" class="fixed bottom-0 left-0 right-0 md:left-1/2 md:right-auto md:bottom-24 md:translate-x-16 pb-4 md:pb-0 z-50">
        <div class="bg-white rounded-xl shadow-2xl border-2 border-blue-300 p-6 w-96 mx-auto md:mx-0 transition-transform duration-300 hover:scale-105" style="animation: glow 3s ease-in-out infinite;">
            <div class="mb-3 flex items-center justify-between">
                <span class="bg-cyan-400 text-white rounded-full px-3 py-1 text-xs font-medium">„Åã„Çì„Åü„Çì10ÁßíÔºÅ</span>
            </div>
            <h2 class="text-lg font-bold mb-3 text-center whitespace-nowrap">
                ÈÉµ‰æøÁï™Âè∑„Åß‰ªä„Åô„ÅêÁõ∏Â†¥„ÉÅ„Çß„ÉÉ„ÇØÔºÅ
            </h2>
            <div class="space-y-3">
                <input type="text" id="postalCode" placeholder="„Äí100-0001"
                       class="w-full border-2 border-yellow-400 rounded-lg px-4 py-3 text-center text-base focus:outline-none focus:border-yellow-500 bg-blue-50">
                <button id="searchButton"
                        class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 font-bold text-base flex items-center justify-center gap-2 transition-all">
                    üîç ÁÑ°Êñô„ÅßÁõ∏Â†¥„ÇíË¶ã„Çã
                </button>
                <div class="flex items-center justify-center text-sm text-gray-600 gap-1">
                    üîí ÂÄã‰∫∫ÊÉÖÂ†±‰øùË≠∑„ÉªSSLÊöóÂè∑ÂåñÈÄö‰ø°„ÅßÂÆâÂÖ®
                </div>
            </div>
        </div>
    </div>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑÔºàBOT + „É©„É≥„Ç≠„É≥„Ç∞Ôºâ -->
    <div id="botParentContainer" class="max-w-6xl mx-auto px-4 space-y-6 pb-32">
        <!-- Ë¶ãÁ©ç„ÇÇ„Çä„Éú„Çø„É≥ÔºàÂõ∫ÂÆö‰ΩçÁΩÆ„ÉªÁôΩËÉåÊôØÔºâ -->
        <div id="estimateBtnContainer" class="fixed bottom-0 left-0 right-0 bg-white shadow-2xl border-t border-gray-200 py-4 z-[9999] hidden">
            <div class="max-w-6xl mx-auto px-4 text-center">
                <button onclick="showKeepModal();" class="bg-orange-400 hover:bg-orange-500 text-white font-bold py-4 px-20 rounded-full text-lg transition-all relative inline-flex items-center justify-center shadow-lg">
                    ÁÑ°ÊñôË¶ãÁ©ç„ÇÇ„Çä
                    <span class="notification-badge">0</span>
                </button>
            </div>
        </div>

        <!-- Áõ∏Â†¥Ë°®Á§∫ -->
        <div id="priceSection" class="hidden">
            <div class="bg-gradient-to-br from-blue-500 via-blue-600 to-purple-600 rounded-2xl shadow-xl p-1">
                <div class="bg-white rounded-xl p-4 md:p-6">
                    <div class="flex items-center justify-between gap-2 mb-4">
                        <div class="flex items-center gap-2 flex-1 min-w-0">
                            <svg class="w-5 h-5 text-blue-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            <h2 class="text-sm md:text-xl font-bold text-gray-800 truncate" id="areaName">Ê§úÁ¥¢‰∏≠...</h2>
                        </div>
                        <span class="bg-gradient-to-r from-blue-500 to-purple-600 text-white text-xs font-bold px-3 py-1 rounded-full whitespace-nowrap flex-shrink-0">
                            AIË®∫Êñ≠Ê∏à„Åø
                        </span>
                    </div>

                    <div class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 rounded-xl p-4 md:p-6 border border-blue-100">
                        <div class="text-center">
                            <p class="text-xs md:text-sm font-medium text-gray-600 mb-3">
                                Êà∏Âª∫„Å¶2ÈöéÂª∫„Å¶ÔºàÂª∂Â∫ä30Âù™„ÉªÁØâ25Âπ¥Ôºâ„ÅÆÂ†¥Âêà
                            </p>
                            <div class="flex items-center justify-center gap-2 md:gap-3 mb-3 whitespace-nowrap">
                                <div class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                                    60‰∏áÂÜÜ
                                </div>
                                <span class="text-xl md:text-2xl text-gray-400">„Äú</span>
                                <div class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                                    180‰∏áÂÜÜ
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 flex items-center justify-center gap-1 flex-wrap">
                                <svg class="w-3 h-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                </svg>
                                <span>Âª∫Áâ©„ÅÆÁä∂ÊÖã„Éª‰ΩøÁî®ÊùêÊñô„Å´„Çà„Çä‰æ°Ê†º„ÅØÂ§âÂãï„Åó„Åæ„Åô</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- BOT + „É©„É≥„Ç≠„É≥„Ç∞ -->
        <div id="mainContentContainer" class="hidden flex flex-col md:flex-row md:gap-6 md:space-y-0 space-y-6 md:h-[800px] relative mb-16">

            <!-- AI„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„Éà (Âè≥ÂÅ¥) -->
            <div id="chatSection" class="bg-white rounded-xl shadow-lg p-4 md:p-6 min-h-[500px] md:h-full md:w-1/2 order-1 md:order-2 overflow-y-auto">
                <div id="messages"></div>

                <!-- Choices area -->
                <div id="choices" class="choices-container space-y-2 mt-4"></div>

                <!-- Typing indicator -->
                <div id="typingIndicator" class="flex items-center text-gray-500 text-sm mt-4 hidden">
                    <div class="flex space-x-1 mr-2">
                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                    </div>
                </div>
            </div>

            <!-- „É©„É≥„Ç≠„É≥„Ç∞„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="rankingSection" class="ranking-section bg-blue-50 rounded-xl shadow-lg p-2 md:p-3 relative md:w-1/2 order-2 md:order-1 md:h-full md:flex md:flex-col" data-theme="blue">
                <h2 id="rankingTitle" class="text-lg font-bold mb-3">„Åä„Åô„Åô„ÇÅÊ•≠ËÄÖ„É©„É≥„Ç≠„É≥„Ç∞</h2>

                <!-- „É¢„Ç∂„Ç§„ÇØÊôÇ„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏ -->
                <div id="mosaicMessage" class="absolute inset-0 flex items-center justify-center z-10 pointer-events-none">
                    <div class="bg-white rounded-lg p-8 text-center shadow-lg">
                        <div class="text-blue-500 mb-4">
                            <svg class="w-16 h-16 mx-auto" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <h3 class="text-base font-bold mb-3 text-blue-600 whitespace-nowrap">„Ç™„É™„Ç∏„Éä„É´Ê•≠ËÄÖ„É©„É≥„Ç≠„É≥„Ç∞ÔºÅ</h3>
                        <div class="text-gray-600 mb-4 text-xs space-y-1">
                            <p class="flex items-start">
                                <span class="text-green-500 mr-1">‚úÖ</span>
                                <span>AI„ÅÆË≥™Âïè„Å´Á≠î„Åà„Å¶„ÅÇ„Å™„Åü„Å†„Åë„ÅÆÊù°‰ª∂„Å´„Éû„ÉÉ„ÉÅÔºÅ</span>
                            </p>
                            <p class="flex items-start">
                                <span class="text-green-500 mr-1">‚úÖ</span>
                                <span>ÈÅéÂéª„ÅÆ„Éá„Éº„Çø„Å´Âü∫„Å•„ÅÑ„ÅüÂÆüÁ∏æ„É©„É≥„Ç≠„É≥„Ç∞ÔºÅ</span>
                            </p>
                            <p class="flex items-start">
                                <span class="text-green-500 mr-1">‚úÖ</span>
                                <span>ÂÆåÂÖ®ÁÑ°Êñô„ÅßÔºîÁ§æ„Åæ„ÅßË¶ãÁ©ç„ÇÇ„Çä‰æùÈ†ºÂèØËÉΩÔºÅ</span>
                            </p>
                        </div>
                        <!-- ÈÄ≤Êçó„É°„Éº„Çø„Éº -->
                        <div id="progressMeter" class="mb-4 hidden">
                            <div class="flex justify-end text-xs text-gray-500 mb-1">
                                <span id="progressPercentage">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="progressBar" style="height: 8px; border-radius: 9999px; width: 0%; background: transparent; transition: all 0.5s;"></div>
                            </div>
                            <p class="text-xs text-blue-600 mt-2 font-medium">AI„ÉÅ„É£„ÉÉ„Éà„ÅÆË≥™Âïè„Å´Á≠î„Åà„Å¶‰∏ã„Åï„ÅÑ</p>
                        </div>
                    </div>
                </div>

                <!-- „É©„É≥„Ç≠„É≥„Ç∞ÂÜÖÂÆπÔºà„É¢„Ç∂„Ç§„ÇØ„Çí„Åã„Åë„ÇãÂØæË±°Ôºâ -->
                <div id="rankingContent" class="mosaic relative md:flex-1 md:flex md:flex-col overflow-hidden">

                    <!-- ‰∏¶„Å≥Êõø„Åà„Çø„Éñ -->
                    <div class="bg-white rounded-lg p-3 mb-4">
                        <h3 class="text-sm font-bold mb-2">‰∏¶„Å≥Êõø„Åà</h3>
                        <div id="sortingContainer" class="grid grid-cols-4 gap-1">
                            <button id="tabRecommend" onclick="switchSortTab('tabRecommend')" class="bg-blue-100 text-blue-800 py-2 px-2 rounded-lg text-xs font-medium flex flex-col items-center justify-center gap-1 h-16 min-h-16 border border-blue-300">
                                <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                                </svg>
                                <span class="whitespace-nowrap">„Åä„Åô„Åô„ÇÅÈ†Ü</span>
                            </button>
                            <button id="tabCheap" onclick="switchSortTab('tabCheap')" class="bg-white border border-gray-200 text-gray-700 py-2 px-2 rounded-lg text-xs font-medium flex flex-col items-center justify-center gap-1 h-16 min-h-16">
                                <svg class="w-4 h-4 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="whitespace-nowrap">ÂÆâ„ÅÑÈ†Ü</span>
                            </button>
                            <button id="tabReview" onclick="switchSortTab('tabReview')" class="bg-white border border-gray-200 text-gray-700 py-2 px-2 rounded-lg text-xs font-medium flex flex-col items-center justify-center gap-1 h-16 min-h-16">
                                <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                </svg>
                                <span class="whitespace-nowrap">Âè£„Ç≥„ÉüÈ†Ü</span>
                            </button>
                            <button id="tabQuality" onclick="switchSortTab('tabQuality')" class="bg-white border border-gray-200 text-gray-700 py-2 px-2 rounded-lg text-xs font-medium flex flex-col items-center justify-center gap-1 h-16 min-h-16">
                                <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                                </svg>
                                <span class="whitespace-nowrap">È´òÂìÅË≥™È†Ü</span>
                            </button>
                        </div>
                    </div>

                    <!-- „É©„É≥„Ç≠„É≥„Ç∞„É™„Çπ„Éà -->
                    <div id="rankingList" class="space-y-1.5 pb-4 max-h-[550px] overflow-y-auto">
                        <!-- 1‰Ωç -->
                        <div class="ranking-item border border-gray-300 rounded-lg p-2 bg-white">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex items-center gap-2">
                                    <span class="text-blue-600 text-lg font-bold">1</span>
                                    <h3 class="text-base font-bold">TÁ§æ</h3>
                                </div>
                                <div class="flex items-center gap-1">
                                    <span class="text-yellow-500 text-sm">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                    <span class="font-bold text-sm">4.9</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex gap-1">
                                    <span class="bg-blue-200 text-blue-800 text-xs px-1.5 py-0.5 rounded">Âú∞ÂÖÉÂØÜÁùÄ</span>
                                    <span class="bg-green-200 text-green-800 text-xs px-1.5 py-0.5 rounded">‰øùË®ºÂÖÖÂÆü</span>
                                    <span class="bg-red-200 text-red-800 text-xs px-1.5 py-0.5 rounded">Âç≥Êó•ÂØæÂøú</span>
                                </div>
                                <div class="text-gray-600 text-xs">
                                    ÊñΩÂ∑•ÂÆüÁ∏æ: 1,200‰ª∂
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <span class="text-xs font-bold text-gray-700">Ë¶ãÁ©ç„ÇÇ„Çä‰æ°Ê†º: 78‰∏áÂÜÜÔΩû</span>
                                </div>
                                <div class="flex gap-1">
                                    <button class="detail-btn bg-blue-200 text-blue-800 px-2 py-1 rounded-lg hover:bg-blue-300 text-xs font-medium flex-1">
                                        Ë©≥Á¥∞<span class="hidden sm:inline">„ÇíË¶ã„Çã</span>
                                    </button>
                                    <button onclick="keepManager.toggle('F001', 'TÁ§æ', this)" class="keep-btn px-2 py-1 rounded-lg text-xs font-medium flex-1">
                                        <span class="keep-text"><span>„Ç≠„Éº„Éó</span><span class="hidden sm:inline">„Åô„Çã</span></span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 2‰Ωç -->
                        <div class="ranking-item border border-gray-300 rounded-lg p-2 bg-white">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex items-center gap-2">
                                    <span class="text-gray-600 text-lg font-bold">2</span>
                                    <h3 class="text-base font-bold">SÁ§æ</h3>
                                </div>
                                <div class="flex items-center gap-1">
                                    <span class="text-yellow-500">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                    <span class="font-bold">4.7</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex gap-1">
                                    <span class="bg-red-200 text-red-800 text-xs px-1.5 py-0.5 rounded">ÊúÄ‰Ωé‰æ°Ê†º‰øùË®º</span>
                                    <span class="bg-purple-200 text-purple-800 text-xs px-1.5 py-0.5 rounded">ËÅ∑‰∫∫Áõ¥Âñ∂</span>
                                </div>
                                <div class="text-gray-600 text-xs">
                                    ÊñΩÂ∑•ÂÆüÁ∏æ: 980‰ª∂
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <span class="text-xs font-bold text-gray-700">Ë¶ãÁ©ç„ÇÇ„Çä‰æ°Ê†º: 83‰∏áÂÜÜÔΩû</span>
                                </div>
                                <div class="flex gap-1">
                                    <button class="detail-btn bg-blue-200 text-blue-800 px-2 py-1 rounded-lg hover:bg-blue-300 text-xs font-medium flex-1">
                                        Ë©≥Á¥∞<span class="hidden sm:inline">„ÇíË¶ã„Çã</span>
                                    </button>
                                    <button onclick="keepManager.toggle('F002', 'SÁ§æ', this)" class="keep-btn px-2 py-1 rounded-lg text-xs font-medium flex-1">
                                        <span class="keep-text"><span>„Ç≠„Éº„Éó</span><span class="hidden sm:inline">„Åô„Çã</span></span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 3‰Ωç -->
                        <div class="ranking-item border border-gray-300 rounded-lg p-2 bg-white">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex items-center gap-2">
                                    <span class="text-orange-600 text-lg font-bold">3</span>
                                    <h3 class="text-base font-bold">KÁ§æ</h3>
                                </div>
                                <div class="flex items-center gap-1">
                                    <span class="text-yellow-500">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                    <span class="font-bold">4.5</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex gap-1">
                                    <span class="bg-blue-200 text-blue-800 text-xs px-1.5 py-0.5 rounded">ÂÆöÊúüÁÇπÊ§ú‰ªò</span>
                                    <span class="bg-green-200 text-green-800 text-xs px-1.5 py-0.5 rounded">Áí∞Â¢ÉÈÖçÊÖÆ</span>
                                </div>
                                <div class="text-gray-600 text-xs">
                                    ÊñΩÂ∑•ÂÆüÁ∏æ: 850‰ª∂
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <span class="text-xs font-bold text-gray-700">Ë¶ãÁ©ç„ÇÇ„Çä‰æ°Ê†º: 85‰∏áÂÜÜÔΩû</span>
                                </div>
                                <div class="flex gap-1">
                                    <button class="detail-btn bg-blue-200 text-blue-800 px-2 py-1 rounded-lg hover:bg-blue-300 text-xs font-medium flex-1">
                                        Ë©≥Á¥∞<span class="hidden sm:inline">„ÇíË¶ã„Çã</span>
                                    </button>
                                    <button onclick="keepManager.toggle('F003', 'KÁ§æ', this)" class="keep-btn px-2 py-1 rounded-lg text-xs font-medium flex-1">
                                        <span class="keep-text"><span>„Ç≠„Éº„Éó</span><span class="hidden sm:inline">„Åô„Çã</span></span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 4‰Ωç -->
                        <div class="ranking-item border border-gray-300 rounded-lg p-2 bg-white">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex items-center gap-2">
                                    <span class="text-gray-600 text-lg font-bold">4</span>
                                    <h3 class="text-base font-bold">PÁ§æ</h3>
                                </div>
                                <div class="flex items-center gap-1">
                                    <span class="text-yellow-500">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                    <span class="font-bold">4.3</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex gap-1">
                                    <span class="bg-red-200 text-red-800 text-xs px-1.5 py-0.5 rounded">10Âπ¥‰øùË®º</span>
                                    <span class="bg-blue-200 text-blue-800 text-xs px-1.5 py-0.5 rounded">È´òÁ¥öÂ°óÊñô‰ΩøÁî®</span>
                                </div>
                                <div class="text-gray-600 text-xs">
                                    ÊñΩÂ∑•ÂÆüÁ∏æ: 760‰ª∂
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <span class="text-xs font-bold text-gray-700">Ë¶ãÁ©ç„ÇÇ„Çä‰æ°Ê†º: 92‰∏áÂÜÜÔΩû</span>
                                </div>
                                <div class="flex gap-1">
                                    <button class="detail-btn bg-blue-200 text-blue-800 px-2 py-1 rounded-lg hover:bg-blue-300 text-xs font-medium flex-1">
                                        Ë©≥Á¥∞<span class="hidden sm:inline">„ÇíË¶ã„Çã</span>
                                    </button>
                                    <button onclick="keepManager.toggle('F004', 'PÁ§æ', this)" class="keep-btn px-2 py-1 rounded-lg text-xs font-medium flex-1">
                                        <span class="keep-text"><span>„Ç≠„Éº„Éó</span><span class="hidden sm:inline">„Åô„Çã</span></span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- „ÇÇ„Å£„Å®Ë¶ã„Çã„É™„É≥„ÇØ -->
                        <div id="showMoreBtn" class="text-center py-3">
                            <a href="javascript:void(0)" onclick="showMoreRankings()" class="text-blue-600 hover:text-blue-800 underline font-medium text-sm">
                                „ÇÇ„Å£„Å®Ë¶ã„Çã
                            </a>
                        </div>

                        <!-- 5„Äú8‰ΩçÔºàÂàùÊúüÈùûË°®Á§∫Ôºâ -->
                        <div id="moreRankings" class="space-y-1.5 hidden">
                            <!-- 5‰Ωç -->
                            <div class="ranking-item border border-gray-300 rounded-lg p-2 bg-white">
                                <div class="flex items-start justify-between mb-2">
                                    <div class="flex items-center gap-2">
                                        <span class="text-gray-600 text-lg font-bold">5</span>
                                        <h3 class="text-base font-bold">MÁ§æ</h3>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <span class="text-yellow-500">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                        <span class="font-bold">4.2</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between mb-1">
                                    <div class="flex gap-1">
                                        <span class="bg-green-200 text-green-800 text-xs px-1.5 py-0.5 rounded">Ëá™Á§æÊñΩÂ∑•</span>
                                        <span class="bg-blue-200 text-blue-800 text-xs px-1.5 py-0.5 rounded">ËøÖÈÄüÂØæÂøú</span>
                                    </div>
                                    <div class="text-gray-600 text-xs">
                                        ÊñΩÂ∑•ÂÆüÁ∏æ: 650‰ª∂
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <span class="text-xs font-bold text-gray-700">Ë¶ãÁ©ç„ÇÇ„Çä‰æ°Ê†º: 88‰∏áÂÜÜÔΩû</span>
                                    </div>
                                    <div class="flex gap-1">
                                        <button class="detail-btn bg-blue-200 text-blue-800 px-2 py-1 rounded-lg hover:bg-blue-300 text-xs font-medium flex-1">
                                            Ë©≥Á¥∞<span class="hidden sm:inline">„ÇíË¶ã„Çã</span>
                                        </button>
                                        <button onclick="keepManager.toggle('F005', 'MÁ§æ', this)" class="keep-btn px-2 py-1 rounded-lg text-xs font-medium flex-1">
                                            <span class="keep-text"><span>„Ç≠„Éº„Éó</span><span class="hidden sm:inline">„Åô„Çã</span></span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- 6‰Ωç -->
                            <div class="ranking-item border border-gray-300 rounded-lg p-2 bg-white">
                                <div class="flex items-start justify-between mb-2">
                                    <div class="flex items-center gap-2">
                                        <span class="text-gray-600 text-lg font-bold">6</span>
                                        <h3 class="text-base font-bold">HÁ§æ</h3>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <span class="text-yellow-500">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                        <span class="font-bold">4.1</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between mb-1">
                                    <div class="flex gap-1">
                                        <span class="bg-purple-200 text-purple-800 text-xs px-1.5 py-0.5 rounded">Â§ßÊâã‰ºÅÊ•≠</span>
                                        <span class="bg-red-200 text-red-800 text-xs px-1.5 py-0.5 rounded">ÂÖ®ÂõΩÂØæÂøú</span>
                                    </div>
                                    <div class="text-gray-600 text-xs">
                                        ÊñΩÂ∑•ÂÆüÁ∏æ: 580‰ª∂
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <span class="text-xs font-bold text-gray-700">Ë¶ãÁ©ç„ÇÇ„Çä‰æ°Ê†º: 95‰∏áÂÜÜÔΩû</span>
                                    </div>
                                    <div class="flex gap-1">
                                        <button class="detail-btn bg-blue-200 text-blue-800 px-2 py-1 rounded-lg hover:bg-blue-300 text-xs font-medium flex-1">
                                            Ë©≥Á¥∞<span class="hidden sm:inline">„ÇíË¶ã„Çã</span>
                                        </button>
                                        <button onclick="keepManager.toggle('F006', 'AÁ§æ', this)" class="keep-btn px-2 py-1 rounded-lg text-xs font-medium flex-1">
                                            <span class="keep-text"><span>„Ç≠„Éº„Éó</span><span class="hidden sm:inline">„Åô„Çã</span></span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- 7‰Ωç -->
                            <div class="ranking-item border border-gray-300 rounded-lg p-2 bg-white">
                                <div class="flex items-start justify-between mb-2">
                                    <div class="flex items-center gap-2">
                                        <span class="text-gray-600 text-lg font-bold">7</span>
                                        <h3 class="text-base font-bold">NÁ§æ</h3>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <span class="text-yellow-500">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                        <span class="font-bold">4.0</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between mb-1">
                                    <div class="flex gap-1">
                                        <span class="bg-blue-200 text-blue-800 text-xs px-1.5 py-0.5 rounded">„Ç¢„Éï„Çø„ÉºÂÖÖÂÆü</span>
                                        <span class="bg-green-200 text-green-800 text-xs px-1.5 py-0.5 rounded">Èï∑Êúü‰øùË®º</span>
                                    </div>
                                    <div class="text-gray-600 text-xs">
                                        ÊñΩÂ∑•ÂÆüÁ∏æ: 520‰ª∂
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <span class="text-xs font-bold text-gray-700">Ë¶ãÁ©ç„ÇÇ„Çä‰æ°Ê†º: 90‰∏áÂÜÜÔΩû</span>
                                    </div>
                                    <div class="flex gap-1">
                                        <button class="detail-btn bg-blue-200 text-blue-800 px-2 py-1 rounded-lg hover:bg-blue-300 text-xs font-medium flex-1">
                                            Ë©≥Á¥∞<span class="hidden sm:inline">„ÇíË¶ã„Çã</span>
                                        </button>
                                        <button onclick="keepManager.toggle('F007', 'BÁ§æ', this)" class="keep-btn px-2 py-1 rounded-lg text-xs font-medium flex-1">
                                            <span class="keep-text"><span>„Ç≠„Éº„Éó</span><span class="hidden sm:inline">„Åô„Çã</span></span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- 8‰Ωç -->
                            <div class="ranking-item border border-gray-300 rounded-lg p-2 bg-white">
                                <div class="flex items-start justify-between mb-2">
                                    <div class="flex items-center gap-2">
                                        <span class="text-gray-600 text-lg font-bold">8</span>
                                        <h3 class="text-base font-bold">RÁ§æ</h3>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <span class="text-yellow-500">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                        <span class="font-bold">3.9</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between mb-1">
                                    <div class="flex gap-1">
                                        <span class="bg-orange-200 text-orange-800 text-xs px-1.5 py-0.5 rounded">‰Ωé‰æ°Ê†º</span>
                                        <span class="bg-purple-200 text-purple-800 text-xs px-1.5 py-0.5 rounded">ËÅ∑‰∫∫Â§öÊï∞</span>
                                    </div>
                                    <div class="text-gray-600 text-xs">
                                        ÊñΩÂ∑•ÂÆüÁ∏æ: 480‰ª∂
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <span class="text-xs font-bold text-gray-700">Ë¶ãÁ©ç„ÇÇ„Çä‰æ°Ê†º: 75‰∏áÂÜÜÔΩû</span>
                                    </div>
                                    <div class="flex gap-1">
                                        <button class="detail-btn bg-blue-200 text-blue-800 px-2 py-1 rounded-lg hover:bg-blue-300 text-xs font-medium flex-1">
                                            Ë©≥Á¥∞<span class="hidden sm:inline">„ÇíË¶ã„Çã</span>
                                        </button>
                                        <button onclick="keepManager.toggle('F008', 'CÁ§æ', this)" class="keep-btn px-2 py-1 rounded-lg text-xs font-medium flex-1">
                                            <span class="keep-text"><span>„Ç≠„Éº„Éó</span><span class="hidden sm:inline">„Åô„Çã</span></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- „Ç≠„Éº„ÉóÁ¢∫Ë™ç„É¢„Éº„ÉÄ„É´ -->
    <div id="keepModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[2000] flex items-center justify-center p-4">
        <div id="keepModalInner" class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto" style="background-color: white !important; min-height: 400px; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
            <div class="p-6">
                <h2 class="text-xl font-bold mb-4">Ë¶ãÁ©ç„ÇÇ„Çä„ÅÆÊµÅ„Çå</h2>

                <h3 class="text-lg font-bold mb-3">„Ç≠„Éº„Éó‰∏≠„ÅÆÊ•≠ËÄÖ</h3>
                <div id="keepList" class="space-y-2 mb-4">
                    <!-- „Ç≠„Éº„Éó„É™„Çπ„Éà„Åå„Åì„Åì„Å´Ë°®Á§∫ -->
                </div>

                <div class="flex gap-2" style="position: relative; z-index: 10;">
                    <button onclick="closeKeepModal()" class="px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 cursor-pointer" style="position: relative; z-index: 10;">
                        Èñâ„Åò„Çã
                    </button>
                    <button onclick="startEstimateForm()" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-lg font-bold hover:from-blue-600 hover:to-blue-700 cursor-pointer" style="position: relative; z-index: 10;">
                        „Åì„ÅÆÊ•≠ËÄÖ„ÅÆË¶ãÁ©ç„ÇÇ„Çä„ÇíË¶ã„Å¶„Åø„Çã
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ë¶ãÁ©ç„ÇÇ„Çä„Éï„Ç©„Éº„É†„É¢„Éº„ÉÄ„É´ -->
    <div id="estimateFormModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[3000] flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <!-- „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº -->
            <div class="bg-blue-50 p-4 border-b">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium">„Çπ„ÉÜ„ÉÉ„Éó <span id="currentStep">1</span>/2</span>
                    <span class="text-sm font-medium"><span id="stepPercent">50</span>%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div id="stepProgress" class="bg-blue-500 h-2 rounded-full transition-all" style="width: 50%"></div>
                </div>
            </div>

            <!-- „Çπ„ÉÜ„ÉÉ„Éó1: Âü∫Êú¨ÊÉÖÂ†± -->
            <div id="step1" class="p-6">
                <h2 class="text-xl font-bold mb-4">Âü∫Êú¨ÊÉÖÂ†±„ÅÆÂÖ•Âäõ</h2>

                <!-- „ÅäÂêçÂâç -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        „ÅäÂêçÂâç <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="userName" class="w-full border-2 border-gray-200 rounded-lg px-4 py-2 focus:outline-none focus:border-blue-500" placeholder="Â±±Áî∞ Â§™ÈÉé">
                </div>

                <!-- ÂØæË±°Áâ©‰ª∂‰ΩèÊâÄ -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        ÂØæË±°Áâ©‰ª∂‰ΩèÊâÄ <span class="text-red-500">*</span>
                    </label>
                    <div class="space-y-2">
                        <div class="flex gap-2">
                            <input type="text" id="propertyZip" class="w-32 border-2 border-gray-200 rounded-lg px-4 py-2 focus:outline-none focus:border-blue-500" placeholder="000-0000" readonly>
                            <input type="text" id="propertyAddress" class="flex-1 border-2 border-gray-200 rounded-lg px-4 py-2 focus:outline-none focus:border-blue-500" placeholder="Â∏ÇÂå∫Áî∫Êùë" readonly>
                        </div>
                        <input type="text" id="propertyStreet" class="w-full border-2 border-gray-200 rounded-lg px-4 py-2 focus:outline-none focus:border-blue-500" placeholder="Áï™Âú∞„ÉªÂª∫Áâ©Âêç">
                    </div>
                </div>

                <!-- Ëá™ÂÆÖ‰ΩèÊâÄÔºàÊù°‰ª∂‰ªò„ÅçÔºâ -->
                <div class="mb-4">
                    <label class="flex items-center">
                        <input type="checkbox" id="differentHome" class="mr-2" onchange="toggleHomeAddress()">
                        <span class="text-sm font-medium text-gray-700">ÂØæË±°Áâ©‰ª∂„Å®Ëá™ÂÆÖ„ÅåÁï∞„Å™„ÇãÂ†¥Âêà„ÅØ„ÉÅ„Çß„ÉÉ„ÇØ</span>
                    </label>

                    <div id="homeAddressSection" class="hidden mt-3 space-y-2">
                        <div class="flex gap-2">
                            <input type="text" id="homeZip" class="w-32 border-2 border-gray-200 rounded-lg px-4 py-2 focus:outline-none focus:border-blue-500" placeholder="000-0000" onblur="fetchAddress(this.value, 'home')">
                            <input type="text" id="homeAddress" class="flex-1 border-2 border-gray-200 rounded-lg px-4 py-2 focus:outline-none focus:border-blue-500" placeholder="Â∏ÇÂå∫Áî∫Êùë" readonly>
                        </div>
                        <input type="text" id="homeStreet" class="w-full border-2 border-gray-200 rounded-lg px-4 py-2 focus:outline-none focus:border-blue-500" placeholder="Áï™Âú∞„ÉªÂª∫Áâ©Âêç">
                    </div>
                </div>

                <!-- „É°„Éº„É´„Ç¢„Éâ„É¨„ÇπÔºà‰ªªÊÑèÔºâ -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        „É°„Éº„É´„Ç¢„Éâ„É¨„Çπ <span class="text-gray-400">(‰ªªÊÑè)</span>
                    </label>
                    <input type="email" id="userEmail" class="w-full border-2 border-gray-200 rounded-lg px-4 py-2 focus:outline-none focus:border-blue-500" placeholder="example@email.com">
                </div>

                <div class="flex gap-2">
                    <button onclick="closeEstimateForm()" class="px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold">
                        Êàª„Çã
                    </button>
                    <button onclick="nextStep()" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-lg font-bold">
                        Ê¨°„Å∏
                    </button>
                </div>
            </div>

            <!-- „Çπ„ÉÜ„ÉÉ„Éó2: Ë©≥Á¥∞ÊÉÖÂ†± -->
            <div id="step2" class="p-4 hidden">
                <h2 class="text-xl font-bold mb-4">Ë©≥Á¥∞ÊÉÖÂ†±„ÅÆÂÖ•Âäõ</h2>

                <!-- ÁèæÂú∞Ë™øÊüªÂ∏åÊúõÊó•ÊôÇ -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        ÁèæÂú∞Ë™øÊüªÂ∏åÊúõÊó•ÊôÇ <span class="text-gray-400">(Ë§áÊï∞ÈÅ∏ÊäûÂèØ)</span>
                    </label>
                    <div class="space-y-2" id="surveyDates">
                        <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                    </div>
                </div>

                <div class="flex gap-2">
                    <button onclick="prevStep()" id="prevStepBtn" class="px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold">
                        Êàª„Çã
                    </button>
                    <button onclick="submitForm()" id="submitBtn" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-lg font-bold transition-all">
                        ÈÄÅ‰ø°„Åô„Çã
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- BOT„Ç∑„Çπ„ÉÜ„É†Ôºà„É≠„Éº„Ç´„É´„Éª„Çµ„Éº„Éê„ÉºÂÖ±ÈÄöÔºâ -->
    <!-- ============================================ -->
    <script src="zip-word-bot-data.js?v=20251008_24"></script>
    <script src="js/bot-config.js?v=20251008_17"></script>
    <script src="js/bot-ui.js?v=20251008_1"></script>
    <script src="js/bot-core.js"></script>
    <script src="js/bot-scenarios.js"></script>
    <script src="js/bot-questions.js?v=20251008_18"></script>
    <script src="js/cv-api.js?v=20251008_7"></script>
    <script src="js/utils.js?v=20251008_34"></script>
    <script src="js/ranking.js?v=20251008_44"></script>
    <script>
        // GAS URL‰∏äÊõ∏„ÅçÔºà„Çµ„Éº„Éê„Éº„Ç≠„É£„ÉÉ„Ç∑„É•ÂØæÁ≠ñÔºâ
        if (typeof CVAPI !== 'undefined') {
            CVAPI.GAS_URL = 'https://script.google.com/macros/s/AKfycbzYC8oyQjjcENCdqKbCtapUKskn7aFpIaxslR-UaW7WgdSqftdq_852R6JgEdRvffjhQA/exec';
            console.log('‚úÖ GAS URL‰∏äÊõ∏„ÅçÂÆå‰∫Ü:', CVAPI.GAS_URL);
        }
    </script>
    <script src="js/phone-form.js"></script>

    <script>
        // ============================================
        // „Ç≠„Éº„ÉóÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†
        // ============================================
        class KeepManager {
            constructor() {
                localStorage.removeItem('keeps');
                this.keeps = [];
            }

            toggle(id, name, button) {
                const keepData = { id, name };
                const index = this.keeps.findIndex(k => k.id === id);

                console.log(`üîÑ „Ç≠„Éº„Éó„Éà„Ç∞„É´: ${id} (${name}) - ÁèæÂú®: ${index > -1 ? '„Ç≠„Éº„Éó‰∏≠' : '„Ç≠„Éº„Éó'}`);

                if (index > -1) {
                    // „Ç≠„Éº„ÉóËß£Èô§
                    this.keeps.splice(index, 1);
                    console.log(`‚ùå „Ç≠„Éº„ÉóËß£Èô§: ${id} - ÊÆã„Çä${this.keeps.length}‰ª∂`);
                } else {
                    // „Ç≠„Éº„ÉóËøΩÂä†
                    if (this.keeps.length >= 4) {
                        alert('„Ç≠„Éº„Éó„ÅØÊúÄÂ§ß4Á§æ„Åæ„Åß„Åß„Åô');
                        return;
                    }
                    this.keeps.push(keepData);
                    console.log(`‚úÖ „Ç≠„Éº„ÉóËøΩÂä†: ${id} - ÂêàË®à${this.keeps.length}‰ª∂`);
                }

                this.save();
                this.updateBadge();

                // „É©„É≥„Ç≠„É≥„Ç∞Ë°®Á§∫„ÇíÊõ¥Êñ∞Ôºà„Ç≠„Éº„ÉóÁä∂ÊÖã„ÇíÂèçÊò†Ôºâ
                console.log(`üîÑ refreshRankingDisplayÈñãÂßã - keeps: ${this.keeps.length}‰ª∂`);
                this.refreshRankingDisplay();
            }

            refreshRankingDisplay() {
                // ÁèæÂú®„ÅÆ„ÇΩ„Éº„ÉàÁ®ÆÂà•„ÅßÂÜçÊèèÁîª
                if (typeof window.updateRankingOrder === 'function' && typeof window.currentSortType !== 'undefined') {
                    const sortTypeMap = {
                        '„Åä„Åô„Åô„ÇÅÈ†Ü': 'tabRecommend',
                        'ÂÆâ„ÅÑÈ†Ü': 'tabCheap',
                        'Âè£„Ç≥„ÉüÈ†Ü': 'tabReview',
                        'È´òÂìÅË≥™È†Ü': 'tabQuality'
                    };
                    const currentTabType = sortTypeMap[window.currentSortType] || 'tabRecommend';
                    window.updateRankingOrder(currentTabType);
                }
            }

            save() {
                localStorage.setItem('keeps', JSON.stringify(this.keeps));
            }

            updateBadge() {
                const badges = document.querySelectorAll('.notification-badge');
                const estimateBtnContainer = document.getElementById('estimateBtnContainer');

                badges.forEach(badge => {
                    badge.textContent = this.keeps.length;
                });

                if (estimateBtnContainer) {
                    if (this.keeps.length > 0) {
                        estimateBtnContainer.classList.remove('hidden');
                    } else {
                        estimateBtnContainer.classList.add('hidden');
                    }
                }
            }

            updateUI() {
                this.updateBadge();

                document.querySelectorAll('.keep-btn').forEach(btn => {
                    const onclickAttr = btn.getAttribute('onclick');
                    if (onclickAttr) {
                        const match = onclickAttr.match(/'([^']+)'/);
                        if (match) {
                            const btnId = match[1];
                            const isKept = this.keeps.some(k => k.id === btnId);
                            if (isKept) {
                                btn.classList.add('active');
                            } else {
                                btn.classList.remove('active');
                            }
                        }
                    }
                });
            }

            getList() {
                return this.keeps;
            }
        }

        const keepManager = new KeepManager();
        window.keepManager = keepManager; // „Ç∞„É≠„Éº„Éê„É´„Å´ÂÖ¨Èñã

        // ============================================
        // „É¢„Éº„ÉÄ„É´Âà∂Âæ°
        // ============================================
        function showKeepModal() {
            const modal = document.getElementById('keepModal');
            const keepList = document.getElementById('keepList');

            if (!modal || !keepList) {
                console.error('„É¢„Éº„ÉÄ„É´Ë¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }

            const keeps = keepManager.getList();
            keepList.innerHTML = keeps.map(keep => `
                <div class="p-3 border rounded-lg flex items-center justify-between">
                    <span class="font-medium">${keep.name}</span>
                    <span class="text-sm text-gray-500">„Ç≠„Éº„Éó‰∏≠</span>
                </div>
            `).join('');

            modal.classList.remove('hidden');
        }

        function closeKeepModal() {
            document.getElementById('keepModal').classList.add('hidden');
        }

        // ============================================
        // ‰∏¶„Å≥Êõø„ÅàÊ©üËÉΩÔºàranking.js„ÅÆswitchSortTab()„Çí‰ΩøÁî®Ôºâ
        // ============================================
        // ÊóßchangeSortType()Èñ¢Êï∞„ÅØÁÑ°ÂäπÂåñÔºàranking.js„ÅÆswitchSortTab()„Å´ÁßªË°åÊ∏à„ÅøÔºâ

        // „ÇÇ„Å£„Å®„Åø„ÇãÊ©üËÉΩ
        function showMoreRankings() {
            const moreRankings = document.getElementById('moreRankings');
            const showMoreBtn = document.getElementById('showMoreBtn');
            const rankingList = document.getElementById('rankingList');

            // 5„Äú8‰Ωç„ÇíË°®Á§∫
            moreRankings.classList.remove('hidden');
            // „Éú„Çø„É≥„ÇíÈùûË°®Á§∫
            showMoreBtn.style.display = 'none';

            // „Çπ„ÇØ„É≠„Éº„É´„Çí„Çπ„É†„Éº„Ç∫„Å´5‰Ωç„Åæ„ÅßÁßªÂãï
            setTimeout(() => {
                const firstNewItem = moreRankings.querySelector('.ranking-item');
                if (firstNewItem) {
                    firstNewItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }, 100);
        }

        // ============================================
        // „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞ÔºàBOT„Ç∑„Çπ„ÉÜ„É†„Å∏„ÅÆÊé•Á∂öÔºâ
        // ============================================
        function startScenario(keyword) {
            console.log('üéØ „Ç∑„Éä„É™„Ç™ÈñãÂßã:', keyword);

            // „Ç≠„Éº„ÉØ„Éº„Éâ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈùûË°®Á§∫
            const keywordSection = document.getElementById('keywordSection');
            if (keywordSection) {
                keywordSection.style.display = 'none';
            }

            // „Éò„ÉÉ„ÉÄ„Éº„ÇíÈùûË°®Á§∫
            const header = document.querySelector('header');
            if (header) {
                header.style.display = 'none';
            }

            // ÈÉµ‰æøÁï™Âè∑„Éï„Ç©„Éº„É†„ÇíÈùûË°®Á§∫
            const postalFormSection = document.getElementById('postalFormSection');
            if (postalFormSection) {
                postalFormSection.style.display = 'none';
            }

            // „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË°®Á§∫
            const mainContentContainer = document.getElementById('mainContentContainer');
            if (mainContentContainer) {
                mainContentContainer.classList.remove('hidden');
            }

            // „É¢„Éê„Ç§„É´„Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº„ÇíË°®Á§∫
            const mobileProgressBar = document.getElementById('mobileProgressBar');
            if (mobileProgressBar) {
                mobileProgressBar.classList.remove('hidden');
            }

            // ÈÄ≤Êçó„É°„Éº„Çø„Éº„ÇíË°®Á§∫
            const progressMeter = document.getElementById('progressMeter');
            if (progressMeter) {
                progressMeter.classList.remove('hidden');
            }

            // BOT„Ç∑„Çπ„ÉÜ„É†„Å´Êé•Á∂ö
            if (window.BotCore && typeof window.BotCore.startFromKeywordEntry === 'function') {
                window.BotCore.startFromKeywordEntry(keyword);
            } else {
                console.error('‚ùå BotCore„ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
            }
        }

        function handlePostalCodeSearch() {
            const postalCode = document.getElementById('postalCode').value.trim();

            if (!postalCode) {
                alert('ÈÉµ‰æøÁï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            if (!postalCode.match(/^\d{3}-?\d{4}$/)) {
                alert('Ê≠£„Åó„ÅÑÈÉµ‰æøÁï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà‰æãÔºö100-0001Ôºâ');
                return;
            }

            // „Ç≠„Éº„ÉØ„Éº„Éâ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈùûË°®Á§∫
            const keywordSection = document.getElementById('keywordSection');
            if (keywordSection) {
                keywordSection.style.display = 'none';
            }

            // „Éò„ÉÉ„ÉÄ„Éº„ÇíÈùûË°®Á§∫
            const header = document.querySelector('header');
            if (header) {
                header.style.display = 'none';
            }

            // ÈÉµ‰æøÁï™Âè∑„Éï„Ç©„Éº„É†„ÇíÈùûË°®Á§∫
            const postalFormSection = document.getElementById('postalFormSection');
            if (postalFormSection) {
                postalFormSection.style.display = 'none';
            }

            // Áõ∏Â†¥Ë°®Á§∫Ôºà„Ç®„É™„Ç¢Âêç„ÅØÈÉµ‰æøÁï™Âè∑„Åã„ÇâËá™ÂãïË®≠ÂÆö„Åï„Çå„Åæ„ÅôÔºâ
            const priceSection = document.getElementById('priceSection');
            if (priceSection) priceSection.classList.remove('hidden');
            // areaNa me„ÅØÈÉµ‰æøÁï™Âè∑„Åã„ÇâÂãïÁöÑ„Å´Ë®≠ÂÆö„Åï„Çå„Çã„Åü„ÇÅ„ÄÅ„Åì„Åì„Åß„ÅØË®≠ÂÆö„Åó„Å™„ÅÑ

            // „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË°®Á§∫
            const mainContentContainer = document.getElementById('mainContentContainer');
            if (mainContentContainer) {
                mainContentContainer.classList.remove('hidden');
            }

            // „É¢„Éê„Ç§„É´„Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº„ÇíË°®Á§∫
            const mobileProgressBar = document.getElementById('mobileProgressBar');
            if (mobileProgressBar) {
                mobileProgressBar.classList.remove('hidden');
            }

            // ÈÄ≤Êçó„É°„Éº„Çø„Éº„ÇíË°®Á§∫
            const progressMeter = document.getElementById('progressMeter');
            if (progressMeter) {
                progressMeter.classList.remove('hidden');
            }

            // BOT„Ç∑„Çπ„ÉÜ„É†„Å´Êé•Á∂ö
            if (window.BotCore && typeof window.BotCore.startFromZipEntry === 'function') {
                window.BotCore.startFromZipEntry(postalCode);
            } else {
                console.error('‚ùå BotCore„ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
            }
        }

        // ============================================
        // Ë¶ãÁ©ç„ÇÇ„Çä„Éï„Ç©„Éº„É†Èñ¢ÈÄ£„ÅÆÈñ¢Êï∞
        // ============================================

        // Ë¶ãÁ©ç„ÇÇ„Çä„Éï„Ç©„Éº„É†„ÇíÈñãÂßã
        function startEstimateForm() {
            closeKeepModal();

            // Âõ∫ÂÆö„ÅÆË¶ãÁ©ç„ÇÇ„Çä„Éú„Çø„É≥„ÇíÈùûË°®Á§∫
            const estimateBtnContainer = document.getElementById('estimateBtnContainer');
            if (estimateBtnContainer) {
                estimateBtnContainer.classList.add('hidden');
            }

            document.getElementById('estimateFormModal').classList.remove('hidden');

            // ÈÉµ‰æøÁï™Âè∑„ÇíËá™Âãï„Çª„ÉÉ„Éà
            const savedPostalCode = localStorage.getItem('userPostalCode') || document.getElementById('postalCode')?.value;
            if (savedPostalCode) {
                document.getElementById('propertyZip').value = savedPostalCode;
                fetchAddress(savedPostalCode, 'property');
            }
        }

        // Ë¶ãÁ©ç„ÇÇ„Çä„Éï„Ç©„Éº„É†„ÇíÈñâ„Åò„Çã
        function closeEstimateForm() {
            document.getElementById('estimateFormModal').classList.add('hidden');
            // Step1„Å´Êàª„Åô
            document.getElementById('step1').classList.remove('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('currentStep').textContent = '1';
            document.getElementById('stepPercent').textContent = '50';
            document.getElementById('stepProgress').style.width = '50%';

            // Âõ∫ÂÆö„ÅÆË¶ãÁ©ç„ÇÇ„Çä„Éú„Çø„É≥„ÇíÂÜçË°®Á§∫
            const estimateBtnContainer = document.getElementById('estimateBtnContainer');
            if (estimateBtnContainer) {
                estimateBtnContainer.classList.remove('hidden');
            }
        }

        // Ëá™ÂÆÖ‰ΩèÊâÄ„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
        function toggleHomeAddress() {
            const checkbox = document.getElementById('differentHome');
            const homeAddressFields = document.getElementById('homeAddressSection');
            if (checkbox.checked) {
                homeAddressFields.classList.remove('hidden');
            } else {
                homeAddressFields.classList.add('hidden');
            }
        }

        // Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„Å∏
        function nextStep() {
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');

            // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥
            const name = document.getElementById('userName').value.trim();
            const street = document.getElementById('propertyStreet').value.trim();

            if (!name) {
                alert('„ÅäÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            if (!street) {
                alert('Áï™Âú∞„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            // Ëá™ÂÆÖ‰ΩèÊâÄ„ÅåÁï∞„Å™„ÇãÂ†¥Âêà„ÅÆ„Éê„É™„Éá„Éº„Ç∑„Éß„É≥
            if (document.getElementById('differentHome').checked) {
                const homePostal = document.getElementById('homeZip').value.trim();
                const homeStreet = document.getElementById('homeStreet').value.trim();

                if (!homePostal) {
                    alert('Ëá™ÂÆÖ„ÅÆÈÉµ‰æøÁï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                if (!homeStreet) {
                    alert('Ëá™ÂÆÖ„ÅÆÁï™Âú∞„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
            }

            // „Çπ„ÉÜ„ÉÉ„ÉóÂàá„ÇäÊõø„Åà
            step1.classList.add('hidden');
            step2.classList.remove('hidden');

            // „Éó„É≠„Ç∞„É¨„Çπ„Éê„ÉºÊõ¥Êñ∞
            document.getElementById('currentStep').textContent = '2';
            document.getElementById('stepPercent').textContent = '100';
            document.getElementById('stepProgress').style.width = '100%';

            // ÁèæÂú∞Ë™øÊüªÂ∏åÊúõÊó•ÊôÇ„ÅÆÂãïÁöÑÁîüÊàê
            generateSurveyDates();
        }

        // Ââç„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„Å∏
        function prevStep() {
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');

            step2.classList.add('hidden');
            step1.classList.remove('hidden');

            // „Éó„É≠„Ç∞„É¨„Çπ„Éê„ÉºÊõ¥Êñ∞
            document.getElementById('currentStep').textContent = '1';
            document.getElementById('stepPercent').textContent = '50';
            document.getElementById('stepProgress').style.width = '50%';
        }

        // ÈÉµ‰æøÁï™Âè∑„Åã„Çâ‰ΩèÊâÄ„ÇíÂèñÂæó
        async function fetchAddress(postalCode, type = 'property') {
            // „Éè„Ç§„Éï„É≥„ÇíÈô§Âéª
            const cleanPostalCode = postalCode.replace(/-/g, '');

            try {
                const response = await fetch(`https://zipcloud.ibsnet.co.jp/api/search?zipcode=${cleanPostalCode}`);
                const data = await response.json();

                if (data.results && data.results.length > 0) {
                    const result = data.results[0];
                    const prefecture = result.address1;  // ÈÉΩÈÅìÂ∫úÁúå
                    const city = result.address2 + result.address3;  // Â∏ÇÂå∫Áî∫Êùë
                    const fullAddress = `${prefecture}${city}`;

                    if (type === 'property') {
                        document.getElementById('propertyAddress').value = fullAddress;
                        // CV2ÈÄÅ‰ø°Áî®„Å´ÈÉΩÈÅìÂ∫úÁúå„Å®Â∏ÇÂå∫Áî∫Êùë„Çí‰øùÂ≠ò
                        window.propertyPrefecture = prefecture;
                        window.propertyCity = city;
                    } else {
                        document.getElementById('homeAddress').value = fullAddress;
                        // CV2ÈÄÅ‰ø°Áî®„Å´ÈÉΩÈÅìÂ∫úÁúå„Å®Â∏ÇÂå∫Áî∫Êùë„Çí‰øùÂ≠ò
                        window.homePrefecture = prefecture;
                        window.homeCity = city;
                    }

                    console.log('‚úÖ ‰ΩèÊâÄÂèñÂæóÊàêÂäü:', fullAddress);
                }
            } catch (error) {
                console.error('‚ùå ‰ΩèÊâÄ„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
            }
        }

        // ÁèæÂú∞Ë™øÊüªÂ∏åÊúõÊó•ÊôÇ„ÅÆÁîüÊàê
        function generateSurveyDates() {
            const container = document.getElementById('surveyDates');

            // ÊõúÊó•„Å®ÊôÇÈñìÂ∏Ø„ÅÆ„Ç™„Éó„Ç∑„Éß„É≥
            const options = [
                { value: 'ÊúàÊõú_ÂçàÂâç', label: 'ÊúàÊõúÊó• ÂçàÂâç' },
                { value: 'ÊúàÊõú_ÂçàÂæå', label: 'ÊúàÊõúÊó• ÂçàÂæå' },
                { value: 'ÁÅ´Êõú_ÂçàÂâç', label: 'ÁÅ´ÊõúÊó• ÂçàÂâç' },
                { value: 'ÁÅ´Êõú_ÂçàÂæå', label: 'ÁÅ´ÊõúÊó• ÂçàÂæå' },
                { value: 'Ê∞¥Êõú_ÂçàÂâç', label: 'Ê∞¥ÊõúÊó• ÂçàÂâç' },
                { value: 'Ê∞¥Êõú_ÂçàÂæå', label: 'Ê∞¥ÊõúÊó• ÂçàÂæå' },
                { value: 'Êú®Êõú_ÂçàÂâç', label: 'Êú®ÊõúÊó• ÂçàÂâç' },
                { value: 'Êú®Êõú_ÂçàÂæå', label: 'Êú®ÊõúÊó• ÂçàÂæå' },
                { value: 'ÈáëÊõú_ÂçàÂâç', label: 'ÈáëÊõúÊó• ÂçàÂâç' },
                { value: 'ÈáëÊõú_ÂçàÂæå', label: 'ÈáëÊõúÊó• ÂçàÂæå' },
                { value: 'ÂúüÊõú_ÂçàÂâç', label: 'ÂúüÊõúÊó• ÂçàÂâç' },
                { value: 'ÂúüÊõú_ÂçàÂæå', label: 'ÂúüÊõúÊó• ÂçàÂæå' },
                { value: 'Êó•Êõú_ÂçàÂâç', label: 'Êó•ÊõúÊó• ÂçàÂâç' },
                { value: 'Êó•Êõú_ÂçàÂæå', label: 'Êó•ÊõúÊó• ÂçàÂæå' },
                { value: 'Êú™ÂÆö', label: 'Êú™ÂÆö' }
            ];

            // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÇíÁîüÊàê
            let html = '';
            for (let i = 0; i < options.length - 1; i += 2) {
                html += `<div class="grid grid-cols-2 gap-2">`;
                html += `
                    <label class="flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-50 cursor-pointer">
                        <input type="checkbox" name="surveyDate" value="${options[i].value}" class="form-checkbox">
                        <span class="text-sm">${options[i].label}</span>
                    </label>
                `;
                if (i + 1 < options.length - 1) {
                    html += `
                        <label class="flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="checkbox" name="surveyDate" value="${options[i+1].value}" class="form-checkbox">
                            <span class="text-sm">${options[i+1].label}</span>
                        </label>
                    `;
                }
                html += `</div>`;
            }
            // Êú™ÂÆö„ÅØÂà•Êû†„ÅßË°®Á§∫
            html += `
                <label class="flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-50 cursor-pointer mt-2">
                    <input type="checkbox" name="surveyDate" value="${options[options.length-1].value}" class="form-checkbox">
                    <span class="text-sm">${options[options.length-1].label}</span>
                </label>
            `;
            container.innerHTML = html;
        }

        // „Éï„Ç©„Éº„É†ÈÄÅ‰ø°
        async function submitForm() {
            // ÈÅ∏Êäû„Åï„Çå„ÅüÊó•ÊôÇ„ÇíÂèñÂæó
            const selectedDates = Array.from(document.querySelectorAll('input[name="surveyDate"]:checked'))
                .map(cb => cb.value);

            if (selectedDates.length === 0) {
                alert('ÁèæÂú∞Ë™øÊüªÂ∏åÊúõÊó•ÊôÇ„Çí1„Å§‰ª•‰∏äÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            // „Éú„Çø„É≥„Çí„É≠„Éº„Éá„Ç£„É≥„Ç∞Áä∂ÊÖã„Å´
            const submitBtn = document.getElementById('submitBtn');
            const prevBtn = document.getElementById('prevStepBtn');
            const originalText = submitBtn.innerHTML;

            submitBtn.disabled = true;
            prevBtn.disabled = true;
            submitBtn.innerHTML = `
                <div class="flex items-center justify-center gap-2">
                    <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span>ÈÄÅ‰ø°‰∏≠...</span>
                </div>
            `;
            submitBtn.classList.add('opacity-75', 'cursor-not-allowed');

            // „Éï„Ç©„Éº„É†„Éá„Éº„Çø„ÇíÂèéÈõÜ
            const formData = {
                // „Çπ„ÉÜ„ÉÉ„Éó1
                name: document.getElementById('userName').value,
                propertyAddress: {
                    postalCode: document.getElementById('propertyZip').value,
                    city: document.getElementById('propertyAddress').value,
                    street: document.getElementById('propertyStreet').value
                },
                isDifferentHome: document.getElementById('differentHome').checked,
                email: document.getElementById('userEmail').value,

                // „Çπ„ÉÜ„ÉÉ„Éó2
                surveyDates: selectedDates,

                // „Ç≠„Éº„ÉóÊ•≠ËÄÖ
                keepCompanies: keepManager.getList()
            };

            // Ëá™ÂÆÖ‰ΩèÊâÄ„ÅåÁï∞„Å™„ÇãÂ†¥Âêà
            if (formData.isDifferentHome) {
                formData.homeAddress = {
                    postalCode: document.getElementById('homeZip').value,
                    city: document.getElementById('homeAddress').value,
                    street: document.getElementById('homeStreet').value
                };
            }

            console.log('ÈÄÅ‰ø°„Éá„Éº„Çø:', formData);

            // üöÄ CV2ÈÄÅ‰ø°ÔºàUPDATEÔºâ
            if (typeof CVAPI !== 'undefined') {
                CVAPI.sendCV2(formData).then(result => {
                    if (result.success) {
                        console.log('‚úÖ CV2ÈÄÅ‰ø°ÊàêÂäü');
                        // ÂÆå‰∫ÜÁîªÈù¢„ÇíË°®Á§∫
                        showCompletionScreen();
                    } else {
                        console.error('‚ùå CV2ÈÄÅ‰ø°Â§±Êïó:', result.error);
                        // „Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
                        submitBtn.disabled = false;
                        prevBtn.disabled = false;
                        submitBtn.innerHTML = originalText;
                        submitBtn.classList.remove('opacity-75', 'cursor-not-allowed');
                        alert('ÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    }
                }).catch(error => {
                    console.error('‚ùå CV2ÈÄÅ‰ø°„Ç®„É©„Éº:', error);
                    // „Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
                    submitBtn.disabled = false;
                    prevBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                    submitBtn.classList.remove('opacity-75', 'cursor-not-allowed');
                    alert('ÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
                });
            } else {
                console.error('‚ùå CVAPI „ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºöÂÆå‰∫ÜÁîªÈù¢„ÇíË°®Á§∫
                showCompletionScreen();
            }
        }

        // ÂÆå‰∫ÜÁîªÈù¢„ÇíË°®Á§∫
        function showCompletionScreen() {
            const modal = document.getElementById('estimateFormModal');

            modal.innerHTML = `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[3000]">
                    <div class="bg-white rounded-lg max-w-md w-full p-6">
                        <div class="text-center">
                            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                            </div>
                            <h2 class="text-2xl font-bold mb-2">ÈÄÅ‰ø°ÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ</h2>
                            <p class="text-gray-600 mb-4">
                                Ë¶ãÁ©ç„ÇÇ„Çä‰æùÈ†º„ÇíÂèó„Åë‰ªò„Åë„Åæ„Åó„Åü„ÄÇ
                            </p>
                            <div class="bg-orange-50 border border-orange-300 p-4 rounded-lg mb-4">
                                <p class="font-semibold text-orange-800 mb-2">ÈáçË¶Å„Å™„ÅäÁü•„Çâ„Åõ</p>
                                <p class="text-sm text-gray-700 mb-2">
                                    ÂºäÁ§æ„Ç™„Éö„É¨„Éº„Çø„Éº„Åã„ÇâÁ∞°Âçò„Å™„ÅîÊú¨‰∫∫ÊßòÁ¢∫Ë™ç„ÅÆ„ÅäÈõªË©±„ÅåÂÖ•„Çä„Åæ„Åô„ÅÆ„Åß„ÅîÂØæÂøú„ÅäÈ°ò„ÅÑ„Åó„Åü„Åó„Åæ„Åô„ÄÇ
                                </p>
                                <p class="text-sm font-semibold text-gray-800">
                                    ÊãÖÂΩìÔºöÂ±±ÂÜÖ
                                </p>
                                <p class="text-lg font-bold text-orange-800">
                                    ÈõªË©±Áï™Âè∑Ôºö090-1994-7162
                                </p>
                            </div>
                            <div class="text-left bg-blue-50 p-4 rounded-lg mb-6">
                                <p class="font-semibold mb-2">‰ªäÂæå„ÅÆÊµÅ„Çå</p>
                                <ol class="text-sm space-y-1">
                                    <li>1. Ê•≠ËÄÖ„Åã„ÇâÈÄ£Áµ°„ÅåÂÖ•„Çä„Åæ„Åô</li>
                                    <li>2. ÁèæÂú∞Ë™øÊüª„ÅÆÊó•Á®ã„ÇíË™øÊï¥</li>
                                    <li>3. Ê≠£Âºè„Å™Ë¶ãÁ©ç„ÇÇ„Çä„Çí„ÅîÊèêÂá∫</li>
                                </ol>
                            </div>
                            <button onclick="window.close();" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition w-full font-bold">
                                Èñâ„Åò„Çã
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // ÈõªË©±Áï™Âè∑„Éï„Ç©„Éº„É†Áî®„ÅÆÈñ¢Êï∞ÔºàÊó¢Â≠ò„Ç∑„Çπ„ÉÜ„É†„Å®„ÅÆ‰∫íÊèõÊÄßÔºâ
        function showPhoneMiniForm() {
            console.log('üìû ÈõªË©±Áï™Âè∑„Éï„Ç©„Éº„É†Ë°®Á§∫');

            const messages = document.getElementById('messages');
            if (!messages) {
                console.error('‚ùå messagesË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }

            const formContainer = document.createElement('div');
            formContainer.className = 'phone-mini-form';
            formContainer.innerHTML = `
                <div class="form-title">
                    ÈõªË©±Áï™Âè∑Ôºà„Ç∑„Éß„Éº„Éà„É°„ÉÉ„Çª„Éº„Ç∏Ôºâ
                </div>
                <div class="elderly-slideshow">
                    <img src="images/elderly-1.png" class="active" alt="">
                    <img src="images/elderly-2.png" alt="">
                    <img src="images/elderly-3.png" alt="">
                </div>
                <div class="phone-input-wrapper">
                    <input type="tel" id="phoneInput" class="phone-input"
                           placeholder="08012345678"
                           maxlength="11"
                           inputmode="numeric"
                           pattern="[0-9]*">
                </div>
                <div class="phone-error" id="phoneError">
                    Ê≠£„Åó„ÅÑÈõªË©±Áï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                </div>
                <button id="phoneSubmitBtn" class="phone-submit-btn" disabled>
                    ÁµêÊûú„ÇíÂèó„ÅëÂèñ„Çã
                </button>
            `;
            messages.appendChild(formContainer);

            // „Çπ„É©„Ç§„Éâ„Ç∑„Éß„ÉºÈñãÂßã
            const slideshowImages = formContainer.querySelectorAll('.elderly-slideshow img');
            let currentSlide = 0;
            setInterval(() => {
                slideshowImages[currentSlide].classList.remove('active');
                currentSlide = (currentSlide + 1) % 3;
                slideshowImages[currentSlide].classList.add('active');
            }, 1000);

            // „Çπ„ÇØ„É≠„Éº„É´
            if (window.BotUI && typeof window.BotUI.scrollToBottom === 'function') {
                window.BotUI.scrollToBottom();
            }

            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
            const phoneInput = document.getElementById('phoneInput');
            const submitBtn = document.getElementById('phoneSubmitBtn');
            const phoneError = document.getElementById('phoneError');

            phoneInput.addEventListener('input', function(e) {
                this.value = this.value.replace(/[^0-9]/g, '');

                if (/^0[0-9]{9,10}$/.test(this.value)) {
                    submitBtn.disabled = false;
                    phoneError.classList.remove('show');
                } else {
                    submitBtn.disabled = true;
                    if (this.value.length >= 10) {
                        phoneError.classList.add('show');
                    }
                }
            });

            // Enter„Ç≠„Éº„ÅßÈÄÅ‰ø°
            phoneInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const phone = phoneInput.value;
                    if (/^0[0-9]{9,10}$/.test(phone)) {
                        submitPhoneNumber(phone);
                    }
                }
            });

            submitBtn.addEventListener('click', () => {
                const phone = phoneInput.value;
                if (/^0[0-9]{9,10}$/.test(phone)) {
                    submitPhoneNumber(phone);
                }
            });
        }

        function submitPhoneNumber(phone) {
            console.log('üìû ÈõªË©±Áï™Âè∑ÈÄÅ‰ø°:', phone);
            localStorage.setItem('userPhone', phone);

            // üöÄ CV1ÈÄÅ‰ø°ÔºàÂç≥ÊôÇ„Çπ„Éó„Ç∑‰øùÂ≠òÔºâ
            if (typeof CVAPI !== 'undefined') {
                CVAPI.sendCV1(phone).then(result => {
                    if (result.success) {
                        console.log('‚úÖ CV1ÈÄÅ‰ø°ÊàêÂäü:', result.cvId);
                    } else {
                        console.error('‚ùå CV1ÈÄÅ‰ø°Â§±Êïó:', result.error);
                    }
                }).catch(error => {
                    console.error('‚ùå CV1ÈÄÅ‰ø°„Ç®„É©„Éº:', error);
                });
            } else {
                console.error('‚ùå CVAPI „ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
            }

            const formElements = document.querySelectorAll('.phone-mini-form');
            formElements.forEach(el => {
                el.style.opacity = '0.5';
                const btn = el.querySelector('button');
                const input = el.querySelector('input');
                if (btn) btn.disabled = true;
                if (input) input.disabled = true;
            });

            setTimeout(() => {
                // „É©„É≥„Ç≠„É≥„Ç∞„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫„Åó„Å¶Q016„ÅÆ„ÇΩ„Éº„ÉàÈ†Ü„ÇíÈÅ©Áî®
                const rankingSection = document.getElementById('rankingSection');
                if (rankingSection) {
                    rankingSection.classList.remove('hidden');
                }

                // „Éí„Ç¢„É™„É≥„Ç∞ÊÆµÈöé„ÇíÂÆå‰∫ÜÁä∂ÊÖã„Å´Ë®≠ÂÆöÔºà„ÇΩ„Éº„ÉàÊ©üËÉΩ„ÇíËß£ÊîæÔºâ
                if (typeof window.completeHearingStage === 'function') {
                    window.completeHearingStage(1);
                    console.log('‚úÖ „Éí„Ç¢„É™„É≥„Ç∞ÊÆµÈöé1ÂÆå‰∫ÜÔºàÈõªË©±Áï™Âè∑ÈÄÅ‰ø°ÂæåÔºâ');
                } else {
                    console.warn('‚ö†Ô∏è completeHearingStageÈñ¢Êï∞„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                }

                // Q016„ÅÆÂõûÁ≠î„Å´Âü∫„Å•„ÅÑ„Å¶„ÇΩ„Éº„ÉàÈ†Ü„ÇíÈÅ©Áî®
                if (typeof BotConfig !== 'undefined' && BotConfig.state && BotConfig.state.userAnswers) {
                    const q016Answer = BotConfig.state.userAnswers['Q016'];
                    if (q016Answer && typeof window.switchSortTab === 'function') {
                        const answerIndex = q016Answer.index;
                        let targetTabId = 'tabRecommend';

                        if (answerIndex === 0) {
                            targetTabId = 'tabRecommend';
                        } else if (answerIndex === 1) {
                            targetTabId = 'tabCheap';
                        } else if (answerIndex === 2) {
                            targetTabId = 'tabReview';
                        } else if (answerIndex === 3) {
                            targetTabId = 'tabQuality';
                        }

                        console.log('üìä ÈõªË©±Áï™Âè∑ÈÄÅ‰ø°Âæå„ÅÆ„ÇΩ„Éº„ÉàÈÅ©Áî®:', q016Answer.choice, '„Çø„Éñ:', targetTabId);
                        window.switchSortTab(targetTabId);
                    }
                }

                // „É¢„Ç∂„Ç§„ÇØËß£Èô§
                const rankingContent = document.getElementById('rankingContent');
                if (rankingContent) {
                    rankingContent.classList.remove('mosaic');
                }

                const mosaicMessage = document.getElementById('mosaicMessage');
                if (mosaicMessage) {
                    mosaicMessage.style.display = 'none';
                }

                // AI„É°„ÉÉ„Çª„Éº„Ç∏
                if (window.BotUI && typeof window.BotUI.showAIMessage === 'function') {
                    window.BotUI.showAIMessage('ÂàÜÊûê„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ<br>„ÅÇ„Å™„Åü„ÅÆÊù°‰ª∂„Å´ÊúÄÈÅ©„Å™Ê•≠ËÄÖ„Çí„É©„É≥„Ç≠„É≥„Ç∞ÂΩ¢Âºè„Åß„ÅîÁ¥π‰ªã„Åó„Åæ„Åô„ÄÇ');
                }

                // ÈÄ≤Êçó100%
                if (window.BotUI && typeof window.BotUI.updateProgress === 'function') {
                    window.BotUI.updateProgress(100);
                }
            }, 1000);
        }

        // ============================================
        // ÂàùÊúüÂåñ
        // ============================================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÈñãÂßã');

            // BOT„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ
            if (window.BotCore && typeof window.BotCore.init === 'function') {
                await window.BotCore.init();
            } else {
                console.error('‚ùå BotCore„ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
            }

            const estimateBtnContainer = document.getElementById('estimateBtnContainer');
            if (estimateBtnContainer) {
                estimateBtnContainer.classList.add('hidden');
            }

            const badges = document.querySelectorAll('.notification-badge');
            badges.forEach(badge => {
                badge.textContent = '0';
            });

            // Ê§úÁ¥¢„Éú„Çø„É≥„Ç§„Éô„É≥„Éà
            const searchButton = document.getElementById('searchButton');
            if (searchButton) {
                searchButton.addEventListener('click', handlePostalCodeSearch);
            }

            // Enter„Ç≠„ÉºÂØæÂøú
            const postalCode = document.getElementById('postalCode');
            if (postalCode) {
                postalCode.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        handlePostalCodeSearch();
                    }
                });
            }

            keepManager.updateUI();

            console.log('‚úÖ „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÂÆå‰∫Ü');
        });
    </script>
</body>
</html>
<!-- Test 20251031-164123 -->
