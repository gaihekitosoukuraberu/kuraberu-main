<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- Deployment: V1818-20251118-02:45 - iPhone UI Fix -->
    <title>Êú¨ÈÉ®ÁÆ°ÁêÜÁîªÈù¢ - Ê°à‰ª∂Ââ≤„ÇäÊåØ„Çä„Ç∑„Çπ„ÉÜ„É†</title>
    <link rel="icon" type="image/png" href="images/7.png">
    <link rel="apple-touch-icon" href="images/7.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; }
        .glass { backdrop-filter: blur(12px); }
        .neon-blue { box-shadow: 0 0 30px rgba(59, 130, 246, 0.5); }
        .neon-green { box-shadow: 0 0 30px rgba(34, 197, 94, 0.5); }
        .form-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        .option-button {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .option-button:hover {
            background: #e2e8f0;
        }
        .option-button.selected {
            background: #3b82f6 !important;
            color: white !important;
            border-color: #3b82f6 !important;
            font-weight: 600 !important;
        }
        /* select„ÅÆplaceholderÔºà„Éá„Éï„Ç©„É´„Éà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ„ÇíËñÑ„ÅÑ„Ç∞„É¨„Éº„Å´ */
        select option[value=""] {
            color: #d1d5db;
        }
        select:invalid {
            color: #d1d5db;
        }
        select option {
            color: #374151;
        }
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 8px;
            margin-top: 8px;
        }
        .time-slot {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 8px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .time-slot:hover {
            background: #e2e8f0;
        }
        .time-slot.selected {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        .ai-button {
            background: linear-gradient(135deg, #8b5cf6 0%, #3b82f6 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .ai-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }
        .map-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            margin-left: 8px;
        }
        .hearing-status {
            background-color: #fef3c7;
            color: #d97706;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .selected-franchise {
            background-color: #fed7aa;
            color: #9a3412;
        }
        .franchise-item {
            background: #fef7ed;
            border: 1px solid #fed7aa;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }
        .franchise-item.selected {
            background: #fed7aa;
            border-color: #f97316;
        }
        .case-card.selected {
            background: #dbeafe;
            border-color: #3b82f6;
            transform: scale(1.02);
        }

        /* „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥„ÅÆÊ®™Êõ∏„Åç„ÇíÂº∑Âà∂ */
        button {
            writing-mode: horizontal-tb !important;
            text-orientation: mixed !important;
            white-space: nowrap !important;
        }

        /* „ÉÜ„Éº„Éñ„É´ÂÜÖ„ÅÆ„Éú„Çø„É≥„ÅÆÁâπÂÆö„Çπ„Çø„Ç§„É´ */
        table button,
        .mobile-card button {
            writing-mode: horizontal-tb !important;
            text-orientation: mixed !important;
            white-space: nowrap !important;
            min-width: auto !important;
            display: inline-block !important;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">
    <!-- „É≠„Ç∞„Ç§„É≥ÁîªÈù¢ -->
    <div id="loginScreen" class="fixed inset-0 bg-gradient-to-br from-blue-50 to-indigo-100 z-[100] flex items-center justify-center">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mb-4">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                    </svg>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">Êú¨ÈÉ®ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</h1>
                <p class="text-gray-500 mt-2">„É≠„Ç∞„Ç§„É≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
            </div>
            
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">„É¶„Éº„Ç∂„ÉºID</label>
                    <input type="text" id="userId" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="„É¶„Éº„Ç∂„ÉºID„ÇíÂÖ•Âäõ">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">„Éë„Çπ„ÉØ„Éº„Éâ</label>
                    <input type="password" id="password" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ">
                </div>
                
                <div class="mb-4">
                    <label class="flex items-center">
                        <input type="checkbox" id="rememberMe" class="rounded text-blue-600 focus:ring-blue-500">
                        <span class="ml-2 text-sm text-gray-600">„É≠„Ç∞„Ç§„É≥Áä∂ÊÖã„Çí‰øùÊåÅ„Åô„Çã</span>
                    </label>
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-2 px-4 rounded-lg hover:from-blue-600 hover:to-indigo-700 font-medium transition-all transform hover:scale-[1.02]">
                    „É≠„Ç∞„Ç§„É≥
                </button>
                
                <div id="loginError" class="mt-4 text-red-600 text-sm text-center hidden"></div>
            </form>
            
            <div class="mt-6 text-center">
                <a href="#" class="text-sm text-blue-600 hover:text-blue-800">„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂøò„Çå„ÅüÊñπ„ÅØ„Åì„Å°„Çâ</a>
            </div>
        </div>
    </div>

    <!-- „É°„Ç§„É≥„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ÔºàÂàùÊúüÁä∂ÊÖã„ÅØÈùûË°®Á§∫Ôºâ -->
    <div id="mainApp" class="hidden">
    <!-- „Éà„ÉÉ„Éó„Éê„Éº -->
    <div class="fixed top-0 left-0 right-0 z-50 h-16 bg-white/95 backdrop-blur-lg border-b border-gray-200 shadow-sm">
        <div class="flex items-center justify-between h-full px-6">
            <div class="flex items-center space-x-4">
                <button onclick="toggleMenu()" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                    <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
                <div class="flex items-center space-x-3">
                    <div class="w-9 h-9 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                        <span class="text-white font-bold text-sm">Êú¨</span>
                    </div>
                    <span class="hidden md:inline-block text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                        Êú¨ÈÉ®ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†
                    </span>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="relative">
                    <button class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                        </svg>
                        <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
                    </button>
                </div>
                <div class="flex items-center space-x-3 px-3 py-1.5 rounded-lg bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200">
                    <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-blue-500 rounded-full shadow-md"></div>
                    <span class="text-sm font-medium text-gray-700">ÁÆ°ÁêÜËÄÖ</span>
                </div>
            </div>
        </div>
    </div>

    <!-- „Çµ„Ç§„Éâ„É°„Éã„É•„Éº -->
    <div id="sideMenu" class="fixed left-0 top-16 bottom-0 w-64 bg-gray-900/95 glass border-r border-gray-200 transform -translate-x-full transition-transform z-40">
        <nav class="p-4 space-y-2">
            <a href="#dashboard" onclick="showSection('dashboard'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
                „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ
            </a>
            <a href="#assignment" onclick="showSection('assignment'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100 relative">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                </svg>
                Ê°à‰ª∂ÁÆ°ÁêÜ
                <span class="ml-auto bg-red-500 text-white text-xs px-2.5 py-1 rounded-full animate-pulse font-bold shadow-lg" title="Êú™Âá¶ÁêÜÊ°à‰ª∂5‰ª∂">
                    <span class="inline-block">5</span>
                    <span class="absolute -top-1 -right-1 w-3 h-3 bg-red-400 rounded-full animate-ping"></span>
                </span>
            </a>
            <a href="#franchise" onclick="showSection('franchise'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                </svg>
                Âä†ÁõüÂ∫óÁÆ°ÁêÜ
            </a>
            <a href="#registration-requests" onclick="showSection('registrationRequests'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100 relative">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                </svg>
                Âä†ÁõüÂ∫óÁôªÈå≤Áî≥Ë´ã
                <span id="registrationRequestBadge" class="ml-auto bg-green-500 text-white text-xs px-2.5 py-1 rounded-full animate-pulse font-bold shadow-lg" style="display:none;">
                    <span class="badge-count inline-block">0</span>
                    <span class="absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-ping"></span>
                </span>
            </a>
            <a href="#cancel-requests" onclick="showSection('cancelRequests'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100 relative">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã
                <span id="cancelRequestBadge" class="ml-auto bg-purple-500 text-white text-xs px-2.5 py-1 rounded-full animate-pulse font-bold shadow-lg">
                    <span class="inline-block">2</span>
                    <span class="absolute -top-1 -right-1 w-3 h-3 bg-purple-400 rounded-full animate-ping"></span>
                </span>
            </a>
            <a href="#financial" onclick="showSection('financial'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
                Ë´ãÊ±Ç„ÉªË≤°Âãô
            </a>
            <a href="#ranking" onclick="showSection('ranking'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
                „É©„É≥„Ç≠„É≥„Ç∞
            </a>

            <!-- Âå∫Âàá„ÇäÁ∑ö -->
            <div class="my-4 border-t border-gray-700"></div>

            <!-- „É≠„Ç∞„Ç¢„Ç¶„Éà -->
            <a href="#" onclick="logout(); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
                „É≠„Ç∞„Ç¢„Ç¶„Éà
            </a>
        </nav>
    </div>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <main class="pt-20 px-6">
            <!-- „Éò„ÉÉ„ÉÄ„Éº -->
            <div class="flex flex-row justify-between items-center mb-8 gap-3">
                <div class="flex items-center gap-2 md:gap-3">
                    <div class="w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                        <svg class="w-5 h-5 md:w-6 md:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl md:text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent">Ê°à‰ª∂ÁÆ°ÁêÜ</h1>
                        <p class="text-xs md:text-sm text-gray-500 mt-0.5">Case Management</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="createNewCase()" class="bg-gradient-to-r from-green-500 to-green-600 text-white p-2.5 md:px-5 md:py-2.5 rounded-xl font-semibold hover:from-green-600 hover:to-green-700 transition-all flex items-center gap-2 shadow-lg hover:shadow-xl transform hover:scale-105">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                        <span class="hidden md:inline">Êñ∞Ë¶è‰ΩúÊàê</span>
                    </button>
                    <button onclick="location.reload()" class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-2.5 rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all shadow-lg hover:shadow-xl transform hover:scale-105" title="Êõ¥Êñ∞">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                    </button>
                    <button onclick="saveAllData()" class="bg-gradient-to-r from-pink-500 to-pink-600 text-white p-2.5 md:px-5 md:py-2.5 rounded-xl font-semibold hover:from-pink-600 hover:to-pink-700 transition-all flex items-center gap-2 shadow-lg hover:shadow-xl transform hover:scale-105">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V2" />
                        </svg>
                        <span class="hidden md:inline">‰øùÂ≠ò</span>
                    </button>
                </div>
            </div>

            <!-- Ê°à‰ª∂‰∏ÄË¶ß -->
            <div class="form-section py-4">
                
                <!-- Ê§úÁ¥¢„Éª„Éï„Ç£„É´„Çø„Éº„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÔºà„É¨„Çπ„Éù„É≥„Ç∑„ÉñÁâàÔºâ -->
                <div class="bg-gradient-to-r from-gray-50 to-white rounded-xl p-4 mb-6 border border-gray-200 shadow-sm">
                    <!-- „É¢„Éê„Ç§„É´: Á∏¶‰∏¶„Å≥„ÄÅPC: „Åô„Åπ„Å¶Ê®™‰∏ÄÂàó -->
                    <div class="flex flex-wrap items-center gap-2 md:gap-3">
                        <!-- Áµ±Ë®à„Éú„Çø„É≥Áæ§Ôºà3„Å§Ê®™‰∏¶„Å≥Ôºâ -->
                        <button onclick="filterByNewStatus()" class="flex items-center gap-1 md:gap-1.5 px-2.5 md:px-3 py-1 md:py-1.5 border-2 border-blue-500 bg-blue-100 text-blue-800 rounded-full shadow-md hover:shadow-lg transition-all cursor-pointer hover:scale-105 transform flex-shrink-0">
                            <span class="text-base md:text-lg font-bold" id="newCount">15</span>
                            <span class="text-xs font-medium">Êñ∞Ë¶è</span>
                        </button>
                        <button onclick="filterByProspect()" class="flex items-center gap-1 md:gap-1.5 px-2.5 md:px-3 py-1 md:py-1.5 border-2 border-orange-600 bg-orange-100 text-orange-800 rounded-full shadow-md hover:shadow-lg transition-all cursor-pointer hover:scale-105 transform flex-shrink-0">
                            <span class="text-base md:text-lg font-bold" id="prospectCount">0</span>
                            <span class="text-xs font-medium">Ë¶ãËæº„Åø</span>
                        </button>
                        <button onclick="filterByAbsent()" class="flex items-center gap-1 md:gap-1.5 px-2.5 md:px-3 py-1 md:py-1.5 border-2 border-yellow-500 bg-yellow-100 text-yellow-800 rounded-full shadow-md hover:shadow-lg transition-all cursor-pointer hover:scale-105 transform flex-shrink-0">
                            <span class="text-base md:text-lg font-bold" id="absentCount">0</span>
                            <span class="text-xs font-medium">ÂØæÂøú‰∏≠</span>
                        </button>

                        <!-- PCÁî®„Çπ„Éö„Éº„Çµ„ÉºÔºàÂ∑¶ÂØÑ„Åõ„Åã„ÇâÂè≥ÂØÑ„Åõ„Å´Âàá„ÇäÊõø„ÅàÔºâ -->
                        <div class="hidden lg:block lg:flex-1"></div>

                        <!-- Ê§úÁ¥¢„Éª„ÇΩ„Éº„Éà„Ç≥„É≥„Éà„É≠„Éº„É´ÔºàÁ∏¶‰∏¶„Å≥Ôºâ -->
                        <div class="flex flex-col gap-2 w-full lg:w-auto lg:min-w-[320px]">
                            <!-- Ê§úÁ¥¢„Éú„ÉÉ„ÇØ„Çπ -->
                            <div class="w-full">
                                <div class="relative">
                                    <input type="text" id="searchInput" placeholder="ÂêçÂâç„Éª‰ΩèÊâÄ„ÉªÈõªË©±Áï™Âè∑„Éª„Ç´„Éä„Å™„Å©..." oninput="searchRegistrations()" autocomplete="off" class="w-full pl-10 pr-10 py-2.5 text-sm border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent shadow-sm transition-all">
                                    <div class="absolute left-3 top-3">
                                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                        </svg>
                                    </div>
                                    <button onclick="clearSearch()" class="absolute right-3 top-3 text-gray-400 hover:text-gray-600 transition-colors" id="clearSearchBtn" style="display: none;">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- „ÇΩ„Éº„Éà„Éú„Çø„É≥„Å®„Ç™„Éó„Ç∑„Éß„É≥ -->
                            <div class="flex items-center gap-2 w-full">
                                <button onclick="openSortModal()" class="px-4 py-2.5 bg-white text-gray-700 border border-gray-300 rounded-xl text-sm font-semibold shadow-sm hover:shadow-md transition-all hover:scale-105 transform whitespace-nowrap">
                                    „ÇΩ„Éº„Éà
                                </button>
                                <select id="sortSelect" class="flex-1 px-3 py-2.5 border border-gray-300 rounded-xl text-sm bg-white shadow-sm focus:ring-2 focus:ring-blue-500 transition-all">
                                    <option value="date-desc">Êñ∞ÁùÄÈ†Ü</option>
                                    <option value="date-asc">Âè§„ÅÑÈ†Ü</option>
                                    <option value="amount-desc">ÈáëÈ°çÈ†Ü</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- „Éì„É•„ÉºÂàá„ÇäÊõø„Åà„Çø„Éñ -->
                <div class="mb-6 mt-8">
                    <div class="flex items-center justify-between">
                        <div class="flex space-x-1 bg-gray-100 p-1 rounded-lg inline-flex">
                            <button id="listViewBtn" class="px-4 py-2 bg-white rounded-md text-sm font-medium text-gray-900 transition-all" onclick="switchView('list')">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                                </svg>
                                „É™„Çπ„Éà
                            </button>
                            <button id="crmViewBtn" class="px-4 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-gray-900 transition-all" onclick="switchView('crm')">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                                CRM
                            </button>
                        </div>
                        <div class="flex items-center gap-3">
                            <!-- „É™„Çπ„ÉàË°®Á§∫ÊôÇ„ÅÆ‰ª∂Êï∞Ë°®Á§∫ -->
                            <div class="text-sm font-semibold text-gray-700 hidden" id="listCountDisplay">
                                <span class="text-blue-600" id="topShowingFrom">0</span>-<span class="text-blue-600" id="topShowingTo">0</span> / <span class="text-gray-900" id="topTotalCount">0</span> ‰ª∂
                            </div>
                            <!-- ÈÅ∏Êäû‰ª∂Êï∞Ë°®Á§∫Ôºà„É™„Çπ„ÉàË°®Á§∫ÊôÇÔºâ -->
                            <div class="text-sm text-gray-600 hidden" id="selectionCountDisplay">
                                ÈÅ∏Êäû: <span class="font-semibold text-blue-600" id="selectedCount">0</span> / <span class="font-semibold" id="currentPageCount">0</span> ‰ª∂
                            </div>
                            <!-- CRMË°®Á§∫ÊôÇ„ÅÆÊ°à‰ª∂‰ΩçÁΩÆË°®Á§∫ -->
                            <div class="text-sm font-semibold text-gray-700 hidden" id="casePositionDisplay">
                                <span class="text-blue-600" id="currentPosition">1</span> / <span class="text-gray-900" id="totalCases">0</span> ‰ª∂
                            </div>
                        </div>
                    </div>
                </div>

                <!-- „É™„Çπ„Éà„Éì„É•„Éº -->
                <div id="listView" class="block">
                    <div class="bg-white rounded-lg border border-gray-200">
                        <!-- PCÁî®„ÉÜ„Éº„Éñ„É´Ë°®Á§∫ -->
                        <div class="overflow-x-auto hidden md:block">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            <input type="checkbox" class="rounded text-blue-600" id="selectAll" onchange="toggleSelectAll()">
                                        </th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            „Çπ„ÉÜ„Éº„Çø„Çπ
                                        </th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            È°ßÂÆ¢Âêç
                                        </th>
                                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            „ÇØ„Ç§„ÉÉ„ÇØ
                                        </th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Áâ©‰ª∂
                                        </th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Á¥π‰ªãÊñô
                                        </th>
                                        <th class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Ë©≥Á¥∞
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="casesListBody" class="bg-white divide-y divide-gray-200">
                                    <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„ÇãÊ°à‰ª∂„É™„Çπ„Éà -->
                                </tbody>
                            </table>
                        </div>

                        <!-- „É¢„Éê„Ç§„É´Áî®„Ç´„Éº„ÉâË°®Á§∫ -->
                        <div id="casesListMobile" class="md:hidden p-4 space-y-4">
                            <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„ÇãÊ°à‰ª∂„Ç´„Éº„Éâ -->
                        </div>
                    </div>

                    <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ -->
                    <div class="flex flex-col sm:flex-row justify-between items-center gap-3 mt-4 px-4 py-3 bg-gradient-to-r from-gray-50 to-white border-t border-gray-200">
                        <div class="text-sm font-semibold text-gray-700">
                            <span class="text-blue-600" id="showingFrom">0</span>-<span class="text-blue-600" id="showingTo">0</span> / <span class="text-gray-900" id="totalCount">0</span> ‰ª∂
                        </div>
                        <div class="flex gap-2 items-center">
                            <button onclick="previousPage()" id="prevBtn" class="px-3 py-1.5 text-sm bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:border-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm">
                                ‚Üê Ââç„Å∏
                            </button>
                            <div class="flex items-center gap-1" id="pageNumbers">
                                <!-- „Éö„Éº„Ç∏Áï™Âè∑„ÅåÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
                            </div>
                            <button onclick="nextPage()" id="nextBtn" class="px-3 py-1.5 text-sm bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:border-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm">
                                Ê¨°„Å∏ ‚Üí
                            </button>
                        </div>
                        <!-- Ë°®Á§∫‰ª∂Êï∞Âàá„ÇäÊõø„Åà -->
                        <select id="itemsPerPage" class="text-sm border border-gray-300 rounded-lg px-3 py-1.5 bg-white shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" onchange="changeItemsPerPage()">
                            <option value="30" selected>30‰ª∂</option>
                            <option value="50">50‰ª∂</option>
                            <option value="100">100‰ª∂</option>
                        </select>
                    </div>
                </div>

                <!-- CRM„Éì„É•„ÉºÔºàÂàùÊúüÈùûË°®Á§∫Ôºâ -->
                <div id="crmView" class="hidden">
                    <div class="bg-white rounded-lg border border-gray-200">
                        <!-- CRM„Éò„ÉÉ„ÉÄ„Éº -->
                        <div class="border-b px-6 py-4 bg-gray-50">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    <!-- „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„ÉÉ„Ç∏Ôºà„ÇØ„É™„ÉÉ„ÇØ„ÅßÂ§âÊõ¥„É¢„Éº„ÉÄ„É´Ë°®Á§∫Ôºâ -->
                                    <div class="relative inline-block">
                                        <button id="crmStatusBadge" onclick="toggleStatusModal()" class="px-5 py-2 rounded-full font-semibold text-base transition-all hover:shadow-lg hover:scale-105 cursor-pointer bg-blue-400 text-white shadow-md">
                                            Êñ∞Ë¶è
                                        </button>
                                        <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
                                        <div id="statusModal" class="hidden absolute top-full left-0 mt-2 bg-white border border-gray-200 rounded-xl shadow-2xl z-50 min-w-[220px] p-3 max-h-[70vh] overflow-y-auto">
                                            <div class="space-y-3">
                                                <!-- ÈÖç‰ø°Ââç„Çπ„ÉÜ„Éº„Çø„Çπ -->
                                                <div>
                                                    <h4 class="text-xs font-medium text-gray-500 mb-2">ÈÖç‰ø°Ââç</h4>
                                                    <div class="space-y-2">
                                                        <button onclick="selectCRMStatus('Êñ∞Ë¶è')" class="w-full px-4 py-2 border-2 border-blue-500 bg-blue-100 text-blue-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">Êñ∞Ë¶è</button>
                                                        <button onclick="selectCRMStatus('‰∏çÂú®')" class="w-full px-4 py-2 border-2 border-gray-500 bg-gray-100 text-gray-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">‰∏çÂú®</button>
                                                        <button onclick="selectCRMStatus('ÂÜçÊû∂Èõª')" class="w-full px-4 py-2 border-2 border-yellow-500 bg-yellow-100 text-yellow-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÂÜçÊû∂Èõª</button>
                                                        <button onclick="selectCRMStatus('Ë¶ãËæº„Åø')" class="w-full px-4 py-2 border-2 border-orange-600 bg-orange-100 text-orange-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">Ë¶ãËæº„Åø</button>
                                                        <button onclick="selectCRMStatus('„É≠„Çπ„Éà')" class="w-full px-4 py-2 border-2 border-indigo-500 bg-indigo-100 text-indigo-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">„É≠„Çπ„Éà</button>
                                                        <button onclick="selectCRMStatus('ÈÖç‰ø°‰∏≠')" class="w-full px-4 py-2 border-2 border-amber-600 bg-amber-100 text-amber-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÈÖç‰ø°‰∏≠</button>
                                                        <button onclick="selectCRMStatus('ÈÖç‰ø°Ê∏à')" class="w-full px-4 py-2 border-2 border-green-600 bg-green-100 text-green-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÈÖç‰ø°Ê∏à</button>
                                                        <button onclick="selectCRMStatus('‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à')" class="w-full px-4 py-2 border-2 border-slate-500 bg-slate-100 text-slate-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à</button>
                                                        <button onclick="selectCRMStatus('ÁÑ°Âäπ')" class="w-full px-4 py-2 border-2 border-gray-600 bg-gray-100 text-gray-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÁÑ°Âäπ</button>
                                                        <button onclick="selectCRMStatus('„ÇØ„É¨„Éº„É†')" class="w-full px-4 py-2 border-2 border-red-700 bg-red-100 text-red-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">„ÇØ„É¨„Éº„É†</button>
                                                    </div>
                                                </div>
                                                <!-- ÈÖç‰ø°Âæå„Çπ„ÉÜ„Éº„Çø„Çπ -->
                                                <div>
                                                    <h4 class="text-xs font-medium text-gray-500 mb-2">ÈÖç‰ø°Âæå</h4>
                                                    <div class="space-y-2">
                                                        <button onclick="selectCRMStatus('„Ç¢„ÉùÊ∏à')" class="w-full px-4 py-2 border-2 border-orange-500 bg-orange-100 text-orange-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">„Ç¢„ÉùÊ∏à</button>
                                                        <button onclick="selectCRMStatus('ÁèæË™øÊ∏à')" class="w-full px-4 py-2 border-2 border-orange-600 bg-orange-100 text-orange-900 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÁèæË™øÊ∏à</button>
                                                        <button onclick="selectCRMStatus('Ë¶ãÁ©çÊèêÂá∫Ê∏à')" class="w-full px-4 py-2 border-2 border-red-600 bg-red-100 text-red-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">Ë¶ãÁ©çÊèêÂá∫Ê∏à</button>
                                                        <button onclick="selectCRMStatus('ÂÖ•Èáë‰∫àÂÆö')" class="w-full px-4 py-2 border-2 border-red-700 bg-red-100 text-red-900 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÂÖ•Èáë‰∫àÂÆö</button>
                                                        <button onclick="selectCRMStatus('ÂÖ•ÈáëÂÆå‰∫Ü')" class="w-full px-4 py-2 border-2 border-purple-700 bg-purple-100 text-purple-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÂÖ•ÈáëÂÆå‰∫Ü</button>
                                                        <button onclick="selectCRMStatus('ÂÆå‰∫Ü')" class="w-full px-4 py-2 border-2 border-green-700 bg-green-100 text-green-900 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÂÆå‰∫Ü</button>
                                                        <button onclick="selectCRMStatus('Á¥π‰ªãÂæå„Ç≠„É£„É≥„Çª„É´')" class="w-full px-4 py-2 border-2 border-cyan-600 bg-cyan-100 text-cyan-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">Á¥π‰ªãÂæå„Ç≠„É£„É≥„Çª„É´</button>
                                                        <button onclick="selectCRMStatus('ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´')" class="w-full px-4 py-2 border-2 border-blue-600 bg-blue-100 text-blue-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´</button>
                                                        <button onclick="selectCRMStatus('ÁèæË™øÂæå„É≠„Çπ„Éà')" class="w-full px-4 py-2 border-2 border-indigo-600 bg-indigo-100 text-indigo-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÁèæË™øÂæå„É≠„Çπ„Éà</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Êû∂ÈõªÂ±•Ê≠¥„Éú„Çø„É≥ -->
                                    <div class="relative group inline-block">
                                        <button onclick="openCallHistoryModal()" class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-all text-2xl" title="Êû∂ÈõªÂ±•Ê≠¥">
                                            üìù
                                        </button>
                                        <!-- „É°„É¢Â±•Ê≠¥„ÅÆ„Éõ„Éê„ÉºË°®Á§∫ -->
                                        <div class="absolute top-full left-0 mt-2 hidden group-hover:block z-50 w-64">
                                            <div class="bg-gray-900 text-white text-xs rounded-lg py-2 px-3">
                                                <div class="font-semibold mb-1">„É°„É¢Â±•Ê≠¥:</div>
                                                <div id="crmMemoPreview">„É°„É¢„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì</div>
                                                <div class="absolute bottom-full left-4 -mb-1">
                                                    <div class="border-4 border-transparent border-b-gray-900"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="previousCase()" class="px-4 py-2 bg-white text-gray-700 rounded-lg border hover:bg-gray-50 transition-all">
                                        <span class="md:hidden">‚Üê</span>
                                        <span class="hidden md:inline">‚Üê Ââç„ÅÆÊ°à‰ª∂</span>
                                    </button>
                                    <button onclick="nextCase()" class="px-4 py-2 bg-white text-gray-700 rounded-lg border hover:bg-gray-50 transition-all">
                                        <span class="md:hidden">‚Üí</span>
                                        <span class="hidden md:inline">Ê¨°„ÅÆÊ°à‰ª∂ ‚Üí</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- CRM„Ç≥„É≥„ÉÜ„É≥„ÉÑÔºàÊó¢Â≠ò„ÅÆ„Éï„Ç©„Éº„É†ÈÉ®ÂàÜÔºâ -->
                        <div class="p-6" id="crmContent">
                            <!-- „Åì„Åì„Å´Êó¢Â≠ò„ÅÆ„Éï„Ç©„Éº„É†„ÅåÂÖ•„Çã -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- „ÅîÊú¨‰∫∫„Åï„ÅæÊÉÖÂ†±ÔºàÂÖÉ„ÅÆÂ†¥ÊâÄ„ÄÅCRMÁî®„Å´„ÇÇ‰ΩøÁî®Ôºâ -->
<!-- „ÅîÊú¨‰∫∫„Åï„ÅæÊÉÖÂ†±ÔºàÂÖÉ„ÅÆÂ†¥ÊâÄ„ÄÅCRMÁî®„Å´„ÇÇ‰ΩøÁî®Ôºâ -->
            <div id="originalFormContent" style="display: none;">
            <!-- üé® Âü∫Êú¨ÊÉÖÂ†± -->
            <div class="form-section bg-gradient-to-br from-blue-50 to-white rounded-xl shadow-sm border border-blue-100 p-4 mb-4">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                        <svg class="w-6 h-6 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                        <h2 id="sectionTitle" class="text-base sm:text-lg font-bold text-gray-900">Âü∫Êú¨ÊÉÖÂ†±</h2>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                    <div class="relative">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Ê∞èÂêçÔºàÊº¢Â≠óÔºâ<span class="text-red-500 ml-1">*</span></label>
                        <input type="text" id="crmNameInput" placeholder="‰æã: Áî∞‰∏≠Â§™ÈÉé" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                    </div>
                    <div class="relative">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Ê∞èÂêçÔºà„Ç´„ÉäÔºâ<span class="text-red-500 ml-1">*</span></label>
                        <input type="text" id="crmKanaInput" placeholder="‰æã: „Çø„Éä„Ç´„Çø„É≠„Ç¶" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                    </div>
                    <div class="relative">
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÈõªË©±Áï™Âè∑<span class="text-red-500 ml-1">*</span></label>
                        <input type="tel" placeholder="‰æã: 090-1234-5678" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                    </div>
                    <div class="relative">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Èñ¢‰øÇÊÄß</label>
                        <select id="relationSelect" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all appearance-none bg-white">
                            <option value="Êú¨‰∫∫" selected>Êú¨‰∫∫</option>
                            <option value="ÈÖçÂÅ∂ËÄÖ">ÈÖçÂÅ∂ËÄÖ</option>
                            <option value="Ë¶™">Ë¶™</option>
                            <option value="Â≠ê">Â≠ê</option>
                            <option value="„Åù„ÅÆ‰ªñ">„Åù„ÅÆ‰ªñ</option>
                        </select>
                    </div>
                    <div class="relative">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÊÄßÂà•</label>
                        <div class="grid grid-cols-2 gap-2" id="genderButtonGroup" data-single-select="true">
                            <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-sm font-medium text-gray-700" data-gender="Áî∑ÊÄß">Áî∑ÊÄß</button>
                            <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-sm font-medium text-gray-700" data-gender="Â•≥ÊÄß">Â•≥ÊÄß</button>
                        </div>
                        <input type="hidden" id="genderSelect" value="">
                    </div>
                    <div class="relative">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Âπ¥ÈΩ¢</label>
                        <div class="grid grid-cols-5 gap-1.5" id="ageButtonGroup" data-single-select="true">
                            <button type="button" class="option-button px-1 py-1 sm:px-2 sm:py-1.5 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-[10px] sm:text-xs font-medium text-gray-700" data-age="30‰ª£">30‰ª£</button>
                            <button type="button" class="option-button px-1 py-1 sm:px-2 sm:py-1.5 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-[10px] sm:text-xs font-medium text-gray-700" data-age="40‰ª£">40‰ª£</button>
                            <button type="button" class="option-button px-1 py-1 sm:px-2 sm:py-1.5 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-[10px] sm:text-xs font-medium text-gray-700" data-age="50‰ª£">50‰ª£</button>
                            <button type="button" class="option-button px-1 py-1 sm:px-2 sm:py-1.5 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-[10px] sm:text-xs font-medium text-gray-700" data-age="60‰ª£">60‰ª£</button>
                            <button type="button" class="option-button px-1 py-1 sm:px-2 sm:py-1.5 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-[10px] sm:text-xs font-medium text-gray-700" data-age="70‰ª£">70‰ª£</button>
                        </div>
                        <input type="hidden" id="ageSelect" value="">
                    </div>
                    <div class="relative sm:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                        <input type="email" placeholder="‰æã: example@email.com" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                    </div>
                </div>

                <!-- 2‰∫∫ÁõÆÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥Ôºà„Éà„Ç∞„É´ÂºèÔºâ -->
                <div class="mt-6">
                    <button type="button" onclick="toggleSecondPerson()" class="flex items-center text-blue-600 hover:text-blue-700 font-medium transition-colors">
                        <svg id="secondPersonToggleIcon" class="w-5 h-5 mr-2 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                        <span id="secondPersonToggleText">2‰∫∫ÁõÆ„ÅÆÊÉÖÂ†±„ÇíËøΩÂä†</span>
                    </button>
                    <div id="secondPersonSection" class="hidden mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Ê∞èÂêçÔºà2‰∫∫ÁõÆÔºâ</label>
                                <input type="text" id="name2Input" placeholder="‰æã: Áî∞‰∏≠Ëä±Â≠ê" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ÈõªË©±Áï™Âè∑Ôºà2‰∫∫ÁõÆÔºâ</label>
                                <input type="tel" id="phone2Input" placeholder="‰æã: 080-5678-1234" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Èñ¢‰øÇÊÄßÔºà2‰∫∫ÁõÆÔºâ</label>
                                <select id="relationship2Select" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all appearance-none bg-white">
                                    <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                    <option value="Êú¨‰∫∫">Êú¨‰∫∫</option>
                                    <option value="ÈÖçÂÅ∂ËÄÖ">ÈÖçÂÅ∂ËÄÖ</option>
                                    <option value="Ë¶™">Ë¶™</option>
                                    <option value="Â≠ê">Â≠ê</option>
                                    <option value="„Åù„ÅÆ‰ªñ">„Åù„ÅÆ‰ªñ</option>
                                </select>
                            </div>
                            <div class="sm:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">„É°„É¢Ôºà2‰∫∫ÁõÆÔºâ</label>
                                <textarea id="memo2Input" rows="2" placeholder="2‰∫∫ÁõÆ„ÅÆÊñπ„Å´Èñ¢„Åô„ÇãË£úË∂≥ÊÉÖÂ†±" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- üè† Áâ©‰ª∂„Éó„É≠„Éï„Ç£„Éº„É´ -->
            <div class="form-section bg-gradient-to-br from-green-50 to-white rounded-xl shadow-sm border border-green-100 p-4 mb-4">
                <div class="flex items-center mb-3">
                    <svg class="w-6 h-6 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                    <h2 class="text-xl font-bold text-gray-900">Áâ©‰ª∂„Éó„É≠„Éï„Ç£„Éº„É´</h2>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                    <div class="relative">
                        <label class="flex justify-between items-center text-sm font-medium text-gray-700 mb-1">
                            <span>ÈöéÊï∞</span>
                            <button type="button" onclick="copyFieldValue(event, 'floorsSelect')" class="copy-btn ml-2 p-0.5 text-gray-400 hover:text-blue-500 transition-colors" title="„Ç≥„Éî„Éº">
                                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                            </button>
                        </label>
                        <input type="text" id="floorsSelect" list="floorsList" placeholder="ÈÅ∏Êäû„Åæ„Åü„ÅØÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" onfocus="this.select()">
                        <datalist id="floorsList">
                            <option value="1ÈöéÂª∫„Å¶">
                            <option value="2ÈöéÂª∫„Å¶">
                            <option value="3ÈöéÂª∫„Å¶">
                            <option value="4ÈöéÂª∫„Å¶">
                            <option value="5ÈöéÂª∫„Å¶">
                            <option value="6ÈöéÂª∫„Å¶">
                            <option value="7ÈöéÂª∫„Å¶">
                            <option value="8ÈöéÂª∫„Å¶">
                            <option value="9ÈöéÂª∫„Å¶">
                            <option value="10ÈöéÂª∫„Å¶‰ª•‰∏ä">
                            <option value="4ÈöéÂª∫„Å¶‰ª•‰∏ä">
                        </datalist>
                    </div>
                    <div class="relative">
                        <label class="flex justify-between items-center text-sm font-medium text-gray-700 mb-1">
                            <span>Áâ©‰ª∂Á®ÆÂà•<span class="text-red-500 ml-1">*</span></span>
                            <button type="button" onclick="copyFieldValue(event, 'propertyTypeSelect')" class="copy-btn ml-2 p-0.5 text-gray-400 hover:text-blue-500 transition-colors" title="„Ç≥„Éî„Éº">
                                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                            </button>
                        </label>
                        <input type="text" id="propertyTypeSelect" list="propertyTypeList" placeholder="ÈÅ∏Êäû„Åæ„Åü„ÅØÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" onfocus="this.select()">
                        <datalist id="propertyTypeList">
                            <option value="Êà∏Âª∫„Å¶">
                            <option value="„Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥">
                            <option value="Â∫óËàó„Éª‰∫ãÂãôÊâÄ">
                            <option value="Â∑•Â†¥„ÉªÂÄâÂ∫´">
                            <option value="„Åù„ÅÆ‰ªñ">
                        </datalist>
                    </div>
                    <div class="relative">
                        <label class="flex justify-between items-center text-sm font-medium text-gray-700 mb-1">
                            <span>ÁØâÂπ¥Êï∞</span>
                            <button type="button" onclick="copyFieldValue(event, 'buildingAgeSelect')" class="copy-btn ml-2 p-0.5 text-gray-400 hover:text-blue-500 transition-colors" title="„Ç≥„Éî„Éº">
                                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                            </button>
                        </label>
                        <input type="text" id="buildingAgeSelect" list="buildingAgeList" placeholder="ÈÅ∏Êäû„Åæ„Åü„ÅØÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" onfocus="this.select()">
                        <datalist id="buildingAgeList">
                            <option value="5Âπ¥Êú™Ê∫Ä">
                            <option value="5„Äú9Âπ¥">
                            <option value="10„Äú15Âπ¥">
                            <option value="15„Äú30Âπ¥">
                            <option value="30Âπ¥‰ª•‰∏ä">
                        </datalist>
                    </div>
                    <div class="relative">
                        <label class="flex justify-between items-center text-sm font-medium text-gray-700 mb-1">
                            <span>ÊñΩÂ∑•ÂõûÊï∞</span>
                            <button type="button" onclick="copyFieldValue(event, 'constructionCountSelect')" class="copy-btn ml-2 p-0.5 text-gray-400 hover:text-blue-500 transition-colors" title="„Ç≥„Éî„Éº">
                                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                            </button>
                        </label>
                        <input type="text" id="constructionCountSelect" list="constructionCountList" placeholder="ÈÅ∏Êäû„Åæ„Åü„ÅØÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" onfocus="this.select()">
                        <datalist id="constructionCountList">
                            <option value="‰ªäÂõû„ÅåÂàù„ÇÅ„Å¶">
                            <option value="2ÂõûÁõÆ">
                            <option value="3ÂõûÁõÆ‰ª•‰∏ä">
                        </datalist>
                    </div>
                    <div class="relative">
                        <label class="flex justify-between items-center text-sm font-medium text-gray-700 mb-1">
                            <span>ÂâçÂõûÊñΩÂ∑•ÊôÇÊúü</span>
                            <button type="button" onclick="copyFieldValue(event, 'previousConstructionSelect')" class="copy-btn ml-2 p-0.5 text-gray-400 hover:text-blue-500 transition-colors" title="„Ç≥„Éî„Éº">
                                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                            </button>
                        </label>
                        <input type="text" id="previousConstructionSelect" list="previousConstructionList" placeholder="ÈÅ∏Êäû„Åæ„Åü„ÅØÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" onfocus="this.select()">
                        <datalist id="previousConstructionList">
                            <option value="1„Äú4Âπ¥Ââç">
                            <option value="5„Äú9Âπ¥Ââç">
                            <option value="10„Äú15Âπ¥Ââç">
                            <option value="16„Äú20Âπ¥Ââç">
                            <option value="20Âπ¥‰ª•‰∏äÂâç">
                            <option value="‰∏çÊòé">
                        </datalist>
                    </div>
                    <div class="relative">
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÈÉµ‰æøÁï™Âè∑<span class="text-red-500 ml-1">*</span></label>
                        <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2">
                            <input type="text" id="zipInput" placeholder="150-0001" class="flex-1 px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all">
                            <button type="button" onclick="fetchAddress()" class="px-4 py-2.5 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors whitespace-nowrap text-sm font-medium">
                                ‰ΩèÊâÄÂèñÂæó
                            </button>
                        </div>
                    </div>
                    <div class="relative">
                        <label class="block text-sm font-medium text-gray-700 mb-1">‰ΩèÊâÄ<span class="text-red-500 ml-1">*</span></label>
                        <input type="text" id="addressInput" placeholder="‰æã: Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫Á•ûÂÆÆÂâç" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all">
                        <div id="addressKanaDisplay" class="text-xs text-gray-400 mt-1"></div>
                    </div>
                    <div class="relative">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Áï™Âú∞<span class="text-red-500 ml-1">*</span></label>
                        <input type="text" id="addressNumberInput" placeholder="‰æã: 1-1-1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all">
                    </div>
                    <div class="relative sm:col-span-2 lg:col-span-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Google„Éû„ÉÉ„Éó</label>
                        <div class="flex flex-col gap-2">
                            <input type="text" id="mapLinkInput" placeholder="URL„ÅåËá™ÂãïÁîüÊàê„Åï„Çå„Åæ„Åô" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all">
                            <div class="flex gap-2">
                                <button type="button" onclick="generateGoogleMapLink()" class="flex-1 px-4 py-2.5 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-sm font-medium">
                                    ÁîüÊàê
                                </button>
                                <button type="button" onclick="openMapLink()" class="flex-1 px-4 py-2.5 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-sm font-medium">
                                    Èñã„Åè
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ëá™ÂÆÖ‰ΩèÊâÄ„Çª„ÇØ„Ç∑„Éß„É≥Ôºà„Éà„Ç∞„É´ÂºèÔºâ -->
                <div class="mt-6">
                    <button type="button" onclick="toggleHomeAddress()" class="flex items-center text-green-600 hover:text-green-700 font-medium transition-colors">
                        <svg id="homeAddressToggleIcon" class="w-5 h-5 mr-2 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                        <span id="homeAddressToggleText">Ëá™ÂÆÖ‰ΩèÊâÄ</span>
                    </button>
                    <div id="homeAddressSection" class="hidden mt-4 p-4 bg-green-50 rounded-lg border border-green-200">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ÈÉµ‰æøÁï™Âè∑ÔºàËá™ÂÆÖÔºâ</label>
                                <input type="text" id="homeZipInput" placeholder="‰æã: 150-0001" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all">
                            </div>
                            <div class="sm:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">‰ΩèÊâÄÔºàËá™ÂÆÖÔºâ</label>
                                <input type="text" id="homeAddressInput" placeholder="‰æã: Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Â§ñÂ£ÅÊùêË≥™„ÉªÂ±ãÊ†πÊùêË≥™ -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-6">
                    <div class="relative">
                        <label class="flex justify-between items-center text-sm font-medium text-gray-700 mb-1">
                            <span>Â§ñÂ£ÅÊùêË≥™</span>
                            <button type="button" onclick="copyFieldValue(event, 'wallMaterialSelect')" class="copy-btn ml-2 p-0.5 text-gray-400 hover:text-blue-500 transition-colors" title="„Ç≥„Éî„Éº">
                                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                            </button>
                        </label>
                        <input type="text" id="wallMaterialSelect" list="wallMaterialList" placeholder="ÈÅ∏Êäû„Åæ„Åü„ÅØÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" onfocus="this.select()">
                        <datalist id="wallMaterialList">
                            <option value="„Çµ„Ç§„Éá„Ç£„É≥„Ç∞">
                            <option value="„É¢„É´„Çø„É´">
                            <option value="„Ç¨„É´„Éê„É™„Ç¶„É†">
                            <option value="ALC">
                            <option value="„Çø„Ç§„É´">
                            <option value="„Åù„ÅÆ‰ªñ">
                            <option value="‰∏çÊòé">
                        </datalist>
                    </div>
                    <div class="relative">
                        <label class="flex justify-between items-center text-sm font-medium text-gray-700 mb-1">
                            <span>Â±ãÊ†πÊùêË≥™</span>
                            <button type="button" onclick="copyFieldValue(event, 'roofMaterialSelect')" class="copy-btn ml-2 p-0.5 text-gray-400 hover:text-blue-500 transition-colors" title="„Ç≥„Éî„Éº">
                                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                            </button>
                        </label>
                        <input type="text" id="roofMaterialSelect" list="roofMaterialList" placeholder="ÈÅ∏Êäû„Åæ„Åü„ÅØÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" onfocus="this.select()">
                        <datalist id="roofMaterialList">
                            <option value="„Çπ„É¨„Éº„Éà">
                            <option value="„Ç¨„É´„Éê„É™„Ç¶„É†">
                            <option value="Â±ã‰∏ä">
                            <option value="Áì¶">
                            <option value="„Éà„Çø„É≥">
                            <option value="„Åù„ÅÆ‰ªñ">
                            <option value="‰∏çÊòé">
                        </datalist>
                    </div>
                </div>
            </div>

            <!-- üìã Ë¶ãÁ©ç„ÇÇ„ÇäË©≥Á¥∞ -->
            <div class="form-section bg-gradient-to-br from-purple-50 to-white rounded-xl shadow-sm border border-purple-100 p-4 mb-4">
                <div class="flex items-center mb-3">
                    <svg class="w-6 h-6 text-purple-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                    </svg>
                    <h2 class="text-xl font-bold text-gray-900">Ë¶ãÁ©ç„ÇÇ„ÇäË©≥Á¥∞</h2>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ë¶ãÁ©ç„ÇÇ„ÇäÂ∏åÊúõÁÆáÊâÄ</label>
                    <div id="workItemsButtons" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2">
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight" data-value="Â§ñÂ£ÅÂ°óË£Ö">Â§ñÂ£ÅÂ°óË£Ö</button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight" data-value="Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï">
                            <span class="sm:hidden">Â§ñÂ£Å„Ç´„Éê„Éº</span>
                            <span class="hidden sm:inline">Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï</span>
                        </button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight" data-value="Â§ñÂ£ÅÂºµÊõø„Åà">Â§ñÂ£ÅÂºµÊõø„Åà</button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight" data-value="Â±ãÊ†πÂ°óË£Ö">Â±ãÊ†πÂ°óË£Ö</button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight" data-value="Â±ã‰∏äÈò≤Ê∞¥">Â±ã‰∏äÈò≤Ê∞¥</button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight" data-value="Â±ãÊ†πËë∫„ÅçÊõø„ÅàÔºà„Çπ„É¨„Éº„ÉàÔºâ">
                            <span class="sm:hidden">Â±ãÊ†πËë∫(ÔΩΩÔæö)</span>
                            <span class="hidden sm:inline">Â±ãÊ†πËë∫„ÅçÊõø„ÅàÔºà„Çπ„É¨„Éº„ÉàÔºâ</span>
                        </button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight" data-value="Â±ãÊ†πËë∫„ÅçÊõø„ÅàÔºàÁì¶Ôºâ">
                            <span class="sm:hidden">Â±ãÊ†πËë∫(Áì¶)</span>
                            <span class="hidden sm:inline">Â±ãÊ†πËë∫„ÅçÊõø„ÅàÔºàÁì¶Ôºâ</span>
                        </button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight" data-value="Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï">
                            <span class="sm:hidden">Â±ãÊ†π„Ç´„Éê„Éº</span>
                            <span class="hidden sm:inline">Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï</span>
                        </button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight" data-value="Â§ñÂ£ÅË£ú‰øÆ">Â§ñÂ£ÅË£ú‰øÆ</button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight" data-value="Â±ãÊ†πË£ú‰øÆ">Â±ãÊ†πË£ú‰øÆ</button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight" data-value="Â§ñÂ£Å‰∏çÊòé">Â§ñÂ£Å‰∏çÊòé</button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight" data-value="Â±ãÊ†π‰∏çÊòé">Â±ãÊ†π‰∏çÊòé</button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight" data-value="„Éô„É©„É≥„ÉÄÈò≤Ê∞¥">„Éô„É©„É≥„ÉÄÈò≤Ê∞¥</button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight" data-value="ÂÜÖË£ÖÊ∞¥Âõû„Çä">ÂÜÖË£ÖÊ∞¥Âõû„Çä</button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight" data-value="ÂÜÖË£ÖÔºàÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâ">
                            <span class="sm:hidden">ÂÜÖË£ÖÔºàÂÆ§ÂÜÖÔºâ</span>
                            <span class="hidden sm:inline">ÂÜÖË£ÖÔºàÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâ</span>
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÁèæÂú®„ÅÆÂä£ÂåñÁä∂Ê≥Å</label>
                        <select id="deteriorationStatusSelect" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all appearance-none bg-white">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <option value="„Éí„Éì„ÇÑÂâ≤„Çå„Åå„ÅÇ„Çã">„Éí„Éì„ÇÑÂâ≤„Çå„Åå„ÅÇ„Çã</option>
                            <option value="Ëâ≤Ë§™„Åõ„ÇÑÊ±ö„Çå„ÅåÁõÆÁ´ã„Å§">Ëâ≤Ë§™„Åõ„ÇÑÊ±ö„Çå„ÅåÁõÆÁ´ã„Å§</option>
                            <option value="Èõ®Êºè„Çä„Åå„ÅÇ„Çã">Èõ®Êºè„Çä„Åå„ÅÇ„Çã</option>
                            <option value="Â§ß„Åç„Å™Âä£Âåñ„ÅØÊÑü„Åò„Å™„ÅÑ">Â§ß„Åç„Å™Âä£Âåñ„ÅØÊÑü„Åò„Å™„ÅÑ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‰ªñÁ§æË¶ãÁ©ç„ÇÇ„ÇäÊï∞</label>
                        <select id="quoteCountSelect" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all appearance-none bg-white">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <option value="„Å™„Åó">„Å™„Åó</option>
                            <option value="1Á§æ">1Á§æ</option>
                            <option value="2Á§æ">2Á§æ</option>
                            <option value="3Á§æ‰ª•‰∏ä">3Á§æ‰ª•‰∏ä</option>
                        </select>
                    </div>
                    <div>
                        <label class="flex justify-between items-center text-sm font-medium text-gray-700 mb-1">
                            <span>Ë¶ãÁ©ç„ÇÇ„ÇäÂèñÂæóÂÖà</span>
                            <button type="button" onclick="copyFieldValue(event, 'quoteSourceInput')" class="copy-btn ml-2 p-0.5 text-gray-400 hover:text-blue-500 transition-colors" title="„Ç≥„Éî„Éº">
                                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                            </button>
                        </label>
                        <input id="quoteSourceInput" type="text" list="quoteSourceList" placeholder="ÈÅ∏Êäû„Åæ„Åü„ÅØÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
                        <datalist id="quoteSourceList">
                            <option value="Ë®™ÂïèÂñ∂Ê•≠">
                            <option value="„Éù„Éº„Çø„É´„Çµ„Ç§„ÉàÔºà„Éç„ÉÉ„Éà„Åß„ÅÆÊØîËºÉ„Çµ„Éº„Éì„ÇπÔºâ">
                            <option value="ËøëÊâÄ„ÅÆÊ•≠ËÄÖ">
                            <option value="ÂâçÂõûÊñΩÂ∑•Ê•≠ËÄÖ">
                            <option value="Áü•‰∫∫„ÇÑÂÆ∂Êóè„ÅÆÁ¥π‰ªã">
                            <option value="Âª∫„Å¶„Åü„Å®„Åì„ÇçÔºà„Éè„Ç¶„Çπ„É°„Éº„Ç´„ÉºÁ≠âÔºâ">
                        </datalist>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Ë®™ÂïèÊ•≠ËÄÖ„ÅÆÁä∂Ê≥Å</label>
                        <select id="doorSalesVisitSelect" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all appearance-none bg-white">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <option value="ÊúÄËøëÊù•„Åü„ÅåË¶ãÁ©çÊõ∏„ÅØ„Åæ„Å†ÊâãÂÖÉ„Å´„Å™„ÅÑ">ÊúÄËøëÊù•„Åü„ÅåË¶ãÁ©çÊõ∏„ÅØ„Åæ„Å†ÊâãÂÖÉ„Å´„Å™„ÅÑ</option>
                            <option value="ÊúÄËøëÊù•„Å¶Ë¶ãÁ©çÊõ∏„Çí„ÇÇ„Çâ„Å£„Åü„ÅåÊú™Â•ëÁ¥Ñ">ÊúÄËøëÊù•„Å¶Ë¶ãÁ©çÊõ∏„Çí„ÇÇ„Çâ„Å£„Åü„ÅåÊú™Â•ëÁ¥Ñ</option>
                            <option value="ÊúÄËøëÊù•„Å¶Â•ëÁ¥Ñ„Åó„Åü">ÊúÄËøëÊù•„Å¶Â•ëÁ¥Ñ„Åó„Åü</option>
                            <option value="Êù•„Å¶„ÅÑ„Å™„ÅÑ">Êù•„Å¶„ÅÑ„Å™„ÅÑ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÊµÅÂÖ•Ê§úÁ¥¢„ÉØ„Éº„Éâ</label>
                        <input type="text" id="searchKeywordInput" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all" placeholder="‰æãÔºöÂ§ñÂ£ÅÂ°óË£Ö Á•ûÂ•àÂ∑ù">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÊñΩÂ∑•ÊôÇÊúü</label>
                        <select id="constructionTimingSelect" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all appearance-none bg-white">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <option value="„Åô„Åê„Å´">„Åô„Åê„Å´</option>
                            <option value="„Åù„Çç„Åù„Çç" selected>„Åù„Çç„Åù„Çç</option>
                            <option value="3„É∂Êúà‰ª•ÂÜÖ">3„É∂Êúà‰ª•ÂÜÖ</option>
                            <option value="ÂçäÂπ¥‰ª•ÂÜÖ">ÂçäÂπ¥‰ª•ÂÜÖ</option>
                            <option value="Êú™ÂÆö">Êú™ÂÆö</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- üìû ÁèæÂú∞Ë™øÊüª -->
            <div class="form-section bg-gradient-to-br from-orange-50 to-white rounded-xl shadow-sm border border-orange-100 p-4 mb-4">
                <div class="flex items-center mb-3">
                    <svg class="w-6 h-6 text-orange-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <h2 class="text-xl font-bold text-gray-900">ÁèæÂú∞Ë™øÊüª</h2>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Á´ã„Å°‰ºö„ÅÑÂèØÂê¶</label>
                        <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all appearance-none bg-white">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <option value="Ë™øÊï¥ÂèØËÉΩ" selected>Ë™øÊï¥ÂèØËÉΩ</option>
                            <option value="‰∏çÂèØËÉΩ">‰∏çÂèØËÉΩ</option>
                            <option value="Ë¶ÅÁõ∏Ë´á">Ë¶ÅÁõ∏Ë´á</option>
                            <option value="Á´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÊâãÊ∏°„Åó">Á´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÊâãÊ∏°„Åó</option>
                            <option value="ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªÈÉµÈÄÅ">ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªÈÉµÈÄÅ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Á´ã„Å°‰ºö„ÅÑËÄÖÈñ¢‰øÇÊÄß</label>
                        <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all appearance-none bg-white">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <option value="Êú¨‰∫∫" selected>Êú¨‰∫∫</option>
                            <option value="ÈÖçÂÅ∂ËÄÖ">ÈÖçÂÅ∂ËÄÖ</option>
                            <option value="Ë¶™">Ë¶™</option>
                            <option value="Â≠ê">Â≠ê</option>
                            <option value="Ë¶™Êóè">Ë¶™Êóè</option>
                            <option value="„Åù„ÅÆ‰ªñ">„Åù„ÅÆ‰ªñ</option>
                        </select>
                    </div>
                </div>

                <!-- ÁèæÂú∞Ë™øÊüªÂ∏åÊúõÊó•ÊôÇ -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ÁèæË™øÊó•ÊôÇ</label>
                    <div class="mb-3">
                        <div id="surveyDateTimeButtonGroup" class="flex flex-wrap gap-2 p-3 rounded-lg">
                            <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all text-xs sm:text-sm font-medium text-gray-700" onclick="selectSurveyDateTime(this)">ÊúàÊõú ÂçàÂâç</button>
                            <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all text-xs sm:text-sm font-medium text-gray-700" onclick="selectSurveyDateTime(this)">ÊúàÊõú ÂçàÂæå</button>
                            <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all text-xs sm:text-sm font-medium text-gray-700" onclick="selectSurveyDateTime(this)">ÁÅ´Êõú ÂçàÂâç</button>
                            <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all text-xs sm:text-sm font-medium text-gray-700" onclick="selectSurveyDateTime(this)">ÁÅ´Êõú ÂçàÂæå</button>
                            <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all text-xs sm:text-sm font-medium text-gray-700" onclick="selectSurveyDateTime(this)">Ê∞¥Êõú ÂçàÂâç</button>
                            <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all text-xs sm:text-sm font-medium text-gray-700" onclick="selectSurveyDateTime(this)">Ê∞¥Êõú ÂçàÂæå</button>
                            <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all text-xs sm:text-sm font-medium text-gray-700" onclick="selectSurveyDateTime(this)">Êú®Êõú ÂçàÂâç</button>
                            <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all text-xs sm:text-sm font-medium text-gray-700" onclick="selectSurveyDateTime(this)">Êú®Êõú ÂçàÂæå</button>
                            <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all text-xs sm:text-sm font-medium text-gray-700" onclick="selectSurveyDateTime(this)">ÈáëÊõú ÂçàÂâç</button>
                            <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all text-xs sm:text-sm font-medium text-gray-700" onclick="selectSurveyDateTime(this)">ÈáëÊõú ÂçàÂæå</button>
                            <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all text-xs sm:text-sm font-medium text-gray-700" onclick="selectSurveyDateTime(this)">ÂúüÊõú ÂçàÂâç</button>
                            <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all text-xs sm:text-sm font-medium text-gray-700" onclick="selectSurveyDateTime(this)">ÂúüÊõú ÂçàÂæå</button>
                            <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all text-xs sm:text-sm font-medium text-gray-700" onclick="selectSurveyDateTime(this)">Êó•Êõú ÂçàÂâç</button>
                            <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all text-xs sm:text-sm font-medium text-gray-700" onclick="selectSurveyDateTime(this)">Êó•Êõú ÂçàÂæå</button>
                            <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all text-xs sm:text-sm font-medium text-gray-700" onclick="selectSurveyDateTime(this)">Êú™ÂÆö</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‚úâÔ∏è ÈÄ£Áµ°ÊñπÊ≥ï -->
            <div class="form-section bg-gradient-to-br from-indigo-50 to-white rounded-xl shadow-sm border border-indigo-100 p-4 mb-4">
                <div class="flex items-center mb-3">
                    <svg class="w-6 h-6 text-indigo-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                    <h2 class="text-xl font-bold text-gray-900">ÈÄ£Áµ°ÊñπÊ≥ï</h2>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ÈÄ£Áµ°ÊôÇÈñìÂ∏Ø„ÉªÂ∏åÊúõÈÄ£Áµ°ÊñπÊ≥ï</label>
                    <textarea id="contactMethodInput" rows="3" placeholder="‰æãÔºöÂπ≥Êó•9-17ÊôÇ„ÄÅÂúüÊó•Á•ù ‰∏çÂèØ„ÄÅ„É°„Éº„É´„ÅÆ„Åø" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all resize-none"></textarea>
                </div>
            </div>

            <!-- üìù Ê°à‰ª∂„É°„É¢ -->
            <div class="form-section bg-gradient-to-br from-yellow-50 to-white rounded-xl shadow-sm border border-yellow-100 p-4 mb-4">
                <div class="flex items-center mb-3">
                    <svg class="w-6 h-6 text-yellow-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                    <h2 class="text-xl font-bold text-gray-900">Ê°à‰ª∂„É°„É¢</h2>
                </div>
                <div class="relative mb-4">
                    <textarea id="caseMemoTextarea" rows="4" placeholder="È°ßÂÆ¢„Åã„Çâ„ÅÆË¶ÅÊúõ„ÇÑÁâπË®ò‰∫ãÈ†Ö„ÇíÂÖ•Âäõ..." class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all resize-none"></textarea>
                    <button type="button" onclick="startVoiceInput()" class="absolute bottom-3 right-3 p-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors" title="Èü≥Â£∞ÂÖ•Âäõ">
                        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                        </svg>
                    </button>
                </div>
                <div class="flex justify-end">
                    <button type="button" onclick="aiCorrectCaseMemo()" class="px-6 py-2.5 bg-gradient-to-r from-yellow-500 to-yellow-600 text-white rounded-lg hover:from-yellow-600 hover:to-yellow-700 transition-all font-medium shadow-md hover:shadow-lg">
                        ‚ú® AIÊ∑ªÂâä
                    </button>
                </div>
            </div>

            <!-- üîß ÁâπÊÆäÈ†ÖÁõÆ -->
            <div class="form-section bg-gradient-to-br from-gray-50 to-white rounded-xl shadow-sm border border-gray-200 p-4 mb-4">
                <div class="flex items-center mb-3">
                    <svg class="w-6 h-6 text-gray-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                    </svg>
                    <h2 class="text-xl font-bold text-gray-900">ÁâπÊÆäÈ†ÖÁõÆ</h2>
                </div>

                <div class="mb-4">
                    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2">
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-gray-500 hover:bg-gray-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight">ÈÅÆÁÜ±Êñ≠ÁÜ±Â°óÊñô</button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-gray-500 hover:bg-gray-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight">„Ç®„ÇØ„Çπ„ÉÜ„É™„Ç¢</button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-gray-500 hover:bg-gray-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight">
                            <span class="sm:hidden">Â§™ÈôΩÂÖâËÑ±ÁùÄ</span>
                            <span class="hidden sm:inline">Â§™ÈôΩÂÖâ„Éë„Éç„É´ËÑ±ÁùÄ</span>
                        </button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-gray-500 hover:bg-gray-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight">ÊèêÊê∫„É≠„Éº„É≥Êúâ</button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-gray-500 hover:bg-gray-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight">„Ç´„Éº„ÉâÊâï„ÅÑÂèØ</button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-gray-500 hover:bg-gray-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight">
                            <span class="sm:hidden">ÁÅ´ÁÅΩ‰øùÈô∫ÂØæÂøú</span>
                            <span class="hidden sm:inline">ÁÅ´ÁÅΩ‰øùÈô∫„Çµ„Éù„Éº„Éà</span>
                        </button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-gray-500 hover:bg-gray-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight">
                            <span class="sm:hidden">Âä©ÊàêÈáëÂØæÂøú</span>
                            <span class="hidden sm:inline">Âä©ÊàêÈáë„Çµ„Éù„Éº„Éà</span>
                        </button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-gray-500 hover:bg-gray-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight">ÂÖâËß¶Â™íÂ°óÊñô</button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-gray-500 hover:bg-gray-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight">
                            <span class="sm:hidden">ÂàÜÂâ≤Êâï„ÅÑ</span>
                            <span class="hidden sm:inline">ÂàÜÂâ≤Êâï„ÅÑ„Éó„É©„É≥</span>
                        </button>
                        <button type="button" class="option-button px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-gray-500 hover:bg-gray-50 transition-all text-xs sm:text-sm font-medium text-gray-700 text-center whitespace-normal leading-tight">
                            <span class="sm:hidden">Ë®±ÂèØË®º</span>
                            <span class="hidden sm:inline">Âª∫ÁØâË®±ÂèØË®º</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- üè¢ Ê•≠ËÄÖÈÅ∏Êäû„ÉªÊåØ„ÇäÂàÜ„Åë -->
            <div class="form-section bg-gradient-to-br from-pink-50 to-white rounded-xl shadow-sm border border-pink-100 p-4 mb-4">
                <div class="flex items-center mb-3">
                    <svg class="w-6 h-6 text-pink-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                    </svg>
                    <h2 class="text-xl font-bold text-gray-900">Ê•≠ËÄÖÈÅ∏Êäû</h2>
                </div>

                <!-- Â∏åÊúõÁ§æÊï∞„Å®Ê•≠ËÄÖÊ§úÁ¥¢ -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Â∏åÊúõÁ§æÊï∞</label>
                        <select id="franchiseCount" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all appearance-none bg-white">
                            <option value="1Á§æ">1Á§æ</option>
                            <option value="2Á§æ">2Á§æ</option>
                            <option value="3Á§æ" selected>3Á§æ</option>
                            <option value="4Á§æ">4Á§æ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Ê•≠ËÄÖÊ§úÁ¥¢</label>
                        <input type="text"
                               id="franchiseSearch"
                               placeholder="Ê•≠ËÄÖ„ÇíÊ§úÁ¥¢ÔºàÂêçÂâç„ÅßÊ§úÁ¥¢Ôºâ"
                               class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all"
                               oninput="searchFranchise(this.value)">
                    </div>
                </div>

                <!-- „Éï„Ç£„É´„Çø„Éº„Éú„Çø„É≥ÔºàiPhone SEÊúÄÈÅ©ÂåñÔºâ -->
                <div class="space-y-2 mb-6">
                    <!-- ‰∏äÊÆµÔºö„É¶„Éº„Ç∂„ÉºÈÅ∏Êäû & Ë∑ùÈõ¢È†Ü -->
                    <div class="grid grid-cols-2 gap-2">
                        <button type="button" onclick="sortFranchises('selected')" class="franchise-sort-btn px-3 py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl text-xs sm:text-sm font-semibold hover:border-pink-400 hover:bg-pink-50 transition-all shadow-sm" data-sort="selected" data-label="„É¶„Éº„Ç∂„ÉºÈÅ∏Êäû">
                            <span class="flex items-center justify-center gap-1.5">
                                <svg class="w-4 h-4 sm:w-5 sm:h-5 text-pink-500" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                    <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="btn-label">„É¶„Éº„Ç∂„ÉºÈÅ∏Êäû</span>
                            </span>
                        </button>
                        <button type="button" onclick="sortFranchises('distance')" class="franchise-sort-btn px-3 py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl text-xs sm:text-sm font-semibold hover:border-purple-400 hover:bg-purple-50 transition-all shadow-sm" data-sort="distance" data-label="Ë∑ùÈõ¢È†Ü">
                            <span class="flex items-center justify-center gap-1.5">
                                <svg class="w-4 h-4 sm:w-5 sm:h-5 text-purple-500" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="btn-label">Ë∑ùÈõ¢È†Ü</span>
                            </span>
                        </button>
                    </div>

                    <!-- ‰∏ãÊÆµÔºö‰∏¶„Å≥Êõø„Åà4È†ÖÁõÆÔºà„Ç¢„Ç§„Ç≥„É≥„ÅÆ„ÅøÔºâ -->
                    <div class="space-y-1">
                        <div class="grid grid-cols-4 gap-2">
                            <button type="button" onclick="sortFranchises('recommend')" class="franchise-sort-btn p-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-blue-400 hover:bg-blue-50 transition-all shadow-sm" data-sort="recommend" data-label="„Åä„Åô„Åô„ÇÅÈ†Ü">
                                <div class="flex items-center justify-center">
                                    <svg class="w-6 h-6 sm:w-7 sm:h-7 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                    </svg>
                                </div>
                            </button>
                            <button type="button" onclick="sortFranchises('price')" class="franchise-sort-btn p-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-orange-400 hover:bg-orange-50 transition-all shadow-sm" data-sort="price" data-label="ÂÆâ„ÅÑÈ†Ü">
                                <div class="flex items-center justify-center">
                                    <svg class="w-6 h-6 sm:w-7 sm:h-7 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"></path>
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </button>
                            <button type="button" onclick="sortFranchises('review')" class="franchise-sort-btn p-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-green-400 hover:bg-green-50 transition-all shadow-sm" data-sort="review" data-label="Âè£„Ç≥„ÉüÈ†Ü">
                                <div class="flex items-center justify-center">
                                    <svg class="w-6 h-6 sm:w-7 sm:h-7 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </button>
                            <button type="button" onclick="sortFranchises('quality')" class="franchise-sort-btn p-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-purple-400 hover:bg-purple-50 transition-all shadow-sm" data-sort="quality" data-label="È´òÂìÅË≥™È†Ü">
                                <div class="flex items-center justify-center">
                                    <svg class="w-6 h-6 sm:w-7 sm:h-7 text-purple-500" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </button>
                        </div>
                        <!-- ÈÅ∏Êäû‰∏≠„ÅÆ‰∏¶„Å≥È†ÜË°®Á§∫ -->
                        <div id="sortLabelDisplay" class="text-center text-xs text-gray-600 h-4"></div>
                    </div>
                </div>

                <!-- Ê•≠ËÄÖ„É™„Çπ„Éà -->
                <div id="franchiseListContainer" class="space-y-2">
                    <div class="franchise-item selected cursor-pointer border-2 border-pink-400 bg-pink-50 rounded-lg p-2 sm:p-4 hover:bg-pink-100 transition-all" onclick="toggleFranchise(this)" data-franchise-id="FRANCHISE_001">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center flex-1 min-w-0">
                                <div class="text-base sm:text-lg font-semibold mr-2 sm:mr-3 text-pink-600 flex-shrink-0">1</div>
                                <input type="checkbox" checked class="mr-2 sm:mr-4 w-4 h-4 sm:w-5 sm:h-5 text-pink-600 rounded flex-shrink-0" onclick="event.stopPropagation()">
                                <div class="flex-1 min-w-0">
                                    <div class="font-semibold text-gray-900 text-sm sm:text-lg">Êù±‰∫¨ÈÉΩÂ∏ÇÈÉ®Â°óË£Ö</div>
                                </div>
                            </div>
                            <div class="text-right ml-2 sm:ml-4 flex-shrink-0">
                                <div class="text-xs sm:text-sm text-gray-600 hidden sm:block">Êù±‰∫¨ÈÉΩ Á•ûÂ•àÂ∑ùÁúå</div>
                                <div class="text-pink-600 text-xs sm:text-sm font-semibold">ÈÅ∏ÊäûÂÄôË£ú</div>
                                <div class="text-xs text-gray-500">100% „Éû„ÉÉ„ÉÅ</div>
                            </div>
                        </div>
                    </div>

                    <div class="franchise-item selected cursor-pointer border-2 border-pink-400 bg-pink-50 rounded-lg p-2 sm:p-4 hover:bg-pink-100 transition-all" onclick="toggleFranchise(this)" data-franchise-id="FRANCHISE_002">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center flex-1 min-w-0">
                                <div class="text-base sm:text-lg font-semibold mr-2 sm:mr-3 text-pink-600 flex-shrink-0">2</div>
                                <input type="checkbox" checked class="mr-2 sm:mr-4 w-4 h-4 sm:w-5 sm:h-5 text-pink-600 rounded flex-shrink-0" onclick="event.stopPropagation()">
                                <div class="flex-1 min-w-0">
                                    <div class="font-semibold text-gray-900 text-sm sm:text-lg">Á•ûÂ•àÂ∑ùÁúåÂ§ÆÂª∫Ë®≠</div>
                                </div>
                            </div>
                            <div class="text-right ml-2 sm:ml-4 flex-shrink-0">
                                <div class="text-xs sm:text-sm text-gray-600 hidden sm:block">Á•ûÂ•àÂ∑ùÁúå Êù±‰∫¨ÈÉΩ</div>
                                <div class="text-pink-600 text-xs sm:text-sm font-semibold">ÈÅ∏ÊäûÂÄôË£ú</div>
                                <div class="text-xs text-gray-500">100% „Éû„ÉÉ„ÉÅ</div>
                            </div>
                        </div>
                    </div>

                    <div class="franchise-item selected cursor-pointer border-2 border-pink-400 bg-pink-50 rounded-lg p-2 sm:p-4 hover:bg-pink-100 transition-all" onclick="toggleFranchise(this)" data-franchise-id="FRANCHISE_003">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center flex-1 min-w-0">
                                <div class="text-base sm:text-lg font-semibold mr-2 sm:mr-3 text-pink-600 flex-shrink-0">3</div>
                                <input type="checkbox" checked class="mr-2 sm:mr-4 w-4 h-4 sm:w-5 sm:h-5 text-pink-600 rounded flex-shrink-0" onclick="event.stopPropagation()">
                                <div class="flex-1 min-w-0">
                                    <div class="font-semibold text-gray-900 text-sm sm:text-lg">ÂçÉËëâÂ§ñË£ÖÂ∑•Ê•≠</div>
                                </div>
                            </div>
                            <div class="text-right ml-2 sm:ml-4 flex-shrink-0">
                                <div class="text-xs sm:text-sm text-gray-600 hidden sm:block">ÂçÉËëâÁúå Êù±‰∫¨ÈÉΩ</div>
                                <div class="text-pink-600 text-xs sm:text-sm font-semibold">ÈÅ∏ÊäûÂÄôË£ú</div>
                                <div class="text-xs text-gray-500">100% „Éû„ÉÉ„ÉÅ</div>
                            </div>
                        </div>
                    </div>

                    <div class="franchise-item cursor-pointer border-2 border-gray-200 bg-white rounded-lg p-2 sm:p-4 hover:bg-gray-50 hover:border-gray-300 transition-all" onclick="toggleFranchise(this)" data-franchise-id="FRANCHISE_004">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center flex-1 min-w-0">
                                <div class="text-base sm:text-lg font-semibold mr-2 sm:mr-3 text-gray-400 flex-shrink-0">4</div>
                                <input type="checkbox" class="mr-2 sm:mr-4 w-4 h-4 sm:w-5 sm:h-5 rounded flex-shrink-0" onclick="event.stopPropagation()">
                                <div class="flex-1 min-w-0">
                                    <div class="font-semibold text-gray-900 text-sm sm:text-lg">ÂüºÁéâ„É™„Éï„Ç©„Éº„É†</div>
                                </div>
                            </div>
                            <div class="text-right ml-2 sm:ml-4 flex-shrink-0">
                                <div class="text-xs sm:text-sm text-gray-600 hidden sm:block">ÂüºÁéâÁúå Êù±‰∫¨ÈÉΩ</div>
                                <div class="text-blue-600 text-xs sm:text-sm font-semibold">ËøΩÂä†ÂÄôË£ú</div>
                                <div class="text-xs text-gray-500">95% „Éû„ÉÉ„ÉÅ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
                <div class="flex justify-center mt-8">
                    <button type="button" class="px-8 py-3.5 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-bold text-lg hover:from-green-600 hover:to-green-700 transition-all shadow-lg hover:shadow-xl transform hover:scale-105">
                        üöÄ „Ç™„Éº„ÉÄ„ÉºËª¢ÈÄÅ
                    </button>
                </div>
            </div>
            </div><!-- originalFormContentÁµÇ‰∫Ü -->

<script>
// „Éï„Ç£„Éº„É´„ÉâÂÄ§„Çí„Ç≥„Éî„Éº
function copyFieldValue(event, fieldId) {
    const field = document.getElementById(fieldId);
    if (!field) {
        console.error('[copyFieldValue] „Éï„Ç£„Éº„É´„Éâ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:', fieldId);
        return;
    }

    const value = field.value;
    if (!value || value.trim() === '') {
        showNotification('„Ç≥„Éî„Éº„Åô„ÇãÂÄ§„Åå„ÅÇ„Çä„Åæ„Åõ„Çì', 'error');
        return;
    }

    // „ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº
    navigator.clipboard.writeText(value).then(() => {
        // „Ç≥„Éî„ÉºÊàêÂäü„ÅÆ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ
        showNotification('„Ç≥„Éî„ÉºÔºÜ„Ç´„ÉÉ„Éà„Åó„Åæ„Åó„Åü: ' + value, 'success');

        // „Éï„Ç£„Éº„É´„Éâ„Çí„ÇØ„É™„Ç¢Ôºà„Ç´„ÉÉ„ÉàÔºâ
        field.value = '';

        // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥Áä∂ÊÖã„ÇíÊõ¥Êñ∞
        if (typeof validateEmptyFields === 'function') {
            validateEmptyFields();
        }

        // „Ç≥„Éî„Éº„Éú„Çø„É≥„Çí‰∏ÄÊôÇÁöÑ„Å´ÈùíËâ≤„Å´„Åô„Çã
        const button = event.target.closest('button');
        if (button) {
            button.classList.add('text-blue-500');
            setTimeout(() => {
                button.classList.remove('text-blue-500');
            }, 300);
        }
    }).catch(err => {
        console.error('[copyFieldValue] „Ç≥„Éî„ÉºÂ§±Êïó:', err);
        showNotification('„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
    });
}

// Èü≥Â£∞ÂÖ•ÂäõÈñãÂßã
function startVoiceInput() {
    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        showNotification('„Åä‰Ωø„ÅÑ„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØÈü≥Â£∞ÂÖ•Âäõ„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
        return;
    }

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = 'ja-JP';
    recognition.continuous = false;
    recognition.interimResults = false;

    const textarea = document.getElementById('caseMemoTextarea');

    recognition.onstart = function() {
        showNotification('Èü≥Â£∞ÂÖ•ÂäõÈñãÂßã...', 'info');
    };

    recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        // Êó¢Â≠ò„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Å´ËøΩË®ò
        textarea.value = textarea.value ? textarea.value + ' ' + transcript : transcript;
        showNotification('Èü≥Â£∞ÂÖ•ÂäõÂÆå‰∫Ü', 'success');
    };

    recognition.onerror = function(event) {
        console.error('[startVoiceInput] „Ç®„É©„Éº:', event.error);
        showNotification('Èü≥Â£∞ÂÖ•Âäõ„Ç®„É©„Éº: ' + event.error, 'error');
    };

    recognition.start();
}

// AIÊ∑ªÂâäÔºàDeepSeek‰ΩøÁî®Ôºâ
async function aiCorrectCaseMemo() {
    const textarea = document.getElementById('caseMemoTextarea');
    const memoText = textarea.value;

    if (!memoText || memoText.trim() === '') {
        showNotification('Ê°à‰ª∂„É°„É¢„ÅåÁ©∫„Åß„Åô', 'error');
        return;
    }

    showNotification('AIÊ∑ªÂâä‰∏≠...', 'info');

    try {
        // DeepSeek API„ÇíÂëº„Å≥Âá∫„ÅóÔºàGASÁµåÁî±Ôºâ
        const response = await window.apiClient.postRequest('aiCorrectMemo', {
            memo: memoText
        });

        if (response && response.success && response.correctedMemo) {
            textarea.value = response.correctedMemo;
            showNotification('AIÊ∑ªÂâäÂÆå‰∫Ü', 'success');
        } else {
            throw new Error(response?.error || 'AIÊ∑ªÂâäÂ§±Êïó');
        }
    } catch (error) {
        console.error('[aiCorrectCaseMemo] „Ç®„É©„Éº:', error);
        showNotification('AIÊ∑ªÂâä„Ç®„É©„Éº: ' + error.message, 'error');
    }
}

// 2‰∫∫ÁõÆÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥ „Éà„Ç∞„É´
function toggleSecondPerson() {
    const section = document.getElementById('secondPersonSection');
    const icon = document.getElementById('secondPersonToggleIcon');
    const text = document.getElementById('secondPersonToggleText');

    if (section.classList.contains('hidden')) {
        section.classList.remove('hidden');
        icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />';
        text.textContent = '2‰∫∫ÁõÆ„ÅÆÊÉÖÂ†±„ÇíÂâäÈô§';
    } else {
        section.classList.add('hidden');
        icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />';
        text.textContent = '2‰∫∫ÁõÆ„ÅÆÊÉÖÂ†±„ÇíËøΩÂä†';
        // ÂÖ•ÂäõÂÜÖÂÆπ„Çí„ÇØ„É™„Ç¢
        document.getElementById('name2Input').value = '';
        document.getElementById('phone2Input').value = '';
        document.getElementById('relationship2Input').value = '';
        document.getElementById('memo2Input').value = '';
    }
}

// Ëá™ÂÆÖ‰ΩèÊâÄ„Çª„ÇØ„Ç∑„Éß„É≥ „Éà„Ç∞„É´
function toggleHomeAddress() {
    const section = document.getElementById('homeAddressSection');
    const icon = document.getElementById('homeAddressToggleIcon');
    const text = document.getElementById('homeAddressToggleText');

    if (section.classList.contains('hidden')) {
        section.classList.remove('hidden');
        icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />';
        text.textContent = 'Ëá™ÂÆÖ‰ΩèÊâÄ';
    } else {
        section.classList.add('hidden');
        icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />';
        text.textContent = 'Ëá™ÂÆÖ‰ΩèÊâÄ';
        // ÂÖ•ÂäõÂÜÖÂÆπ„Çí„ÇØ„É™„Ç¢
        document.getElementById('homeZipInput').value = '';
        document.getElementById('homeAddressInput').value = '';
    }
}

// Áâ©‰ª∂Á®ÆÂà•„Å´Âøú„Åò„Å¶ÈöéÊï∞ÈÅ∏ÊäûËÇ¢„ÇíÂãïÁöÑ„Å´Â§âÊõ¥
function updateFloorsOptions() {
    const propertyType = document.getElementById('propertyTypeSelect').value;
    const floorsSelect = document.getElementById('floorsSelect');

    // Êó¢Â≠ò„ÅÆÈÅ∏ÊäûËÇ¢„Çí„ÇØ„É™„Ç¢
    floorsSelect.innerHTML = '<option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>';

    if (propertyType === 'Êà∏Âª∫„Å¶') {
        floorsSelect.innerHTML += `
            <option value="Âπ≥Â±ã">Âπ≥Â±ã</option>
            <option value="2ÈöéÂª∫„Å¶">2ÈöéÂª∫„Å¶</option>
            <option value="3ÈöéÂª∫„Å¶">3ÈöéÂª∫„Å¶</option>
            <option value="4ÈöéÂª∫„Å¶‰ª•‰∏ä">4ÈöéÂª∫„Å¶‰ª•‰∏ä</option>
        `;
    } else if (propertyType === '„Éû„É≥„Ç∑„Éß„É≥' || propertyType === '„Ç¢„Éë„Éº„Éà') {
        floorsSelect.innerHTML += `
            <option value="1Èöé">1Èöé</option>
            <option value="2Èöé">2Èöé</option>
            <option value="3Èöé">3Èöé</option>
            <option value="4Èöé">4Èöé</option>
            <option value="5Èöé">5Èöé</option>
            <option value="6Èöé‰ª•‰∏ä">6Èöé‰ª•‰∏ä</option>
            <option value="ÊúÄ‰∏äÈöé">ÊúÄ‰∏äÈöé</option>
        `;
    } else if (propertyType === 'Â∫óËàó„Éª‰∫ãÂãôÊâÄ' || propertyType === 'Â∑•Â†¥„ÉªÂÄâÂ∫´') {
        floorsSelect.innerHTML += `
            <option value="Âπ≥Â±ã">Âπ≥Â±ã</option>
            <option value="1Èöé">1Èöé</option>
            <option value="2Èöé">2Èöé</option>
            <option value="3Èöé">3Èöé</option>
            <option value="4Èöé‰ª•‰∏ä">4Èöé‰ª•‰∏ä</option>
        `;
    } else {
        // „Åù„ÅÆ‰ªñ„ÅÆÂ†¥Âêà„ÅØÊà∏Âª∫„Å¶„ÅÆÈÅ∏ÊäûËÇ¢„ÇíË°®Á§∫
        floorsSelect.innerHTML += `
            <option value="Âπ≥Â±ã">Âπ≥Â±ã</option>
            <option value="2ÈöéÂª∫„Å¶">2ÈöéÂª∫„Å¶</option>
            <option value="3ÈöéÂª∫„Å¶">3ÈöéÂª∫„Å¶</option>
            <option value="4ÈöéÂª∫„Å¶‰ª•‰∏ä">4ÈöéÂª∫„Å¶‰ª•‰∏ä</option>
        `;
    }
}

// option-button „ÅÆ„Éà„Ç∞„É´Ê©üËÉΩÔºàÈÅ∏ÊäûÁä∂ÊÖã„ÅÆË¶ñË¶öÁöÑ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÔºâ
document.addEventListener('DOMContentLoaded', function() {
    const optionButtons = document.querySelectorAll('.option-button');
    optionButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();

            // Âçò‰∏ÄÈÅ∏Êäû„Ç∞„É´„Éº„Éó„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàdata-single-select="true"„ÅÆË¶™Ë¶ÅÁ¥†Ôºâ
            const parent = this.parentElement;
            const isSingleSelect = parent && parent.dataset.singleSelect === 'true';

            if (isSingleSelect) {
                // Âçò‰∏ÄÈÅ∏ÊäûÔºöÊó¢„Å´ÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑÔºàÈÅ∏ÊäûËß£Èô§„ÇíÈò≤„ÅêÔºâ
                if (this.classList.contains('selected')) {
                    return;
                }

                // ‰ªñ„ÅÆ„Éú„Çø„É≥„Åã„Çâ selected „ÇíÂâäÈô§
                parent.querySelectorAll('.option-button').forEach(btn => {
                    btn.classList.remove('selected', 'bg-purple-500', 'border-purple-500', 'text-white', 'shadow-md');
                    btn.classList.add('bg-white', 'border-gray-300', 'text-gray-700');
                });
                // „Åì„ÅÆ„Éú„Çø„É≥„ÇíÈÅ∏ÊäûÁä∂ÊÖã„Å´„Åô„Çã
                this.classList.add('selected');
                this.classList.remove('bg-white', 'border-gray-300', 'text-gray-700');
                this.classList.add('bg-purple-500', 'border-purple-500', 'text-white', 'shadow-md');

                // ÊÄßÂà•„Éú„Çø„É≥„ÅÆÂ†¥Âêà„ÄÅhidden input„Å´ÂÄ§„ÇíË®≠ÂÆö
                if (this.dataset.gender) {
                    const genderSelect = document.getElementById('genderSelect');
                    if (genderSelect) {
                        genderSelect.value = this.dataset.gender;
                        // Êú™‰øùÂ≠ò„ÅÆÂ§âÊõ¥„Å®„Åó„Å¶„Éû„Éº„ÇØ
                        if (typeof currentCaseId !== 'undefined' && currentCaseId && typeof unsavedChanges !== 'undefined') {
                            unsavedChanges.set(currentCaseId, { type: 'form' });
                            if (typeof updateSaveButton === 'function') {
                                updateSaveButton();
                            }
                        }
                    }
                }

                // Âπ¥ÈΩ¢„Éú„Çø„É≥„ÅÆÂ†¥Âêà„ÄÅhidden input„Å´ÂÄ§„ÇíË®≠ÂÆö
                if (this.dataset.age) {
                    const ageSelect = document.getElementById('ageSelect');
                    if (ageSelect) {
                        ageSelect.value = this.dataset.age;
                        // Êú™‰øùÂ≠ò„ÅÆÂ§âÊõ¥„Å®„Åó„Å¶„Éû„Éº„ÇØ
                        if (typeof currentCaseId !== 'undefined' && currentCaseId && typeof unsavedChanges !== 'undefined') {
                            unsavedChanges.set(currentCaseId, { type: 'form' });
                            if (typeof updateSaveButton === 'function') {
                                updateSaveButton();
                            }
                        }
                    }
                }
            } else {
                // Ë§áÊï∞ÈÅ∏ÊäûÔºö„Éà„Ç∞„É´
                this.classList.toggle('selected');

                if (this.classList.contains('selected')) {
                    this.classList.remove('bg-white', 'border-gray-300', 'text-gray-700');
                    this.classList.add('bg-purple-500', 'border-purple-500', 'text-white', 'shadow-md');
                } else {
                    this.classList.add('bg-white', 'border-gray-300', 'text-gray-700');
                    this.classList.remove('bg-purple-500', 'border-purple-500', 'text-white', 'shadow-md');
                }
            }
        });
    });

    // „Ç™„Éº„Éà„Çª„Éº„Éñ„Ç∑„Çπ„ÉÜ„É†ÈñãÂßã
    if (typeof startAutoSave === 'function') {
        startAutoSave();
        console.log('[Admin] „Ç™„Éº„Éà„Çª„Éº„Éñ„Ç∑„Çπ„ÉÜ„É†„ÇíËµ∑Âãï„Åó„Åæ„Åó„Åü');
    }

    // ‰øùÂ≠ò„Éú„Çø„É≥„ÅÆÂàùÊúüÁä∂ÊÖã„ÇíË®≠ÂÆö
    if (typeof updateSaveButton === 'function') {
        updateSaveButton();
    }
});

// „Éö„Éº„Ç∏Èõ¢ËÑ±ÊôÇ„ÅÆÊú™‰øùÂ≠òÂ§âÊõ¥Á¢∫Ë™ç
window.addEventListener('beforeunload', function(e) {
    if (typeof checkUnsavedBeforeUnload === 'function') {
        return checkUnsavedBeforeUnload(e);
    }
});
</script>
    </main>

    <!-- Êû∂ÈõªÂ±•Ê≠¥„É¢„Éº„ÉÄ„É´ -->
    <div id="callHistoryModal" class="fixed inset-0 z-50 hidden">
        <div class="fixed inset-0 bg-black/50" onclick="closeCallHistoryModal()"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">„É°„É¢</h3>
                    <button onclick="closeCallHistoryModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                
                <!-- Êñ∞Ë¶è„É°„É¢ÂÖ•Âäõ -->
                <div class="mb-6">
                    <textarea id="newCallNote" placeholder="„É°„É¢„ÇíÂÖ•Âäõ..." class="w-full p-3 border rounded-lg resize-none" rows="3"></textarea>
                    <div class="flex items-center gap-4 mt-3">
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ê¨°ÂõûÊû∂ÈõªÊó•</label>
                            <input type="date" id="nextCallDate" class="w-full px-3 py-2 border rounded-lg">
                        </div>
                        <button onclick="addCallHistory()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            ‰øùÂ≠ò
                        </button>
                    </div>
                </div>
                
                <!-- Â±•Ê≠¥„É™„Çπ„Éà -->
                <div id="callHistoryList" class="space-y-3">
                    <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„ÇãÂ±•Ê≠¥ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- „ÇΩ„Éº„Éà„É¢„Éº„ÉÄ„É´ -->
    <div id="sortModal" class="fixed inset-0 z-50 hidden">
        <div class="fixed inset-0 bg-black/50" onclick="closeSortModal()"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-xl p-6 max-w-md w-full max-h-[80vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">„Çπ„ÉÜ„Éº„Çø„ÇπÁµû„ÇäËæº„ÅøÔºàË§áÊï∞ÈÅ∏ÊäûÂèØÔºâ</h3>
                        <p id="selectedStatusCount" class="text-sm text-gray-500">„Åô„Åπ„Å¶Ë°®Á§∫‰∏≠</p>
                    </div>
                    <button onclick="closeSortModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                
                <!-- „Åô„Åπ„Å¶Ë°®Á§∫„Éú„Çø„É≥ -->
                <div class="mb-4">
                    <button onclick="showAllCases()" class="w-full px-4 py-2.5 bg-gradient-to-r from-gray-100 to-white text-gray-800 border border-gray-300 rounded-lg shadow hover:shadow-lg transition-all font-medium">
                        <span class="flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                            ÈÅ∏Êäû„Çí„ÇØ„É™„Ç¢Ôºà„Åô„Åπ„Å¶Ë°®Á§∫Ôºâ
                        </span>
                    </button>
                </div>
                
                <!-- ÁÆ°ÁêÜ„Çπ„ÉÜ„Éº„Çø„Çπ -->
                <div class="mb-4">
                    <h4 class="text-sm font-medium text-gray-700 mb-2">ÁÆ°ÁêÜ„Çπ„ÉÜ„Éº„Çø„Çπ</h4>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="filterBySpecificStatus('Êñ∞Ë¶è')" class="px-4 py-2 border-2 border-blue-500 bg-blue-100 text-blue-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">Êñ∞Ë¶è</button>
                        <button onclick="filterBySpecificStatus('‰∏çÂú®')" class="px-4 py-2 border-2 border-gray-500 bg-gray-100 text-gray-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">‰∏çÂú®</button>
                        <button onclick="filterBySpecificStatus('ÂÜçÊû∂Èõª')" class="px-4 py-2 border-2 border-yellow-500 bg-yellow-100 text-yellow-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÂÜçÊû∂Èõª</button>
                        <button onclick="filterBySpecificStatus('Ë¶ãËæº„Åø')" class="px-4 py-2 border-2 border-orange-600 bg-orange-100 text-orange-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">Ë¶ãËæº„Åø</button>
                        <button onclick="filterBySpecificStatus('„É≠„Çπ„Éà')" class="px-4 py-2 border-2 border-indigo-500 bg-indigo-100 text-indigo-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">„É≠„Çπ„Éà</button>
                        <button onclick="filterBySpecificStatus('ÈÖç‰ø°‰∏≠')" class="px-4 py-2 border-2 border-amber-600 bg-amber-100 text-amber-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÈÖç‰ø°‰∏≠</button>
                        <button onclick="filterBySpecificStatus('ÈÖç‰ø°Ê∏à')" class="px-4 py-2 border-2 border-green-600 bg-green-100 text-green-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÈÖç‰ø°Ê∏à</button>
                        <button onclick="filterBySpecificStatus('‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à')" class="px-4 py-2 border-2 border-slate-500 bg-slate-100 text-slate-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à</button>
                        <button onclick="filterBySpecificStatus('ÁÑ°Âäπ')" class="px-4 py-2 border-2 border-gray-600 bg-gray-100 text-gray-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÁÑ°Âäπ</button>
                        <button onclick="filterBySpecificStatus('„ÇØ„É¨„Éº„É†')" class="px-4 py-2 border-2 border-red-700 bg-red-100 text-red-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">„ÇØ„É¨„Éº„É†</button>
                    </div>
                </div>

                <!-- ÈÖç‰ø°Âæå„Çπ„ÉÜ„Éº„Çø„Çπ -->
                <div>
                    <h4 class="text-sm font-medium text-gray-700 mb-2">ÈÖç‰ø°Âæå„Çπ„ÉÜ„Éº„Çø„Çπ</h4>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="filterBySpecificStatus('„Ç¢„ÉùÊ∏à')" class="px-4 py-2 border-2 border-orange-500 bg-orange-100 text-orange-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">„Ç¢„ÉùÊ∏à</button>
                        <button onclick="filterBySpecificStatus('ÁèæË™øÊ∏à')" class="px-4 py-2 border-2 border-orange-600 bg-orange-100 text-orange-900 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÁèæË™øÊ∏à</button>
                        <button onclick="filterBySpecificStatus('Ë¶ãÁ©çÊèêÂá∫Ê∏à')" class="px-4 py-2 border-2 border-red-600 bg-red-100 text-red-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">Ë¶ãÁ©çÊèêÂá∫Ê∏à</button>
                        <button onclick="filterBySpecificStatus('ÂÖ•Èáë‰∫àÂÆö')" class="px-4 py-2 border-2 border-red-700 bg-red-100 text-red-900 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÂÖ•Èáë‰∫àÂÆö</button>
                        <button onclick="filterBySpecificStatus('ÂÖ•ÈáëÂÆå‰∫Ü')" class="px-4 py-2 border-2 border-purple-700 bg-purple-100 text-purple-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÂÖ•ÈáëÂÆå‰∫Ü</button>
                        <button onclick="filterBySpecificStatus('ÂÆå‰∫Ü')" class="px-4 py-2 border-2 border-green-700 bg-green-100 text-green-900 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÂÆå‰∫Ü</button>
                        <button onclick="filterBySpecificStatus('Á¥π‰ªãÂæå„Ç≠„É£„É≥„Çª„É´')" class="px-4 py-2 border-2 border-cyan-600 bg-cyan-100 text-cyan-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">Á¥π‰ªãÂæå„Ç≠„É£„É≥„Çª„É´</button>
                        <button onclick="filterBySpecificStatus('ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´')" class="px-4 py-2 border-2 border-blue-600 bg-blue-100 text-blue-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´</button>
                        <button onclick="filterBySpecificStatus('ÁèæË™øÂæå„É≠„Çπ„Éà')" class="px-4 py-2 border-2 border-indigo-600 bg-indigo-100 text-indigo-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÁèæË™øÂæå„É≠„Çπ„Éà</button>
                    </div>
                </div>

                <!-- ÈÅ©Áî®„Åó„Å¶Èñâ„Åò„Çã„Éú„Çø„É≥ -->
                <div class="mt-4 pt-4 border-t border-gray-200">
                    <button onclick="closeSortModal()" class="w-full px-4 py-2.5 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg shadow-md hover:shadow-lg transition-all font-semibold hover:from-blue-600 hover:to-blue-700">
                        ÈÅ©Áî®„Åó„Å¶Èñâ„Åò„Çã
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- „É™„Çπ„Éà„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥„É¢„Éº„ÉÄ„É´ -->
    <div id="listStatusModal" class="fixed inset-0 z-50 hidden">
        <div class="fixed inset-0 bg-black/50" onclick="closeListStatusModal()"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-xl shadow-2xl p-5 max-w-sm w-full">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥</h3>
                    <button onclick="closeListStatusModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <div class="max-h-[60vh] overflow-y-auto space-y-3">
                    <!-- ÈÖç‰ø°Ââç„Çπ„ÉÜ„Éº„Çø„Çπ -->
                    <div>
                        <h4 class="text-xs font-medium text-gray-500 mb-2 px-2">ÈÖç‰ø°Ââç„Çπ„ÉÜ„Éº„Çø„Çπ</h4>
                        <div class="space-y-2">
                            <button onclick="selectListStatus('Êñ∞Ë¶è')" class="w-full px-4 py-2 border-2 border-blue-500 bg-blue-100 text-blue-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">Êñ∞Ë¶è</button>
                            <button onclick="selectListStatus('‰∏çÂú®')" class="w-full px-4 py-2 border-2 border-gray-500 bg-gray-100 text-gray-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">‰∏çÂú®</button>
                            <button onclick="selectListStatus('ÂÜçÊû∂Èõª')" class="w-full px-4 py-2 border-2 border-yellow-500 bg-yellow-100 text-yellow-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÂÜçÊû∂Èõª</button>
                            <button onclick="selectListStatus('Ë¶ãËæº„Åø')" class="w-full px-4 py-2 border-2 border-orange-600 bg-orange-100 text-orange-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">Ë¶ãËæº„Åø</button>
                            <button onclick="selectListStatus('„É≠„Çπ„Éà')" class="w-full px-4 py-2 border-2 border-indigo-500 bg-indigo-100 text-indigo-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">„É≠„Çπ„Éà</button>
                            <button onclick="selectListStatus('ÈÖç‰ø°‰∏≠')" class="w-full px-4 py-2 border-2 border-amber-600 bg-amber-100 text-amber-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÈÖç‰ø°‰∏≠</button>
                            <button onclick="selectListStatus('ÈÖç‰ø°Ê∏à')" class="w-full px-4 py-2 border-2 border-green-600 bg-green-100 text-green-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÈÖç‰ø°Ê∏à</button>
                            <button onclick="selectListStatus('‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à')" class="w-full px-4 py-2 border-2 border-slate-500 bg-slate-100 text-slate-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à</button>
                            <button onclick="selectListStatus('ÁÑ°Âäπ')" class="w-full px-4 py-2 border-2 border-gray-600 bg-gray-100 text-gray-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÁÑ°Âäπ</button>
                            <button onclick="selectListStatus('„ÇØ„É¨„Éº„É†')" class="w-full px-4 py-2 border-2 border-red-700 bg-red-100 text-red-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">„ÇØ„É¨„Éº„É†</button>
                        </div>
                    </div>
                    <!-- ÈÖç‰ø°Âæå„Çπ„ÉÜ„Éº„Çø„Çπ -->
                    <div>
                        <h4 class="text-xs font-medium text-gray-500 mb-2 px-2">ÈÖç‰ø°Âæå„Çπ„ÉÜ„Éº„Çø„Çπ</h4>
                        <div class="space-y-2">
                            <button onclick="selectListStatus('„Ç¢„ÉùÊ∏à')" class="w-full px-4 py-2 border-2 border-orange-500 bg-orange-100 text-orange-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">„Ç¢„ÉùÊ∏à</button>
                            <button onclick="selectListStatus('ÁèæË™øÊ∏à')" class="w-full px-4 py-2 border-2 border-orange-600 bg-orange-100 text-orange-900 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÁèæË™øÊ∏à</button>
                            <button onclick="selectListStatus('Ë¶ãÁ©çÊèêÂá∫Ê∏à')" class="w-full px-4 py-2 border-2 border-red-600 bg-red-100 text-red-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">Ë¶ãÁ©çÊèêÂá∫Ê∏à</button>
                            <button onclick="selectListStatus('ÂÖ•Èáë‰∫àÂÆö')" class="w-full px-4 py-2 border-2 border-red-700 bg-red-100 text-red-900 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÂÖ•Èáë‰∫àÂÆö</button>
                            <button onclick="selectListStatus('ÂÖ•ÈáëÂÆå‰∫Ü')" class="w-full px-4 py-2 border-2 border-purple-700 bg-purple-100 text-purple-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÂÖ•ÈáëÂÆå‰∫Ü</button>
                            <button onclick="selectListStatus('ÂÆå‰∫Ü')" class="w-full px-4 py-2 border-2 border-green-700 bg-green-100 text-green-900 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÂÆå‰∫Ü</button>
                            <button onclick="selectListStatus('Á¥π‰ªãÂæå„Ç≠„É£„É≥„Çª„É´')" class="w-full px-4 py-2 border-2 border-cyan-600 bg-cyan-100 text-cyan-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">Á¥π‰ªãÂæå„Ç≠„É£„É≥„Çª„É´</button>
                            <button onclick="selectListStatus('ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´')" class="w-full px-4 py-2 border-2 border-blue-600 bg-blue-100 text-blue-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´</button>
                            <button onclick="selectListStatus('ÁèæË™øÂæå„É≠„Çπ„Éà')" class="w-full px-4 py-2 border-2 border-indigo-600 bg-indigo-100 text-indigo-800 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-sm font-medium">ÁèæË™øÂæå„É≠„Çπ„Éà</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- „É¢„Éº„ÉÄ„É´ -->
    <div id="modal" class="fixed inset-0 z-50 hidden">
        <div class="fixed inset-0 bg-black/70 backdrop-blur-sm" onclick="closeModal()"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="relative w-full max-w-4xl bg-gray-900 rounded-2xl shadow-2xl border border-gray-200">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-xl font-bold text-gray-100">Ê°à‰ª∂Ë©≥Á¥∞„ÉªÂâ≤„ÇäÊåØ„ÇäË®≠ÂÆö</h3>
                        <button onclick="closeModal()" class="p-2 hover:bg-gray-800 rounded-lg transition-colors">
                            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="p-6">
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <h4 class="text-lg font-semibold text-gray-100 mb-4">È°ßÂÆ¢ÊÉÖÂ†±</h4>
                            <dl class="space-y-3">
                                <div>
                                    <dt class="text-sm text-gray-400">È°ßÂÆ¢Âêç</dt>
                                    <dd class="text-gray-100 font-medium">Áî∞‰∏≠Â§™ÈÉé</dd>
                                </div>
                                <div>
                                    <dt class="text-sm text-gray-400">Âª∫Áâ©Á®ÆÂà•</dt>
                                    <dd><span class="badge badge-info">Êà∏Âª∫„Å¶</span></dd>
                                </div>
                                <div>
                                    <dt class="text-sm text-gray-400">Â∏åÊúõÂ∑•‰∫ã</dt>
                                    <dd class="text-gray-100">Â§ñÂ£ÅÂ°óË£Ö„ÄÅÂ±ãÊ†πÂ°óË£ÖÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ</dd>
                                </div>
                            </dl>
                        </div>
                        
                        <div>
                            <h4 class="text-lg font-semibold text-gray-100 mb-4">Á¥π‰ªãÊñôË®≠ÂÆö</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="text-sm text-gray-400">Ëá™ÂãïË®àÁÆóÈ°ç</label>
                                    <div class="text-2xl font-bold text-emerald-400">¬•20,000</div>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400">ÊâãÂãïË™øÊï¥</label>
                                    <div class="flex space-x-2 mt-2">
                                        <button class="px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm">¬•5,000</button>
                                        <button class="px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm">¬•10,000</button>
                                        <button class="px-4 py-2 bg-blue-600 rounded-lg text-sm">¬•20,000</button>
                                        <button class="px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm">¬•30,000</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <h4 class="text-lg font-semibold text-gray-100 mb-4">AIÊé®Ëñ¶Âä†ÁõüÂ∫ó</h4>
                        <div class="space-y-3">
                            <div class="p-4 bg-gray-800 rounded-lg hover:bg-gray-700 transition-colors cursor-pointer">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <input type="checkbox" class="rounded border-gray-600 bg-gray-700">
                                        <div>
                                            <div class="font-medium text-gray-900">Êù±‰∫¨„Éö„Ç§„É≥„ÉàÂ∑•Ê•≠ <span class="text-xs text-gray-500">F0001</span></div>
                                            <div class="text-sm text-gray-400 mt-1">AI„Çπ„Ç≥„Ç¢: <span class="text-blue-400 font-medium">95</span></div>
                                        </div>
                                    </div>
                                    <div class="flex gap-2">
                                        <span class="px-2 py-1 bg-emerald-500/20 text-emerald-400 text-xs rounded-full">„Éá„Éù„Ç∏„ÉÉ„ÉàÊúâ</span>
                                        <span class="px-2 py-1 bg-blue-500/20 text-blue-400 text-xs rounded-full">ÊúÄÂÑ™ÂÖà„Ç®„É™„Ç¢</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-end space-x-3">
                        <button onclick="closeModal()" class="px-5 py-2.5 bg-gray-800 hover:bg-gray-700 rounded-lg font-medium">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                        <button class="px-5 py-2.5 bg-blue-600 hover:bg-blue-500 rounded-lg font-medium neon-blue">
                            Ëª¢ÈÄÅÂÆüË°å
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
        window.addEventListener('error', function(e) {
            console.error('JavaScript Error:', e.message, 'at', e.filename, ':', e.lineno, ':', e.colno);
            console.error('Error object:', e.error);
        });
        
        try {
            console.log('Script initialization starting...');
        } catch(e) {
            console.error('Initialization error:', e);
        }
        
        function toggleMenu() {
            const menu = document.getElementById('sideMenu');
            menu.classList.toggle('-translate-x-full');
        }

        // „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢„ÇØ„É™„ÉÉ„ÇØ„Åß„É°„Éã„É•„Éº„ÇíÈñâ„Åò„Çã
        document.addEventListener('click', function(e) {
            const menu = document.getElementById('sideMenu');
            const menuButton = document.querySelector('[onclick="toggleMenu()"]');
            
            // „ÇØ„É™„ÉÉ„ÇØ„Åå„É°„Éã„É•„ÉºÂ§ñ„Åß„Åã„Å§„É°„Éã„É•„Éº„Éú„Çø„É≥‰ª•Â§ñ„ÅÆÂ†¥Âêà
            if (!menu.contains(e.target) && e.target !== menuButton && !menuButton.contains(e.target)) {
                menu.classList.add('-translate-x-full');
            }
        });
        
        function openModal() {
            document.getElementById('modal').classList.remove('hidden');
        }
        
        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        // „Éè„É≥„Éá„Ç≠„É£„ÉÉ„ÉóÊõ¥Êñ∞Ê©üËÉΩ
        function updateHandicap(franchiseId, value) {
            // „Éè„É≥„Éá„Ç≠„É£„ÉÉ„ÉóÂÄ§„Çí‰øùÂ≠òÔºàÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Åß„ÅØAPI„Ç≥„Éº„É´„ÇíË°å„ÅÜÔºâ
            console.log(`Âä†ÁõüÂ∫ó ${franchiseId} „ÅÆ„Éè„É≥„Éá„Çí ${value} „Å´Êõ¥Êñ∞„Åó„Åæ„Åó„Åü`);

            // ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫Ôºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
            notification.textContent = `„Éè„É≥„Éá„Çí ${value} „Å´Êõ¥Êñ∞„Åó„Åæ„Åó„Åü`;
            document.body.appendChild(notification);

            // 3ÁßíÂæå„Å´ÈÄöÁü•„ÇíÂâäÈô§
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Âä†ÁõüÂ∫ó„Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞Ê©üËÉΩ
        function updateFranchiseStatus(franchiseId, status) {
            const select = document.querySelector(`[data-franchise-id="${franchiseId}"]`);

            // „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„Å¶Ëâ≤„ÇíÂ§âÊõ¥
            const statusColors = {
                'active': 'bg-green-100 text-green-800 border-green-300',
                'inactive': 'bg-purple-100 text-purple-800 border-purple-300',
                'paused': 'bg-yellow-100 text-yellow-800 border-yellow-300',
                'silent': 'bg-gray-100 text-gray-800 border-gray-300',
                'suspended': 'bg-red-100 text-red-800 border-red-300',
                'withdrawn': 'bg-black text-white border-gray-800'
            };

            // ÂÖ®„ÇØ„É©„Çπ„Çí„É™„Çª„ÉÉ„Éà
            select.className = 'status-select px-3 py-1 text-xs font-semibold rounded-full border-2 cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500';

            // Êñ∞„Åó„ÅÑ„Çπ„ÉÜ„Éº„Çø„Çπ„ÅÆ„ÇØ„É©„Çπ„ÇíËøΩÂä†
            select.className += ' ' + statusColors[status];

            // „Çπ„ÉÜ„Éº„Çø„Çπ„É©„Éô„É´„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞
            const statusLabels = {
                'active': '„Ç¢„ÇØ„ÉÜ„Ç£„Éñ',
                'inactive': 'Èùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ',
                'paused': '‰∏ÄÊôÇÂÅúÊ≠¢',
                'silent': '„Çµ„Ç§„É¨„É≥„Éà',
                'suspended': '‰ºëÊ≠¢',
                'withdrawn': 'ÈÄÄ‰ºö'
            };

            // API„Ç≥„Éº„É´„Åß„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÇíÊõ¥Êñ∞
            const apiStatus = statusLabels[status];
            updateFranchiseStatusAPI(franchiseId, apiStatus).then(response => {
                console.log(`Âä†ÁõüÂ∫ó ${franchiseId} „ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Çí ${apiStatus} „Å´Êõ¥Êñ∞„Åó„Åæ„Åó„Åü`, response);
                showNotification(`„Çπ„ÉÜ„Éº„Çø„Çπ„Çí„Äå${apiStatus}„Äç„Å´Êõ¥Êñ∞„Åó„Åæ„Åó„Åü`, 'success');
            }).catch(error => {
                console.error('„Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞„Ç®„É©„Éº:', error);
                showNotification('„Çπ„ÉÜ„Éº„Çø„Çπ„ÅÆÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                // ÂÖÉ„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Å´Êàª„Åô
                location.reload();
            });

            // ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫ÔºàÂç≥Â∫ß„Å´UIÊõ¥Êñ∞Ôºâ
            const statusLabelsDisplay = {
                'active': '„Ç¢„ÇØ„ÉÜ„Ç£„Éñ',
                'inactive': 'Èùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ',
                'paused': '‰∏ÄÊôÇÂÅúÊ≠¢',
                'silent': '„Çµ„Ç§„É¨„É≥„Éà',
                'suspended': '‰ºëÊ≠¢',
                'withdrawn': 'ÈÄÄ‰ºö'
            };

            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
            notification.textContent = `„Çπ„ÉÜ„Éº„Çø„Çπ„Çí„Äå${statusLabels[status]}„Äç„Å´Êõ¥Êñ∞„Åó„Åæ„Åó„Åü`;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Âä†ÁõüÂ∫óË©≥Á¥∞Ë°®Á§∫
        window.showFranchiseDetail = function(franchiseId) {
            // franchiseData„Åã„ÇâË©≤ÂΩì„ÅÆÂä†ÁõüÂ∫ó„ÇíÂèñÂæó
            const franchiseBase = window.franchiseData ? window.franchiseData.find(f => f.id === franchiseId) : null;
            if (!franchiseBase) {
                alert('Âä†ÁõüÂ∫ó„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }

            // Ë©≥Á¥∞„Éá„Éº„Çø„ÇíÊßãÁØâÔºàÂÆüÈöõ„ÅØAPI„Åã„ÇâÂèñÂæóÔºâ
            const franchise = {
                ...franchiseBase,
                phone: '03-1234-5678',
                performance: {
                    thisMonth: { contracts: 12, rate: 68, avgPrice: '¬•266,000', leads: 18 },
                    lastMonth: { contracts: 10, rate: 63, avgPrice: '¬•245,000', leads: 16 },
                    threeMonths: { contracts: 31, rate: 65, avgPrice: '¬•255,000', leads: 48 }
                },
                activeProjects: 5,
                pendingProjects: 3,
                lastActivity: '2025-01-19 14:30',
                settings: {
                    areas: ['‰∏ñÁî∞Ë∞∑Âå∫', 'Êùâ‰∏¶Âå∫', 'Ê∏ãË∞∑Âå∫', 'ÁõÆÈªíÂå∫'],
                    services: ['Â§ñÂ£ÅÂ°óË£Ö', 'Â±ãÊ†πÂ°óË£Ö', 'Èò≤Ê∞¥Â∑•‰∫ã', '„Ç∑„Éº„É™„É≥„Ç∞'],
                    handicap: franchiseBase.handicap,
                    status: franchiseBase.status
                }
            };

            // „É¢„Éº„ÉÄ„É´HTML‰ΩúÊàê
            const modalHtml = `
                <div id="franchiseDetailModal" class="fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm overflow-y-auto h-full w-full z-50" onclick="closeFranchiseDetail(event)">
                    <div class="relative top-10 mx-auto p-5 w-full max-w-5xl" onclick="event.stopPropagation()">
                        <div class="bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-2xl border border-gray-200 overflow-hidden">
                            <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                            <div class="relative bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-5">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <h2 class="text-3xl font-bold text-white flex items-center">
                                            ${franchise.name}
                                            <span class="ml-3 px-3 py-1 text-xs font-semibold rounded-full ${
                                                franchise.status === 'active' ? 'bg-green-400 text-green-900' :
                                                franchise.status === 'inactive' ? 'bg-purple-400 text-purple-900' :
                                                'bg-yellow-400 text-yellow-900'
                                            }">
                                                ${franchise.status === 'active' ? '„Ç¢„ÇØ„ÉÜ„Ç£„Éñ' :
                                                  franchise.status === 'inactive' ? 'Èùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ' :
                                                  franchise.status === 'paused' ? '‰∏ÄÊôÇÂÅúÊ≠¢‰∏≠' :
                                                  franchise.status === 'silent' ? '„Çµ„Ç§„É¨„É≥„Éà' :
                                                  franchise.status === 'suspended' ? '‰ºëÊ≠¢' : 'ÈÄÄ‰ºö'}
                                            </span>
                                        </h2>
                                        <p class="text-blue-100 mt-1">
                                            <span class="inline-flex items-center">
                                                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                                                </svg>
                                                ${franchise.areaDetail || franchise.area}
                                            </span>
                                            <span class="ml-4">ID: ${franchise.id}</span>
                                        </p>
                                    </div>
                                    <button onclick="closeFranchiseDetail()" class="text-white hover:text-gray-200 transition-colors">
                                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <div class="p-8 space-y-6 max-h-[70vh] overflow-y-auto">
                                <!-- üìà „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„Éá„Éº„Çø -->
                                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200">
                                    <h3 class="text-xl font-bold text-gray-800 mb-5 flex items-center">
                                        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-lg flex items-center justify-center mr-3">
                                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                            </svg>
                                        </div>
                                        „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„Éá„Éº„Çø
                                    </h3>

                                    <!-- ÊúüÈñìÂà•„Éá„Éº„Çø -->
                                    <div class="grid grid-cols-3 gap-4 mb-4">
                                        <div class="bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                                            <div class="flex items-center justify-between mb-2">
                                                <div class="text-sm font-semibold text-gray-600">‰ªäÊúà</div>
                                                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                                    <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                                    </svg>
                                                </div>
                                            </div>
                                            <div class="text-2xl font-bold text-gray-800">${franchise.performance.thisMonth.contracts}‰ª∂</div>
                                            <div class="flex items-center mt-2">
                                                <div class="text-sm font-semibold text-green-600">ÊàêÁ¥ÑÁéá ${franchise.performance.thisMonth.rate}%</div>
                                            </div>
                                            <div class="text-xs text-gray-500 mt-1">Âπ≥Âùá ${franchise.performance.thisMonth.avgPrice}</div>
                                        </div>
                                        <div class="bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                                            <div class="flex items-center justify-between mb-2">
                                                <div class="text-sm font-semibold text-gray-600">ÂÖàÊúà</div>
                                                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                    </svg>
                                                </div>
                                            </div>
                                            <div class="text-2xl font-bold text-gray-800">${franchise.performance.lastMonth.contracts}‰ª∂</div>
                                            <div class="flex items-center mt-2">
                                                <div class="text-sm font-semibold text-blue-600">ÊàêÁ¥ÑÁéá ${franchise.performance.lastMonth.rate}%</div>
                                            </div>
                                            <div class="text-xs text-gray-500 mt-1">Âπ≥Âùá ${franchise.performance.lastMonth.avgPrice}</div>
                                        </div>
                                        <div class="bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                                            <div class="flex items-center justify-between mb-2">
                                                <div class="text-sm font-semibold text-gray-600">3„É∂ÊúàÁ¥ØË®à</div>
                                                <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                                                    <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
                                                    </svg>
                                                </div>
                                            </div>
                                            <div class="text-2xl font-bold text-gray-800">${franchise.performance.threeMonths.contracts}‰ª∂</div>
                                            <div class="flex items-center mt-2">
                                                <div class="text-sm font-semibold text-purple-600">ÊàêÁ¥ÑÁéá ${franchise.performance.threeMonths.rate}%</div>
                                            </div>
                                            <div class="text-xs text-gray-500 mt-1">Âπ≥Âùá ${franchise.performance.threeMonths.avgPrice}</div>
                                        </div>
                                    </div>

                                    <!-- Á∞°Êòì„Ç∞„É©„Éï -->
                                    <div class="bg-white p-4 rounded-lg shadow-sm">
                                        <div class="text-sm font-semibold text-gray-700 mb-3">ÊàêÁ¥ÑÁéáÊé®Áßª</div>
                                        <div class="flex items-end space-x-3 h-24">
                                            <div class="flex-1 bg-gradient-to-t from-blue-500 to-blue-400 rounded-t-lg shadow-sm" style="height: 63%"></div>
                                            <div class="flex-1 bg-gradient-to-t from-green-500 to-green-400 rounded-t-lg shadow-sm" style="height: 68%"></div>
                                            <div class="flex-1 bg-gradient-to-t from-purple-500 to-purple-400 rounded-t-lg shadow-sm" style="height: 65%"></div>
                                        </div>
                                        <div class="flex justify-between text-xs font-medium text-gray-600 mt-2">
                                            <span>ÂÖàÊúà</span>
                                            <span>‰ªäÊúà</span>
                                            <span>3„É∂ÊúàÂπ≥Âùá</span>
                                        </div>
                                    </div>

                                    <!-- Ê°à‰ª∂Áä∂Ê≥Å -->
                                    <div class="grid grid-cols-2 gap-4 mt-4">
                                        <div class="bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <div class="text-sm font-semibold text-gray-600">‰øùÊúâÊ°à‰ª∂Êï∞</div>
                                                    <div class="text-3xl font-bold text-blue-600 mt-1">${franchise.activeProjects}</div>
                                                </div>
                                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                                    <svg class="w-7 h-7 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                                    </svg>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <div class="text-sm font-semibold text-gray-600">ÈÄ≤Ë°å‰∏≠Ê°à‰ª∂</div>
                                                    <div class="text-3xl font-bold text-orange-600 mt-1">${franchise.pendingProjects}</div>
                                                </div>
                                                <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                                    <svg class="w-7 h-7 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                    </svg>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mt-3 text-sm text-gray-600">
                                        ÊúÄÁµÇÊ¥ªÂãïÊó•: <span class="font-medium">${franchise.lastActivity}</span>
                                    </div>
                                </div>

                                <!-- üìù Á∞°Êòì„É°„É¢ -->
                                <div class="bg-gradient-to-r from-orange-50 to-amber-50 rounded-xl p-6 border border-orange-200">
                                    <h3 class="text-xl font-bold text-gray-800 mb-5 flex items-center">
                                        <div class="w-10 h-10 bg-gradient-to-r from-orange-500 to-amber-500 rounded-lg flex items-center justify-center mr-3">
                                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                        </div>
                                        Á∞°Êòì„É°„É¢
                                    </h3>

                                    <div id="memoList" class="space-y-3 mb-4 max-h-64 overflow-y-auto">
                                        ${franchise.memos && franchise.memos.length > 0 ? franchise.memos.map(memo =>
                                            `<div class="bg-white p-3 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                                                <div class="flex items-center justify-between mb-1">
                                                    <div class="text-xs font-semibold text-orange-600">${memo.date}</div>
                                                    <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fill-rule="evenodd" d="M18 13V5a2 2 0 00-2-2H4a2 2 0 00-2 2v8a2 2 0 002 2h3l3 3 3-3h3a2 2 0 002-2zM5 7a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zm1 3a1 1 0 100 2h3a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                                                    </svg>
                                                </div>
                                                <div class="text-sm text-gray-700 leading-relaxed">${memo.content}</div>
                                            </div>`
                                        ).join('') : '<p class="text-gray-500 text-center py-4">„Åæ„Å†„É°„É¢„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>'}
                                    </div>

                                    <button onclick="addMemoInModal('${franchise.id}')" class="w-full py-3 bg-gradient-to-r from-orange-500 to-amber-500 text-white text-sm font-semibold rounded-lg hover:from-orange-600 hover:to-amber-600 transition-all shadow-sm hover:shadow-md">
                                        <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                        </svg>
                                        Êñ∞„Åó„ÅÑ„É°„É¢„ÇíËøΩÂä†
                                    </button>
                                </div>
                            </div>

                            <!-- „Éï„ÉÉ„Çø„Éº -->
                            <div class="px-6 py-5 bg-gray-50 border-t border-gray-200 flex justify-between items-center">
                                <button onclick="openFranchisePage('${franchise.id}')" class="group px-6 py-3 bg-gradient-to-r from-yellow-400 to-yellow-500 text-gray-900 font-bold rounded-lg hover:from-yellow-500 hover:to-yellow-600 transform hover:scale-105 transition-all shadow-lg hover:shadow-xl flex items-center space-x-2">
                                    <svg class="w-6 h-6 text-gray-900 group-hover:animate-pulse" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>Super Access</span>
                                </button>
                                <button onclick="closeFranchiseDetail()" class="px-5 py-2.5 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition-colors">
                                    Èñâ„Åò„Çã
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // „É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        // „É¢„Éº„ÉÄ„É´„ÅÆ„Çπ„ÉÜ„Éº„Çø„ÇπËâ≤„ÇØ„É©„Çπ„ÇíÂèñÂæó
        function getModalStatusColorClass(status) {
            const statusColors = {
                'active': 'bg-green-100 text-green-800 border-green-300',
                'inactive': 'bg-purple-100 text-purple-800 border-purple-300',
                'paused': 'bg-yellow-100 text-yellow-800 border-yellow-300',
                'suspended': 'bg-red-100 text-red-800 border-red-300',
                'silent': 'bg-gray-100 text-gray-800 border-gray-300'
            };
            return statusColors[status] || statusColors['active'];
        }

        // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeFranchiseDetail(event) {
            if (!event || event.target.id === 'franchiseDetailModal') {
                const modal = document.getElementById('franchiseDetailModal');
                if (modal) modal.remove();
            }
        }

        // Âä†ÁõüÂ∫óÁîªÈù¢„ÇíÈñã„Åè
        function openFranchisePage(franchiseId) {
            // ÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Åß„ÅØÂä†ÁõüÂ∫óÂ∞ÇÁî®ÁîªÈù¢„Å∏ÈÅ∑Áßª
            // „Åì„Åì„Åß„ÅØ‰ªÆ„ÅÆURL„Éë„Çø„Éº„É≥„ÅßË°®Á§∫
            const franchiseUrl = `/franchise-dashboard/${franchiseId}`;
            console.log(`Âä†ÁõüÂ∫óÁîªÈù¢„ÇíÈñã„Åè: ${franchiseUrl}`);

            // Êñ∞„Åó„ÅÑ„Çø„Éñ„ÅßÈñã„ÅèÂ†¥Âêà
            window.open(franchiseUrl, '_blank');

            // Âêå„Åò„Çø„Éñ„ÅßÈÅ∑Áßª„Åô„ÇãÂ†¥Âêà„ÅØ‰ª•‰∏ã„Çí‰ΩøÁî®
            // window.location.href = franchiseUrl;
        }

        // „É¢„Éº„ÉÄ„É´ÂÜÖ„Åß„É°„É¢„ÇíËøΩÂä†
        function addMemoInModal(franchiseId) {
            const memoContent = prompt('„É°„É¢„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö');
            if (memoContent) {
                const franchise = window.franchiseData ? window.franchiseData.find(f => f.id === franchiseId) : null;
                if (franchise) {
                    const today = new Date().toISOString().split('T')[0];
                    if (!franchise.memos) franchise.memos = [];
                    franchise.memos.unshift({ date: today, content: memoContent });
                    console.log(`Âä†ÁõüÂ∫ó ${franchiseId} „Å´„É°„É¢„ÇíËøΩÂä†: ${memoContent}`);
                    alert('„É°„É¢„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü');
                    updateModalMemos(franchiseId);
                }
            }
        }

        // „É¢„Éº„ÉÄ„É´ÂÜÖ„ÅÆ„É°„É¢„É™„Çπ„Éà„ÇíÊõ¥Êñ∞
        function updateModalMemos(franchiseId) {
            const franchise = window.franchiseData ? window.franchiseData.find(f => f.id === franchiseId) : null;
            if (!franchise) return;

            const memoList = document.getElementById('memoList');
            if (memoList) {
                memoList.innerHTML = franchise.memos && franchise.memos.length > 0 ? franchise.memos.map(memo => `
                    <div class="bg-white p-3 rounded border border-gray-200">
                        <div class="text-xs text-gray-500 mb-1">${memo.date}</div>
                        <div class="text-sm text-gray-700">${memo.content}</div>
                    </div>
                `).join('') : '<p class="text-gray-500">„Åæ„Å†„É°„É¢„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
            }
        }

        // Âä†ÁõüÂ∫ó„Å´ÈõªË©±
        function callFranchise(franchiseId) {
            console.log(`Âä†ÁõüÂ∫ó ${franchiseId} „Å´ÈõªË©±`);
            // ÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Åß„ÅØÈõªË©±Áï™Âè∑„ÇíÂèñÂæó„Åó„Å¶„ÉÄ„Ç§„É§„É´
            alert(`Âä†ÁõüÂ∫ó ${franchiseId} „Å´ÈõªË©±„Çí„Åã„Åë„Åæ„Åô`);
        }

        // Âä†ÁõüÂ∫ó„Å´„É°„Éº„É´
        function emailFranchise(franchiseId) {
            console.log(`Âä†ÁõüÂ∫ó ${franchiseId} „Å´„É°„Éº„É´`);
            // ÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Åß„ÅØ„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíÂèñÂæó„Åó„Å¶„É°„Éº„É´„ÇØ„É©„Ç§„Ç¢„É≥„Éà„ÇíËµ∑Âãï
            alert(`Âä†ÁõüÂ∫ó ${franchiseId} „Å´„É°„Éº„É´„ÇíÈÄÅ‰ø°„Åó„Åæ„Åô`);
        }

        // Âä†ÁõüÂ∫ó„Å´ÈÄöÁü•
        function snsFranchise(franchiseId) {
            console.log(`Âä†ÁõüÂ∫ó ${franchiseId} „Å´ÈÄöÁü•`);
            // ÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Åß„ÅØÈÄöÁü•„Ç∑„Çπ„ÉÜ„É†„Å®ÈÄ£Êê∫
            alert(`Âä†ÁõüÂ∫ó ${franchiseId} „Å´ÈÄöÁü•„ÇíÈÄÅ‰ø°„Åó„Åæ„Åô`);
        }

        // Âä†ÁõüÂ∫ó„Å´„É°„É¢„ÇíËøΩÂä†
        function addMemo(franchiseId) {
            const memoContent = prompt('„É°„É¢„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö');
            if (memoContent) {
                const franchise = window.franchiseData ? window.franchiseData.find(f => f.id === franchiseId) : null;
                if (franchise) {
                    const today = new Date().toISOString().split('T')[0];
                    if (!franchise.memos) franchise.memos = [];
                    franchise.memos.unshift({ date: today, content: memoContent });
                    console.log(`Âä†ÁõüÂ∫ó ${franchiseId} „Å´„É°„É¢„ÇíËøΩÂä†: ${memoContent}`);
                    alert('„É°„É¢„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü');
                    // „É¢„Éº„ÉÄ„É´„ÅåÈñã„ÅÑ„Å¶„ÅÑ„Çå„Å∞Êõ¥Êñ∞
                    if (document.getElementById('franchiseDetailModal')) {
                        updateModalMemos(franchiseId);
                    }
                }
            }
        }

        // „É°„Éã„É•„Éº„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
        function updateActiveMenu(activeSection) {
            // „Åô„Åπ„Å¶„ÅÆ„É°„Éã„É•„Éº„Ç¢„Ç§„ÉÜ„É†„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„ÇØ„É©„Çπ„ÇíÂâäÈô§
            const menuItems = document.querySelectorAll('#sideMenu a');
            menuItems.forEach(item => {
                item.classList.remove('bg-gradient-to-r', 'from-blue-600', 'to-blue-500', 'text-gray-100');
                item.classList.add('hover:bg-gray-800', 'text-gray-400', 'hover:text-gray-100');
            });

            // ÁèæÂú®„ÅÆ„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆ„É°„Éã„É•„Éº„Çí„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´„Åô„Çã
            let selector = '';
            switch(activeSection) {
                case 'dashboard':
                    selector = 'a[href="#dashboard"]';
                    break;
                case 'assignment':
                    selector = 'a[href="#assignment"]';
                    break;
                case 'franchise':
                    selector = 'a[href="#franchise"]';
                    break;
                case 'registrationRequests':
                    selector = 'a[href="#registration-requests"]';
                    break;
                case 'cancelRequests':
                    selector = 'a[href="#cancel-requests"]';
                    break;
                case 'financial':
                    selector = 'a[href="#financial"]';
                    break;
                case 'ranking':
                    selector = 'a[href="#ranking"]';
                    break;
            }

            if (selector) {
                const activeItem = document.querySelector('#sideMenu ' + selector);
                if (activeItem) {
                    activeItem.classList.remove('hover:bg-gray-800', 'text-gray-400', 'hover:text-gray-100');
                    activeItem.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-blue-500', 'text-gray-100');
                }
            }
        }

        // „ÇΩ„Éº„ÉàÊ©üËÉΩ
        function sortFranchises(sortType) {
            const button = event.target.closest('button');
            const label = button.getAttribute('data-label');

            console.log('sortFranchises called:', sortType, label); // „Éá„Éê„ÉÉ„Ç∞Áî®

            // „ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åü„Éú„Çø„É≥„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„Çí„Éà„Ç∞„É´
            const isActive = button.classList.contains('border-pink-400') ||
                           button.classList.contains('border-purple-400') ||
                           button.classList.contains('border-blue-400') ||
                           button.classList.contains('border-orange-400') ||
                           button.classList.contains('border-green-400');

            if (isActive) {
                // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™Â†¥Âêà„ÅØÈùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´Êàª„Åô
                button.classList.remove(
                    'border-pink-400', 'bg-pink-50',
                    'border-purple-400', 'bg-purple-50',
                    'border-blue-400', 'bg-blue-50',
                    'border-orange-400', 'bg-orange-50',
                    'border-green-400', 'bg-green-50'
                );
                button.classList.add('border-gray-200', 'bg-white');

                // „É©„Éô„É´„Çí„ÇØ„É™„Ç¢
                const labelDisplay = document.getElementById('sortLabelDisplay');
                if (labelDisplay) {
                    labelDisplay.textContent = '';
                }
            } else {
                // Èùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™Â†¥Âêà„ÅØ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´„Åô„ÇãÔºàhoverÊôÇ„Å®Âêå„ÅòËâ≤Ôºâ
                button.classList.remove('border-gray-200', 'bg-white');

                // „ÇΩ„Éº„Éà„Çø„Ç§„Éó„Å´Âøú„Åò„Å¶ÈÅ©Âàá„Å™„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Çπ„Çø„Ç§„É´„ÇíÈÅ©Áî®
                if (sortType === 'selected') {
                    button.classList.add('border-pink-400', 'bg-pink-50');
                } else if (sortType === 'distance') {
                    button.classList.add('border-purple-400', 'bg-purple-50');
                } else if (sortType === 'recommend') {
                    button.classList.add('border-blue-400', 'bg-blue-50');
                } else if (sortType === 'price') {
                    button.classList.add('border-orange-400', 'bg-orange-50');
                } else if (sortType === 'review') {
                    button.classList.add('border-green-400', 'bg-green-50');
                } else if (sortType === 'quality') {
                    button.classList.add('border-purple-400', 'bg-purple-50');
                }

                // „É©„Éô„É´„ÇíË°®Á§∫
                const labelDisplay = document.getElementById('sortLabelDisplay');
                if (labelDisplay && label) {
                    labelDisplay.textContent = label;
                    console.log('Label displayed:', label); // „Éá„Éê„ÉÉ„Ç∞Áî®
                }
            }

            // „ÇΩ„Éº„ÉàÂá¶ÁêÜ„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏
            const sortLabels = {
                'sales': 'Â£≤‰∏ä',
                'conversion': 'ÊàêÁ¥ÑÁéá',
                'activity': 'ÊúÄÁµÇÊ¥ªÂãï',
                'cospa': '„Ç≥„Çπ„Éë',
                'cases': 'Ê°à‰ª∂Êï∞',
                'newest': 'Êñ∞ÁùÄ'
            };

            const orderLabel = newOrder === 'desc' ? 'ÈôçÈ†Ü' : 'ÊòáÈ†Ü';
            console.log(`${sortLabels[sortType]}„Çí${orderLabel}„Åß„ÇΩ„Éº„Éà„Åó„Åæ„Åó„Åü`);

            // ÂÆüÈöõ„ÅÆ„ÇΩ„Éº„ÉàÂá¶ÁêÜ„ÅØ„Åì„Åì„ÅßÂÆüË£Ö
            // API„Ç≥„Éº„É´„Åæ„Åü„ÅØ„ÇØ„É©„Ç§„Ç¢„É≥„ÉàÂÅ¥„ÅÆ„ÇΩ„Éº„Éà„É≠„Ç∏„ÉÉ„ÇØ
        }

        // „Çª„ÇØ„Ç∑„Éß„É≥Âàá„ÇäÊõø„ÅàÊ©üËÉΩ
        // ÁèæÂú®„ÅÆ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíËøΩË∑°
        let currentSection = 'assignment'; // „Éá„Éï„Ç©„É´„Éà„ÅØÊ°à‰ª∂ÁÆ°ÁêÜ

        function showSection(sectionName) {
            // Êú™‰øùÂ≠òÂ§âÊõ¥„ÉÅ„Çß„ÉÉ„ÇØ
            if (unsavedChanges.size > 0 && sectionName !== currentSection) {
                console.log('[showSection] Êú™‰øùÂ≠ò„ÅÆÂ§âÊõ¥„Åå„ÅÇ„Çä„Åæ„Åô:', unsavedChanges.size, '‰ª∂');
                showSectionNavigationWarning(sectionName);
                // ÂÖÉ„ÅÆ„Éè„ÉÉ„Ç∑„É•„Å´Êàª„Åô
                window.location.hash = '#' + currentSection;
                return;
            }

            // ÁèæÂú®„ÅÆ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÊõ¥Êñ∞
            currentSection = sectionName;

            // „É°„Éã„É•„Éº„ÇíÈñâ„Åò„Çã
            document.getElementById('sideMenu').classList.add('-translate-x-full');

            // ÂàùÊúüÊ°à‰ª∂ÁÆ°ÁêÜ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Çí‰øùÂ≠òÔºàÂàùÂõû„ÅÆ„ÅøÔºâ
            if (!window.originalAssignmentContent && sectionName !== 'assignment') {
                window.originalAssignmentContent = document.querySelector('main').innerHTML;
            }

            // URL„Éè„ÉÉ„Ç∑„É•„ÇíÊõ¥Êñ∞
            window.location.hash = '#' + sectionName;

            // „É°„Éã„É•„Éº„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            updateActiveMenu(sectionName);

            const mainContent = document.querySelector('main');

            // „Çª„ÇØ„Ç∑„Éß„É≥„Å´Âøú„Åò„Åü„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË°®Á§∫
            if (sectionName === 'assignment') {
                // Ê°à‰ª∂ÁÆ°ÁêÜ„ÇíË°®Á§∫Ôºà‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Çå„Å∞Âæ©ÂÖÉ„ÄÅ„Å™„Åë„Çå„Å∞ÁèæÂú®„ÅÆÂÜÖÂÆπ„Çí‰øùÊåÅÔºâ
                if (window.originalAssignmentContent) {
                    mainContent.innerHTML = window.originalAssignmentContent;
                }

                // „É™„Çπ„Éà„Éì„É•„Éº„ÇíËá™ÂãïË°®Á§∫
                setTimeout(() => {
                    if (typeof switchView === 'function') {
                        switchView('list');
                        console.log('[Assignment] Ê°à‰ª∂ÁÆ°ÁêÜ„Å´Êàª„Çä„Åæ„Åó„Åü - „É™„Çπ„Éà„Éì„É•„Éº„ÇíË°®Á§∫');
                    }
                }, 100); // DOMÊõ¥Êñ∞„ÇíÂæÖ„Å§„Åü„ÇÅÂ∞ë„ÅóÈÅÖÂª∂

            } else if (sectionName === 'dashboard') {
                // ÁèæÂú®„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÈùûË°®Á§∫
                const mainContent = document.querySelector('main');
                window.location.href = '#dashboard';
                mainContent.innerHTML = `
                    <div class="pt-20 px-6 max-w-7xl mx-auto">
                        <div class="mb-8">
                            <h1 class="text-4xl font-bold text-gray-800 mb-2">„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</h1>
                            <p class="text-gray-600">„É™„Ç¢„É´„Çø„Ç§„É†„É¢„Éã„Çø„Éº</p>
                        </div>
                        
                        <!-- KPI„Ç´„Éº„Éâ -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white rounded-xl p-6 border border-gray-200 hover:shadow-lg transition-shadow">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-500">Êú™ÊåØÂàÜÊ°à‰ª∂</span>
                                    <span class="text-xs bg-red-100 text-red-600 px-2 py-1 rounded-full animate-pulse">Ë¶ÅÂØæÂøú</span>
                                </div>
                                <div class="mt-4 text-3xl font-bold text-gray-800">7</div>
                                <div class="mt-2 text-xs text-gray-500">Áõ¥Ëøë1ÊôÇÈñì: +3</div>
                            </div>
                            <div class="bg-white rounded-xl p-6 border border-gray-200 hover:shadow-lg transition-shadow">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-500">Êú¨Êó•ÊåØÂàÜÊ∏à</span>
                                    <span class="text-xs text-green-600">+12%</span>
                                </div>
                                <div class="mt-4 text-3xl font-bold text-gray-800">24</div>
                                <div class="mt-2 text-xs text-gray-500">ÁõÆÊ®ô: 30‰ª∂</div>
                            </div>
                            <div class="bg-white rounded-xl p-6 border border-gray-200 hover:shadow-lg transition-shadow">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-500">ÈÄ≤Ë°å‰∏≠Ê°à‰ª∂</span>
                                    <span class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full">Ê¥ªÁô∫</span>
                                </div>
                                <div class="mt-4 text-3xl font-bold text-gray-800">42</div>
                                <div class="mt-2 text-xs text-gray-500">Ë¶ãÁ©çÊèêÂá∫ÂæÖ„Å°: 18</div>
                            </div>
                            <div class="bg-white rounded-xl p-6 border border-gray-200 hover:shadow-lg transition-shadow">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-500">‰ªäÊúàÊàêÁ¥Ñ</span>
                                    <span class="text-xs text-purple-600">ÁõÆÊ®ô85%</span>
                                </div>
                                <div class="mt-4 text-3xl font-bold text-gray-800">¬•8.5M</div>
                                <div class="mt-2 text-xs text-gray-500">Á¥π‰ªãÊñô: ¬•1.28M</div>
                            </div>
                        </div>
                        
                        <!-- „Ç∞„É©„Éï„Ç®„É™„Ç¢ -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                            <div class="bg-white rounded-xl p-6 border border-gray-200">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">Ê°à‰ª∂„Çπ„ÉÜ„Éº„Çø„ÇπÂàÜÂ∏É</h3>
                                <div class="space-y-3">
                                    <div class="flex items-center">
                                        <span class="text-sm text-gray-600 w-24">Êú™ÊåØÂàÜ</span>
                                        <div class="flex-1 bg-gray-200 rounded-full h-6 relative">
                                            <div class="bg-red-500 h-6 rounded-full" style="width: 15%"></div>
                                        </div>
                                        <span class="text-sm text-gray-800 ml-3 font-semibold">7‰ª∂</span>
                                    </div>
                                    <div class="flex items-center">
                                        <span class="text-sm text-gray-600 w-24">ÊåØÂàÜÊ∏à</span>
                                        <div class="flex-1 bg-gray-200 rounded-full h-6 relative">
                                            <div class="bg-yellow-500 h-6 rounded-full" style="width: 25%"></div>
                                        </div>
                                        <span class="text-sm text-gray-800 ml-3 font-semibold">12‰ª∂</span>
                                    </div>
                                    <div class="flex items-center">
                                        <span class="text-sm text-gray-600 w-24">ÈÄ≤Ë°å‰∏≠</span>
                                        <div class="flex-1 bg-gray-200 rounded-full h-6 relative">
                                            <div class="bg-blue-500 h-6 rounded-full" style="width: 45%"></div>
                                        </div>
                                        <span class="text-sm text-gray-800 ml-3 font-semibold">42‰ª∂</span>
                                    </div>
                                    <div class="flex items-center">
                                        <span class="text-sm text-gray-600 w-24">ÂÆå‰∫Ü</span>
                                        <div class="flex-1 bg-gray-200 rounded-full h-6 relative">
                                            <div class="bg-green-500 h-6 rounded-full" style="width: 35%"></div>
                                        </div>
                                        <span class="text-sm text-gray-800 ml-3 font-semibold">28‰ª∂</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-xl p-6 border border-gray-200">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">Âä†ÁõüÂ∫ó„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ TOP5</h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between p-2 hover:bg-gray-50 rounded">
                                        <div class="flex items-center">
                                            <span class="text-lg font-bold text-yellow-500 w-8">1</span>
                                            <span class="text-sm text-gray-800">Áî∞‰∏≠Â°óË£ÖÂ∑•Ê•≠</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-sm font-semibold text-gray-800">ÊàêÁ¥ÑÁéá 68%</div>
                                            <div class="text-xs text-gray-500">‰ªäÊúà 12‰ª∂</div>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between p-2 hover:bg-gray-50 rounded">
                                        <div class="flex items-center">
                                            <span class="text-lg font-bold text-gray-400 w-8">2</span>
                                            <span class="text-sm text-gray-800">Â±±Áî∞„Éö„Ç§„É≥„Éà</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-sm font-semibold text-gray-800">ÊàêÁ¥ÑÁéá 62%</div>
                                            <div class="text-xs text-gray-500">‰ªäÊúà 10‰ª∂</div>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between p-2 hover:bg-gray-50 rounded">
                                        <div class="flex items-center">
                                            <span class="text-lg font-bold text-orange-600 w-8">3</span>
                                            <span class="text-sm text-gray-800">‰ΩêËó§Â°óË£ÖÂ∫ó</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-sm font-semibold text-gray-800">ÊàêÁ¥ÑÁéá 58%</div>
                                            <div class="text-xs text-gray-500">‰ªäÊúà 9‰ª∂</div>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between p-2 hover:bg-gray-50 rounded">
                                        <div class="flex items-center">
                                            <span class="text-lg font-bold text-gray-400 w-8">4</span>
                                            <span class="text-sm text-gray-800">Èà¥Êú®Âª∫Ë£Ö</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-sm font-semibold text-gray-800">ÊàêÁ¥ÑÁéá 55%</div>
                                            <div class="text-xs text-gray-500">‰ªäÊúà 8‰ª∂</div>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between p-2 hover:bg-gray-50 rounded">
                                        <div class="flex items-center">
                                            <span class="text-lg font-bold text-gray-400 w-8">5</span>
                                            <span class="text-sm text-gray-800">È´òÊ©ãÂ°óË£Ö</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-sm font-semibold text-gray-800">ÊàêÁ¥ÑÁéá 52%</div>
                                            <div class="text-xs text-gray-500">‰ªäÊúà 7‰ª∂</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- „Ç¢„É©„Éº„Éà„Ç®„É™„Ç¢ -->
                        <div class="bg-white rounded-xl p-6 border border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Ë¶ÅÂØæÂøú„Ç¢„É©„Éº„Éà</h3>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between p-3 bg-red-50 border-l-4 border-red-500 rounded">
                                    <div>
                                        <div class="text-sm font-semibold text-red-800">Ê°à‰ª∂ID: #2024-0892</div>
                                        <div class="text-xs text-red-600">30ÂàÜ‰ª•‰∏äÊú™ÊåØÂàÜ - ÂçÉËëâÁúåËàπÊ©ãÂ∏Ç„ÅÆÊà∏Âª∫„Å¶Ê°à‰ª∂</div>
                                    </div>
                                    <button onclick="showSection('assignment')" class="px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600">ÂØæÂøú„Åô„Çã</button>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-purple-50 border-l-4 border-purple-500 rounded animate-pulse">
                                    <div>
                                        <div class="text-sm font-semibold text-purple-800">üö® „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã</div>
                                        <div class="text-xs text-purple-600">Áî∞‰∏≠Â°óË£ÖÂ∑•Ê•≠„Çà„Çä - Ê°à‰ª∂ID: #2024-0885„ÄåÂØæÂøú‰∏çÂèØ„ÅÆ„Åü„ÇÅËæûÈÄÄ„Äç</div>
                                    </div>
                                    <button onclick="showCancelRequest('#2024-0885')" class="px-3 py-1 bg-purple-500 text-white text-xs rounded hover:bg-purple-600">Âá¶ÁêÜ„Åô„Çã</button>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-yellow-50 border-l-4 border-yellow-500 rounded">
                                    <div>
                                        <div class="text-sm font-semibold text-yellow-800">Âä†ÁõüÂ∫ó: Â±±Áî∞„Éö„Ç§„É≥„Éà</div>
                                        <div class="text-xs text-yellow-600">Ë¶ãÁ©çÊèêÂá∫ÊúüÈôê„Åæ„ÅßÊÆã„Çä2ÊôÇÈñì</div>
                                    </div>
                                    <button class="px-3 py-1 bg-yellow-500 text-white text-xs rounded hover:bg-yellow-600">Á¢∫Ë™ç</button>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-blue-50 border-l-4 border-blue-500 rounded">
                                    <div>
                                        <div class="text-sm font-semibold text-blue-800">Ë´ãÊ±ÇÂá¶ÁêÜ</div>
                                        <div class="text-xs text-blue-600">3‰ª∂„ÅÆÊàêÁ¥ÑÊ°à‰ª∂„ÅÆÁ¥π‰ªãÊñôË®àÁÆó„ÅåÊú™ÂÆå‰∫Ü</div>
                                    </div>
                                    <button onclick="showSection('financial')" class="px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600">Âá¶ÁêÜ„Åô„Çã</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (sectionName === 'franchise') {
                // Âä†ÁõüÂ∫óÁÆ°ÁêÜ„Çª„ÇØ„Ç∑„Éß„É≥
                const mainContent = document.querySelector('main');

                // ÂÖà„Å´ÁîªÈù¢„Çí„ÇØ„É™„Ç¢„Åó„Å¶Âä†ÁõüÂ∫óÁÆ°ÁêÜ„ÅÆÂü∫Êú¨ÊßãÈÄ†„ÇíË°®Á§∫
                mainContent.innerHTML = ''; // ‰∏ÄÊó¶„ÇØ„É™„Ç¢

                // Âæå„Åß„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÂÆü„Éá„Éº„Çø„ÇíÂèñÂæó
                (window.loadFranchiseManagementData || loadFranchiseManagementData)('all').then(response => {
                    console.log('Âä†ÁõüÂ∫ó„Éá„Éº„ÇøÂèñÂæóÊàêÂäü:', response);

                    // „Éá„Éº„Çø„ÇíÁîªÈù¢Áî®„Å´Â§âÊèõ
                    window.franchiseData = response.data.map(f => ({
                        id: f.id,
                        name: f.companyName,
                        avatar: {
                            text: f.companyName ? f.companyName.substring(0, 1) : 'Ôºü',
                            colorClass: 'bg-blue-100',
                            textColorClass: 'text-blue-600'
                        },
                        area: f.area,
                        areaDetail: f.area,
                        conversionRate: f.contractRate || 0,
                        conversionChange: f.performance ? `${f.performance.trend}${f.performance.trendValue}%` : '+0%',
                        conversionColorClass: f.performance && f.performance.trend === '+' ? 'text-green-600' : 'text-yellow-600',
                        monthlyPerformance: {
                            cases: f.deliveryCount ? f.deliveryCount.current : 0,
                            amount: f.deliveryCount ? f.deliveryCount.unit : '¬•0M'
                        },
                        handicap: f.handicap || 0,
                        status: convertStatusForUI(f.status),
                        memos: []
                    }));

                    // „ÉÜ„Éº„Éñ„É´„ÇíÊõ¥Êñ∞ÔºàPCÁâàÔºâ
                    const tbody = document.querySelector('#franchise-table tbody');
                    if (tbody) {
                        tbody.innerHTML = generateFranchiseRows(window.franchiseData);
                    }

                    // „É¢„Éê„Ç§„É´Áâà„ÇíÊõ¥Êñ∞
                    const mobileContainer = document.querySelector('#franchise-mobile-container');
                    if (mobileContainer) {
                        mobileContainer.innerHTML = generateFranchiseMobileCards(window.franchiseData);
                    }

                    // Áµ±Ë®à„ÇíÊõ¥Êñ∞
                    updateFranchiseStats(response.stats);
                }).catch(error => {
                    console.error('Âä†ÁõüÂ∫ó„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº:', error);
                    showNotification('Âä†ÁõüÂ∫ó„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                });

                // „Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊèõÈñ¢Êï∞
                function convertStatusForUI(status) {
                    const statusMap = {
                        '„Ç¢„ÇØ„ÉÜ„Ç£„Éñ': 'active',
                        'Èùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ': 'inactive',
                        '‰∏ÄÊôÇÂÅúÊ≠¢': 'paused',
                        '„Çµ„Ç§„É¨„É≥„Éà': 'silent',
                        '‰ºëÊ≠¢': 'suspended',
                        'ÈÄÄ‰ºö': 'withdrawn'
                    };
                    return statusMap[status] || 'active';
                }

                // Áµ±Ë®àÊÉÖÂ†±„ÇíÊõ¥Êñ∞„Åô„ÇãÈñ¢Êï∞
                function updateFranchiseStats(stats) {
                    const statsHTML = `
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
                            <div class="bg-green-50 rounded-lg p-4">
                                <div class="text-2xl font-bold text-green-600">${stats.active || 0}</div>
                                <div class="text-xs text-gray-600">„Ç¢„ÇØ„ÉÜ„Ç£„Éñ</div>
                            </div>
                            <div class="bg-yellow-50 rounded-lg p-4">
                                <div class="text-2xl font-bold text-yellow-600">${stats.paused || 0}</div>
                                <div class="text-xs text-gray-600">‰∏ÄÊôÇÂÅúÊ≠¢</div>
                            </div>
                            <div class="bg-purple-50 rounded-lg p-4">
                                <div class="text-2xl font-bold text-purple-600">${stats.silent || 0}</div>
                                <div class="text-xs text-gray-600">„Çµ„Ç§„É¨„É≥„Éà</div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="text-2xl font-bold text-gray-600">${stats.inactive || 0}</div>
                                <div class="text-xs text-gray-600">Èùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ</div>
                            </div>
                            <div class="bg-red-50 rounded-lg p-4">
                                <div class="text-2xl font-bold text-red-600">${stats.suspended || 0}</div>
                                <div class="text-xs text-gray-600">‰ºëÊ≠¢</div>
                            </div>
                            <div class="bg-black rounded-lg p-4">
                                <div class="text-2xl font-bold text-white">${stats.withdrawn || 0}</div>
                                <div class="text-xs text-gray-300">ÈÄÄ‰ºö</div>
                            </div>
                        </div>
                    `;

                    // Áµ±Ë®à„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÊåøÂÖ•
                    const searchArea = document.querySelector('.bg-white.rounded-xl.p-4.mb-6');
                    if (searchArea) {
                        searchArea.insertAdjacentHTML('beforebegin', statsHTML);
                    }
                }

                // ÂàùÊúü„É¢„ÉÉ„ÇØ„Éá„Éº„ÇøÔºà„Éá„Éº„ÇøÂèñÂæó‰∏≠„ÅÆË°®Á§∫Áî®Ôºâ
                window.franchiseData = [
                    {
                        id: 'F001',
                        name: 'Áî∞‰∏≠Â°óË£ÖÂ∑•Ê•≠',
                        avatar: { text: 'Áî∞', colorClass: 'bg-blue-100', textColorClass: 'text-blue-600' },
                        area: 'Êù±‰∫¨ÈÉΩ',
                        areaDetail: 'Êù±‰∫¨ÈÉΩ‰∏ñÁî∞Ë∞∑Âå∫ÂåóÊ≤¢2-15-8',
                        conversionRate: 68,
                        conversionChange: '+5%',
                        conversionColorClass: 'text-green-600',
                        monthlyPerformance: { cases: 12, amount: '¬•3.2M' },
                        handicap: 1,
                        status: 'active',
                        memos: []
                    },
                    {
                        id: 'F002',
                        name: 'Â±±Áî∞„Éö„Ç§„É≥„Éà',
                        avatar: { text: 'Â±±', colorClass: 'bg-purple-100', textColorClass: 'text-purple-600' },
                        area: 'Á•ûÂ•àÂ∑ùÁúå',
                        areaDetail: 'Á•ûÂ•àÂ∑ùÁúåÊ®™ÊµúÂ∏Ç‰∏≠Âå∫Êú¨Áî∫3-24-1',
                        conversionRate: 62,
                        conversionChange: '+2%',
                        conversionColorClass: 'text-green-600',
                        monthlyPerformance: { cases: 10, amount: '¬•2.8M' },
                        handicap: 0,
                        status: 'active',
                        memos: []
                    },
                    {
                        id: 'F003',
                        name: '‰ΩêËó§Â°óË£ÖÂ∫ó',
                        avatar: { text: '‰Ωê', colorClass: 'bg-orange-100', textColorClass: 'text-orange-600' },
                        area: 'ÂçÉËëâÁúå',
                        areaDetail: 'ÂçÉËëâÁúåËàπÊ©ãÂ∏ÇÊú¨Áî∫7-11-5',
                        conversionRate: 58,
                        conversionChange: '-3%',
                        conversionColorClass: 'text-yellow-600',
                        monthlyPerformance: { cases: 9, amount: '¬•2.1M' },
                        handicap: -1,
                        status: 'active',
                        memos: []
                    }
                ];

                // ÂÖà„Å´Âä†ÁõüÂ∫óÁÆ°ÁêÜÁîªÈù¢„ÅÆHTML„ÇíË®≠ÂÆö
                mainContent.innerHTML = `
                    <div class="pt-20 px-3 md:px-6 max-w-7xl mx-auto">
                        <div class="mb-6">
                            <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">Âä†ÁõüÂ∫óÁÆ°ÁêÜ</h1>
                            <p class="text-sm md:text-base text-gray-600">Âä†ÁõüÂ∫ó„ÅÆÊÉÖÂ†±ÁÆ°ÁêÜ„Éª„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÂàÜÊûê</p>
                        </div>

                        <div id="franchise-stats-container"></div>

                        <!-- Ê§úÁ¥¢„Éª„Éï„Ç£„É´„Çø„Ç®„É™„Ç¢ -->
                        <div class="bg-white rounded-xl p-3 md:p-4 mb-4 border border-gray-200">
                            <div class="flex flex-wrap gap-2 md:gap-4">
                                <input type="search" id="franchiseSearchInput" placeholder="Âä†ÁõüÂ∫óÂêç„ÅßÊ§úÁ¥¢..." oninput="searchFranchises()" autocomplete="off" class="flex-1 min-w-[150px] px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm touch-manipulation">
                                <select id="franchiseStatusFilter" onchange="filterFranchisesByStatus()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm">
                                    <option value="all">ÂÖ®„Çπ„ÉÜ„Éº„Çø„Çπ</option>
                                    <option value="active">„Ç¢„ÇØ„ÉÜ„Ç£„Éñ</option>
                                    <option value="inactive">Èùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ</option>
                                    <option value="paused">‰∏ÄÊôÇÂÅúÊ≠¢</option>
                                    <option value="silent">„Çµ„Ç§„É¨„É≥„Éà</option>
                                    <option value="suspended">‰ºëÊ≠¢</option>
                                    <option value="withdrawn">ÈÄÄ‰ºö</option>
                                </select>
                            </div>
                        </div>

                        <!-- „ÇΩ„Éº„ÉàÊ©üËÉΩ -->
                        <div class="bg-white rounded-xl p-3 md:p-4 mb-4 border border-gray-200">
                            <div class="flex items-center gap-2 overflow-x-auto">
                                <span class="text-xs md:text-sm font-medium text-gray-700 whitespace-nowrap">‰∏¶„Å≥Êõø„ÅàÔºö</span>
                                <div class="flex gap-2">
                                    <button onclick="sortFranchises('sales')" class="px-3 py-1.5 text-xs md:text-sm bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg shadow hover:shadow-md transition-all whitespace-nowrap">
                                        Â£≤‰∏äÈ†Ü
                                    </button>
                                    <button onclick="sortFranchises('conversion')" class="px-3 py-1.5 text-xs md:text-sm bg-gradient-to-r from-emerald-500 to-emerald-600 text-white rounded-lg shadow hover:shadow-md transition-all whitespace-nowrap">
                                        ÊàêÁ¥ÑÁéáÈ†Ü
                                    </button>
                                    <button onclick="sortFranchises('activity')" class="px-3 py-1.5 text-xs md:text-sm bg-gradient-to-r from-amber-500 to-amber-600 text-white rounded-lg shadow hover:shadow-md transition-all whitespace-nowrap">
                                        ÊúÄÁµÇÊ¥ªÂãïÈ†Ü
                                    </button>
                                    <button onclick="sortFranchises('cospa')" class="px-3 py-1.5 text-xs md:text-sm bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg shadow hover:shadow-md transition-all whitespace-nowrap">
                                        „Ç≥„Çπ„ÉëÈ†Ü
                                    </button>
                                    <button onclick="sortFranchises('cases')" class="px-3 py-1.5 text-xs md:text-sm bg-gradient-to-r from-pink-500 to-pink-600 text-white rounded-lg shadow hover:shadow-md transition-all whitespace-nowrap">
                                        Ê°à‰ª∂Êï∞È†Ü
                                    </button>
                                    <button onclick="sortFranchises('newest')" class="px-3 py-1.5 text-xs md:text-sm bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg shadow hover:shadow-md transition-all whitespace-nowrap">
                                        Êñ∞ÁùÄÈ†Ü
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Âä†ÁõüÂ∫ó„É™„Çπ„Éà -->
                        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
                            <!-- PCÁâà„ÉÜ„Éº„Éñ„É´Ë°®Á§∫ -->
                            <div class="overflow-x-auto hidden md:block">
                                <table class="w-full min-w-[900px]" id="franchise-table">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Âä†ÁõüÂ∫óÂêç</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">„Ç®„É™„Ç¢</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊàêÁ¥ÑÁéá</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‰ªäÊúàÂÆüÁ∏æ</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">„Éè„É≥„Éá</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">„Ç¢„ÇØ„Ç∑„Éß„É≥</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200" id="franchiseTableBody">
                                        <tr><td colspan="7" class="text-center py-4 text-gray-500">„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...</td></tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- „Çπ„Éû„ÉõÁâà„Ç´„Éº„ÉâË°®Á§∫ -->
                            <div class="md:hidden" id="franchise-mobile-container">
                                <div class="p-4 text-center text-gray-500">„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>
                            </div>
                        </div>
                    </div>
                `;

                // „ÉÜ„Éº„Éñ„É´Ë°å„ÇíÁîüÊàê„Åô„ÇãÈñ¢Êï∞
                function generateFranchiseRows(franchises) {
                    return franchises.map(franchise => `
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4">
                                <div>
                                    <div class="text-sm font-medium text-gray-900">${franchise.name}</div>
                                    <div class="text-xs text-gray-500">ID: ${franchise.id}</div>
                                </div>
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-900" title="${franchise.areaDetail}">${franchise.area}</td>
                            <td class="px-6 py-4">
                                <div class="text-sm font-semibold ${franchise.conversionColorClass}">${franchise.conversionRate}%</div>
                                <div class="text-xs text-gray-500">ÂâçÊúàÊØî ${franchise.conversionChange}</div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm text-gray-900">${franchise.monthlyPerformance.cases}‰ª∂ / ${franchise.monthlyPerformance.amount}</div>
                            </td>
                            <td class="px-6 py-4">
                                <select class="px-2 py-1 text-xs font-semibold rounded border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="updateHandicap('${franchise.id}', this.value)">
                                    ${[3, 2, 1, 0, -1, -2, -3].map(val =>
                                        `<option value="${val > 0 ? '+' : ''}${val}" ${franchise.handicap === val ? 'selected' : ''}>${val > 0 ? '+' : ''}${val}</option>`
                                    ).join('')}
                                </select>
                            </td>
                            <td class="px-6 py-4">
                                <select class="status-select px-3 py-1 text-xs font-semibold rounded-full border-2 cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500 ${getStatusColorClass(franchise.status)}" onchange="updateFranchiseStatus('${franchise.id}', this.value)" data-franchise-id="${franchise.id}">
                                    <option value="active" ${franchise.status === 'active' ? 'selected' : ''}>„Ç¢„ÇØ„ÉÜ„Ç£„Éñ</option>
                                    <option value="inactive" ${franchise.status === 'inactive' ? 'selected' : ''}>Èùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ</option>
                                    <option value="paused" ${franchise.status === 'paused' ? 'selected' : ''}>‰∏ÄÊôÇÂÅúÊ≠¢‰∏≠</option>
                                    <option value="silent" ${franchise.status === 'silent' ? 'selected' : ''}>„Çµ„Ç§„É¨„É≥„Éà</option>
                                    <option value="suspended" ${franchise.status === 'suspended' ? 'selected' : ''}>‰ºëÊ≠¢</option>
                                    <option value="withdrawn" ${franchise.status === 'withdrawn' ? 'selected' : ''}>ÈÄÄ‰ºö</option>
                                </select>
                            </td>
                            <td class="px-6 py-4">
                                <button class="text-gray-600 hover:text-gray-800 text-lg mr-2" onclick="callFranchise('${franchise.id}')" title="ÈõªË©±">üìû</button>
                                <button class="text-gray-600 hover:text-gray-800 text-lg mr-2" onclick="emailFranchise('${franchise.id}')" title="„É°„Éº„É´">üì§</button>
                                <button class="text-gray-600 hover:text-gray-800 text-lg mr-3" onclick="snsFranchise('${franchise.id}')" title="ÈÄöÁü•">üîî</button>
                                <button class="text-blue-600 hover:text-blue-800 text-sm font-medium" onclick="showFranchiseDetail('${franchise.id}')">Ë©≥Á¥∞</button>
                            </td>
                        </tr>
                    `).join('');
                }

                // „Çπ„Éû„ÉõÁâà„Ç´„Éº„ÉâË°®Á§∫„ÇíÁîüÊàê„Åô„ÇãÈñ¢Êï∞
                function generateFranchiseMobileCards(franchises) {
                    return franchises.map(franchise => `
                        <div class="p-4 border-b border-gray-200">
                            <div class="mb-3">
                                <div class="font-semibold text-gray-900">${franchise.name}</div>
                                <div class="text-xs text-gray-500">ID: ${franchise.id}</div>
                            </div>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">„Ç®„É™„Ç¢:</span>
                                    <span class="font-medium">${franchise.area}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">ÊàêÁ¥ÑÁéá:</span>
                                    <span class="font-semibold ${franchise.conversionColorClass}">${franchise.conversionRate}%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">‰ªäÊúàÂÆüÁ∏æ:</span>
                                    <span>${franchise.monthlyPerformance.cases}‰ª∂</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">„Çπ„ÉÜ„Éº„Çø„Çπ:</span>
                                    <select class="status-select px-2 py-1 text-xs font-semibold rounded-full border-2 ${getStatusColorClass(franchise.status)}"
                                            onchange="updateFranchiseStatus('${franchise.id}', this.value)"
                                            data-franchise-id="${franchise.id}">
                                        <option value="active" ${franchise.status === 'active' ? 'selected' : ''}>„Ç¢„ÇØ„ÉÜ„Ç£„Éñ</option>
                                        <option value="inactive" ${franchise.status === 'inactive' ? 'selected' : ''}>Èùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ</option>
                                        <option value="paused" ${franchise.status === 'paused' ? 'selected' : ''}>‰∏ÄÊôÇÂÅúÊ≠¢</option>
                                        <option value="silent" ${franchise.status === 'silent' ? 'selected' : ''}>„Çµ„Ç§„É¨„É≥„Éà</option>
                                        <option value="suspended" ${franchise.status === 'suspended' ? 'selected' : ''}>‰ºëÊ≠¢</option>
                                        <option value="withdrawn" ${franchise.status === 'withdrawn' ? 'selected' : ''}>ÈÄÄ‰ºö</option>
                                    </select>
                                </div>
                                <div class="flex justify-between items-center pt-2 border-t">
                                    <div class="flex gap-2">
                                        <button onclick="callFranchise('${franchise.id}')" class="text-gray-600 text-lg">üìû</button>
                                        <button onclick="emailFranchise('${franchise.id}')" class="text-gray-600 text-lg">üì§</button>
                                        <button onclick="snsFranchise('${franchise.id}')" class="text-gray-600 text-lg">üîî</button>
                                    </div>
                                    <button onclick="showFranchiseDetail('${franchise.id}')" class="text-blue-600 text-sm font-medium">Ë©≥Á¥∞</button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }

                // „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„ÅüËâ≤„ÇØ„É©„Çπ„ÇíËøî„ÅôÈñ¢Êï∞
                function getStatusColorClass(status) {
                    const statusColors = {
                        'active': 'bg-green-100 text-green-800 border-green-300',
                        'inactive': 'bg-purple-100 text-purple-800 border-purple-300',
                        'paused': 'bg-yellow-100 text-yellow-800 border-yellow-300',
                        'silent': 'bg-gray-100 text-gray-800 border-gray-300',
                        'suspended': 'bg-red-100 text-red-800 border-red-300',
                        'withdrawn': 'bg-black text-white border-gray-800'
                    };
                    return statusColors[status] || statusColors['active'];
                }

            } else if (sectionName === 'financial') {
                // Ë´ãÊ±Ç„ÉªË≤°Âãô„Çª„ÇØ„Ç∑„Éß„É≥
                const mainContent = document.querySelector('main');
                window.location.href = '#financial';
                mainContent.innerHTML = `
                    <div class="pt-20 px-6 max-w-7xl mx-auto">
                        <div class="mb-8">
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">Ë´ãÊ±Ç„ÉªË≤°ÂãôÁÆ°ÁêÜ</h1>
                            <p class="text-gray-600">Á¥π‰ªãÊñôË®àÁÆó„ÉªË´ãÊ±ÇÊõ∏ÁÆ°ÁêÜ„ÉªË≤°Âãô„É¨„Éù„Éº„Éà</p>
                        </div>
                        
                        <!-- Ê¶ÇË¶Å„Ç´„Éº„Éâ -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white rounded-xl p-6 border border-gray-200">
                                <div class="text-sm text-gray-500 mb-2">‰ªäÊúàË´ãÊ±ÇÈ°ç</div>
                                <div class="text-2xl font-bold text-gray-800">¬•1,280,000</div>
                                <div class="text-xs text-green-600 mt-1">ÂâçÊúàÊØî +15%</div>
                            </div>
                            <div class="bg-white rounded-xl p-6 border border-gray-200">
                                <div class="text-sm text-gray-500 mb-2">Êú™Âá¶ÁêÜË´ãÊ±Ç</div>
                                <div class="text-2xl font-bold text-yellow-600">3‰ª∂</div>
                                <div class="text-xs text-gray-500 mt-1">ÂêàË®à ¬•320,000</div>
                            </div>
                            <div class="bg-white rounded-xl p-6 border border-gray-200">
                                <div class="text-sm text-gray-500 mb-2">ÂÖ•ÈáëÂæÖ„Å°</div>
                                <div class="text-2xl font-bold text-blue-600">5‰ª∂</div>
                                <div class="text-xs text-gray-500 mt-1">ÂêàË®à ¬•850,000</div>
                            </div>
                            <div class="bg-white rounded-xl p-6 border border-gray-200">
                                <div class="text-sm text-gray-500 mb-2">‰ªäÊúàÂÖ•ÈáëÊ∏à</div>
                                <div class="text-2xl font-bold text-green-600">¬•2,150,000</div>
                                <div class="text-xs text-gray-500 mt-1">12‰ª∂ÂÆå‰∫Ü</div>
                            </div>
                        </div>
                        
                        <!-- „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
                        <div class="bg-white rounded-t-xl border border-gray-200 border-b-0">
                            <div class="flex border-b" id="financialTabs">
                                <button onclick="switchFinancialTab('referral')" class="px-6 py-3 text-sm font-medium text-blue-600 border-b-2 border-blue-600 tab-btn" data-tab="referral">Á¥π‰ªãÊñôË´ãÊ±Ç</button>
                                <button onclick="switchFinancialTab('success')" class="px-6 py-3 text-sm font-medium text-gray-600 hover:text-gray-800 tab-btn" data-tab="success">ÊàêÁ¥ÑÊâãÊï∞Êñô</button>
                                <button onclick="switchFinancialTab('invoices')" class="px-6 py-3 text-sm font-medium text-gray-600 hover:text-gray-800 tab-btn" data-tab="invoices">Ë´ãÊ±ÇÊõ∏‰∏ÄË¶ß</button>
                                <button onclick="switchFinancialTab('payment')" class="px-6 py-3 text-sm font-medium text-gray-600 hover:text-gray-800 tab-btn" data-tab="payment">ÊîØÊâï‰∫àÂÆö</button>
                            </div>
                        </div>
                        
                        <!-- Á¥π‰ªãÊñô„Çø„Éñ -->
                        <div id="referralTab" class="financial-tab-content">
                            <div class="bg-white rounded-b-xl border border-gray-200 border-t-0">
                                <div class="p-6">
                                    <div class="grid grid-cols-4 gap-4 mb-6">
                                        <div class="bg-blue-50 p-4 rounded-lg">
                                            <div class="text-sm text-gray-600">‰ªäÊúàË´ãÊ±Ç‰∫àÂÆö</div>
                                            <div class="text-2xl font-bold text-blue-600">¬•385,000</div>
                                            <div class="text-xs text-gray-500">Á®éËæºÔºà35‰ª∂Ôºâ</div>
                                        </div>
                                        <div class="bg-green-50 p-4 rounded-lg">
                                            <div class="text-sm text-gray-600">ÂÖ•ÈáëÊ∏à„Åø</div>
                                            <div class="text-2xl font-bold text-green-600">¬•2,750,000</div>
                                            <div class="text-xs text-gray-500">‰ªäÊúàÂàÜ</div>
                                        </div>
                                        <div class="bg-yellow-50 p-4 rounded-lg">
                                            <div class="text-sm text-gray-600">Êú™ÂÖ•Èáë</div>
                                            <div class="text-2xl font-bold text-yellow-600">¬•110,000</div>
                                            <div class="text-xs text-gray-500">ÈÅÖÂª∂1‰ª∂</div>
                                        </div>
                                        <div class="bg-purple-50 p-4 rounded-lg">
                                            <div class="text-sm text-gray-600">‰ªäÊúàÁ¥π‰ªãÊï∞</div>
                                            <div class="text-2xl font-bold text-purple-600">42‰ª∂</div>
                                            <div class="text-xs text-gray-500">ÂâçÊúàÊØî +8</div>
                                        </div>
                                    </div>
                                    <div class="mb-4 flex justify-between items-center">
                                        <div class="flex gap-2">
                                            <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                                <i class="fas fa-file-invoice mr-2"></i>Ë´ãÊ±ÇÊõ∏‰∏ÄÊã¨Áô∫Ë°å
                                            </button>
                                            <button class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                                <i class="fas fa-download mr-2"></i>CSV„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                                            </button>
                                        </div>
                                        <div class="flex gap-2">
                                            <select class="px-3 py-2 border rounded-lg">
                                                <option>ÂÖ®ÊúüÈñì</option>
                                                <option>‰ªäÊúà</option>
                                                <option>ÂÖàÊúà</option>
                                                <option>ÈÅéÂéª3„É∂Êúà</option>
                                            </select>
                                            <select class="px-3 py-2 border rounded-lg">
                                                <option>ÂÖ®„Çπ„ÉÜ„Éº„Çø„Çπ</option>
                                                <option>Êú™Ë´ãÊ±Ç</option>
                                                <option>Ë´ãÊ±ÇÊ∏à„Åø</option>
                                                <option>ÂÖ•ÈáëÊ∏à„Åø</option>
                                                <option>ÈÅÖÂª∂</option>
                                            </select>
                                        </div>
                                    </div>
                                    <table class="w-full">
                                        <thead>
                                            <tr class="border-b bg-gray-50">
                                                <th class="text-left py-3 px-4">
                                                    <input type="checkbox" class="rounded">
                                                </th>
                                                <th class="text-left py-3 px-4">Âä†ÁõüÂ∫óÂêç</th>
                                                <th class="text-left py-3 px-4">Ê°à‰ª∂ID</th>
                                                <th class="text-left py-3 px-4">È°ßÂÆ¢Âêç</th>
                                                <th class="text-left py-3 px-4">Âª∫Áâ©Á®ÆÂà•</th>
                                                <th class="text-right py-3 px-4">Á¥π‰ªãÊñô<br><span class="text-xs text-gray-500">(Á®éÊäú)</span></th>
                                                <th class="text-right py-3 px-4">Ê∂àË≤ªÁ®é<br><span class="text-xs text-gray-500">(10%)</span></th>
                                                <th class="text-right py-3 px-4">Ë´ãÊ±ÇÈ°ç<br><span class="text-xs text-gray-500">(Á®éËæº)</span></th>
                                                <th class="text-left py-3 px-4">ÊîØÊâïÊó•</th>
                                                <th class="text-center py-3 px-4">„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                                                <th class="text-center py-3 px-4">Êìç‰Ωú</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="border-b hover:bg-gray-50">
                                                <td class="py-3 px-4">
                                                    <input type="checkbox" class="rounded">
                                                </td>
                                                <td class="py-3 px-4 font-medium">Áî∞‰∏≠„Éõ„Éº„É†„ÉÜ„ÉÉ„ÇØ</td>
                                                <td class="py-3 px-4">C-2025-0142</td>
                                                <td class="py-3 px-4">Â±±Áî∞Â§™ÈÉé</td>
                                                <td class="py-3 px-4"><span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">Êà∏Âª∫„Å¶</span></td>
                                                <td class="text-right py-3 px-4 font-semibold">¬•20,000</td>
                                                <td class="text-right py-3 px-4 text-gray-600">¬•2,000</td>
                                                <td class="text-right py-3 px-4 font-bold text-blue-600">¬•22,000</td>
                                                <td class="py-3 px-4">2025/02/15</td>
                                                <td class="text-center py-3 px-4">
                                                    <span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs">Êú™Ë´ãÊ±Ç</span>
                                                </td>
                                                <td class="text-center py-3 px-4">
                                                    <button class="text-blue-600 hover:text-blue-800 text-sm">Ë´ãÊ±ÇÊõ∏‰ΩúÊàê</button>
                                                </td>
                                    </tr>
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="py-3 px-4">
                                            <input type="checkbox" class="rounded">
                                        </td>
                                        <td class="py-3 px-4 font-medium">Â±±Áî∞„Éö„Ç§„É≥„Éà</td>
                                        <td class="py-3 px-4">C-2025-0847</td>
                                        <td class="py-3 px-4">Èà¥Êú®Ëä±Â≠ê</td>
                                        <td class="py-3 px-4"><span class="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs">„Éû„É≥„Ç∑„Éß„É≥</span></td>
                                        <td class="text-right py-3 px-4 font-semibold">¬•30,000</td>
                                        <td class="text-right py-3 px-4 text-gray-600">¬•3,000</td>
                                        <td class="text-right py-3 px-4 font-bold text-blue-600">¬•33,000</td>
                                        <td class="py-3 px-4">2025/02/15</td>
                                        <td class="text-center py-3 px-4">
                                            <span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs">Êú™Ë´ãÊ±Ç</span>
                                        </td>
                                        <td class="text-center py-3 px-4">
                                            <button class="text-blue-600 hover:text-blue-800 text-sm">Ë´ãÊ±ÇÊõ∏‰ΩúÊàê</button>
                                        </td>
                                    </tr>
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="py-3 px-4">
                                            <input type="checkbox" class="rounded">
                                        </td>
                                        <td class="py-3 px-4 font-medium">‰ΩêËó§Â°óË£ÖÂ∫ó</td>
                                        <td class="py-3 px-4">C-2025-0849</td>
                                        <td class="py-3 px-4">È´òÊ©ãÊ¨°ÈÉé</td>
                                        <td class="py-3 px-4"><span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">Êà∏Âª∫„Å¶</span></td>
                                        <td class="text-right py-3 px-4 font-semibold">¬•10,000</td>
                                        <td class="text-right py-3 px-4 text-gray-600">¬•1,000</td>
                                        <td class="text-right py-3 px-4 font-bold text-blue-600">¬•11,000</td>
                                        <td class="py-3 px-4">2025/02/27</td>
                                        <td class="text-center py-3 px-4">
                                            <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">Ë´ãÊ±ÇÊ∏à„Åø</span>
                                        </td>
                                        <td class="text-center py-3 px-4">
                                            <button class="text-gray-400 text-sm" disabled>Áô∫Ë°åÊ∏à„Åø</button>
                                        </td>
                                    </tr>
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="py-3 px-4">
                                            <input type="checkbox" class="rounded">
                                        </td>
                                        <td class="py-3 px-4 font-medium">Èà¥Êú®Âª∫Ë£Ö</td>
                                        <td class="py-3 px-4">C-2025-0850</td>
                                        <td class="py-3 px-4">‰ºäËó§ÁæéÂí≤</td>
                                        <td class="py-3 px-4"><span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">Êà∏Âª∫„Å¶</span></td>
                                        <td class="text-right py-3 px-4 font-semibold">¬•5,000</td>
                                        <td class="text-right py-3 px-4 text-gray-600">¬•500</td>
                                        <td class="text-right py-3 px-4 font-bold text-blue-600">¬•5,500</td>
                                        <td class="py-3 px-4">2025/02/15</td>
                                        <td class="text-center py-3 px-4">
                                            <span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs">Êú™Ë´ãÊ±Ç</span>
                                        </td>
                                        <td class="text-center py-3 px-4">
                                            <button class="text-blue-600 hover:text-blue-800 text-sm">Ë´ãÊ±ÇÊõ∏‰ΩúÊàê</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="p-4 bg-gray-50">
                                <div class="flex justify-between items-center">
                                    <div class="text-sm text-gray-600">
                                        Á¥π‰ªãÊñôÂêàË®à: <span class="font-bold text-blue-600 mr-4">¬•65,000</span>
                                        ÊàêÁ¥ÑÊâãÊï∞ÊñôÂêàË®à: <span class="font-bold text-green-600 mr-4">¬•250,000</span>
                                        Ë´ãÊ±ÇÁ∑èÈ°ç: <span class="font-bold text-purple-600 text-lg">¬•315,000</span>
                                    </div>
                                    <button class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm">‰∏ÄÊã¨Ë´ãÊ±ÇÊõ∏‰ΩúÊàê</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (sectionName === 'registrationRequests') {
                // Âä†ÁõüÂ∫óÁôªÈå≤Áî≥Ë´ã„Çª„ÇØ„Ç∑„Éß„É≥
                const mainContent = document.querySelector('main');
                window.location.href = '#registrationRequests';
                mainContent.innerHTML = `
                    <div class="pt-20 px-6 max-w-7xl mx-auto">
                        <div class="mb-8">
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">Âä†ÁõüÂ∫óÁôªÈå≤Áî≥Ë´ãÁÆ°ÁêÜ</h1>
                            <p class="text-gray-600">Êñ∞Ë¶èÂä†ÁõüÂ∫ó„ÅÆÁôªÈå≤Áî≥Ë´ã„ÇíÂØ©Êüª„ÉªÊâøË™ç</p>
                        </div>

                        <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫ -->
                        <div id="loading-indicator" class="text-center py-8" style="display:none;">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"></div>
                            <p class="mt-2 text-gray-600">„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>
                        </div>

                        <!-- Áµ±Ë®à„Ç´„Éº„Éâ -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-white rounded-xl p-6 border border-gray-200">
                                <div class="text-sm text-gray-500 mb-2">Êú™ÂØ©ÊüªÁî≥Ë´ã</div>
                                <div id="pending-count" class="text-2xl font-bold text-green-600">-</div>
                                <div class="text-xs text-red-600 mt-1">Ëá≥ÊÄ•ÂØæÂøú</div>
                            </div>
                            <div class="bg-white rounded-xl p-6 border border-gray-200">
                                <div class="text-sm text-gray-500 mb-2">‰ªäÊúàÊâøË™ç</div>
                                <div id="monthly-approved" class="text-2xl font-bold text-gray-800">-</div>
                                <div class="text-xs text-gray-500 mt-1">ÂâçÊúàÊØî +5</div>
                            </div>
                            <div class="bg-white rounded-xl p-6 border border-gray-200">
                                <div class="text-sm text-gray-500 mb-2">ÊâøË™çÁéá</div>
                                <div id="approval-rate" class="text-2xl font-bold text-gray-800">-</div>
                                <div class="text-xs text-green-600 mt-1">È´òÊ∞¥Ê∫ñ</div>
                            </div>
                        </div>
                        
                        <!-- Êú™ÂØ©ÊüªÁî≥Ë´ã„É™„Çπ„Éà -->
                        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden mb-6">
                            <div class="p-4 bg-green-50 border-b">
                                <h3 class="text-lg font-semibold text-green-800">üÜï Êú™ÂØ©Êüª„ÅÆÁôªÈå≤Áî≥Ë´ã</h3>
                            </div>
                            <div class="overflow-x-auto hidden md:block">
                            <table id="pending-table" class="w-full min-w-[768px]">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Áî≥Ë´ãÊó•ÊôÇ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‰ºöÁ§æÂêç</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‰ª£Ë°®ËÄÖÂêç</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÈÄ£Áµ°ÂÖà</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÂØæÂøú„Ç®„É™„Ç¢</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">„Ç¢„ÇØ„Ç∑„Éß„É≥</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <!-- ÂãïÁöÑ„Å´„Éá„Éº„Çø„ÅåÊåøÂÖ•„Åï„Çå„Çã -->
                                </tbody>
                            </table>
                            </div>

                            <!-- „É¢„Éê„Ç§„É´Áî®„Ç´„Éº„ÉâË°®Á§∫ -->
                            <div id="pending-mobile" class="md:hidden p-4 space-y-4">
                                <!-- ÂãïÁöÑ„Å´„Éá„Éº„Çø„ÅåÊåøÂÖ•„Åï„Çå„Çã -->
                            </div>
                        </div>

                        <!-- ÂØ©ÊüªÊ∏à„ÅøÂ±•Ê≠¥ -->
                        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
                            <div class="p-4 bg-gray-50 border-b flex justify-between items-center">
                                <h3 class="text-lg font-semibold text-gray-800">ÂØ©ÊüªÊ∏à„ÅøÂ±•Ê≠¥</h3>
                                <select id="dateRangeSelector" class="px-3 py-1 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500">
                                    <option value="7">ÈÅéÂéª1ÈÄ±Èñì</option>
                                    <option value="30" selected>ÈÅéÂéª1„É∂Êúà</option>
                                    <option value="90">ÈÅéÂéª3„É∂Êúà</option>
                                    <option value="365">ÈÅéÂéª1Âπ¥</option>
                                    <option value="-1">ÂÖ®ÊúüÈñì</option>
                                </select>
                            </div>
                            <div class="overflow-x-auto hidden md:block">
                            <table id="approved-table" class="w-full min-w-[768px]">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Áî≥Ë´ãÊó•ÊôÇ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‰ºöÁ§æÂêç</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‰ª£Ë°®ËÄÖÂêç</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÈÄ£Áµ°ÂÖà</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÂØæÂøú„Ç®„É™„Ç¢</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">„Ç¢„ÇØ„Ç∑„Éß„É≥</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <!-- ÂãïÁöÑ„Å´„Éá„Éº„Çø„ÅåÊåøÂÖ•„Åï„Çå„Çã -->
                                </tbody>
                            </table>
                            </div>

                            <!-- „É¢„Éê„Ç§„É´Áî®„Ç´„Éº„ÉâË°®Á§∫ÔºàÂØ©ÊüªÊ∏à„ÅøÔºâ -->
                            <div id="approved-mobile" class="md:hidden p-4 space-y-4">
                                <!-- ÂãïÁöÑ„Å´„Éá„Éº„Çø„ÅåÊåøÂÖ•„Åï„Çå„Çã -->
                            </div>
                        </div>
                    </div>
                `;

                // registrationRequests„Çª„ÇØ„Ç∑„Éß„É≥Ë°®Á§∫Âæå„Å´„Éá„Éº„Çø„ÇíÂèñÂæó
                setTimeout(() => {
                    // registration-requests.js„ÅÆÈñ¢Êï∞„ÇíÂëº„Å≥Âá∫„Åó
                    if (typeof loadRegistrationRequestsData === 'function') {
                        loadRegistrationRequestsData();
                    } else if (typeof refreshDashboard === 'function') {
                        refreshDashboard();
                    } else if (window.dashboardAPI && typeof window.dashboardAPI.refreshDashboard === 'function') {
                        window.dashboardAPI.refreshDashboard();
                    }
                }, 100);

            } else if (sectionName === 'cancelRequests') {
                // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„Çª„ÇØ„Ç∑„Éß„É≥
                const mainContent = document.querySelector('main');
                window.location.href = '#cancelRequests';
                mainContent.innerHTML = `
                    <div class="pt-20 px-6 max-w-7xl mx-auto">
                        <div class="mb-8">
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ãÁÆ°ÁêÜ</h1>
                            <p class="text-gray-600">Âä†ÁõüÂ∫ó„Åã„Çâ„ÅÆ„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÇíÂá¶ÁêÜ</p>
                        </div>
                        
                        <!-- Áµ±Ë®à„Ç´„Éº„Éâ -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white rounded-xl p-6 border border-gray-200">
                                <div class="text-sm text-gray-500 mb-2">Êú™Âá¶ÁêÜÁî≥Ë´ã</div>
                                <div class="text-2xl font-bold text-purple-600">2‰ª∂</div>
                                <div class="text-xs text-red-600 mt-1">Ë¶ÅÂØæÂøú</div>
                            </div>
                            <div class="bg-white rounded-xl p-6 border border-gray-200">
                                <div class="text-sm text-gray-500 mb-2">‰ªäÊúàÊâøË™ç</div>
                                <div class="text-2xl font-bold text-gray-800">8‰ª∂</div>
                                <div class="text-xs text-gray-500 mt-1">ÂâçÊúàÊØî +2</div>
                            </div>
                            <div class="bg-white rounded-xl p-6 border border-gray-200">
                                <div class="text-sm text-gray-500 mb-2">‰ªäÊúàÂç¥‰∏ã</div>
                                <div class="text-2xl font-bold text-gray-800">3‰ª∂</div>
                                <div class="text-xs text-gray-500 mt-1">Âç¥‰∏ãÁéá 27%</div>
                            </div>
                            <div class="bg-white rounded-xl p-6 border border-gray-200">
                                <div class="text-sm text-gray-500 mb-2">Âπ≥ÂùáÂá¶ÁêÜÊôÇÈñì</div>
                                <div class="text-2xl font-bold text-gray-800">2.5h</div>
                                <div class="text-xs text-green-600 mt-1">ÁõÆÊ®ôÂÜÖ</div>
                            </div>
                        </div>
                        
                        <!-- Êú™Âá¶ÁêÜÁî≥Ë´ã„É™„Çπ„Éà -->
                        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden mb-6">
                            <div class="p-4 bg-purple-50 border-b">
                                <h3 class="text-lg font-semibold text-purple-800">üö® Êú™Âá¶ÁêÜ„ÅÆ„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã</h3>
                            </div>
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Áî≥Ë´ãÊó•ÊôÇ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ê°à‰ª∂ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Âä†ÁõüÂ∫ó</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">È°ßÂÆ¢„Ç®„É™„Ç¢</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÁêÜÁî±</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÁµåÈÅéÊôÇÈñì</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">„Ç¢„ÇØ„Ç∑„Éß„É≥</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <tr class="hover:bg-purple-50 animate-pulse">
                                        <td class="px-6 py-4 text-sm text-gray-900">2025-01-12 14:30</td>
                                        <td class="px-6 py-4 text-sm font-medium text-gray-900">#2024-0885</td>
                                        <td class="px-6 py-4 text-sm text-gray-900">Áî∞‰∏≠Â°óË£ÖÂ∑•Ê•≠</td>
                                        <td class="px-6 py-4 text-sm text-gray-900">ÂçÉËëâÁúåËàπÊ©ãÂ∏Ç</td>
                                        <td class="px-6 py-4 text-sm text-gray-900">ÂØæÂøú‰∏çÂèØ„ÅÆ„Åü„ÇÅËæûÈÄÄ</td>
                                        <td class="px-6 py-4">
                                            <span class="text-sm font-semibold text-red-600">2ÊôÇÈñì30ÂàÜ</span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <button onclick="showCancelRequest('#2024-0885')" class="px-3 py-1 bg-purple-600 text-white text-xs rounded hover:bg-purple-700">Âá¶ÁêÜ</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-purple-50">
                                        <td class="px-6 py-4 text-sm text-gray-900">2025-01-12 15:45</td>
                                        <td class="px-6 py-4 text-sm font-medium text-gray-900">#2024-0887</td>
                                        <td class="px-6 py-4 text-sm text-gray-900">Â±±Áî∞„Éö„Ç§„É≥„Éà</td>
                                        <td class="px-6 py-4 text-sm text-gray-900">Êù±‰∫¨ÈÉΩÂ§ßÁî∞Âå∫</td>
                                        <td class="px-6 py-4 text-sm text-gray-900">„Ç®„É™„Ç¢Â§ñ„ÅÆ„Åü„ÇÅÂØæÂøú‰∏çÂèØ</td>
                                        <td class="px-6 py-4">
                                            <span class="text-sm font-semibold text-yellow-600">1ÊôÇÈñì15ÂàÜ</span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <button onclick="showCancelRequest('#2024-0887')" class="px-3 py-1 bg-purple-600 text-white text-xs rounded hover:bg-purple-700">Âá¶ÁêÜ</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Âá¶ÁêÜÊ∏à„ÅøÂ±•Ê≠¥ -->
                        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
                            <div class="p-4 bg-gray-50 border-b">
                                <h3 class="text-lg font-semibold text-gray-800">Âá¶ÁêÜÊ∏à„ÅøÂ±•Ê≠¥</h3>
                            </div>
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Âá¶ÁêÜÊó•ÊôÇ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ê°à‰ª∂ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Âä†ÁõüÂ∫ó</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Âá¶ÁêÜÁµêÊûú</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÂÜçÊåØÂàÜÂÖà</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Âá¶ÁêÜËÄÖ</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 text-sm text-gray-900">2025-01-12 10:30</td>
                                        <td class="px-6 py-4 text-sm font-medium text-gray-900">#2024-0880</td>
                                        <td class="px-6 py-4 text-sm text-gray-900">‰ΩêËó§Â°óË£ÖÂ∫ó</td>
                                        <td class="px-6 py-4">
                                            <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">ÊâøË™ç</span>
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-900">Èà¥Êú®Âª∫Ë£Ö</td>
                                        <td class="px-6 py-4 text-sm text-gray-900">ÁÆ°ÁêÜËÄÖA</td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 text-sm text-gray-900">2025-01-12 09:15</td>
                                        <td class="px-6 py-4 text-sm font-medium text-gray-900">#2024-0878</td>
                                        <td class="px-6 py-4 text-sm text-gray-900">È´òÊ©ãÂ°óË£Ö</td>
                                        <td class="px-6 py-4">
                                            <span class="px-2 py-1 text-xs rounded-full bg-red-100 text-red-800">Âç¥‰∏ã</span>
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-900">-</td>
                                        <td class="px-6 py-4 text-sm text-gray-900">ÁÆ°ÁêÜËÄÖB</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } else if (sectionName === 'ranking') {
                // „É©„É≥„Ç≠„É≥„Ç∞„Çª„ÇØ„Ç∑„Éß„É≥
                const mainContent = document.querySelector('main');
                window.location.href = '#ranking';
                mainContent.innerHTML = `
                    <div class="pt-20 px-6 max-w-7xl mx-auto">
                        <div class="mb-8">
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">Âä†ÁõüÂ∫ó„É©„É≥„Ç≠„É≥„Ç∞</h1>
                            <p class="text-gray-600">„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπË©ï‰æ°„Éª„Éè„É≥„Éá„Ç£„Ç≠„É£„ÉÉ„ÉóÈÅ©Áî®</p>
                        </div>
                        
                        <!-- ÊúüÈñìÈÅ∏Êäû -->
                        <div class="bg-white rounded-xl p-4 mb-6 border border-gray-200">
                            <div class="flex items-center gap-4">
                                <span class="text-sm font-medium text-gray-700">ÊúüÈñì:</span>
                                <select class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option selected>‰ªäÊúà</option>
                                    <option>ÂÖàÊúà</option>
                                    <option>ÈÅéÂéª3„É∂Êúà</option>
                                    <option>ÈÅéÂéª6„É∂Êúà</option>
                                    <option>‰ªäÂπ¥Â∫¶</option>
                                </select>
                                <span class="text-sm font-medium text-gray-700 ml-4">Ë©ï‰æ°È†ÖÁõÆ:</span>
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="mr-2">
                                    <span class="text-sm">ÊàêÁ¥ÑÁéá</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="mr-2">
                                    <span class="text-sm">ÂØæÂøúÈÄüÂ∫¶</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="mr-2">
                                    <span class="text-sm">È°ßÂÆ¢Ê∫ÄË∂≥Â∫¶</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- „É©„É≥„Ç≠„É≥„Ç∞Ë°® -->
                        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
                            <div class="p-4 bg-gradient-to-r from-yellow-50 to-yellow-100 border-b">
                                <h3 class="text-lg font-semibold text-gray-800">Á∑èÂêà„É©„É≥„Ç≠„É≥„Ç∞ TOP10</h3>
                            </div>
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">È†Ü‰Ωç</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Âä†ÁõüÂ∫óÂêç</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">ÊàêÁ¥ÑÁéá</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">ÂØæÂøúÈÄüÂ∫¶</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">Ê∫ÄË∂≥Â∫¶</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">„Éè„É≥„Éá„Ç£</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">Á∑èÂêà„Çπ„Ç≥„Ç¢</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">ÂâçÂõû</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <tr class="hover:bg-yellow-50">
                                        <td class="px-6 py-4 text-center">
                                            <div class="text-2xl font-bold text-yellow-500">ü•á</div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center">
                                                <div class="w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center text-yellow-600 font-semibold mr-3">Áî∞</div>
                                                <div>
                                                    <div class="text-sm font-medium text-gray-900">Áî∞‰∏≠Â°óË£ÖÂ∑•Ê•≠</div>
                                                    <div class="text-xs text-gray-500">Êù±‰∫¨ÈÉΩ‰∏ñÁî∞Ë∞∑Âå∫</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <div class="text-sm font-semibold text-green-600">68%</div>
                                            <div class="text-xs text-gray-500">85pt</div>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <div class="text-sm font-semibold text-blue-600">1.2h</div>
                                            <div class="text-xs text-gray-500">92pt</div>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <div class="text-sm font-semibold text-purple-600">4.8</div>
                                            <div class="text-xs text-gray-500">96pt</div>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">+1</span>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <div class="text-lg font-bold text-gray-900">92.3</div>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <span class="text-green-600">‚Üë2</span>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 text-center">
                                            <div class="text-2xl font-bold text-gray-400">ü•à</div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center">
                                                <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-gray-600 font-semibold mr-3">Â±±</div>
                                                <div>
                                                    <div class="text-sm font-medium text-gray-900">Â±±Áî∞„Éö„Ç§„É≥„Éà</div>
                                                    <div class="text-xs text-gray-500">Á•ûÂ•àÂ∑ùÁúåÊ®™ÊµúÂ∏Ç</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <div class="text-sm font-semibold text-green-600">62%</div>
                                            <div class="text-xs text-gray-500">78pt</div>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <div class="text-sm font-semibold text-blue-600">1.5h</div>
                                            <div class="text-xs text-gray-500">88pt</div>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <div class="text-sm font-semibold text-purple-600">4.7</div>
                                            <div class="text-xs text-gray-500">94pt</div>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">0</span>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <div class="text-lg font-bold text-gray-900">86.7</div>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <span class="text-gray-600">‚Üí</span>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-orange-50">
                                        <td class="px-6 py-4 text-center">
                                            <div class="text-2xl font-bold text-orange-600">ü•â</div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center">
                                                <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center text-orange-600 font-semibold mr-3">Èà¥</div>
                                                <div>
                                                    <div class="text-sm font-medium text-gray-900">Èà¥Êú®Âª∫Ë£Ö</div>
                                                    <div class="text-xs text-gray-500">ÂüºÁéâÁúå„Åï„ÅÑ„Åü„ÅæÂ∏Ç</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <div class="text-sm font-semibold text-green-600">55%</div>
                                            <div class="text-xs text-gray-500">70pt</div>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <div class="text-sm font-semibold text-blue-600">0.8h</div>
                                            <div class="text-xs text-gray-500">95pt</div>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <div class="text-sm font-semibold text-purple-600">4.9</div>
                                            <div class="text-xs text-gray-500">98pt</div>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">+2</span>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <div class="text-lg font-bold text-gray-900">85.5</div>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <span class="text-green-600">‚Üë5</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }
            
            // „É°„Éã„É•„Éº„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.querySelectorAll('#sideMenu nav a').forEach(link => {
                link.classList.remove('bg-gradient-to-r', 'from-blue-600', 'to-blue-500', 'text-gray-100');
                link.classList.add('text-gray-400', 'hover:text-gray-100');
                
                if (link.getAttribute('href') === '#' + sectionName) {
                    link.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-blue-500', 'text-gray-100');
                    link.classList.remove('text-gray-400', 'hover:text-gray-100');
                }
            });
        }
        
        // „Éè„ÉÉ„Ç∑„É•Â§âÊõ¥ÊôÇ„ÅÆÂá¶ÁêÜÔºàDOMContentLoaded„ÅØÂæå„ÅßË®≠ÂÆöÔºâ
        window.addEventListener('hashchange', () => {
            const hash = window.location.hash.slice(1);
            if (hash === 'dashboard') {
                showSection('dashboard');
            } else if (hash === 'assignment') {
                showSection('assignment');
            } else if (hash === 'franchise') {
                showSection('franchise');
            } else if (hash === 'registrationRequests') {
                showSection('registrationRequests');
            } else if (hash === 'cancelRequests') {
                showSection('cancelRequests');
            } else if (hash === 'ranking') {
                showSection('ranking');
            }
        });

        // „Ç≥„Éî„ÉºÊ©üËÉΩ
        function copyText(text) {
            navigator.clipboard.writeText(text).then(function() {
                // ÊàêÂäüÊôÇ„ÅÆÂá¶ÁêÜÔºà„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Å™„Å©„ÇíËøΩÂä†ÂèØËÉΩÔºâ
                console.log('„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü: ' + text);
            });
        }

        // Google Map„É™„É≥„ÇØÁîüÊàêÊ©üËÉΩÔºàÁü≠Á∏ÆURLÁâàÔºâ
        async function generateGoogleMapLink() {
            const zipInput = document.getElementById('zipInput');
            const addressInput = document.getElementById('addressInput');
            const addressNumberInput = document.getElementById('addressNumberInput');
            const mapLinkInput = document.getElementById('mapLinkInput');

            // ‰ΩèÊâÄ„ÇíÁµÑ„ÅøÁ´ã„Å¶ÔºàÈÉµ‰æøÁï™Âè∑„ÄÅ‰ΩèÊâÄ„ÄÅÁï™Âú∞„ÇíÁµêÂêàÔºâ
            let fullAddress = '';

            if (zipInput && zipInput.value.trim()) {
                fullAddress += zipInput.value.trim();
            }

            if (addressInput && addressInput.value.trim()) {
                fullAddress += (fullAddress ? ' ' : '') + addressInput.value.trim();
            }

            if (addressNumberInput && addressNumberInput.value.trim()) {
                fullAddress += addressNumberInput.value.trim();
            }

            if (fullAddress) {
                // Google Maps URL„ÇíÁîüÊàê
                const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(fullAddress)}`;

                try {
                    // GASÁµåÁî±„ÅßÁü≠Á∏ÆURLÂèñÂæó
                    const response = await window.apiClient.postRequest('shortenUrl', { url: googleMapsUrl });

                    if (response && response.success && response.shortUrl) {
                        if (mapLinkInput) {
                            mapLinkInput.value = response.shortUrl;
                        }
                        // URLËá™ÂãïÁîüÊàêÂæå„Å´Êú™ÂÖ•Âäõ„Éï„Ç£„Éº„É´„ÉâÊ§úË®º„ÇíÊõ¥Êñ∞
                        if (typeof validateEmptyFields === 'function') {
                            validateEmptyFields();
                        }
                        return response.shortUrl;
                    } else {
                        // Áü≠Á∏ÆÂ§±ÊïóÊôÇ„ÅØÂÖÉ„ÅÆURL„Çí‰ΩøÁî®
                        if (mapLinkInput) {
                            mapLinkInput.value = googleMapsUrl;
                        }
                        // URLËá™ÂãïÁîüÊàêÂæå„Å´Êú™ÂÖ•Âäõ„Éï„Ç£„Éº„É´„ÉâÊ§úË®º„ÇíÊõ¥Êñ∞
                        if (typeof validateEmptyFields === 'function') {
                            validateEmptyFields();
                        }
                        return googleMapsUrl;
                    }
                } catch (error) {
                    console.error('Áü≠Á∏ÆURLÁîüÊàê„Ç®„É©„Éº:', error);
                    // „Ç®„É©„ÉºÊôÇ„ÅØÂÖÉ„ÅÆURL„Çí‰ΩøÁî®
                    if (mapLinkInput) {
                        mapLinkInput.value = googleMapsUrl;
                    }
                    // URLËá™ÂãïÁîüÊàêÂæå„Å´Êú™ÂÖ•Âäõ„Éï„Ç£„Éº„É´„ÉâÊ§úË®º„ÇíÊõ¥Êñ∞
                    if (typeof validateEmptyFields === 'function') {
                        validateEmptyFields();
                    }
                    return googleMapsUrl;
                }
            }
            return '';
        }

        // Map„É™„É≥„ÇØ„ÇíÈñã„Åè
        async function openMapLink() {
            const mapLinkInput = document.getElementById('mapLinkInput');
            if (mapLinkInput && mapLinkInput.value.trim()) {
                window.open(mapLinkInput.value.trim(), '_blank');
            } else {
                // „É™„É≥„ÇØ„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÁîüÊàê„Åó„Å¶„Åã„ÇâÈñã„Åè
                const url = await generateGoogleMapLink();
                if (url) {
                    window.open(url, '_blank');
                } else {
                    alert('‰ΩèÊâÄ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                }
            }
        }

        // ‰ΩèÊâÄÂÖ•ÂäõÊôÇ„Å´Ëá™ÂãïÁöÑ„Å´„Éû„ÉÉ„Éó„É™„É≥„ÇØ„ÇíÁîüÊàê
        function autoGenerateMapLink() {
            const addressInput = document.getElementById('addressInput');
            const addressNumberInput = document.getElementById('addressNumberInput');

            if (addressInput) {
                addressInput.addEventListener('blur', function() {
                    if (this.value.trim()) {
                        generateGoogleMapLink();
                    }
                });
                addressInput.addEventListener('input', function() {
                    if (this.value.trim()) {
                        setTimeout(() => {
                            generateGoogleMapLink();
                        }, 500); // 0.5ÁßíÂæå„Å´Ëá™ÂãïÁîüÊàê
                    }
                });
            }

            if (addressNumberInput) {
                addressNumberInput.addEventListener('blur', function() {
                    if (this.value.trim()) {
                        generateGoogleMapLink();
                    }
                });
                addressNumberInput.addEventListener('input', function() {
                    if (this.value.trim()) {
                        setTimeout(() => {
                            generateGoogleMapLink();
                        }, 500); // 0.5ÁßíÂæå„Å´Ëá™ÂãïÁîüÊàê
                    }
                });
            }
        }

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´ÂÆüË°å
        document.addEventListener('DOMContentLoaded', function() {
            autoGenerateMapLink();
        });

        // „Ç™„Éó„Ç∑„Éß„É≥„Éú„Çø„É≥„ÅÆÈÅ∏ÊäûÊ©üËÉΩÔºà„Ç§„Éô„É≥„ÉàÂßî‰ªª„Çí‰ΩøÁî®Ôºâ
        document.addEventListener('click', function(e) {
            if (e.target && e.target.classList.contains('option-button')) {
                const button = e.target;
                const parentGroup = button.closest('[data-single-select]');

                if (parentGroup) {
                    // „Ç∑„É≥„Ç∞„É´„Çª„É¨„ÇØ„Éà„É¢„Éº„Éâ„ÅÆÂ†¥Âêà
                    const isSingleSelect = parentGroup.dataset.singleSelect === 'true';

                    if (isSingleSelect) {
                        // Âêå„Åò„Ç∞„É´„Éº„ÉóÂÜÖ„ÅÆ‰ªñ„ÅÆ„Éú„Çø„É≥„ÅÆÈÅ∏Êäû„ÇíËß£Èô§
                        parentGroup.querySelectorAll('.option-button').forEach(btn => {
                            if (btn !== button) {
                                btn.classList.remove('selected');
                                btn.classList.remove('bg-purple-500', 'border-purple-500', 'text-white', 'shadow-md');
                                btn.classList.add('bg-white', 'border-gray-300', 'text-gray-700');
                            }
                        });

                        // „ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åü„Éú„Çø„É≥„ÇíÈÅ∏ÊäûÁä∂ÊÖã„Å´„Åô„Çã
                        button.classList.add('selected');
                        button.classList.remove('bg-white', 'border-gray-300', 'text-gray-700');
                        button.classList.add('bg-purple-500', 'border-purple-500', 'text-white', 'shadow-md');

                        // hidden input„ÅÆÂÄ§„ÇíÊõ¥Êñ∞
                        if (button.dataset.gender) {
                            const genderSelect = document.getElementById('genderSelect');
                            if (genderSelect) {
                                genderSelect.value = button.dataset.gender;
                            }
                        }

                        if (button.dataset.age) {
                            const ageSelect = document.getElementById('ageSelect');
                            if (ageSelect) {
                                ageSelect.value = button.dataset.age;
                            }
                        }

                        // Êú™ÂÖ•Âäõ„Éï„Ç£„Éº„É´„ÉâÊ§úË®º„ÇíÊõ¥Êñ∞
                        if (typeof validateEmptyFields === 'function') {
                            validateEmptyFields();
                        }
                    } else {
                        // „Éû„É´„ÉÅ„Çª„É¨„ÇØ„Éà„É¢„Éº„Éâ„ÅÆÂ†¥ÂêàÔºàÂæìÊù•„ÅÆÂãï‰ΩúÔºâ
                        button.classList.toggle('selected');
                    }
                } else {
                    // data-single-selectÂ±ûÊÄß„Åå„Å™„ÅÑÂ†¥ÂêàÔºàÂæìÊù•„ÅÆÂãï‰ΩúÔºâ
                    button.classList.toggle('selected');
                }
            }
        });

        // ÊôÇÈñì„Çπ„É≠„ÉÉ„Éà„ÅÆÈÅ∏ÊäûÊ©üËÉΩÔºàÂæå„ÅßÂàùÊúüÂåñÔºâ
        function initializeTimeSlots() {
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.addEventListener('click', function() {
                    this.classList.toggle('selected');
                });
            });
        }

        // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÅÆÂ§âÊõ¥„ÇíÁõ£Ë¶ñÔºàÂæå„ÅßÂàùÊúüÂåñÔºâ
        function initializeCheckboxes() {
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const franchiseItem = this.closest('.franchise-item');
                    if (franchiseItem) {
                        if (this.checked) {
                            franchiseItem.classList.add('selected');
                        } else {
                            franchiseItem.classList.remove('selected');
                        }
                    }
                });
            });
        }

        // AIÂÖ®È†ÖÁõÆÊ∑ªÂâä„Éú„Çø„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
        const aiButton = document.querySelector('.ai-button');
        if (aiButton) {
            aiButton.addEventListener('click', function() {
                alert('AIÊ∑ªÂâäÊ©üËÉΩ„ÇíÂÆüË°å„Åó„Åæ„Åô„ÄÇ');
            });
        }

        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let currentPage = 1;
        let itemsPerPage = 30;
        let selectedItems = new Set();
        let currentStatusFilter = '';

        // „Ç™„Éº„Éà„Çª„Éº„ÉñÈñ¢ÈÄ£
        let unsavedChanges = new Map(); // { cvId: { status, timestamp } }
        let autoSaveTimer = null;
        let isSaving = false;

        // Ê°à‰ª∂„Éá„Éº„Çø„Éô„Éº„Çπ
        // Ê°à‰ª∂„Éá„Éº„ÇøÔºàÂÆü„Éá„Éº„ÇøÔºâ
        let casesData = {}; // ÂàùÊúüÂÄ§„ÅØÁ©∫„ÄÅloadCasesData()„ÅßÂèñÂæó
        //         console.log('About to define casesData...');
        //         const casesData = {
        //             '001': {
        //                 name: 'Áî∞‰∏≠Â§™ÈÉé',
        //                 nameKana: '„Çø„Éä„Ç´„Çø„É≠„Ç¶',
        //                 gender: 'Áî∑ÊÄß',
        //                 age: '40‰ª£',
        //                 relation: 'Êú¨‰∫∫',
        //                 phone: '090-1234-5678',
        //                 email: 'tanaka@example.com',
        //                 propertyType: 'Êà∏Âª∫„Å¶',
        //                 floors: '2ÈöéÂª∫„Å¶',
        //                 buildingAge: '15Âπ¥',
        //                 area: '120„é°',
        //                 constructionCount: 'ÂàùÂõû',
        //                 wallMaterial: '„Çµ„Ç§„Éá„Ç£„É≥„Ç∞',
        //                 roofMaterial: '„Çπ„É¨„Éº„Éà',
        //                 postalCode: '150-0001',
        //                 address: 'Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫Á•ûÂÆÆÂâç1-1-1',
        //                 searchKeyword: 'Â§ñÂ£ÅÂ°óË£Ö Êù±‰∫¨',
        //                 workItems: ['Â§ñÂ£ÅÂ°óË£Ö', 'Â±ãÊ†πÂ°óË£ÖÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ'],
        //                 companiesCount: 3,
        //                 status: 'ÈÖç‰ø°Ê∏à',
        //                 date: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000), // 5Êó•Ââç
        //                 amount: '¬•60,000',
        //                 franchiseStatuses: {
        //                     'franchise1': { name: 'AÂ∑•ÂãôÂ∫ó', status: '„Ç¢„ÉùÊ∏à' },
        //                     'franchise2': { name: 'BÂ°óË£Ö', status: 'ÁèæË™øÊ∏à' },
        //                     'franchise3': { name: 'CÂª∫Ë®≠', status: 'Ë¶ãÁ©çÊèêÂá∫Ê∏à' }
        //                 }
        //             },
        //             '002': {
        //                 name: 'Èà¥Êú®Ëä±Â≠ê',
        //                 nameKana: '„Çπ„Ç∫„Ç≠„Éè„Éä„Ç≥',
        //                 gender: 'Â•≥ÊÄß',
        //                 age: '50‰ª£',
        //                 relation: 'Êú¨‰∫∫',
        //                 phone: '080-9876-5432',
        //                 email: 'suzuki@example.com',
        //                 propertyType: '„Éû„É≥„Ç∑„Éß„É≥',
        //                 floors: '5ÈöéÂª∫„Å¶',
        //                 buildingAge: '8Âπ¥',
        //                 area: '85„é°',
        //                 constructionCount: '2ÂõûÁõÆ',
        //                 wallMaterial: '„É¢„É´„Çø„É´',
        //                 roofMaterial: 'Áì¶',
        //                 postalCode: '160-0022',
        //                 address: 'Êù±‰∫¨ÈÉΩÊñ∞ÂÆøÂå∫Êñ∞ÂÆø2-2-2',
        //                 searchKeyword: 'Â§ñÂ£ÅÂ°óË£Ö „Éû„É≥„Ç∑„Éß„É≥',
        //                 workItems: ['Â§ñÂ£ÅÂ°óË£Ö', '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ'],
        //                 companiesCount: 3,
        //                 status: 'ÈÖç‰ø°‰∏≠',
        //                 date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000), // 2Êó•Ââç
        //                 amount: '¬•45,000',
        //                 franchiseStatuses: {
        //                     'franchise1': { name: 'DÂ§ñË£ÖÂ∑•Ê•≠', status: 'Êñ∞Ë¶èÈÖç‰ø°' },
        //                     'franchise2': { name: 'EÂ°óË£ÖÂ∫ó', status: 'ÈÖç‰ø°Ê∏à' },
        //                     'franchise3': { name: 'FÂª∫Ë®≠Â∑•Ê•≠', status: 'ÈÖç‰ø°Ê∏à' }
        //                 }
        //             },
        //             '003': {
        //                 name: '‰ΩêËó§‰∏ÄÈÉé',
        //                 nameKana: '„Çµ„Éà„Ç¶„Ç§„ÉÅ„É≠„Ç¶',
        //                 gender: 'Áî∑ÊÄß',
        //                 age: '60‰ª£',
        //                 relation: 'Êú¨‰∫∫',
        //                 phone: '070-5555-7777',
        //                 email: 'sato@example.com',
        //                 propertyType: 'Êà∏Âª∫„Å¶',
        //                 floors: '2ÈöéÂª∫„Å¶',
        //                 buildingAge: '25Âπ¥',
        //                 area: '150„é°',
        //                 constructionCount: '3ÂõûÁõÆ‰ª•‰∏ä',
        //                 wallMaterial: 'ALC',
        //                 roofMaterial: 'ÈáëÂ±û',
        //                 postalCode: '140-0013',
        //                 address: 'Êù±‰∫¨ÈÉΩÂìÅÂ∑ùÂå∫ÂçóÂ§ß‰∫ï3-3-3',
        //                 searchKeyword: 'Â±ãÊ†πÊõø„Åà Â§ñÂ£ÅÂ∑•‰∫ã',
        //                 workItems: ['Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„ÅàÔºà„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠âÔºâ', 'Â§ñÂ£ÅË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ'],
        //                 companiesCount: 3,
        //                 status: 'Ë¶ãËæº„Åø',
        //                 date: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000), // 10Êó•Ââç
        //                 amount: '¬•90,000',
        //                 franchiseStatuses: {}
        //             },
        //             '004': {
        //                 name: 'Â±±Áî∞Ê¨°ÈÉé',
        //                 nameKana: '„É§„Éû„ÉÄ„Ç∏„É≠„Ç¶',
        //                 gender: 'Áî∑ÊÄß',
        //                 age: '30‰ª£',
        //                 relation: 'Êú¨‰∫∫',
        //                 phone: '090-1111-2222',
        //                 email: 'yamada@example.com',
        //                 propertyType: 'Êà∏Âª∫„Å¶',
        //                 floors: '3ÈöéÂª∫„Å¶',
        //                 buildingAge: '10Âπ¥',
        //                 area: '100„é°',
        //                 constructionCount: 'ÂàùÂõû',
        //                 wallMaterial: '„Çµ„Ç§„Éá„Ç£„É≥„Ç∞',
        //                 roofMaterial: '„Çπ„É¨„Éº„Éà',
        //                 postalCode: '151-0001',
        //                 address: 'Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫‰ª£„ÄÖÊú®1-1-1',
        //                 searchKeyword: 'Â§ñÂ£ÅÂ°óË£Ö Ê∏ãË∞∑',
        //                 workItems: ['Â§ñÂ£ÅÂ°óË£Ö', 'Â§ñÂ£ÅË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ'],
        //                 companiesCount: 2,
        //                 status: 'Êñ∞Ë¶è',
        //                 date: new Date(),
        //                 amount: '¬•80,000',
        //                 franchiseStatuses: {}
        //             },
        //             '005': {
        //                 name: 'È´òÊ©ãÁæéÂí≤',
        //                 nameKana: '„Çø„Ç´„Éè„Ç∑„Éü„Çµ„Ç≠',
        //                 gender: 'Â•≥ÊÄß',
        //                 age: '40‰ª£',
        //                 relation: 'Êú¨‰∫∫',
        //                 phone: '080-3333-4444',
        //                 email: 'takahashi@example.com',
        //                 propertyType: '„Éû„É≥„Ç∑„Éß„É≥',
        //                 floors: '8ÈöéÂª∫„Å¶',
        //                 buildingAge: '20Âπ¥',
        //                 area: '75„é°',
        //                 constructionCount: '2ÂõûÁõÆ',
        //                 wallMaterial: '„Çø„Ç§„É´',
        //                 roofMaterial: 'Èô∏Â±ãÊ†π',
        //                 postalCode: '162-0001',
        //                 address: 'Êù±‰∫¨ÈÉΩÊñ∞ÂÆøÂå∫Â∏ÇË∞∑1-1-1',
        //                 searchKeyword: '„Éû„É≥„Ç∑„Éß„É≥ Èò≤Ê∞¥',
        //                 workItems: ['Â±ã‰∏äÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ', '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ'],
        //                 companiesCount: 3,
        //                 status: '‰∏çÂú®',
        //                 date: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000),
        //                 amount: '¬•60,000',
        //                 callHistory: [
        //                     { date: '2025-01-10 10:30', note: 'ÂàùÂõûÊû∂Èõª„ÄÅ‰∏çÂú®„ÄÇÂÜçÊû∂Èõª‰∫àÂÆö„ÄÇ' }
        //                 ],
        //                 franchiseStatuses: {}
        //             },
        //             '006': {
        //                 name: '‰ºäËó§ÂÅ•‰∏Ä',
        //                 nameKana: '„Ç§„Éà„Ç¶„Ç±„É≥„Ç§„ÉÅ',
        //                 gender: 'Áî∑ÊÄß',
        //                 age: '50‰ª£',
        //                 relation: 'Êú¨‰∫∫',
        //                 phone: '070-5555-6666',
        //                 email: 'ito@example.com',
        //                 propertyType: 'Â∫óËàó',
        //                 floors: '2ÈöéÂª∫„Å¶',
        //                 buildingAge: '30Âπ¥',
        //                 area: '200„é°',
        //                 constructionCount: '3ÂõûÁõÆ‰ª•‰∏ä',
        //                 wallMaterial: '„É¢„É´„Çø„É´',
        //                 roofMaterial: 'Áì¶',
        //                 postalCode: '141-0001',
        //                 address: 'Êù±‰∫¨ÈÉΩÂìÅÂ∑ùÂå∫ÂåóÂìÅÂ∑ù1-1-1',
        //                 searchKeyword: 'Â∫óËàó Â§ñÂ£Å',
        //                 workItems: ['Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï', 'Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï'],
        //                 companiesCount: 4,
        //                 status: 'ÂÜçÊû∂Èõª',
        //                 date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000),
        //                 amount: '¬•120,000',
        //                 callHistory: [
        //                     { date: '2025-01-08 14:00', note: 'ÂàùÂõûÊû∂Èõª„ÄÇË¶ãÁ©ç„ÇÇ„ÇäÂ∏åÊúõ„ÄÇ' },
        //                     { date: '2025-01-09 11:00', note: 'Ë≥áÊñôÈÄÅ‰ªò„ÅÆÁ¢∫Ë™ç„ÄÇÊ¨°ÂõûÊû∂Èõª‰∫àÂÆö„ÄÇ' }
        //                 ],
        //                 franchiseStatuses: {}
        //             },
        //             '007': {
        //                 name: 'Ê∏°Ëæ∫ÈôΩÂ≠ê',
        //                 nameKana: '„ÉØ„Çø„Éä„Éô„É®„Ç¶„Ç≥',
        //                 gender: 'Â•≥ÊÄß',
        //                 age: '60‰ª£',
        //                 relation: 'ÈÖçÂÅ∂ËÄÖ',
        //                 phone: '090-7777-8888',
        //                 email: 'watanabe@example.com',
        //                 propertyType: 'Êà∏Âª∫„Å¶',
        //                 floors: 'Âπ≥Â±ã',
        //                 buildingAge: '35Âπ¥',
        //                 area: '90„é°',
        //                 constructionCount: 'ÂàùÂõû',
        //                 wallMaterial: 'ALC',
        //                 roofMaterial: 'Áì¶',
        //                 postalCode: '143-0001',
        //                 address: 'Êù±‰∫¨ÈÉΩÂ§ßÁî∞Âå∫Êù±Êµ∑1-1-1',
        //                 searchKeyword: 'Â±ãÊ†πËë∫„ÅçÊõø„Åà',
        //                 workItems: ['Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„ÅàÔºàÁì¶Ôºâ', 'Èõ®Êºè„Çä‰øÆÁπï'],
        //                 companiesCount: 3,
        //                 status: 'ÈÖç‰ø°Ê∏à',
        //                 date: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000),
        //                 amount: '¬•100,000',
        //                 franchiseStatuses: {
        //                     'franchise1': { name: 'GÂ±ãÊ†πÂ∑•‰∫ã', status: 'Ë¶ãÁ©çÊèêÂá∫Ê∏à' },
        //                     'franchise2': { name: 'HÂª∫ÁØâ', status: '„Ç¢„ÉùÊ∏à' },
        //                     'franchise3': { name: 'IÂ∑•ÂãôÂ∫ó', status: 'Ê§úË®é‰∏≠' }
        //                 }
        //             },
        //             '008': {
        //                 name: '‰∏≠ÊùëÂ§™‰∏Ä',
        //                 nameKana: '„Éä„Ç´„É†„É©„Çø„Ç§„ÉÅ',
        //                 gender: 'Áî∑ÊÄß',
        //                 age: '40‰ª£',
        //                 relation: 'Êú¨‰∫∫',
        //                 phone: '080-9999-0000',
        //                 email: 'nakamura@example.com',
        //                 propertyType: '„Ç¢„Éë„Éº„Éà',
        //                 floors: '3ÈöéÂª∫„Å¶',
        //                 buildingAge: '15Âπ¥',
        //                 area: '250„é°',
        //                 constructionCount: '2ÂõûÁõÆ',
        //                 wallMaterial: '„Çµ„Ç§„Éá„Ç£„É≥„Ç∞',
        //                 roofMaterial: '„Çπ„É¨„Éº„Éà',
        //                 postalCode: '144-0001',
        //                 address: 'Êù±‰∫¨ÈÉΩÂ§ßÁî∞Âå∫Ëí≤Áî∞1-1-1',
        //                 searchKeyword: '„Ç¢„Éë„Éº„Éà Â°óË£Ö',
        //                 workItems: ['Â§ñÂ£ÅÂ°óË£Ö', 'Â±ãÊ†πÂ°óË£ÖÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ', 'ÈâÑÈÉ®Â°óË£Ö'],
        //                 companiesCount: 3,
        //                 status: 'Êñ∞Ë¶è',
        //                 date: new Date(),
        //                 amount: '¬•150,000',
        //                 franchiseStatuses: {}
        //             }
        //         };
        
        console.log('casesData defined successfully:', Object.keys(casesData).length + ' cases');
        console.log('Case IDs:', Object.keys(casesData));

        // Á¥π‰ªãÊñôË®àÁÆó„É≠„Ç∏„ÉÉ„ÇØ
        function calculateIntroductionFee(workItems, propertyType, floors, companiesCount) {
            // ÊñôÈáëË®≠ÂÆö
            const basicItems = {
                'Â§ñÂ£ÅÂ°óË£Ö': 20000,
                'Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï': 20000,
                'Â§ñÂ£ÅÂºµÊõø„Åà': 20000,
                'Â±ãÊ†πÂ°óË£ÖÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 20000,
                'Â±ã‰∏äÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 20000,
                'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„ÅàÔºà„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠âÔºâ': 20000,
                'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„ÅàÔºàÁì¶Ôºâ': 20000,
                'Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï': 20000,
                'Â§ñÂ£ÅË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 20000,
                'Â±ãÊ†πË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 20000,
                '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 20000,
                'ÂÜÖË£ÖÊ∞¥Âõû„ÇäÔºà„Éê„Çπ„Éª„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éà„Ç§„É¨ÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 20000,
                'ÂÜÖË£ÖÔºà„Éï„É≠„Éº„É™„É≥„Ç∞„ÇÑÁï≥„Å™„Å©„ÅÆÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 20000
            };
            
            const singleItems = {
                'Â±ãÊ†πÂ°óË£ÖÂçòÂìÅ': companiesCount === 1 ? 20000 : 10000,
                'Â±ã‰∏äÈò≤Ê∞¥ÂçòÂìÅ': companiesCount === 1 ? 20000 : 10000,
                'Â§ñÂ£ÅË£ú‰øÆÂçòÂìÅ': companiesCount === 1 ? 20000 : 5000,
                'Â±ãÊ†πË£ú‰øÆÂçòÂìÅ': companiesCount === 1 ? 20000 : 5000,
                '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÂçòÂìÅ': companiesCount === 1 ? 20000 : 5000
            };
            
            let maxFee = 0;
            
            // ÂêÑÂ∑•‰∫ãÈ†ÖÁõÆ„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åó„ÄÅÊúÄÈ´òÈ°ç„ÇíÂèñÂæó
            workItems.forEach(item => {
                let fee = 0;
                
                // Âü∫Êú¨È†ÖÁõÆ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                if (basicItems[item]) {
                    fee = basicItems[item];
                    
                    // 3Èöé‰ª•‰∏ä„ÅÆ„Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÄÅ30,000ÂÜÜ„Å´Â§âÊõ¥
                    if ((propertyType === '„Ç¢„Éë„Éº„Éà' || propertyType === '„Éû„É≥„Ç∑„Éß„É≥') && 
                        floors && (floors.includes('3Èöé') || floors.includes('4Èöé') || floors.includes('5Èöé') || floors.includes('6Èöé') || parseInt(floors) >= 3)) {
                        fee = 30000;
                    }
                }
                
                // ÂçòÂìÅÈ†ÖÁõÆ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                if (singleItems[item]) {
                    fee = singleItems[item];
                }
                
                maxFee = Math.max(maxFee, fee);
            });
            
            return maxFee;
        }

        // Ê°à‰ª∂ÈÅ∏ÊäûÊ©üËÉΩ

        // „Éï„Ç©„Éº„É†„Å´Ê°à‰ª∂„Éá„Éº„Çø„ÇíÂèçÊò†
        function populateForm(caseId) {
            const data = casesData[caseId];
            if (!data) return;

            console.log('[populateForm] „Éá„Éº„Çø„ÇíÂèçÊò†„Åó„Åæ„Åô:', caseId, data);

            // CRM„Ç≥„É≥„ÉÜ„É≥„ÉÑÂÜÖ„ÅÆÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„ÇíÂèñÂæó
            const crmContent = document.getElementById('crmContent');
            if (!crmContent) return;

            // CVIDË°®Á§∫Ôºà„Çª„ÇØ„Ç∑„Éß„É≥„Çø„Ç§„Éà„É´„Å´Ë°®Á§∫Ôºâ
            const sectionTitle = document.getElementById('sectionTitle');
            if (sectionTitle) {
                sectionTitle.textContent = caseId;
            }

            // Âü∫Êú¨ÊÉÖÂ†±ÔºàID„ÅßÁõ¥Êé•ÂèñÂæóÔºâ
            const nameInput = document.getElementById('crmNameInput');
            if (nameInput) {
                nameInput.value = data.name || data['Ê∞èÂêç'] || '';
                // ÂÄ§„ÅåÂÖ•„Å£„ÅüÂ†¥Âêà„ÅØÂç≥Â∫ß„Å´Ëµ§Êû†„ÇíËß£Èô§
                if (nameInput.value && nameInput.value.trim() !== '') {
                    nameInput.classList.remove('border-red-500');
                    nameInput.classList.add('border-gray-300');
                    nameInput.style.borderWidth = '';
                }
            }

            const kanaInput = document.getElementById('crmKanaInput');
            if (kanaInput) {
                kanaInput.value = data.nameKana || data['„Éï„É™„Ç¨„Éä'] || '';
                // ÂÄ§„ÅåÂÖ•„Å£„ÅüÂ†¥Âêà„ÅØÂç≥Â∫ß„Å´Ëµ§Êû†„ÇíËß£Èô§
                if (kanaInput.value && kanaInput.value.trim() !== '') {
                    kanaInput.classList.remove('border-red-500');
                    kanaInput.classList.add('border-gray-300');
                    kanaInput.style.borderWidth = '';
                }
            }

            // ÊÄßÂà•Ôºà„Éú„Çø„É≥ÂΩ¢Âºè - hidden input„Å´ÂÄ§„ÇíË®≠ÂÆö„Åó„ÄÅÂØæÂøú„Åô„Çã„Éú„Çø„É≥„ÇíÈÅ∏ÊäûÁä∂ÊÖã„Å´„Åô„ÇãÔºâ
            const genderSelect = document.getElementById('genderSelect');
            const genderValue = data.gender || data['ÊÄßÂà•'] || '';
            if (genderSelect) {
                genderSelect.value = genderValue;
                // ÂØæÂøú„Åô„Çã„Éú„Çø„É≥„Å´ selected „ÇØ„É©„Çπ„Å®Ëâ≤„ÇíËøΩÂä†
                const genderButtonGroup = document.getElementById('genderButtonGroup');
                if (genderButtonGroup && genderValue) {
                    genderButtonGroup.querySelectorAll('.option-button').forEach(btn => {
                        if (btn.textContent.trim() === genderValue) {
                            btn.classList.add('selected');
                            btn.classList.remove('bg-white', 'border-gray-300', 'text-gray-700');
                            btn.classList.add('bg-purple-500', 'border-purple-500', 'text-white', 'shadow-md');
                        } else {
                            btn.classList.remove('selected', 'bg-purple-500', 'border-purple-500', 'text-white', 'shadow-md');
                            btn.classList.add('bg-white', 'border-gray-300', 'text-gray-700');
                        }
                    });
                }
            }

            // Âπ¥ÈΩ¢Ôºà„Éú„Çø„É≥ÂΩ¢Âºè - hidden input„Å´ÂÄ§„ÇíË®≠ÂÆö„Åó„ÄÅÂØæÂøú„Åô„Çã„Éú„Çø„É≥„ÇíÈÅ∏ÊäûÁä∂ÊÖã„Å´„Åô„ÇãÔºâ
            const ageSelect = document.getElementById('ageSelect');
            let ageValue = data.age || data['Âπ¥ÈΩ¢'] || '';
            // Âè§„ÅÑÂÄ§„ÇíÊñ∞„Åó„ÅÑÂÄ§„Å´Ê≠£Ë¶èÂåñÔºà„Äú30‰ª£‚Üí30‰ª£„ÄÅ70‰ª£„Äú‚Üí70‰ª£Ôºâ
            if (ageValue === '„Äú30‰ª£') ageValue = '30‰ª£';
            if (ageValue === '70‰ª£„Äú') ageValue = '70‰ª£';
            if (ageSelect) {
                ageSelect.value = ageValue;
                // ÂØæÂøú„Åô„Çã„Éú„Çø„É≥„Å´ selected „ÇØ„É©„Çπ„Å®Ëâ≤„ÇíËøΩÂä†
                const ageButtonGroup = document.getElementById('ageButtonGroup');
                if (ageButtonGroup && ageValue) {
                    ageButtonGroup.querySelectorAll('.option-button').forEach(btn => {
                        if (btn.textContent.trim() === ageValue) {
                            btn.classList.add('selected');
                            btn.classList.remove('bg-white', 'border-gray-300', 'text-gray-700');
                            btn.classList.add('bg-purple-500', 'border-purple-500', 'text-white', 'shadow-md');
                        } else {
                            btn.classList.remove('selected', 'bg-purple-500', 'border-purple-500', 'text-white', 'shadow-md');
                            btn.classList.add('bg-white', 'border-gray-300', 'text-gray-700');
                        }
                    });
                }
            }

            // Èñ¢‰øÇÊÄßÔºà„Çª„É¨„ÇØ„Éà - ID„ÅßÁõ¥Êé•„Ç¢„ÇØ„Çª„Çπ„ÄÅ„Éá„Éï„Ç©„É´„Éà„ÅØ„ÄåÊú¨‰∫∫„ÄçÔºâ
            const relationSelect = document.getElementById('relationSelect');
            if (relationSelect) {
                relationSelect.value = data.relation || data['Á∂öÊüÑ'] || 'Êú¨‰∫∫';
            }

            // ÈõªË©±Áï™Âè∑„Å®„É°„Éº„É´
            const telInput = crmContent.querySelector('input[type="tel"]');
            if (telInput) telInput.value = data.phone || data['ÈõªË©±Áï™Âè∑'] || '';

            const emailInput = crmContent.querySelector('input[type="email"]');
            if (emailInput) emailInput.value = data.email || data['„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ'] || '';

            // Áâ©‰ª∂„Éó„É≠„Éï„Ç£„Éº„É´Ôºàdata„Åã„ÇâÁõ¥Êé•ÂèñÂæó - CVListManager„ÅßÊ≠£„Åó„Åè„Éû„ÉÉ„Éî„É≥„Ç∞Ê∏à„ÅøÔºâ
            console.log('[populateForm] „Éá„Éº„ÇøÁ¢∫Ë™ç:', {
                propertyType: data.propertyType,
                floors: data.floors,
                buildingAge: data.buildingAge,
                floorArea: data.floorArea || data.area,
                constructionCount: data.constructionCount,
                previousConstructionTime: data.previousConstructionTime,
                wallMaterial: data.wallMaterial,
                roofMaterial: data.roofMaterial
            });

            const propertyTypeInput = document.getElementById('propertyTypeSelect');
            if (propertyTypeInput) propertyTypeInput.value = data.propertyType || '';

            const floorsInput = document.getElementById('floorsSelect');
            if (floorsInput) floorsInput.value = data.floors || '';

            const buildingAgeInput = document.getElementById('buildingAgeSelect');
            if (buildingAgeInput) buildingAgeInput.value = data.buildingAge || '';

            const floorAreaInput = document.getElementById('floorAreaSelect');
            if (floorAreaInput) floorAreaInput.value = data.floorArea || data.area || '';

            const constructionCountInput = document.getElementById('constructionCountSelect');
            if (constructionCountInput) constructionCountInput.value = data.constructionCount || '';

            const previousConstructionInput = document.getElementById('previousConstructionSelect');
            if (previousConstructionInput) previousConstructionInput.value = data.previousConstructionTime || '';

            const wallMaterialInput = document.getElementById('wallMaterialSelect');
            if (wallMaterialInput) wallMaterialInput.value = data.wallMaterial || '';

            const roofMaterialInput = document.getElementById('roofMaterialSelect');
            if (roofMaterialInput) roofMaterialInput.value = data.roofMaterial || '';

            console.log('[populateForm] Áâ©‰ª∂„Éó„É≠„Éï„Ç£„Éº„É´ÂèçÊò†ÂÆå‰∫Ü:', {
                propertyType: propertyTypeInput?.value,
                floors: floorsInput?.value,
                buildingAge: buildingAgeInput?.value,
                floorArea: floorAreaInput?.value,
                constructionCount: constructionCountInput?.value,
                previousConstructionTime: previousConstructionInput?.value,
                wallMaterial: wallMaterialInput?.value,
                roofMaterial: roofMaterialInput?.value
            });

            // ÈÉµ‰æøÁï™Âè∑„Å®‰ΩèÊâÄÔºàID„Éô„Éº„Çπ„ÅßÂèñÂæóÔºâ
            const zipInput = document.getElementById('zipInput');
            if (zipInput) zipInput.value = data.postalCode || data['ÈÉµ‰æøÁï™Âè∑'] || '';

            const addressInput = document.getElementById('addressInput');
            const addressNumberInput = document.getElementById('addressNumberInput');
            const addressKanaDisplay = document.getElementById('addressKanaDisplay');

            if (addressInput && addressNumberInput) {
                // GAS„Åã„ÇâËøî„Å£„Å¶„Åè„ÇãÂÄãÂà•„Éá„Éº„Çø„Çí‰ΩøÁî®
                const prefecture = data._rawData?.prefecture || '';
                const city = data._rawData?.city || '';
                const propertyStreet = data._rawData?.propertyStreet || '';
                const addressKana = data._rawData?.addressKana || '';

                // ‰ΩèÊâÄ = ÈÉΩÈÅìÂ∫úÁúå + Â∏ÇÂå∫Áî∫Êùë
                addressInput.value = (prefecture + city).trim();

                // Áï™Âú∞ = ‰ΩèÊâÄË©≥Á¥∞
                addressNumberInput.value = propertyStreet;

                // ‰ΩèÊâÄ„Ç´„Éä„ÇíË£úË∂≥Ë°®Á§∫ÔºàÂçäËßí„Ç´„Çø„Ç´„Éä„ÄÅÁúåÂêçÈô§Â§ñÔºâ
                if (addressKana && addressKanaDisplay) {
                    // ÁúåÂêç„ÇíÈô§Â§ñÔºàÊúÄÂàù„ÅÆ2-3ÊñáÂ≠ó„ÇíÈô§„ÅèÔºâ
                    const kanaWithoutPrefecture = addressKana.replace(/^[ÔΩ±-ÔæùÔæûÔæü]{2,4}ÔΩπÔæù/, '');
                    addressKanaDisplay.textContent = kanaWithoutPrefecture;
                }
            }

            // ÈÉµ‰æøÁï™Âè∑„Åæ„Åü„ÅØ‰ΩèÊâÄ„Åå„ÅÇ„Çå„Å∞Google Maps„É™„É≥„ÇØ„ÇíËá™ÂãïÁîüÊàê
            if ((zipInput && zipInput.value) || (addressInput && addressInput.value)) {
                setTimeout(() => generateGoogleMapLink(), 100);
            }

            // Google„Éû„ÉÉ„Éó
            const mapLinkInput = document.getElementById('mapLinkInput');
            if (mapLinkInput && data.mapLink) {
                mapLinkInput.value = data.mapLink;
            }

            // Ë¶ãÁ©ç„ÇÇ„Çä„ÉªÂ∑•‰∫ã„Å´Èñ¢„Åô„Çã„ÅîË¶ÅÊúõ„Çª„ÇØ„Ç∑„Éß„É≥

            // Ë¶ãÁ©ç„ÇÇ„ÇäÂ∏åÊúõÁÆáÊâÄÔºàworkItems„Åã„ÇâÈÅ∏ÊäûÁä∂ÊÖã„Å´„Åô„ÇãÔºâ
            const workItemsButtons = document.getElementById('workItemsButtons');
            if (workItemsButtons && data.workItems && Array.isArray(data.workItems)) {
                // „Åæ„ÅöÂÖ®„Éú„Çø„É≥„ÅÆÈÅ∏ÊäûÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
                workItemsButtons.querySelectorAll('.option-button').forEach(btn => {
                    btn.classList.remove('selected', 'bg-purple-500', 'border-purple-500', 'text-white', 'shadow-md');
                    btn.classList.add('bg-white', 'border-gray-300', 'text-gray-700');
                });

                // workItems„Å´Âê´„Åæ„Çå„Çã„Éú„Çø„É≥„ÇíÈÅ∏ÊäûÁä∂ÊÖã„Å´„Åô„Çã
                data.workItems.forEach(item => {
                    const btn = workItemsButtons.querySelector(`[data-value="${item}"]`);
                    if (btn) {
                        btn.classList.remove('bg-white', 'border-gray-300', 'text-gray-700');
                        btn.classList.add('selected', 'bg-purple-500', 'border-purple-500', 'text-white', 'shadow-md');
                    }
                });
            }

            // Ë¶ãÁ©ç„ÇÇ„ÇäÂèñÂæóÂÖà
            const quoteSourceInput = document.getElementById('quoteSourceInput');
            if (quoteSourceInput) {
                quoteSourceInput.value = data.quoteSource || data['Q12_Ë¶ãÁ©ç„ÇÇ„ÇäÂèñÂæóÂÖà'] || '';
            }

            // ÊñΩÂ∑•ÊôÇÊúü
            const constructionTimingSelect = document.getElementById('constructionTimingSelect');
            if (constructionTimingSelect) {
                constructionTimingSelect.value = data.constructionTiming || data['ÊñΩÂ∑•ÊôÇÊúü'] || '';
            }

            // ‰ªñÁ§æË¶ãÁ©ç„ÇÇ„ÇäÁä∂Ê≥Å
            const quoteStatusSelect = document.getElementById('quoteStatusSelect');
            if (quoteStatusSelect) {
                quoteStatusSelect.value = data.quoteStatus || '';
            }

            // ‰ªñÁ§æË¶ãÁ©ç„ÇÇ„ÇäÊï∞
            const quoteCountSelect = document.getElementById('quoteCountSelect');
            if (quoteCountSelect) {
                const quoteCount = data.quoteCount || data['Q11_Ë¶ãÁ©ç„ÇÇ„Çä‰øùÊúâÊï∞'] || '';
                quoteCountSelect.value = quoteCount;
            }

            // Ë®™ÂïèÊ•≠ËÄÖ„ÅÆÁä∂Ê≥Å
            const doorSalesVisitSelect = document.getElementById('doorSalesVisitSelect');
            if (doorSalesVisitSelect) {
                doorSalesVisitSelect.value = data.doorSalesVisit || '';
            }

            // ÊØîËºÉÊÑèÂêëÔºà„ÄåÊØîËºÉ„ÅØ‰∏çË¶Å„Äç„ÅÆÂ†¥Âêà„ÅØÁ©∫Ê¨ÑË°®Á§∫Ôºâ
            const comparisonIntentionSelect = document.getElementById('comparisonIntentionSelect');
            if (comparisonIntentionSelect) {
                const comparisonValue = data.comparisonIntention || '';
                // „ÄåÊØîËºÉ„ÅØ‰∏çË¶Å„Äç„ÅÆÂ†¥Âêà„ÅØÊ•≠ËÄÖ„Å´Ë¶ã„Åõ„Å™„ÅÑ„Åü„ÇÅÁ©∫Ê¨Ñ„Å´„Åô„Çã
                if (comparisonValue === 'ÊØîËºÉ„ÅØ‰∏çË¶Å') {
                    comparisonIntentionSelect.value = '';
                } else {
                    comparisonIntentionSelect.value = comparisonValue;
                }
            }

            // ÁèæÂú®„ÅÆÂä£ÂåñÁä∂Ê≥Å
            const deteriorationStatusSelect = document.getElementById('deteriorationStatusSelect');
            if (deteriorationStatusSelect) {
                deteriorationStatusSelect.value = data.deteriorationStatus || '';
            }

            // ÁèæÂú∞Ë™øÊüªÂ∏åÊúõÊó•ÊôÇÔºàAQÂàó: ÁèæÂú∞Ë™øÊüªÂ∏åÊúõÊó•ÊôÇÔºâ
            // „Éú„Çø„É≥„ÇíÈÅ∏ÊäûÁä∂ÊÖã„Å´„Åô„Çã
            if (data['ÁèæÂú∞Ë™øÊüªÂ∏åÊúõÊó•ÊôÇ']) {
                const selectedTimes = data['ÁèæÂú∞Ë™øÊüªÂ∏åÊúõÊó•ÊôÇ'].split(', ');
                const surveyButtonGroup = document.getElementById('surveyDateTimeButtonGroup');
                if (surveyButtonGroup) {
                    surveyButtonGroup.querySelectorAll('.option-button').forEach(btn => {
                        if (selectedTimes.includes(btn.textContent.trim())) {
                            btn.classList.add('selected');
                        }
                    });
                }
                console.log('[populateForm] ÁèæÂú∞Ë™øÊüªÂ∏åÊúõÊó•ÊôÇË™≠„ÅøËæº„Åø:', data['ÁèæÂú∞Ë™øÊüªÂ∏åÊúõÊó•ÊôÇ']);
            }

            // ÊµÅÂÖ•Ê§úÁ¥¢„ÉØ„Éº„ÉâÔºàBFÂàó: searchKeywordÔºâ
            const searchKeywordInput = document.getElementById('searchKeywordInput');
            if (searchKeywordInput) {
                searchKeywordInput.value = data.searchKeyword || '';
            }

            // ÈÄ£Áµ°ÊñπÊ≥ïÔºàATÂàó: ÈÄ£Áµ°ÊôÇÈñìÂ∏ØÔºâ
            const contactMethodInput = document.getElementById('contactMethodInput');
            if (contactMethodInput) {
                contactMethodInput.value = data['ÈÄ£Áµ°ÊôÇÈñìÂ∏Ø'] || data.contactMethod || '';
            }

            // Ë¶ãÁ©ç„ÇÇ„Çä„ÉªÂ∑•‰∫ã„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆ„Éï„Ç£„Éº„É´„Éâ
            // Â∏åÊúõÂ∑•‰∫ãÂÜÖÂÆπ„Åã„ÇâË¶ãÁ©ç„ÇÇ„ÇäÂ∏åÊúõÁÆáÊâÄ„ÇíÈÅ∏Êäû
            const workExterior = data['Q9_Â∏åÊúõÂ∑•‰∫ãÂÜÖÂÆπ_Â§ñÂ£Å'] || '';
            const workRoof = data['Q10_Â∏åÊúõÂ∑•‰∫ãÂÜÖÂÆπ_Â±ãÊ†π'] || '';
            const estimateCount = data['Q11_Ë¶ãÁ©ç„ÇÇ„Çä‰øùÊúâÊï∞'] || '';
            const deterioration = data['Q16_ÁèæÂú®„ÅÆÂä£ÂåñÁä∂Ê≥Å'] || '';
            const selectionCriteria = data['Q17_Ê•≠ËÄÖÈÅ∏ÂÆöÊù°‰ª∂'] || '';

            // Ë¶ãÁ©ç„ÇÇ„ÇäÂ∏åÊúõÁÆáÊâÄ„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞
            const workMapping = {
                'Â°óË£Ö': ['Â§ñÂ£ÅÂ°óË£Ö', 'Â±ãÊ†πÂ°óË£Ö'],
                'Ëë∫„ÅçÊõø„Åà„Éª„Ç´„Éê„ÉºÂ∑•Ê≥ï': ['Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„ÅàÔºà„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠âÔºâ', 'Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï'],
                'Â§ñÂ£Å„Å®Â±ãÊ†π': ['Â§ñÂ£ÅÂ°óË£Ö', 'Â±ãÊ†πÂ°óË£Ö']
            };

            // Ë¶ãÁ©ç„ÇÇ„ÇäÂ∏åÊúõÁÆáÊâÄ„ÅÆ„Éú„Çø„É≥„ÇíÈÅ∏ÊäûÔºàCSV„Éá„Éº„Çø„ÇíÂÑ™ÂÖàÔºâ
            if (workExterior || workRoof || (data.workItems && Array.isArray(data.workItems))) {
                // Ë¶ãÁ©ç„ÇÇ„Çä„Çª„ÇØ„Ç∑„Éß„É≥ÂÜÖ„ÅÆ„Éú„Çø„É≥„ÅÆ„Åø„ÇíÂØæË±°
                const estimateSection = crmContent.querySelector('.form-section.bg-gradient-to-br.from-purple-50');
                if (estimateSection) {
                    const estimateButtons = estimateSection.querySelectorAll('.option-button');

                    // CSV„Éá„Éº„Çø„Åã„ÇâË¶ãÁ©ç„ÇÇ„ÇäÂ∏åÊúõÁÆáÊâÄ„ÇíÈÅ∏Êäû
                    if (workExterior === 'Â°óË£Ö') {
                        estimateButtons.forEach(btn => {
                            if (btn.textContent.trim() === 'Â§ñÂ£ÅÂ°óË£Ö') btn.classList.add('selected');
                        });
                    }
                    if (workRoof === 'Â°óË£Ö') {
                        estimateButtons.forEach(btn => {
                            if (btn.textContent.trim() === 'Â±ãÊ†πÂ°óË£Ö') btn.classList.add('selected');
                        });
                    }
                    if (workRoof === 'Ëë∫„ÅçÊõø„Åà„Éª„Ç´„Éê„ÉºÂ∑•Ê≥ï') {
                        estimateButtons.forEach(btn => {
                            const text = btn.textContent.trim();
                            if (text.includes('Â±ãÊ†πËë∫„ÅçÊõø„Åà') || text.includes('Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï')) {
                                btn.classList.add('selected');
                            }
                        });
                    }

                    // Êó¢Â≠ò„ÅÆworkItems„Éá„Éº„Çø„ÇÇÂá¶ÁêÜÔºàÂæåÊñπ‰∫íÊèõÊÄßÔºâ
                    if (data.workItems && Array.isArray(data.workItems)) {
                        data.workItems.forEach(item => {
                            estimateButtons.forEach(button => {
                                const buttonText = button.textContent.trim();
                                // ÂÆåÂÖ®‰∏ÄËá¥„Åæ„Åü„ÅØÈÉ®ÂàÜ‰∏ÄËá¥„Åß„ÉÅ„Çß„ÉÉ„ÇØ
                                if (buttonText === 'Â§ñÂ£ÅÂ°óË£Ö' && item.includes('Â§ñÂ£ÅÂ°óË£Ö')) {
                                    button.classList.add('selected');
                                } else if (buttonText === 'Â±ãÊ†πÂ°óË£Ö' && item.includes('Â±ãÊ†πÂ°óË£Ö')) {
                                    button.classList.add('selected');
                                } else if (buttonText === 'Â±ã‰∏äÈò≤Ê∞¥' && item.includes('Â±ã‰∏äÈò≤Ê∞¥')) {
                                    button.classList.add('selected');
                                } else if (buttonText.includes('Â±ãÊ†πËë∫„ÅçÊõø„Åà') && item.includes('Â±ãÊ†πËë∫„ÅçÊõø„Åà')) {
                                    button.classList.add('selected');
                                } else if (buttonText === 'Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï' && item.includes('Â±ãÊ†π„Ç´„Éê„Éº')) {
                                    button.classList.add('selected');
                                } else if (buttonText === 'Â§ñÂ£ÅË£ú‰øÆ' && item.includes('Â§ñÂ£ÅË£ú‰øÆ')) {
                                    button.classList.add('selected');
                                } else if (buttonText === 'Â±ãÊ†πË£ú‰øÆ' && item.includes('Â±ãÊ†πË£ú‰øÆ')) {
                                    button.classList.add('selected');
                                } else if (buttonText === '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥' && item.includes('„Éô„É©„É≥„ÉÄÈò≤Ê∞¥')) {
                                    button.classList.add('selected');
                                } else if (buttonText === 'ÂÜÖË£ÖÊ∞¥Âõû„ÇäÔºà„Éê„Çπ„Éª„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éà„Ç§„É¨Ôºâ' && item.includes('ÂÜÖË£ÖÊ∞¥Âõû„Çä')) {
                                    button.classList.add('selected');
                                }
                            });
                        });
                    }
                }
            }

            console.log('[populateForm] „Éá„Éº„ÇøÂèçÊò†ÂÆå‰∫Ü:', {
                workExterior,
                workRoof,
                estimateCount,
                deterioration,
                selectionCriteria
            });

            // Ê°à‰ª∂„É°„É¢„ÇíË™≠„ÅøËæº„ÅøÔºàASÂàó: Ê°à‰ª∂„É°„É¢Ôºâ
            const caseMemoTextarea = document.getElementById('caseMemoTextarea');
            if (caseMemoTextarea) {
                caseMemoTextarea.value = data['Ê°à‰ª∂„É°„É¢'] || data.caseMemo || '';
                console.log('[populateForm] Ê°à‰ª∂„É°„É¢Ë™≠„ÅøËæº„Åø:', data['Ê°à‰ª∂„É°„É¢'] || data.caseMemo || '(Á©∫)');
            }

            // Êú™ÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„ÅÆËµ§Êû†Ë°®Á§∫„ÇíÊõ¥Êñ∞ÔºàÂç≥Â∫ß„Å´ÂÆüË°åÔºâ
            validateEmptyFields();
        }

        /**
         * Êú™ÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„ÇíËµ§Êû†„Åß„Éè„Ç§„É©„Ç§„ÉàË°®Á§∫
         * Á©∫Ê¨Ñ„ÅÆinput/select„Éï„Ç£„Éº„É´„Éâ„Å´Ëµ§„ÅÑ„Éú„Éº„ÉÄ„Éº„ÇíÂãïÁöÑ„Å´ÈÅ©Áî®
         */
        function validateEmptyFields() {
            const crmContent = document.getElementById('crmContent');
            if (!crmContent) return;

            // ÂØæË±°„Éï„Ç£„Éº„É´„Éâ: input[type="text"], input[type="tel"], input[type="email"], select
            const fields = crmContent.querySelectorAll('input[type="text"], input[type="tel"], input[type="email"], select');

            fields.forEach(field => {
                const isEmpty = !field.value || field.value.trim() === '' || field.value === 'ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ';

                // „Éá„Éê„ÉÉ„Ç∞: crmKanaInput„ÅÆÁä∂ÊÖã„Çí„É≠„Ç∞Âá∫Âäõ
                if (field.id === 'crmKanaInput') {
                    console.log('[validateEmptyFields] crmKanaInputÁä∂ÊÖã:', {
                        id: field.id,
                        value: field.value,
                        isEmpty: isEmpty,
                        classList: field.classList.toString()
                    });
                }

                if (isEmpty) {
                    // Á©∫Ê¨Ñ„ÅÆÂ†¥Âêà„ÅØËµ§Êû†„ÇíËøΩÂä†
                    field.classList.remove('border-gray-300', 'border-blue-300');
                    field.classList.add('border-red-500');
                    field.style.borderWidth = '2px';
                } else {
                    // ÂÖ•ÂäõÊ∏à„Åø„ÅÆÂ†¥Âêà„ÅØÈÄöÂ∏∏„ÅÆ„Éú„Éº„ÉÄ„Éº„Å´Êàª„Åô
                    field.classList.remove('border-red-500');
                    field.classList.add('border-gray-300');
                    field.style.borderWidth = '';
                }
            });

            // „Éú„Çø„É≥„Ç∞„É´„Éº„Éó„ÅÆÊ§úË®ºÔºàÊÄßÂà•„ÉªÂπ¥ÈΩ¢Ôºâ
            // ÊÄßÂà•
            const genderSelect = document.getElementById('genderSelect');
            const genderButtonGroup = document.getElementById('genderButtonGroup');
            if (genderSelect && genderButtonGroup) {
                if (!genderSelect.value || genderSelect.value.trim() === '') {
                    genderButtonGroup.style.border = '2px solid #ef4444';
                    genderButtonGroup.style.borderRadius = '0.5rem';
                } else {
                    genderButtonGroup.style.border = '';
                }
            }

            // Âπ¥ÈΩ¢
            const ageSelect = document.getElementById('ageSelect');
            const ageButtonGroup = document.getElementById('ageButtonGroup');
            if (ageSelect && ageButtonGroup) {
                if (!ageSelect.value || ageSelect.value.trim() === '') {
                    ageButtonGroup.style.border = '2px solid #ef4444';
                    ageButtonGroup.style.borderRadius = '0.5rem';
                } else {
                    ageButtonGroup.style.border = '';
                }
            }

            // ‰ªñÁ§æË¶ãÁ©ç„ÇÇ„ÇäÊï∞„Åå„Äå„Å™„Åó„Äç„ÅÆÂ†¥Âêà„ÄÅË¶ãÁ©ç„ÇÇ„ÇäÂèñÂæóÂÖà„Å®Ë®™ÂïèÊ•≠ËÄÖ„ÅÆÁä∂Ê≥Å„ÅÆËµ§Êû†„ÇíËß£Èô§
            const quoteCountSelect = document.getElementById('quoteCountSelect');
            if (quoteCountSelect && quoteCountSelect.value === '„Å™„Åó') {
                const quoteSourceInput = document.getElementById('quoteSourceInput');
                const doorSalesVisitSelect = document.getElementById('doorSalesVisitSelect');

                if (quoteSourceInput) {
                    quoteSourceInput.classList.remove('border-red-500');
                    quoteSourceInput.classList.add('border-gray-300');
                    quoteSourceInput.style.borderWidth = '';
                }

                if (doorSalesVisitSelect) {
                    doorSalesVisitSelect.classList.remove('border-red-500');
                    doorSalesVisitSelect.classList.add('border-gray-300');
                    doorSalesVisitSelect.style.borderWidth = '';
                }
            }

            // ÊñΩÂ∑•ÂõûÊï∞„Åå„Äå‰ªäÂõû„ÅåÂàù„ÇÅ„Å¶„Äç„ÅÆÂ†¥Âêà„ÄÅÂâçÂõûÊñΩÂ∑•ÊôÇÊúü„ÅÆËµ§Êû†„ÇíËß£Èô§
            const constructionCountSelect = document.getElementById('constructionCountSelect');
            if (constructionCountSelect && constructionCountSelect.value === '‰ªäÂõû„ÅåÂàù„ÇÅ„Å¶') {
                const previousConstructionSelect = document.getElementById('previousConstructionSelect');

                if (previousConstructionSelect) {
                    previousConstructionSelect.classList.remove('border-red-500');
                    previousConstructionSelect.classList.add('border-gray-300');
                    previousConstructionSelect.style.borderWidth = '';
                }
            }

            // ÁèæË™øÊó•ÊôÇÔºà„Éú„Çø„É≥„Ç∞„É´„Éº„ÉóÔºâ
            const surveyDateTimeButtonGroup = document.getElementById('surveyDateTimeButtonGroup');
            if (surveyDateTimeButtonGroup) {
                const selectedButtons = surveyDateTimeButtonGroup.querySelectorAll('.option-button.selected');
                if (selectedButtons.length === 0) {
                    // Êú™ÈÅ∏Êäû„ÅÆÂ†¥Âêà„ÅØËµ§Êû†
                    surveyDateTimeButtonGroup.style.border = '2px solid #ef4444';
                    surveyDateTimeButtonGroup.style.borderRadius = '0.5rem';
                } else {
                    // ÈÅ∏ÊäûÊ∏à„Åø„ÅÆÂ†¥Âêà„ÅØËµ§Êû†„ÇíËß£Èô§
                    surveyDateTimeButtonGroup.style.border = '';
                }
            }

            console.log('[validateEmptyFields] Êú™ÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØÂÆå‰∫Ü');
        }


        // „Çª„É¨„ÇØ„Éà„Éú„ÉÉ„ÇØ„Çπ„ÅÆÂÄ§„ÇíË®≠ÂÆö„Åô„Çã„Éò„É´„Éë„ÉºÈñ¢Êï∞
        function setSelectValue(labelText, value) {
            if (!value) return; // ÂÄ§„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„Çπ„Ç≠„ÉÉ„Éó

            const labels = document.querySelectorAll('label');
            for (let label of labels) {
                if (label.textContent.includes(labelText)) {
                    const select = label.parentElement.querySelector('select');
                    if (select) {
                        for (let option of select.options) {
                            if (option.text === value || option.value === value) {
                                option.selected = true;
                                break;
                            }
                        }
                    }
                    break;
                }
            }
        }

        // datalist‰ªò„ÅçinputÔºà„Åæ„Åü„ÅØselectÔºâ„ÅÆÂÄ§„ÇíË®≠ÂÆö„Åô„Çã„Éò„É´„Éë„ÉºÈñ¢Êï∞
        function setInputOrDatalistValue(labelText, value) {
            if (!value) return; // ÂÄ§„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„Çπ„Ç≠„ÉÉ„Éó

            const labels = document.querySelectorAll('label');
            for (let label of labels) {
                if (label.textContent.includes(labelText)) {
                    // datalist‰ªò„Åçinput„ÇíÊé¢„Åô
                    const input = label.parentElement.querySelector('input[list]');
                    if (input) {
                        input.value = value;
                        return;
                    }

                    // ÈÄöÂ∏∏„ÅÆinput„ÇíÊé¢„Åô
                    const textInput = label.parentElement.querySelector('input[type="text"]');
                    if (textInput) {
                        textInput.value = value;
                        return;
                    }

                    // select„ÇÇÊé¢„ÅôÔºà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºâ
                    const select = label.parentElement.querySelector('select');
                    if (select) {
                        for (let option of select.options) {
                            if (option.text === value || option.value === value) {
                                option.selected = true;
                                break;
                            }
                        }
                        return;
                    }
                    break;
                }
            }
        }

        // Ê§úÁ¥¢„Éª„Éï„Ç£„É´„Çø„ÉºÊ©üËÉΩ
        function initializeSearchAndFilter() {
            const searchInput = document.getElementById('searchInput');
            const statusFilters = document.querySelectorAll('.status-filter');
            const sortSelect = document.getElementById('sortSelect');
            
            // Ê§úÁ¥¢Ê©üËÉΩ
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    filterCases();
                });
            }
            
            // „Çπ„ÉÜ„Éº„Çø„Çπ„Éï„Ç£„É´„Çø„Éº
            if (statusFilters) {
                statusFilters.forEach(button => {
                    button.addEventListener('click', function() {
                        // „Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÅÆÂàá„ÇäÊõø„Åà
                        statusFilters.forEach(btn => {
                            btn.classList.remove('active', 'bg-blue-600', 'text-white');
                            btn.classList.add('bg-gray-200', 'text-gray-700');
                        });
                        this.classList.add('active', 'bg-blue-600', 'text-white');
                        this.classList.remove('bg-gray-200', 'text-gray-700');
                        
                        filterCases();
                    });
                });
            }
            
            // „ÇΩ„Éº„ÉàÊ©üËÉΩ
            if (sortSelect) {
                sortSelect.addEventListener('change', function() {
                    filterCases();
                });
            }
        }
        
        // „Çπ„ÉÜ„Éº„Çø„Çπ„Åß„Éï„Ç£„É´„Çø„É™„É≥„Ç∞ÔºàÁµ±Ë®à„ÇØ„É™„ÉÉ„ÇØÁî®Ôºâ
        function filterByStatus(status) {
            // Êñ∞Ë¶èÊ°à‰ª∂„ÅÆ„ÅøË°®Á§∫
            filterBySpecificStatus('Êñ∞Ë¶è');
        }
        
        // ÂØæÂøú‰∏≠ÂÑ™ÂÖàÈ†Ü„Åß„ÇΩ„Éº„ÉàÔºàË¶ãËæº„Åø‚ÜíÂÜçÊû∂Èõª‚Üí‰∏çÂú®Ôºâ
        
        // Êñ∞Ë¶è„Éú„Çø„É≥„ÅÆ„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
        function filterByNewStatus() {
            if (currentView !== 'list') {
                switchView('list');
            }
            
            currentStatusFilter = 'Êñ∞Ë¶è';
            initializeListView();
        }
        
        // Ë¶ãËæº„Åø„ÇΩ„Éº„ÉàÔºàË¶ãËæº„Åø„ÅÆ„ÅøÔºâ
        function filterByProspect() {
            // „É™„Çπ„Éà„Éì„É•„Éº„Å´Âàá„ÇäÊõø„Åà
            if (currentView !== 'list') {
                switchView('list');
            }

            const tbody = document.getElementById('casesListBody');
            tbody.innerHTML = '';

            // Ë¶ãËæº„ÅøÊ°à‰ª∂„ÅÆ„Åø„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            const filteredCases = Object.entries(casesData)
                .filter(([_, caseData]) => {
                    return caseData.status === 'Ë¶ãËæº„Åø';
                })
                .sort((a, b) => {
                    // Êñ∞„Åó„ÅÑÈ†Ü„Å´‰∏¶„Åπ„Çã
                    return new Date(b[1].date || Date.now()) - new Date(a[1].date || Date.now());
                });
            
            // „Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Åó„ÅüÊ°à‰ª∂„ÇíË°®Á§∫
            filteredCases.forEach(([caseId, caseData]) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 cursor-pointer';
                row.ondblclick = () => openCRM(caseId);
                row.innerHTML = `
                    <td class="px-3 py-4 whitespace-nowrap">
                        <input type="checkbox" class="rounded text-blue-600" onchange="updateSelectedCount()">
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs rounded-full ${getStatusColor(caseData.status)}">
                            ${caseData.status}
                        </span>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap font-medium text-gray-900">
                        ${caseData.name}
                    </td>
                    <td class="px-4 py-4 text-center">
                        <div class="flex justify-center items-center space-x-2">
                            <button onclick="event.stopPropagation(); window.location.href='tel:${caseData.phone}'" class="text-xl hover:scale-110 transition-transform" title="ÈõªË©±">
                                üìû
                            </button>
                            <button onclick="event.stopPropagation(); window.location.href='sms:${caseData.phone}'" class="text-xl hover:scale-110 transition-transform" title="SMS">
                                üí¨
                            </button>
                            <button onclick="event.stopPropagation(); sendData('${caseId}')" class="text-xl hover:scale-110 transition-transform" title="ÈÄÅ‰ø°">
                                üì§
                            </button>
                            <button onclick="event.stopPropagation(); quickActionList('‰∏çÂú®', '${caseId}')" class="px-2 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600">
                                ‰∏çÂú®
                            </button>
                            <button onclick="event.stopPropagation(); openCallHistoryModal('${caseId}')" class="text-xl hover:scale-110 transition-transform" title="„É°„É¢">
                                üìù
                            </button>
                        </div>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-gray-600">
                        <div class="relative group">
                            <div class="cursor-pointer" onclick="event.stopPropagation(); toggleWorkDetails('${caseId}')">
                                ${getPropertyIcon(caseData.propertyType)} ${getFloorDisplay(caseData.propertyType, caseData.floors)}
                            </div>
                            <!-- ÊñΩÂ∑•ÂÜÖÂÆπ„ÅÆË©≥Á¥∞Ë°®Á§∫ -->
                            <div id="work-details-${caseId}" class="absolute bottom-full left-0 mb-2 hidden group-hover:block z-50">
                                <div class="bg-gray-900 text-white text-xs rounded-lg py-2 px-3 max-w-xs">
                                    <div class="font-semibold mb-1">ÊñΩÂ∑•ÂÜÖÂÆπ:</div>
                                    ${caseData.workItems ? caseData.workItems.map(item => `<div>‚Ä¢ ${item}</div>`).join('') : 'Êú™Ë®≠ÂÆö'}
                                    <div class="absolute top-full left-4 -mt-1">
                                        <div class="border-4 border-transparent border-t-gray-900"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-gray-900 font-medium">
                        ${caseData.amount.replace('¬•', '¬•').replace(',000', 'K')}
                    </td>
                    <td class="px-3 py-4 whitespace-nowrap text-center">
                        <button onclick="event.stopPropagation(); openCRM('${caseId}')" class="text-blue-600 hover:text-blue-800">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ÂØæÂøú‰∏≠„ÇΩ„Éº„ÉàÔºà1„É∂Êúà‰ª•ÂÜÖ„ÅÆ‰∏çÂú®„ÉªÂÜçÊû∂Èõª„ÇíÊñ∞„Åó„ÅÑÈ†ÜÔºâ
        function filterByAbsent() {
            // „É™„Çπ„Éà„Éì„É•„Éº„Å´Âàá„ÇäÊõø„Åà
            if (currentView !== 'list') {
                switchView('list');
            }

            const oneMonthAgo = new Date();
            oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
            const tbody = document.getElementById('casesListBody');
            tbody.innerHTML = '';

            // 1„É∂Êúà‰ª•ÂÜÖ„ÅÆ‰∏çÂú®„ÉªÂÜçÊû∂ÈõªÊ°à‰ª∂„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞ÔºàÊµÅÂÖ•Êó•„Åã„ÇâËµ∑ÁÆóÔºâ
            const filteredCases = Object.entries(casesData)
                .filter(([_, caseData]) => {
                    if (caseData.status !== '‰∏çÂú®' && caseData.status !== 'ÂÜçÊû∂Èõª') return false;
                    const caseDate = new Date(caseData.date || Date.now());
                    return caseDate >= oneMonthAgo;
                })
                .sort((a, b) => {
                    // Êñ∞„Åó„ÅÑÈ†Ü„Å´‰∏¶„Åπ„Çã
                    return new Date(b[1].date || Date.now()) - new Date(a[1].date || Date.now());
                });
            
            // „Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Åó„ÅüÊ°à‰ª∂„ÇíË°®Á§∫
            filteredCases.forEach(([caseId, caseData]) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 cursor-pointer';
                row.ondblclick = () => openCRM(caseId);
                row.innerHTML = `
                    <td class="px-3 py-4 whitespace-nowrap">
                        <input type="checkbox" class="rounded text-blue-600" onchange="updateSelectedCount()">
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs rounded-full ${getStatusColor(caseData.status)}">
                            ${caseData.status}
                        </span>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap font-medium text-gray-900">
                        ${caseData.name}
                    </td>
                    <td class="px-4 py-4 text-center">
                        <div class="flex justify-center items-center space-x-2">
                            <button onclick="event.stopPropagation(); window.location.href='tel:${caseData.phone}'" class="text-xl hover:scale-110 transition-transform" title="ÈõªË©±">
                                üìû
                            </button>
                            <button onclick="event.stopPropagation(); window.location.href='sms:${caseData.phone}'" class="text-xl hover:scale-110 transition-transform" title="SMS">
                                üí¨
                            </button>
                            <button onclick="event.stopPropagation(); sendData('${caseId}')" class="text-xl hover:scale-110 transition-transform" title="ÈÄÅ‰ø°">
                                üì§
                            </button>
                            <button onclick="event.stopPropagation(); quickActionList('‰∏çÂú®', '${caseId}')" class="px-2 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600">
                                ‰∏çÂú®
                            </button>
                            <button onclick="event.stopPropagation(); openCallHistoryModal('${caseId}')" class="text-xl hover:scale-110 transition-transform" title="„É°„É¢">
                                üìù
                            </button>
                        </div>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-gray-600">
                        <div class="relative group">
                            <div class="cursor-pointer" onclick="event.stopPropagation(); toggleWorkDetails('${caseId}')">
                                ${getPropertyIcon(caseData.propertyType)} ${getFloorDisplay(caseData.propertyType, caseData.floors)}
                            </div>
                            <!-- ÊñΩÂ∑•ÂÜÖÂÆπ„ÅÆË©≥Á¥∞Ë°®Á§∫ -->
                            <div id="work-details-${caseId}" class="absolute bottom-full left-0 mb-2 hidden group-hover:block z-50">
                                <div class="bg-gray-900 text-white text-xs rounded-lg py-2 px-3 max-w-xs">
                                    <div class="font-semibold mb-1">ÊñΩÂ∑•ÂÜÖÂÆπ:</div>
                                    ${caseData.workItems ? caseData.workItems.map(item => `<div>‚Ä¢ ${item}</div>`).join('') : 'Êú™Ë®≠ÂÆö'}
                                    <div class="absolute top-full left-4 -mt-1">
                                        <div class="border-4 border-transparent border-t-gray-900"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-gray-900 font-medium">
                        ${caseData.amount.replace('¬•', '¬•').replace(',000', 'K')}
                    </td>
                    <td class="px-3 py-4 whitespace-nowrap text-center">
                        <button onclick="event.stopPropagation(); openCRM('${caseId}')" class="text-blue-600 hover:text-blue-800">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function filterByPriority() {
            // ÂæåÊñπ‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅÊÆã„Åô
            filterByProspect();
        }
        
        // „ÇΩ„Éº„Éà„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
        function openSortModal() {
            document.getElementById('sortModal').classList.remove('hidden');
            // „Éú„Çø„É≥„ÅÆÈÅ∏ÊäûÁä∂ÊÖã„ÇíÂàùÊúüÂåñ
            updateStatusButtonStates();
            // ÈÅ∏ÊäûÊï∞„ÇíÊõ¥Êñ∞
            updateSelectedCount();
        }
        
        // „ÇΩ„Éº„Éà„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeSortModal() {
            document.getElementById('sortModal').classList.add('hidden');
        }
        
        // ÈÅ∏Êäû‰∏≠„ÅÆ„Çπ„ÉÜ„Éº„Çø„ÇπÔºàË§áÊï∞ÈÅ∏ÊäûÂØæÂøúÔºâ
        let selectedStatuses = [];

        // ÁâπÂÆö„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Åß„Éï„Ç£„É´„Çø„É™„É≥„Ç∞ÔºàË§áÊï∞ÈÅ∏ÊäûÂØæÂøúÔºâ
        function filterBySpecificStatus(status) {
            // „É™„Çπ„Éà„Éì„É•„Éº„Å´Âàá„ÇäÊõø„Åà
            if (currentView !== 'list') {
                switchView('list');
            }

            // „Éà„Ç∞„É´Âãï‰ΩúÔºö„Åô„Åß„Å´ÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åü„ÇâËß£Èô§„ÄÅ„Åï„Çå„Å¶„ÅÑ„Å™„Åë„Çå„Å∞ËøΩÂä†
            const index = selectedStatuses.indexOf(status);
            if (index > -1) {
                selectedStatuses.splice(index, 1);
            } else {
                selectedStatuses.push(status);
            }

            // „Éú„Çø„É≥„ÅÆË¶ã„ÅüÁõÆ„ÇíÊõ¥Êñ∞
            updateStatusButtonStates();

            // ÈÅ∏ÊäûÊï∞„ÇíÊõ¥Êñ∞
            updateSelectedCount();

            // „Éï„Ç£„É´„Çø„É™„É≥„Ç∞ÂÆüË°å
            applyStatusFilter();
        }

        // „Çπ„ÉÜ„Éº„Çø„Çπ„Éú„Çø„É≥„ÅÆÈÅ∏ÊäûÁä∂ÊÖã„ÇíÊõ¥Êñ∞
        function updateStatusButtonStates() {
            const buttons = document.querySelectorAll('#sortModal button[onclick*="filterBySpecificStatus"]');
            buttons.forEach(button => {
                const onclick = button.getAttribute('onclick');
                const match = onclick.match(/filterBySpecificStatus\('([^']+)'\)/);
                if (match) {
                    const status = match[1];
                    if (selectedStatuses.includes(status)) {
                        // ÈÅ∏Êäû‰∏≠ÔºöÊøÉ„ÅÑËâ≤
                        button.style.opacity = '1';
                        button.style.transform = 'scale(0.95)';
                        button.style.boxShadow = '0 0 0 3px rgba(59, 130, 246, 0.5)';
                    } else {
                        // Êú™ÈÅ∏ÊäûÔºöËñÑ„ÅÑËâ≤
                        button.style.opacity = '0.6';
                        button.style.transform = 'scale(1)';
                        button.style.boxShadow = '';
                    }
                }
            });
        }

        // „Çπ„ÉÜ„Éº„Çø„Çπ„Éï„Ç£„É´„Çø„ÇíÈÅ©Áî®ÔºàË§áÊï∞ORÊù°‰ª∂Ôºâ
        function applyStatusFilter() {
            initializeListView(); // „Åæ„Åö„Åô„Åπ„Å¶„ÅÆÊ°à‰ª∂„ÇíË°®Á§∫

            // ‰Ωï„ÇÇÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØ„Åô„Åπ„Å¶Ë°®Á§∫
            if (selectedStatuses.length === 0) {
                return;
            }

            // ÈÅ∏Êäû„Åï„Çå„Åü„Çπ„ÉÜ„Éº„Çø„Çπ„ÅÆ„ÅÑ„Åö„Çå„Åã„Å´‰∏ÄËá¥„Åô„ÇãÊ°à‰ª∂„ÅÆ„ÅøË°®Á§∫
            const rows = document.querySelectorAll('#casesListBody tr');
            rows.forEach(row => {
                const statusElement = row.querySelector('td:nth-child(2) span');
                const rowStatus = statusElement?.textContent.trim() || '';

                if (selectedStatuses.includes(rowStatus)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // ÈÅ∏ÊäûÊï∞„ÇíÊõ¥Êñ∞
        function updateSelectedCount() {
            const countElement = document.getElementById('selectedStatusCount');
            if (countElement) {
                if (selectedStatuses.length === 0) {
                    countElement.textContent = '„Åô„Åπ„Å¶Ë°®Á§∫‰∏≠';
                    countElement.className = 'text-sm text-gray-500';
                } else {
                    countElement.textContent = `${selectedStatuses.length}‰ª∂ÈÅ∏Êäû‰∏≠`;
                    countElement.className = 'text-sm text-blue-600 font-semibold';
                }
            }
        }

        // Ê°à‰ª∂„Éï„Ç£„É´„Çø„É™„É≥„Ç∞Ê©üËÉΩ
        function filterCases() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const activeStatus = document.querySelector('.status-filter.active')?.dataset.status || 'all';
            const sortOption = document.getElementById('sortSelect').value;
            
            // „É™„Çπ„Éà„Éì„É•„Éº„ÅÆË°å„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            const rows = document.querySelectorAll('#casesListBody tr');
            rows.forEach(row => {
                const name = row.querySelector('td:nth-child(3)')?.textContent.toLowerCase() || '';
                const phone = row.querySelector('td:nth-child(4)')?.textContent || '';
                const address = row.querySelector('td:nth-child(5)')?.textContent.toLowerCase() || '';
                const statusElement = row.querySelector('td:nth-child(2) span');
                const status = statusElement?.textContent.trim() || '';
                
                const matchesSearch = searchTerm === '' || 
                    name.includes(searchTerm) || 
                    phone.includes(searchTerm) || 
                    address.includes(searchTerm);
                
                const matchesStatus = activeStatus === 'all' || 
                    (activeStatus === 'new' && status === 'Êñ∞Ë¶è') ||
                    (activeStatus === 'distributing' && status === 'ÈÖç‰ø°‰∏≠') ||
                    (activeStatus === 'distributed' && status === 'ÈÖç‰ø°Ê∏à') ||
                    (activeStatus === 'completed' && status === 'ÂÆå‰∫Ü');
                
                if (matchesSearch && matchesStatus) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        // „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„ÅüËâ≤„ÇíËøî„Åô„Éò„É´„Éë„ÉºÈñ¢Êï∞Ôºà„Çµ„Éº„É¢„Ç∞„É©„Éï„Ç£„ÉºÊ∏©Â∫¶ÊÑüÔºâ
        // ÂÜ∑„Åü„ÅÑÔºàÁ¢∫Â∫¶‰ΩéÔºâ‚Üí Èùí„Éª„Ç∞„É¨„Éº„ÄÅÊ∏©„Åã„ÅÑÔºàÁ¢∫Â∫¶‰∏≠Ôºâ‚Üí ÈªÑËâ≤„ÄÅÁÜ±„ÅÑÔºàÁ¢∫Â∫¶È´òÔºâ‚Üí „Ç™„É¨„É≥„Ç∏„ÉªËµ§
        // Âä†ÁõüÂ∫óÁÆ°ÁêÜ„Å®Áµ±‰∏ÄÔºöÂ§ñÊû†ÔºàÊøÉ„ÅÑËâ≤Ôºâ+ ËñÑ„ÅÑËÉåÊôØ + ÊøÉ„ÅÑÊñáÂ≠ó
        function getStatusColor(status) {
            const colorMap = {
                // ÁÆ°ÁêÜ„Çπ„ÉÜ„Éº„Çø„ÇπÔºàÊ∏©Â∫¶ÊÑü„ÅßÁ¢∫Â∫¶„ÇíË°®ÁèæÔºâ
                'Êñ∞Ë¶è': 'border-2 border-blue-500 bg-blue-100 text-blue-800',           // ÂÜ∑„Åü„ÅÑÔºàÂßã„Åæ„Å£„Åü„Å∞„Åã„ÇäÔºâ
                '‰∏çÂú®': 'border-2 border-gray-500 bg-gray-100 text-gray-800',           // ÂÜ∑„Åü„ÅÑÔºàÊé•Ëß¶„Åß„Åç„Å¶„ÅÑ„Å™„ÅÑÔºâ
                'ÂÜçÊû∂Èõª': 'border-2 border-yellow-500 bg-yellow-100 text-yellow-800',   // Ê∏©„Åã„ÅÑÔºàÂÜçÂ∫¶„Ç¢„Éó„É≠„Éº„ÉÅÔºâ
                'Ë¶ãËæº„Åø': 'border-2 border-orange-600 bg-orange-100 text-orange-800',   // ÁÜ±„ÅÑÔºàÁ¢∫Â∫¶È´ò„ÅÑÔºâ
                '„É≠„Çπ„Éà': 'border-2 border-indigo-500 bg-indigo-100 text-indigo-800',   // ÂÜ∑„ÇÅ„ÅüÔºàÁµÇ‰∫ÜÔºâ
                'ÈÖç‰ø°‰∏≠': 'border-2 border-amber-600 bg-amber-100 text-amber-800',      // ÁÜ±„ÅÑÔºàÈÄ≤Ë°å‰∏≠Ôºâ
                'ÈÖç‰ø°Ê∏à': 'border-2 border-green-600 bg-green-100 text-green-800',      // ÊàêÂäüÔºàÂÆå‰∫ÜÔºâ
                '‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à': 'border-2 border-slate-500 bg-slate-100 text-slate-800',  // ÂÜ∑„Åü„ÅÑÔºàÁµÇ‰∫ÜÔºâ
                'ÁÑ°Âäπ': 'border-2 border-gray-600 bg-gray-100 text-gray-800',           // ÂÜ∑„Åü„ÅÑÔºàÁÑ°ÂäπÔºâ
                '„ÇØ„É¨„Éº„É†': 'border-2 border-red-700 bg-red-100 text-red-800',          // ÂïèÈ°åÔºàË¶ÅÊ≥®ÊÑèÔºâ
                // ÈÖç‰ø°Âæå„Çπ„ÉÜ„Éº„Çø„ÇπÔºàÊ∏©Â∫¶ÊÑüÔºöÈÄ≤Â±ïÂ∫¶Âêà„ÅÑÔºâ
                '„Ç¢„ÉùÊ∏à': 'border-2 border-orange-500 bg-orange-100 text-orange-800',        // ÁÜ±„ÅÑÔºàÁ¢∫Â∫¶‰∏ä„Åå„ÇãÔºâ
                'ÁèæË™øÊ∏à': 'border-2 border-orange-600 bg-orange-100 text-orange-900',        // „Åï„Çâ„Å´ÁÜ±„ÅÑÔºàÁ¢∫Â∫¶È´ò„ÅÑÔºâ
                'Ë¶ãÁ©çÊèêÂá∫Ê∏à': 'border-2 border-red-600 bg-red-100 text-red-800',             // ÈùûÂ∏∏„Å´ÁÜ±„ÅÑÔºàÁ¢∫Â∫¶ÈùûÂ∏∏„Å´È´ò„ÅÑÔºâ
                'ÂÖ•Èáë‰∫àÂÆö': 'border-2 border-red-700 bg-red-100 text-red-900',               // ÊúÄÈ´òÊ∏©Â∫¶Ôºà„Åª„ÅºÁ¢∫ÂÆöÔºâ
                'ÂÖ•ÈáëÂÆå‰∫Ü': 'border-2 border-purple-700 bg-purple-100 text-purple-800',      // Â•ëÁ¥ÑÈáëÂÖ•ÈáëÂÆå‰∫ÜÔºàË´ãÊ±ÇÊõ∏Áô∫Ë°åÔºâ
                'ÂÆå‰∫Ü': 'border-2 border-green-700 bg-green-100 text-green-900',             // ÊàêÂäüÔºàÂÆå‰∫ÜÔºâ
                'Á¥π‰ªãÂæå„Ç≠„É£„É≥„Çª„É´': 'border-2 border-cyan-600 bg-cyan-100 text-cyan-800',    // ÂÜ∑„ÇÅ„ÅüÔºàÊÆãÂøµÔºâ
                'ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´': 'border-2 border-blue-600 bg-blue-100 text-blue-800',    // ÂÜ∑„ÇÅ„ÅüÔºàÊÆãÂøµÔºâ
                'ÁèæË™øÂæå„É≠„Çπ„Éà': 'border-2 border-indigo-600 bg-indigo-100 text-indigo-800'   // ÂÜ∑„ÇÅ„ÅüÔºàÂ§±ÊïóÔºâ
            };
            return colorMap[status] || 'border-2 border-gray-500 bg-gray-100 text-gray-800';
        }

        // Áµ±Ë®à„Ç´„Ç¶„É≥„Éà„ÇíÊõ¥Êñ∞
        function updateStatsCounts() {
            // Êñ∞Ë¶è‰ª∂Êï∞
            const newCount = Object.values(casesData).filter(c => c.status === 'Êñ∞Ë¶è').length;
            document.getElementById('newCount').textContent = newCount;
            
            // Ë¶ãËæº„Åø‰ª∂Êï∞ÔºàÂÜçÊû∂Èõª„ÅØÈô§Â§ñÔºâ
            const prospectCount = Object.values(casesData).filter(c => c.status === 'Ë¶ãËæº„Åø').length;
            document.getElementById('prospectCount').textContent = prospectCount;
            
            // Áõ¥Ëøë1„É∂Êúà„ÅÆ‰∏çÂú®„ÉªÂÜçÊû∂Èõª‰ª∂Êï∞ÔºàÊµÅÂÖ•Êó•„Åã„ÇâËµ∑ÁÆóÔºâ
            const oneMonthAgo = new Date();
            oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
            const absentCount = Object.values(casesData).filter(c => {
                if (c.status !== '‰∏çÂú®' && c.status !== 'ÂÜçÊû∂Èõª') return false;
                const caseDate = new Date(c.date || Date.now());
                return caseDate >= oneMonthAgo;
            }).length;
            document.getElementById('absentCount').textContent = absentCount;
        }

        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ãÂá¶ÁêÜ„É¢„Éº„ÉÄ„É´
        function showCancelRequest(caseId) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üö® „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ãÂá¶ÁêÜ</h3>
                    <div class="bg-purple-50 p-4 rounded-lg mb-4">
                        <p class="text-sm text-gray-700 mb-2"><strong>Ê°à‰ª∂ID:</strong> ${caseId}</p>
                        <p class="text-sm text-gray-700 mb-2"><strong>Âä†ÁõüÂ∫ó:</strong> Áî∞‰∏≠Â°óË£ÖÂ∑•Ê•≠</p>
                        <p class="text-sm text-gray-700 mb-2"><strong>ÁêÜÁî±:</strong> ÂØæÂøú‰∏çÂèØ„ÅÆ„Åü„ÇÅËæûÈÄÄ</p>
                        <p class="text-sm text-gray-700"><strong>Áî≥Ë´ãÊó•ÊôÇ:</strong> 2025-01-12 14:30</p>
                    </div>
                    
                    <div class="flex gap-3">
                        <button onclick="processCancelRequest('${caseId}')" class="flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                            ÊâøË™ç
                        </button>
                        <button onclick="rejectCancelRequest('${caseId}')" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            Âç¥‰∏ã
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function processCancelRequest(caseId) {
            if (confirm('„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÇíÊâøË™ç„Åó„Åæ„Åô„ÅãÔºü')) {
                alert(`Ê°à‰ª∂ ${caseId} „ÅÆ„Ç≠„É£„É≥„Çª„É´„ÇíÊâøË™ç„Åó„Åæ„Åó„Åü„ÄÇ`);
                document.querySelector('.fixed').remove();
                updateCancelRequestCount(-1);
            }
        }

        function rejectCancelRequest(caseId) {
            if (confirm('„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÇíÂç¥‰∏ã„Åó„Åæ„Åô„ÅãÔºü')) {
                alert(`Ê°à‰ª∂ ${caseId} „ÅÆ„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÇíÂç¥‰∏ã„Åó„Åæ„Åó„Åü„ÄÇ\n\nÂä†ÁõüÂ∫ó„Å´ÈÄöÁü•„ÇíÈÄÅ‰ø°„Åó„Åæ„Åô„ÄÇ`);
                document.querySelector('.fixed').remove();
                updateCancelRequestCount(-1);
            }
        }
        
        function updateCancelRequestCount(change) {
            const badge = document.getElementById('cancelRequestBadge');
            if (badge) {
                const currentCount = parseInt(badge.querySelector('span').textContent) || 0;
                const newCount = Math.max(0, currentCount + change);
                if (newCount > 0) {
                    badge.querySelector('span').textContent = newCount;
                } else {
                    badge.style.display = 'none';
                }
            }
        }
        
        // Âä†ÁõüÂ∫óÁôªÈå≤Áî≥Ë´ã„ÇíÊâøË™ç
        function approveRegistration(registrationId) {
            if (confirm(`Áî≥Ë´ãID: ${registrationId} „ÇíÊâøË™ç„Åó„Åæ„Åô„ÅãÔºü`)) {
                // ÊâøË™çÂá¶ÁêÜÔºàÂÆüÈöõ„ÅØAPI„Ç≥„Éº„É´Ôºâ
                console.log(`ÊâøË™çÂá¶ÁêÜ: ${registrationId}`);

                // ÊàêÂäüÈÄöÁü•„ÇíË°®Á§∫
                const notification = document.createElement('div');
                notification.className = 'fixed top-20 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center';
                notification.innerHTML = `
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    Áî≥Ë´ã„ÇíÊâøË™ç„Åó„Åæ„Åó„Åü
                `;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);

                // Ë©≤ÂΩìË°å„ÇíÂâäÈô§„Åæ„Åü„ÅØÊõ¥Êñ∞ÔºàÂÆüÈöõ„ÅØÂÜçË™≠„ÅøËæº„ÅøÔºâ
                location.reload();
            }
        }

        // Âä†ÁõüÂ∫óÁôªÈå≤Áî≥Ë´ã„ÇíÂç¥‰∏ã
        function rejectRegistration(registrationId) {
            const reason = prompt(`Áî≥Ë´ãID: ${registrationId} „ÇíÂç¥‰∏ã„Åô„ÇãÁêÜÁî±„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö`);
            if (reason) {
                // Âç¥‰∏ãÂá¶ÁêÜÔºàÂÆüÈöõ„ÅØAPI„Ç≥„Éº„É´Ôºâ
                console.log(`Âç¥‰∏ãÂá¶ÁêÜ: ${registrationId}, ÁêÜÁî±: ${reason}`);

                // ÊàêÂäüÈÄöÁü•„ÇíË°®Á§∫
                const notification = document.createElement('div');
                notification.className = 'fixed top-20 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center';
                notification.innerHTML = `
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                    Áî≥Ë´ã„ÇíÂç¥‰∏ã„Åó„Åæ„Åó„Åü
                `;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);

                // Ë©≤ÂΩìË°å„ÇíÂâäÈô§„Åæ„Åü„ÅØÊõ¥Êñ∞ÔºàÂÆüÈöõ„ÅØÂÜçË™≠„ÅøËæº„ÅøÔºâ
                location.reload();
            }
        }

        // ÈõªË©±„Çí„Åã„Åë„Çã
        function callRegistration(phoneNumber) {
            console.log(`ÈõªË©±Áï™Âè∑: ${phoneNumber}`);
            // ÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Åß„ÅØÈõªË©±„Ç¢„Éó„É™„ÇíËµ∑Âãï
            window.location.href = `tel:${phoneNumber}`;
        }

        // „É°„Éº„É´„ÇíÈÄÅ‰ø°
        function emailRegistration(email) {
            console.log(`„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ: ${email}`);
            // „É°„Éº„É´„ÇØ„É©„Ç§„Ç¢„É≥„Éà„ÇíËµ∑Âãï
            window.location.href = `mailto:${email}`;
        }

        // SNSÈÄ£Áµ°
        function snsRegistration(registrationId) {
            console.log(`SNSÈÄ£Áµ°: ${registrationId}`);
            // ÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Åß„ÅØSNS/„ÉÅ„É£„ÉÉ„Éà„ÉÑ„Éº„É´„Å®„ÅÆÈÄ£Êê∫
            alert(`SNS„ÅßÈÄ£Áµ°„Åó„Åæ„Åô: ${registrationId}`);
        }

        // Âä†ÁõüÂ∫óÁôªÈå≤Áî≥Ë´ãË©≥Á¥∞„É¢„Éº„ÉÄ„É´
        function showRegistrationDetail(registrationId) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üÜï Âä†ÁõüÂ∫óÁôªÈå≤Áî≥Ë´ãË©≥Á¥∞</h3>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="text-sm font-semibold text-gray-700 mb-3">‰ºöÁ§æÊÉÖÂ†±</h4>
                            <div class="space-y-2 text-sm">
                                <p><strong>‰ºöÁ§æÂêç:</strong> Ê†™Âºè‰ºöÁ§æ„Éö„Ç§„É≥„Éà„Éó„É≠</p>
                                <p><strong>‰ª£Ë°®ËÄÖ:</strong> ‰∏≠ÊùëÂ§™ÈÉé</p>
                                <p><strong>Ë®≠Á´ãÂπ¥:</strong> 2015Âπ¥</p>
                                <p><strong>Ë≥áÊú¨Èáë:</strong> 500‰∏áÂÜÜ</p>
                                <p><strong>ÂæìÊ•≠Âì°Êï∞:</strong> 8Âêç</p>
                                <p><strong>Âª∫Ë®≠Ê•≠Ë®±ÂèØ:</strong> Á•ûÂ•àÂ∑ùÁúåÁü•‰∫ãË®±ÂèØ(Ëà¨-30)Á¨¨12345Âè∑</p>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="text-sm font-semibold text-gray-700 mb-3">ÈÄ£Áµ°ÂÖàÊÉÖÂ†±</h4>
                            <div class="space-y-2 text-sm">
                                <p><strong>‰ΩèÊâÄ:</strong> Á•ûÂ•àÂ∑ùÁúåÂ∑ùÂ¥éÂ∏ÇÂπ∏Âå∫Â†ÄÂ∑ùÁî∫580</p>
                                <p><strong>ÈõªË©±:</strong> 044-123-4567</p>
                                <p><strong>„É°„Éº„É´:</strong> nakamura@paintpro.jp</p>
                                <p><strong>Web:</strong> https://paintpro.jp</p>
                                <p><strong>ÂØæÂøú„Ç®„É™„Ç¢:</strong> Â∑ùÂ¥éÂ∏Ç„ÄÅÊ®™ÊµúÂ∏ÇÈ∂¥Ë¶ãÂå∫</p>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="text-sm font-semibold text-gray-700 mb-3">ÂÆüÁ∏æÊÉÖÂ†±</h4>
                            <div class="space-y-2 text-sm">
                                <p><strong>Âπ¥ÈñìÊñΩÂ∑•‰ª∂Êï∞:</strong> 120‰ª∂</p>
                                <p><strong>‰∏ªË¶ÅÂèñÂºïÂÖà:</strong> Â§ßÂíå„Éè„Ç¶„Çπ„ÄÅÁ©çÊ∞¥„Éè„Ç¶„Çπ</p>
                                <p><strong>ÂæóÊÑèÂàÜÈáé:</strong> Êà∏Âª∫„Å¶Â§ñÂ£ÅÂ°óË£Ö„ÄÅÂ±ãÊ†πÂ°óË£Ö</p>
                                <p><strong>‰øùË®ºÂÜÖÂÆπ:</strong> 10Âπ¥‰øùË®º</p>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <h4 class="text-sm font-semibold text-gray-700 mb-3">Â∏åÊúõÊù°‰ª∂</h4>
                            <div class="space-y-2 text-sm">
                                <p><strong>Â∏åÊúõÁ¥π‰ªãÊï∞:</strong> ÊúàÈñì10‰ª∂Á®ãÂ∫¶</p>
                                <p><strong>ÂØæÂøúÂèØËÉΩÊó•:</strong> Âπ≥Êó•„ÉªÂúüÊõú</p>
                                <p><strong>ÁâπË®ò‰∫ãÈ†Ö:</strong> ÈõÜÂêà‰ΩèÂÆÖÂØæÂøúÂèØËÉΩ</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded-lg mb-6">
                        <h4 class="text-sm font-semibold text-green-800 mb-2">ÂØ©Êüª„ÉÅ„Çß„ÉÉ„ÇØ„É™„Çπ„Éà</h4>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <label class="flex items-center">
                                <input type="checkbox" checked class="mr-2">
                                <span>Âª∫Ë®≠Ê•≠Ë®±ÂèØÁ¢∫Ë™çÊ∏à„Åø</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" checked class="mr-2">
                                <span>‰øùÈô∫Âä†ÂÖ•Á¢∫Ë™çÊ∏à„Åø</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" checked class="mr-2">
                                <span>Ë≥áÊú¨ÈáëÁ¢∫Ë™çÊ∏à„Åø</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" checked class="mr-2">
                                <span>ÂÆüÁ∏æÁ¢∫Ë™çÊ∏à„Åø</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2">
                                <span>ÁèæÂú∞Á¢∫Ë™çÊ∏à„Åø</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2">
                                <span>‰∏é‰ø°Ë™øÊüªÊ∏à„Åø</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="flex gap-3">
                        <button onclick="approveRegistration('${registrationId}')" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                            ÊâøË™ç„Åó„Å¶„É°„Éº„É´ÈÄÅ‰ø°
                        </button>
                        <button onclick="rejectRegistration('${registrationId}')" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            Âç¥‰∏ã
                        </button>
                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                            Èñâ„Åò„Çã
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function approveRegistration(registrationId) {
            if (confirm('„Åì„ÅÆÁî≥Ë´ã„ÇíÊâøË™ç„Åó„Åæ„Åô„ÅãÔºü\n\nÊâøË™çÂæå„ÄÅÂàùÂõû„É≠„Ç∞„Ç§„É≥ÊÉÖÂ†±„Åå„É°„Éº„É´ÈÄÅ‰ø°„Åï„Çå„Åæ„Åô„ÄÇ')) {
                alert(`Áî≥Ë´ã ${registrationId} „ÇíÊâøË™ç„Åó„Åæ„Åó„Åü„ÄÇ\n\nÂä†ÁõüÂ∫óID: F033\nÂàùÂõû„É≠„Ç∞„Ç§„É≥ÊÉÖÂ†±„Çí„É°„Éº„É´ÈÄÅ‰ø°„Åó„Åæ„Åó„Åü„ÄÇ`);
                document.querySelector('.fixed').remove();
                updateRegistrationRequestCount(-1);
            }
        }
        
        function rejectRegistration(registrationId) {
            const reason = prompt('Âç¥‰∏ãÁêÜÁî±„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö');
            if (reason && confirm('Êú¨ÂΩì„Å´Âç¥‰∏ã„Åó„Åæ„Åô„ÅãÔºü')) {
                alert(`Áî≥Ë´ã ${registrationId} „ÇíÂç¥‰∏ã„Åó„Åæ„Åó„Åü„ÄÇ\n\nÁêÜÁî±: ${reason}\nÁî≥Ë´ãËÄÖ„Å´ÈÄöÁü•„ÇíÈÄÅ‰ø°„Åó„Åæ„Åô„ÄÇ`);
                document.querySelector('.fixed').remove();
                updateRegistrationRequestCount(-1);
            }
        }
        
        function updateRegistrationRequestCount(change) {
            const badge = document.getElementById('registrationRequestBadge');
            if (badge) {
                const currentCount = parseInt(badge.querySelector('span').textContent) || 0;
                const newCount = Math.max(0, currentCount + change);
                if (newCount > 0) {
                    badge.querySelector('span').textContent = newCount;
                } else {
                    badge.style.display = 'none';
                }
            }
        }
        
        // „É™„Çπ„Éà„Éì„É•„Éº„ÅÆÂàùÊúüÂåñ
        function initializeListView() {
            console.log('initializeListView called');
            console.log('casesData:', casesData);
            console.log('casesData keys:', Object.keys(casesData));

            const tbody = document.getElementById('casesListBody');
            if (!tbody) {
                console.error('casesListBody element not found!');
                return;
            }
            tbody.innerHTML = '';

            // 1. Ê§úÁ¥¢„Éï„Ç£„É´„Çø„ÇíÊúÄÂàù„Å´ÈÅ©Áî®
            let allCases = Object.entries(casesData);
            console.log('Total cases before filters:', allCases.length);

            const searchInput = document.getElementById('searchInput');
            const searchTerm = normalizeText(searchInput?.value || '');

            if (searchTerm) {
                // Ê§úÁ¥¢Êù°‰ª∂„Åß„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
                allCases = allCases.filter(([caseId, caseData]) => {
                    const searchableText = normalizeText(
                        JSON.stringify([
                            caseData.name || '',
                            caseData.kana || '',
                            caseData.phone || '',
                            caseData.address || '',
                            caseData.postalCode || '',
                            caseData.prefecture || '',
                            caseData.city || '',
                            caseData.status || ''
                        ])
                    );
                    return searchableText.includes(searchTerm);
                });
                console.log('Total cases after search filter:', allCases.length);
            }

            // 2. „Çπ„ÉÜ„Éº„Çø„Çπ„Éï„Ç£„É´„Çø„ÇíÈÅ©Áî®
            if (currentStatusFilter) {
                allCases = allCases.filter(([_, caseData]) => caseData.status === currentStatusFilter);
                console.log('Total cases after status filter:', allCases.length);
            }

            // „ÇΩ„Éº„ÉàÂá¶ÁêÜ
            const sortOption = document.getElementById('sortSelect')?.value || 'date-desc';
            allCases.sort(([idA, dataA], [idB, dataB]) => {
                if (sortOption === 'date-desc') {
                    // Êñ∞ÁùÄÈ†ÜÔºàID„ÅÆÈôçÈ†Ü„ÄÅ„Åæ„Åü„ÅØÁôªÈå≤Êó•ÊôÇ„ÅÆÈôçÈ†ÜÔºâ
                    const dateA = dataA.createdAt || dataA.date || idA;
                    const dateB = dataB.createdAt || dataB.date || idB;
                    return dateB > dateA ? 1 : -1;
                } else if (sortOption === 'date-asc') {
                    // Âè§„ÅÑÈ†ÜÔºàID„ÅÆÊòáÈ†Ü„ÄÅ„Åæ„Åü„ÅØÁôªÈå≤Êó•ÊôÇ„ÅÆÊòáÈ†ÜÔºâ
                    const dateA = dataA.createdAt || dataA.date || idA;
                    const dateB = dataB.createdAt || dataB.date || idB;
                    return dateA > dateB ? 1 : -1;
                } else if (sortOption === 'amount-desc') {
                    // ÈáëÈ°çÈ†ÜÔºàÈáëÈ°ç„ÅÆÈôçÈ†ÜÔºâ
                    const amountA = parseInt(dataA.amount?.replace(/[¬•K,]/g, '') || 0);
                    const amountB = parseInt(dataB.amount?.replace(/[¬•K,]/g, '') || 0);
                    return amountB - amountA;
                }
                return 0;
            });

            // ÂÖ®„Éá„Éº„Çø„ÇíÂèñÂæó
            // const allCases = Object.entries(casesData);
            const totalItems = allCases.length;

            // ÁèæÂú®Ë°®Á§∫‰∏≠„ÅÆ„Ç±„Éº„ÇπID„É™„Çπ„Éà„ÇíÊõ¥Êñ∞ÔºàCRM„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥Áî®Ôºâ
            // „ÇΩ„Éº„ÉàÔºÜ„Éï„Ç£„É´„ÇøÂæå„ÅÆÈ†ÜÂ∫è„Çí‰øùÊåÅ
            currentDisplayedCaseIds = allCases.map(([caseId, _]) => caseId);
            
            // „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥Ë®àÁÆó
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, totalItems);
            const pageCases = allCases.slice(startIndex, endIndex);
            
            // „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ÊÉÖÂ†±„ÇíÊõ¥Êñ∞
            updatePaginationInfo(totalItems, startIndex, endIndex);
            
            // Áµ±Ë®à„Ç´„Ç¶„É≥„Éà„ÇíÊõ¥Êñ∞
            updateStatsCounts();
            
            // ÁèæÂú®„ÅÆ„Éö„Éº„Ç∏„ÅÆ„Éá„Éº„Çø„ÇíË°®Á§∫
            pageCases.forEach(([caseId, caseData]) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 cursor-pointer';
                row.ondblclick = () => openCRM(caseId); // „ÉÄ„Éñ„É´„ÇØ„É™„ÉÉ„ÇØ„ÅßCRM„ÇíÈñã„Åè
                const statusColor = getStatusColor(caseData.status);
                const fee = calculateIntroductionFee(
                    caseData.workItems, 
                    caseData.propertyType, 
                    caseData.floors, 
                    caseData.companiesCount
                );
                
                row.innerHTML = `
                    <td class="px-3 py-4 whitespace-nowrap">
                        <input type="checkbox" class="rounded text-blue-600 case-checkbox" data-case-id="${caseId}" onchange="updateSelectedCount()">
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap">
                        <button class="px-4 py-1.5 ${statusColor} rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-xs font-semibold" onclick="event.stopPropagation(); openListStatusModal('${caseId}', this)">
                            ${caseData.status}
                        </button>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${caseData.name}</div>
                        <div class="relative group">
                            <div class="text-xs text-gray-500 cursor-pointer hover:text-blue-600" 
                                 onclick="event.stopPropagation(); toggleAddressTooltip('${caseId}')">
                                üìç ${caseData.postalCode}
                            </div>
                            <!-- „Éõ„Éê„ÉºÊôÇ(PC)„Åæ„Åü„ÅØ„Çø„ÉÉ„ÉóÊôÇ(„Çπ„Éû„Éõ)„ÅÆ‰ΩèÊâÄË°®Á§∫ -->
                            <div id="tooltip-${caseId}" class="absolute bottom-full left-0 mb-2 hidden group-hover:block z-50">
                                <div class="bg-gray-900 text-white text-xs rounded-lg py-2 px-3 whitespace-nowrap">
                                    ${caseData.address || '‰ΩèÊâÄÊú™Ë®≠ÂÆö'}
                                    <div class="absolute top-full left-4 -mt-1">
                                        <div class="border-4 border-transparent border-t-gray-900"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-4 text-center">
                        <div class="flex justify-center items-center space-x-2">
                            <button onclick="event.stopPropagation(); window.location.href='tel:${caseData.phone}'" class="text-xl hover:scale-110 transition-transform" title="ÈõªË©±">
                                üìû
                            </button>
                            <button onclick="event.stopPropagation(); window.location.href='sms:${caseData.phone}'" class="text-xl hover:scale-110 transition-transform" title="SMS">
                                üí¨
                            </button>
                            <button onclick="event.stopPropagation(); sendData('${caseId}')" class="text-xl hover:scale-110 transition-transform" title="ÈÄÅ‰ø°">
                                üì§
                            </button>
                            <button onclick="event.stopPropagation(); quickActionList('‰∏çÂú®', '${caseId}')" class="px-2 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600">
                                ‰∏çÂú®
                            </button>
                            <button onclick="event.stopPropagation(); openCallHistoryModal('${caseId}')" class="text-xl hover:scale-110 transition-transform" title="„É°„É¢">
                                üìù
                            </button>
                        </div>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                        <div class="relative group">
                            <div class="cursor-pointer" onclick="event.stopPropagation(); toggleWorkDetails('${caseId}')">
                                ${getPropertyIcon(caseData.propertyType)} ${getFloorDisplay(caseData.propertyType, caseData.floors)}
                            </div>
                            <!-- ÊñΩÂ∑•ÂÜÖÂÆπ„ÅÆË©≥Á¥∞Ë°®Á§∫ -->
                            <div id="work-details-${caseId}" class="absolute bottom-full left-0 mb-2 hidden group-hover:block z-50">
                                <div class="bg-gray-900 text-white text-xs rounded-lg py-2 px-3 max-w-xs">
                                    <div class="font-semibold mb-1">ÊñΩÂ∑•ÂÜÖÂÆπ:</div>
                                    ${caseData.workItems ? caseData.workItems.map(item => `<div>‚Ä¢ ${item}</div>`).join('') : 'Êú™Ë®≠ÂÆö'}
                                    <div class="absolute top-full left-4 -mt-1">
                                        <div class="border-4 border-transparent border-t-gray-900"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-emerald-600">
                        ¬•${Math.round(fee / 1000)}K
                    </td>
                    <td class="px-3 py-4 whitespace-nowrap text-center">
                        <button onclick="event.stopPropagation(); openCRM('${caseId}')" class="text-blue-600 hover:text-blue-800">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // „É¢„Éê„Ç§„É´Áî®„Ç´„Éº„ÉâË°®Á§∫„ÇÇÁîüÊàê
            const mobileContainer = document.getElementById('casesListMobile');
            if (mobileContainer) {
                mobileContainer.innerHTML = '';

                pageCases.forEach(([caseId, caseData]) => {
                    const statusColor = getStatusColor(caseData.status);
                    const fee = calculateIntroductionFee(
                        caseData.workItems,
                        caseData.propertyType,
                        caseData.floors,
                        caseData.companiesCount
                    );

                    const card = document.createElement('div');
                    card.className = 'bg-white rounded-lg border border-gray-200 p-4 hover:shadow-lg transition-shadow';
                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-2">
                                    <button class="px-4 py-1.5 ${statusColor} rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-xs font-semibold" onclick="event.stopPropagation(); openListStatusModal('${caseId}', this)">
                                        ${caseData.status}
                                    </button>
                                </div>
                                <div class="font-semibold text-gray-900">${caseData.name}</div>
                                <div class="text-sm text-gray-600 mt-1">üìç ${caseData.postalCode}</div>
                                <div class="text-xs text-gray-500 mt-1">${caseData.address || '‰ΩèÊâÄÊú™Ë®≠ÂÆö'}</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-semibold text-emerald-600">¬•${Math.round(fee / 1000)}K</div>
                                <div class="text-xs text-gray-500 mt-1">
                                    ${getPropertyIcon(caseData.propertyType)} ${getFloorDisplay(caseData.propertyType, caseData.floors)}
                                </div>
                            </div>
                        </div>
                        <div class="pt-3 border-t border-gray-200">
                            <div class="flex justify-between items-center">
                                <div class="flex space-x-2">
                                    <button onclick="window.location.href='tel:${caseData.phone}'" class="text-lg" title="ÈõªË©±">üìû</button>
                                    <button onclick="window.location.href='sms:${caseData.phone}'" class="text-lg" title="SMS">üí¨</button>
                                    <button onclick="sendData('${caseId}')" class="text-lg" title="ÈÄÅ‰ø°">üì§</button>
                                    <button onclick="openCallHistoryModal('${caseId}')" class="text-lg" title="„É°„É¢">üìù</button>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="quickActionList('‰∏çÂú®', '${caseId}')" class="px-2 py-1 text-xs bg-gray-500 text-white rounded">‰∏çÂú®</button>
                                    <button onclick="openCRM('${caseId}')" class="px-3 py-1 text-xs bg-blue-600 text-white rounded">Ë©≥Á¥∞</button>
                                </div>
                            </div>
                        </div>
                    `;
                    mobileContainer.appendChild(card);
                });
            }

            updateStatistics();
            updateSelectedCount();

            // „É™„Çπ„ÉàË°®Á§∫ÊôÇ„ÅÆ‰ª∂Êï∞Ë°®Á§∫„ÇíË°®Á§∫
            document.getElementById('listCountDisplay')?.classList.remove('hidden');
        }

        // „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ÊÉÖÂ†±„ÅÆÊõ¥Êñ∞
        function updatePaginationInfo(total, from, to) {
            // ‰∏ãÈÉ®„ÅÆ„Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ÊÉÖÂ†±„ÇíÊõ¥Êñ∞
            document.getElementById('totalCount').textContent = total;
            document.getElementById('showingFrom').textContent = from + 1;
            document.getElementById('showingTo').textContent = to;
            document.getElementById('currentPageCount').textContent = to - from;

            // ‰∏äÈÉ®„ÅÆ‰ª∂Êï∞Ë°®Á§∫„ÇÇÊõ¥Êñ∞
            document.getElementById('topTotalCount').textContent = total;
            document.getElementById('topShowingFrom').textContent = from + 1;
            document.getElementById('topShowingTo').textContent = to;
            
            // „Éö„Éº„Ç∏Áï™Âè∑„ÅÆÁîüÊàê
            const totalPages = Math.ceil(total / itemsPerPage);
            const pageNumbers = document.getElementById('pageNumbers');
            pageNumbers.innerHTML = '';
            
            // ÊúÄÂ§ß5„Éö„Éº„Ç∏„ÇíË°®Á§∫
            const maxPages = 5;
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + maxPages - 1);
            
            if (endPage - startPage < maxPages - 1) {
                startPage = Math.max(1, endPage - maxPages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                btn.className = i === currentPage
                    ? 'px-3 py-1.5 text-sm bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-semibold shadow-md'
                    : 'px-3 py-1.5 text-sm bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all shadow-sm';
                btn.onclick = () => goToPage(i);
                pageNumbers.appendChild(btn);
            }
            
            // Ââç/Ê¨°„Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages;
        }
        
        // „Éö„Éº„Ç∏ÁßªÂãï
        function goToPage(page) {
            currentPage = page;
            initializeListView();
        }
        
        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                initializeListView();
            }
        }
        
        function nextPage() {
            const totalPages = Math.ceil(Object.keys(casesData).length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                initializeListView();
            }
        }
        
        // Ë°®Á§∫‰ª∂Êï∞„ÅÆÂ§âÊõ¥
        function changeItemsPerPage() {
            itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
            currentPage = 1;
            initializeListView();
        }
        
        // ÈÅ∏Êäû‰ª∂Êï∞„ÅÆÊõ¥Êñ∞
        function updateSelectedCount() {
            const checkboxes = document.querySelectorAll('#casesListBody input[type="checkbox"]:checked');
            const selectedCount = checkboxes.length;
            document.getElementById('selectedCount').textContent = selectedCount;
            
            // ÈÅ∏Êäû‰ª∂Êï∞Ë°®Á§∫„ÅÆË°®Á§∫/ÈùûË°®Á§∫„ÇíÂà∂Âæ°
            const selectionDisplay = document.getElementById('selectionCountDisplay');
            if (selectedCount > 0 && currentView === 'list') {
                selectionDisplay.classList.remove('hidden');
            } else {
                selectionDisplay.classList.add('hidden');
            }
        }
        
        // ÂÖ®ÈÅ∏Êäû/ÂÖ®Ëß£Èô§
        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.case-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
            updateSelectedCount();
        }
        
        // „Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥
        // „É™„Çπ„Éà„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥Áî®„ÅÆ„Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let currentEditingCaseId = null;
        let currentEditingButton = null;

        // „É™„Çπ„Éà„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
        function openListStatusModal(caseId, buttonElement) {
            currentEditingCaseId = caseId;
            currentEditingButton = buttonElement;
            document.getElementById('listStatusModal').classList.remove('hidden');
        }

        // „É™„Çπ„Éà„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeListStatusModal() {
            document.getElementById('listStatusModal').classList.add('hidden');
            currentEditingCaseId = null;
            currentEditingButton = null;
        }

        // „É™„Çπ„Éà„Åã„Çâ„Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÈÅ∏Êäû
        function selectListStatus(newStatus) {
            if (!currentEditingCaseId) return;

            changeStatus(currentEditingCaseId, newStatus);

            // „Éú„Çø„É≥„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
            if (currentEditingButton) {
                const colorClass = getStatusColor(newStatus);
                currentEditingButton.className = 'px-4 py-1.5 rounded-full shadow-md hover:shadow-lg hover:scale-105 transition-all text-xs font-semibold ' + colorClass;
                currentEditingButton.textContent = newStatus;
            }

            closeListStatusModal();
        }

        function changeStatus(caseId, newStatus) {
            casesData[caseId].status = newStatus;

            // Êú™‰øùÂ≠òÂ§âÊõ¥„ÇíË®òÈå≤
            unsavedChanges.set(caseId, {
                status: newStatus,
                timestamp: Date.now()
            });

            // ‰øùÂ≠ò„Éú„Çø„É≥„ÇíÊõ¥Êñ∞
            updateSaveButton();

            console.log(`Ê°à‰ª∂ ${caseId} „ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Çí ${newStatus} „Å´Â§âÊõ¥ÔºàÊú™‰øùÂ≠òÔºâ`);
        }
        
        // CRM„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥
        function changeCRMStatus(newStatus) {
            if (!currentCaseId) return;
            casesData[currentCaseId].status = newStatus;

            // Êú™‰øùÂ≠òÂ§âÊõ¥„ÇíË®òÈå≤
            unsavedChanges.set(currentCaseId, {
                status: newStatus,
                timestamp: Date.now()
            });

            // ‰øùÂ≠ò„Éú„Çø„É≥„ÇíÊõ¥Êñ∞
            updateSaveButton();

            console.log(`Ê°à‰ª∂ ${currentCaseId} „ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Çí ${newStatus} „Å´Â§âÊõ¥ÔºàÊú™‰øùÂ≠òÔºâ`);
            updateCRMStatusBadge(newStatus);
        }

        // ========================================
        // „Ç™„Éº„Éà„Çª„Éº„Éñ„Ç∑„Çπ„ÉÜ„É†
        // ========================================

        // ‰øùÂ≠ò„Éú„Çø„É≥„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
        function updateSaveButton() {
            const saveBtn = document.querySelector('button[onclick="saveAllData()"]');
            if (!saveBtn) return;

            if (unsavedChanges.size > 0) {
                // Êú™‰øùÂ≠òÂ§âÊõ¥„ÅÇ„ÇäÔºö„Éî„É≥„ÇØËâ≤„ÅßÁõÆÁ´ã„Åü„Åõ„Çã + „Éë„É´„ÇπÂäπÊûú
                saveBtn.className = 'bg-gradient-to-r from-pink-500 to-pink-600 text-white p-2.5 md:px-5 md:py-2.5 rounded-xl font-semibold hover:from-pink-600 hover:to-pink-700 transition-all flex items-center gap-2 shadow-lg hover:shadow-xl transform hover:scale-105 animate-pulse';
                saveBtn.querySelector('span').textContent = `‰øùÂ≠ò (${unsavedChanges.size})`;
            } else {
                // Êú™‰øùÂ≠òÂ§âÊõ¥„Å™„ÅóÔºö„Ç∞„É¨„ÉºËâ≤„ÅßÊéß„Åà„ÇÅ„Å´
                saveBtn.className = 'bg-gray-300 text-gray-600 p-2.5 md:px-5 md:py-2.5 rounded-xl font-semibold transition-all flex items-center gap-2 shadow-md opacity-60 cursor-not-allowed';
                saveBtn.querySelector('span').textContent = '‰øùÂ≠ò';
            }
        }

        // ÁèæÂú∞Ë™øÊüªÂ∏åÊúõÊó•ÊôÇ„ÅÆÈÅ∏Êäû„Éú„Çø„É≥
        function selectSurveyDateTime(button) {
            // Êó¢„Å´ÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØËß£Èô§
            if (button.classList.contains('selected')) {
                button.classList.remove('selected');
                button.classList.remove('bg-orange-500', 'border-orange-500', 'text-white');
                button.classList.add('bg-white', 'border-gray-300', 'text-gray-700');
            } else {
                button.classList.add('selected');
                button.classList.remove('bg-white', 'border-gray-300', 'text-gray-700');
                button.classList.add('bg-orange-500', 'border-orange-500', 'text-white');
            }

            // Â§âÊõ¥„ÇíË®òÈå≤ÔºàMap„Å™„ÅÆ„Åßset„Çí‰ΩøÁî®Ôºâ
            if (currentCaseId) {
                unsavedChanges.set(currentCaseId, { type: 'form' });
                updateSaveButton();
            }

            // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥Áä∂ÊÖã„ÇíÊõ¥Êñ∞
            validateEmptyFields();
        }

        // „Ç≠„Éº„Éú„Éº„Éâ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„ÉàÔºàCmd+S / Ctrl+S „Åß‰øùÂ≠òÔºâ
        document.addEventListener('keydown', function(e) {
            // Cmd+S (Mac) „Åæ„Åü„ÅØ Ctrl+S (Windows/Linux)
            if ((e.metaKey || e.ctrlKey) && e.key === 's') {
                e.preventDefault(); // „Éñ„É©„Ç¶„Ç∂„ÅÆ„Éá„Éï„Ç©„É´„Éà‰øùÂ≠ò„ÇíÈò≤„Åê
                console.log('[„Ç≠„Éº„Éú„Éº„Éâ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà] Cmd+S / Ctrl+S „ÅåÊäº„Åï„Çå„Åæ„Åó„Åü');

                // Êú™‰øùÂ≠ò„ÅÆÂ§âÊõ¥„Åå„ÅÇ„Çå„Å∞‰øùÂ≠ò
                if (unsavedChanges.size > 0 && !isSaving) {
                    saveAllData();
                }
            }
        });

        // ÂÖ®Êú™‰øùÂ≠òÂ§âÊõ¥„Çí‰øùÂ≠ò
        // CRM„Éï„Ç©„Éº„É†„Åã„ÇâÂÖ®„Éá„Éº„Çø„ÇíÂèñÂæó
        function getCRMFormData() {
            const crmContent = document.getElementById('crmContent');
            if (!crmContent) return null;

            const data = {};

            // Âü∫Êú¨ÊÉÖÂ†±
            const nameInput = crmContent.querySelector('input[type="text"]');
            if (nameInput) data.name = nameInput.value;

            const kanaInput = crmContent.querySelectorAll('input[type="text"]')[1];
            if (kanaInput) data.nameKana = kanaInput.value;

            const telInput = crmContent.querySelector('input[type="tel"]');
            if (telInput) data.phone = telInput.value;

            const emailInput = crmContent.querySelector('input[type="email"]');
            if (emailInput) data.email = emailInput.value;

            // ÊÄßÂà•Ôºà„Éú„Çø„É≥ÂΩ¢Âºè - hidden input„Åã„ÇâÂèñÂæóÔºâ
            const genderSelect = document.getElementById('genderSelect');
            if (genderSelect) data.gender = genderSelect.value;

            // Âπ¥ÈΩ¢Ôºà„Éú„Çø„É≥ÂΩ¢Âºè - hidden input„Åã„ÇâÂèñÂæóÔºâ
            const ageSelect = document.getElementById('ageSelect');
            if (ageSelect) data.age = ageSelect.value;

            // Èñ¢‰øÇÊÄßÔºà„Çª„É¨„ÇØ„Éà„Åã„ÇâÂèñÂæóÔºâ
            const relationSelect = document.getElementById('relationSelect');
            if (relationSelect) data.relation = relationSelect.value;

            // ‰ΩèÊâÄ
            const zipInput = document.getElementById('zipInput');
            if (zipInput) data.postalCode = zipInput.value;

            const addressInput = document.getElementById('addressInput');
            const addressNumberInput = document.getElementById('addressNumberInput');
            if (addressInput && addressNumberInput) {
                // ‰ΩèÊâÄ„Å®Áï™Âú∞„ÇíÁµêÂêà„Åó„Å¶‰øùÂ≠ò
                data.address = (addressInput.value + addressNumberInput.value).trim();
            } else if (addressInput) {
                data.address = addressInput.value;
            }

            // Áâ©‰ª∂„Éó„É≠„Éï„Ç£„Éº„É´ÔºàID„Éô„Éº„Çπ„ÅßÁõ¥Êé•ÂèñÂæóÔºâ
            const propertyTypeInput = document.getElementById('propertyTypeSelect');
            if (propertyTypeInput) data.propertyType = propertyTypeInput.value;

            const floorsInput = document.getElementById('floorsSelect');
            if (floorsInput) data.floors = floorsInput.value;

            const buildingAgeInput = document.getElementById('buildingAgeSelect');
            if (buildingAgeInput) data.buildingAge = buildingAgeInput.value;

            const floorAreaInput = document.getElementById('floorAreaSelect');
            if (floorAreaInput) data.floorArea = floorAreaInput.value;

            const constructionCountInput = document.getElementById('constructionCountSelect');
            if (constructionCountInput) data.constructionCount = constructionCountInput.value;

            const previousConstructionInput = document.getElementById('previousConstructionSelect');
            if (previousConstructionInput) data.previousConstructionTime = previousConstructionInput.value;

            const wallMaterialInput = document.getElementById('wallMaterialSelect');
            if (wallMaterialInput) data.wallMaterial = wallMaterialInput.value;

            const roofMaterialInput = document.getElementById('roofMaterialSelect');
            if (roofMaterialInput) data.roofMaterial = roofMaterialInput.value;

            // Google Maps„É™„É≥„ÇØ
            const mapLinkInput = document.getElementById('mapLinkInput');
            if (mapLinkInput) data.mapLink = mapLinkInput.value;

            // Ë¶ãÁ©ç„ÇÇ„ÇäÂèñÂæóÂÖà
            data.quoteSource = getInputOrSelectValue('Ë¶ãÁ©ç„ÇÇ„ÇäÂèñÂæóÂÖà');

            // ÊñΩÂ∑•ÊôÇÊúü
            data.constructionTiming = getInputOrSelectValue('ÊñΩÂ∑•ÊôÇÊúü');

            // ÁèæÂú∞Ë™øÊüªÂ∏åÊúõÊó•ÊôÇÔºàÈÅ∏Êäû„Åï„Çå„Åü„Éú„Çø„É≥„Åã„ÇâÂèñÂæóÔºâ
            const surveyButtonGroup = document.getElementById('surveyDateTimeButtonGroup');
            if (surveyButtonGroup) {
                const selectedSurveyTimes = Array.from(surveyButtonGroup.querySelectorAll('.option-button.selected'))
                    .map(btn => btn.textContent.trim());
                data['ÁèæÂú∞Ë™øÊüªÂ∏åÊúõÊó•ÊôÇ'] = selectedSurveyTimes.join(', ');
            }

            // Â∑•‰∫ãÂ∏åÊúõÁÆáÊâÄÔºàÈÅ∏Êäû„Åï„Çå„Åü„Éú„Çø„É≥„ÇíÈÖçÂàó„ÅßÂèñÂæóÔºâ
            const selectedButtons = Array.from(crmContent.querySelectorAll('.option-button.selected'));
            data.workItems = selectedButtons.map(btn => btn.textContent.trim());

            // „Çπ„ÉÜ„Éº„Çø„Çπ
            const statusBadge = document.getElementById('crmStatusBadge');
            if (statusBadge) {
                data.status = statusBadge.textContent.trim();
            }

            // Ê°à‰ª∂„É°„É¢ÔºàASÂàó: Ê°à‰ª∂„É°„É¢Ôºâ
            const caseMemoTextarea = document.getElementById('caseMemoTextarea');
            if (caseMemoTextarea) {
                data['Ê°à‰ª∂„É°„É¢'] = caseMemoTextarea.value || '';
            }

            // ÊµÅÂÖ•Ê§úÁ¥¢„ÉØ„Éº„ÉâÔºàBFÂàó: searchKeywordÔºâ
            const searchKeywordInput = document.getElementById('searchKeywordInput');
            if (searchKeywordInput) {
                data.searchKeyword = searchKeywordInput.value || '';
            }

            // ÈÄ£Áµ°ÊñπÊ≥ïÔºàATÂàó: ÈÄ£Áµ°ÊôÇÈñìÂ∏ØÔºâ
            const contactMethodInput = document.getElementById('contactMethodInput');
            if (contactMethodInput) {
                data['ÈÄ£Áµ°ÊôÇÈñìÂ∏Ø'] = contactMethodInput.value || '';
            }

            console.log('[getCRMFormData] „Éï„Ç©„Éº„É†„Éá„Éº„ÇøÂèñÂæó:', data);
            return data;
        }

        // inputÔºàdatalist‰ªò„ÅçÔºâ„Åæ„Åü„ÅØselect„ÅÆÂÄ§„ÇíÂèñÂæó„Åô„Çã„Éò„É´„Éë„ÉºÈñ¢Êï∞
        function getInputOrSelectValue(labelText) {
            const crmContent = document.getElementById('crmContent');
            if (!crmContent) return '';

            const labels = crmContent.querySelectorAll('label');
            for (const label of labels) {
                if (label.textContent.includes(labelText)) {
                    // datalist‰ªò„Åçinput„ÇíÊé¢„Åô
                    const input = label.parentElement.querySelector('input[list]');
                    if (input) return input.value || '';

                    // ÈÄöÂ∏∏„ÅÆinput„ÇíÊé¢„Åô
                    const textInput = label.parentElement.querySelector('input[type="text"]');
                    if (textInput) return textInput.value || '';

                    // select„ÇíÊé¢„Åô
                    const select = label.parentElement.querySelector('select');
                    if (select) return select.value || '';
                }
            }
            return '';
        }

        // „Çª„É¨„ÇØ„Éà„Éú„ÉÉ„ÇØ„Çπ„ÅÆÂÄ§„ÇíÂèñÂæó„Åô„Çã„Éò„É´„Éë„ÉºÈñ¢Êï∞ÔºàÂæåÊñπ‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅÊÆã„ÅôÔºâ
        function getSelectValue(labelText) {
            return getInputOrSelectValue(labelText);
        }

        async function saveAllData() {
            if (unsavedChanges.size === 0) {
                console.log('[AutoSave] Êú™‰øùÂ≠ò„ÅÆÂ§âÊõ¥„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }

            if (isSaving) {
                console.log('[AutoSave] ‰øùÂ≠òÂá¶ÁêÜÂÆüË°å‰∏≠...');
                return;
            }

            isSaving = true;
            const changesToSave = Array.from(unsavedChanges.entries());
            console.log(`[AutoSave] ${changesToSave.length} ‰ª∂„ÅÆÂ§âÊõ¥„Çí‰øùÂ≠ò‰∏≠...`);

            // ‰øùÂ≠ò‰∏≠„Ç§„É≥„Ç∏„Ç±„Éº„Çø„ÉºË°®Á§∫
            showSavingIndicator();

            let successCount = 0;
            let failCount = 0;

            for (const [cvId, changeType] of changesToSave) {
                try {
                    // ÁèæÂú®Ë°®Á§∫‰∏≠„ÅÆCRM„Éá„Éº„Çø„ÅãÁ¢∫Ë™ç
                    if (cvId === currentCaseId && currentView === 'crm') {
                        // CRM„Éï„Ç©„Éº„É†„Åã„ÇâÂÖ®„Éá„Éº„Çø„ÇíÂèñÂæó„Åó„Å¶‰øùÂ≠ò
                        const formData = getCRMFormData();
                        if (formData) {
                            const result = await window.apiClient.postRequest('updateCVData', {
                                cvId: cvId,
                                data: formData
                            });

                            if (result.success) {
                                successCount++;
                                unsavedChanges.delete(cvId);
                                // „É≠„Éº„Ç´„É´„Éá„Éº„Çø„ÇÇÊõ¥Êñ∞
                                if (casesData[cvId]) {
                                    Object.assign(casesData[cvId], formData);
                                }
                                console.log(`[AutoSave] ÂÖ®È†ÖÁõÆ‰øùÂ≠òÊàêÂäü: ${cvId}`);
                            } else {
                                failCount++;
                                console.error(`[AutoSave] Â§±Êïó: ${cvId}`, result.error);
                            }
                        }
                    } else {
                        // „É™„Çπ„Éà„Éì„É•„Éº„Å™„Å©„Åã„Çâ„ÅÆ„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥„ÅÆ„Åø‰øùÂ≠ò
                        const caseData = casesData[cvId];
                        if (caseData) {
                            const result = await window.apiClient.postRequest('updateCVStatus', {
                                cvId: cvId,
                                status: caseData.status
                            });

                            if (result.success) {
                                successCount++;
                                unsavedChanges.delete(cvId);
                                console.log(`[AutoSave] „Çπ„ÉÜ„Éº„Çø„Çπ‰øùÂ≠òÊàêÂäü: ${cvId} ‚Üí ${caseData.status}`);
                            } else {
                                failCount++;
                                console.error(`[AutoSave] Â§±Êïó: ${cvId}`, result.error);
                            }
                        }
                    }
                } catch (error) {
                    failCount++;
                    console.error(`[AutoSave] „Ç®„É©„Éº: ${cvId}`, error);
                }
            }

            isSaving = false;

            // ‰øùÂ≠òÂÆå‰∫ÜË°®Á§∫
            hideSavingIndicator();
            // Â§±ÊïóÊôÇ„ÅÆ„Åø„Éà„Éº„Çπ„ÉàÈÄöÁü•„ÇíË°®Á§∫ÔºàÂè≥‰∏äÔºâ
            if (failCount > 0) {
                showNotification(`‚ö† ‰øùÂ≠òÂ§±Êïó: ${failCount} ‰ª∂„ÅÆ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü`, 'error');
            }
            // ÊàêÂäüÊôÇ„ÅØÈÄöÁü•„ÇíË°®Á§∫„Åó„Å™„ÅÑÔºà„É¶„Éº„Ç∂„ÉºË¶ÅÊúõÔºâ

            // ‰øùÂ≠ò„Éú„Çø„É≥„ÇíÊõ¥Êñ∞
            updateSaveButton();
        }

        // ‰øùÂ≠ò‰∏≠„Ç§„É≥„Ç∏„Ç±„Éº„Çø„ÉºË°®Á§∫
        function showSavingIndicator() {
            const indicator = document.createElement('div');
            indicator.id = 'savingIndicator';
            indicator.className = 'fixed top-20 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 z-50';
            indicator.innerHTML = `
                <svg class="animate-spin h-5 w-5" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span>‰øùÂ≠ò‰∏≠...</span>
            `;
            document.body.appendChild(indicator);
        }

        // ‰øùÂ≠ò‰∏≠„Ç§„É≥„Ç∏„Ç±„Éº„Çø„ÉºÈùûË°®Á§∫
        function hideSavingIndicator() {
            const indicator = document.getElementById('savingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // „Ç™„Éº„Éà„Çª„Éº„Éñ„Çø„Ç§„Éû„ÉºÈñãÂßãÔºà30ÁßíÈñìÈöîÔºâ
        function startAutoSave() {
            // Êó¢Â≠ò„ÅÆ„Çø„Ç§„Éû„Éº„Çí„ÇØ„É™„Ç¢
            if (autoSaveTimer) {
                clearInterval(autoSaveTimer);
            }

            // 60Áßí„Åî„Å®„Å´„Ç™„Éº„Éà„Çª„Éº„Éñ
            autoSaveTimer = setInterval(async () => {
                if (unsavedChanges.size > 0 && !isSaving) {
                    console.log('[AutoSave] Ëá™Âãï‰øùÂ≠ò„ÇíÂÆüË°å„Åó„Åæ„Åô');
                    await saveAllData();
                }
            }, 60000); // 60Áßí

            console.log('[AutoSave] „Ç™„Éº„Éà„Çª„Éº„Éñ„Çø„Ç§„Éû„ÉºÈñãÂßãÔºà60ÁßíÈñìÈöîÔºâ');
        }

        // „Éö„Éº„Ç∏Èõ¢ËÑ±ÊôÇ„ÅÆÁ¢∫Ë™ç
        function checkUnsavedBeforeUnload(e) {
            if (unsavedChanges.size > 0) {
                e.preventDefault();
                e.returnValue = ''; // Chrome„Åß„ÅØÁ©∫ÊñáÂ≠ó„ÇíË®≠ÂÆö

                // „Ç´„Çπ„Çø„É†„É¢„Éº„ÉÄ„É´Ë°®Á§∫
                showUnsavedChangesModal();
            }
        }

        // Êú™‰øùÂ≠òÂ§âÊõ¥„É¢„Éº„ÉÄ„É´Ë°®Á§∫
        function showUnsavedChangesModal() {
            const modal = document.createElement('div');
            modal.id = 'unsavedChangesModal';
            modal.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 relative">
                    <button onclick="closeUnsavedChangesModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                    <div class="text-center">
                        <div class="mb-4">
                            <svg class="w-16 h-16 mx-auto text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-2">Êú™‰øùÂ≠ò„ÅÆÂ§âÊõ¥„Åå„ÅÇ„Çä„Åæ„Åô</h3>
                        <p class="text-gray-600 mb-6">${unsavedChanges.size} ‰ª∂„ÅÆÂ§âÊõ¥„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ<br>‰øùÂ≠ò„Åó„Åæ„Åô„ÅãÔºü</p>
                        <button onclick="saveAndClose()" class="w-full px-6 py-3 bg-pink-500 text-white rounded-lg font-semibold hover:bg-pink-600 transition-all shadow-lg hover:shadow-xl">
                            ‰øùÂ≠ò„Åô„Çã
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Êú™‰øùÂ≠òÂ§âÊõ¥„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeUnsavedChangesModal() {
            const modal = document.getElementById('unsavedChangesModal');
            if (modal) {
                modal.remove();
            }
        }

        // ‰øùÂ≠ò„Åó„Å¶„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        async function saveAndClose() {
            await saveAllData();
            closeUnsavedChangesModal();
        }

        // „Éö„Éº„Ç∏ÂÜÖÈÅ∑ÁßªÊôÇ„ÅÆ‰øùÂ≠òÁ¢∫Ë™ç„É¢„Éº„ÉÄ„É´ÔºàCRM‚Üí„É™„Çπ„ÉàÁ≠âÔºâ
        function showInternalNavigationWarning(targetView) {
            const modal = document.createElement('div');
            modal.id = 'internalNavigationModal';
            modal.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 relative">
                    <button onclick="closeInternalNavigationModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                    <div class="text-center">
                        <div class="mb-4">
                            <svg class="w-16 h-16 mx-auto text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-2">Êú™‰øùÂ≠ò„ÅÆÂ§âÊõ¥„Åå„ÅÇ„Çä„Åæ„Åô</h3>
                        <p class="text-gray-600 mb-6">${unsavedChanges.size} ‰ª∂„ÅÆÂ§âÊõ¥„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ<br>‰øùÂ≠ò„Åó„Åæ„Åô„ÅãÔºü</p>
                        <div class="flex flex-col gap-3">
                            <button onclick="saveAndNavigate('${targetView}')" class="w-full px-6 py-3 bg-pink-500 text-white rounded-lg font-semibold hover:bg-pink-600 transition-all shadow-lg hover:shadow-xl">
                                ‰øùÂ≠ò„Åô„Çã
                            </button>
                            <button onclick="navigateWithoutSaving('${targetView}')" class="w-full px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-all">
                                ‰øùÂ≠ò„Åõ„Åö„Å´Á∂öË°å
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // „Éö„Éº„Ç∏ÂÜÖÈÅ∑Áßª„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeInternalNavigationModal() {
            const modal = document.getElementById('internalNavigationModal');
            if (modal) {
                modal.remove();
            }
        }

        // ‰øùÂ≠ò„Åó„Å¶„Åã„ÇâÈÅ∑Áßª
        async function saveAndNavigate(targetView) {
            await saveAllData();
            closeInternalNavigationModal();
            performViewSwitch(targetView);
        }

        // ‰øùÂ≠ò„Åõ„Åö„Å´ÈÅ∑Áßª
        function navigateWithoutSaving(targetView) {
            // Êú™‰øùÂ≠òÂ§âÊõ¥„Çí„ÇØ„É™„Ç¢
            unsavedChanges.clear();
            updateSaveButtonState();
            closeInternalNavigationModal();
            performViewSwitch(targetView);
        }

        // „Çª„ÇØ„Ç∑„Éß„É≥ÈÅ∑ÁßªÊôÇ„ÅÆ‰øùÂ≠òÁ¢∫Ë™ç„É¢„Éº„ÉÄ„É´ÔºàÊ°à‰ª∂ÁÆ°ÁêÜ‚Üí„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÁ≠âÔºâ
        function showSectionNavigationWarning(targetSection) {
            const modal = document.createElement('div');
            modal.id = 'sectionNavigationModal';
            modal.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 relative">
                    <button onclick="closeSectionNavigationModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                    <div class="text-center">
                        <div class="mb-4">
                            <svg class="w-16 h-16 mx-auto text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-2">Êú™‰øùÂ≠ò„ÅÆÂ§âÊõ¥„Åå„ÅÇ„Çä„Åæ„Åô</h3>
                        <p class="text-gray-600 mb-6">${unsavedChanges.size} ‰ª∂„ÅÆÂ§âÊõ¥„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ<br>‰øùÂ≠ò„Åó„Åæ„Åô„ÅãÔºü</p>
                        <div class="flex flex-col gap-3">
                            <button onclick="saveAndNavigateSection('${targetSection}')" class="w-full px-6 py-3 bg-pink-500 text-white rounded-lg font-semibold hover:bg-pink-600 transition-all shadow-lg hover:shadow-xl">
                                ‰øùÂ≠ò„Åô„Çã
                            </button>
                            <button onclick="navigateWithoutSavingSection('${targetSection}')" class="w-full px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-all">
                                ‰øùÂ≠ò„Åõ„Åö„Å´Á∂öË°å
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // „Çª„ÇØ„Ç∑„Éß„É≥ÈÅ∑Áßª„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeSectionNavigationModal() {
            const modal = document.getElementById('sectionNavigationModal');
            if (modal) {
                modal.remove();
            }
        }

        // ‰øùÂ≠ò„Åó„Å¶„Åã„Çâ„Çª„ÇØ„Ç∑„Éß„É≥ÈÅ∑Áßª
        async function saveAndNavigateSection(targetSection) {
            await saveAllData();
            closeSectionNavigationModal();
            // Êú™‰øùÂ≠òÂ§âÊõ¥„Çí„ÇØ„É™„Ç¢„Åó„Å¶„Åã„ÇâÈÅ∑Áßª
            unsavedChanges.clear();
            updateSaveButtonState();
            showSection(targetSection);
        }

        // ‰øùÂ≠ò„Åõ„Åö„Å´„Çª„ÇØ„Ç∑„Éß„É≥ÈÅ∑Áßª
        function navigateWithoutSavingSection(targetSection) {
            // Êú™‰øùÂ≠òÂ§âÊõ¥„Çí„ÇØ„É™„Ç¢
            unsavedChanges.clear();
            updateSaveButtonState();
            closeSectionNavigationModal();
            showSection(targetSection);
        }

        // ========================================
        // „Ç™„Éº„Éà„Çª„Éº„Éñ„Ç∑„Çπ„ÉÜ„É† „Åì„Åì„Åæ„Åß
        // ========================================

        // „Çπ„ÉÜ„Éº„Çø„Çπ„É¢„Éº„ÉÄ„É´„ÅÆ„Éà„Ç∞„É´
        function toggleStatusModal() {
            const modal = document.getElementById('statusModal');
            if (modal) {
                modal.classList.toggle('hidden');
            }
        }

        // „Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÈÅ∏Êäû
        function selectCRMStatus(status) {
            changeCRMStatus(status);
            toggleStatusModal();
        }

        // „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„ÉÉ„Ç∏„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
        function updateCRMStatusBadge(status) {
            const badge = document.getElementById('crmStatusBadge');
            if (!badge) return;

            // Êó¢Â≠ò„ÅÆ„Ç´„É©„Éº„ÇØ„É©„Çπ„ÇíÂâäÈô§
            badge.className = 'px-5 py-2 rounded-full font-semibold text-base transition-all hover:shadow-lg hover:scale-105 cursor-pointer shadow-md';

            // Êñ∞„Åó„ÅÑ„Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„ÅüËâ≤„ÇíÈÅ©Áî®
            const colorClass = getStatusColor(status);
            badge.className += ' ' + colorClass;
            badge.textContent = status;
        }

        // „É¢„Éº„ÉÄ„É´Â§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('statusModal');
            const badge = document.getElementById('crmStatusBadge');
            if (modal && badge && !modal.contains(event.target) && !badge.contains(event.target)) {
                modal.classList.add('hidden');
            }
        });
        
        // Êû∂ÈõªÂ±•Ê≠¥„É¢„Éº„ÉÄ„É´„ÇíÈñã„ÅèÔºà„É™„Çπ„Éà„Åã„Çâ„ÇÇCRM„Åã„Çâ„ÇÇ‰Ωø„Åà„ÇãÔºâ
        function openCallHistoryModal(caseId) {
            // „É™„Çπ„Éà„Åã„ÇâÈñã„ÅÑ„ÅüÂ†¥Âêà„ÅØcaseId„ÇíË®≠ÂÆö
            if (caseId) {
                currentCaseId = caseId;
            }
            document.getElementById('callHistoryModal').classList.remove('hidden');
            loadCallHistory();
        }
        
        // Êû∂ÈõªÂ±•Ê≠¥„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeCallHistoryModal() {
            document.getElementById('callHistoryModal').classList.add('hidden');
            document.getElementById('newCallNote').value = '';
            document.getElementById('nextCallDate').value = '';
        }
        
        // Êû∂ÈõªÂ±•Ê≠¥„ÇíËøΩÂä†
        function addCallHistory() {
            const note = document.getElementById('newCallNote').value;
            if (!note.trim()) return;
            
            if (!casesData[currentCaseId].callHistory) {
                casesData[currentCaseId].callHistory = [];
            }
            
            const timestamp = new Date().toLocaleString('ja-JP');
            const nextCallDate = document.getElementById('nextCallDate').value;
            
            casesData[currentCaseId].callHistory.unshift({
                timestamp: timestamp,
                note: note,
                nextCallDate: nextCallDate
            });
            
            // Ê¨°ÂõûÊû∂ÈõªÊó•„Çí‰øùÂ≠ò
            if (nextCallDate) {
                casesData[currentCaseId].nextCallDate = nextCallDate;
            }
            
            // UI„É™„Çª„ÉÉ„Éà
            document.getElementById('newCallNote').value = '';
            document.getElementById('nextCallDate').value = '';
            
            // Â±•Ê≠¥„ÇíÂÜçË°®Á§∫
            loadCallHistory();
            
            // „É™„Çπ„ÉàË°®Á§∫„ÇÇÊõ¥Êñ∞Ôºà„É°„É¢„ÅÆÂêåÊúüÔºâ
            if (currentView === 'list') {
                initializeListView();
            }
        }
        
        // ‰ΩèÊâÄ„ÇíË°®Á§∫Ôºà„ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó„Åæ„Åü„ÅØ„Ç¢„É©„Éº„ÉàÔºâ
        // ‰ΩèÊâÄ„ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó„ÅÆ„Éà„Ç∞„É´Ôºà„Çπ„Éû„ÉõÁî®Ôºâ
        function toggleAddressTooltip(caseId) {
            const tooltip = document.getElementById(`tooltip-${caseId}`);
            if (tooltip) {
                tooltip.classList.toggle('hidden');
                // 3ÁßíÂæå„Å´Ëá™Âãï„ÅßÈñâ„Åò„Çã
                if (!tooltip.classList.contains('hidden')) {
                    setTimeout(() => {
                        tooltip.classList.add('hidden');
                    }, 3000);
                }
            }
        }
        
        // ÊñΩÂ∑•ÂÜÖÂÆπË©≥Á¥∞„ÅÆ„Éà„Ç∞„É´Ôºà„Çπ„Éû„ÉõÁî®Ôºâ
        function toggleWorkDetails(caseId) {
            const details = document.getElementById(`work-details-${caseId}`);
            if (details) {
                details.classList.toggle('hidden');
                // 3ÁßíÂæå„Å´Ëá™Âãï„ÅßÈñâ„Åò„Çã
                if (!details.classList.contains('hidden')) {
                    setTimeout(() => {
                        details.classList.add('hidden');
                    }, 3000);
                }
            }
        }
        
        // „É°„É¢Â±•Ê≠¥„ÅÆ„Éó„É¨„Éì„É•„Éº„ÇíÂèñÂæó
        function getMemoPreview(caseId) {
            const caseData = casesData[caseId];
            if (!caseData || !caseData.callHistory || caseData.callHistory.length === 0) {
                return '<div class="text-gray-400">„É°„É¢„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
            }
            
            // ÊúÄÊñ∞3‰ª∂„ÅÆ„É°„É¢„ÇíË°®Á§∫
            const recentMemos = caseData.callHistory.slice(-3).reverse();
            return recentMemos.map(memo => 
                `<div class="mb-1 pb-1 border-b border-gray-700 last:border-0">
                    <div class="text-gray-400">${memo.date}</div>
                    <div>${memo.note.substring(0, 50)}${memo.note.length > 50 ? '...' : ''}</div>
                </div>`
            ).join('');
        }
        
        // Êû∂ÈõªÂ±•Ê≠¥„ÇíË™≠„ÅøËæº„Åø
        function loadCallHistory() {
            const historyList = document.getElementById('callHistoryList');
            const history = casesData[currentCaseId]?.callHistory || [];
            
            if (history.length === 0) {
                historyList.innerHTML = '<p class="text-gray-500 text-center">Â±•Ê≠¥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                return;
            }
            
            historyList.innerHTML = history.map(item => `
                <div class="border-l-4 border-blue-500 pl-4 py-2">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">${item.timestamp}</p>
                            <p class="mt-1">${item.note}</p>
                            ${item.nextCallDate ? `<p class="text-sm text-blue-600 mt-1">Ê¨°ÂõûÊû∂Èõª: ${item.nextCallDate}</p>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // Âè§„ÅÑsaveAllDataÈñ¢Êï∞„ÅØÂâäÈô§Ôºà4878Ë°åÁõÆ„ÅÆÈùûÂêåÊúüÁâà„Çí‰ΩøÁî®Ôºâ
        
        // Áâ©‰ª∂„Çø„Ç§„Éó„ÅÆ„Ç¢„Ç§„Ç≥„É≥„ÇíÂèñÂæó
        function getPropertyIcon(propertyType) {
            const icons = {
                'Êà∏Âª∫„Å¶': 'üè†',
                '„Ç¢„Éë„Éº„Éà': 'üè¢',
                '„Éû„É≥„Ç∑„Éß„É≥': 'üè¢',
                'Â∫óËàó': 'üè™',
                '‰∫ãÂãôÊâÄ': 'üè™',
                'Â∑•Â†¥': 'üè≠',
                'ÂÄâÂ∫´': 'üè≠'
            };
            return icons[propertyType] || 'üè†';
        }
        
        // ÈöéÊï∞Ë°®Á§∫„ÇíÂèñÂæó
        function getFloorDisplay(propertyType, floors) {
            if (!floors) return '';
            
            // „Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà
            if (propertyType === '„Ç¢„Éë„Éº„Éà' || propertyType === '„Éû„É≥„Ç∑„Éß„É≥') {
                if (floors === '10ÈöéÂª∫„Å¶‰ª•‰∏ä') return '10F„Äú';
                const match = floors.match(/(\d+)/);
                if (match) return `${match[1]}F`;
                return floors;
            }
            
            // „Åù„ÅÆ‰ªñ„ÅÆÁâ©‰ª∂„Çø„Ç§„Éó
            const match = floors.match(/(\d+)/);
            if (match) {
                const num = parseInt(match[1]);
                if (num >= 4) return '4F„Äú';
                return `${num}F`;
            }
            return floors;
        }

        // „Éì„É•„ÉºÂàá„ÇäÊõø„Åà
        let currentView = 'list';
        let currentCaseId = null;
        let currentDisplayedCaseIds = []; // ÁèæÂú®Ë°®Á§∫‰∏≠„ÅÆ„É™„Çπ„ÉàÈ†ÜÂ∫è„Çí‰øùÊåÅ
        
        function switchView(view) {
            console.log('switchView called with view:', view);

            // „Éö„Éº„Ç∏ÂÜÖÈÅ∑ÁßªÊôÇ„ÅÆÊú™‰øùÂ≠òÂ§âÊõ¥„ÉÅ„Çß„ÉÉ„ÇØ
            if (unsavedChanges.size > 0) {
                console.log('[switchView] Êú™‰øùÂ≠ò„ÅÆÂ§âÊõ¥„Åå„ÅÇ„Çä„Åæ„Åô:', unsavedChanges.size, '‰ª∂');
                showInternalNavigationWarning(view);
                return; // ÈÅ∑Áßª„Çí‰∏ÄÊôÇÂÅúÊ≠¢
            }

            performViewSwitch(view);
        }

        // ÂÆüÈöõ„ÅÆ„Éì„É•„ÉºÂàá„ÇäÊõø„ÅàÂá¶ÁêÜ
        function performViewSwitch(view) {
            console.log('performViewSwitch called with view:', view);
            if (view === 'list') {
                document.getElementById('listView').classList.remove('hidden');
                document.getElementById('crmView').classList.add('hidden');
                document.getElementById('listViewBtn').classList.add('bg-white', 'text-gray-900');
                document.getElementById('listViewBtn').classList.remove('text-gray-600');
                document.getElementById('crmViewBtn').classList.remove('bg-white', 'text-gray-900');
                document.getElementById('crmViewBtn').classList.add('text-gray-600');
                currentView = 'list';

                // „É™„Çπ„ÉàË°®Á§∫ÊôÇ„ÅÆUIË¶ÅÁ¥†Ë°®Á§∫
                document.getElementById('listCountDisplay').classList.remove('hidden');
                document.getElementById('casePositionDisplay').classList.add('hidden');

                // initializeListView() „ÅåÊ§úÁ¥¢„Éï„Ç£„É´„Çø„ÇíËá™ÂãïÈÅ©Áî®
                initializeListView();

                // „É™„Çπ„ÉàË°®Á§∫ÊôÇ„ÅØÈÅ∏Êäû‰ª∂Êï∞„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
                updateSelectedCount();
            } else {
                document.getElementById('listView').classList.add('hidden');
                document.getElementById('crmView').classList.remove('hidden');
                document.getElementById('crmViewBtn').classList.add('bg-white', 'text-gray-900');
                document.getElementById('crmViewBtn').classList.remove('text-gray-600');
                document.getElementById('listViewBtn').classList.remove('bg-white', 'text-gray-900');
                document.getElementById('listViewBtn').classList.add('text-gray-600');
                currentView = 'crm';

                // CRMË°®Á§∫ÊôÇ„ÅÆUIË¶ÅÁ¥†Ë°®Á§∫
                document.getElementById('selectionCountDisplay').classList.add('hidden');
                document.getElementById('listCountDisplay').classList.add('hidden');
                document.getElementById('casePositionDisplay').classList.remove('hidden');

                // currentCaseId„ÅåÊú™Ë®≠ÂÆö„ÄÅ„Åæ„Åü„ÅØË°®Á§∫‰∏≠„É™„Çπ„Éà„Å´„Å™„ÅÑÂ†¥Âêà„ÅØÊúÄÂàù„ÅÆÊ°à‰ª∂„ÇíËá™ÂãïÈÅ∏Êäû
                console.log('[switchView] currentCaseId:', currentCaseId);
                console.log('[switchView] currentDisplayedCaseIds:', currentDisplayedCaseIds);
                console.log('[switchView] includes check:', currentDisplayedCaseIds.includes(currentCaseId));

                if (!currentCaseId || !currentDisplayedCaseIds.includes(currentCaseId)) {
                    if (currentDisplayedCaseIds.length > 0) {
                        currentCaseId = currentDisplayedCaseIds[0];
                        console.log('CRMË°®Á§∫: „É™„Çπ„Éà„ÅÆÊúÄÂàù„ÅÆÊ°à‰ª∂„ÇíËá™ÂãïÈÅ∏Êäû', currentCaseId);
                    }
                }

                console.log('[switchView] Final currentCaseId before load:', currentCaseId);
                if (currentCaseId) {
                    console.log('[switchView] Calling loadCRMContent with:', currentCaseId);
                    loadCRMContent(currentCaseId);
                    updateNavigationButtons();
                    updateCasePosition();
                } else {
                    console.log('[switchView] currentCaseId„Åå„Å™„ÅÑ„Åü„ÇÅloadCRMContent„Çí„Çπ„Ç≠„ÉÉ„Éó');
                }
            }
        }

        // ÂêçÂâç‚Üí„Ç´„Éä„ÅÆËá™ÂãïÂ§âÊèõÊ©üËÉΩ
        async function autoConvertNameToKana(name, kanaInput) {
            if (!name || name.trim() === '') {
                console.log('[KanaConversion] ÂêçÂâç„ÅåÁ©∫„ÅÆ„Åü„ÇÅ„Çπ„Ç≠„ÉÉ„Éó');
                return;
            }

            console.log('[KanaConversion] Ëá™ÂãïÂ§âÊèõÈñãÂßã:', name);

            // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
            const originalPlaceholder = kanaInput.placeholder;
            kanaInput.placeholder = 'Â§âÊèõ‰∏≠...';

            try {
                const result = await window.apiClient.postRequest('cv_convertNameToKana', {
                    name: name
                });

                if (result.success && result.kana) {
                    kanaInput.value = result.kana;
                    console.log('[KanaConversion] Â§âÊèõÊàêÂäü:', result.kana);

                    // ÂÄ§Ë®≠ÂÆöÂæå„Å´input„Ç§„Éô„É≥„Éà„ÇíÁô∫ÁÅ´„Åï„Åõ„Å¶Ëµ§Êû†„ÇíËß£Èô§
                    kanaInput.dispatchEvent(new Event('input', { bubbles: true }));

                    // Ëµ§Êû†„ÇíÂç≥Â∫ß„Å´Ëß£Èô§
                    kanaInput.classList.remove('border-red-500');
                    kanaInput.classList.add('border-gray-300');
                    kanaInput.style.borderWidth = '';

                    // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥ÂÜçÂÆüË°å
                    if (typeof validateEmptyFields === 'function') {
                        validateEmptyFields();
                    }
                } else {
                    console.error('[KanaConversion] Â§âÊèõÂ§±Êïó:', result.error);
                }
            } catch (error) {
                console.error('[KanaConversion] API„Ç®„É©„Éº:', error);
            } finally {
                // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ëß£Èô§
                kanaInput.placeholder = originalPlaceholder;
            }
        }


        // CRMË©≥Á¥∞„ÇíÈñã„Åè
        function openCRM(caseId) {
            console.log('openCRM called with caseId:', caseId);
            currentCaseId = caseId;
            switchView('crm');
        }

        // Êñ∞Ë¶èÊ°à‰ª∂„Çí‰ΩúÊàê
        function createNewCase() {
            // Êñ∞„Åó„ÅÑÊ°à‰ª∂ID„ÇíÁîüÊàêÔºà„Çø„Ç§„É†„Çπ„Çø„É≥„Éó„Éô„Éº„ÇπÔºâ
            const newCaseId = 'CASE-' + Date.now();

            // Á©∫„ÅÆÊ°à‰ª∂„Éá„Éº„Çø„Çí‰ΩúÊàê
            casesData[newCaseId] = {
                status: 'Êñ∞Ë¶è',
                name: '',
                phone: '',
                area: '',
                propertyType: 'Êà∏Âª∫„Å¶',
                floors: '2ÈöéÂª∫„Å¶',
                workItems: [],
                amount: '¬•0',
                age: '',
                gender: '',
                relationship: 'Êú¨‰∫∫',
                address: '',
                email: '',
                memo: [],
                callHistory: [],
                createdAt: new Date().toISOString(),
                isNew: true  // Êñ∞Ë¶è‰ΩúÊàê„Éï„É©„Ç∞
            };

            // Êñ∞Ë¶èÊ°à‰ª∂„ÇíCRM„ÅßÈñã„Åè
            currentCaseId = newCaseId;
            switchView('crm');

            // „Éï„Ç©„Éº„É†„Çí„ÇØ„É™„Ç¢
            clearCRMForm();

            // „Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÊñ∞Ë¶è„Å´Ë®≠ÂÆö
            document.getElementById('crmStatus').value = 'Êñ∞Ë¶è';

            // ÈÄöÁü•„ÇíË°®Á§∫
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
            notification.textContent = 'Êñ∞Ë¶èÊ°à‰ª∂„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü';
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // CRM„Éï„Ç©„Éº„É†„Çí„ÇØ„É™„Ç¢
        function clearCRMForm() {
            const crmContent = document.getElementById('crmContent');
            if (!crmContent) return;

            // „Åô„Åπ„Å¶„ÅÆÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„Çí„ÇØ„É™„Ç¢
            const inputs = crmContent.querySelectorAll('input[type="text"], input[type="tel"], input[type="email"], textarea');
            inputs.forEach(input => {
                input.value = '';
            });

            // „Åô„Åπ„Å¶„ÅÆ„Çª„É¨„ÇØ„Éà„Éú„ÉÉ„ÇØ„Çπ„ÇíÂàùÊúüÂÄ§„Å´Êàª„Åô
            const selects = crmContent.querySelectorAll('select');
            selects.forEach(select => {
                select.selectedIndex = 0;
            });

            // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Çí„Åô„Åπ„Å¶Â§ñ„Åô
            const checkboxes = crmContent.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });

            // „É©„Ç∏„Ç™„Éú„Çø„É≥„Çí„ÇØ„É™„Ç¢
            const radios = crmContent.querySelectorAll('input[type="radio"]');
            radios.forEach(radio => {
                radio.checked = false;
            });
        }

        // CRM„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆË™≠„ÅøËæº„Åø
        function loadCRMContent(caseId) {
            if (!caseId) {
                console.log('loadCRMContent: caseId„ÅåÊåáÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                return;
            }

            const caseData = casesData[caseId];
            if (!caseData) {
                console.log('loadCRMContent: caseData„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:', caseId);
                return;
            }

            // „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„ÉÉ„Ç∏„ÇíÊõ¥Êñ∞
            updateCRMStatusBadge(caseData.status);

            // CRM„Éì„É•„Éº„ÅÆ„É°„É¢„Éó„É¨„Éì„É•„Éº„ÇíÊõ¥Êñ∞
            const crmMemoPreview = document.getElementById('crmMemoPreview');
            if (crmMemoPreview) {
                crmMemoPreview.innerHTML = getMemoPreview(caseId).replace('text-gray-400', 'text-gray-300');
            }

            // ÂÖÉ„ÅÆ„Éï„Ç©„Éº„É†„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÂèñÂæó„Åó„Å¶CRM„Ç®„É™„Ç¢„Å´ÊåøÂÖ•
            const originalContentElement = document.getElementById('originalFormContent');
            if (originalContentElement) {
                // „Åô„Åπ„Å¶„ÅÆ„Éï„Ç©„Éº„É†„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÂèñÂæó„Åó„Å¶CRM„Ç®„É™„Ç¢„Å´ÊåøÂÖ•
                document.getElementById('crmContent').innerHTML = originalContentElement.innerHTML;
            }

            // Êñ∞Ë¶è‰ΩúÊàê„ÅÆÂ†¥Âêà„ÅØ„Éï„Ç©„Éº„É†„Çí„ÇØ„É™„Ç¢„ÄÅ„Åù„Çå‰ª•Â§ñ„ÅØÊó¢Â≠ò„Éá„Éº„Çø„ÇíÂèçÊò†
            if (caseData.isNew) {
                clearCRMForm();
                // Êñ∞Ë¶è‰ΩúÊàê„Éï„É©„Ç∞„ÇíÂâäÈô§
                delete caseData.isNew;
            } else {
                // „Éï„Ç©„Éº„É†„Å´Ê°à‰ª∂„Éá„Éº„Çø„ÇíÂèçÊò†Ôºà„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞‰ªò„ÅçÔºâ
                try {
                    populateForm(caseId);

                    // ÂêçÂâç„Åå„ÅÇ„Å£„Å¶„Ç´„Éä„ÅåÁ©∫„Å™„ÇâËá™ÂãïÂ§âÊèõ
                    console.log('[loadCRMContent] Ëá™ÂãïÂ§âÊèõ„ÉÅ„Çß„ÉÉ„ÇØ:', {
                        name: caseData.name,
                        nameKana: caseData.nameKana
                    });

                    if (caseData.name && caseData.name.trim() !== '' && (!caseData.nameKana || caseData.nameKana.trim() === '')) {
                        console.log('[loadCRMContent] Êù°‰ª∂ÂêàËá¥ - Â§âÊèõÂÆüË°å„Åó„Åæ„Åô');

                        // DOMÊõ¥Êñ∞Âæå„Å´ÂÆüË°å
                        setTimeout(() => {
                            const crmContent = document.getElementById('crmContent');
                            if (!crmContent) {
                                console.error('[loadCRMContent] crmContent„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                                return;
                            }

                            // „Ç´„ÉäÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„ÇíÂèñÂæóÔºà2Áï™ÁõÆ„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Éï„Ç£„Éº„É´„ÉâÔºâ
                            const kanaInput = crmContent.querySelectorAll('input[type="text"]')[1];
                            if (kanaInput) {
                                autoConvertNameToKana(caseData.name, kanaInput);
                            } else {
                                console.error('[loadCRMContent] „Ç´„ÉäÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                            }
                        }, 300);
                    } else {
                        console.log('[loadCRMContent] Â§âÊèõ„Çπ„Ç≠„ÉÉ„Éó - „Ç´„Éä„ÅåÊó¢„Å´Â≠òÂú®„Åô„Çã„ÅãÂêçÂâç„ÅåÁ©∫„Åß„Åô');
                    }
                } catch (e) {
                    console.log('„Éï„Ç©„Éº„É†„Éá„Éº„Çø„ÅÆÂèçÊò†„Åß„Ç®„É©„Éº:', e);
                }
            }

            // „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            updateNavigationButtons();
            // Ê°à‰ª∂‰ΩçÁΩÆË°®Á§∫„ÇíÊõ¥Êñ∞
            updateCasePosition();

            // CRM„Éï„Ç©„Éº„É†„ÅÆÂÖ•ÂäõÂ§âÊõ¥„ÇíÁõ£Ë¶ñ
            setupCRMFormChangeListeners(caseId);
        }

        // CRM„Éï„Ç©„Éº„É†„ÅÆÂÖ•ÂäõÂ§âÊõ¥„ÇíÁõ£Ë¶ñ„Åô„Çã„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆö
        function setupCRMFormChangeListeners(caseId) {
            const crmContent = document.getElementById('crmContent');
            if (!crmContent) return;

            // „Åô„Åπ„Å¶„ÅÆÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„Å´Â§âÊõ¥„Ç§„Éô„É≥„Éà„ÇíË®≠ÂÆö
            const inputs = crmContent.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', () => {
                    trackChange(caseId);
                });
                input.addEventListener('change', () => {
                    trackChange(caseId);
                });
            });

            // „Ç™„Éó„Ç∑„Éß„É≥„Éú„Çø„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„ÇÇÁõ£Ë¶ñ
            const optionButtons = crmContent.querySelectorAll('.option-button');
            optionButtons.forEach(button => {
                button.addEventListener('click', () => {
                    trackChange(caseId);
                });
            });

            console.log('[CRM] „Éï„Ç©„Éº„É†Â§âÊõ¥Áõ£Ë¶ñ„ÇíË®≠ÂÆö:', caseId);
        }

        // ‰øùÂ≠ò„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞Ôºà„ÉÄ„Éü„ÉºÈñ¢Êï∞Ôºâ
        function updateSaveButtonState() {
            // Êú™‰øùÂ≠òÂ§âÊõ¥„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„Éú„Çø„É≥„ÇíÊúâÂäπÂåñ„Åô„Çã„Å™„Å©„ÅÆÂá¶ÁêÜ
            // ÁèæÂú®„ÅØÁâπ„Å´Âá¶ÁêÜ„Å™„Åó
            console.log('[CRM] ‰øùÂ≠ò„Éú„Çø„É≥Áä∂ÊÖãÊõ¥Êñ∞:', unsavedChanges.size, '‰ª∂„ÅÆÊú™‰øùÂ≠òÂ§âÊõ¥');
        }

        // Â§âÊõ¥„ÇíËøΩË∑°
        function trackChange(caseId) {
            if (!unsavedChanges.has(caseId)) {
                unsavedChanges.set(caseId, { type: 'form' });
                updateSaveButtonState();
                console.log('[CRM] Â§âÊõ¥„ÇíË®òÈå≤:', caseId);
            }
        }

        // „ÇØ„Ç§„ÉÉ„ÇØ„Ç¢„ÇØ„Ç∑„Éß„É≥Ôºà„É™„Çπ„ÉàÁî®Ôºâ
        function quickActionList(action, caseId) {
            if (action === '‰∏çÂú®') casesData[caseId].status = '‰∏çÂú®';
            else if (action === 'ÂØæÂøú‰∏≠') casesData[caseId].status = 'ÈÖç‰ø°‰∏≠';
            else if (action === 'ÂÆå‰∫Ü') casesData[caseId].status = 'ÂÆå‰∫Ü';

            initializeListView();
        }

        // „Éá„Éº„ÇøÈÄÅ‰ø°Ê©üËÉΩ
        function sendData(caseId) {
            const caseData = casesData[caseId];
            if (!caseData) return;

            // ÈÄÅ‰ø°Âá¶ÁêÜÔºàÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Åß„ÅØAPI„Ç≥„Éº„É´„ÇíË°å„ÅÜÔºâ
            console.log(`Ê°à‰ª∂ ${caseId} „ÅÆ„Éá„Éº„Çø„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü`);

            // ÈÄöÁü•„ÇíË°®Á§∫
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
            notification.textContent = `üì§ „Éá„Éº„Çø„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü`;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);

            // „Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÊõ¥Êñ∞ÔºàÂøÖË¶Å„Å´Âøú„Åò„Å¶Ôºâ
            casesData[caseId].status = 'ÈÖç‰ø°Ê∏à';
            initializeListView();
        }

        // „ÇØ„Ç§„ÉÉ„ÇØ„Ç¢„ÇØ„Ç∑„Éß„É≥ÔºàCRMÁî®Ôºâ
        function quickActionCRM(status) {
            if (!currentCaseId) return;
            
            casesData[currentCaseId].status = status;
            
            // ‰∏çÂú®„ÉªÂÜçÊû∂Èõª„ÅÆÂ†¥Âêà„ÅØÊ¨°„ÅÆÊ°à‰ª∂„Å∏
            if (status === '‰∏çÂú®' || status === 'ÂÜçÊû∂Èõª') {
                nextCase();
            } else {
                loadCRMContent(currentCaseId);
            }
        }

        // „Åô„Åπ„Å¶Ë°®Á§∫
        function showAllCases() {
            currentStatusFilter = '';
            // ÈÅ∏ÊäûÁä∂ÊÖã„Çí„ÇØ„É™„Ç¢
            selectedStatuses = [];
            // „Éú„Çø„É≥„ÅÆË¶ã„ÅüÁõÆ„Çí„É™„Çª„ÉÉ„Éà
            updateStatusButtonStates();
            // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
            closeSortModal();
            // „Åô„Åπ„Å¶„ÅÆÊ°à‰ª∂„ÇíË°®Á§∫
            initializeListView();
        }

        // Ê¨°„ÅÆÊ°à‰ª∂„Å∏
        function nextCase() {
            const currentIndex = currentDisplayedCaseIds.indexOf(currentCaseId);
            if (currentIndex !== -1 && currentIndex < currentDisplayedCaseIds.length - 1) {
                currentCaseId = currentDisplayedCaseIds[currentIndex + 1];
                loadCRMContent(currentCaseId);
                updateNavigationButtons();
                updateCasePosition();
            }
        }

        // Ââç„ÅÆÊ°à‰ª∂„Å∏
        function previousCase() {
            const currentIndex = currentDisplayedCaseIds.indexOf(currentCaseId);
            if (currentIndex > 0) {
                currentCaseId = currentDisplayedCaseIds[currentIndex - 1];
                loadCRMContent(currentCaseId);
                updateNavigationButtons();
                updateCasePosition();
            }
        }

        // „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Éú„Çø„É≥„ÅÆÊúâÂäπ/ÁÑ°Âäπ„ÇíÊõ¥Êñ∞
        function updateNavigationButtons() {
            const currentIndex = currentDisplayedCaseIds.indexOf(currentCaseId);
            const prevButton = document.querySelector('button[onclick="previousCase()"]');
            const nextButton = document.querySelector('button[onclick="nextCase()"]');

            if (prevButton) {
                if (currentIndex <= 0) {
                    prevButton.disabled = true;
                    prevButton.classList.add('opacity-50', 'cursor-not-allowed');
                    prevButton.classList.remove('hover:bg-gray-50');
                } else {
                    prevButton.disabled = false;
                    prevButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    prevButton.classList.add('hover:bg-gray-50');
                }
            }

            if (nextButton) {
                if (currentIndex === -1 || currentIndex >= currentDisplayedCaseIds.length - 1) {
                    nextButton.disabled = true;
                    nextButton.classList.add('opacity-50', 'cursor-not-allowed');
                    nextButton.classList.remove('hover:bg-gray-50');
                } else {
                    nextButton.disabled = false;
                    nextButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    nextButton.classList.add('hover:bg-gray-50');
                }
            }
        }

        // Ê°à‰ª∂‰ΩçÁΩÆ„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞ÔºàCRMË°®Á§∫ÊôÇÔºâ
        function updateCasePosition() {
            const currentIndex = currentDisplayedCaseIds.indexOf(currentCaseId);
            const totalCases = currentDisplayedCaseIds.length;

            const currentPositionEl = document.getElementById('currentPosition');
            const totalCasesEl = document.getElementById('totalCases');

            if (currentPositionEl && totalCasesEl) {
                // „ÄåÂÖ®155‰ª∂‰∏≠ 5‰ª∂ÁõÆ„ÇíË°®Á§∫„ÄçÂΩ¢Âºè
                totalCasesEl.textContent = totalCases;
                currentPositionEl.textContent = currentIndex >= 0 ? (currentIndex + 1) : 0;
            }
        }

        // Ë¶ãÁ©ç„ÇÇ„ÇäÈÄÅ‰ªòÂÖà‰ΩèÊâÄ„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
        function toggleEstimateAddress() {
            const checkbox = document.getElementById('estimateAddressCheck');
            const addressArea = document.getElementById('estimateAddressArea');
            
            if (checkbox && addressArea) {
                if (checkbox.checked) {
                    addressArea.classList.remove('hidden');
                } else {
                    addressArea.classList.add('hidden');
                    // „ÉÅ„Çß„ÉÉ„ÇØ„ÇíÂ§ñ„Åó„Åü„Å®„Åç„ÅØÂÖ•ÂäõÂÜÖÂÆπ„ÇÇ„ÇØ„É™„Ç¢
                    document.getElementById('estimatePostalCode').value = '';
                    document.getElementById('estimateAddress').value = '';
                }
            }
        }
        
        // Ê•≠ËÄÖ„Ç´„Éº„Éâ„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØÂàá„ÇäÊõø„Åà
        function toggleFranchise(element) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            if (checkbox) {
                checkbox.checked = !checkbox.checked;
                if (checkbox.checked) {
                    element.classList.add('selected');
                } else {
                    element.classList.remove('selected');
                }
            }
        }
        
        // Ê•≠ËÄÖ„ÅÆ„ÇΩ„Éº„ÉàÊ©üËÉΩ
        function sortFranchises(sortType) {
            // „ÇΩ„Éº„Éà„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´Êõ¥Êñ∞
            document.querySelectorAll('.franchise-sort-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            const activeBtn = document.querySelector(`[data-sort="${sortType}"]`);
            if (activeBtn) {
                activeBtn.classList.remove('bg-gray-200', 'text-gray-700');
                activeBtn.classList.add('bg-blue-600', 'text-white');
            }
            
            // „Åì„Åì„ÅßÂÆüÈöõ„ÅÆ„ÇΩ„Éº„ÉàÂá¶ÁêÜ„ÇíÂÆüË£Ö
            console.log('Sorting by:', sortType);
            // TODO: ÂÆüÈöõ„ÅÆ„ÇΩ„Éº„ÉàÂá¶ÁêÜ
        }
        
        // Ê•≠ËÄÖÊ§úÁ¥¢Ê©üËÉΩ
        function searchFranchise(searchText) {
            const container = document.getElementById('franchiseListContainer');
            if (!container) return;
            
            const franchiseItems = container.querySelectorAll('.franchise-item');
            
            franchiseItems.forEach(item => {
                const name = item.querySelector('.font-semibold').textContent;
                const id = item.dataset.franchiseId;
                
                if (searchText === '' || 
                    name.toLowerCase().includes(searchText.toLowerCase()) || 
                    id.toLowerCase().includes(searchText.toLowerCase())) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        // ÈÉµ‰æøÁï™Âè∑„Åã„Çâ‰ΩèÊâÄ„ÇíÂèñÂæó
        async function fetchAddressFromPostal() {
            const postalCode = document.getElementById('estimatePostalCode').value;
            const addressInput = document.getElementById('estimateAddress');
            
            if (!postalCode) {
                alert('ÈÉµ‰æøÁï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            // ÈÉµ‰æøÁï™Âè∑„ÅÆ„Éï„Ç©„Éº„Éû„ÉÉ„Éà„ÇíÊï¥„Åà„ÇãÔºà„Éè„Ç§„Éï„É≥„ÇíÈô§ÂéªÔºâ
            const cleanPostalCode = postalCode.replace(/[^0-9]/g, '');
            
            if (cleanPostalCode.length !== 7) {
                alert('Ê≠£„Åó„ÅÑÈÉµ‰æøÁï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà7Ê°ÅÔºâ');
                return;
            }
            
            try {
                // ÈÉµ‰æøÁï™Âè∑API„Çí‰ΩøÁî®ÔºàÁÑ°Êñô„ÅÆzipcloud APIÔºâ
                const response = await fetch(`https://zipcloud.ibsnet.co.jp/api/search?zipcode=${cleanPostalCode}`);
                const data = await response.json();
                
                if (data.results && data.results.length > 0) {
                    const result = data.results[0];
                    const address = result.address1 + result.address2 + result.address3;
                    addressInput.value = address;
                } else {
                    alert('‰ΩèÊâÄ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
                }
            } catch (error) {
                console.error('‰ΩèÊâÄÂèñÂæó„Ç®„É©„Éº:', error);
                alert('‰ΩèÊâÄ„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        // Áµ±Ë®àÊÉÖÂ†±„ÅÆÊõ¥Êñ∞
        function updateStatistics() {
            const total = Object.keys(casesData).length;
            const completed = Object.values(casesData).filter(c => c.status === 'ÂÆå‰∫Ü').length;
            // null „ÉÅ„Çß„ÉÉ„ÇØ„ÇíËøΩÂä†
            const totalTodayElement = document.getElementById('totalToday');
            const completedTodayElement = document.getElementById('completedToday');

            if (totalTodayElement) {
                totalTodayElement.textContent = total;
            }
            if (completedTodayElement) {
                completedTodayElement.textContent = completed;
            }
        }
        
        // Ë≤°Âãô„Çø„ÉñÂàá„ÇäÊõø„Åà
        function switchFinancialTab(tabName) {
            // „Åô„Åπ„Å¶„ÅÆ„Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÈùûË°®Á§∫
            document.querySelectorAll('.financial-tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // „Åô„Åπ„Å¶„ÅÆ„Çø„Éñ„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´„Çí„É™„Çª„ÉÉ„Éà
            document.querySelectorAll('#financialTabs .tab-btn').forEach(btn => {
                btn.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
                btn.classList.add('text-gray-600', 'hover:text-gray-800');
            });
            
            // ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Éñ„ÇíË°®Á§∫
            const selectedTab = document.getElementById(tabName + 'Tab');
            if (selectedTab) {
                selectedTab.style.display = 'block';
            }
            
            // ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Éñ„Éú„Çø„É≥„Çí„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´
            const activeBtn = document.querySelector(`button[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.remove('text-gray-600', 'hover:text-gray-800');
                activeBtn.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
            }
        }
        
        // „Çπ„ÉØ„Ç§„ÉóÊ©üËÉΩ„ÅÆÂÆüË£Ö
        function initializeSwipeGesture() {
            const crmView = document.getElementById('crmView');
            if (!crmView) {
                console.log('CRM View not found for swipe');
                return;
            }
            
            let touchStartX = 0;
            let touchEndX = 0;
            let touchStartY = 0;
            let touchEndY = 0;
            
            // „Çø„ÉÉ„ÉÅÈñãÂßã
            crmView.addEventListener('touchstart', function(e) {
                touchStartX = e.changedTouches[0].screenX;
                touchStartY = e.changedTouches[0].screenY;
                console.log('Touch start:', touchStartX);
            }, { passive: true });
            
            // „Çø„ÉÉ„ÉÅÁµÇ‰∫Ü
            crmView.addEventListener('touchend', function(e) {
                touchEndX = e.changedTouches[0].screenX;
                touchEndY = e.changedTouches[0].screenY;
                console.log('Touch end:', touchEndX);
                handleSwipe();
            }, { passive: true });
            
            // „Éû„Ç¶„Çπ„Åß„ÇÇ„Çπ„ÉØ„Ç§„Éó„ÇíÂèØËÉΩ„Å´„Åô„ÇãÔºàPCÈñãÁô∫Áî®Ôºâ
            let mouseDown = false;
            let mouseStartX = 0;
            let mouseEndX = 0;
            
            crmView.addEventListener('mousedown', function(e) {
                mouseDown = true;
                mouseStartX = e.screenX;
                console.log('Mouse down:', mouseStartX);
            });
            
            crmView.addEventListener('mouseup', function(e) {
                if (mouseDown) {
                    mouseEndX = e.screenX;
                    console.log('Mouse up:', mouseEndX);
                    const diff = mouseEndX - mouseStartX;
                    handleMouseSwipe(diff);
                    mouseDown = false;
                }
            });
            
            // „Éû„Ç¶„Çπ„Åß„ÅÆ„Çπ„ÉØ„Ç§„ÉóÂá¶ÁêÜ
            function handleMouseSwipe(diff) {
                const swipeThreshold = 100; // „Éû„Ç¶„Çπ„ÅØÂ∞ë„ÅóÂ§ß„Åç„ÇÅ„ÅÆÈñæÂÄ§
                
                if (Math.abs(diff) > swipeThreshold) {
                    if (diff > 0) {
                        // Âè≥„Çπ„ÉØ„Ç§„ÉóÔºàÂâç„ÅÆÊ°à‰ª∂„Å∏Ôºâ
                        console.log('Right swipe detected (mouse)');
                        previousCase();
                    } else {
                        // Â∑¶„Çπ„ÉØ„Ç§„ÉóÔºàÊ¨°„ÅÆÊ°à‰ª∂„Å∏Ôºâ
                        console.log('Left swipe detected (mouse)');
                        nextCase();
                    }
                }
            }
            
            // „Çø„ÉÉ„ÉÅ„Åß„ÅÆ„Çπ„ÉØ„Ç§„ÉóÂá¶ÁêÜ
            function handleSwipe() {
                const swipeThreshold = 50; // ÊúÄÂ∞è„Çπ„ÉØ„Ç§„ÉóË∑ùÈõ¢
                const diffX = touchEndX - touchStartX;
                const diffY = Math.abs(touchEndY - touchStartY);
                
                // Á∏¶„Çπ„ÉØ„Ç§„Éó„Çà„ÇäÊ®™„Çπ„ÉØ„Ç§„Éó„ÅåÂ§ß„Åç„ÅÑÂ†¥Âêà„ÅÆ„Åø
                if (Math.abs(diffX) > swipeThreshold && Math.abs(diffX) > diffY) {
                    if (diffX > 0) {
                        // Âè≥„Çπ„ÉØ„Ç§„ÉóÔºàÂâç„ÅÆÊ°à‰ª∂„Å∏Ôºâ
                        console.log('Right swipe detected (touch)');
                        previousCase();
                    } else {
                        // Â∑¶„Çπ„ÉØ„Ç§„ÉóÔºàÊ¨°„ÅÆÊ°à‰ª∂„Å∏Ôºâ
                        console.log('Left swipe detected (touch)');
                        nextCase();
                    }
                }
            }
            
            console.log('Swipe gesture initialized');
        }

        // ÂàùÊúüÂåñÂá¶ÁêÜ
        document.addEventListener('DOMContentLoaded', function() {

            // CV‰∏ÄË¶ß„ÇíË™≠„ÅøËæº„ÅøÔºàÂÆü„Éá„Éº„ÇøÔºâ
            async function loadCasesData() {
                try {
                    console.log("[loadCasesData] CV‰∏ÄË¶ßË™≠„ÅøËæº„ÅøÈñãÂßã...");
                    
                    // CV‰∏ÄË¶ß„ÇíÂèñÂæó
                    const loadedCasesData = await window.CVListManager.loadAndConvert();
                    
                    // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Å´‰ª£ÂÖ•
                    Object.assign(casesData, loadedCasesData);
                    
                    console.log("[loadCasesData] CV‰∏ÄË¶ßË™≠„ÅøËæº„ÅøÂÆå‰∫Ü:", Object.keys(casesData).length, "‰ª∂");
                    
                    // „É™„Çπ„Éà„Éì„É•„Éº„ÇíÂÜçÂàùÊúüÂåñ
                    if (typeof initializeListView === "function") {
                        initializeListView();
                    }
                    if (typeof updateStatsCounts === "function") {
                        updateStatsCounts();
                    }
                    
                } catch (error) {
                    console.error("[loadCasesData] CV‰∏ÄË¶ßË™≠„ÅøËæº„Åø„Ç®„É©„Éº:", error);
                    // „Ç®„É©„ÉºÊôÇ„ÅØ„ÉÄ„Éü„Éº„Éá„Éº„Çø„Çí‰ΩøÁî®„Åô„Çã„Å™„Å©„ÄÅ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÂá¶ÁêÜ„ÇíÂÆüË£ÖÂèØËÉΩ
                }
            }
            
            // CV‰∏ÄË¶ß„ÇíÈùûÂêåÊúü„ÅßË™≠„ÅøËæº„Åø
            loadCasesData();
            console.log('=== DOMContentLoaded - ÂàùÊúüÂåñÈñãÂßã ===');
            console.log('casesData:', casesData);
            console.log('Total cases:', Object.keys(casesData).length);

            // ÂàùÊúü„ÅÆÊ°à‰ª∂ÁÆ°ÁêÜ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Çí‰øùÂ≠òÔºàÁèæÂú®Ë°®Á§∫„Åï„Çå„Å¶„ÅÑ„Çã„ÅÆ„ÅåÊ°à‰ª∂ÁÆ°ÁêÜÔºâ
            window.originalAssignmentContent = document.querySelector('main').innerHTML;

            // „Éè„ÉÉ„Ç∑„É•Âá¶ÁêÜ
            const hash = window.location.hash.slice(1);

            // URL„Å´„Éè„ÉÉ„Ç∑„É•„Åå„Å™„ÅÑÂ†¥Âêà„ÄÅ„Åæ„Åü„ÅØfranchise„ÅÆÂ†¥Âêà„ÅØÂä†ÁõüÂ∫óÁÆ°ÁêÜ„ÇíË°®Á§∫
            if (!hash || hash === 'franchise') {
                setTimeout(() => {
                    showSection('franchise');
                }, 100);
            } else if (hash === 'assignment') {
                // Ê°à‰ª∂ÁÆ°ÁêÜ„ÅÆÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑÔºàÊó¢„Å´Ë°®Á§∫„Åï„Çå„Å¶„ÅÑ„ÇãÔºâ
                console.log('Ê°à‰ª∂ÁÆ°ÁêÜ„ÇíË°®Á§∫‰∏≠');
            } else {
                // „Åù„ÅÆ‰ªñ„ÅÆ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
                setTimeout(() => {
                    showSection(hash);
                }, 100);
            }
            
            // Èñ¢Êï∞„ÅÆÂàùÊúüÂåñ
            try {
                // „É™„Çπ„Éà„Éì„É•„Éº„ÇíÂàùÊúüÂåñ
                if (typeof initializeListView === 'function') {
                    initializeListView();
                    console.log('‚úì initializeListView ÂÆüË°åÂÆå‰∫Ü');
                } else {
                    console.error('‚úó initializeListView is not defined');
                }
                
                // Ê§úÁ¥¢„Å®„Éï„Ç£„É´„Çø„Éº„ÇíÂàùÊúüÂåñ
                if (typeof initializeSearchAndFilter === 'function') {
                    initializeSearchAndFilter();
                    console.log('‚úì initializeSearchAndFilter ÂÆüË°åÂÆå‰∫Ü');
                } else {
                    console.error('‚úó initializeSearchAndFilter is not defined');
                }
                
                // Áµ±Ë®à„Ç´„Ç¶„É≥„Éà„ÇíÊõ¥Êñ∞
                if (typeof updateStatsCounts === 'function') {
                    updateStatsCounts();
                    console.log('‚úì updateStatsCounts ÂÆüË°åÂÆå‰∫Ü');
                } else {
                    console.error('‚úó updateStatsCounts is not defined');
                }
                
                // Áµ±Ë®à„ÇíÊõ¥Êñ∞
                if (typeof updateStatistics === 'function') {
                    updateStatistics();
                    console.log('‚úì updateStatistics ÂÆüË°åÂÆå‰∫Ü');
                } else {
                    console.error('‚úó updateStatistics is not defined');
                }
                
                // „Çø„Ç§„É†„Çπ„É≠„ÉÉ„Éà„Å®„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÅÆÂàùÊúüÂåñ
                if (typeof initializeTimeSlots === 'function') {
                    initializeTimeSlots();
                }
                if (typeof initializeCheckboxes === 'function') {
                    initializeCheckboxes();
                }
                
                // „Çπ„ÉØ„Ç§„ÉóÊ©üËÉΩ„ÅÆÂàùÊúüÂåñÔºàÁÑ°ÂäπÂåñÔºâ
                // if (typeof initializeSwipeGesture === 'function') {
                //     initializeSwipeGesture();
                //     console.log('‚úì initializeSwipeGesture ÂÆüË°åÂÆå‰∫Ü');
                // }

                // Êú™ÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„ÅÆËµ§Êû†Ë°®Á§∫Ôºà„É™„Ç¢„É´„Çø„Ç§„É†Êõ¥Êñ∞Ôºâ
                const crmContent = document.getElementById('crmContent');
                if (crmContent) {
                    // „Ç§„Éô„É≥„ÉàÂßîË≠≤„Çí‰ΩøÁî®„Åó„Å¶ÂãïÁöÑ„Å´„Éê„É™„Éá„Éº„Ç∑„Éß„É≥
                    crmContent.addEventListener('input', function(e) {
                        const target = e.target;
                        if (target.matches('input[type="text"], input[type="tel"], input[type="email"]')) {
                            validateEmptyFields();
                        }
                    });

                    crmContent.addEventListener('change', function(e) {
                        const target = e.target;
                        if (target.matches('select')) {
                            validateEmptyFields();
                        }
                    });

                    console.log('‚úì Êú™ÂÖ•Âäõ„Éï„Ç£„Éº„É´„ÉâÊ§úË®º„ÅÆÂàùÊúüÂåñÂÆå‰∫Ü');
                }

                console.log('=== ÂàùÊúüÂåñÂÆå‰∫Ü ===');
            } catch(e) {
                console.error('ÂàùÊúüÂåñ„Ç®„É©„Éº:', e);
            }
        });

        // „ÉÜ„Ç≠„Çπ„ÉàÊ≠£Ë¶èÂåñÈñ¢Êï∞Ôºà„Ç´„Éä„Éª„Åã„Å™„ÉªÂçäËßí„Ç´„Éä„ÉªÈõªË©±Áï™Âè∑ÂØæÂøúÔºâ
        function normalizeText(text) {
            if (!text) return '';

            let normalized = text.toLowerCase();

            // „Å≤„Çâ„Åå„Å™„Çí„Ç´„Çø„Ç´„Éä„Å´Â§âÊèõ
            normalized = normalized.replace(/[\u3041-\u3096]/g, function(match) {
                const chr = match.charCodeAt(0) + 0x60;
                return String.fromCharCode(chr);
            });

            // ÂçäËßí„Ç´„Éä„ÇíÂÖ®Ëßí„Ç´„Éä„Å´Â§âÊèõ
            const kanaMap = {
                'ÔΩ∂Ôæû':'„Ç¨','ÔΩ∑Ôæû':'„ÇÆ','ÔΩ∏Ôæû':'„Ç∞','ÔΩπÔæû':'„Ç≤','ÔΩ∫Ôæû':'„Ç¥',
                'ÔΩªÔæû':'„Ç∂','ÔΩºÔæû':'„Ç∏','ÔΩΩÔæû':'„Ç∫','ÔΩæÔæû':'„Çº','ÔΩøÔæû':'„Çæ',
                'ÔæÄÔæû':'„ÉÄ','ÔæÅÔæû':'„ÉÇ','ÔæÇÔæû':'„ÉÖ','ÔæÉÔæû':'„Éá','ÔæÑÔæû':'„Éâ',
                'ÔæäÔæû':'„Éê','ÔæãÔæû':'„Éì','ÔæåÔæû':'„Éñ','ÔæçÔæû':'„Éô','ÔæéÔæû':'„Éú',
                'ÔæäÔæü':'„Éë','ÔæãÔæü':'„Éî','ÔæåÔæü':'„Éó','ÔæçÔæü':'„Éö','ÔæéÔæü':'„Éù',
                'ÔΩ≥Ôæû':'„É¥','ÔæúÔæû':'„É∑','ÔΩ¶Ôæû':'„É∫',
                'ÔΩ±':'„Ç¢','ÔΩ≤':'„Ç§','ÔΩ≥':'„Ç¶','ÔΩ¥':'„Ç®','ÔΩµ':'„Ç™',
                'ÔΩ∂':'„Ç´','ÔΩ∑':'„Ç≠','ÔΩ∏':'„ÇØ','ÔΩπ':'„Ç±','ÔΩ∫':'„Ç≥',
                'ÔΩª':'„Çµ','ÔΩº':'„Ç∑','ÔΩΩ':'„Çπ','ÔΩæ':'„Çª','ÔΩø':'„ÇΩ',
                'ÔæÄ':'„Çø','ÔæÅ':'„ÉÅ','ÔæÇ':'„ÉÑ','ÔæÉ':'„ÉÜ','ÔæÑ':'„Éà',
                'ÔæÖ':'„Éä','ÔæÜ':'„Éã','Ôæá':'„Éå','Ôæà':'„Éç','Ôæâ':'„Éé',
                'Ôæä':'„Éè','Ôæã':'„Éí','Ôæå':'„Éï','Ôæç':'„Éò','Ôæé':'„Éõ',
                'Ôæè':'„Éû','Ôæê':'„Éü','Ôæë':'„É†','Ôæí':'„É°','Ôæì':'„É¢',
                'Ôæî':'„É§','Ôæï':'„É¶','Ôæñ':'„É®',
                'Ôæó':'„É©','Ôæò':'„É™','Ôæô':'„É´','Ôæö':'„É¨','Ôæõ':'„É≠',
                'Ôæú':'„ÉØ','ÔΩ¶':'„É≤','Ôæù':'„É≥',
                'ÔΩß':'„Ç°','ÔΩ®':'„Ç£','ÔΩ©':'„Ç•','ÔΩ™':'„Çß','ÔΩ´':'„Ç©',
                'ÔΩØ':'„ÉÉ','ÔΩ¨':'„É£','ÔΩ≠':'„É•','ÔΩÆ':'„Éß',
                'ÔΩ°':'„ÄÇ','ÔΩ¢':'„Äå','ÔΩ£':'„Äç','ÔΩ§':'„ÄÅ','ÔΩ•':'„Éª',
                'ÔΩ∞':'„Éº','Ôæû':'„Çõ','Ôæü':'„Çú'
            };

            let result = '';
            for (let i = 0; i < normalized.length; i++) {
                const c = normalized.charAt(i);
                const c2 = normalized.charAt(i + 1);
                if (kanaMap[c + c2]) {
                    result += kanaMap[c + c2];
                    i++;
                } else if (kanaMap[c]) {
                    result += kanaMap[c];
                } else {
                    result += c;
                }
            }

            // „Éè„Ç§„Éï„É≥„Éª„Çπ„Éö„Éº„Çπ„ÉªÊã¨Âºß„ÇíÂâäÈô§ÔºàÈõªË©±Áï™Âè∑„Éª‰ΩèÊâÄÊ§úÁ¥¢Áî®Ôºâ
            result = result.replace(/[-\s()ÔºàÔºâ]/g, '');

            return result;
        }

        // Ê§úÁ¥¢„ÇØ„É™„Ç¢
        function clearSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.value = '';
            const clearBtn = document.getElementById('clearSearchBtn');
            clearBtn.style.display = 'none';
            searchRegistrations(); // ÂÜç„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
        }

        // Âä†ÁõüÂ∫óÁôªÈå≤Áî≥Ë´ã„ÅÆÊ§úÁ¥¢Ê©üËÉΩÔºàÂº∑ÂåñÁâàÔºâ
        function searchRegistrations() {
            const searchInput = document.getElementById('searchInput');
            const searchTerm = normalizeText(searchInput.value);
            const clearBtn = document.getElementById('clearSearchBtn');

            // „ÇØ„É™„Ç¢„Éú„Çø„É≥„ÅÆË°®Á§∫/ÈùûË°®Á§∫
            clearBtn.style.display = searchInput.value ? 'block' : 'none';

            // Ê°à‰ª∂ÁÆ°ÁêÜ„Éì„É•„Éº„ÅÆÂ†¥ÂêàÔºàcasesData„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥ÂêàÔºâ
            if (typeof casesData !== 'undefined' && Object.keys(casesData).length > 0) {
                // „É™„Çπ„Éà„Éì„É•„Éº„ÅÆÂ†¥Âêà„ÅØ initializeListView() „ÇíÂëº„Å≥Áõ¥„Åô„Å†„Åë
                // ÔºàÊ§úÁ¥¢„Éï„Ç£„É´„Çø„ÅØ initializeListView() ÂÜÖ„ÅßËá™ÂãïÈÅ©Áî®„Åï„Çå„ÇãÔºâ
                if (currentView === 'list') {
                    initializeListView();
                    return;
                }

                // CRM„Éì„É•„Éº„ÅÆÂ†¥Âêà„ÅØ currentDisplayedCaseIds „ÇíÊõ¥Êñ∞
                const matchedCaseIds = [];

                if (searchTerm) {
                    // Ê§úÁ¥¢Êù°‰ª∂„Åå„ÅÇ„ÇãÂ†¥Âêà
                    Object.entries(casesData).forEach(([caseId, caseData]) => {
                        // Ê°à‰ª∂„Éá„Éº„Çø„ÇíÊñáÂ≠óÂàóÂåñ„Åó„Å¶Ê≠£Ë¶èÂåñ
                        const searchableText = normalizeText(
                            JSON.stringify([
                                caseData.name || '',
                                caseData.kana || '',
                                caseData.phone || '',
                                caseData.address || '',
                                caseData.postalCode || '',
                                caseData.prefecture || '',
                                caseData.city || '',
                                caseData.status || ''
                            ])
                        );

                        if (searchableText.includes(searchTerm)) {
                            matchedCaseIds.push(caseId);
                        }
                    });

                    // Ë©≤ÂΩìÊ°à‰ª∂„ÅåË¶ã„Å§„Åã„Å£„ÅüÂ†¥Âêà
                    if (matchedCaseIds.length > 0) {
                        // currentDisplayedCaseIds„ÇíË©≤ÂΩìÊ°à‰ª∂„ÅÆ„Åø„Å´Êõ¥Êñ∞
                        currentDisplayedCaseIds = matchedCaseIds;

                        // ÊúÄÂàù„ÅÆË©≤ÂΩìÊ°à‰ª∂„ÇíË°®Á§∫
                        const firstMatchedId = matchedCaseIds[0];
                        if (currentCaseId !== firstMatchedId) {
                            openCRM(firstMatchedId);
                        }
                        updateCasePosition();
                        updateNavigationButtons();
                    } else {
                        // Ë©≤ÂΩìÊ°à‰ª∂„Åå„Å™„ÅÑÂ†¥Âêà
                        currentDisplayedCaseIds = [];
                        updateCasePosition();
                        updateNavigationButtons();
                    }
                } else {
                    // Ê§úÁ¥¢Êù°‰ª∂„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÂÖ®‰ª∂Ë°®Á§∫
                    currentDisplayedCaseIds = Object.keys(casesData);
                    updateCasePosition();
                    updateNavigationButtons();
                }

                return; // Ê°à‰ª∂ÁÆ°ÁêÜ„Éì„É•„Éº„ÅÆÂá¶ÁêÜ„ÇíÁµÇ‰∫Ü
            }

            // ‰ª•‰∏ã„ÅØÂä†ÁõüÂ∫óÁôªÈå≤Áî≥Ë´ã„Éì„É•„Éº„ÅÆÂá¶ÁêÜ
            const pendingRows = document.querySelectorAll('#pending-table tbody tr');
            const approvedRows = document.querySelectorAll('#approved-table tbody tr');
            const franchiseMobileCards = document.querySelectorAll('#pending-mobile > div, #approved-mobile > div');

            // ÊâøË™çÂæÖ„Å°„ÉÜ„Éº„Éñ„É´„ÅÆ„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            pendingRows.forEach(row => {
                const text = normalizeText(row.textContent);
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });

            // ÊâøË™çÊ∏à„Åø„ÉÜ„Éº„Éñ„É´„ÅÆ„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            approvedRows.forEach(row => {
                const text = normalizeText(row.textContent);
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });

            // Âä†ÁõüÂ∫ó„É¢„Éê„Ç§„É´„Ç´„Éº„Éâ„ÅÆ„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            franchiseMobileCards.forEach(card => {
                const text = normalizeText(card.textContent);
                card.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // „É™„Çπ„Éà„Éì„É•„Éº„ÅÆÊ°à‰ª∂Ë°®Á§∫„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
        function filterListViewByCaseIds(caseIds) {
            // PCÁî®„ÉÜ„Éº„Éñ„É´Ë°å„ÅÆ„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            const caseRows = document.querySelectorAll('#casesListBody tr');
            caseRows.forEach(row => {
                const checkbox = row.querySelector('.case-checkbox');
                if (checkbox) {
                    const caseId = checkbox.getAttribute('data-case-id');
                    row.style.display = caseIds.includes(caseId) ? '' : 'none';
                } else {
                    // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Åå„Å™„ÅÑË°åÔºà„Éò„ÉÉ„ÉÄ„Éº„Å™„Å©Ôºâ„ÅØÈùûË°®Á§∫
                    row.style.display = 'none';
                }
            });

            // „É¢„Éê„Ç§„É´Áî®„Ç´„Éº„Éâ„ÅÆ„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            const caseMobileCards = document.querySelectorAll('#casesListMobile > div');
            caseMobileCards.forEach(card => {
                const cardText = card.textContent;
                const match = cardText.match(/#(CV[^#\s]+)/);
                if (match) {
                    const caseId = match[1];
                    card.style.display = caseIds.includes(caseId) ? '' : 'none';
                } else {
                    // Ê°à‰ª∂ID„Åå„Å™„ÅÑ„Ç´„Éº„Éâ„ÅØÈùûË°®Á§∫
                    card.style.display = 'none';
                }
            });

            // „É™„Çπ„Éà„Éì„É•„ÉºË°®Á§∫‰ª∂Êï∞„Ç´„Ç¶„É≥„Çø„Éº„ÇíÊõ¥Êñ∞
            updateListViewCounter(caseIds.length);
        }

        // „É™„Çπ„Éà„Éì„É•„ÉºË°®Á§∫‰ª∂Êï∞„Ç´„Ç¶„É≥„Çø„Éº„ÇíÊõ¥Êñ∞
        function updateListViewCounter(displayedCount) {
            const totalCount = Object.keys(casesData || {}).length;
            const topShowingFromEl = document.getElementById('topShowingFrom');
            const topShowingToEl = document.getElementById('topShowingTo');
            const topTotalCountEl = document.getElementById('topTotalCount');

            if (topShowingFromEl && topShowingToEl && topTotalCountEl) {
                if (displayedCount === 0) {
                    // Ê§úÁ¥¢ÁµêÊûú0‰ª∂„ÅÆÂ†¥Âêà
                    topShowingFromEl.textContent = '0';
                    topShowingToEl.textContent = '0';
                } else {
                    // Ê§úÁ¥¢ÁµêÊûú„Åå„ÅÇ„ÇãÂ†¥Âêà
                    topShowingFromEl.textContent = '1';
                    topShowingToEl.textContent = displayedCount;
                }
                topTotalCountEl.textContent = displayedCount;
            }
        }

        // ÈÄöÁü•Ë°®Á§∫Èñ¢Êï∞
        function showNotification(message, type = 'info') {
            // Êó¢Â≠ò„ÅÆÈÄöÁü•„ÇíÂâäÈô§
            const existingNotification = document.querySelector('.notification-toast');
            if (existingNotification) {
                existingNotification.remove();
            }

            // ÈÄöÁü•Ë¶ÅÁ¥†„Çí‰ΩúÊàê
            const notification = document.createElement('div');
            notification.className = 'notification-toast fixed top-20 right-4 z-50 px-6 py-3 rounded-lg shadow-lg transition-all transform translate-x-full';

            // „Çø„Ç§„Éó„Å´„Çà„Å£„Å¶Ëâ≤„ÇíÂ§âÊõ¥
            if (type === 'success') {
                notification.classList.add('bg-green-600', 'text-white');
            } else if (type === 'error') {
                notification.classList.add('bg-red-600', 'text-white');
            } else {
                notification.classList.add('bg-blue-600', 'text-white');
            }

            notification.textContent = message;
            document.body.appendChild(notification);

            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÅßË°®Á§∫
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
                notification.classList.add('translate-x-0');
            }, 100);

            // 3ÁßíÂæå„Å´ÂâäÈô§
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        // Âä†ÁõüÂ∫óÁÆ°ÁêÜ„ÅÆÊ§úÁ¥¢Ê©üËÉΩ
        function searchFranchises() {
            const searchTerm = document.getElementById('franchiseSearchInput')?.value.toLowerCase() || '';
            const statusFilter = document.getElementById('franchiseStatusFilter')?.value || 'all';

            console.log('Ê§úÁ¥¢ÂÆüË°å:', { searchTerm, statusFilter });

            // PCÁâà„ÉÜ„Éº„Éñ„É´Ë°å„ÅÆ„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            const tableRows = document.querySelectorAll('#franchise-table tbody tr');
            tableRows.forEach(row => {
                // ‰ºöÁ§æÂêç„Å®„Ç®„É™„Ç¢„ÇíÂèñÂæóÔºà1ÂàóÁõÆ„Å´‰ºöÁ§æÂêç„ÄÅ2ÂàóÁõÆ„Å´„Ç®„É™„Ç¢Ôºâ
                const companyCell = row.querySelector('td:nth-child(1)');
                const areaCell = row.querySelector('td:nth-child(2)');
                const statusSelect = row.querySelector('td:nth-child(6) select');

                const companyName = companyCell?.textContent.toLowerCase() || '';
                const area = areaCell?.textContent.toLowerCase() || '';
                const currentStatus = statusSelect?.value || '';

                // Ê§úÁ¥¢Êù°‰ª∂„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ
                const matchesSearch = searchTerm === '' || companyName.includes(searchTerm) || area.includes(searchTerm);

                // „Çπ„ÉÜ„Éº„Çø„ÇπÊù°‰ª∂„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ
                const matchesStatus = statusFilter === 'all' || currentStatus === statusFilter;

                // ‰∏°Êñπ„ÅÆÊù°‰ª∂„ÇíÊ∫Ä„Åü„ÅôÂ†¥Âêà„ÅÆ„ÅøË°®Á§∫
                row.style.display = (matchesSearch && matchesStatus) ? '' : 'none';
            });

            // „É¢„Éê„Ç§„É´Áâà„Ç´„Éº„Éâ„ÅÆ„Éï„Ç£„É´„Çø„É™„É≥„Ç∞ÔºàÊ≠£„Åó„ÅÑ„Çª„É¨„ÇØ„Çø„Éº„Çí‰ΩøÁî®Ôºâ
            const mobileCards = document.querySelectorAll('#franchise-mobile-container > div');
            console.log('„É¢„Éê„Ç§„É´„Ç´„Éº„ÉâÊï∞:', mobileCards.length);

            let visibleCount = 0;
            mobileCards.forEach(card => {
                // „Ç´„Éº„Éâ„Åå„Éá„Éº„ÇøË™≠„ÅøËæº„Åø‰∏≠„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÂ†¥Âêà„ÅØ„Çπ„Ç≠„ÉÉ„Éó
                if (card.textContent.includes('„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠')) {
                    return;
                }

                // ‰ºöÁ§æÂêç„ÇíÂèñÂæóÔºàÊúÄÂàù„ÅÆ font-semibold Ë¶ÅÁ¥†Ôºâ
                const nameElement = card.querySelector('.font-semibold');
                const companyName = nameElement?.textContent.toLowerCase() || '';

                // „Ç®„É™„Ç¢„ÇíÂèñÂæó
                const areaElement = Array.from(card.querySelectorAll('.flex.justify-between')).find(el =>
                    el.textContent.includes('„Ç®„É™„Ç¢:')
                );
                const area = areaElement?.querySelector('span:last-child')?.textContent.toLowerCase() || '';

                // „Çπ„ÉÜ„Éº„Çø„Çπ„Çª„É¨„ÇØ„Éà„Éú„ÉÉ„ÇØ„Çπ„ÇíÂèñÂæó
                const statusSelect = card.querySelector('select.status-select');
                const currentStatus = statusSelect?.value || '';

                // Ê§úÁ¥¢Êù°‰ª∂„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ
                const matchesSearch = searchTerm === '' || companyName.includes(searchTerm) || area.includes(searchTerm);

                // „Çπ„ÉÜ„Éº„Çø„ÇπÊù°‰ª∂„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ
                const matchesStatus = statusFilter === 'all' || currentStatus === statusFilter;

                // ‰∏°Êñπ„ÅÆÊù°‰ª∂„ÇíÊ∫Ä„Åü„ÅôÂ†¥Âêà„ÅÆ„ÅøË°®Á§∫
                const shouldShow = matchesSearch && matchesStatus;
                card.style.display = shouldShow ? '' : 'none';

                if (shouldShow) visibleCount++;

                console.log('„Ç´„Éº„Éâ:', {
                    companyName,
                    area,
                    currentStatus,
                    matchesSearch,
                    matchesStatus,
                    shouldShow
                });
            });

            console.log('Ë°®Á§∫‰∏≠„ÅÆ„Ç´„Éº„ÉâÊï∞:', visibleCount);
        }

        // „Çπ„ÉÜ„Éº„Çø„Çπ„Åß„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
        function filterFranchisesByStatus() {
            // searchFranchisesÈñ¢Êï∞„ÅßÁµ±ÂêàÂá¶ÁêÜ„Åô„Çã„ÅÆ„Åß„ÄÅ„Åù„Å°„Çâ„ÇíÂëº„Å≥Âá∫„Åô
            searchFranchises();
        }
    </script>
    </div> <!-- mainAppÁµÇ‰∫Ü -->

    <!-- „É≠„Ç∞„Ç§„É≥Âá¶ÁêÜ„Çπ„ÇØ„É™„Éó„Éà -->
    <script>
        // „É≠„Ç∞„Ç§„É≥Âá¶ÁêÜÔºà„Çµ„Éº„Éê„Éº„Çµ„Ç§„ÉâË™çË®ºÔºâ
        async function handleLogin(event) {
            event.preventDefault();

            const userId = document.getElementById('userId').value.trim();
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            const loginError = document.getElementById('loginError');
            const loginButton = event.target.querySelector('button[type="submit"]');

            // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥
            if (!userId || !password) {
                loginError.textContent = '„É¶„Éº„Ç∂„ÉºID„Å®„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                loginError.classList.remove('hidden');
                return;
            }

            // „É≠„Éº„Éá„Ç£„É≥„Ç∞Áä∂ÊÖã
            const originalButtonText = loginButton.textContent;
            loginButton.disabled = true;
            loginButton.textContent = '„É≠„Ç∞„Ç§„É≥‰∏≠...';
            loginError.classList.add('hidden');

            try {
                // apiClient„ÅåÂà©Áî®ÂèØËÉΩ„Å´„Å™„Çã„Åæ„ÅßÂæÖÊ©ü
                const waitForApiClient = async () => {
                    const maxWait = 5000; // 5Áßí
                    const startTime = Date.now();

                    while (typeof window.apiClient === 'undefined' || !window.apiClient) {
                        if (Date.now() - startTime > maxWait) {
                            throw new Error('API„ÇØ„É©„Ç§„Ç¢„É≥„Éà„ÅÆÂàùÊúüÂåñ„Åå„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                        }
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                    return window.apiClient;
                };

                const client = await waitForApiClient();

                // „Éá„Éê„ÉÉ„Ç∞ÔºöÁí∞Â¢ÉÂ§âÊï∞„Å®GAS URL„ÇíÁ¢∫Ë™ç
                console.log('[Login] ENV:', window.ENV);
                console.log('[Login] GAS_URL:', window.ENV?.GAS_URL);
                console.log('[Login] ApiClient baseUrl:', client.baseUrl);

                // „Çπ„Éû„Éõ„Éá„Éê„ÉÉ„Ç∞Áî®ÔºöÁí∞Â¢ÉÊÉÖÂ†±„Çí„Ç¢„É©„Éº„ÉàË°®Á§∫
                if (!window.ENV || !window.ENV.GAS_URL) {
                    alert('Áí∞Â¢ÉÂ§âÊï∞„Ç®„É©„Éº\nENV: ' + (window.ENV ? 'OK' : 'NG') + '\nGAS_URL: ' + (window.ENV?.GAS_URL || 'undefined'));
                    throw new Error('Áí∞Â¢ÉÂ§âÊï∞„ÅåÊ≠£„Åó„ÅèË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                }

                // GAS API„ÅßË™çË®ºÔºàJSONPÊñπÂºèÔºâ
                const result = await client.jsonpRequest('verifyAdminLogin', {
                    userId: userId,
                    password: password
                });

                // „É¨„Çπ„Éù„É≥„Çπ„ÅÆÊàêÂäü„ÉÅ„Çß„ÉÉ„ÇØ
                if (!result.success) {
                    throw new Error(result.message || '„É≠„Ç∞„Ç§„É≥„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }

                // „É≠„Ç∞„Ç§„É≥ÊàêÂäü
                console.log('[Login] Ë™çË®ºÊàêÂäü:', result);

                // „Çª„ÉÉ„Ç∑„Éß„É≥„Åæ„Åü„ÅØ„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò
                const storage = rememberMe ? localStorage : sessionStorage;
                storage.setItem('isLoggedIn', 'true');
                storage.setItem('userId', result.userId || userId);
                storage.setItem('loginTime', result.loginTime || new Date().toISOString());

                // „É≠„Ç∞„Ç§„É≥ÁîªÈù¢„ÇíÈùûË°®Á§∫„ÄÅ„É°„Ç§„É≥„Ç¢„Éó„É™„ÇíË°®Á§∫
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').classList.remove('hidden');

                // ÂàùÊúüÂåñÂá¶ÁêÜ„ÇíÂÆüË°å
                if (typeof initializeListView === 'function') {
                    initializeListView();
                }

            } catch (error) {
                // „É≠„Ç∞„Ç§„É≥Â§±Êïó
                console.error('[Login] Ë™çË®º„Ç®„É©„Éº:', error);
                loginError.textContent = error.message || '„É≠„Ç∞„Ç§„É≥„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„É¶„Éº„Ç∂„ÉºID„Å®„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                loginError.classList.remove('hidden');

                // „Éë„Çπ„ÉØ„Éº„Éâ„Éï„Ç£„Éº„É´„Éâ„Çí„ÇØ„É™„Ç¢
                document.getElementById('password').value = '';

            } finally {
                // „Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
                loginButton.disabled = false;
                loginButton.textContent = originalButtonText;
            }
        }
        
        // „É≠„Ç∞„Ç¢„Ç¶„ÉàÂá¶ÁêÜ
        function logout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userId');
            localStorage.removeItem('loginTime');
            sessionStorage.clear();
            location.reload();
        }
        
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆË™çË®º„ÉÅ„Çß„ÉÉ„ÇØ
        window.addEventListener('DOMContentLoaded', function() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') || sessionStorage.getItem('isLoggedIn');
            
            if (isLoggedIn === 'true') {
                // Êó¢„Å´„É≠„Ç∞„Ç§„É≥Ê∏à„Åø
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').classList.remove('hidden');
                
                // ÂàùÊúüÂåñÂá¶ÁêÜ„ÇíÂÆüË°å
                if (typeof initializeListView === 'function') {
                    initializeListView();
                }
            }
        });
    </script>
    <!-- ÁÆ°ÁêÜ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ APIÈÄ£Êê∫ -->
    <!-- Êñ∞„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£ v2.0 - Fixed: JSONP-only CORS fix -->
    <script>
(function() {
  const cacheBuster = new Date().getTime();

  // env-loader.js „ÇíÂãïÁöÑ„É≠„Éº„Éâ
  const envScript = document.createElement("script");
  envScript.src = "js/env-loader.js?v=" + cacheBuster;
  document.write("<script src=\"" + envScript.src + "\"><\/script>");

  // api-client.js „ÇíÂãïÁöÑ„É≠„Éº„Éâ
  const apiScript = document.createElement("script");
  apiScript.src = "js/api-client.js?v=" + cacheBuster;
  document.write("<script src=\"" + apiScript.src + "\"><\/script>");

  // ApiClient „Ç§„É≥„Çπ„Çø„É≥„Çπ‰ΩúÊàêÔºàENV„Å®ApiClient„Åå‰∏°Êñπ„É≠„Éº„Éâ„Åï„Çå„ÅüÂæåÔºâ
  document.write("<script>(function initApiClient() {" +
    "const maxRetries = 50;" +
    "let retries = 0;" +
    "function tryInit() {" +
      "if (window.ENV && window.ApiClient) {" +
        "window.apiClient = new ApiClient();" +
        "console.log('[Admin] ApiClient initialized');" +
      "} else {" +
        "retries++;" +
        "if (retries < maxRetries) {" +
          "setTimeout(tryInit, 100);" +
        "} else {" +
          "console.error('[Admin] Failed to initialize ApiClient after ' + maxRetries + ' retries');" +
        "}" +
      "}" +
    "}" +
    "tryInit();" +
  "})();<\/script>");
})();
</script>
    <!-- dashboard-api.js „ÅØ registration-requests.js „Å´Áµ±ÂêàÊ∏à„Åø„ÅÆ„Åü„ÇÅÁÑ°ÂäπÂåñ -->
    <!-- <script src="js/dashboard-api.js?v=20251016_1615"></script> -->
    <script src="js/data-formatter.js?v=V1402-JSONP-ONLY"></script>
    <script src="js/registration-requests.js?v=V1402-JSONP-ONLY"></script>
    <script src="js/franchise-management.js?v=V1553-20251103"></script>
    <!-- Êóß„Ç∑„Çπ„ÉÜ„É†ÔºàÁÑ°ÂäπÂåñÔºâ -->
    <!-- <script src="js/gas-config.js?v=20250926_1800"></script> -->
    <!-- <script src="js/dashboard-api.js?v=20250926_1800"></script> -->
    <script>
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÂÆå‰∫ÜÂæå„Å´„Éá„Éº„Çø„ÇíÂèñÂæó
        document.addEventListener('DOMContentLoaded', function() {
            // „É≠„Ç∞„Ç§„É≥Âæå„ÅÆ„Åø„Éá„Éº„ÇøÂèñÂæó
            const isLoggedIn = sessionStorage.getItem('isLoggedIn') || localStorage.getItem('isLoggedIn');

            if (isLoggedIn) {
                // „É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Çå„Å∞Âç≥Â∫ß„Å´„Éá„Éº„ÇøÂèñÂæóÔºà„Éê„ÉÉ„Ç∏Êõ¥Êñ∞„ÅÆ„Åü„ÇÅÔºâ
                setTimeout(() => {
                    // registration-requests.js„ÅÆÈñ¢Êï∞„ÇíÂëº„Å≥Âá∫„Åó
                    if (typeof loadRegistrationRequestsData === 'function') {
                        loadRegistrationRequestsData();
                    } else if (typeof refreshDashboard === 'function') {
                        refreshDashboard();
                    } else if (window.dashboardAPI && typeof window.dashboardAPI.refreshDashboard === 'function') {
                        window.dashboardAPI.refreshDashboard();
                    }
                }, 100); // 100ms„ÅÆÈÅÖÂª∂„ÅßÁ¢∫ÂÆü„Å´Èñ¢Êï∞„ÅåÂà©Áî®ÂèØËÉΩ„Å´„Å™„Çã„Åæ„ÅßÂæÖ„Å§
            }

            // ÊúüÈñìÈÅ∏Êäû„Çª„É¨„ÇØ„Çø„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
            const dateRangeSelector = document.getElementById('dateRangeSelector');
            if (dateRangeSelector) {
                dateRangeSelector.addEventListener('change', function() {
                    console.log('ÊúüÈñìÂ§âÊõ¥:', dateRangeSelector.value + 'Êó•');
                    if (typeof refreshDashboard === 'function') {
                        refreshDashboard();
                    }
                });
            }
        });

        // „Éè„ÉÉ„Ç∑„É•Â§âÊõ¥ÊôÇ„Å´Âç≥Â∫ß„Å´„Éá„Éº„ÇøÂèñÂæó
        window.addEventListener('hashchange', function() {
            const isLoggedIn = sessionStorage.getItem('isLoggedIn') || localStorage.getItem('isLoggedIn');

            // „Éö„Éº„Ç∏ÈÅ∑Áßª„Åó„Åü„ÇâÂç≥Â∫ß„Å´„Éá„Éº„ÇøÊõ¥Êñ∞
            if (isLoggedIn) {
                console.log('„Éö„Éº„Ç∏ÈÅ∑ÁßªÊ§úÁü• - „Éá„Éº„ÇøÂç≥ÊôÇÂèñÂæó');
                if (typeof refreshDashboard === 'function') {
                    refreshDashboard();
                } else if (window.dashboardAPI && typeof window.dashboardAPI.refreshDashboard === 'function') {
                    window.dashboardAPI.refreshDashboard();
                }
            }
        });

    </script>

    <!-- Â§ñÈÉ®JS„Éï„Ç°„Ç§„É´Ë™≠„ÅøËæº„Åø (V1760) - ÂãïÁöÑ„É≠„Éº„Éâ -->
    <script>
    (function() {
        const cacheBuster = new Date().getTime();
        document.write('<script src="js/cv-data-handler.js?v=' + cacheBuster + '"><\/script>');
        document.write('<script src="js/fee-calculator.js?v=' + cacheBuster + '"><\/script>');
        document.write('<script src="js/cv-list-manager.js?v=' + cacheBuster + '"><\/script>');
    })();
    </script>
</body>
</html><!-- Test auto-deploy Fri Oct 31 16:40:05 JST 2025 -->
