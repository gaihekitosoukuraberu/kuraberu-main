<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒ—ãƒ­ã‚¤ç¢ºèªãƒ„ãƒ¼ãƒ« - Admin Dashboard</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .check-item {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #ccc;
        }
        .check-item.success {
            background: #d4edda;
            border-color: #28a745;
        }
        .check-item.error {
            background: #f8d7da;
            border-color: #dc3545;
        }
        .check-item.info {
            background: #d1ecf1;
            border-color: #17a2b8;
        }
        .check-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .check-detail {
            font-size: 0.9em;
            color: #666;
            word-break: break-all;
        }
        .actions {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        .button {
            display: inline-block;
            padding: 10px 20px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
        }
        .button:hover {
            background: #0056b3;
        }
        .code-block {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 0.85em;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Admin Dashboard ãƒ‡ãƒ—ãƒ­ã‚¤ç¢ºèª</h1>

        <div id="results">
            <p>ãƒã‚§ãƒƒã‚¯ä¸­...</p>
        </div>

        <div class="actions">
            <button class="button" onclick="runCheck()">å†ãƒã‚§ãƒƒã‚¯</button>
            <button class="button" onclick="location.reload()">ãƒªãƒ­ãƒ¼ãƒ‰</button>
            <a href="index.html" class="button">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸</a>
        </div>
    </div>

    <script src="js/env-loader.js"></script>
    <script>
        // æœŸå¾…ã•ã‚Œã‚‹æ­£ã—ã„å€¤
        const EXPECTED_VALUES = {
            GAS_URL: 'https://script.google.com/macros/s/AKfycbzAoTXkkw6vltB2uNAsEsFUQ_sToWKOuraH7Zr3d9yZeaV_ncrEWbIjUtVJ7DqQg93FQw/exec',
            CACHE_BUSTER: '1731855720000',
            VERSION: 'V1816'
        };

        // å•é¡Œã®ã‚ã‚‹å¤ã„URLä¸€è¦§
        const OLD_URLS = [
            'AKfycbxGBYjSiaHmFj',  // åˆ‡ã‚Œã¦ã„ã‚‹URL
            'AKfycbxGBYjSiaHG2W7RrRyBBwRldeDDlbC0ILnCu75T-mFj',  // æ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³
            'AKfycbwBOj5KN_lIXxopGqRukr9GqHbPmxbENMttY0FTfZgc'  // æ›´ã«å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³
        ];

        function runCheck() {
            const results = document.getElementById('results');
            results.innerHTML = '';

            let allGood = true;

            // 1. ENVèª­ã¿è¾¼ã¿ãƒã‚§ãƒƒã‚¯
            if (!window.ENV) {
                results.innerHTML += createCheckItem(
                    'error',
                    'âŒ ENVæœªèª­ã¿è¾¼ã¿',
                    'window.ENVãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚env-loader.jsãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚'
                );
                allGood = false;
                return;
            } else {
                results.innerHTML += createCheckItem(
                    'success',
                    'âœ… ENVèª­ã¿è¾¼ã¿æˆåŠŸ',
                    'window.ENVãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™'
                );
            }

            // 2. GAS_URLãƒã‚§ãƒƒã‚¯
            const currentUrl = window.ENV.GAS_URL;
            if (!currentUrl) {
                results.innerHTML += createCheckItem(
                    'error',
                    'âŒ GAS_URLæœªè¨­å®š',
                    'GAS_URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“'
                );
                allGood = false;
            } else if (currentUrl === EXPECTED_VALUES.GAS_URL) {
                results.innerHTML += createCheckItem(
                    'success',
                    'âœ… GAS_URLæ­£å¸¸',
                    `æ­£ã—ã„URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ï¼š<div class="code-block">${currentUrl}</div>`
                );
            } else if (OLD_URLS.some(oldUrl => currentUrl.includes(oldUrl))) {
                results.innerHTML += createCheckItem(
                    'error',
                    'âŒ GAS_URLãŒå¤ã„',
                    `<strong>ã“ã‚ŒãŒå•é¡Œã®åŸå› ã§ã™ï¼</strong><br>` +
                    `ç¾åœ¨ã®URLï¼š<div class="code-block">${currentUrl}</div>` +
                    `æ­£ã—ã„URLï¼š<div class="code-block">${EXPECTED_VALUES.GAS_URL}</div>` +
                    `<strong>å¯¾å‡¦æ–¹æ³•ï¼š</strong><br>` +
                    `1. ãƒ­ãƒ¼ã‚«ãƒ«ã® admin-dashboard/js/env-loader.js ã‚’ã‚µãƒ¼ãƒãƒ¼ã«å†ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰<br>` +
                    `2. ã‚µãƒ¼ãƒãƒ¼ä¸Šã®å¤ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¦ã‹ã‚‰æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰<br>` +
                    `3. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢`
                );
                allGood = false;
            } else {
                results.innerHTML += createCheckItem(
                    'error',
                    'âŒ GAS_URLãŒä¸æ­£',
                    `ç¾åœ¨ã®URLï¼š<div class="code-block">${currentUrl}</div>` +
                    `æœŸå¾…ã•ã‚Œã‚‹URLï¼š<div class="code-block">${EXPECTED_VALUES.GAS_URL}</div>`
                );
                allGood = false;
            }

            // 3. CACHE_BUSTERãƒã‚§ãƒƒã‚¯
            const currentCacheBuster = window.ENV.CACHE_BUSTER;
            if (currentCacheBuster === EXPECTED_VALUES.CACHE_BUSTER) {
                results.innerHTML += createCheckItem(
                    'success',
                    'âœ… CACHE_BUSTERæœ€æ–°',
                    `ãƒãƒ¼ã‚¸ãƒ§ãƒ³: ${EXPECTED_VALUES.VERSION} (${currentCacheBuster})`
                );
            } else {
                results.innerHTML += createCheckItem(
                    'error',
                    'âŒ CACHE_BUSTERãŒå¤ã„',
                    `ç¾åœ¨: ${currentCacheBuster}<br>æœ€æ–°: ${EXPECTED_VALUES.CACHE_BUSTER}`
                );
                allGood = false;
            }

            // 4. ãã®ä»–ã®URLãƒã‚§ãƒƒã‚¯
            results.innerHTML += createCheckItem(
                'info',
                'â„¹ï¸ ãã®ä»–ã®URLè¨­å®š',
                `ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯URL: <div class="code-block">${window.ENV.FALLBACK_GAS_URL || 'æœªè¨­å®š'}</div>` +
                `ç·Šæ€¥æ™‚URL: <div class="code-block">${window.ENV.EMERGENCY_GAS_URL || 'æœªè¨­å®š'}</div>`
            );

            // 5. ç·åˆåˆ¤å®š
            if (allGood) {
                results.innerHTML += createCheckItem(
                    'success',
                    'ğŸ‰ ã™ã¹ã¦æ­£å¸¸',
                    'ãƒ‡ãƒ—ãƒ­ã‚¤ã¯æ­£ã—ãå®Œäº†ã—ã¦ã„ã¾ã™ã€‚ã‚¹ãƒãƒ›ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã¯ãšã§ã™ã€‚<br>' +
                    'ãã‚Œã§ã‚‚ãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„å ´åˆã¯ã€iPhoneã®Safariã§ï¼š<br>' +
                    '1. è¨­å®š > Safari > å±¥æ­´ã¨Webã‚µã‚¤ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆå»<br>' +
                    '2. Safariã‚¢ãƒ—ãƒªã‚’å®Œå…¨çµ‚äº†ï¼ˆãƒãƒ«ãƒã‚¿ã‚¹ã‚¯ç”»é¢ã‹ã‚‰ä¸Šã«ã‚¹ãƒ¯ã‚¤ãƒ—ï¼‰<br>' +
                    '3. Safariå†èµ·å‹•ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³'
                );
            } else {
                results.innerHTML += createCheckItem(
                    'error',
                    'âš ï¸ ãƒ‡ãƒ—ãƒ­ã‚¤ã«å•é¡Œã‚ã‚Š',
                    'ä¸Šè¨˜ã®ã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚ç‰¹ã«GAS_URLã®å•é¡Œã‚’å„ªå…ˆçš„ã«è§£æ±ºã—ã¦ãã ã•ã„ã€‚'
                );
            }

            // ãƒ‡ãƒãƒƒã‚°æƒ…å ±
            results.innerHTML += createCheckItem(
                'info',
                'ğŸ”§ ãƒ‡ãƒãƒƒã‚°æƒ…å ±',
                `ãƒ–ãƒ©ã‚¦ã‚¶: ${navigator.userAgent}<br>` +
                `ç¾åœ¨æ™‚åˆ»: ${new Date().toLocaleString('ja-JP')}<br>` +
                `ENVå…¨ä½“:<div class="code-block">${JSON.stringify(window.ENV, null, 2)}</div>`
            );
        }

        function createCheckItem(type, title, detail) {
            return `
                <div class="check-item ${type}">
                    <div class="check-title">${title}</div>
                    <div class="check-detail">${detail}</div>
                </div>
            `;
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
        window.addEventListener('load', () => {
            setTimeout(runCheck, 500);
        });
    </script>
</body>
</html>
