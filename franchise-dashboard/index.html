<!-- V2024-12-04-DEBUG -->
<html lang="ja"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âä†ÁõüÂ∫óÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É† - Â§ñÂ£ÅÂ°óË£Ö„Åè„Çâ„Åπ„ÇãAI</title>
    <link rel="icon" type="image/png" href="images/5.png">
    <script>
console.log('üî• V2024-12-04-DEBUG: „Éï„Ç°„Ç§„É´Êõ¥Êñ∞Á¢∫Ë™ç');
(function() {
  const cacheBuster = new Date().getTime();
  document.write("<script src=\"/js/env-loader.js?v=" + cacheBuster + "\"><\/script>");
  document.write("<script src=\"merchant-portal/cancel-reasons.js?v=" + cacheBuster + "\"><\/script>");
})();
</script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gray: {
                            50: '#f9fafb',
                            100: '#f3f4f6',
                            200: '#e5e7eb',
                            300: '#d1d5db',
                            400: '#9ca3af',
                            500: '#6b7280',
                            600: '#4b5563',
                            700: '#374151',
                            800: '#1f2937',
                            900: '#111827',
                        }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; }
        .glass { backdrop-filter: blur(12px); }
        .section {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
            min-height: 200px;
        }
        .permission-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        /* „Éà„Ç∞„É´„Çπ„Ç§„ÉÉ„ÉÅ„ÅÆ„Çπ„Çø„Ç§„É´ */
        .toggle-switch {
            position: relative;
            appearance: none;
            width: 44px;
            height: 24px;
            background: #cbd5e0;
            border-radius: 9999px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .toggle-switch:checked {
            background: #3b82f6;
        }
        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s;
        }
        .toggle-switch:checked::after {
            transform: translateX(20px);
        }

        /* ‰ºöÁ§æÊÉÖÂ†±„ÉªËá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥„Éò„ÉÉ„ÉÄ„Éº„ÅÆ„É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
        @media (max-width: 768px) {
            /* „É°„Ç§„É≥„Éò„ÉÉ„ÉÄ„ÉºÔºà‰ºöÁ§æÊÉÖÂ†±„Çø„Ç§„Éà„É´„Å®„Éó„É¨„Éì„É•„Éº„Éú„Çø„É≥Ôºâ */
            .flex.justify-between.items-start {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 1rem !important;
            }

            .flex.justify-between.items-start > div {
                order: 1;
                width: 100%;
            }

            .flex.justify-between.items-start > button {
                order: 2;
                width: 100%;
                justify-content: center !important;
                padding: 0.75rem 1rem;
            }

            /* ÂêÑ„Çª„ÇØ„Ç∑„Éß„É≥„Éò„ÉÉ„ÉÄ„Éº */
            .section-header {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 0.75rem !important;
            }

            .section-header h3 {
                margin-bottom: 0 !important;
                order: 1;
            }

            .section-header .flex {
                order: 2;
                width: 100%;
                justify-content: flex-start !important;
            }

            .section-header .flex button {
                flex: 1;
                min-width: 80px;
                font-size: 0.875rem;
                padding: 0.5rem 0.75rem;
            }

            /* „Åù„ÅÆ‰ªñ„ÅÆË≥áÊ†º„Éª‰øùÈô∫ÂÖ•ÂäõÊ¨Ñ„ÅÆ„É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
            #customQualifications,
            #customInsurance {
                flex-direction: column !important;
                gap: 0.5rem !important;
            }

            #customQualifications input,
            #customInsurance input {
                width: 100% !important;
                margin-bottom: 0.5rem;
            }

            #customQualifications button,
            #customInsurance button {
                width: 100% !important;
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
            }

            /* Ë´ãÊ±ÇÁî®„É°„Éº„É´„Ç¢„Éâ„É¨„ÇπÂÖ•ÂäõÊ¨Ñ„ÅÆ„É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
            .billing-email-item .flex {
                flex-direction: column !important;
                gap: 0.5rem !important;
            }

            .billing-email-item input {
                width: 100% !important;
                margin-bottom: 0.5rem;
            }

            .billing-email-item button {
                width: 100% !important;
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
                justify-content: center !important;
            }

            /* Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅÆ„Ç®„É™„Ç¢ÈÅ∏Êäû„Ç∞„É™„ÉÉ„Éâ„Çí„Çπ„Éû„ÉõÁî®„Å´Ë™øÊï¥ */
            #allPrefecturesGrid {
                grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
                gap: 0.5rem !important;
            }
            #allPrefecturesGrid .area-item {
                padding: 0.5rem !important;
                font-size: 0.75rem !important;
            }

            /* Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅÆÁâ©‰ª∂Á®ÆÂà•ÈÅ∏Êäû„ÅÆ„É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
            #propertyTypesEdit .space-y-3 label {
                padding: 0.75rem !important;
            }
            #propertyTypesEdit .space-y-3 label .flex-1 {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 0.5rem !important;
            }
            #propertyTypesEdit .space-y-3 label select {
                margin-left: 0 !important;
                width: 100% !important;
                margin-top: 0.5rem !important;
            }

            /* ÊñΩÂ∑•ÁÆáÊâÄ„ÅÆ„Ç∞„É™„ÉÉ„Éâ„É¨„Ç§„Ç¢„Ç¶„Éà„Çí„É¢„Éê„Ç§„É´Áî®„Å´Ë™øÊï¥ */
            #constructionAreasEdit .grid-cols-1.md\\:grid-cols-2 {
                grid-template-columns: repeat(1, minmax(0, 1fr)) !important;
            }

            /* ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ„ÅÆ„Ç∞„É™„ÉÉ„Éâ„É¨„Ç§„Ç¢„Ç¶„Éà„Çí„É¢„Éê„Ç§„É´Áî®„Å´Ë™øÊï¥ */
            #specialServicesEdit .grid-cols-1.md\\:grid-cols-2 {
                grid-template-columns: repeat(1, minmax(0, 1fr)) !important;
            }
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.invisible{visibility:hidden}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.inset-0{inset:0px}.-right-1{right:-0.25rem}.-top-1{top:-0.25rem}.-top-8{top:-2rem}.bottom-0{bottom:0px}.left-0{left:0px}.right-0{right:0px}.right-4{right:1rem}.top-0{top:0px}.top-1\/2{top:50%}.top-14{top:3.5rem}.top-16{top:4rem}.top-20{top:5rem}.top-4{top:1rem}.top-full{top:100%}.right-1{right:0.25rem}.top-1{top:0.25rem}.left-2{left:0.5rem}.top-2{top:0.5rem}.z-10{z-index:10}.z-20{z-index:20}.z-40{z-index:40}.z-50{z-index:50}.z-\[200\]{z-index:200}.-mx-4{margin-left:-1rem;margin-right:-1rem}.mx-auto{margin-left:auto;margin-right:auto}.-mb-px{margin-bottom:-1px}.mb-1{margin-bottom:0.25rem}.mb-1\.5{margin-bottom:0.375rem}.mb-12{margin-bottom:3rem}.mb-2{margin-bottom:0.5rem}.mb-3{margin-bottom:0.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.ml-1{margin-left:0.25rem}.ml-2{margin-left:0.5rem}.ml-3{margin-left:0.75rem}.ml-4{margin-left:1rem}.ml-6{margin-left:1.5rem}.ml-auto{margin-left:auto}.mr-1{margin-right:0.25rem}.mr-2{margin-right:0.5rem}.mr-3{margin-right:0.75rem}.mt-0\.5{margin-top:0.125rem}.mt-1{margin-top:0.25rem}.mt-2{margin-top:0.5rem}.mt-3{margin-top:0.75rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.inline-flex{display:inline-flex}.grid{display:grid}.hidden{display:none}.aspect-square{aspect-ratio:1 / 1}.h-10{height:2.5rem}.h-12{height:3rem}.h-16{height:4rem}.h-2{height:0.5rem}.h-3{height:0.75rem}.h-4{height:1rem}.h-48{height:12rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-64{height:16rem}.h-8{height:2rem}.h-full{height:100%}.h-32{height:8rem}.h-24{height:6rem}.max-h-64{max-height:16rem}.max-h-\[500px\]{max-height:500px}.max-h-\[600px\]{max-height:600px}.max-h-\[90vh\]{max-height:90vh}.max-h-full{max-height:100%}.min-h-\[48px\]{min-height:48px}.min-h-screen{min-height:100vh}.w-1{width:0.25rem}.w-10{width:2.5rem}.w-11{width:2.75rem}.w-11\/12{width:91.666667%}.w-12{width:3rem}.w-16{width:4rem}.w-2{width:0.5rem}.w-3{width:0.75rem}.w-32{width:8rem}.w-4{width:1rem}.w-48{width:12rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-64{width:16rem}.w-8{width:2rem}.w-96{width:24rem}.w-\[120px\]{width:120px}.w-full{width:100%}.w-72{width:18rem}.min-w-0{min-width:0px}.min-w-\[20px\]{min-width:20px}.min-w-\[280px\]{min-width:280px}.min-w-full{min-width:100%}.max-w-2xl{max-width:42rem}.max-w-3xl{max-width:48rem}.max-w-4xl{max-width:56rem}.max-w-6xl{max-width:72rem}.max-w-\[100px\]{max-width:100px}.max-w-\[80px\]{max-width:80px}.max-w-full{max-width:100%}.max-w-7xl{max-width:80rem}.max-w-lg{max-width:32rem}.flex-1{flex:1 1 0%}.flex-shrink-0{flex-shrink:0}.-translate-x-12{--tw-translate-x:-3rem;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-x-4{--tw-translate-x:-1rem;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-x-full{--tw-translate-x:-100%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-1\/2{--tw-translate-y:-50%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-12{--tw-translate-x:3rem;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-4{--tw-translate-x:1rem;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-125{--tw-scale-x:1.25;--tw-scale-y:1.25;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite}.cursor-help{cursor:help}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.resize-y{resize:vertical}.list-inside{list-style-position:inside}.list-disc{list-style-type:disc}.grid-cols-1{grid-template-columns:repeat(1, minmax(0, 1fr))}.grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}.grid-cols-4{grid-template-columns:repeat(4, minmax(0, 1fr))}.grid-cols-7{grid-template-columns:repeat(7, minmax(0, 1fr))}.grid-cols-8{grid-template-columns:repeat(8, minmax(0, 1fr))}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-0{gap:0px}.gap-1{gap:0.25rem}.gap-1\.5{gap:0.375rem}.gap-2{gap:0.5rem}.gap-3{gap:0.75rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.space-x-2 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.5rem * var(--tw-space-x-reverse));margin-left:calc(0.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-3 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.75rem * var(--tw-space-x-reverse));margin-left:calc(0.75rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-4 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-1 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.25rem * var(--tw-space-y-reverse))}.space-y-2 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.5rem * var(--tw-space-y-reverse))}.space-y-3 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.75rem * var(--tw-space-y-reverse))}.space-y-4 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.divide-y > :not([hidden]) ~ :not([hidden]){--tw-divide-y-reverse:0;border-top-width:calc(1px * calc(1 - var(--tw-divide-y-reverse)));border-bottom-width:calc(1px * var(--tw-divide-y-reverse))}.divide-gray-200 > :not([hidden]) ~ :not([hidden]){--tw-divide-opacity:1;border-color:rgb(229 231 235 / var(--tw-divide-opacity, 1))}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.text-ellipsis{text-overflow:ellipsis}.whitespace-nowrap{white-space:nowrap}.whitespace-pre-wrap{white-space:pre-wrap}.break-words{overflow-wrap:break-word}.break-all{word-break:break-all}.rounded{border-radius:0.25rem}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-md{border-radius:0.375rem}.rounded-xl{border-radius:0.75rem}.rounded-b-lg{border-bottom-right-radius:0.5rem;border-bottom-left-radius:0.5rem}.rounded-t-2xl{border-top-left-radius:1rem;border-top-right-radius:1rem}.rounded-t-lg{border-top-left-radius:0.5rem;border-top-right-radius:0.5rem}.rounded-t-xl{border-top-left-radius:0.75rem;border-top-right-radius:0.75rem}.border{border-width:1px}.border-2{border-width:2px}.border-b{border-bottom-width:1px}.border-b-2{border-bottom-width:2px}.border-l-4{border-left-width:4px}.border-r{border-right-width:1px}.border-t{border-top-width:1px}.border-t-0{border-top-width:0px}.border-t-2{border-top-width:2px}.border-dashed{border-style:dashed}.border-blue-200{--tw-border-opacity:1;border-color:rgb(191 219 254 / var(--tw-border-opacity, 1))}.border-gray-100{--tw-border-opacity:1;border-color:rgb(243 244 246 / var(--tw-border-opacity, 1))}.border-gray-200{--tw-border-opacity:1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1))}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.border-gray-700{--tw-border-opacity:1;border-color:rgb(55 65 81 / var(--tw-border-opacity, 1))}.border-gray-800{--tw-border-opacity:1;border-color:rgb(31 41 55 / var(--tw-border-opacity, 1))}.border-orange-200{--tw-border-opacity:1;border-color:rgb(254 215 170 / var(--tw-border-opacity, 1))}.border-orange-500{--tw-border-opacity:1;border-color:rgb(249 115 22 / var(--tw-border-opacity, 1))}.border-purple-200{--tw-border-opacity:1;border-color:rgb(233 213 255 / var(--tw-border-opacity, 1))}.border-red-300{--tw-border-opacity:1;border-color:rgb(252 165 165 / var(--tw-border-opacity, 1))}.border-yellow-200{--tw-border-opacity:1;border-color:rgb(254 240 138 / var(--tw-border-opacity, 1))}.border-blue-400{--tw-border-opacity:1;border-color:rgb(96 165 250 / var(--tw-border-opacity, 1))}.border-green-400{--tw-border-opacity:1;border-color:rgb(74 222 128 / var(--tw-border-opacity, 1))}.border-yellow-400{--tw-border-opacity:1;border-color:rgb(250 204 21 / var(--tw-border-opacity, 1))}.border-yellow-300{--tw-border-opacity:1;border-color:rgb(253 224 71 / var(--tw-border-opacity, 1))}.border-purple-100{--tw-border-opacity:1;border-color:rgb(243 232 255 / var(--tw-border-opacity, 1))}.border-green-300{--tw-border-opacity:1;border-color:rgb(134 239 172 / var(--tw-border-opacity, 1))}.border-green-200{--tw-border-opacity:1;border-color:rgb(187 247 208 / var(--tw-border-opacity, 1))}.border-indigo-200{--tw-border-opacity:1;border-color:rgb(199 210 254 / var(--tw-border-opacity, 1))}.border-blue-500{--tw-border-opacity:1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.bg-black{--tw-bg-opacity:1;background-color:rgb(0 0 0 / var(--tw-bg-opacity, 1))}.bg-blue-100{--tw-bg-opacity:1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.bg-blue-200{--tw-bg-opacity:1;background-color:rgb(191 219 254 / var(--tw-bg-opacity, 1))}.bg-blue-50{--tw-bg-opacity:1;background-color:rgb(239 246 255 / var(--tw-bg-opacity, 1))}.bg-blue-500{--tw-bg-opacity:1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}.bg-gray-200{--tw-bg-opacity:1;background-color:rgb(229 231 235 / var(--tw-bg-opacity, 1))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.bg-gray-500{--tw-bg-opacity:1;background-color:rgb(107 114 128 / var(--tw-bg-opacity, 1))}.bg-gray-600{--tw-bg-opacity:1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}.bg-gray-900\/95{background-color:rgb(17 24 39 / 0.95)}.bg-green-100{--tw-bg-opacity:1;background-color:rgb(220 252 231 / var(--tw-bg-opacity, 1))}.bg-green-200{--tw-bg-opacity:1;background-color:rgb(187 247 208 / var(--tw-bg-opacity, 1))}.bg-green-50{--tw-bg-opacity:1;background-color:rgb(240 253 244 / var(--tw-bg-opacity, 1))}.bg-green-500{--tw-bg-opacity:1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.bg-green-600{--tw-bg-opacity:1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.bg-indigo-600{--tw-bg-opacity:1;background-color:rgb(79 70 229 / var(--tw-bg-opacity, 1))}.bg-orange-500{--tw-bg-opacity:1;background-color:rgb(249 115 22 / var(--tw-bg-opacity, 1))}.bg-orange-600{--tw-bg-opacity:1;background-color:rgb(234 88 12 / var(--tw-bg-opacity, 1))}.bg-pink-600{--tw-bg-opacity:1;background-color:rgb(219 39 119 / var(--tw-bg-opacity, 1))}.bg-purple-100{--tw-bg-opacity:1;background-color:rgb(243 232 255 / var(--tw-bg-opacity, 1))}.bg-purple-200{--tw-bg-opacity:1;background-color:rgb(233 213 255 / var(--tw-bg-opacity, 1))}.bg-purple-500{--tw-bg-opacity:1;background-color:rgb(168 85 247 / var(--tw-bg-opacity, 1))}.bg-purple-600{--tw-bg-opacity:1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.bg-red-100{--tw-bg-opacity:1;background-color:rgb(254 226 226 / var(--tw-bg-opacity, 1))}.bg-red-500{--tw-bg-opacity:1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-white\/20{background-color:rgb(255 255 255 / 0.2)}.bg-yellow-100{--tw-bg-opacity:1;background-color:rgb(254 249 195 / var(--tw-bg-opacity, 1))}.bg-yellow-50{--tw-bg-opacity:1;background-color:rgb(254 252 232 / var(--tw-bg-opacity, 1))}.bg-yellow-500{--tw-bg-opacity:1;background-color:rgb(234 179 8 / var(--tw-bg-opacity, 1))}.bg-gray-300{--tw-bg-opacity:1;background-color:rgb(209 213 219 / var(--tw-bg-opacity, 1))}.bg-purple-50{--tw-bg-opacity:1;background-color:rgb(250 245 255 / var(--tw-bg-opacity, 1))}.bg-indigo-100{--tw-bg-opacity:1;background-color:rgb(224 231 255 / var(--tw-bg-opacity, 1))}.bg-orange-100{--tw-bg-opacity:1;background-color:rgb(255 237 213 / var(--tw-bg-opacity, 1))}.bg-indigo-50{--tw-bg-opacity:1;background-color:rgb(238 242 255 / var(--tw-bg-opacity, 1))}.bg-opacity-50{--tw-bg-opacity:0.5}.bg-opacity-90{--tw-bg-opacity:0.9}.bg-opacity-60{--tw-bg-opacity:0.6}.bg-gradient-to-b{background-image:linear-gradient(to bottom, var(--tw-gradient-stops))}.bg-gradient-to-br{background-image:linear-gradient(to bottom right, var(--tw-gradient-stops))}.bg-gradient-to-r{background-image:linear-gradient(to right, var(--tw-gradient-stops))}.from-blue-400{--tw-gradient-from:#60a5fa var(--tw-gradient-from-position);--tw-gradient-to:rgb(96 165 250 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-blue-50{--tw-gradient-from:#eff6ff var(--tw-gradient-from-position);--tw-gradient-to:rgb(239 246 255 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-blue-500{--tw-gradient-from:#3b82f6 var(--tw-gradient-from-position);--tw-gradient-to:rgb(59 130 246 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-blue-600{--tw-gradient-from:#2563eb var(--tw-gradient-from-position);--tw-gradient-to:rgb(37 99 235 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-green-50{--tw-gradient-from:#f0fdf4 var(--tw-gradient-from-position);--tw-gradient-to:rgb(240 253 244 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-orange-50{--tw-gradient-from:#fff7ed var(--tw-gradient-from-position);--tw-gradient-to:rgb(255 247 237 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-orange-500{--tw-gradient-from:#f97316 var(--tw-gradient-from-position);--tw-gradient-to:rgb(249 115 22 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-purple-50{--tw-gradient-from:#faf5ff var(--tw-gradient-from-position);--tw-gradient-to:rgb(250 245 255 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-purple-600{--tw-gradient-from:#9333ea var(--tw-gradient-from-position);--tw-gradient-to:rgb(147 51 234 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-transparent{--tw-gradient-from:transparent var(--tw-gradient-from-position);--tw-gradient-to:rgb(0 0 0 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-yellow-50{--tw-gradient-from:#fefce8 var(--tw-gradient-from-position);--tw-gradient-to:rgb(254 252 232 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-yellow-500{--tw-gradient-from:#eab308 var(--tw-gradient-from-position);--tw-gradient-to:rgb(234 179 8 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-indigo-50{--tw-gradient-from:#eef2ff var(--tw-gradient-from-position);--tw-gradient-to:rgb(238 242 255 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-pink-50{--tw-gradient-from:#fdf2f8 var(--tw-gradient-from-position);--tw-gradient-to:rgb(253 242 248 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-amber-400{--tw-gradient-from:#fbbf24 var(--tw-gradient-from-position);--tw-gradient-to:rgb(251 191 36 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-amber-50{--tw-gradient-from:#fffbeb var(--tw-gradient-from-position);--tw-gradient-to:rgb(255 251 235 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.via-blue-50{--tw-gradient-to:rgb(239 246 255 / 0)  var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), #eff6ff var(--tw-gradient-via-position), var(--tw-gradient-to)}.via-orange-100{--tw-gradient-to:rgb(255 237 213 / 0)  var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), #ffedd5 var(--tw-gradient-via-position), var(--tw-gradient-to)}.via-transparent{--tw-gradient-to:rgb(0 0 0 / 0)  var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), transparent var(--tw-gradient-via-position), var(--tw-gradient-to)}.to-black\/30{--tw-gradient-to:rgb(0 0 0 / 0.3) var(--tw-gradient-to-position)}.to-blue-100{--tw-gradient-to:#dbeafe var(--tw-gradient-to-position)}.to-blue-50{--tw-gradient-to:#eff6ff var(--tw-gradient-to-position)}.to-blue-500{--tw-gradient-to:#3b82f6 var(--tw-gradient-to-position)}.to-blue-600{--tw-gradient-to:#2563eb var(--tw-gradient-to-position)}.to-green-100{--tw-gradient-to:#dcfce7 var(--tw-gradient-to-position)}.to-orange-50{--tw-gradient-to:#fff7ed var(--tw-gradient-to-position)}.to-orange-600{--tw-gradient-to:#ea580c var(--tw-gradient-to-position)}.to-purple-100{--tw-gradient-to:#f3e8ff var(--tw-gradient-to-position)}.to-purple-400{--tw-gradient-to:#c084fc var(--tw-gradient-to-position)}.to-purple-50{--tw-gradient-to:#faf5ff var(--tw-gradient-to-position)}.to-purple-600{--tw-gradient-to:#9333ea var(--tw-gradient-to-position)}.to-red-50{--tw-gradient-to:#fef2f2 var(--tw-gradient-to-position)}.to-red-500{--tw-gradient-to:#ef4444 var(--tw-gradient-to-position)}.to-indigo-100{--tw-gradient-to:#e0e7ff var(--tw-gradient-to-position)}.to-pink-100{--tw-gradient-to:#fce7f3 var(--tw-gradient-to-position)}.to-yellow-100{--tw-gradient-to:#fef9c3 var(--tw-gradient-to-position)}.to-yellow-400{--tw-gradient-to:#facc15 var(--tw-gradient-to-position)}.to-yellow-50{--tw-gradient-to:#fefce8 var(--tw-gradient-to-position)}.bg-clip-text{-webkit-background-clip:text;background-clip:text}.fill-current{fill:currentColor}.object-contain{object-fit:contain}.object-cover{object-fit:cover}.p-1{padding:0.25rem}.p-10{padding:2.5rem}.p-12{padding:3rem}.p-2{padding:0.5rem}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.p-1\.5{padding:0.375rem}.px-1{padding-left:0.25rem;padding-right:0.25rem}.px-10{padding-left:2.5rem;padding-right:2.5rem}.px-2{padding-left:0.5rem;padding-right:0.5rem}.px-2\.5{padding-left:0.625rem;padding-right:0.625rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.px-8{padding-left:2rem;padding-right:2rem}.py-0\.5{padding-top:0.125rem;padding-bottom:0.125rem}.py-1{padding-top:0.25rem;padding-bottom:0.25rem}.py-1\.5{padding-top:0.375rem;padding-bottom:0.375rem}.py-12{padding-top:3rem;padding-bottom:3rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.py-8{padding-top:2rem;padding-bottom:2rem}.pb-2{padding-bottom:0.5rem}.pb-20{padding-bottom:5rem}.pt-20{padding-top:5rem}.pt-3{padding-top:0.75rem}.pt-4{padding-top:1rem}.pb-6{padding-bottom:1.5rem}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-5xl{font-size:3rem;line-height:1}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-normal{font-weight:400}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.leading-5{line-height:1.25rem}.leading-relaxed{line-height:1.625}.leading-tight{line-height:1.25}.tracking-wider{letter-spacing:0.05em}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-blue-700{--tw-text-opacity:1;color:rgb(29 78 216 / var(--tw-text-opacity, 1))}.text-blue-800{--tw-text-opacity:1;color:rgb(30 64 175 / var(--tw-text-opacity, 1))}.text-blue-900{--tw-text-opacity:1;color:rgb(30 58 138 / var(--tw-text-opacity, 1))}.text-gray-100{--tw-text-opacity:1;color:rgb(243 244 246 / var(--tw-text-opacity, 1))}.text-gray-300{--tw-text-opacity:1;color:rgb(209 213 219 / var(--tw-text-opacity, 1))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-gray-900{--tw-text-opacity:1;color:rgb(17 24 39 / var(--tw-text-opacity, 1))}.text-green-600{--tw-text-opacity:1;color:rgb(22 163 74 / var(--tw-text-opacity, 1))}.text-green-700{--tw-text-opacity:1;color:rgb(21 128 61 / var(--tw-text-opacity, 1))}.text-green-800{--tw-text-opacity:1;color:rgb(22 101 52 / var(--tw-text-opacity, 1))}.text-green-900{--tw-text-opacity:1;color:rgb(20 83 45 / var(--tw-text-opacity, 1))}.text-orange-500{--tw-text-opacity:1;color:rgb(249 115 22 / var(--tw-text-opacity, 1))}.text-orange-600{--tw-text-opacity:1;color:rgb(234 88 12 / var(--tw-text-opacity, 1))}.text-purple-500{--tw-text-opacity:1;color:rgb(168 85 247 / var(--tw-text-opacity, 1))}.text-purple-600{--tw-text-opacity:1;color:rgb(147 51 234 / var(--tw-text-opacity, 1))}.text-purple-700{--tw-text-opacity:1;color:rgb(126 34 206 / var(--tw-text-opacity, 1))}.text-purple-800{--tw-text-opacity:1;color:rgb(107 33 168 / var(--tw-text-opacity, 1))}.text-purple-900{--tw-text-opacity:1;color:rgb(88 28 135 / var(--tw-text-opacity, 1))}.text-red-500{--tw-text-opacity:1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.text-red-600{--tw-text-opacity:1;color:rgb(220 38 38 / var(--tw-text-opacity, 1))}.text-red-700{--tw-text-opacity:1;color:rgb(185 28 28 / var(--tw-text-opacity, 1))}.text-red-800{--tw-text-opacity:1;color:rgb(153 27 27 / var(--tw-text-opacity, 1))}.text-transparent{color:transparent}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-yellow-600{--tw-text-opacity:1;color:rgb(202 138 4 / var(--tw-text-opacity, 1))}.text-yellow-700{--tw-text-opacity:1;color:rgb(161 98 7 / var(--tw-text-opacity, 1))}.text-yellow-800{--tw-text-opacity:1;color:rgb(133 77 14 / var(--tw-text-opacity, 1))}.text-black{--tw-text-opacity:1;color:rgb(0 0 0 / var(--tw-text-opacity, 1))}.text-yellow-500{--tw-text-opacity:1;color:rgb(234 179 8 / var(--tw-text-opacity, 1))}.text-yellow-400{--tw-text-opacity:1;color:rgb(250 204 21 / var(--tw-text-opacity, 1))}.text-indigo-800{--tw-text-opacity:1;color:rgb(55 48 163 / var(--tw-text-opacity, 1))}.text-orange-700{--tw-text-opacity:1;color:rgb(194 65 12 / var(--tw-text-opacity, 1))}.text-amber-900{--tw-text-opacity:1;color:rgb(120 53 15 / var(--tw-text-opacity, 1))}.line-through{-webkit-text-decoration-line:line-through;text-decoration-line:line-through}.opacity-10{opacity:0.1}.opacity-90{opacity:0.9}.opacity-0{opacity:0}.shadow{--tw-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgb(0 0 0 / 0.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.drop-shadow-lg{--tw-drop-shadow:drop-shadow(0 10px 8px rgb(0 0 0 / 0.04)) drop-shadow(0 4px 3px rgb(0 0 0 / 0.1));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-md{--tw-drop-shadow:drop-shadow(0 4px 3px rgb(0 0 0 / 0.07)) drop-shadow(0 2px 2px rgb(0 0 0 / 0.06));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.backdrop-blur{--tw-backdrop-blur:blur(8px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition{transition-property:color, background-color, border-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-colors{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-shadow{transition-property:box-shadow;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-300{transition-duration:300ms}.after\:absolute::after{content:var(--tw-content);position:absolute}.after\:left-\[2px\]::after{content:var(--tw-content);left:2px}.after\:top-\[2px\]::after{content:var(--tw-content);top:2px}.after\:h-5::after{content:var(--tw-content);height:1.25rem}.after\:w-5::after{content:var(--tw-content);width:1.25rem}.after\:rounded-full::after{content:var(--tw-content);border-radius:9999px}.after\:border::after{content:var(--tw-content);border-width:1px}.after\:border-gray-300::after{content:var(--tw-content);--tw-border-opacity:1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.after\:bg-white::after{content:var(--tw-content);--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.after\:transition-all::after{content:var(--tw-content);transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.after\:content-\[\'\'\]::after{--tw-content:'';content:var(--tw-content)}.hover\:scale-105:hover{--tw-scale-x:1.05;--tw-scale-y:1.05;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:scale-110:hover{--tw-scale-x:1.1;--tw-scale-y:1.1;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:border-blue-500:hover{--tw-border-opacity:1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.hover\:border-gray-300:hover{--tw-border-opacity:1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.hover\:bg-blue-200:hover{--tw-bg-opacity:1;background-color:rgb(191 219 254 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-50:hover{--tw-bg-opacity:1;background-color:rgb(239 246 255 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-600:hover{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-100:hover{--tw-bg-opacity:1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-200:hover{--tw-bg-opacity:1;background-color:rgb(229 231 235 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-300:hover{--tw-bg-opacity:1;background-color:rgb(209 213 219 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-50:hover{--tw-bg-opacity:1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-600:hover{--tw-bg-opacity:1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-700:hover{--tw-bg-opacity:1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-800:hover{--tw-bg-opacity:1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}.hover\:bg-green-200:hover{--tw-bg-opacity:1;background-color:rgb(187 247 208 / var(--tw-bg-opacity, 1))}.hover\:bg-green-600:hover{--tw-bg-opacity:1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.hover\:bg-green-700:hover{--tw-bg-opacity:1;background-color:rgb(21 128 61 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-700:hover{--tw-bg-opacity:1;background-color:rgb(126 34 206 / var(--tw-bg-opacity, 1))}.hover\:bg-red-200:hover{--tw-bg-opacity:1;background-color:rgb(254 202 202 / var(--tw-bg-opacity, 1))}.hover\:bg-red-900\/50:hover{background-color:rgb(127 29 29 / 0.5)}.hover\:bg-white:hover{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.hover\:bg-yellow-200:hover{--tw-bg-opacity:1;background-color:rgb(254 240 138 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-100:hover{--tw-bg-opacity:1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.hover\:bg-orange-200:hover{--tw-bg-opacity:1;background-color:rgb(254 215 170 / var(--tw-bg-opacity, 1))}.hover\:bg-red-100:hover{--tw-bg-opacity:1;background-color:rgb(254 226 226 / var(--tw-bg-opacity, 1))}.hover\:bg-yellow-100:hover{--tw-bg-opacity:1;background-color:rgb(254 249 195 / var(--tw-bg-opacity, 1))}.hover\:bg-green-100:hover{--tw-bg-opacity:1;background-color:rgb(220 252 231 / var(--tw-bg-opacity, 1))}.hover\:bg-opacity-20:hover{--tw-bg-opacity:0.2}.hover\:from-amber-100:hover{--tw-gradient-from:#fef3c7 var(--tw-gradient-from-position);--tw-gradient-to:rgb(254 243 199 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.hover\:to-yellow-100:hover{--tw-gradient-to:#fef9c3 var(--tw-gradient-to-position)}.hover\:text-blue-800:hover{--tw-text-opacity:1;color:rgb(30 64 175 / var(--tw-text-opacity, 1))}.hover\:text-blue-900:hover{--tw-text-opacity:1;color:rgb(30 58 138 / var(--tw-text-opacity, 1))}.hover\:text-gray-100:hover{--tw-text-opacity:1;color:rgb(243 244 246 / var(--tw-text-opacity, 1))}.hover\:text-gray-200:hover{--tw-text-opacity:1;color:rgb(229 231 235 / var(--tw-text-opacity, 1))}.hover\:text-gray-700:hover{--tw-text-opacity:1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.hover\:text-green-900:hover{--tw-text-opacity:1;color:rgb(20 83 45 / var(--tw-text-opacity, 1))}.hover\:text-red-400:hover{--tw-text-opacity:1;color:rgb(248 113 113 / var(--tw-text-opacity, 1))}.hover\:text-red-800:hover{--tw-text-opacity:1;color:rgb(153 27 27 / var(--tw-text-opacity, 1))}.hover\:text-red-900:hover{--tw-text-opacity:1;color:rgb(127 29 29 / var(--tw-text-opacity, 1))}.hover\:text-gray-300:hover{--tw-text-opacity:1;color:rgb(209 213 219 / var(--tw-text-opacity, 1))}.hover\:text-gray-600:hover{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.hover\:underline:hover{-webkit-text-decoration-line:underline;text-decoration-line:underline}.hover\:opacity-80:hover{opacity:0.8}.hover\:opacity-90:hover{opacity:0.9}.hover\:shadow-lg:hover{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.hover\:shadow-md:hover{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.hover\:shadow-xl:hover{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.focus\:border-blue-500:focus{--tw-border-opacity:1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-1:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-blue-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(59 130 246 / var(--tw-ring-opacity, 1))}.focus\:ring-orange-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(249 115 22 / var(--tw-ring-opacity, 1))}.active\:bg-blue-800:active{--tw-bg-opacity:1;background-color:rgb(30 64 175 / var(--tw-bg-opacity, 1))}.group:hover .group-hover\:visible{visibility:visible}.group:hover .group-hover\:block{display:block}.group:hover .group-hover\:text-blue-400{--tw-text-opacity:1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-yellow-400{--tw-text-opacity:1;color:rgb(250 204 21 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:opacity-100{opacity:1}.peer:checked ~ .peer-checked\:bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.peer:checked ~ .peer-checked\:bg-orange-500{--tw-bg-opacity:1;background-color:rgb(249 115 22 / var(--tw-bg-opacity, 1))}.peer:checked ~ .peer-checked\:after\:translate-x-full::after{content:var(--tw-content);--tw-translate-x:100%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.peer:checked ~ .peer-checked\:after\:border-white::after{content:var(--tw-content);--tw-border-opacity:1;border-color:rgb(255 255 255 / var(--tw-border-opacity, 1))}.peer:focus ~ .peer-focus\:outline-none{outline:2px solid transparent;outline-offset:2px}.peer:focus ~ .peer-focus\:ring-4{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(4px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.peer:focus ~ .peer-focus\:ring-orange-300{--tw-ring-opacity:1;--tw-ring-color:rgb(253 186 116 / var(--tw-ring-opacity, 1))}@media (min-width: 640px){.sm\:mx-0{margin-left:0px;margin-right:0px}.sm\:mb-4{margin-bottom:1rem}.sm\:ml-1{margin-left:0.25rem}.sm\:block{display:block}.sm\:inline{display:inline}.sm\:grid{display:grid}.sm\:min-w-0{min-width:0px}.sm\:max-w-\[100px\]{max-width:100px}.sm\:flex-none{flex:none}.sm\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.sm\:flex-row{flex-direction:row}.sm\:items-center{align-items:center}.sm\:justify-between{justify-content:space-between}.sm\:gap-4{gap:1rem}.sm\:space-x-3 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.75rem * var(--tw-space-x-reverse));margin-left:calc(0.75rem * calc(1 - var(--tw-space-x-reverse)))}.sm\:space-y-4 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.sm\:p-6{padding:1.5rem}.sm\:p-8{padding:2rem}.sm\:px-0{padding-left:0px;padding-right:0px}.sm\:px-2{padding-left:0.5rem;padding-right:0.5rem}.sm\:px-6{padding-left:1.5rem;padding-right:1.5rem}.sm\:py-4{padding-top:1rem;padding-bottom:1rem}.sm\:text-left{text-align:left}.sm\:text-3xl{font-size:1.875rem;line-height:2.25rem}.sm\:text-4xl{font-size:2.25rem;line-height:2.5rem}.sm\:text-7xl{font-size:4.5rem;line-height:1}.sm\:text-base{font-size:1rem;line-height:1.5rem}.sm\:text-lg{font-size:1.125rem;line-height:1.75rem}.sm\:text-sm{font-size:0.875rem;line-height:1.25rem}}@media (min-width: 768px){.md\:col-span-2{grid-column:span 2 / span 2}.md\:table-cell{display:table-cell}.md\:w-96{width:24rem}.md\:max-w-\[140px\]{max-width:140px}.md\:max-w-none{max-width:none}.md\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.md\:grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}.md\:grid-cols-4{grid-template-columns:repeat(4, minmax(0, 1fr))}}@media (min-width: 1024px){.lg\:col-span-2{grid-column:span 2 / span 2}.lg\:inline{display:inline}.lg\:table-cell{display:table-cell}.lg\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.lg\:grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}.lg\:grid-cols-4{grid-template-columns:repeat(4, minmax(0, 1fr))}.lg\:grid-cols-6{grid-template-columns:repeat(6, minmax(0, 1fr))}}@media (min-width: 1280px){.xl\:grid-cols-4{grid-template-columns:repeat(4, minmax(0, 1fr))}}</style></head>
<body class="bg-gray-100 text-gray-900">
    <!-- ÈÄöË©±‰∏≠„Éê„ÉºÔºàÁô∫‰ø°Âæå„Å´Ë°®Á§∫Ôºâ -->
    <div id="callingBar" class="fixed top-0 left-0 right-0 z-[60] hidden">
        <div class="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-3 flex items-center justify-between shadow-lg">
            <div class="flex items-center gap-3">
                <span class="text-xl animate-pulse">üìû</span>
                <span class="font-bold">ÈÄöË©±‰∏≠:</span>
                <span id="callingBarName" class="font-medium"></span>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="openCallingCaseDetail()" class="px-3 py-1.5 bg-white/20 text-white font-medium rounded-lg hover:bg-white/30 transition-all">
                    Ë©≥Á¥∞
                </button>
                <button onclick="endPhoneCall()" class="px-3 py-1.5 bg-white text-green-600 font-bold rounded-lg hover:bg-gray-100 transition-all shadow-md text-sm">
                    Â±•Ê≠¥„ÇíÊÆã„Åô
                </button>
            </div>
        </div>
    </div>

    <!-- „É°„Ç§„É≥„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ -->
    <div id="mainApp">
        <!-- „Éà„ÉÉ„Éó„Éê„Éº -->
        <div class="fixed top-0 left-0 right-0 z-50 h-16 bg-gray-900/95 glass border-b border-gray-200">
            <div class="flex items-center justify-between h-full px-3 sm:px-6">
                <!-- Â∑¶ÂÅ¥Ôºö„É°„Éã„É•„ÉºÔºã„É≠„Ç¥ -->
                <div class="flex items-center space-x-2 sm:space-x-3">
                    <button onclick="toggleMenu()" class="p-2 rounded-lg hover:bg-gray-800 transition-colors flex-shrink-0">
                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                    <div class="flex items-center space-x-2">
                        <div id="companyLogo" class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0" style="background: linear-gradient(135deg, rgb(102, 126, 234) 0%, rgb(118, 75, 162) 100%);">
                            <span class="text-gray-100 font-bold">Âä†</span>
                        </div>
                        <span id="systemTitle" class="hidden lg:inline text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent whitespace-nowrap">Âä†ÁõüÂ∫óÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</span>
                    </div>
                </div>

                <!-- ‰∏≠Â§ÆÔºö„Çπ„ÉÜ„Éº„Çø„Çπ -->
                <div class="flex-shrink-0">
                    <div class="relative">
                        <label class="hidden sm:block text-xs text-gray-400 mb-1 text-center">„Çπ„ÉÜ„Éº„Çø„Çπ</label>
                        <span id="merchantStatus" class="px-3 py-1 text-xs font-semibold rounded-full border-2 bg-gray-100 text-gray-500 border-gray-300 cursor-pointer hover:opacity-80 transition-opacity" onclick="handleHeaderStatusClick()" title="‰ºëÊ≠¢ÊôÇ„ÇØ„É™„ÉÉ„ÇØ„Åß„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´Â§âÊõ¥">Ë™≠Ëæº‰∏≠...</span>
                    </div>
                </div>

                <!-- Âè≥ÂÅ¥ÔºöÈÄöÁü•Ôºã„É¶„Éº„Ç∂„ÉºÊÉÖÂ†± -->
                <div class="flex items-center space-x-2 sm:space-x-3">
                    <!-- Êú¨ÈÉ®„Åã„Çâ„ÅÆÈÄöÁü•„Éú„Çø„É≥ -->
                    <button onclick="toggleNotificationPanel()" class="relative p-2 rounded-lg hover:bg-gray-800 transition-colors group flex-shrink-0">
                        <svg class="w-6 h-6 text-gray-400 group-hover:text-yellow-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                        </svg>
                        <span id="notificationCount" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                    </button>
                    <!-- „Ç¢„É©„Éº„Éà„Éª„É™„Éû„Ç§„É≥„ÉÄ„Éº„Éú„Çø„É≥ -->
                    <button onclick="toggleAlertPanel()" class="relative p-2 rounded-lg hover:bg-gray-800 transition-colors group flex-shrink-0">
                        <svg class="w-6 h-6 text-gray-400 group-hover:text-blue-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <span id="alertCount" class="absolute -top-1 -right-1 bg-blue-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">3</span>
                    </button>
                    <div class="text-center min-w-0">
                        <div id="userName" class="hidden sm:block text-sm text-gray-300 truncate max-w-[100px] md:max-w-none">Ë™≠Ëæº‰∏≠...</div>
                        <div id="userRole" class="ml-2 text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-500" onclick="editSalesPerson()" title="„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Á∑®ÈõÜ">Ë™≠Ëæº‰∏≠...</div>
                        <input id="userRoleInput" class="hidden text-xs text-gray-900 bg-white border border-gray-300 rounded px-2 py-1 w-[120px]" onblur="saveSalesPerson()" onkeydown="if(event.key==='Enter') saveSalesPerson()">
                    </div>
                </div>
            </div>
        </div>

        <!-- „Çµ„Ç§„Éâ„É°„Éã„É•„Éº -->
        <div id="sideMenu" class="fixed left-0 top-16 bottom-0 w-64 bg-gray-900/95 glass border-r border-gray-200 transform transition-transform z-40 -translate-x-full overflow-y-auto">
            <nav class="p-4 space-y-2">
                <!-- 1. „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ -->
                <a href="#dashboard" onclick="showSection('dashboard'); return false;" class="flex items-center px-4 py-3 rounded-lg text-gray-400 hover:bg-gray-800 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                    </svg>
                    „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ
                </a>
                <!-- 2. Ê°à‰ª∂ÁÆ°ÁêÜ -->
                <a href="#cases" onclick="showSection('cases'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100 relative">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                    </svg>
                    Ê°à‰ª∂ÁÆ°ÁêÜ
                    <span id="unassignedBadge" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-red-500 text-white text-xs font-bold rounded-full px-2 py-0.5 min-w-[20px] text-center">3</span>
                </a>
                <!-- 3. „Ç´„É¨„É≥„ÉÄ„Éº -->
                <a href="#calendar" onclick="showSection('calendar'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    „Ç´„É¨„É≥„ÉÄ„Éº
                </a>
                <!-- 4. „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã -->
                <a href="#cancel" onclick="showSection('cancel'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728A9 9 0 0 1 5.636 5.636m12.728 12.728L5.636 5.636"></path>
                    </svg>
                    „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã
                </a>
                <!-- 5. ÊúüÈôêÂª∂Èï∑Áî≥Ë´ã -->
                <a href="#extension" onclick="showSection('extension'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    ÊúüÈôêÂª∂Èï∑Áî≥Ë´ã
                </a>
                <!-- 6. ÊàêÁ¥ÑÂ†±Âëä -->
                <a href="#contract" onclick="showSection('contract'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    ÊàêÁ¥ÑÂ†±Âëä
                </a>
                <!-- 7. ËøΩÂÆ¢ÁµÇ‰∫ÜBOX -->
                <a href="#archive" onclick="showSection('archive'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                    ËøΩÂÆ¢ÁµÇ‰∫ÜBOX
                </a>
                <!-- 8. Âñ∂Ê•≠ÁÆ°ÁêÜ (admin) -->
                <a href="#sales" onclick="showSection('sales'); return false;" class="admin-only flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100" style="display: flex;">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    Âñ∂Ê•≠ÁÆ°ÁêÜ
                </a>
                <!-- 9. „É¨„Éù„Éº„Éà (admin) -->
                <a href="#reports" onclick="showSection('reports'); return false;" class="admin-only flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100" style="display: flex;">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    „É¨„Éù„Éº„Éà
                </a>
                <!-- 10. Ë≤°ÂãôÁÆ°ÁêÜ -->
                <a href="#billing" onclick="showSection('billing'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Ë≤°ÂãôÁÆ°ÁêÜ
                </a>
                <!-- 11. „Éá„Éù„Ç∏„ÉÉ„Éà -->
                <a href="#deposit" onclick="showSection('deposit'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                    </svg>
                    „Éá„Éù„Ç∏„ÉÉ„Éà
                </a>
                <!-- 12. Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö (admin) -->
                <a href="#autodelivery" onclick="showSection('autodelivery'); return false;" class="admin-only flex items-center px-4 py-3 rounded-lg text-gray-400 hover:bg-gray-800 hover:text-gray-100" style="display: flex;">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                    </svg>
                    Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö
                </a>
                <!-- 13. ‰ºöÁ§æÊÉÖÂ†± -->
                <a href="#company" onclick="showSection('company'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                    </svg>
                    ‰ºöÁ§æÊÉÖÂ†±
                </a>
                <!-- 14. Ë®≠ÂÆö -->
                <a href="#settings" onclick="showSection('settings'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    Ë®≠ÂÆö
                </a>
                <!-- „É≠„Ç∞„Ç¢„Ç¶„Éà -->
                <a href="#" onclick="logout(); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-red-900/50 text-gray-400 hover:text-red-400 mt-4 border-t border-gray-700 pt-4">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                    „É≠„Ç∞„Ç¢„Ç¶„Éà
                </a>
            </nav>
        </div>

        <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
        <main class="pt-20 px-6" style="background: #f3f4f6; min-height: 100vh;">
            <!-- „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ -->
            <div id="dashboardSection" class="section" style="display: none;">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</h2>
                
                <!-- Áµ±Ë®à„Ç´„Éº„Éâ„Å®„Éü„Éã„Ç´„É¨„É≥„ÉÄ„Éº -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Áµ±Ë®à„Ç´„Éº„Éâ -->
                    <div class="lg:col-span-2">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex items-center">
                            <div class="p-3 bg-blue-100 rounded-full">
                                <svg class="h-8 w-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500">Êñ∞Ë¶èÊ°à‰ª∂</p>
                                <p class="text-2xl font-semibold text-gray-900">24</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex items-center">
                            <div class="p-3 bg-green-100 rounded-full">
                                <svg class="h-8 w-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500">ÊàêÁ¥ÑÁéá</p>
                                <p class="text-2xl font-semibold text-gray-900">68%</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex items-center">
                            <div class="p-3 bg-yellow-100 rounded-full">
                                <svg class="h-8 w-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500">ÂØæÂøú‰∏≠</p>
                                <p class="text-2xl font-semibold text-gray-900">15</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex items-center">
                            <div class="p-3 bg-purple-100 rounded-full">
                                <svg class="h-8 w-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500">Âñ∂Ê•≠„É°„É≥„Éê„Éº</p>
                                <p class="text-2xl font-semibold text-gray-900">8</p>
                            </div>
                        </div>
                    </div>
                        </div>
                    </div>
                    
                    <!-- „Éü„Éã„Ç´„É¨„É≥„ÉÄ„Éº -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">‰ªäÊúà„ÅÆ‰∫àÂÆö</h3>
                            <button onclick="showSection('calendar')" class="text-sm text-blue-600 hover:text-blue-800">ÂÖ®„Å¶Ë°®Á§∫</button>
                        </div>
                        <div id="miniCalendar" class="text-sm"><div class="grid grid-cols-7 gap-1 text-xs"><div class="text-center font-medium text-gray-500 py-1">Êó•</div><div class="text-center font-medium text-gray-500 py-1">Êúà</div><div class="text-center font-medium text-gray-500 py-1">ÁÅ´</div><div class="text-center font-medium text-gray-500 py-1">Ê∞¥</div><div class="text-center font-medium text-gray-500 py-1">Êú®</div><div class="text-center font-medium text-gray-500 py-1">Èáë</div><div class="text-center font-medium text-gray-500 py-1">Âúü</div><div></div><div></div><div></div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-01')">1</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-02')">2</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-03')">3</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-04')">4</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded bg-blue-500 text-white hover:bg-blue-600" onclick="goToDate('2025-10-05')">5</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded font-bold text-blue-600" onclick="goToDate('2025-10-06')">6</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-07')">7</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded font-bold text-blue-600" onclick="goToDate('2025-10-08')">8</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-09')">9</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-10')">10</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-11')">11</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-12')">12</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-13')">13</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-14')">14</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-15')">15</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-16')">16</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-17')">17</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-18')">18</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-19')">19</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-20')">20</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-21')">21</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-22')">22</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-23')">23</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-24')">24</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-25')">25</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-26')">26</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-27')">27</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-28')">28</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-29')">29</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-30')">30</div><div class="text-center py-1 cursor-pointer hover:bg-gray-100 rounded" onclick="goToDate('2025-10-31')">31</div></div></div>
                        <div class="mt-4 space-y-2">
                            <div class="flex items-center p-2 bg-blue-50 rounded">
                                <div class="w-2 h-2 bg-blue-500 rounded-full mr-2"></div>
                                <div class="flex-1">
                                    <div class="text-sm font-medium">Áî∞‰∏≠Êßò ÁèæÂú∞Ë™øÊüª</div>
                                    <div class="text-xs text-gray-500">‰ªäÊó• 14:00-15:00</div>
                                </div>
                            </div>
                            <div class="flex items-center p-2 bg-green-50 rounded">
                                <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                <div class="flex-1">
                                    <div class="text-sm font-medium">‰ΩêËó§Êßò Â∑•‰∫ãÈñãÂßã</div>
                                    <div class="text-xs text-gray-500">ÊòéÊó• 9:00-</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÊúÄËøë„ÅÆÊ°à‰ª∂ -->
                <div class="bg-white shadow rounded-lg p-4 sm:p-6">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">ÊúÄËøë„ÅÆÊ°à‰ª∂</h3>
                    <!-- „Çπ„Éû„ÉõÔºöÊ®™„Çπ„ÇØ„É≠„Éº„É´ / „Çø„Éñ„É¨„ÉÉ„Éà‰ª•‰∏äÔºö„Ç∞„É™„ÉÉ„Éâ -->
                    <div class="sm:grid sm:grid-cols-2 lg:grid-cols-3 sm:gap-4 flex sm:flex-none overflow-x-auto gap-3 pb-2 -mx-4 px-4 sm:mx-0 sm:px-0">
                        <!-- Ê°à‰ª∂„Ç´„Éº„Éâ1 -->
                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow min-w-[280px] sm:min-w-0">
                            <div class="flex justify-between items-start mb-3">
                                <div class="font-semibold text-gray-900">#2024-001</div>
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">ÊàêÁ¥Ñ</span>
                            </div>
                            <div class="space-y-2">
                                <div class="flex items-center text-sm">
                                    <span class="text-gray-500 w-16">È°ßÂÆ¢:</span>
                                    <span class="text-gray-900 font-medium">Â±±Áî∞Â§™ÈÉé</span>
                                </div>
                                <div class="flex items-center text-sm">
                                    <span class="text-gray-500 w-16">ÊãÖÂΩì:</span>
                                    <span class="text-gray-700">Áî∞‰∏≠Âñ∂Ê•≠</span>
                                </div>
                                <div class="flex items-center text-sm">
                                    <span class="text-gray-500 w-16">Êõ¥Êñ∞Êó•:</span>
                                    <span class="text-gray-700">2024/01/15</span>
                                </div>
                            </div>
                        </div>

                        <!-- Ê°à‰ª∂„Ç´„Éº„Éâ2 -->
                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow min-w-[280px] sm:min-w-0">
                            <div class="flex justify-between items-start mb-3">
                                <div class="font-semibold text-gray-900">#2024-002</div>
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">„Éí„Ç¢„É™„É≥„Ç∞‰∏≠</span>
                            </div>
                            <div class="space-y-2">
                                <div class="flex items-center text-sm">
                                    <span class="text-gray-500 w-16">È°ßÂÆ¢:</span>
                                    <span class="text-gray-900 font-medium">Èà¥Êú®Ëä±Â≠ê</span>
                                </div>
                                <div class="flex items-center text-sm">
                                    <span class="text-gray-500 w-16">ÊãÖÂΩì:</span>
                                    <span class="text-gray-700">‰ΩêËó§Âñ∂Ê•≠</span>
                                </div>
                                <div class="flex items-center text-sm">
                                    <span class="text-gray-500 w-16">Êõ¥Êñ∞Êó•:</span>
                                    <span class="text-gray-700">2024/01/14</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- dashboardSection„ÅÆÁµÇ‰∫Ü -->

            <!-- Âñ∂Ê•≠ÁÆ°ÁêÜ„Çª„ÇØ„Ç∑„Éß„É≥ÔºàÁÆ°ÁêÜËÄÖ„ÅÆ„ÅøÔºâ -->
            <div id="salesSection" class="section" style="display: none;">
                <div class="mb-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">Âñ∂Ê•≠ÁÆ°ÁêÜ</h2>
                    <button onclick="openPermissionModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        Êñ∞Ë¶èÂñ∂Ê•≠ËøΩÂä†
                    </button>
                </div>

                <!-- Âñ∂Ê•≠„É°„É≥„Éê„Éº„É™„Çπ„Éà -->
                <div class="bg-white shadow rounded-lg">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÂêçÂâç</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ê®©Èôê„É¨„Éô„É´</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÊàêÁ¥ÑÊï∞</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÊàêÁ¥ÑÁéá</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">„Ç¢„ÇØ„Ç∑„Éß„É≥</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Áî∞‰∏≠Â§™ÈÉé</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800">„É™„Éº„ÉÄ„Éº</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">45</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">75%</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">
                                    <button onclick="editPermissions('Áî∞‰∏≠Â§™ÈÉé')" class="text-blue-600 hover:text-blue-900 mr-3">Ê®©ÈôêÁ∑®ÈõÜ</button>
                                    <button onclick="confirmDeleteSales('Áî∞‰∏≠Â§™ÈÉé')" class="text-red-600 hover:text-red-900">ÂâäÈô§</button>
                                </td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">‰ΩêËó§Ëä±Â≠ê</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">‰∏ÄËà¨Âñ∂Ê•≠</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">28</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">62%</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">
                                    <button onclick="editPermissions('‰ΩêËó§Ëä±Â≠ê')" class="text-blue-600 hover:text-blue-900 mr-3">Ê®©ÈôêÁ∑®ÈõÜ</button>
                                    <button onclick="confirmDeleteSales('‰ΩêËó§Ëä±Â≠ê')" class="text-red-600 hover:text-red-900">ÂâäÈô§</button>
                                </td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Èà¥Êú®Ê¨°ÈÉé</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">‰∏ÄËà¨‰∫ãÂãô</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">
                                    <button onclick="editPermissions('Èà¥Êú®Ê¨°ÈÉé')" class="text-blue-600 hover:text-blue-900 mr-3">Ê®©ÈôêÁ∑®ÈõÜ</button>
                                    <button onclick="confirmDeleteSales('Èà¥Êú®Ê¨°ÈÉé')" class="text-red-600 hover:text-red-900">ÂâäÈô§</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div><!-- salesSection„ÅÆÁµÇ‰∫Ü -->

            <!-- Ê°à‰ª∂ÁÆ°ÁêÜ„Çª„ÇØ„Ç∑„Éß„É≥ÔºàÂÖ®ÁîªÈù¢„ÉªÁôΩËÉåÊôØÔºâ -->
            <div id="casesSection" class="section bg-white -mx-6 -mt-4 px-6 pt-4 pb-6" style="display: none; min-height: calc(100vh - 4rem);">
                <div class="mb-3">
                    <h2 class="text-xl font-bold text-gray-900">Ê°à‰ª∂ÁÆ°ÁêÜ</h2>
                </div>

                <!-- Ê§úÁ¥¢„Éª„Éï„Ç£„É´„Çø„Éº„Ç®„É™„Ç¢ -->
                <div class="mb-3">
                    <div class="flex flex-col gap-3 w-full">
                        <!-- Ê§úÁ¥¢„Éú„ÉÉ„ÇØ„Çπ + Áµû„ÇäËæº„Åø„Éú„Çø„É≥ÔºàÊ®™‰∏¶„Å≥„ÉªÂÖ®ÂπÖÔºâ -->
                        <div class="flex gap-2 w-full">
                            <div class="relative flex-1">
                                <input type="text" id="caseSearchInput" placeholder="ÂêçÂâç„Éª‰ΩèÊâÄ„ÉªÈõªË©±„ÅßÊ§úÁ¥¢" oninput="searchCases()" autocomplete="off" class="w-full pl-10 pr-10 py-2.5 text-sm border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-400 focus:border-blue-400 shadow-sm transition-all bg-gray-50 placeholder-gray-400">
                                <div class="absolute left-3 top-2.5">
                                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                    </svg>
                                </div>
                                <button onclick="document.getElementById('caseSearchInput').value=''; searchCases();" class="absolute right-2 top-2 text-gray-400 hover:text-gray-600 p-1">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>
                            <button onclick="openUnifiedFilterModal()" id="unifiedFilterBtn" class="flex items-center gap-2 px-4 py-2.5 bg-purple-50 text-purple-600 border-2 border-purple-200 rounded-xl shadow-md hover:bg-purple-100 transition-all font-bold whitespace-nowrap flex-shrink-0">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/></svg>
                                <span id="unifiedFilterLabel">Áµû„ÇäËæº„Åø</span>
                            </button>
                        </div>

                        <!-- „ÇØ„Ç§„ÉÉ„ÇØ„Éï„Ç£„É´„ÇøÔºàÂÖ®Ê°à‰ª∂/Ë¶ÅÂØæÂøú/ÊàêÁ¥ÑÔºâ -->
                        <div class="grid grid-cols-3 gap-2 w-full">
                            <button id="filterBtnAll" data-filter="all" onclick="filterCases('all')" class="flex flex-col items-center justify-center py-3 px-2 bg-indigo-200 text-indigo-800 border border-indigo-400 rounded-xl shadow-md transition-all cursor-pointer">
                                <span class="text-lg font-bold" id="stat-total">0</span>
                                <span class="text-xs font-medium">ÂÖ®Ê°à‰ª∂</span>
                            </button>
                            <button id="filterBtnPending" data-filter="pending" onclick="filterCases('pending')" class="flex flex-col items-center justify-center py-3 px-2 bg-pink-50 text-pink-400 border border-pink-200 rounded-xl shadow-md hover:bg-pink-100 transition-all cursor-pointer">
                                <span class="text-lg font-bold" id="stat-pending">0</span>
                                <span class="text-xs font-medium">Ë¶ÅÂØæÂøú</span>
                            </button>
                            <button id="filterBtnContracted" data-filter="contracted" onclick="filterCases('contracted')" class="flex flex-col items-center justify-center py-3 px-2 bg-green-50 text-green-500 border border-green-200 rounded-xl shadow-md hover:bg-green-100 transition-all cursor-pointer">
                                <span class="text-lg font-bold" id="stat-contracted">0</span>
                                <span class="text-xs font-medium">ÊàêÁ¥ÑÊ∏à</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- „É™„Çπ„ÉàÁõ¥‰∏ä: ‰ª∂Êï∞Ë°®Á§∫ + ‰∏¶„Å≥Êõø„Åà -->
                <div class="flex justify-between items-center mb-3 px-2">
                    <p class="text-sm text-gray-700 font-medium">
                        <span id="displayCount" class="text-blue-600 font-bold">0</span>‰ª∂Ë°®Á§∫
                    </p>
                    <select id="sortOrderSelect" onchange="selectSortOrderDirect(this.value)" class="py-2 px-4 bg-white text-gray-800 border-2 border-gray-200 rounded-lg shadow-sm hover:border-gray-300 hover:bg-gray-50 transition-all cursor-pointer text-sm font-bold">
                        <option value="date-desc">Êñ∞ÁùÄÈ†Ü</option>
                        <option value="nextcall-asc">Ê¨°ÂõûÊû∂ÈõªÈ†Ü</option>
                        <option value="status">„Çπ„ÉÜ„Éº„Çø„ÇπÈ†Ü</option>
                    </select>
                </div>

                <!-- „Ç´„Éº„Éâ„Éì„É•„ÉºÔºà„Çπ„Éû„Éõ: Ë°®Á§∫ / PC: ÈùûË°®Á§∫Ôºâ -->
                <div id="caseCardView" class="grid grid-cols-1 gap-5 md:hidden">
                    <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫Ôºàhidden by defaultÔºâ -->
                    <div id="casesLoading" class="col-span-full text-center py-12 hidden">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mb-4"></div>
                        <p class="text-gray-500">Ê°à‰ª∂„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>
                    </div>
                    <!-- Ê°à‰ª∂„Ç´„Éº„Éâ„ÅØÂãïÁöÑ„Å´ÁîüÊàê -->
                </div>

                <!-- „É™„Çπ„Éà„Éì„É•„ÉºÔºà„Çπ„Éû„Éõ: ÈùûË°®Á§∫ / PC: Ë°®Á§∫Ôºâ -->
                <div id="caseListView" class="bg-white rounded-lg shadow overflow-hidden hidden md:block">
                    <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                                <th class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">È°ßÂÆ¢ÊÉÖÂ†±</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Êû∂ÈõªÂ±•Ê≠¥</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">„É°„É¢</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Ê¨°ÂõûÊû∂Èõª</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ÈÄ≤Êçó</th>
                                <th class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ÊãÖÂΩì</th>
                                <th class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell">ÈÖç‰ø°Êó•</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Ë©≥Á¥∞</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Áô∫‰ø°</th>
                            </tr>
                        </thead>
                        <tbody id="caseListBody" class="bg-white divide-y divide-gray-200">
                            <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                        </tbody>
                    </table>
                    </div>
                </div>

                <!-- „É°„É¢„É¢„Éº„ÉÄ„É´ÔºàÂºï„ÅçÁ∂ô„ÅéÈáçË¶ñ„Éá„Ç∂„Ç§„É≥Ôºâ -->
                <div id="caseMemoModal" class="fixed inset-0 z-50 hidden">
                    <div class="fixed inset-0 bg-black/60 backdrop-blur-sm" onclick="closeMemoModal()"></div>
                    <div class="fixed inset-0 flex items-end sm:items-center justify-center p-0 sm:p-4">
                        <div class="bg-white rounded-t-3xl sm:rounded-2xl shadow-2xl w-full sm:max-w-lg max-h-[95vh] sm:max-h-[90vh] overflow-hidden flex flex-col">
                            <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                            <div class="p-4 border-b bg-gradient-to-r from-amber-500 to-orange-500 text-white flex-shrink-0 relative">
                                <button onclick="closeMemoModal()" class="absolute top-3 right-3 text-white/80 hover:text-white hover:bg-white/20 rounded-full p-2 transition-all">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                                <h3 class="text-lg font-bold">üìù Âºï„ÅçÁ∂ô„Åé„É°„É¢</h3>
                                <p id="memoTargetName" class="text-sm text-amber-100 mt-1">---</p>
                                <p id="memoTargetAddress" class="text-xs text-amber-100/80 mt-0.5">---</p>
                            </div>

                            <!-- „É°„É¢ÂÖ•Âäõ„Ç®„É™„Ç¢Ôºà‰∏äÈÉ®Âõ∫ÂÆöÔºâ -->
                            <div class="p-4 bg-amber-50 border-b border-amber-200 flex-shrink-0">
                                <div class="flex gap-2">
                                    <textarea
                                        id="caseMemoTextarea"
                                        placeholder="„É°„É¢„ÇíÂÖ•Âäõ..."
                                        class="flex-1 p-3 border-2 border-amber-200 rounded-xl resize-none focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-all text-base bg-white"
                                        rows="2"
                                    ></textarea>
                                    <button
                                        onclick="saveCaseMemo()"
                                        class="px-4 bg-amber-500 text-white rounded-xl hover:bg-amber-600 font-bold shadow-md hover:shadow-lg transition-all flex-shrink-0">
                                        <svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="white" d="M2 21l21-9L2 3v7l15 2-15 2v7z"/><path fill="rgba(255,255,255,0.6)" d="M2 3l15 9L2 21V3z"/></svg>
                                    </button>
                                </div>
                            </div>

                            <!-- Â±•Ê≠¥„Ç®„É™„Ç¢Ôºà„É°„Ç§„É≥„Éª„Çπ„ÇØ„É≠„Éº„É´ÂèØËÉΩÔºâ -->
                            <div class="flex-1 overflow-y-auto">
                                <div class="p-4">
                                    <div class="flex items-center justify-between mb-4">
                                        <h4 class="text-sm font-bold text-gray-700 flex items-center gap-2">
                                            <span>üìã</span> ÂØæÂøúÂ±•Ê≠¥
                                        </h4>
                                        <span id="memoHistoryCount" class="text-xs px-2 py-0.5 bg-gray-200 rounded-full text-gray-600">0‰ª∂</span>
                                    </div>
                                    <div id="memoHistoryList" class="space-y-3">
                                        <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„ÇãÂ±•Ê≠¥Ôºà„Çø„Ç§„É†„É©„Ç§„É≥ÂΩ¢ÂºèÔºâ -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- „É©„Éô„É´ÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
                <div id="labelModal" class="fixed inset-0 z-[60] hidden">
                    <div class="fixed inset-0 bg-black/60 backdrop-blur-sm" onclick="closeLabelModal()"></div>
                    <div class="fixed inset-0 flex items-center justify-center p-4">
                        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden">
                            <div class="p-4 border-b bg-gradient-to-r from-blue-500 to-indigo-500 text-white">
                                <h3 class="text-lg font-bold">üè∑Ô∏è „É©„Éô„É´„ÇíË®≠ÂÆö</h3>
                                <p class="text-sm text-blue-100 mt-1">„Åì„ÅÆÂ±•Ê≠¥„Å´„É©„Éô„É´„Çí„Å§„Åë„Å¶„Ç´„Éº„Éâ„Å´Ë°®Á§∫</p>
                            </div>
                            <div class="p-4">
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="applyLabel('Ë¶ÅÂØæÂøú', 'red')" class="px-3 py-2 rounded-lg bg-red-100 text-red-700 font-medium hover:bg-red-200 transition-all flex items-center gap-2 justify-center">
                                        <span class="w-3 h-3 rounded-full bg-red-500"></span>Ë¶ÅÂØæÂøú
                                    </button>
                                    <button onclick="applyLabel('Á¢∫Ë™ç‰∏≠', 'yellow')" class="px-3 py-2 rounded-lg bg-yellow-100 text-yellow-700 font-medium hover:bg-yellow-200 transition-all flex items-center gap-2 justify-center">
                                        <span class="w-3 h-3 rounded-full bg-yellow-500"></span>Á¢∫Ë™ç‰∏≠
                                    </button>
                                    <button onclick="applyLabel('ÈÄ£Áµ°ÂæÖ„Å°', 'blue')" class="px-3 py-2 rounded-lg bg-blue-100 text-blue-700 font-medium hover:bg-blue-200 transition-all flex items-center gap-2 justify-center">
                                        <span class="w-3 h-3 rounded-full bg-blue-500"></span>ÈÄ£Áµ°ÂæÖ„Å°
                                    </button>
                                    <button onclick="applyLabel('ÈáçË¶Å', 'purple')" class="px-3 py-2 rounded-lg bg-purple-100 text-purple-700 font-medium hover:bg-purple-200 transition-all flex items-center gap-2 justify-center">
                                        <span class="w-3 h-3 rounded-full bg-purple-500"></span>ÈáçË¶Å
                                    </button>
                                    <button onclick="applyLabel('Ë¶ãËæº„ÅøÈ´ò', 'green')" class="px-3 py-2 rounded-lg bg-green-100 text-green-700 font-medium hover:bg-green-200 transition-all flex items-center gap-2 justify-center">
                                        <span class="w-3 h-3 rounded-full bg-green-500"></span>Ë¶ãËæº„ÅøÈ´ò
                                    </button>
                                    <button onclick="applyLabel('Ë¶ãËæº„Åø‰Ωé', 'gray')" class="px-3 py-2 rounded-lg bg-gray-100 text-gray-700 font-medium hover:bg-gray-200 transition-all flex items-center gap-2 justify-center">
                                        <span class="w-3 h-3 rounded-full bg-gray-500"></span>Ë¶ãËæº„Åø‰Ωé
                                    </button>
                                </div>
                                <div class="mt-4 pt-4 border-t">
                                    <button onclick="closeLabelModal()" class="w-full py-2 text-gray-500 hover:bg-gray-100 rounded-lg transition-all">
                                        „Ç≠„É£„É≥„Çª„É´
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥„É¢„Éº„ÉÄ„É´ -->
                <div id="caseStatusModal" class="fixed inset-0 z-50 hidden">
                    <div class="fixed inset-0 bg-black/60 backdrop-blur-sm" onclick="closeStatusModal()"></div>
                    <div class="fixed inset-x-0 top-4 bottom-0 flex items-start justify-center p-0 sm:p-4">
                        <div class="bg-white rounded-t-3xl sm:rounded-2xl shadow-2xl w-full sm:max-w-md overflow-hidden flex flex-col">
                            <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                            <div class="p-4 pb-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white relative">
                                <button onclick="closeStatusModal()" class="absolute top-3 right-3 text-white/80 hover:text-white hover:bg-white/20 rounded-full p-2 transition-all">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                                <h3 class="text-lg font-bold">„Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h3>
                                <p id="statusTargetName" class="text-sm text-purple-200 mt-1">---</p>
                            </div>

                            <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÈÅ∏Êäû„Ç®„É™„Ç¢ -->
                            <div class="flex-1 p-3 bg-gray-50">
                                <!-- Âñ∂Ê•≠ÈÄ≤Êçó„Éï„É≠„Éº -->
                                <div class="flex flex-col items-center mb-2" id="statusDetailGrid">
                                    <p class="text-sm text-gray-500 mb-1.5 font-medium w-28 text-center">üìû Âñ∂Ê•≠ÈÄ≤Êçó</p>
                                    <div class="flex items-start">
                                        <div class="flex flex-col items-center w-28">
                                            <button onclick="selectDetailStatus('Êñ∞ÁùÄ')" data-status="Êñ∞ÁùÄ" class="status-btn w-full py-2 bg-white border-2 border-gray-200 rounded-lg text-gray-500 font-bold text-base hover:bg-blue-100 hover:border-blue-300 hover:text-blue-800 transition-all">Êñ∞ÁùÄ</button>
                                            <span class="text-gray-300 text-base">‚Üì</span>
                                        </div>
                                        <span class="text-sm text-gray-400 whitespace-nowrap ml-3 w-32 py-2">Êú™ÁùÄÊâã</span>
                                    </div>
                                    <div class="flex items-start">
                                        <div class="flex flex-col items-center w-28">
                                            <button onclick="selectDetailStatus('Êú™„Ç¢„Éù')" data-status="Êú™„Ç¢„Éù" class="status-btn w-full py-2 bg-white border-2 border-gray-200 rounded-lg text-gray-500 font-bold text-base hover:bg-pink-100 hover:border-pink-300 hover:text-pink-700 transition-all">Êú™„Ç¢„Éù</button>
                                            <span class="text-gray-300 text-base">‚Üì</span>
                                        </div>
                                        <span class="text-sm text-gray-400 whitespace-nowrap ml-3 w-32 py-2">ÈõªË©±„Åó„Åü„Åå„Ç¢„ÉùÂèñ„Çå„Åö</span>
                                    </div>
                                    <div class="flex items-start">
                                        <div class="flex flex-col items-center w-28">
                                            <button onclick="selectDetailStatus('„Ç¢„ÉùÊ∏à')" data-status="„Ç¢„ÉùÊ∏à" class="status-btn w-full py-2 bg-white border-2 border-gray-200 rounded-lg text-gray-500 font-bold text-base hover:bg-orange-100 hover:border-orange-300 hover:text-orange-800 transition-all">„Ç¢„ÉùÊ∏à</button>
                                            <span class="text-gray-300 text-base">‚Üì</span>
                                        </div>
                                        <span class="text-sm text-gray-400 whitespace-nowrap ml-3 w-32 py-2">ÁèæË™øÊó•ÊôÇÁ¢∫ÂÆö</span>
                                    </div>
                                    <div class="flex items-start">
                                        <div class="flex flex-col items-center w-28">
                                            <button onclick="selectDetailStatus('ÁèæË™øÊ∏à')" data-status="ÁèæË™øÊ∏à" class="status-btn w-full py-2 bg-white border-2 border-gray-200 rounded-lg text-gray-500 font-bold text-base hover:bg-purple-100 hover:border-purple-300 hover:text-purple-800 transition-all">ÁèæË™øÊ∏à</button>
                                            <span class="text-gray-300 text-base">‚Üì</span>
                                        </div>
                                        <span class="text-sm text-gray-400 whitespace-nowrap ml-3 w-32 py-2">ÁèæÂú∞Ë™øÊüªÂÆå‰∫Ü</span>
                                    </div>
                                    <div class="flex items-start">
                                        <div class="flex flex-col items-center w-28">
                                            <button onclick="selectDetailStatus('Ë¶ãÁ©çÊèêÂá∫Ê∏à')" data-status="Ë¶ãÁ©çÊèêÂá∫Ê∏à" class="status-btn w-full py-2 bg-white border-2 border-gray-200 rounded-lg text-gray-500 font-bold text-base hover:bg-amber-100 hover:border-amber-300 hover:text-amber-800 transition-all">Ë¶ãÁ©çÊèêÂá∫Ê∏à</button>
                                        </div>
                                        <span class="text-sm text-gray-400 whitespace-nowrap ml-3 w-32 py-2">Ë¶ãÁ©çÊõ∏„ÇíÈ°ßÂÆ¢„Å´ÊèêÂá∫</span>
                                    </div>
                                </div>

                                <!-- ÊàêÁ¥Ñ„ÉªÂÖ•ÈáëÁ≥ª„ÅÆË™¨Êòé -->
                                <div class="bg-amber-50 border border-amber-200 rounded-lg p-1.5 text-center mb-2">
                                    <p class="text-sm text-amber-700">üí° ÊàêÁ¥ÑÊôÇ„ÅØ„ÄåÊàêÁ¥ÑÂ†±Âëä„Äç„Çà„Çä„ÅäÊâãÁ∂ö„Åç„Åè„Å†„Åï„ÅÑ</p>
                                </div>

                                <!-- Èõ¢ËÑ±„Çπ„ÉÜ„Éº„Çø„Çπ -->
                                <div class="flex flex-col items-center" id="statusDetailGrid2">
                                    <p class="text-sm text-gray-500 mb-1.5 font-medium w-28 text-center">‚úñÔ∏è Èõ¢ËÑ±„Éª„Åù„ÅÆ‰ªñ</p>
                                    <div class="grid grid-cols-3 gap-1.5 w-[17rem]">
                                        <button onclick="selectDetailStatus('ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´')" data-status="ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´" title="ÁèæË™øÂâç„Å´È°ßÂÆ¢ÈÉΩÂêà„Åß„Ç≠„É£„É≥„Çª„É´" class="status-btn py-1.5 px-1 bg-white border-2 border-gray-200 rounded-lg text-gray-500 font-bold text-sm hover:bg-gray-200 hover:border-gray-400 hover:text-gray-700 transition-all leading-tight">ÁèæË™øÂâç<br>„Ç≠„É£„É≥„Çª„É´</button>
                                        <button onclick="selectDetailStatus('ÁèæË™øÂæåÂ§±Ê≥®')" data-status="ÁèæË™øÂæåÂ§±Ê≥®" title="ÁèæË™øÂæåÊñ≠„Çâ„Çå„Åü" class="status-btn py-1.5 px-1 bg-white border-2 border-gray-200 rounded-lg text-gray-500 font-bold text-sm hover:bg-gray-300 hover:border-gray-500 hover:text-gray-800 transition-all leading-tight">ÁèæË™øÂæå<br>Â§±Ê≥®</button>
                                        <button onclick="selectDetailStatus('‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à')" data-status="‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à" title="‰ªñ„ÅÆ‰∏ÄËà¨Ê•≠ËÄÖ„ÅßÂ•ëÁ¥Ñ" class="status-btn py-1.5 px-1 bg-white border-2 border-gray-200 rounded-lg text-gray-500 font-bold text-sm hover:bg-gray-200 hover:border-gray-400 hover:text-gray-700 transition-all leading-tight">‰ªñÁ§æ<br>Â•ëÁ¥ÑÊ∏à</button>
                                        <button onclick="selectDetailStatus('Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à')" data-status="Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à" title="‰ªñ„ÅÆÂä†ÁõüÂ∫ó„ÅßÂ•ëÁ¥Ñ" class="status-btn py-1.5 px-1 bg-white border-2 border-gray-200 rounded-lg text-gray-500 font-bold text-sm hover:bg-indigo-100 hover:border-indigo-300 hover:text-indigo-700 transition-all leading-tight">Âà•Âä†ÁõüÂ∫ó<br>Â•ëÁ¥ÑÊ∏à</button>
                                        <button onclick="selectDetailStatus('„ÇØ„É¨„Éº„É†')" data-status="„ÇØ„É¨„Éº„É†" title="ÂïèÈ°åÁô∫Áîü„Åæ„Åü„ÅØÂ§±Ê≥®" class="status-btn py-1.5 px-1 bg-white border-2 border-gray-200 rounded-lg text-gray-500 font-bold text-sm hover:bg-red-100 hover:border-red-300 hover:text-red-800 transition-all leading-tight">„ÇØ„É¨„Éº„É†</button>
                                    </div>
                                </div>
                            </div>

                            <!-- „Éï„ÉÉ„Çø„Éº„Éú„Çø„É≥ -->
                            <div class="p-4 bg-white border-t flex gap-3 flex-shrink-0">
                                <button onclick="closeStatusModal()" class="flex-1 py-3 bg-gray-100 text-gray-600 rounded-xl font-bold hover:bg-gray-200 transition-all">
                                    Êàª„Çã
                                </button>
                                <button onclick="confirmStatusSelection()" id="statusConfirmBtn" class="flex-1 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl font-bold hover:opacity-90 shadow-lg transition-all">
                                    ÈÅ©Áî®„Åô„Çã
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ê°à‰ª∂Ë©≥Á¥∞„É¢„Éº„ÉÄ„É´ÔºàV2022 ÂÖ®ÊÉÖÂ†±ÂØæÂøúÔºâ -->
                <div id="caseDetailModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
                        <div class="p-4 border-b flex justify-between items-center flex-shrink-0 bg-white rounded-t-lg">
                            <div class="w-8"></div>
                            <div class="flex items-center gap-2">
                                <span id="detailModalStatus" class="px-3 py-1 text-sm font-semibold rounded-full"></span>
                                <h3 class="text-lg font-bold">Ê°à‰ª∂Ë©≥Á¥∞</h3>
                            </div>
                            <button onclick="closeDetailModal()" class="text-gray-500 hover:text-gray-700 text-2xl w-8">&times;</button>
                        </div>
                        <div class="flex-1 overflow-y-auto p-4" id="caseDetailContent">
                            <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                        </div>
                        <!-- „É°„É¢„Çª„ÇØ„Ç∑„Éß„É≥Ôºà‰∏ãÈÉ®Âõ∫ÂÆöÔºâ -->
                        <div class="border-t bg-amber-50 p-3 flex-shrink-0 rounded-b-lg">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-amber-600 font-bold text-sm">üìù „É°„É¢</span>
                                <span id="detailMemoCount" class="text-xs px-2 py-0.5 bg-amber-200 rounded-full text-amber-700">0‰ª∂</span>
                            </div>
                            <div class="flex gap-2">
                                <textarea id="detailMemoTextarea" placeholder="„É°„É¢„ÇíÂÖ•Âäõ..." rows="2" class="flex-1 p-2 border-2 border-amber-200 rounded-lg resize-none focus:border-amber-500 focus:ring-1 focus:ring-amber-200 transition-all text-base bg-white"></textarea>
                                <button onclick="saveDetailMemo()" class="px-3 bg-amber-500 text-white rounded-lg hover:bg-amber-600 font-bold shadow transition-all flex-shrink-0">
                                    <svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="white" d="M2 21l21-9L2 3v7l15 2-15 2v7z"/></svg>
                                </button>
                            </div>
                            <!-- Â±•Ê≠¥„Éó„É¨„Éì„É•„ÉºÔºàÊúÄÊñ∞2‰ª∂Ôºâ -->
                            <div id="detailMemoHistory" class="mt-2 space-y-1 max-h-24 overflow-y-auto">
                                <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÊãÖÂΩìËÄÖÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
                <div id="assignModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-lg shadow-xl max-w-sm w-full">
                        <div class="p-4 border-b flex justify-between items-center">
                            <h3 class="text-lg font-bold">ÊãÖÂΩìËÄÖ„ÇíÈÅ∏Êäû</h3>
                            <button onclick="closeAssignModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                        </div>
                        <div class="p-4">
                            <div id="assignStaffList" class="space-y-2">
                                <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÁèæË™øÊó•ÊôÇË®≠ÂÆö„É¢„Éº„ÉÄ„É´Ôºà„Ç¢„ÉùÊ∏àÈÅ∏ÊäûÂæåÔºâ -->
                <div id="surveyDateModal" class="fixed inset-0 z-50 hidden">
                    <div class="fixed inset-0 bg-black/60 backdrop-blur-sm" onclick="closeSurveyDateModal()"></div>
                    <div class="fixed inset-0 flex items-end sm:items-center justify-center p-0 sm:p-4">
                        <div class="bg-white rounded-t-3xl sm:rounded-2xl shadow-2xl w-full sm:max-w-md max-h-[95vh] sm:max-h-[90vh] overflow-hidden flex flex-col">
                            <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                            <div class="p-4 border-b bg-gradient-to-r from-orange-500 to-orange-600 text-white flex-shrink-0">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="text-lg font-bold">üìÖ ÁèæË™øÊó•ÊôÇ„ÇíË®≠ÂÆö</h3>
                                    <button onclick="closeSurveyDateModal()" class="text-white/80 hover:text-white hover:bg-white/20 rounded-full p-2 transition-all -mr-2">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                <p id="surveyTargetName" class="text-base font-bold text-white">---</p>
                                <p id="surveyTargetAddress" class="text-sm text-orange-100 mt-0.5">---</p>
                            </div>

                            <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
                            <div class="flex-1 overflow-y-auto p-4 space-y-4">
                                <!-- Êó•‰ªò„ÇØ„Ç§„ÉÉ„ÇØÈÅ∏ÊäûÔºà‰ªäÊó•„Äú6Êó•ÂæåÔºâ -->
                                <div class="bg-gray-50 rounded-xl p-4">
                                    <h4 class="text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                                        <span>üìÖ</span> Êó•‰ªò„ÇíÈÅ∏Êäû
                                    </h4>
                                    <div class="grid grid-cols-4 gap-2 mb-3">
                                        <button onclick="setSurveyDay(0)" data-survey-day="0" class="survey-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-orange-400 hover:bg-orange-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">‰ªäÊó•</div>
                                            <div id="surveyDayLabel0" class="text-base"></div>
                                        </button>
                                        <button onclick="setSurveyDay(1)" data-survey-day="1" class="survey-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-orange-400 hover:bg-orange-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">ÊòéÊó•</div>
                                            <div id="surveyDayLabel1" class="text-base"></div>
                                        </button>
                                        <button onclick="setSurveyDay(2)" data-survey-day="2" class="survey-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-orange-400 hover:bg-orange-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">ÊòéÂæåÊó•</div>
                                            <div id="surveyDayLabel2" class="text-base"></div>
                                        </button>
                                        <button onclick="setSurveyDay(3)" data-survey-day="3" class="survey-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-orange-400 hover:bg-orange-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">3Êó•Âæå</div>
                                            <div id="surveyDayLabel3" class="text-base"></div>
                                        </button>
                                    </div>
                                    <div class="grid grid-cols-4 gap-2 mb-3">
                                        <button onclick="setSurveyDay(4)" data-survey-day="4" class="survey-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-orange-400 hover:bg-orange-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">4Êó•Âæå</div>
                                            <div id="surveyDayLabel4" class="text-base"></div>
                                        </button>
                                        <button onclick="setSurveyDay(5)" data-survey-day="5" class="survey-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-orange-400 hover:bg-orange-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">5Êó•Âæå</div>
                                            <div id="surveyDayLabel5" class="text-base"></div>
                                        </button>
                                        <button onclick="setSurveyDay(6)" data-survey-day="6" class="survey-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-orange-400 hover:bg-orange-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">6Êó•Âæå</div>
                                            <div id="surveyDayLabel6" class="text-base"></div>
                                        </button>
                                        <button onclick="toggleSurveyCustomDatePicker()" class="py-3 bg-white border-2 border-gray-200 text-gray-500 rounded-xl hover:border-orange-400 hover:bg-orange-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">„Åù„ÅÆ‰ªñ</div>
                                            <div class="text-base">üìÜ</div>
                                        </button>
                                    </div>
                                    <!-- „Ç´„Çπ„Çø„É†Êó•‰ªòÈÅ∏Êäû -->
                                    <div id="surveyCustomDatePicker" class="hidden">
                                        <input type="date" id="surveyDateInput" class="w-full p-3 border-2 border-orange-300 rounded-xl focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all text-center font-bold" onchange="onSurveyDateInputChange()">
                                    </div>
                                </div>

                                <!-- ÊôÇÈñìÈÅ∏ÊäûÔºà„Éó„É´„ÉÄ„Ç¶„É≥Ôºâ -->
                                <div class="bg-gray-50 rounded-xl p-4">
                                    <h4 class="text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                                        <span>‚è∞</span> ÊôÇÈñì„ÇíÈÅ∏Êäû
                                    </h4>
                                    <div class="flex items-center gap-3">
                                        <select id="surveyHour" class="flex-1 px-3 py-3 border-2 border-gray-200 rounded-xl text-center font-bold text-lg focus:border-orange-500 transition-all" onchange="onSurveyTimeChange()">
                                            <option value="">ÊôÇ</option>
                                            <option value="5">5ÊôÇ</option>
                                            <option value="6">6ÊôÇ</option>
                                            <option value="7">7ÊôÇ</option>
                                            <option value="8">8ÊôÇ</option>
                                            <option value="9">9ÊôÇ</option>
                                            <option value="10">10ÊôÇ</option>
                                            <option value="11">11ÊôÇ</option>
                                            <option value="12">12ÊôÇ</option>
                                            <option value="13">13ÊôÇ</option>
                                            <option value="14">14ÊôÇ</option>
                                            <option value="15">15ÊôÇ</option>
                                            <option value="16">16ÊôÇ</option>
                                            <option value="17">17ÊôÇ</option>
                                            <option value="18">18ÊôÇ</option>
                                            <option value="19">19ÊôÇ</option>
                                            <option value="20">20ÊôÇ</option>
                                            <option value="21">21ÊôÇ</option>
                                            <option value="22">22ÊôÇ</option>
                                        </select>
                                        <span class="text-xl font-bold text-gray-400">:</span>
                                        <select id="surveyMinute" class="flex-1 px-3 py-3 border-2 border-gray-200 rounded-xl text-center font-bold text-lg focus:border-orange-500 transition-all" onchange="onSurveyTimeChange()">
                                            <option value="0">00ÂàÜ</option>
                                            <option value="10">10ÂàÜ</option>
                                            <option value="20">20ÂàÜ</option>
                                            <option value="30">30ÂàÜ</option>
                                            <option value="40">40ÂàÜ</option>
                                            <option value="50">50ÂàÜ</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- ÈÅ∏ÊäûÁµêÊûú„Éó„É¨„Éì„É•„Éº -->
                                <div id="surveyPreview" class="bg-orange-50 rounded-xl p-4 border-2 border-orange-200 hidden">
                                    <div class="flex items-center justify-center gap-3">
                                        <span class="text-2xl">üè†</span>
                                        <div class="text-center">
                                            <div class="text-xs text-orange-600 font-medium">ÁèæË™ø‰∫àÂÆöÊó•ÊôÇ</div>
                                            <div id="surveyPreviewText" class="text-xl font-bold text-orange-800">---</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- „Éï„ÉÉ„Çø„Éº -->
                            <div class="p-4 border-t bg-gray-50 flex-shrink-0">
                                <div class="flex gap-3">
                                    <button onclick="closeSurveyDateModal()" class="flex-1 py-3 bg-white border-2 border-gray-300 text-gray-600 rounded-xl hover:bg-gray-100 font-bold transition-all">
                                        Êàª„Çã
                                    </button>
                                    <button onclick="saveSurveyDate()" id="surveySaveBtn" class="flex-[2] py-3 bg-orange-500 text-white rounded-xl hover:bg-orange-600 font-bold shadow-lg hover:shadow-xl transition-all disabled:bg-gray-300 disabled:shadow-none">
                                        ‰øùÂ≠ò„Åó„Å¶Ê¨°„Å∏
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ë¶ãÁ©çÊèêÂá∫Êó•ÊôÇ„É¢„Éº„ÉÄ„É´ÔºàÂïÜË´á„Ç¢„ÉùÊ∏àÈÅ∏ÊäûÂæåÔºâ -->
                <div id="estimateDateModal" class="fixed inset-0 z-50 hidden">
                    <div class="fixed inset-0 bg-black/60 backdrop-blur-sm" onclick="closeEstimateDateModal()"></div>
                    <div class="fixed inset-0 flex items-end sm:items-center justify-center p-0 sm:p-4">
                        <div class="bg-white rounded-t-3xl sm:rounded-2xl shadow-2xl w-full sm:max-w-md max-h-[95vh] sm:max-h-[90vh] overflow-hidden flex flex-col">
                            <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                            <div class="p-4 border-b bg-gradient-to-r from-emerald-500 to-emerald-600 text-white flex-shrink-0">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="text-lg font-bold">üìã ÂïÜË´áÊó•ÊôÇ„ÇíË®≠ÂÆö</h3>
                                    <button onclick="closeEstimateDateModal()" class="text-white/80 hover:text-white hover:bg-white/20 rounded-full p-2 transition-all -mr-2">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                <p id="estimateTargetName" class="text-base font-bold text-white">---</p>
                                <p id="estimateTargetAddress" class="text-sm text-emerald-100 mt-0.5">---</p>
                            </div>

                            <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
                            <div class="flex-1 overflow-y-auto p-4 space-y-4">
                                <!-- Êó•‰ªò„ÇØ„Ç§„ÉÉ„ÇØÈÅ∏ÊäûÔºà‰ªäÊó•„Äú6Êó•ÂæåÔºâ -->
                                <div class="bg-gray-50 rounded-xl p-4">
                                    <h4 class="text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                                        <span>üìÖ</span> Êó•‰ªò„ÇíÈÅ∏Êäû
                                    </h4>
                                    <div class="grid grid-cols-4 gap-2 mb-3">
                                        <button onclick="setEstimateDay(0)" data-estimate-day="0" class="estimate-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-emerald-400 hover:bg-emerald-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">‰ªäÊó•</div>
                                            <div id="estimateDayLabel0" class="text-base"></div>
                                        </button>
                                        <button onclick="setEstimateDay(1)" data-estimate-day="1" class="estimate-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-emerald-400 hover:bg-emerald-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">ÊòéÊó•</div>
                                            <div id="estimateDayLabel1" class="text-base"></div>
                                        </button>
                                        <button onclick="setEstimateDay(2)" data-estimate-day="2" class="estimate-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-emerald-400 hover:bg-emerald-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">ÊòéÂæåÊó•</div>
                                            <div id="estimateDayLabel2" class="text-base"></div>
                                        </button>
                                        <button onclick="setEstimateDay(3)" data-estimate-day="3" class="estimate-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-emerald-400 hover:bg-emerald-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">3Êó•Âæå</div>
                                            <div id="estimateDayLabel3" class="text-base"></div>
                                        </button>
                                    </div>
                                    <div class="grid grid-cols-4 gap-2 mb-3">
                                        <button onclick="setEstimateDay(4)" data-estimate-day="4" class="estimate-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-emerald-400 hover:bg-emerald-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">4Êó•Âæå</div>
                                            <div id="estimateDayLabel4" class="text-base"></div>
                                        </button>
                                        <button onclick="setEstimateDay(5)" data-estimate-day="5" class="estimate-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-emerald-400 hover:bg-emerald-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">5Êó•Âæå</div>
                                            <div id="estimateDayLabel5" class="text-base"></div>
                                        </button>
                                        <button onclick="setEstimateDay(6)" data-estimate-day="6" class="estimate-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-emerald-400 hover:bg-emerald-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">6Êó•Âæå</div>
                                            <div id="estimateDayLabel6" class="text-base"></div>
                                        </button>
                                        <button onclick="toggleEstimateCustomDatePicker()" class="py-3 bg-white border-2 border-gray-200 text-gray-500 rounded-xl hover:border-emerald-400 hover:bg-emerald-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">„Åù„ÅÆ‰ªñ</div>
                                            <div class="text-base">üìÜ</div>
                                        </button>
                                    </div>
                                    <!-- „Ç´„Çπ„Çø„É†Êó•‰ªòÈÅ∏Êäû -->
                                    <div id="estimateCustomDatePicker" class="hidden">
                                        <input type="date" id="estimateDateInput" class="w-full p-3 border-2 border-emerald-300 rounded-xl focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 transition-all text-center font-bold" onchange="onEstimateDateInputChange()">
                                    </div>
                                </div>

                                <!-- ÊôÇÈñìÈÅ∏ÊäûÔºà„Éó„É´„ÉÄ„Ç¶„É≥Ôºâ -->
                                <div class="bg-gray-50 rounded-xl p-4">
                                    <h4 class="text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                                        <span>‚è∞</span> ÊôÇÈñì„ÇíÈÅ∏Êäû
                                    </h4>
                                    <div class="flex items-center gap-3">
                                        <select id="estimateHour" class="flex-1 px-3 py-3 border-2 border-gray-200 rounded-xl text-center font-bold text-lg focus:border-emerald-500 transition-all" onchange="onEstimateTimeChange()">
                                            <option value="">ÊôÇ</option>
                                            <option value="9">9ÊôÇ</option>
                                            <option value="10">10ÊôÇ</option>
                                            <option value="11">11ÊôÇ</option>
                                            <option value="12">12ÊôÇ</option>
                                            <option value="13">13ÊôÇ</option>
                                            <option value="14">14ÊôÇ</option>
                                            <option value="15">15ÊôÇ</option>
                                            <option value="16">16ÊôÇ</option>
                                            <option value="17">17ÊôÇ</option>
                                            <option value="18">18ÊôÇ</option>
                                            <option value="19">19ÊôÇ</option>
                                            <option value="20">20ÊôÇ</option>
                                            <option value="21">21ÊôÇ</option>
                                        </select>
                                        <span class="text-xl font-bold text-gray-400">:</span>
                                        <select id="estimateMinute" class="flex-1 px-3 py-3 border-2 border-gray-200 rounded-xl text-center font-bold text-lg focus:border-emerald-500 transition-all" onchange="onEstimateTimeChange()">
                                            <option value="0">00ÂàÜ</option>
                                            <option value="30">30ÂàÜ</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- ÈÅ∏ÊäûÁµêÊûú„Éó„É¨„Éì„É•„Éº -->
                                <div id="estimatePreview" class="bg-emerald-50 rounded-xl p-4 border-2 border-emerald-200 hidden">
                                    <div class="flex items-center justify-center gap-3">
                                        <span class="text-2xl">üìã</span>
                                        <div class="text-center">
                                            <div class="text-xs text-emerald-600 font-medium">ÂïÜË´á‰∫àÂÆöÊó•ÊôÇ</div>
                                            <div id="estimatePreviewText" class="text-xl font-bold text-emerald-800">---</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- „Éï„ÉÉ„Çø„Éº -->
                            <div class="p-4 border-t bg-gray-50 flex-shrink-0">
                                <div class="flex gap-3">
                                    <button onclick="closeEstimateDateModal()" class="flex-1 py-3 bg-white border-2 border-gray-300 text-gray-600 rounded-xl hover:bg-gray-100 font-bold transition-all">
                                        Êàª„Çã
                                    </button>
                                    <button onclick="saveEstimateDate()" id="estimateSaveBtn" class="flex-[2] py-3 bg-emerald-500 text-white rounded-xl hover:bg-emerald-600 font-bold shadow-lg hover:shadow-xl transition-all disabled:bg-gray-300 disabled:shadow-none">
                                        ‰øùÂ≠ò„Åó„Å¶Ê¨°„Å∏
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ê¨°ÂõûÊû∂ÈõªÊó•Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´ -->
                <div id="nextCallModal" class="fixed inset-0 z-50 hidden">
                    <div class="fixed inset-0 bg-black/60 backdrop-blur-sm" onclick="closeNextCallModal()"></div>
                    <div class="fixed inset-0 flex items-end sm:items-center justify-center p-0 sm:p-4">
                        <div class="bg-white rounded-t-3xl sm:rounded-2xl shadow-2xl w-full sm:max-w-md max-h-[95vh] sm:max-h-[90vh] overflow-hidden flex flex-col">
                            <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                            <div class="p-4 border-b bg-gradient-to-r from-blue-500 to-blue-600 text-white flex-shrink-0">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="text-lg font-bold">üìû Ê¨°ÂõûÊû∂ÈõªÊó•ÊôÇ„ÇíË®≠ÂÆö„Åó„Å¶‰∏ã„Åï„ÅÑ</h3>
                                    <button onclick="closeNextCallModal()" class="text-white/80 hover:text-white hover:bg-white/20 rounded-full p-2 transition-all -mr-2">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                <p id="nextCallTargetName" class="text-base font-bold text-white">---</p>
                                <p id="nextCallTargetAddress" class="text-sm text-blue-100 mt-0.5">---</p>
                            </div>

                            <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑÔºà„Çπ„ÇØ„É≠„Éº„É´ÂèØËÉΩÔºâ -->
                            <div class="flex-1 overflow-y-auto p-4 space-y-4">
                                <!-- Êó•‰ªò„ÇØ„Ç§„ÉÉ„ÇØÈÅ∏Êäû -->
                                <div class="bg-gray-50 rounded-xl p-4">
                                    <h4 class="text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                                        <span>üìÖ</span> Êó•‰ªò„ÇíÈÅ∏Êäû
                                    </h4>
                                    <div class="grid grid-cols-4 gap-2 mb-3">
                                        <button onclick="setNextCallDay(0)" data-day="0" class="next-call-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-blue-400 hover:bg-blue-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">‰ªäÊó•</div>
                                            <div id="dayLabel0" class="text-base"></div>
                                        </button>
                                        <button onclick="setNextCallDay(1)" data-day="1" class="next-call-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-blue-400 hover:bg-blue-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">ÊòéÊó•</div>
                                            <div id="dayLabel1" class="text-base"></div>
                                        </button>
                                        <button onclick="setNextCallDay(2)" data-day="2" class="next-call-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-blue-400 hover:bg-blue-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">ÊòéÂæåÊó•</div>
                                            <div id="dayLabel2" class="text-base"></div>
                                        </button>
                                        <button onclick="setNextCallDay(3)" data-day="3" class="next-call-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-blue-400 hover:bg-blue-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">3Êó•Âæå</div>
                                            <div id="dayLabel3" class="text-base"></div>
                                        </button>
                                    </div>
                                    <div class="grid grid-cols-4 gap-2 mb-3">
                                        <button onclick="setNextCallDay(4)" data-day="4" class="next-call-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-blue-400 hover:bg-blue-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">4Êó•Âæå</div>
                                            <div id="dayLabel4" class="text-base"></div>
                                        </button>
                                        <button onclick="setNextCallDay(7)" data-day="7" class="next-call-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-blue-400 hover:bg-blue-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">1ÈÄ±ÈñìÂæå</div>
                                            <div id="dayLabel7" class="text-base"></div>
                                        </button>
                                        <button onclick="setNextCallDay(14)" data-day="14" class="next-call-day-btn py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-xl hover:border-blue-400 hover:bg-blue-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">2ÈÄ±ÈñìÂæå</div>
                                            <div id="dayLabel14" class="text-base"></div>
                                        </button>
                                        <button onclick="toggleCustomDatePicker()" class="py-3 bg-white border-2 border-gray-200 text-gray-500 rounded-xl hover:border-blue-400 hover:bg-blue-50 font-bold text-sm transition-all">
                                            <div class="text-xs text-gray-400">„Åù„ÅÆ‰ªñ</div>
                                            <div class="text-base">üìÜ</div>
                                        </button>
                                    </div>
                                    <!-- „Ç´„Çπ„Çø„É†Êó•‰ªòÈÅ∏ÊäûÔºàÈùûË°®Á§∫„Éá„Éï„Ç©„É´„ÉàÔºâ -->
                                    <div id="customDatePicker" class="hidden">
                                        <input type="date" id="nextCallDateInput" class="w-full p-3 border-2 border-blue-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all text-center font-bold">
                                    </div>
                                </div>

                                <!-- ÊôÇÈñìÂ∏ØÈÅ∏Êäû -->
                                <div class="bg-gray-50 rounded-xl p-4">
                                    <h4 class="text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                                        <span>‚è∞</span> ÊôÇÈñìÂ∏Ø„ÇíÈÅ∏Êäû
                                        <button onclick="openTimePresetSettings()" class="ml-auto text-gray-400 hover:text-blue-500 transition-all" title="„Éó„É™„Çª„ÉÉ„ÉàË®≠ÂÆö">‚öôÔ∏è</button>
                                    </h4>
                                    <!-- ÊôÇÈñìÂ∏Ø„Éó„É™„Çª„ÉÉ„Éà -->
                                    <div id="timePresetButtons" class="grid grid-cols-4 gap-2 mb-3">
                                        <!-- JS„ÅßÂãïÁöÑÁîüÊàê -->
                                    </div>
                                    <!-- „Ç´„Çπ„Çø„É†ÊôÇÈñìÈÅ∏ÊäûÔºàÈùûË°®Á§∫„Éá„Éï„Ç©„É´„ÉàÔºâ -->
                                    <div id="customTimePicker" class="hidden">
                                        <div class="flex items-center gap-2">
                                            <select id="nextCallHour" class="flex-1 p-3 border-2 border-blue-300 rounded-xl text-center font-bold focus:border-blue-500 transition-all" onchange="updateNextCallTimeDisplay()">
                                                <option value="">ÊôÇ</option>
                                                <option value="8">8ÊôÇ</option>
                                                <option value="9">9ÊôÇ</option>
                                                <option value="10">10ÊôÇ</option>
                                                <option value="11">11ÊôÇ</option>
                                                <option value="12">12ÊôÇ</option>
                                                <option value="13">13ÊôÇ</option>
                                                <option value="14">14ÊôÇ</option>
                                                <option value="15">15ÊôÇ</option>
                                                <option value="16">16ÊôÇ</option>
                                                <option value="17">17ÊôÇ</option>
                                                <option value="18">18ÊôÇ</option>
                                                <option value="19">19ÊôÇ</option>
                                                <option value="20">20ÊôÇ</option>
                                            </select>
                                            <span class="text-xl font-bold text-gray-400">:</span>
                                            <select id="nextCallMinute" class="flex-1 p-3 border-2 border-blue-300 rounded-xl text-center font-bold focus:border-blue-500 transition-all" onchange="updateNextCallTimeDisplay()">
                                                <option value="0">00ÂàÜ</option>
                                                <option value="10">10ÂàÜ</option>
                                                <option value="20">20ÂàÜ</option>
                                                <option value="30">30ÂàÜ</option>
                                                <option value="40">40ÂàÜ</option>
                                                <option value="50">50ÂàÜ</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÈÅ∏ÊäûÁµêÊûú„Éó„É¨„Éì„É•„Éº -->
                                <div id="nextCallPreview" class="bg-blue-50 rounded-xl p-4 border-2 border-blue-200 hidden">
                                    <div class="flex items-center justify-center gap-3">
                                        <span class="text-2xl">üìû</span>
                                        <div class="text-center">
                                            <div class="text-xs text-blue-600 font-medium">Ê¨°ÂõûÊû∂Èõª‰∫àÂÆö</div>
                                            <div id="nextCallPreviewText" class="text-xl font-bold text-blue-800">---</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- „Éï„ÉÉ„Çø„ÉºÔºàÂõ∫ÂÆöÔºâ -->
                            <div class="p-4 border-t bg-gray-50 flex-shrink-0">
                                <div class="flex gap-3">
                                    <button onclick="clearNextCallDate()" class="flex-1 py-3 bg-white border-2 border-gray-300 text-gray-600 rounded-xl hover:bg-gray-100 font-bold transition-all">
                                        „ÇØ„É™„Ç¢
                                    </button>
                                    <button onclick="saveNextCallDate()" id="nextCallSaveBtn" class="flex-[2] py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 font-bold shadow-lg hover:shadow-xl transition-all disabled:bg-gray-300 disabled:shadow-none">
                                        ‰øùÂ≠ò„Åô„Çã
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÊôÇÈñì„Éó„É™„Çª„ÉÉ„ÉàË®≠ÂÆö„É¢„Éº„ÉÄ„É´ -->
                <div id="timePresetModal" class="fixed inset-0 z-[60] hidden">
                    <div class="fixed inset-0 bg-black/60 backdrop-blur-sm" onclick="closeTimePresetModal()"></div>
                    <div class="fixed inset-0 flex items-center justify-center p-4">
                        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden">
                            <div class="p-4 border-b bg-gradient-to-r from-blue-500 to-blue-600">
                                <h3 class="text-lg font-bold text-white text-center">‚è∞ „Çà„Åè‰Ωø„ÅÜÊôÇÈñì„ÇíÁôªÈå≤</h3>
                            </div>
                            <div class="p-4 space-y-4 max-h-[60vh] overflow-y-auto">
                                <!-- Ë™¨Êòé -->
                                <div class="bg-blue-50 rounded-xl p-3 border border-blue-200">
                                    <p class="text-sm text-blue-800 leading-relaxed">
                                        <span class="font-bold">üìå ‰Ωø„ÅÑÊñπ</span><br>
                                        ÈõªË©±„Çí„Åã„Åë„ÇãÊôÇÈñì„Çí3„Å§ÁôªÈå≤„Åß„Åç„Åæ„Åô„ÄÇ<br>
                                        ‰øùÂ≠ò„Åô„Çã„Å®„ÄÅÊ¨°Âõû„Åã„ÇâÈÅ∏„Åπ„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åô„ÄÇ
                                    </p>
                                </div>
                                <!-- „Éó„É™„Çª„ÉÉ„Éà1 -->
                                <div class="bg-gray-50 rounded-xl p-3">
                                    <label class="text-sm font-bold text-gray-700 mb-2 block">‚ë† 1„Å§ÁõÆ„ÅÆÊôÇÈñì</label>
                                    <div class="flex items-center gap-2">
                                        <select id="presetTime1Hour" class="flex-1 p-2 border-2 border-gray-200 rounded-lg text-center font-bold">
                                            <option value="8">8ÊôÇ</option>
                                            <option value="9" selected>9ÊôÇ</option>
                                            <option value="10">10ÊôÇ</option>
                                            <option value="11">11ÊôÇ</option>
                                            <option value="12">12ÊôÇ</option>
                                            <option value="13">13ÊôÇ</option>
                                            <option value="14">14ÊôÇ</option>
                                            <option value="15">15ÊôÇ</option>
                                            <option value="16">16ÊôÇ</option>
                                            <option value="17">17ÊôÇ</option>
                                            <option value="18">18ÊôÇ</option>
                                            <option value="19">19ÊôÇ</option>
                                            <option value="20">20ÊôÇ</option>
                                        </select>
                                        <span class="text-gray-400">:</span>
                                        <select id="presetTime1Minute" class="flex-1 p-2 border-2 border-gray-200 rounded-lg text-center font-bold">
                                            <option value="0" selected>00ÂàÜ</option>
                                            <option value="10">10ÂàÜ</option>
                                            <option value="20">20ÂàÜ</option>
                                            <option value="30">30ÂàÜ</option>
                                            <option value="40">40ÂàÜ</option>
                                            <option value="50">50ÂàÜ</option>
                                        </select>
                                    </div>
                                </div>
                                <!-- „Éó„É™„Çª„ÉÉ„Éà2 -->
                                <div class="bg-gray-50 rounded-xl p-3">
                                    <label class="text-sm font-bold text-gray-700 mb-2 block">‚ë° 2„Å§ÁõÆ„ÅÆÊôÇÈñì</label>
                                    <div class="flex items-center gap-2">
                                        <select id="presetTime2Hour" class="flex-1 p-2 border-2 border-gray-200 rounded-lg text-center font-bold">
                                            <option value="8">8ÊôÇ</option>
                                            <option value="9">9ÊôÇ</option>
                                            <option value="10">10ÊôÇ</option>
                                            <option value="11">11ÊôÇ</option>
                                            <option value="12" selected>12ÊôÇ</option>
                                            <option value="13">13ÊôÇ</option>
                                            <option value="14">14ÊôÇ</option>
                                            <option value="15">15ÊôÇ</option>
                                            <option value="16">16ÊôÇ</option>
                                            <option value="17">17ÊôÇ</option>
                                            <option value="18">18ÊôÇ</option>
                                            <option value="19">19ÊôÇ</option>
                                            <option value="20">20ÊôÇ</option>
                                        </select>
                                        <span class="text-gray-400">:</span>
                                        <select id="presetTime2Minute" class="flex-1 p-2 border-2 border-gray-200 rounded-lg text-center font-bold">
                                            <option value="0" selected>00ÂàÜ</option>
                                            <option value="10">10ÂàÜ</option>
                                            <option value="20">20ÂàÜ</option>
                                            <option value="30">30ÂàÜ</option>
                                            <option value="40">40ÂàÜ</option>
                                            <option value="50">50ÂàÜ</option>
                                        </select>
                                    </div>
                                </div>
                                <!-- „Éó„É™„Çª„ÉÉ„Éà3 -->
                                <div class="bg-gray-50 rounded-xl p-3">
                                    <label class="text-sm font-bold text-gray-700 mb-2 block">‚ë¢ 3„Å§ÁõÆ„ÅÆÊôÇÈñì</label>
                                    <div class="flex items-center gap-2">
                                        <select id="presetTime3Hour" class="flex-1 p-2 border-2 border-gray-200 rounded-lg text-center font-bold">
                                            <option value="8">8ÊôÇ</option>
                                            <option value="9">9ÊôÇ</option>
                                            <option value="10">10ÊôÇ</option>
                                            <option value="11">11ÊôÇ</option>
                                            <option value="12">12ÊôÇ</option>
                                            <option value="13">13ÊôÇ</option>
                                            <option value="14">14ÊôÇ</option>
                                            <option value="15">15ÊôÇ</option>
                                            <option value="16">16ÊôÇ</option>
                                            <option value="17">17ÊôÇ</option>
                                            <option value="18" selected>18ÊôÇ</option>
                                            <option value="19">19ÊôÇ</option>
                                            <option value="20">20ÊôÇ</option>
                                        </select>
                                        <span class="text-gray-400">:</span>
                                        <select id="presetTime3Minute" class="flex-1 p-2 border-2 border-gray-200 rounded-lg text-center font-bold">
                                            <option value="0" selected>00ÂàÜ</option>
                                            <option value="10">10ÂàÜ</option>
                                            <option value="20">20ÂàÜ</option>
                                            <option value="30">30ÂàÜ</option>
                                            <option value="40">40ÂàÜ</option>
                                            <option value="50">50ÂàÜ</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4 border-t bg-gray-50">
                                <div class="flex gap-3">
                                    <button onclick="closeTimePresetModal()" class="flex-1 py-3 bg-white border-2 border-gray-300 text-gray-600 rounded-xl font-bold">„Ç≠„É£„É≥„Çª„É´</button>
                                    <button onclick="saveTimePresets()" class="flex-1 py-3 bg-blue-600 text-white rounded-xl font-bold shadow-lg">‰øùÂ≠ò</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÈÄöË©±ÁµêÊûú„É¢„Éº„ÉÄ„É´ÔºàÊé•Á∂ö/‰∏çÂú®ÈÅ∏ÊäûÔºâ -->
                <div id="connectionModal" class="fixed inset-0 z-50 hidden">
                    <div class="fixed inset-0 bg-black/60 backdrop-blur-sm" onclick="closeConnectionModal()"></div>
                    <div class="fixed inset-0 flex items-center justify-center p-4">
                        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden max-h-[90vh] overflow-y-auto">
                            <div class="px-5 py-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-white">
                                <h3 class="text-lg font-bold text-gray-900 text-center">ÈÄöË©±ÁµêÊûú</h3>
                            </div>
                            <div class="p-5 space-y-3">
                                <!-- Êé•Á∂ö/‰∏çÂú®ÈÅ∏Êäû -->
                                <div id="connectionBtnsContainer" class="flex gap-3">
                                    <button id="connectedBtn" onclick="selectConnectionStatus('connected')" class="flex-1 py-3 text-base font-bold bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2">
                                        <span class="text-xl">üìû</span>
                                        Êé•Á∂ö
                                    </button>
                                    <button id="absentBtn" onclick="selectConnectionStatus('absent')" class="flex-1 py-3 text-base font-bold bg-gradient-to-r from-gray-400 to-gray-500 text-white rounded-xl shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2">
                                        <span class="text-xl">üìµ</span>
                                        ‰∏çÂú®
                                    </button>
                                </div>

                                <!-- Ê¨°ÂõûÊû∂Èõª„ÇØ„Ç§„ÉÉ„ÇØË®≠ÂÆö -->
                                <div id="nextCallQuickSettings" class="hidden p-4 bg-gray-50 rounded-xl">
                                    <h4 class="text-sm font-semibold text-gray-700 mb-3">Ê¨°ÂõûÊû∂Èõª„ÇíË®≠ÂÆö</h4>
                                    <div class="flex gap-2 mb-3">
                                        <!-- Êó•‰ªò„Éú„Çø„É≥ -->
                                        <div class="grid grid-cols-2 gap-1.5 w-24 flex-shrink-0">
                                            <button onclick="setQuickCallDay('today')" data-day="today" class="quick-day-btn px-1.5 py-2 text-xs font-medium bg-white border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all">ÂΩìÊó•</button>
                                            <button onclick="setQuickCallDay('tomorrow')" data-day="tomorrow" class="quick-day-btn px-1.5 py-2 text-xs font-medium bg-white border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all">ÊòéÊó•</button>
                                            <button onclick="setQuickCallDay('saturday')" data-day="saturday" class="quick-day-btn px-1.5 py-2 text-xs font-medium bg-white border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all">Âúü</button>
                                            <button onclick="setQuickCallDay('sunday')" data-day="sunday" class="quick-day-btn px-1.5 py-2 text-xs font-medium bg-white border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all">Êó•</button>
                                        </div>
                                        <!-- ÊôÇÈñì„Éú„Çø„É≥ -->
                                        <div class="flex-1 grid grid-cols-4 gap-1.5">
                                            <button onclick="setQuickCallTime(9)" data-hour="9" class="quick-time-btn px-1 py-2 text-sm font-medium bg-white border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all">9ÊôÇ</button>
                                            <button onclick="setQuickCallTime(12)" data-hour="12" class="quick-time-btn px-1 py-2 text-sm font-medium bg-white border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all">12ÊôÇ</button>
                                            <button onclick="setQuickCallTime(17)" data-hour="17" class="quick-time-btn px-1 py-2 text-sm font-medium bg-white border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all">17ÊôÇ</button>
                                            <button onclick="setQuickCallTime(19)" data-hour="19" class="quick-time-btn px-1 py-2 text-sm font-medium bg-white border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all">19ÊôÇ</button>
                                        </div>
                                    </div>
                                    <!-- ÂàÜÊï∞„Éó„É´„ÉÄ„Ç¶„É≥ -->
                                    <div class="flex items-center gap-2 mb-3">
                                        <span class="text-xs text-gray-500 flex-shrink-0">ÂàÜÔºö</span>
                                        <select id="quickCallMinute" onchange="updateSelectedNextCallDisplay()" class="flex-1 px-2 py-1.5 border-2 border-gray-300 rounded-lg text-sm focus:border-blue-500 transition-all">
                                            <option value="0">00ÂàÜ</option>
                                            <option value="15">15ÂàÜ</option>
                                            <option value="30">30ÂàÜ</option>
                                            <option value="45">45ÂàÜ</option>
                                        </select>
                                    </div>
                                    <div id="selectedNextCall" class="text-center text-sm text-blue-600 font-medium mb-3 hidden"></div>
                                    <div class="flex gap-2">
                                        <button onclick="skipNextCallSetting()" class="flex-1 py-2 text-sm font-medium bg-white border-2 border-gray-300 text-gray-600 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all">
                                            Êàª„Çã
                                        </button>
                                        <button onclick="confirmConnectionResult()" class="flex-1 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-all text-sm">
                                            Á¢∫ÂÆö
                                        </button>
                                    </div>
                                </div>

                                <!-- „É°„É¢ÂÖ•Âäõ„Çª„ÇØ„Ç∑„Éß„É≥ÔºàÊé•Á∂öÊôÇ„ÅÆ„ÅøË°®Á§∫Ôºâ -->
                                <div id="memoSection" class="hidden">
                                    <div class="bg-amber-50 rounded-xl p-4 border border-amber-200">
                                        <h4 class="text-sm font-bold text-amber-800 mb-3 flex items-center gap-2">
                                            <span>üìû</span> ÈÄöË©±„É°„É¢
                                        </h4>
                                        <textarea id="connectionMemo" rows="3" placeholder="ÈÄöË©±ÂÜÖÂÆπ„Çí„É°„É¢..." class="w-full p-3 border-2 border-amber-200 rounded-xl text-base focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-all resize-none bg-white"></textarea>
                                        <!-- „ÇØ„Ç§„ÉÉ„ÇØÂÖ•Âäõ„Éú„Çø„É≥ -->
                                        <div class="flex flex-wrap gap-2 mt-3 mb-4">
                                            <button onclick="appendConnectionMemo('„Ç¢„ÉùÂèñÂæó')" class="px-3 py-1.5 bg-white border border-gray-300 rounded-lg text-xs font-medium text-gray-600 hover:bg-green-50 hover:border-green-400 transition-all">‚úÖ „Ç¢„ÉùÂèñÂæó</button>
                                            <button onclick="appendConnectionMemo('Ê§úË®é‰∏≠')" class="px-3 py-1.5 bg-white border border-gray-300 rounded-lg text-xs font-medium text-gray-600 hover:bg-gray-50 transition-all">ü§î Ê§úË®é‰∏≠</button>
                                            <button onclick="appendConnectionMemo('Áõ∏Ë¶ãÁ©ç‰∏≠')" class="px-3 py-1.5 bg-white border border-gray-300 rounded-lg text-xs font-medium text-gray-600 hover:bg-gray-50 transition-all">üìä Áõ∏Ë¶ãÁ©ç‰∏≠</button>
                                            <button onclick="appendConnectionMemo('Ë¶ãÁ©çÂ∏åÊúõ')" class="px-3 py-1.5 bg-white border border-gray-300 rounded-lg text-xs font-medium text-gray-600 hover:bg-blue-50 hover:border-blue-400 transition-all">üìù Ë¶ãÁ©çÂ∏åÊúõ</button>
                                        </div>
                                        <div class="flex gap-2">
                                            <button onclick="backToConnectionSelect()" class="flex-1 py-2.5 text-sm font-medium bg-white border-2 border-gray-300 text-gray-600 rounded-xl hover:border-gray-400 hover:bg-gray-50 transition-all">
                                                Êàª„Çã
                                            </button>
                                            <button onclick="confirmMemoAndShowStatus()" class="flex-1 py-2.5 bg-green-500 text-white rounded-xl font-bold hover:bg-green-600 shadow-md transition-all text-sm">
                                                Ê¨°„Å∏ ‚Üí
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÈÅ∏Êäû„Çª„ÇØ„Ç∑„Éß„É≥ -->
                                <div id="statusSection" class="hidden">
                                    <div class="p-4 bg-gray-50 rounded-xl">
                                        <h4 class="text-sm font-semibold text-gray-700 mb-3">„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥</h4>
                                        <div class="grid grid-cols-3 gap-2 mb-3">
                                            <button onclick="selectCaseStatus('ÂØæÂøúÂæÖ„Å°')" class="case-status-btn py-2 text-xs font-medium bg-white border-2 border-gray-300 rounded-lg hover:border-red-500 hover:bg-red-50 transition-all">ÂØæÂøúÂæÖ„Å°</button>
                                            <button onclick="selectCaseStatus('Ë®™ÂïèÊ∏à„Åø')" class="case-status-btn py-2 text-xs font-medium bg-white border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all">Ë®™ÂïèÊ∏à„Åø</button>
                                            <button onclick="selectCaseStatus('Ë¶ãÁ©çÊèêÂá∫Ê∏à„Åø')" class="case-status-btn py-2 text-xs font-medium bg-white border-2 border-gray-300 rounded-lg hover:border-amber-500 hover:bg-amber-50 transition-all">Ë¶ãÁ©çÊèêÂá∫</button>
                                            <button onclick="selectCaseStatus('ÊàêÁ¥Ñ')" class="case-status-btn py-2 text-xs font-medium bg-white border-2 border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-all">ÊàêÁ¥Ñ</button>
                                            <button onclick="selectCaseStatus('„Ç≠„É£„É≥„Çª„É´')" class="case-status-btn py-2 text-xs font-medium bg-white border-2 border-gray-300 rounded-lg hover:border-gray-500 hover:bg-gray-100 transition-all">„Ç≠„É£„É≥„Çª„É´</button>
                                            <button onclick="skipStatusChange()" class="py-2 text-xs font-medium bg-gray-200 text-gray-600 rounded-lg hover:bg-gray-300 transition-all">Â§âÊõ¥„Å™„Åó</button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Êàª„Çã„Éú„Çø„É≥Ôºà„É¢„Éº„ÉÄ„É´‰∏ãÈÉ®Ôºâ -->
                                <button onclick="closeConnectionModal()" id="closeConnectionBtn" class="w-full py-2 text-sm text-gray-500 hover:text-gray-700 transition-all">
                                    Èñâ„Åò„Çã
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Áµ±ÂêàÁµû„ÇäËæº„Åø„É¢„Éº„ÉÄ„É´Ôºà„Çπ„ÉÜ„Éº„Çø„ÇπÔºãÈÖç‰ø°Êó•„ÇíÂêà‰ΩìÔºâ -->
                <div id="unifiedFilterModal" class="fixed inset-0 z-50 hidden">
                    <div class="fixed inset-0 bg-black/60 backdrop-blur-sm" onclick="closeUnifiedFilterModal()"></div>
                    <div class="fixed inset-0 flex items-end sm:items-center justify-center p-0 sm:p-4">
                        <div class="bg-white rounded-t-3xl sm:rounded-2xl shadow-2xl w-full sm:max-w-md max-h-[95vh] sm:max-h-[90vh] flex flex-col overflow-hidden">
                            <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                            <div class="px-5 py-4 bg-gradient-to-r from-purple-400 to-purple-600 flex-shrink-0">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <h3 class="text-lg font-bold text-white">Áµû„ÇäËæº„Åø</h3>
                                        <p id="unifiedFilterStatus" class="text-sm text-purple-200 mt-0.5">„Åô„Åπ„Å¶Ë°®Á§∫‰∏≠</p>
                                    </div>
                                    <button onclick="closeUnifiedFilterModal()" class="text-white/80 hover:text-white hover:bg-white/20 rounded-full p-2 transition-all">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑÔºà„Çπ„ÇØ„É≠„Éº„É´ÂèØËÉΩÔºâ -->
                            <div class="flex-1 overflow-y-auto px-5 py-4">
                                <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÁµû„ÇäËæº„Åø -->
                                <div class="mb-6">
                                    <h4 class="text-base font-bold text-gray-900 mb-3 flex items-center gap-2">
                                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
                                        „Çπ„ÉÜ„Éº„Çø„Çπ„ÅßÁµû„ÇäËæº„ÇÄ
                                    </h4>

                                    <!-- „Ç¢„ÉùÂâç/„Ç¢„ÉùÂæå „Éó„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥ -->
                                    <p class="text-xs text-gray-400 mb-2">„Åã„Çì„Åü„ÇìÈÅ∏Êäû</p>
                                    <div class="flex gap-3 mb-3">
                                        <button id="uf-preset-before" onclick="ufSelectCallTargetStatuses()" class="flex-1 px-4 py-4 bg-white text-gray-600 border-2 border-gray-300 rounded-xl hover:border-blue-400 transition-all font-bold text-base">
                                            üìû „Ç¢„ÉùÂâç
                                        </button>
                                        <button id="uf-preset-after" onclick="ufSelectInProgressStatuses()" class="flex-1 px-4 py-4 bg-white text-gray-600 border-2 border-gray-300 rounded-xl hover:border-orange-400 transition-all font-bold text-base">
                                            üî• „Ç¢„ÉùÂæå
                                        </button>
                                    </div>

                                    <!-- ÂÄãÂà•„Çπ„ÉÜ„Éº„Çø„ÇπÔºàÈÅ∏ÊäûÊôÇ„ÅÆ„ÅøË°®Á§∫Ôºâ -->
                                    <div id="uf-detail-statuses" class="hidden">
                                        <p class="text-xs text-gray-400 mb-2">Ë©≥Á¥∞ÈÅ∏Êäû</p>
                                        <div class="grid grid-cols-3 gap-1.5 mb-3">
                                            <button id="uf-status-btn-Êñ∞ÁùÄ" onclick="ufToggleStatusFilter('Êñ∞ÁùÄ')" class="uf-status-filter-btn px-2 py-2 border-2 border-gray-200 bg-white text-gray-600 rounded-lg hover:border-gray-400 transition-all text-xs font-medium">Êñ∞ÁùÄ</button>
                                            <button id="uf-status-btn-Êú™„Ç¢„Éù" onclick="ufToggleStatusFilter('Êú™„Ç¢„Éù')" class="uf-status-filter-btn px-2 py-2 border-2 border-gray-200 bg-white text-gray-600 rounded-lg hover:border-gray-400 transition-all text-xs font-medium">Êú™„Ç¢„Éù</button>
                                            <button id="uf-status-btn-„Ç¢„ÉùÊ∏à" onclick="ufToggleStatusFilter('„Ç¢„ÉùÊ∏à')" class="uf-status-filter-btn px-2 py-2 border-2 border-gray-200 bg-white text-gray-600 rounded-lg hover:border-gray-400 transition-all text-xs font-medium">„Ç¢„ÉùÊ∏à</button>
                                            <button id="uf-status-btn-ÁèæË™øÊ∏à" onclick="ufToggleStatusFilter('ÁèæË™øÊ∏à')" class="uf-status-filter-btn px-2 py-2 border-2 border-gray-200 bg-white text-gray-600 rounded-lg hover:border-gray-400 transition-all text-xs font-medium">ÁèæË™øÊ∏à</button>
                                            <button id="uf-status-btn-Ë¶ãÁ©çÊèêÂá∫Ê∏à" onclick="ufToggleStatusFilter('Ë¶ãÁ©çÊèêÂá∫Ê∏à')" class="uf-status-filter-btn px-2 py-2 border-2 border-gray-200 bg-white text-gray-600 rounded-lg hover:border-gray-400 transition-all text-xs font-medium">Ë¶ãÁ©çÊèêÂá∫</button>
                                            <button id="uf-status-btn-ÂÖ•Èáë‰∫àÂÆö" onclick="ufToggleStatusFilter('ÂÖ•Èáë‰∫àÂÆö')" class="uf-status-filter-btn px-2 py-2 border-2 border-gray-200 bg-white text-gray-600 rounded-lg hover:border-gray-400 transition-all text-xs font-medium">ÂÖ•Èáë‰∫àÂÆö</button>
                                            <button id="uf-status-btn-ÊàêÁ¥Ñ" onclick="ufToggleStatusFilter('ÊàêÁ¥Ñ')" class="uf-status-filter-btn px-2 py-2 border-2 border-gray-200 bg-white text-gray-600 rounded-lg hover:border-gray-400 transition-all text-xs font-medium">ÊàêÁ¥Ñ</button>
                                            <button id="uf-status-btn-ÂÖ•ÈáëÊ∏à" onclick="ufToggleStatusFilter('ÂÖ•ÈáëÊ∏à')" class="uf-status-filter-btn px-2 py-2 border-2 border-gray-200 bg-white text-gray-600 rounded-lg hover:border-gray-400 transition-all text-xs font-medium">ÂÖ•ÈáëÊ∏à</button>
                                            <button id="uf-status-btn-ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´" onclick="ufToggleStatusFilter('ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´')" class="uf-status-filter-btn px-2 py-2 border-2 border-gray-200 bg-white text-gray-600 rounded-lg hover:border-gray-400 transition-all text-xs font-medium">ÁèæË™øÂâçCN</button>
                                            <button id="uf-status-btn-ÁèæË™øÂæåÂ§±Ê≥®" onclick="ufToggleStatusFilter('ÁèæË™øÂæåÂ§±Ê≥®')" class="uf-status-filter-btn px-2 py-2 border-2 border-gray-200 bg-white text-gray-600 rounded-lg hover:border-gray-400 transition-all text-xs font-medium">ÁèæË™øÂæåÂ§±Ê≥®</button>
                                            <button id="uf-status-btn-‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à" onclick="ufToggleStatusFilter('‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à')" class="uf-status-filter-btn px-2 py-2 border-2 border-gray-200 bg-white text-gray-600 rounded-lg hover:border-gray-400 transition-all text-xs font-medium">‰ªñÁ§æÂ•ëÁ¥Ñ</button>
                                            <button id="uf-status-btn-Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à" onclick="ufToggleStatusFilter('Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à')" class="uf-status-filter-btn px-2 py-2 border-2 border-gray-200 bg-white text-gray-600 rounded-lg hover:border-gray-400 transition-all text-xs font-medium">Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥Ñ</button>
                                            <button id="uf-status-btn-„ÇØ„É¨„Éº„É†" onclick="ufToggleStatusFilter('„ÇØ„É¨„Éº„É†')" class="uf-status-filter-btn px-2 py-2 border-2 border-gray-200 bg-white text-gray-600 rounded-lg hover:border-gray-400 transition-all text-xs font-medium">„ÇØ„É¨„Éº„É†</button>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÈÖç‰ø°Êó•Áµû„ÇäËæº„Åø -->
                                <div class="pt-4 border-t border-gray-200">
                                    <h4 class="text-base font-bold text-gray-900 mb-3 flex items-center gap-2">
                                        <svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                                        ÈÖç‰ø°Êó•„ÅßÁµû„ÇäËæº„ÇÄ
                                        <span id="ufDateFilterLabel" class="ml-auto text-xs px-2 py-0.5 bg-gray-100 text-gray-600 rounded-full font-medium">„Åô„Åπ„Å¶</span>
                                    </h4>

                                    <!-- ÊúüÈñì„Éú„Çø„É≥ÔºàÂÖ®ÊúüÈñì/‰ªäÊúà/ÂÖàÊúàÔºâ -->
                                    <div class="flex gap-2 mb-3">
                                        <button id="uf-period-all" onclick="ufSetPeriodFilter('all')" class="flex-1 px-3 py-3 bg-white text-gray-600 border-2 border-gray-300 rounded-xl hover:border-yellow-400 transition-all font-bold text-sm">
                                            ÂÖ®ÊúüÈñì
                                        </button>
                                        <button id="uf-period-thismonth" onclick="ufSetPeriodFilter('thismonth')" class="flex-1 px-3 py-3 bg-white text-gray-600 border-2 border-gray-300 rounded-xl hover:border-yellow-400 transition-all font-bold text-sm">
                                            ‰ªäÊúà
                                        </button>
                                        <button id="uf-period-lastmonth" onclick="ufSetPeriodFilter('lastmonth')" class="flex-1 px-3 py-3 bg-white text-gray-600 border-2 border-gray-300 rounded-xl hover:border-yellow-400 transition-all font-bold text-sm">
                                            ÂÖàÊúà
                                        </button>
                                    </div>

                                    <!-- „Ç´„Çπ„Çø„É†Êó•‰ªòÁØÑÂõ≤Ôºà‰ªäÊúà/ÂÖàÊúàÈÅ∏ÊäûÊôÇ„Å´Ë°®Á§∫Ôºâ -->
                                    <div id="uf-custom-date-range" class="hidden">
                                        <p class="text-xs text-gray-400 mb-2">ÊúüÈñì„ÇíË™øÊï¥„Åß„Åç„Åæ„Åô</p>
                                        <div class="flex items-center gap-3">
                                            <input type="date" id="ufModalDateFrom" class="flex-1 px-3 py-2 border-2 border-gray-200 rounded-xl text-sm font-medium focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200 transition-all">
                                            <span class="text-gray-400 font-bold">„Äú</span>
                                            <input type="date" id="ufModalDateTo" class="flex-1 px-3 py-2 border-2 border-gray-200 rounded-xl text-sm font-medium focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200 transition-all">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- „Éï„ÉÉ„Çø„Éº -->
                            <div class="flex gap-2 p-4 border-t border-gray-200 bg-gray-50 flex-shrink-0">
                                <button onclick="clearUnifiedFilter()" class="flex-1 px-4 py-3 bg-gray-100 text-gray-700 border border-gray-300 rounded-xl shadow-sm hover:bg-gray-200 transition-all font-medium">
                                    „ÇØ„É™„Ç¢
                                </button>
                                <button onclick="applyUnifiedFilter()" class="flex-1 px-4 py-3 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-xl shadow-md hover:shadow-lg transition-all font-semibold">
                                    ÈÅ©Áî®„Åô„Çã
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- „ÇΩ„Éº„Éà„É¢„Éº„ÉÄ„É´Ôºà„Çπ„ÉÜ„Éº„Çø„ÇπÁµû„ÇäËæº„ÅøÔºâ‚ÄªÂæåÊñπ‰∫íÊèõÁî® -->
                <div id="sortModal" class="fixed inset-0 z-50 hidden">
                    <div class="fixed inset-0 bg-black/50" onclick="closeSortModal()"></div>
                    <div class="fixed inset-0 flex items-center justify-center p-4">
                        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full max-h-[85vh] flex flex-col">
                            <div class="flex justify-between items-center p-5 pb-3 flex-shrink-0">
                                <div>
                                    <h3 class="text-lg font-bold text-gray-900">„Çπ„ÉÜ„Éº„Çø„ÇπÁµû„ÇäËæº„Åø</h3>
                                    <p id="selectedStatusCount" class="text-sm text-blue-600 font-medium">„Åô„Åπ„Å¶Ë°®Á§∫‰∏≠</p>
                                </div>
                                <button onclick="closeSortModal()" class="text-gray-400 hover:text-gray-600 p-1">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>
                            <div class="flex-1 overflow-y-auto px-5">
                                <!-- „Éó„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥ -->
                                <div class="flex gap-2 mb-4 pb-4 border-b border-gray-200">
                                    <button onclick="selectCallTargetStatuses()" class="flex-1 px-3 py-2 bg-blue-100 text-blue-700 border-2 border-blue-400 rounded-lg hover:bg-blue-200 transition-all font-medium text-sm">
                                        üìû „Ç¢„ÉùÂâç
                                    </button>
                                    <button onclick="selectInProgressStatuses()" class="flex-1 px-3 py-2 bg-orange-100 text-orange-700 border-2 border-orange-400 rounded-lg hover:bg-orange-200 transition-all font-medium text-sm">
                                        üî• „Ç¢„ÉùÂæå
                                    </button>
                                </div>

                                <!-- ÂØæÂøú‰∏≠„Çπ„ÉÜ„Éº„Çø„Çπ -->
                                <div class="mb-4">
                                    <h4 class="text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                        <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                        ÂØæÂøú‰∏≠
                                    </h4>
                                    <div class="grid grid-cols-3 gap-1.5">
                                        <button id="status-btn-Êñ∞ÁùÄ" onclick="toggleStatusFilter('Êñ∞ÁùÄ')" class="status-filter-btn px-2 py-1.5 border-2 border-blue-400 bg-blue-100 text-blue-800 rounded-lg shadow-sm hover:shadow-md transition-all text-xs font-medium">Êñ∞ÁùÄ</button>
                                        <button id="status-btn-Êú™„Ç¢„Éù" onclick="toggleStatusFilter('Êú™„Ç¢„Éù')" class="status-filter-btn px-2 py-1.5 border-2 border-pink-400 bg-pink-100 text-pink-700 rounded-lg shadow-sm hover:shadow-md transition-all text-xs font-medium">Êú™„Ç¢„Éù</button>
                                        <button id="status-btn-„Ç¢„ÉùÊ∏à" onclick="toggleStatusFilter('„Ç¢„ÉùÊ∏à')" class="status-filter-btn px-2 py-1.5 border-2 border-orange-400 bg-orange-100 text-orange-800 rounded-lg shadow-sm hover:shadow-md transition-all text-xs font-medium">„Ç¢„ÉùÊ∏à</button>
                                        <button id="status-btn-ÁèæË™øÊ∏à" onclick="toggleStatusFilter('ÁèæË™øÊ∏à')" class="status-filter-btn px-2 py-1.5 border-2 border-purple-400 bg-purple-100 text-purple-800 rounded-lg shadow-sm hover:shadow-md transition-all text-xs font-medium">ÁèæË™øÊ∏à</button>
                                        <button id="status-btn-Ë¶ãÁ©çÊèêÂá∫Ê∏à" onclick="toggleStatusFilter('Ë¶ãÁ©çÊèêÂá∫Ê∏à')" class="status-filter-btn px-2 py-1.5 border-2 border-amber-400 bg-amber-100 text-amber-800 rounded-lg shadow-sm hover:shadow-md transition-all text-xs font-medium">Ë¶ãÁ©çÊèêÂá∫</button>
                                        <button id="status-btn-ÂÖ•Èáë‰∫àÂÆö" onclick="toggleStatusFilter('ÂÖ•Èáë‰∫àÂÆö')" class="status-filter-btn px-2 py-1.5 border-2 border-cyan-400 bg-cyan-100 text-cyan-800 rounded-lg shadow-sm hover:shadow-md transition-all text-xs font-medium">ÂÖ•Èáë‰∫àÂÆö</button>
                                    </div>
                                </div>

                                <!-- ÂÆå‰∫Ü„Çπ„ÉÜ„Éº„Çø„ÇπÔºàÁ∑ëÁ≥ªÔºâ -->
                                <div class="mb-4">
                                    <h4 class="text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                        <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                        ÂÆå‰∫Ü
                                    </h4>
                                    <div class="grid grid-cols-3 gap-1.5">
                                        <button id="status-btn-ÊàêÁ¥Ñ" onclick="toggleStatusFilter('ÊàêÁ¥Ñ')" class="status-filter-btn px-2 py-1.5 border-2 border-green-400 bg-green-100 text-green-800 rounded-lg shadow-sm hover:shadow-md transition-all text-xs font-medium">ÊàêÁ¥Ñ</button>
                                        <button id="status-btn-ÂÖ•ÈáëÊ∏à" onclick="toggleStatusFilter('ÂÖ•ÈáëÊ∏à')" class="status-filter-btn px-2 py-1.5 border-2 border-emerald-400 bg-emerald-100 text-emerald-800 rounded-lg shadow-sm hover:shadow-md transition-all text-xs font-medium">ÂÖ•ÈáëÊ∏à</button>
                                    </div>
                                </div>

                                <!-- „Ç≠„É£„É≥„Çª„É´„ÉªÂ§±Ê≥®„Çπ„ÉÜ„Éº„Çø„ÇπÔºà„Ç∞„É¨„ÉºÁ≥ª + Ëµ§Ôºâ -->
                                <div class="pb-4">
                                    <h4 class="text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                        <span class="w-2 h-2 bg-gray-500 rounded-full"></span>
                                        „Ç≠„É£„É≥„Çª„É´„ÉªÂ§±Ê≥®
                                    </h4>
                                    <div class="grid grid-cols-3 gap-1.5">
                                        <button id="status-btn-ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´" onclick="toggleStatusFilter('ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´')" class="status-filter-btn px-2 py-1.5 border-2 border-gray-400 bg-gray-100 text-gray-600 rounded-lg shadow-sm hover:shadow-md transition-all text-xs font-medium">ÁèæË™øÂâçCN</button>
                                        <button id="status-btn-ÁèæË™øÂæåÂ§±Ê≥®" onclick="toggleStatusFilter('ÁèæË™øÂæåÂ§±Ê≥®')" class="status-filter-btn px-2 py-1.5 border-2 border-gray-500 bg-gray-200 text-gray-700 rounded-lg shadow-sm hover:shadow-md transition-all text-xs font-medium">ÁèæË™øÂæåÂ§±Ê≥®</button>
                                        <button id="status-btn-‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à" onclick="toggleStatusFilter('‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à')" class="status-filter-btn px-2 py-1.5 border-2 border-gray-400 bg-gray-100 text-gray-600 rounded-lg shadow-sm hover:shadow-md transition-all text-xs font-medium">‰ªñÁ§æÂ•ëÁ¥Ñ</button>
                                        <button id="status-btn-Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à" onclick="toggleStatusFilter('Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à')" class="status-filter-btn px-2 py-1.5 border-2 border-indigo-400 bg-indigo-100 text-indigo-700 rounded-lg shadow-sm hover:shadow-md transition-all text-xs font-medium">Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥Ñ</button>
                                        <button id="status-btn-„ÇØ„É¨„Éº„É†" onclick="toggleStatusFilter('„ÇØ„É¨„Éº„É†')" class="status-filter-btn px-2 py-1.5 border-2 border-red-400 bg-red-100 text-red-800 rounded-lg shadow-sm hover:shadow-md transition-all text-xs font-medium">„ÇØ„É¨„Éº„É†</button>
                                    </div>
                                </div>
                            </div>
                            <div class="flex gap-2 p-5 pt-3 border-t border-gray-200 bg-white flex-shrink-0">
                                <button onclick="clearStatusFilter()" class="flex-1 px-4 py-2.5 bg-gray-100 text-gray-700 border border-gray-300 rounded-lg shadow-sm hover:bg-gray-200 transition-all font-medium text-sm">
                                    „ÇØ„É™„Ç¢
                                </button>
                                <button onclick="applyStatusFilter()" class="flex-1 px-4 py-2.5 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg shadow-md hover:shadow-lg transition-all font-semibold text-sm">
                                    Ë®≠ÂÆö
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÈÖç‰ø°Êó•„Éï„Ç£„É´„Çø„É¢„Éº„ÉÄ„É´ -->
                <div id="dateFilterModal" class="fixed inset-0 z-50 hidden">
                    <div class="fixed inset-0 bg-black/60 backdrop-blur-sm" onclick="closeDateFilterModal()"></div>
                    <div class="fixed inset-0 flex items-center justify-center p-4">
                        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden">
                            <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                            <div class="px-5 py-4 bg-gradient-to-r from-indigo-500 to-purple-600">
                                <div class="flex justify-between items-center">
                                    <h3 class="text-lg font-bold text-white">üì¶ ÈÖç‰ø°Êó•</h3>
                                    <button onclick="closeDateFilterModal()" class="text-white/80 hover:text-white hover:bg-white/20 rounded-lg p-1.5 transition-all">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
                            <div class="p-5">
                                <!-- ÊúàÈÅ∏Êäû„Éú„Çø„É≥ÔºàÂãïÁöÑÁîüÊàêÔºâ -->
                                <div class="mb-5">
                                    <label class="block text-sm font-bold text-gray-700 mb-3">Êúà„ÅßÁµû„ÇäËæº„Åø</label>
                                    <div id="monthButtonsContainer" class="grid grid-cols-3 gap-2">
                                        <!-- JS„ÅßÂãïÁöÑÁîüÊàê -->
                                    </div>
                                </div>
                                <!-- „Ç´„Çπ„Çø„É†Êó•‰ªòÁØÑÂõ≤ -->
                                <div class="mb-5">
                                    <label class="block text-sm font-bold text-gray-700 mb-3">Êó•‰ªò„ÅßÊåáÂÆö</label>
                                    <div class="flex items-center gap-3">
                                        <input type="date" id="modalDateFrom" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl text-sm font-medium focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all">
                                        <span class="text-gray-400 font-bold">„Äú</span>
                                        <input type="date" id="modalDateTo" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl text-sm font-medium focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all">
                                    </div>
                                </div>
                                <div class="flex gap-3">
                                    <button onclick="clearDateFilter()" class="flex-1 py-3 bg-gray-100 text-gray-600 rounded-xl font-bold hover:bg-gray-200 transition-all">
                                        „ÇØ„É™„Ç¢
                                    </button>
                                    <button onclick="applyDateFilter()" class="flex-1 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-bold hover:from-indigo-600 hover:to-purple-700 shadow-lg hover:shadow-xl transition-all">
                                        ÈÅ©Áî®
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‰∏¶„Å≥È†Ü„É¢„Éº„ÉÄ„É´ -->
                <div id="sortOrderModal" class="fixed inset-0 z-50 hidden">
                    <div class="fixed inset-0 bg-black/60 backdrop-blur-sm" onclick="closeSortOrderModal()"></div>
                    <div class="fixed inset-0 flex items-center justify-center p-4">
                        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-xs overflow-hidden">
                            <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                            <div class="px-5 py-4 bg-gradient-to-r from-amber-500 to-orange-500">
                                <div class="flex justify-between items-center">
                                    <h3 class="text-lg font-bold text-white">üìä ‰∏¶„Å≥È†Ü</h3>
                                    <button onclick="closeSortOrderModal()" class="text-white/80 hover:text-white hover:bg-white/20 rounded-lg p-1.5 transition-all">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
                            <div class="p-5">
                                <div class="flex flex-col gap-3">
                                    <button onclick="selectSortOrder('date-desc')" class="sort-order-btn py-3 px-4 rounded-xl border-2 border-amber-500 bg-amber-50 text-gray-900 font-bold text-sm text-center" data-value="date-desc">Êñ∞ÁùÄÈ†ÜÔºàÈÖç‰ø°Êó•Ôºâ</button>
                                    <button onclick="selectSortOrder('nextcall-asc')" class="sort-order-btn py-3 px-4 rounded-xl border-2 border-gray-200 bg-white text-gray-900 font-bold text-sm text-center hover:bg-gray-50 transition-all" data-value="nextcall-asc">Ê¨°ÂõûÊû∂ÈõªÈ†Ü</button>
                                    <button onclick="selectSortOrder('status')" class="sort-order-btn py-3 px-4 rounded-xl border-2 border-gray-200 bg-white text-gray-900 font-bold text-sm text-center hover:bg-gray-50 transition-all" data-value="status">„Çπ„ÉÜ„Éº„Çø„ÇπÈ†Ü</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- casesSection„ÅÆÁµÇ‰∫Ü -->

            <!-- Ë≤°ÂãôÁÆ°ÁêÜ„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="billingSection" class="section" style="display: none;">
                <div class="mb-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">Ë≤°ÂãôÁÆ°ÁêÜ</h2>
                    <div class="flex space-x-2">
                        <button onclick="exportFinancialReport()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
                            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            CSVÂá∫Âäõ
                        </button>
                    </div>
                </div>

                <!-- „Çµ„Éû„É™„Éº„Ç´„Éº„Éâ -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500" id="referralFeeMonth">1ÊúàÁ¥π‰ªãÊñô</p>
                                <p class="text-2xl font-bold text-gray-900" id="referralFeeAmount">¬•132,000</p>
                                <p class="text-xs text-gray-500" id="referralFeeCases">Ê°à‰ª∂6‰ª∂ÂàÜ</p>
                            </div>
                            <div class="p-3 bg-blue-100 rounded-full">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500" id="commissionMonth">1ÊúàÊàêÁ¥ÑÊâãÊï∞Êñô</p>
                                <p class="text-2xl font-bold text-green-600" id="commissionAmount">¬•180,000</p>
                                <p class="text-xs text-gray-500" id="commissionCases">ÊàêÁ¥Ñ2‰ª∂ÂàÜ</p>
                            </div>
                            <div class="p-3 bg-green-100 rounded-full">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500" id="profitLabel">Á¥ØË®àÂà©Áõä</p>
                                <p class="text-2xl font-bold text-yellow-600" id="profitAmount">¬•650,000</p>
                                <p class="text-xs text-gray-500" id="profitPeriod">2025Âπ¥Â∫¶</p>
                            </div>
                            <div class="p-3 bg-yellow-100 rounded-full">
                                <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500" id="roiLabel">1ÊúàROI</p>
                                <p class="text-2xl font-bold text-blue-600" id="roiValue">3265%</p>
                                <p class="text-xs text-gray-500" id="roiPrevious">ÂâçÊúà: 2850%</p>
                            </div>
                            <div class="p-3 bg-red-100 rounded-full">
                                <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
                <div class="bg-white rounded-lg shadow mb-6">
                    <div class="border-b border-gray-200 overflow-x-auto">
                        <nav class="flex -mb-px min-w-max">
                            <button onclick="showBillingTab('purchase')" class="billing-tab billing-tab-active px-4 sm:px-6 py-3 border-b-2 font-medium text-xs sm:text-sm whitespace-nowrap" data-tab="purchase">
                                Á¥π‰ªãÊñôÂ±•Ê≠¥
                            </button>
                            <button onclick="showBillingTab('commission')" class="billing-tab px-4 sm:px-6 py-3 border-b-2 font-medium text-xs sm:text-sm text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="commission">
                                ÊàêÁ¥ÑÊâãÊï∞Êñô
                            </button>
                            <button onclick="showBillingTab('payment')" class="billing-tab px-4 sm:px-6 py-3 border-b-2 font-medium text-xs sm:text-sm text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="payment">
                                ÊîØÊâïÂ±•Ê≠¥
                            </button>
                            <button onclick="showBillingTab('analysis')" class="billing-tab px-4 sm:px-6 py-3 border-b-2 font-medium text-xs sm:text-sm text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="analysis">
                                ÂèéÊîØÂàÜÊûê
                            </button>
                        </nav>
                    </div>

                    <!-- Á¥π‰ªãÊñôÂ±•Ê≠¥„Çø„Éñ -->
                    <div id="purchaseTab" class="billing-tab-content p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">Á¥π‰ªãÊñôÊîØÊâïÂ±•Ê≠¥</h3>
                            <div class="flex items-center space-x-4">
                                <div class="text-sm bg-blue-50 px-3 py-1 rounded">
                                    <span class="text-gray-600">„Éá„Éù„Ç∏„ÉÉ„ÉàÊÆãÈ´ò:</span>
                                    <span class="font-bold text-blue-600">¬•440,000</span>
                                    <span class="text-gray-500">(20‰ª∂ÂàÜ)</span>
                                </div>
                                <input type="month" value="2025-01" onchange="updateFinancialData(this.value)" class="border rounded px-3 py-1 text-sm">
                            </div>
                        </div>

                        <!-- ÊîØÊâï„ÅÑ„Çπ„Ç±„Ç∏„É•„Éº„É´ÊÉÖÂ†± -->
                        <div class="bg-blue-50 p-3 rounded-lg mb-4 text-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <span class="font-medium text-blue-800">ÊîØÊâïÊù°‰ª∂:</span>
                                    <span class="text-blue-700 ml-2">ÊúàÊú´Á∑†„ÇÅ</span>
                                </div>
                                <div class="text-right">
                                    <span class="text-blue-700">ÊåØËæº: ÁøåÊúà15Êó• / Âè£Â∫ßÂºïËêΩ: ÁøåÊúà27Êó•</span>
                                    <span class="text-gray-600 text-xs ml-2">(ÂúüÊó•Á•ù„ÅØÁøåÂñ∂Ê•≠Êó•)</span>
                                </div>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Á¥π‰ªãÊó•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ê°à‰ª∂ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">È°ßÂÆ¢Âêç</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Áâ©‰ª∂Á®ÆÂà•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Â∑•‰∫ãÂÜÖÂÆπ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Á¥π‰ªãÊñô</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊîØÊâï‰∫àÂÆöÊó•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊîØÊâïÁä∂Ê≥Å</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊàêÁ¥ÑÈ°ç/ROI</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">Ë©≥Á¥∞</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/15</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#C2025-001</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Áî∞‰∏≠Êßò</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Êà∏Âª∫„Å¶</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Â§ñÂ£ÅÂ°óË£Ö„ÉªÂ±ãÊ†πÂ°óË£Ö</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•22,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2/15(Âúü)‚Üí17(Êúà)</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Ë´ãÊ±ÇÂæÖ„Å°</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">‰∫§Ê∏â‰∏≠</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                                            <button onclick="showCaseDetail(1)" class="text-blue-600 hover:text-blue-900">Ë©≥Á¥∞</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50 bg-green-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/10</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#C2025-002</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">‰ΩêËó§Êßò</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">‰∏ÄÊà∏Âª∫„Å¶</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Â§ñÂ£ÅÂ°óË£Ö</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•22,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2/15(Âúü)‚Üí17(Êúà)</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÊîØÊâïÊ∏à</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            <div class="text-xs">¬•1.2M</div>
                                            <div class="text-green-600 font-bold text-xs">3636%</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                                            <button onclick="showCaseDetail(2)" class="text-blue-600 hover:text-blue-900">Ë©≥Á¥∞</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50 bg-green-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/08</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#C2025-003</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Èà¥Êú®Êßò</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Êà∏Âª∫„Å¶</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Â±ãÊ†πËë∫„ÅçÊõø„ÅàÔºàÁì¶Ôºâ</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•22,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2/27(Êú®)</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÊîØÊâïÊ∏à</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            <div class="text-xs">¬•800K</div>
                                            <div class="text-green-600 font-bold text-xs">3636%</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                                            <button onclick="showCaseDetail(3)" class="text-blue-600 hover:text-blue-900">Ë©≥Á¥∞</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- ÊàêÁ¥ÑÊâãÊï∞Êñô„Çø„Éñ -->
                    <div id="commissionTab" class="billing-tab-content p-6" style="display: none;">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">ÊàêÁ¥ÑÊâãÊï∞ÊñôÊîØÊâïÂ±•Ê≠¥</h3>
                            <div class="flex space-x-2">
                                <select class="border rounded px-3 py-1 text-sm">
                                    <option>ÂÖ®„Å¶</option>
                                    <option>ÊîØÊâïÊ∏à</option>
                                    <option>Êú™Êâï„ÅÑ</option>
                                </select>
                                <input type="month" value="2025-01" class="border rounded px-3 py-1 text-sm">
                            </div>
                        </div>

                        <!-- ÊîØÊâï„ÅÑ„Çπ„Ç±„Ç∏„É•„Éº„É´ÊÉÖÂ†± -->
                        <div class="bg-yellow-50 p-3 rounded-lg mb-4 text-sm">
                            <span class="font-medium text-yellow-800">ÊîØÊâïÊù°‰ª∂:</span>
                            <span class="text-yellow-700">Ë´ãÊ±ÇÊõ∏Áô∫Ë°å„Åã„Çâ3Âñ∂Ê•≠Êó•‰ª•ÂÜÖ</span>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊàêÁ¥ÑÊó•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ê°à‰ª∂ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">È°ßÂÆ¢Âêç</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊàêÁ¥ÑÈáëÈ°ç</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊâãÊï∞ÊñôÁéá</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊâãÊï∞ÊñôÈ°ç(Á®éËæº)</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊîØÊâïÊúüÊó•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊîØÊâïÁä∂Ê≥Å</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ë´ãÊ±ÇÊõ∏</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr class="hover:bg-gray-50 bg-green-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/10</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#C2025-002</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">‰ΩêËó§Êßò</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•1,200,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">10%</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•132,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/31</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÊîØÊâïÊ∏à</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button onclick="downloadInvoicePDF('INV-2025-0102')" class="text-blue-600 hover:text-blue-900">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50 bg-green-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/08</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#C2025-003</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Èà¥Êú®Êßò</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•800,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">10%</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•88,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/31</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÊîØÊâïÊ∏à</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button onclick="downloadInvoicePDF('INV-2025-0103')" class="text-blue-600 hover:text-blue-900">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/05</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#C2024-845</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">È´òÊ©ãÊßò</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•550,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">10%</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-red-600">¬•60,500</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/25</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Ë´ãÊ±ÇÂæÖ„Å°</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button onclick="viewInvoice('INV-2025-0104')" class="text-blue-600 hover:text-blue-900">Á¢∫Ë™ç</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2024/12/28</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#C2024-810</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Â±±Áî∞Êßò</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•950,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">10%</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•104,500</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/15</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÊîØÊâïÊ∏à</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button onclick="downloadInvoicePDF('INV-2024-1228')" class="text-blue-600 hover:text-blue-900">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- ÊîØÊâïÂ±•Ê≠¥„Çø„Éñ -->
                    <div id="paymentTab" class="billing-tab-content p-6" style="display: none;">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">ÊîØÊâïÂ±•Ê≠¥</h3>
                            <div class="flex space-x-2">
                                <select class="border rounded px-3 py-1 text-sm">
                                    <option>ÂÖ®„Å¶</option>
                                    <option>Á¥π‰ªãÊñô</option>
                                    <option>ÊàêÁ¥ÑÊâãÊï∞Êñô</option>
                                    <option>„Åù„ÅÆ‰ªñ</option>
                                </select>
                                <input type="month" value="2025-01" class="border rounded px-3 py-1 text-sm">
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊîØÊâïÊó•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ë´ãÊ±ÇÊõ∏Áï™Âè∑</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Á®ÆÂà•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÂÜÖÂÆπ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊîØÊâïÈ°ç(Á®éËæº)</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊîØÊâïÊñπÊ≥ï</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">È†òÂèéÊõ∏</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/15</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">INV-2025-0156</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Á¥π‰ªãÊñô</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Ê°à‰ª∂#C2025-001 Áî∞‰∏≠ÊßòÔºàÂ§ñÂ£ÅÂ°óË£ÖÔºâ</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•22,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ÈäÄË°åÊåØËæº</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÆå‰∫Ü</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button onclick="downloadReceipt('RCP-2025-0156')" class="text-blue-600 hover:text-blue-900">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/10</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">INV-2025-0145</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Á¥π‰ªãÊñô</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Ê°à‰ª∂#C2025-002 ‰ΩêËó§ÊßòÔºàÂ§ñÂ£ÅÂ°óË£ÖÔºâ</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•22,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ÈäÄË°åÊåØËæº</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÆå‰∫Ü</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button onclick="downloadReceipt('RCP-2025-0145')" class="text-blue-600 hover:text-blue-900">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/10</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">INV-2025-0102</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ÊàêÁ¥ÑÊâãÊï∞Êñô</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">‰ΩêËó§ÊßòÊ°à‰ª∂ ÊàêÁ¥ÑÊâãÊï∞Êñô</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•132,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ÈäÄË°åÊåØËæº</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÆå‰∫Ü</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button onclick="downloadReceipt('RCP-2025-0102')" class="text-blue-600 hover:text-blue-900">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/08</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">INV-2025-0103</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ÊàêÁ¥ÑÊâãÊï∞Êñô</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Èà¥Êú®ÊßòÊ°à‰ª∂ ÊàêÁ¥ÑÊâãÊï∞Êñô</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•88,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ÈäÄË°åÊåØËæº</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÆå‰∫Ü</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button onclick="downloadReceipt('RCP-2025-0103')" class="text-blue-600 hover:text-blue-900">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/05</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">INV-2025-0133</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Á¥π‰ªãÊñô</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Ê°à‰ª∂#C2024-098 ÊùëÁî∞ÊßòÔºà„É¢„É´„Çø„É´Â§ñÂ£ÅÔºâ</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•22,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ÈäÄË°åÊåØËæº</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÆå‰∫Ü</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button onclick="downloadReceipt('RCP-2025-0133')" class="text-blue-600 hover:text-blue-900">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- ÂèéÊîØÂàÜÊûê„Çø„Éñ -->
                    <div id="analysisTab" class="billing-tab-content p-6" style="display: none;">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold">ÂèéÊîØÂàÜÊûê</h3>
                            <select class="border rounded px-3 py-1 text-sm">
                                <option>2025Âπ¥1Êúà</option>
                                <option>2024Âπ¥12Êúà</option>
                                <option>2024Âπ¥11Êúà</option>
                            </select>
                        </div>

                        <!-- ÊúàÈñì„Çµ„Éû„É™„Éº -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div class="bg-white border rounded-lg p-4">
                                <div class="text-sm text-gray-500 mb-1">Â£≤‰∏äÈ´ò</div>
                                <div class="text-2xl font-bold text-gray-900">¬•3,550,000</div>
                                <div class="text-xs text-green-600 mt-1">+12% ÂâçÊúàÊØî</div>
                            </div>
                            <div class="bg-white border rounded-lg p-4">
                                <div class="text-sm text-gray-500 mb-1">ÊîØÂá∫ÂêàË®à</div>
                                <div class="text-2xl font-bold text-gray-900">¬•625,000</div>
                                <div class="text-xs text-red-600 mt-1">+8% ÂâçÊúàÊØî</div>
                            </div>
                            <div class="bg-white border rounded-lg p-4">
                                <div class="text-sm text-gray-500 mb-1">Á≤óÂà©Áõä</div>
                                <div class="text-2xl font-bold text-green-600">¬•2,925,000</div>
                                <div class="text-xs text-green-600 mt-1">+14% ÂâçÊúàÊØî</div>
                            </div>
                            <div class="bg-white border rounded-lg p-4">
                                <div class="text-sm text-gray-500 mb-1">ROI</div>
                                <div class="text-2xl font-bold text-blue-600">468%</div>
                                <div class="text-xs text-green-600 mt-1">ÂÑ™ËâØ</div>
                            </div>
                        </div>

                        <!-- ÂèéÊîØÂÜÖË®≥ -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <!-- ÂèéÂÖ•ÂÜÖË®≥ -->
                            <div class="bg-white border rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-3">ÂèéÂÖ•ÂÜÖË®≥</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center">
                                            <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                            <span class="text-sm text-gray-700">Â∑•‰∫ãÂ£≤‰∏ä</span>
                                        </div>
                                        <span class="text-sm font-semibold">¬•3,350,000</span>
                                    </div>
                                    <div class="pt-3 mt-3 border-t flex justify-between">
                                        <span class="text-sm font-semibold text-gray-700">ÂêàË®à</span>
                                        <span class="text-sm font-bold text-green-600">¬•3,350,000</span>
                                    </div>
                                </div>
                            </div>

                            <!-- ÊîØÂá∫ÂÜÖË®≥ -->
                            <div class="bg-white border rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-3">ÊîØÂá∫ÂÜÖË®≥</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center">
                                            <div class="w-2 h-2 bg-red-500 rounded-full mr-2"></div>
                                            <span class="text-sm text-gray-700">Á¥π‰ªãÊñô</span>
                                        </div>
                                        <span class="text-sm font-semibold">¬•176,000</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center">
                                            <div class="w-2 h-2 bg-orange-500 rounded-full mr-2"></div>
                                            <span class="text-sm text-gray-700">ÊàêÁ¥ÑÊâãÊï∞Êñô</span>
                                        </div>
                                        <span class="text-sm font-semibold">¬•325,000</span>
                                    </div>
                                    <div class="pt-3 mt-3 border-t flex justify-between">
                                        <span class="text-sm font-semibold text-gray-700">ÂêàË®à</span>
                                        <span class="text-sm font-bold text-red-600">¬•501,000</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Ê°à‰ª∂Âà•ÂèéÊîØ -->
                        <div class="bg-white border rounded-lg p-4">
                            <h4 class="font-semibold text-gray-900 mb-3">Ê°à‰ª∂Âà•ÂèéÊîØTOP5</h4>
                            <div class="overflow-x-auto">
                                <table class="min-w-full">
                                    <thead class="border-b">
                                        <tr>
                                            <th class="text-left text-xs font-medium text-gray-500 uppercase pb-2">Ê°à‰ª∂</th>
                                            <th class="text-right text-xs font-medium text-gray-500 uppercase pb-2">Á¥π‰ªãÊñô</th>
                                            <th class="text-right text-xs font-medium text-gray-500 uppercase pb-2">Â£≤‰∏ä</th>
                                            <th class="text-right text-xs font-medium text-gray-500 uppercase pb-2">ÊâãÊï∞Êñô</th>
                                            <th class="text-right text-xs font-medium text-gray-500 uppercase pb-2">Âà©Áõä</th>
                                            <th class="text-right text-xs font-medium text-gray-500 uppercase pb-2">ROI</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        <tr>
                                            <td class="py-2 text-sm text-gray-900">‰ΩêËó§ÊßòÊ°à‰ª∂</td>
                                            <td class="py-2 text-sm text-right">¬•22,000</td>
                                            <td class="py-2 text-sm text-right">¬•1,200,000</td>
                                            <td class="py-2 text-sm text-right">¬•132,000</td>
                                            <td class="py-2 text-sm text-right font-semibold text-green-600">¬•1,046,000</td>
                                            <td class="py-2 text-sm text-right font-bold text-blue-600">4755%</td>
                                        </tr>
                                        <tr>
                                            <td class="py-2 text-sm text-gray-900">Èà¥Êú®ÊßòÊ°à‰ª∂</td>
                                            <td class="py-2 text-sm text-right">¬•22,000</td>
                                            <td class="py-2 text-sm text-right">¬•800,000</td>
                                            <td class="py-2 text-sm text-right">¬•88,000</td>
                                            <td class="py-2 text-sm text-right font-semibold text-green-600">¬•690,000</td>
                                            <td class="py-2 text-sm text-right font-bold text-blue-600">800%</td>
                                        </tr>
                                        <tr>
                                            <td class="py-2 text-sm text-gray-900">Â±±Áî∞ÊßòÊ°à‰ª∂</td>
                                            <td class="py-2 text-sm text-right">¬•85,000</td>
                                            <td class="py-2 text-sm text-right">¬•950,000</td>
                                            <td class="py-2 text-sm text-right">¬•95,000</td>
                                            <td class="py-2 text-sm text-right font-semibold text-green-600">¬•770,000</td>
                                            <td class="py-2 text-sm text-right font-bold text-blue-600">906%</td>
                                        </tr>
                                        <tr>
                                            <td class="py-2 text-sm text-gray-900">È´òÊ©ãÊßòÊ°à‰ª∂</td>
                                            <td class="py-2 text-sm text-right">¬•75,000</td>
                                            <td class="py-2 text-sm text-right">¬•600,000</td>
                                            <td class="py-2 text-sm text-right">¬•60,000</td>
                                            <td class="py-2 text-sm text-right font-semibold text-green-600">¬•465,000</td>
                                            <td class="py-2 text-sm text-right font-bold text-blue-600">620%</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                </div>
            </div><!-- billingSection„ÅÆÁµÇ‰∫Ü -->

            <!-- „Éá„Éù„Ç∏„ÉÉ„Éà„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="depositSection" class="section" style="display: none;">
                <div class="mb-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">„Éá„Éù„Ç∏„ÉÉ„ÉàÁÆ°ÁêÜ</h2>
                    <div class="flex space-x-2">
                        <button onclick="showDepositModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">
                            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            „Éá„Éù„Ç∏„ÉÉ„ÉàËøΩÂä†
                        </button>
                    </div>
                </div>

                <!-- „Éá„Éù„Ç∏„ÉÉ„ÉàÁä∂Ê≥Å„Çµ„Éû„É™„Éº -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white border-2 border-blue-200 rounded-lg shadow p-4">
                        <div class="text-sm text-gray-600 mb-1">„Éá„Éù„Ç∏„ÉÉ„ÉàÊÆãÈ´ò</div>
                        <div class="text-3xl font-bold text-blue-600">20/25‰ª∂</div>
                        <div class="text-sm text-gray-500 mt-1">¬•440,000 ÊÆãÈ´ò</div>
                    </div>
                    <div class="bg-white border rounded-lg shadow p-4">
                        <div class="text-sm text-gray-600 mb-1">ÊúâÂäπÊúüÈôê</div>
                        <div class="text-2xl font-bold text-gray-900">2025/03/31</div>
                        <div class="text-sm text-orange-600 mt-1">ÊÆã„Çä45Êó•</div>
                    </div>
                    <div class="bg-white border rounded-lg shadow p-4">
                        <div class="text-sm text-gray-600 mb-1">ÁèæÂú®„ÅÆË®≠ÂÆö</div>
                        <div class="text-2xl font-bold text-green-600">Áπ∞Ë∂ä</div>
                        <div class="text-sm text-gray-500 mt-1">ÊúÄÁµÇÊõ¥Êñ∞: 2025/01/17</div>
                    </div>
                    <div class="bg-white border rounded-lg shadow p-4">
                        <div class="text-sm text-gray-600 mb-1">Ë°®Á§∫„É©„É≥„ÇØ</div>
                        <div class="text-2xl font-bold text-purple-600">ÂÑ™ÂÖà+1</div>
                        <div class="text-sm text-gray-500 mt-1">„Éá„Éù„Ç∏„ÉÉ„ÉàÁâπÂÖ∏ÈÅ©Áî®‰∏≠</div>
                    </div>
                </div>

                <!-- „É©„É≥„Ç≠„É≥„Ç∞ÁâπÂÖ∏Ë™¨Êòé -->
                <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg shadow mb-6 p-6">
                    <div class="flex items-start">
                        <svg class="w-8 h-8 text-purple-600 mr-3 mt-1" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                        </svg>
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">„Éá„Éù„Ç∏„ÉÉ„ÉàË≥ºÂÖ•ÁâπÂÖ∏</h3>
                            <p class="text-sm text-gray-700 mb-3">
                                „Éá„Éù„Ç∏„ÉÉ„Éà„ÇíË≥ºÂÖ•„Åô„Çã„Å®„ÄÅ„É¶„Éº„Ç∂„Éº„Å∏Ë°®Á§∫„Åï„Çå„Çã„É©„É≥„Ç≠„É≥„Ç∞„Åå<span class="font-bold text-purple-600">ÂÖ®„Å¶UP</span>„Åï„Çå„ÄÅ
                                „Çà„ÇäËâØ„ÅÑÊù°‰ª∂„ÅßÊ°à‰ª∂„Åå‰æõÁµ¶„Åï„Çå„ÇÑ„Åô„Åè„Å™„Çä„Åæ„Åô„ÄÇ
                            </p>
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-3">
                                <div class="flex items-start">
                                    <svg class="w-5 h-5 text-yellow-600 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                    </svg>
                                    <div class="text-sm text-yellow-800">
                                        <p class="font-medium">„Éá„Éù„Ç∏„ÉÉ„ÉàÈÅ©Áî®ÂØæË±°</p>
                                        <p class="text-xs mt-1">„Éá„Éù„Ç∏„ÉÉ„Éà„ÅØÂü∫Êú¨Á¥π‰ªãÊñô¬•22,000„ÅÆÊ°à‰ª∂„ÅÆ„Åø„Å´ÈÅ©Áî®„Åï„Çå„Åæ„Åô„ÄÇ„Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥Ôºà¬•33,000Ôºâ„ÇÑÈÉ®ÂàÜÊñΩÂ∑•Ôºà¬•11,000‰ª•‰∏ãÔºâ„Å´„ÅØÈÅ©Áî®„Åï„Çå„Åæ„Åõ„Çì„ÄÇ</p>
                                    </div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <div class="bg-white rounded-lg p-3 border border-purple-200">
                                    <div class="flex items-center mb-1">
                                        <svg class="w-4 h-4 text-purple-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                        </svg>
                                        <span class="text-xs font-medium text-gray-700">ÂÑ™ÂÖàË°®Á§∫</span>
                                    </div>
                                    <p class="text-xs text-gray-600">Ê§úÁ¥¢ÁµêÊûú„ÅÆ‰∏ä‰Ωç„Å´Ë°®Á§∫</p>
                                </div>
                                <div class="bg-white rounded-lg p-3 border border-purple-200">
                                    <div class="flex items-center mb-1">
                                        <svg class="w-4 h-4 text-purple-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                        </svg>
                                        <span class="text-xs font-medium text-gray-700">‰ø°È†ºÂ∫¶UP</span>
                                    </div>
                                    <p class="text-xs text-gray-600">ÂâçÊâï„ÅÑ„Åß‰ø°È†ºÊÑüÂêë‰∏ä</p>
                                </div>
                                <div class="bg-white rounded-lg p-3 border border-purple-200">
                                    <div class="flex items-center mb-1">
                                        <svg class="w-4 h-4 text-purple-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                        </svg>
                                        <span class="text-xs font-medium text-gray-700">Ê°à‰ª∂Áç≤ÂæóÁéáUP</span>
                                    </div>
                                    <p class="text-xs text-gray-600">Á´∂Âêà‰ªñÁ§æ„Çà„ÇäÂÑ™‰Ωç</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Áπ∞Ë∂ä/ËøîÈáëË®≠ÂÆö -->
                <div class="bg-white rounded-lg shadow mb-6 p-6">
                    <h3 class="text-lg font-semibold mb-4">Áπ∞Ë∂ä„ÉªËøîÈáëË®≠ÂÆö</h3>
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                        <div class="flex items-start">
                            <svg class="w-5 h-5 text-yellow-600 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                            </svg>
                            <div class="text-sm text-yellow-800">
                                <p class="font-medium mb-1">ÈáçË¶Å„Å™„ÅäÁü•„Çâ„Åõ</p>
                                <ul class="list-disc list-inside space-y-1 text-xs">
                                    <li>„Éá„Éù„Ç∏„ÉÉ„Éà„ÅÆÊúâÂäπÊúüÈôê„ÅØÂÖ•Èáë„ÅÆÁøå„ÄÖÊúàÊú´„Åæ„Åß„Åß„Åô</li>
                                    <li>ËøîÈáëÊôÇ„ÅÆÊåØËæºÊâãÊï∞Êñô„ÅØ„ÅäÂÆ¢ÊßòË≤†ÊãÖ„Å®„Å™„Çä„Åæ„Åô</li>
                                    <li>Áπ∞Ë∂ä„ÇíÈÅ∏Êäû„Åô„Çã„Å®ÁÑ°ÊúüÈôê„Å´Á∂ôÁ∂öÂà©Áî®ÂèØËÉΩ„Åß„Åô</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-700 mb-2">ÊúüÈôêÂàá„ÇåÊôÇ„ÅÆÂá¶ÁêÜÊñπÊ≥ï</p>
                            <div class="flex space-x-4">
                                <label class="flex items-center">
                                    <input type="radio" name="depositHandling" value="rollover" checked="" class="mr-2">
                                    <span class="text-sm">Áπ∞Ë∂äÔºàÊé®Â•®Ôºâ</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="depositHandling" value="refund" class="mr-2">
                                    <span class="text-sm">ËøîÈáë</span>
                                </label>
                            </div>
                        </div>
                        <button onclick="updateDepositSetting()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                            Ë®≠ÂÆö„Çí‰øùÂ≠ò
                        </button>
                    </div>
                </div>

                <!-- „Éá„Éù„Ç∏„ÉÉ„ÉàÂèñÂºïÂ±•Ê≠¥ -->
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">„Éá„Éù„Ç∏„ÉÉ„ÉàÂèñÂºïÂ±•Ê≠¥</h3>
                        <div class="flex space-x-2">
                            <select id="depositTypeFilter" onchange="filterDepositHistory()" class="border rounded px-3 py-1 text-sm">
                                <option value="all">ÂÖ®„Å¶</option>
                                <option value="Áî≥Ë´ã">Áî≥Ë´ã‰∏≠</option>
                                <option value="ÂèçÊò†">ÂèçÊò†</option>
                                <option value="Âà©Áî®">Âà©Áî®</option>
                                <option value="ËøîÈáë">ËøîÈáë</option>
                            </select>
                            <input type="month" id="depositMonthFilter" value="2025-01" onchange="filterDepositHistory()" class="border rounded px-3 py-1 text-sm">
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Êó•‰ªò</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Á®ÆÂà•</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Áä∂ÊÖã</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‰ª∂Êï∞</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÈáëÈ°ç</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ë™¨Êòé</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊÆã‰ª∂Êï∞</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊúâÂäπÊúüÈôê</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="depositHistoryBody" class="bg-white divide-y divide-gray-200">
                                <tr class="hover:bg-gray-50 deposit-row" data-type="Áî≥Ë´ã" data-date="2025-01">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/17</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">Áî≥Ë´ã</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">ÂÖ•ÈáëÂæÖ„Å°</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">10</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">¬•220,000</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">INV-20250117 (ÊîØÊâïÊúüÈôê:1/24)</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">-</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">-</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button onclick="downloadInvoice('INV-20250117')" class="text-blue-600 hover:text-blue-800">Ë´ãÊ±ÇÊõ∏DL</button>
                                    </td>
                                </tr>
                                <tr class="hover:bg-gray-50 bg-gray-50 deposit-row" data-type="Âà©Áî®" data-date="2025-01">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/15</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Âà©Áî®</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÆå‰∫Ü</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">-1</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-red-600">-¬•22,000</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600">
                                        <a href="#" onclick="showCaseDetail('C2025-001'); return false;" class="hover:underline">#C2025-001 Áî∞‰∏≠Êßò</a>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">20</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/03/31</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">-</td>
                                </tr>
                                <tr class="hover:bg-gray-50 deposit-row" data-type="Âà©Áî®" data-date="2025-01">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/10</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Âà©Áî®</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÆå‰∫Ü</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">-1</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-red-600">-¬•22,000</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600">
                                        <a href="#" onclick="showCaseDetail('C2025-002'); return false;" class="hover:underline">#C2025-002 ‰ΩêËó§Êßò</a>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">21</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/03/31</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">-</td>
                                </tr>
                                <tr class="hover:bg-gray-50 bg-gray-50 deposit-row" data-type="ÂèçÊò†" data-date="2025-01">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/05</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂèçÊò†</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÆå‰∫Ü</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">+25</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600">+¬•550,000</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">INV-20250101 ÂÖ•ÈáëÁ¢∫Ë™ç</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">25</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/03/31</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button onclick="downloadInvoice('INV-20250101')" class="text-blue-600 hover:text-blue-800">Ë´ãÊ±ÇÊõ∏DL</button>
                                    </td>
                                </tr>
                                <tr class="hover:bg-gray-50 deposit-row" data-type="Áî≥Ë´ã" data-date="2025-01">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/01</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">Áî≥Ë´ã</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÖ•ÈáëÊ∏à</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">25</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">¬•550,000</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">INV-20250101 (ÂÖ•Èáë:1/5)</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">-</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">-</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button onclick="downloadInvoice('INV-20250101')" class="text-blue-600 hover:text-blue-800">Ë´ãÊ±ÇÊõ∏DL</button>
                                    </td>
                                </tr>
                                <tr class="hover:bg-gray-50 bg-gray-50 deposit-row" data-type="ËøîÈáë" data-date="2024-12">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2024/12/15</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">ËøîÈáë</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÆå‰∫Ü</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">-3</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600">¬•65,450</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ÊúüÈôêÂàá„ÇåËøîÈáë(ÊâãÊï∞Êñô¬•550Â∑ÆÂºï)</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">0</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2024/11/30</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div><!-- depositSection„ÅÆÁµÇ‰∫Ü -->

            <!-- „É¨„Éù„Éº„Éà„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="reportsSection" class="section" style="display: none;">
                <div class="mb-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">„É¨„Éù„Éº„Éà</h2>
                    <div class="flex space-x-2">
                        <select id="reportPeriod" onchange="updateReports()" class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            <option value="month">‰ªäÊúà</option>
                            <option value="quarter">‰ªäÂõõÂçäÊúü</option>
                            <option value="year">‰ªäÂπ¥Â∫¶</option>
                            <option value="custom">ÊúüÈñìÊåáÂÆö</option>
                        </select>
                        <button onclick="exportReport()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">
                            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            „É¨„Éù„Éº„ÉàÂá∫Âäõ
                        </button>
                    </div>
                </div>

                <!-- KPI„Çµ„Éû„É™„Éº -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Á∑èÂ£≤‰∏ä</p>
                                <p class="text-2xl font-bold text-gray-900">¬•8,450,000</p>
                                <p class="text-xs text-green-600 flex items-center mt-1">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    12% ÂâçÊúàÊØî
                                </p>
                            </div>
                            <div class="p-3 bg-blue-100 rounded-full">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">ÊàêÁ¥ÑÁéá</p>
                                <p class="text-2xl font-bold text-gray-900">68.5%</p>
                                <p class="text-xs text-green-600 flex items-center mt-1">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    5.2% ÊîπÂñÑ
                                </p>
                            </div>
                            <div class="p-3 bg-green-100 rounded-full">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Âπ≥ÂùáÂçò‰æ°</p>
                                <p class="text-2xl font-bold text-gray-900">¬•952,000</p>
                                <p class="text-xs text-red-600 flex items-center mt-1">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M14.707 12.293a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l2.293-2.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    3% ÂâçÊúàÊØî
                                </p>
                            </div>
                            <div class="p-3 bg-yellow-100 rounded-full">
                                <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Êñ∞Ë¶èÊ°à‰ª∂</p>
                                <p class="text-2xl font-bold text-gray-900">42‰ª∂</p>
                                <p class="text-xs text-green-600 flex items-center mt-1">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    8‰ª∂ Â¢óÂä†
                                </p>
                            </div>
                            <div class="p-3 bg-purple-100 rounded-full">
                                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- „Ç∞„É©„Éï„Ç®„É™„Ç¢ -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Â£≤‰∏äÊé®Áßª„Ç∞„É©„Éï -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Â£≤‰∏äÊé®Áßª</h3>
                            <select class="text-sm border rounded px-2 py-1">
                                <option>ÊúàÂà•</option>
                                <option>ÈÄ±Âà•</option>
                                <option>Êó•Âà•</option>
                            </select>
                        </div>
                        <div style="height: 200px;">
                            <canvas id="salesChart"></canvas>
                        </div>
                    </div>

                    <!-- ÊàêÁ¥ÑÁéáÊé®Áßª„Ç∞„É©„Éï -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">ÊàêÁ¥ÑÁéáÊé®Áßª</h3>
                            <select class="text-sm border rounded px-2 py-1">
                                <option>ÊúàÂà•</option>
                                <option>ÈÄ±Âà•</option>
                            </select>
                        </div>
                        <div style="height: 200px;">
                            <canvas id="conversionChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Ë©≥Á¥∞„ÉÜ„Éº„Éñ„É´ -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Âñ∂Ê•≠Âà•ÊàêÁ∏æ -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="px-6 py-4 border-b">
                            <h3 class="text-lg font-semibold text-gray-900">Âñ∂Ê•≠Âà•ÊàêÁ∏æ</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Âñ∂Ê•≠Âêç</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊàêÁ¥ÑÊï∞</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊàêÁ¥ÑÁéá</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Â£≤‰∏ä</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Áî∞‰∏≠Â§™ÈÉé</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">12</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <span class="text-sm text-gray-900">75%</span>
                                                <div class="ml-2 w-16 bg-gray-200 rounded-full h-2">
                                                    <div class="bg-green-500 h-2 rounded-full" style="width: 75%"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•3,200,000</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">‰ΩêËó§Ëä±Â≠ê</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">8</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <span class="text-sm text-gray-900">62%</span>
                                                <div class="ml-2 w-16 bg-gray-200 rounded-full h-2">
                                                    <div class="bg-yellow-500 h-2 rounded-full" style="width: 62%"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•2,100,000</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Èà¥Êú®Ê¨°ÈÉé</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">5</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <span class="text-sm text-gray-900">45%</span>
                                                <div class="ml-2 w-16 bg-gray-200 rounded-full h-2">
                                                    <div class="bg-red-500 h-2 rounded-full" style="width: 45%"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•1,450,000</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- „Ç®„É™„Ç¢Âà•ÊàêÁ∏æ -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="px-6 py-4 border-b">
                            <h3 class="text-lg font-semibold text-gray-900">„Ç®„É™„Ç¢Âà•ÊàêÁ∏æ</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">„Ç®„É™„Ç¢</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ê°à‰ª∂Êï∞</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊàêÁ¥ÑÁéá</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Â£≤‰∏ä</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Êù±‰∫¨ÈÉΩ</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">18</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">72%</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•4,200,000</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Á•ûÂ•àÂ∑ùÁúå</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">12</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">65%</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•2,800,000</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">ÂüºÁéâÁúå</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">8</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">58%</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•1,450,000</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- „É™„Éº„Éâ„Çø„Ç§„É†ÂàÜÊûê„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div class="mt-8">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-gray-900">„É™„Éº„Éâ„Çø„Ç§„É†ÂàÜÊûê</h3>
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-gray-500">Âπ≥ÂùáÂÄ§Ë°®Á§∫</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="showMedian" class="sr-only peer" onchange="updateLeadTimeDisplay()">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                                <span class="text-sm text-gray-500">‰∏≠Â§ÆÂÄ§Ë°®Á§∫</span>
                            </div>
                        </div>

                        <!-- KPI„Ç´„Éº„Éâ -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-blue-600 font-medium">ÂïèÂêà„Åõ ‚Üí ÁèæÂú∞Ë™øÊüª</p>
                                        <p class="text-2xl font-bold text-blue-900" id="leadTime1">3.2Êó•</p>
                                        <p class="text-xs text-blue-600 flex items-center mt-1">
                                            <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                            </svg>
                                            0.5Êó• Áü≠Á∏Æ
                                        </p>
                                    </div>
                                    <div class="p-3 bg-blue-200 rounded-full">
                                        <svg class="w-6 h-6 text-blue-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-green-50 to-green-100 p-4 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-green-600 font-medium">ÁèæÂú∞Ë™øÊüª ‚Üí Ë¶ãÁ©çÊèêÂá∫</p>
                                        <p class="text-2xl font-bold text-green-900" id="leadTime2">2.8Êó•</p>
                                        <p class="text-xs text-green-600 flex items-center mt-1">
                                            <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                            </svg>
                                            0.2Êó• Áü≠Á∏Æ
                                        </p>
                                    </div>
                                    <div class="p-3 bg-green-200 rounded-full">
                                        <svg class="w-6 h-6 text-green-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-purple-50 to-purple-100 p-4 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-purple-600 font-medium">Ë¶ãÁ©çÊèêÂá∫ ‚Üí ÊàêÁ¥Ñ</p>
                                        <p class="text-2xl font-bold text-purple-900" id="leadTime3">5.5Êó•</p>
                                        <p class="text-xs text-red-600 flex items-center mt-1">
                                            <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M14.707 12.293a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l2.293-2.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                            </svg>
                                            1.2Êó• Âª∂Èï∑
                                        </p>
                                    </div>
                                    <div class="p-3 bg-purple-200 rounded-full">
                                        <svg class="w-6 h-6 text-purple-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- „É™„Éº„Éâ„Çø„Ç§„É†„ÉÅ„É£„Éº„Éà -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <!-- ÊúàÂà•Êé®Áßª„Ç∞„É©„Éï -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-sm font-semibold text-gray-700 mb-3">ÊúàÂà•„É™„Éº„Éâ„Çø„Ç§„É†Êé®Áßª</h4>
                                <div style="height: 250px;">
                                    <canvas id="leadTimeChart"></canvas>
                                </div>
                            </div>

                            <!-- „Éï„Ç°„Éç„É´ÂàÜÊûê -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-sm font-semibold text-gray-700 mb-3">Âñ∂Ê•≠„Éï„Ç°„Éç„É´ÂàÜÊûê</h4>
                                <div class="space-y-3">
                                    <div class="relative">
                                        <div class="flex items-center justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700">ÂïèÂêà„Åõ</span>
                                            <span class="text-sm text-gray-500">142‰ª∂</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-8">
                                            <div class="bg-blue-500 h-8 rounded-full flex items-center justify-center text-white text-xs" style="width: 100%">
                                                100%
                                            </div>
                                        </div>
                                    </div>

                                    <div class="relative">
                                        <div class="flex items-center justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700">ÁèæÂú∞Ë™øÊüª</span>
                                            <span class="text-sm text-gray-500">98‰ª∂</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-8">
                                            <div class="bg-green-500 h-8 rounded-full flex items-center justify-center text-white text-xs" style="width: 69%">
                                                69% (Âπ≥Âùá3.2Êó•)
                                            </div>
                                        </div>
                                    </div>

                                    <div class="relative">
                                        <div class="flex items-center justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700">Ë¶ãÁ©çÊèêÂá∫</span>
                                            <span class="text-sm text-gray-500">85‰ª∂</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-8">
                                            <div class="bg-yellow-500 h-8 rounded-full flex items-center justify-center text-white text-xs" style="width: 60%">
                                                60% (Âπ≥Âùá2.8Êó•)
                                            </div>
                                        </div>
                                    </div>

                                    <div class="relative">
                                        <div class="flex items-center justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700">ÊàêÁ¥Ñ</span>
                                            <span class="text-sm text-gray-500">42‰ª∂</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-8">
                                            <div class="bg-purple-500 h-8 rounded-full flex items-center justify-center text-white text-xs" style="width: 30%">
                                                30% (Âπ≥Âùá5.5Êó•)
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-4 pt-4 border-t border-gray-200">
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">„Éà„Éº„Çø„É´Âπ≥ÂùáÊó•Êï∞:</span>
                                        <span class="font-bold text-gray-900">11.5Êó•</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Âñ∂Ê•≠Âà•„É™„Éº„Éâ„Çø„Ç§„É†ÊØîËºÉ -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="text-sm font-semibold text-gray-700 mb-4">Âñ∂Ê•≠Âà•„É™„Éº„Éâ„Çø„Ç§„É†ÊØîËºÉ</h4>
                            <div class="overflow-x-auto">
                                <table class="min-w-full">
                                    <thead>
                                        <tr class="text-xs text-gray-500 uppercase">
                                            <th class="text-left py-2">Âñ∂Ê•≠ÊãÖÂΩì</th>
                                            <th class="text-center py-2">ÂïèÂêà„Åõ‚ÜíË™øÊüª</th>
                                            <th class="text-center py-2">Ë™øÊüª‚ÜíË¶ãÁ©ç</th>
                                            <th class="text-center py-2">Ë¶ãÁ©ç‚ÜíÊàêÁ¥Ñ</th>
                                            <th class="text-center py-2">ÂêàË®àÊó•Êï∞</th>
                                            <th class="text-center py-2">ÊàêÁ¥ÑÁéá</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-sm">
                                        <tr class="border-t border-gray-200">
                                            <td class="py-3 font-medium text-gray-900">Áî∞‰∏≠Â§™ÈÉé</td>
                                            <td class="text-center text-green-600 font-medium">2.5Êó•</td>
                                            <td class="text-center text-green-600 font-medium">2.0Êó•</td>
                                            <td class="text-center text-green-600 font-medium">4.5Êó•</td>
                                            <td class="text-center font-bold text-gray-900">9.0Êó•</td>
                                            <td class="text-center">
                                                <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">75%</span>
                                            </td>
                                        </tr>
                                        <tr class="border-t border-gray-200">
                                            <td class="py-3 font-medium text-gray-900">‰ΩêËó§Ëä±Â≠ê</td>
                                            <td class="text-center text-yellow-600 font-medium">3.0Êó•</td>
                                            <td class="text-center text-yellow-600 font-medium">3.2Êó•</td>
                                            <td class="text-center text-yellow-600 font-medium">5.8Êó•</td>
                                            <td class="text-center font-bold text-gray-900">12.0Êó•</td>
                                            <td class="text-center">
                                                <span class="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">62%</span>
                                            </td>
                                        </tr>
                                        <tr class="border-t border-gray-200">
                                            <td class="py-3 font-medium text-gray-900">Èà¥Êú®Ê¨°ÈÉé</td>
                                            <td class="text-center text-red-600 font-medium">4.5Êó•</td>
                                            <td class="text-center text-red-600 font-medium">3.8Êó•</td>
                                            <td class="text-center text-red-600 font-medium">7.2Êó•</td>
                                            <td class="text-center font-bold text-gray-900">15.5Êó•</td>
                                            <td class="text-center">
                                                <span class="px-2 py-1 text-xs rounded-full bg-red-100 text-red-800">45%</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                                <p class="text-xs text-blue-800">
                                    <strong>üí° ÊîπÂñÑ„Éù„Ç§„É≥„Éà:</strong> Ë¶ãÁ©çÊèêÂá∫„Åã„ÇâÊàêÁ¥Ñ„Åæ„Åß„ÅÆÊúüÈñì„ÅåÈï∑„ÅÑÂÇæÂêë„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó„ÅÆÈ†ªÂ∫¶„Çí‰∏ä„Åí„Çã„Åì„Å®„ÅßÊàêÁ¥ÑÁéáÂêë‰∏ä„ÅåÊúüÂæÖ„Åß„Åç„Åæ„Åô„ÄÇ
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- reportsSection„ÅÆÁµÇ‰∫Ü -->

            <!-- „Ç´„É¨„É≥„ÉÄ„Éº„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="calendarSection" class="section" style="display: none;">
                <div class="mb-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">„Ç´„É¨„É≥„ÉÄ„Éº</h2>
                    <div class="flex items-center space-x-2">
                        <button onclick="changeCalendarView('month')" class="calendar-view-btn px-3 py-1 text-sm font-medium text-blue-600 bg-blue-50 rounded">Êúà</button>
                        <button onclick="changeCalendarView('week')" class="calendar-view-btn px-3 py-1 text-sm font-medium text-gray-600 hover:bg-gray-50 rounded">ÈÄ±</button>
                        <button onclick="changeCalendarView('day')" class="calendar-view-btn px-3 py-1 text-sm font-medium text-gray-600 hover:bg-gray-50 rounded">Êó•</button>
                        <button onclick="addNewEvent()" class="ml-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">
                            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            ‰∫àÂÆö„ÇíËøΩÂä†
                        </button>
                    </div>
                </div>
                
                <!-- „Ç´„É¨„É≥„ÉÄ„Éº„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
                <div class="bg-white rounded-lg shadow mb-4">
                    <div class="p-4 flex justify-between items-center border-b">
                        <button onclick="previousMonth()" class="p-2 hover:bg-gray-100 rounded">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                        </button>
                        <h3 id="currentMonth" class="text-lg font-semibold text-gray-900">2025Âπ¥10Êúà</h3>
                        <button onclick="nextMonth()" class="p-2 hover:bg-gray-100 rounded">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <!-- ÊúàË°®Á§∫„Ç´„É¨„É≥„ÉÄ„Éº -->
                    <div id="calendarMonthView" class="p-4">
                        <div class="grid grid-cols-7 mb-2">
                            <div class="text-center text-sm font-medium text-gray-700 py-2 border-b">Êó•</div>
                            <div class="text-center text-sm font-medium text-gray-700 py-2 border-b">Êúà</div>
                            <div class="text-center text-sm font-medium text-gray-700 py-2 border-b">ÁÅ´</div>
                            <div class="text-center text-sm font-medium text-gray-700 py-2 border-b">Ê∞¥</div>
                            <div class="text-center text-sm font-medium text-gray-700 py-2 border-b">Êú®</div>
                            <div class="text-center text-sm font-medium text-gray-700 py-2 border-b">Èáë</div>
                            <div class="text-center text-sm font-medium text-gray-700 py-2 border-b">Âúü</div>
                        </div>
                        <div id="calendarGrid" style="display: grid; grid-template-columns: repeat(7, 1fr);">
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; color: #9ca3af; background: #f9fafb;" data-date="28">
                                <div style="font-weight: 500; font-size: 14px;">28</div>
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; color: #9ca3af; background: #f9fafb;" data-date="29">
                                <div style="font-weight: 500; font-size: 14px;">29</div>
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; color: #9ca3af; background: #f9fafb;" data-date="30">
                                <div style="font-weight: 500; font-size: 14px;">30</div>
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="1" data-full-date="2025-10-01" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">1</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="2" data-full-date="2025-10-02" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">2</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="3" data-full-date="2025-10-03" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">3</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; background: #e0f2fe;" data-date="4" data-full-date="2025-10-04" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#bae6fd'" onmouseout="this.style.background='#e0f2fe'">
                                <div style="font-weight: 500; font-size: 14px; color: #0284c7;">4</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: #eff6ff; background: #fee2e2; border: 2px solid #3b82f6;" data-date="5" data-full-date="2025-10-05" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#dbeafe'" onmouseout="this.style.background='#eff6ff'">
                                <div style="font-weight: 500; font-size: 14px; color: #dc2626;">5</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="6" data-full-date="2025-10-06" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">6</div>
                                
                                <div class="mt-1 space-y-1">
                                    <div class="text-xs p-1 bg-gray-500 text-white rounded truncate cursor-pointer hover:opacity-80 event-item" draggable="true" data-event-id="case-4" onclick="showEventDetail(case-4)" oncontextmenu="showEventMenu(event, case-4)" ondragstart="handleDragStart(event, case-4)" title="Ë¶ãÁ©ç‰ΩúÊàê‰∏≠: undefinedÊßò">
                                        10:00 Ë¶ãÁ©ç‰ΩúÊàê‰∏≠: undefinedÊßò
                                    </div>
                                </div>
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="7" data-full-date="2025-10-07" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">7</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="8" data-full-date="2025-10-08" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">8</div>
                                
                                <div class="mt-1 space-y-1">
                                    <div class="text-xs p-1 bg-gray-500 text-white rounded truncate cursor-pointer hover:opacity-80 event-item" draggable="true" data-event-id="case-1" onclick="showEventDetail(case-1)" oncontextmenu="showEventMenu(event, case-1)" ondragstart="handleDragStart(event, case-1)" title="2024/01/18 14:00 ÈõªË©±„Éï„Ç©„É≠„Éº: undefinedÊßò">
                                        10:00 2024/01/18 14:00 ÈõªË©±„Éï„Ç©„É≠„Éº: undefinedÊßò
                                    </div>
                                
                                    <div class="text-xs p-1 bg-gray-500 text-white rounded truncate cursor-pointer hover:opacity-80 event-item" draggable="true" data-event-id="case-2" onclick="showEventDetail(case-2)" oncontextmenu="showEventMenu(event, case-2)" ondragstart="handleDragStart(event, case-2)" title="2024/01/20 14:00 ÁèæÂú∞Ë™øÊüª: undefinedÊßò">
                                        10:00 2024/01/20 14:00 ÁèæÂú∞Ë™øÊüª: undefinedÊßò
                                    </div>
                                
                                    <div class="text-xs p-1 bg-gray-500 text-white rounded truncate cursor-pointer hover:opacity-80 event-item" draggable="true" data-event-id="case-3" onclick="showEventDetail(case-3)" oncontextmenu="showEventMenu(event, case-3)" ondragstart="handleDragStart(event, case-3)" title="2024/01/22 10:00 Ë¶ãÁ©çË™¨ÊòéË®™Âïè: undefinedÊßò">
                                        10:00 2024/01/22 10:00 Ë¶ãÁ©çË™¨ÊòéË®™Âïè: undefinedÊßò
                                    </div>
                                
                                    <div class="text-xs p-1 bg-gray-500 text-white rounded truncate cursor-pointer hover:opacity-80 event-item" draggable="true" data-event-id="case-5" onclick="showEventDetail(case-5)" oncontextmenu="showEventMenu(event, case-5)" ondragstart="handleDragStart(event, case-5)" title="2024/01/25 Â∑•‰∫ãÈñãÂßã: undefinedÊßò">
                                        10:00 2024/01/25 Â∑•‰∫ãÈñãÂßã: undefinedÊßò
                                    </div>
                                </div>
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="9" data-full-date="2025-10-09" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">9</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="10" data-full-date="2025-10-10" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">10</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; background: #e0f2fe;" data-date="11" data-full-date="2025-10-11" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#bae6fd'" onmouseout="this.style.background='#e0f2fe'">
                                <div style="font-weight: 500; font-size: 14px; color: #0284c7;">11</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; background: #fee2e2;" data-date="12" data-full-date="2025-10-12" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#fecaca'" onmouseout="this.style.background='#fee2e2'">
                                <div style="font-weight: 500; font-size: 14px; color: #dc2626;">12</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; background: #fee2e2;" data-date="13" data-full-date="2025-10-13" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#fecaca'" onmouseout="this.style.background='#fee2e2'">
                                <div style="font-weight: 500; font-size: 14px; color: #dc2626;">13</div>
                                <div style="font-size: 10px; color: #dc2626; font-weight: 500;">„Çπ„Éù„Éº„ÉÑ„ÅÆÊó•</div>
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="14" data-full-date="2025-10-14" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">14</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="15" data-full-date="2025-10-15" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">15</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="16" data-full-date="2025-10-16" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">16</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="17" data-full-date="2025-10-17" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">17</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; background: #e0f2fe;" data-date="18" data-full-date="2025-10-18" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#bae6fd'" onmouseout="this.style.background='#e0f2fe'">
                                <div style="font-weight: 500; font-size: 14px; color: #0284c7;">18</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; background: #fee2e2;" data-date="19" data-full-date="2025-10-19" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#fecaca'" onmouseout="this.style.background='#fee2e2'">
                                <div style="font-weight: 500; font-size: 14px; color: #dc2626;">19</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="20" data-full-date="2025-10-20" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">20</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="21" data-full-date="2025-10-21" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">21</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="22" data-full-date="2025-10-22" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">22</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="23" data-full-date="2025-10-23" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">23</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="24" data-full-date="2025-10-24" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">24</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; background: #e0f2fe;" data-date="25" data-full-date="2025-10-25" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#bae6fd'" onmouseout="this.style.background='#e0f2fe'">
                                <div style="font-weight: 500; font-size: 14px; color: #0284c7;">25</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; background: #fee2e2;" data-date="26" data-full-date="2025-10-26" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#fecaca'" onmouseout="this.style.background='#fee2e2'">
                                <div style="font-weight: 500; font-size: 14px; color: #dc2626;">26</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="27" data-full-date="2025-10-27" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">27</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="28" data-full-date="2025-10-28" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">28</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="29" data-full-date="2025-10-29" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">29</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="30" data-full-date="2025-10-30" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">30</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;" data-date="31" data-full-date="2025-10-31" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="handleCellClick(event)" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                                <div style="font-weight: 500; font-size: 14px; ">31</div>
                                
                                
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; color: #9ca3af; background: #f9fafb;" data-date="1">
                                <div style="font-weight: 500; font-size: 14px;">1</div>
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; color: #9ca3af; background: #f9fafb;" data-date="2">
                                <div style="font-weight: 500; font-size: 14px;">2</div>
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; color: #9ca3af; background: #f9fafb;" data-date="3">
                                <div style="font-weight: 500; font-size: 14px;">3</div>
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; color: #9ca3af; background: #f9fafb;" data-date="4">
                                <div style="font-weight: 500; font-size: 14px;">4</div>
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; color: #9ca3af; background: #f9fafb;" data-date="5">
                                <div style="font-weight: 500; font-size: 14px;">5</div>
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; color: #9ca3af; background: #f9fafb;" data-date="6">
                                <div style="font-weight: 500; font-size: 14px;">6</div>
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; color: #9ca3af; background: #f9fafb;" data-date="7">
                                <div style="font-weight: 500; font-size: 14px;">7</div>
                            </div>
                        
                            <div style="border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white; color: #9ca3af; background: #f9fafb;" data-date="8">
                                <div style="font-weight: 500; font-size: 14px;">8</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÈÄ±Ë°®Á§∫ÔºàÂàùÊúü„ÅØÈùûË°®Á§∫Ôºâ -->
                    <div id="calendarWeekView" class="p-4 hidden">
                        <div id="weekGrid" class="grid grid-cols-8 gap-0 border">
                            <!-- Week view content will be rendered here -->
                        </div>
                    </div>
                    
                    <!-- Êó•Ë°®Á§∫ÔºàÂàùÊúü„ÅØÈùûË°®Á§∫Ôºâ -->
                    <div id="calendarDayView" class="p-4 hidden">
                        <div class="bg-white rounded-lg shadow">
                            <div class="p-4 border-b">
                                <h3 id="dayViewDate" class="text-lg font-semibold">2024Âπ¥1Êúà15Êó•ÔºàÊúàÔºâ</h3>
                            </div>
                            <div id="dayTimeSlots" class="p-4">
                                <!-- Day view time slots will be rendered here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Âá°‰æã -->
                <div class="bg-white rounded-lg shadow p-4">
                    <h4 class="text-sm font-medium text-gray-700 mb-3">Âá°‰æã</h4>
                    <div class="flex flex-wrap gap-4 text-sm">
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-blue-500 rounded mr-2"></div>
                            <span>„Éí„Ç¢„É™„É≥„Ç∞„ÉªÁèæÂú∞Ë™øÊüª</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-green-500 rounded mr-2"></div>
                            <span>Â∑•‰∫ã</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-yellow-500 rounded mr-2"></div>
                            <span>Ë¶ãÁ©ç„ÇÇ„ÇäÊèêÂá∫</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-purple-500 rounded mr-2"></div>
                            <span>„Ç¢„Éï„Çø„Éº„Éï„Ç©„É≠„Éº</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-red-500 rounded mr-2"></div>
                            <span>ÈáçË¶Å</span>
                        </div>
                    </div>
                </div>
            </div><!-- calendarSection„ÅÆÁµÇ‰∫Ü -->
            
            <!-- Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="autodeliverySection" class="section" style="display: none;">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö</h2>

                <!-- ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö -->
                <div id="pauseSection" class="group mb-8 border-2 border-orange-300 rounded-lg p-6 bg-gradient-to-r from-orange-50 to-red-50 transition-all duration-300 hover:bg-orange-100">
                    <div class="flex justify-between items-center mb-4 section-header">
                        <h3 class="text-lg font-semibold text-gray-900">‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö</h3>
                        <div class="flex gap-2">
                            <!-- Èñ≤Ë¶ß„É¢„Éº„ÉâÊôÇ„ÅÆ„Éú„Çø„É≥ -->
                            <button id="editPauseBtn" onclick="toggleEditMode('pause', true)" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg flex items-center gap-2 font-medium group-hover:bg-orange-600 group-hover:text-white transition-colors duration-300">
                                üõ†Ô∏è Á∑®ÈõÜ
                            </button>
                            <!-- Á∑®ÈõÜ„É¢„Éº„ÉâÊôÇ„ÅÆ„Éú„Çø„É≥ÔºàÂàùÊúü„ÅØÈùûË°®Á§∫Ôºâ -->
                            <button id="savePauseBtn" onclick="saveSection('pause')" class="hidden px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 flex items-center gap-2 font-medium shadow-md">
                                üíæ ‰øùÂ≠ò
                            </button>
                            <button id="cancelPauseBtn" onclick="cancelEditMode('pause')" class="hidden px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 flex items-center gap-2 font-medium">
                                ‚úó „Ç≠„É£„É≥„Çª„É´
                            </button>
                        </div>
                    </div>

                    <!-- Èñ≤Ë¶ß„É¢„Éº„Éâ -->
                    <div id="pauseView">
                        <div id="pauseDisplay" class="space-y-2">
                            <div class="flex items-center gap-3">
                                <span class="text-sm font-medium text-gray-700">‰∏ÄÊôÇÂÅúÊ≠¢Áä∂ÊÖã:</span>
                                <span id="pauseStatusDisplay" class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 cursor-pointer hover:opacity-80 transition-opacity" onclick="handleStatusClick()" title="„ÇØ„É™„ÉÉ„ÇØ„Åß„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´Â§âÊõ¥">„Ç¢„ÇØ„ÉÜ„Ç£„Éñ</span>
                            </div>
                            <div id="pauseDateDisplay" class="text-sm text-gray-600 hidden">
                                <div>ÈñãÂßãÊó•: <span id="pauseStartDisplay"></span></div>
                                <div>ÂÜçÈñã‰∫àÂÆöÊó•: <span id="pauseEndDisplay"></span></div>
                            </div>
                        </div>
                    </div>

                    <!-- Á∑®ÈõÜ„É¢„Éº„Éâ -->
                    <div id="pauseEdit" class="hidden space-y-4">
                        <div class="flex items-center justify-between">
                            <label class="text-sm font-medium text-gray-700">‰∏ÄÊôÇÂÅúÊ≠¢„ÇíÊúâÂäπ„Å´„Åô„Çã</label>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="autoPauseToggle" onchange="toggleAutoPauseEdit()" class="sr-only peer" data-section="pause">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"></div>
                            </label>
                        </div>

                        <div id="pauseSettings" class="space-y-3 hidden">
                            <!-- ‰∏ÄÊôÇÂÅúÊ≠¢ÈñãÂßãÊó• -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">‰∏ÄÊôÇÂÅúÊ≠¢ÈñãÂßãÊó•</label>
                                <input type="date" id="pauseStartDate" data-section="pause" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                            </div>

                            <!-- ‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñãÊó• -->
                            <div>
                                <div class="flex items-center justify-between mb-2">
                                    <label class="block text-sm font-medium text-gray-700">‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñãÊó•</label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" id="indefinitePause" onchange="toggleIndefinitePause()" data-section="pause" class="rounded text-orange-600 focus:ring-orange-500">
                                        <span class="text-sm text-gray-600">Êú™ÂÆö</span>
                                    </label>
                                </div>
                                <input type="text" id="pauseEndDateDisplay" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed text-gray-500 hidden" value="Êú™ÂÆö" readonly>
                                <input type="date" id="pauseEndDate" data-section="pause" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÂØæÂøúÂèØËÉΩÁâ©‰ª∂Á®ÆÂà• -->
                <div id="propertyTypesSection" class="group mb-8 border-2 border-gray-300 rounded-lg p-6 bg-white transition-all duration-300 hover:bg-blue-50">
                    <div class="flex justify-between items-center mb-4 section-header">
                        <h3 class="text-lg font-semibold text-gray-900">ÂØæÂøúÂèØËÉΩÁâ©‰ª∂Á®ÆÂà•</h3>
                        <div class="flex gap-2">
                            <!-- Èñ≤Ë¶ß„É¢„Éº„ÉâÊôÇ„ÅÆ„Éú„Çø„É≥ -->
                            <button id="editPropertyTypesBtn" onclick="toggleEditMode('propertyTypes', true)" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg flex items-center gap-2 font-medium group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300">
                                üõ†Ô∏è Á∑®ÈõÜ
                            </button>
                            <!-- Á∑®ÈõÜ„É¢„Éº„ÉâÊôÇ„ÅÆ„Éú„Çø„É≥ÔºàÂàùÊúü„ÅØÈùûË°®Á§∫Ôºâ -->
                            <button id="savePropertyTypesBtn" onclick="saveSection('propertyTypes')" class="hidden px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 font-medium shadow-md">
                                üíæ ‰øùÂ≠ò
                            </button>
                            <button id="cancelPropertyTypesBtn" onclick="cancelEditMode('propertyTypes')" class="hidden px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 flex items-center gap-2 font-medium">
                                ‚úó „Ç≠„É£„É≥„Çª„É´
                            </button>
                        </div>
                    </div>

                    <!-- Èñ≤Ë¶ß„É¢„Éº„Éâ -->
                    <div id="propertyTypesView" class="space-y-4">
                        <div id="propertyTypesDisplay" class="text-sm text-gray-500">Ë®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</div>
                    </div>

                    <!-- Á∑®ÈõÜ„É¢„Éº„Éâ -->
                    <div id="propertyTypesEdit" class="hidden">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            ÂØæÂøúÂèØËÉΩÁâ©‰ª∂<span class="text-red-500">*</span>ÔºàÊúÄÂ§ßÂØæÂøúÈöéÊï∞Ôºâ
                        </label>
                        <div class="space-y-3">
                                <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-gray-300">
                                    <input type="checkbox" class="mr-3" value="house" name="propertyType">
                                    <div class="flex-1 flex items-center">
                                        <span class="font-medium">üè† Êà∏Âª∫„Å¶‰ΩèÂÆÖ</span>
                                        <select class="ml-auto text-sm border rounded px-2 py-1">
                                            <option value="1">1Èöé</option>
                                            <option value="2">2Èöé</option>
                                            <option value="3" selected="">3Èöé</option>
                                            <option value="4">4Èöé‰ª•‰∏ä</option>
                                        </select>
                                        <span class="ml-1 text-sm text-gray-600">„Åæ„Åß</span>
                                    </div>
                                </label>
                                <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-gray-300">
                                    <input type="checkbox" class="mr-3" value="apartment" name="propertyType" onchange="checkLargeProperty(this)">
                                    <div class="flex-1 flex items-center">
                                        <span class="font-medium">üè¢ „Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥</span>
                                        <select class="ml-auto text-sm border rounded px-2 py-1" onchange="checkFloorSelection(this)">
                                            <option value="1">1Èöé</option>
                                            <option value="2">2Èöé</option>
                                            <option value="3" selected="">3Èöé</option>
                                            <option value="4">4Èöé</option>
                                            <option value="5">5Èöé</option>
                                            <option value="6">6Èöé</option>
                                            <option value="7">7Èöé</option>
                                            <option value="8">8Èöé</option>
                                            <option value="9">9Èöé</option>
                                            <option value="unlimited">10Èöé‰ª•‰∏ä</option>
                                        </select>
                                        <span class="ml-1 text-sm text-gray-600">„Åæ„Åß</span>
                                    </div>
                                </label>
                                <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-gray-300">
                                    <input type="checkbox" class="mr-3" value="commercial" name="propertyType" onchange="checkLargeProperty(this)">
                                    <div class="flex-1 flex items-center">
                                        <span class="font-medium">üè™ Â∫óËàó„Éª‰∫ãÂãôÊâÄ</span>
                                        <select class="ml-auto text-sm border rounded px-2 py-1" onchange="checkFloorSelection(this)">
                                            <option value="1">1Èöé</option>
                                            <option value="2">2Èöé</option>
                                            <option value="3" selected="">3Èöé</option>
                                            <option value="4">4Èöé‰ª•‰∏ä</option>
                                        </select>
                                        <span class="ml-1 text-sm text-gray-600">„Åæ„Åß</span>
                                    </div>
                                </label>
                                <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-gray-300">
                                    <input type="checkbox" class="mr-3" value="factory" name="propertyType" onchange="checkLargeProperty(this)">
                                    <div class="flex-1 flex items-center">
                                        <span class="font-medium">üè≠ Â∑•Â†¥„ÉªÂÄâÂ∫´</span>
                                        <select class="ml-auto text-sm border rounded px-2 py-1" onchange="checkFloorSelection(this)">
                                            <option value="1">1Èöé</option>
                                            <option value="2">2Èöé</option>
                                            <option value="3" selected="">3Èöé</option>
                                            <option value="4">4Èöé‰ª•‰∏ä</option>
                                        </select>
                                        <span class="ml-1 text-sm text-gray-600">„Åæ„Åß</span>
                                    </div>
                                </label>
                            </div>

                        <!-- ÁØâÂπ¥Êï∞ÂØæÂøúÁØÑÂõ≤ -->
                        <div class="mt-6">
                            <label class="block mb-2 text-sm font-semibold text-gray-700">ÁØâÂπ¥Êï∞ÂØæÂøúÁØÑÂõ≤ <span class="text-red-500">*</span></label>
                            <div class="bg-white border rounded-lg p-4">
                                <div class="mb-2">
                                    <p class="text-center text-lg font-medium text-gray-800">
                                        ÁØâ<span id="ageRangeMinAuto">19</span>Âπ¥„Äú<span id="ageRangeMaxAuto">53</span>Âπ¥„Åæ„ÅßÂØæÂøú
                                    </p>
                                </div>
                                <div class="space-y-4">
                                    <div>
                                        <label class="text-sm text-gray-600">ÁØâÂπ¥Êï∞‰∏ãÈôê</label>
                                        <input type="range" min="0" max="50" value="0" class="w-full" oninput="updateAgeRangeAuto()">
                                        <div class="flex justify-between text-xs text-gray-400 mt-1">
                                            <span>0Âπ¥</span>
                                            <span>10Âπ¥</span>
                                            <span>20Âπ¥</span>
                                            <span>30Âπ¥</span>
                                            <span>40Âπ¥</span>
                                            <span>50Âπ¥</span>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-600">ÁØâÂπ¥Êï∞‰∏äÈôê</label>
                                        <input type="range" min="0" max="100" value="50" class="w-full" oninput="updateAgeRangeAuto()">
                                        <div class="flex justify-between text-xs text-gray-400 mt-1">
                                            <span>0Âπ¥</span>
                                            <span>20Âπ¥</span>
                                            <span>40Âπ¥</span>
                                            <span>60Âπ¥</span>
                                            <span>80Âπ¥</span>
                                            <span>100Âπ¥</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÊñΩÂ∑•ÁÆáÊâÄ -->
                <div id="constructionAreasSection" class="group mb-8 border-2 border-gray-300 rounded-lg p-6 bg-white transition-all duration-300 hover:bg-blue-50">
                    <div class="flex justify-between items-center mb-4 section-header">
                        <h3 class="text-lg font-semibold text-gray-900">ÊñΩÂ∑•ÁÆáÊâÄ</h3>
                        <div class="flex gap-2">
                            <!-- Èñ≤Ë¶ß„É¢„Éº„ÉâÊôÇ„ÅÆ„Éú„Çø„É≥ -->
                            <button id="editConstructionAreasBtn" onclick="toggleEditMode('constructionAreas', true)" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg flex items-center gap-2 font-medium group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300">
                                üõ†Ô∏è Á∑®ÈõÜ
                            </button>
                            <!-- Á∑®ÈõÜ„É¢„Éº„ÉâÊôÇ„ÅÆ„Éú„Çø„É≥ÔºàÂàùÊúü„ÅØÈùûË°®Á§∫Ôºâ -->
                            <button id="saveConstructionAreasBtn" onclick="saveSection('constructionAreas')" class="hidden px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 font-medium shadow-md">
                                üíæ ‰øùÂ≠ò
                            </button>
                            <button id="cancelConstructionAreasBtn" onclick="cancelEditMode('constructionAreas')" class="hidden px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 flex items-center gap-2 font-medium">
                                ‚úó „Ç≠„É£„É≥„Çª„É´
                            </button>
                        </div>
                    </div>

                    <!-- Èñ≤Ë¶ß„É¢„Éº„Éâ -->
                    <div id="constructionAreasView" class="space-y-4">
                        <div id="constructionAreasDisplay" class="text-sm text-gray-500">Ë®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</div>
                    </div>

                    <!-- Á∑®ÈõÜ„É¢„Éº„Éâ -->
                    <div id="constructionAreasEdit" class="hidden">
                        <div class="space-y-4">
                            <p class="text-sm text-gray-600 mb-2">ÂØæÂøúÂèØËÉΩ„Å™Â∑•‰∫ãÂÜÖÂÆπÂÖ®„Å¶„Å´„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÂÖ•„Çå„Å¶„Åè„Å†„Åï„ÅÑ</p>
                            <p class="text-sm text-gray-600 mb-4">ÈÅ∏Êäû„Åó„ÅüÈ†ÖÁõÆ„ÅåËá™ÂãïÈÖç‰ø°„ÅÆÊù°‰ª∂„Å´ÂΩì„Å¶„ÅØ„Åæ„Å£„ÅüÂ†¥Âêà„ÄÅË®òËºâ„ÅÆÊñôÈáëÔºà‚ÄªÁ®éÊäúÔºâ„ÅåÈÅ©Áî®„Åï„Çå„Åæ„Åô„ÄÇ</p>

                        <!-- ¬•20,000È†ÖÁõÆ -->
                        <div class="mb-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â§ñÂ£ÅÂ°óË£Ö" class="mr-3">
                                    <span class="flex-1">Â§ñÂ£ÅÂ°óË£Ö</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï" class="mr-3">
                                    <span class="flex-1">Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â§ñÂ£ÅÂºµÊõø„Åà" class="mr-3">
                                    <span class="flex-1">Â§ñÂ£ÅÂºµÊõø„Åà</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ãÊ†πÂ°óË£ÖÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ" class="mr-3">
                                    <span class="flex-1">Â±ãÊ†πÂ°óË£ÖÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ã‰∏äÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ" class="mr-3">
                                    <span class="flex-1">Â±ã‰∏äÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚Äª„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠â" class="mr-3">
                                    <span class="flex-1 text-sm">Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚Äª„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠â</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚ÄªÁì¶" class="mr-3">
                                    <span class="flex-1">Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚ÄªÁì¶</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï" class="mr-3">
                                    <span class="flex-1">Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â§ñÂ£ÅË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ" class="mr-3">
                                    <span class="flex-1">Â§ñÂ£ÅË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ãÊ†πË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ" class="mr-3">
                                    <span class="flex-1">Â±ãÊ†πË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ" class="mr-3">
                                    <span class="flex-1">„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ" class="mr-3">
                                    <span class="flex-1">Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="ÂÜÖË£ÖÊ∞¥Âõû„ÇäÔºà„Éê„Çπ„Éª„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éà„Ç§„É¨ÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ" class="mr-3">
                                    <span class="flex-1 text-sm">ÂÜÖË£ÖÊ∞¥Âõû„ÇäÔºà„Éê„Çπ„Éª„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éà„Ç§„É¨ÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="ÂÜÖË£ÖÔºà„Éï„É≠„Éº„É™„É≥„Ç∞„ÇÑÁï≥„Å™„Å©„ÅÆÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ" class="mr-3">
                                    <span class="flex-1 text-sm">ÂÜÖË£ÖÔºà„Éï„É≠„Éº„É™„É≥„Ç∞„ÇÑÁï≥„Å™„Å©„ÅÆÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÔºàÂ±ãÊ†πÂ∑•‰∫ãÂê´„ÇÄÔºâ" class="mr-3">
                                    <span class="flex-1">Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÔºàÂ±ãÊ†πÂ∑•‰∫ãÂê´„ÇÄÔºâ</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                            </div>
                        </div>

                        <!-- ¬•10,000È†ÖÁõÆ -->
                        <div class="mb-6">
                            <p class="text-sm text-gray-600 mb-2">‰ª•‰∏ã„ÅÆÂçòÂìÅ‰æùÈ†º„ÅØÁõ∏Ë¶ãÁ©ç„ÇÇ„ÇäÊôÇ„ÅÆÊñôÈáë„ÇíÁ®éÊäú„ÅçË°®Á§∫„Åó„Å¶„Åä„Çä„Åæ„Åô„ÄÇ</p>
                            <p class="text-sm text-gray-600 mb-3">‚Äª1Á§æÁ¥π‰ªãÊôÇ„ÅØ„Åô„Åπ„Å¶¬•20,000„Å®„Å™„Çä„Åæ„Åô</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ãÊ†πÂ°óË£ÖÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ" class="mr-3" onchange="checkSingleItemSelection(this)">
                                    <span class="flex-1">Â±ãÊ†πÂ°óË£ÖÂçòÂìÅ</span>
                                    <span class="text-sm font-semibold text-green-600">¬•10,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ã‰∏äÈò≤Ê∞¥ÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ" class="mr-3" onchange="checkSingleItemSelection(this)">
                                    <span class="flex-1">Â±ã‰∏äÈò≤Ê∞¥ÂçòÂìÅ</span>
                                    <span class="text-sm font-semibold text-green-600">¬•10,000</span>
                                </label>
                            </div>
                        </div>

                        <!-- ¬•5,000È†ÖÁõÆ -->
                        <div class="mb-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â§ñÂ£ÅË£ú‰øÆÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ" class="mr-3" onchange="checkSingleItemSelection(this)">
                                    <span class="flex-1">Â§ñÂ£ÅË£ú‰øÆÂçòÂìÅ</span>
                                    <span class="text-sm font-semibold text-red-600">¬•5,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ãÊ†πË£ú‰øÆÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ" class="mr-3" onchange="checkSingleItemSelection(this)">
                                    <span class="flex-1">Â±ãÊ†πË£ú‰øÆÂçòÂìÅ</span>
                                    <span class="text-sm font-semibold text-red-600">¬•5,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ" class="mr-3" onchange="checkSingleItemSelection(this)">
                                    <span class="flex-1">„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÂçòÂìÅ</span>
                                    <span class="text-sm font-semibold text-red-600">¬•5,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ" class="mr-3" onchange="checkSingleItemSelection(this)">
                                    <span class="flex-1">Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅ</span>
                                    <span class="text-sm font-semibold text-red-600">¬•5,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ" class="mr-3" onchange="checkSingleItemSelection(this)">
                                    <span class="flex-1">Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅ</span>
                                    <span class="text-sm font-semibold text-red-600">¬•5,000</span>
                                </label>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>

                <!-- ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ -->
                <div id="specialServicesSection" class="group mb-8 border-2 border-gray-300 rounded-lg p-6 bg-white transition-all duration-300 hover:bg-blue-50">
                    <div class="flex justify-between items-center mb-4 section-header">
                        <h3 class="text-lg font-semibold text-gray-900">ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ</h3>
                        <div class="flex gap-2">
                            <!-- Èñ≤Ë¶ß„É¢„Éº„ÉâÊôÇ„ÅÆ„Éú„Çø„É≥ -->
                            <button id="editSpecialServicesBtn" onclick="toggleEditMode('specialServices', true)" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg flex items-center gap-2 font-medium group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300">
                                üõ†Ô∏è Á∑®ÈõÜ
                            </button>
                            <!-- Á∑®ÈõÜ„É¢„Éº„ÉâÊôÇ„ÅÆ„Éú„Çø„É≥ÔºàÂàùÊúü„ÅØÈùûË°®Á§∫Ôºâ -->
                            <button id="saveSpecialServicesBtn" onclick="saveSection('specialServices')" class="hidden px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 font-medium shadow-md">
                                üíæ ‰øùÂ≠ò
                            </button>
                            <button id="cancelSpecialServicesBtn" onclick="cancelEditMode('specialServices')" class="hidden px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 flex items-center gap-2 font-medium">
                                ‚úó „Ç≠„É£„É≥„Çª„É´
                            </button>
                        </div>
                    </div>

                    <!-- Èñ≤Ë¶ß„É¢„Éº„Éâ -->
                    <div id="specialServicesView" class="space-y-4">
                        <div id="specialServicesDisplay" class="text-sm text-gray-500">Ë®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</div>
                    </div>

                    <!-- Á∑®ÈõÜ„É¢„Éº„Éâ -->
                    <div id="specialServicesEdit" class="hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üå° ÈÅÆÁÜ±„ÉªÊñ≠ÁÜ±Â°óÊñôÊèêÊ°àÂèØËÉΩ">
                                <span class="text-sm">üå° ÈÅÆÁÜ±„ÉªÊñ≠ÁÜ±Â°óÊñôÊèêÊ°àÂèØËÉΩ</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üëÄ Á´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÊâãÊ∏°„ÅóÂ∏åÊúõ">
                                <span class="text-sm">üëÄ Á´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÊâãÊ∏°„ÅóÂ∏åÊúõ</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üìÆ ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÈÉµÈÄÅ„ÉªÈõªË©±„ÅßÂïÜË´áÂèØ">
                                <span class="text-sm">üìÆ ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÈÉµÈÄÅ„ÉªÈõªË©±„ÅßÂïÜË´áÂèØ</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üè° „Ç®„ÇØ„Çπ„ÉÜ„É™„Ç¢ÔºàÂ∫≠„ÉªÈßêËªäÂ†¥„ÉªÂ§ñÊßãÔºâ">
                                <span class="text-sm">üè° „Ç®„ÇØ„Çπ„ÉÜ„É™„Ç¢ÔºàÂ∫≠„ÉªÈßêËªäÂ†¥„ÉªÂ§ñÊßãÔºâ</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="‚òÄÔ∏è Â§™ÈôΩÂÖâ„Éë„Éç„É´ËÑ±ÁùÄÔºàÊí§ÂéªÂê´„ÇÄÔºâ">
                                <span class="text-sm">‚òÄÔ∏è Â§™ÈôΩÂÖâ„Éë„Éç„É´ËÑ±ÁùÄÔºàÊí§ÂéªÂê´„ÇÄÔºâ</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üè¶ ÊèêÊê∫ÂÖà„É≠„Éº„É≥Êúâ„Çä">
                                <span class="text-sm">üè¶ ÊèêÊê∫ÂÖà„É≠„Éº„É≥Êúâ„Çä</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üí≥ „ÇØ„É¨„Ç∏„ÉÉ„Éà„Ç´„Éº„ÉâÊâï„ÅÑÂèØ">
                                <span class="text-sm">üí≥ „ÇØ„É¨„Ç∏„ÉÉ„Éà„Ç´„Éº„ÉâÊâï„ÅÑÂèØ</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üî• ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà">
                                <span class="text-sm">üî• ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üí∞ Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà">
                                <span class="text-sm">üí∞ Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üèó Âª∫ÁØâË®±ÂèØË®º">
                                <span class="text-sm">üèó Âª∫ÁØâË®±ÂèØË®º</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="‚ú® ÂÖâËß¶Â™íÂ°óÊñôÊèêÊ°àÂèØ">
                                <span class="text-sm">‚ú® ÂÖâËß¶Â™íÂ°óÊñôÊèêÊ°àÂèØ</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üí¥ ÂàÜÂâ≤Êâï„ÅÑ„Éó„É©„É≥Êúâ">
                                <span class="text-sm">üí¥ ÂàÜÂâ≤Êâï„ÅÑ„Éó„É©„É≥Êúâ</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- ÂØæÂøú„Ç®„É™„Ç¢ÈÅ∏Êäû -->
                <div id="serviceAreasSection" class="group mb-8 border-2 border-gray-300 rounded-lg p-6 bg-white transition-all duration-300 hover:bg-blue-50">
                    <div class="flex justify-between items-center mb-4 section-header">
                        <h3 class="text-lg font-semibold text-gray-900">ÂØæÂøú„Ç®„É™„Ç¢ÈÅ∏Êäû</h3>
                        <div class="flex gap-2">
                            <!-- Èñ≤Ë¶ß„É¢„Éº„ÉâÊôÇ„ÅÆ„Éú„Çø„É≥ -->
                            <button id="editServiceAreasBtn" onclick="toggleEditMode('serviceAreas', true)" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg flex items-center gap-2 font-medium group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300">
                                üõ†Ô∏è Á∑®ÈõÜ
                            </button>
                            <!-- Á∑®ÈõÜ„É¢„Éº„ÉâÊôÇ„ÅÆ„Éú„Çø„É≥ÔºàÂàùÊúü„ÅØÈùûË°®Á§∫Ôºâ -->
                            <button id="saveServiceAreasBtn" onclick="saveSection('serviceAreas')" class="hidden px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 font-medium shadow-md">
                                üíæ ‰øùÂ≠ò
                            </button>
                            <button id="cancelServiceAreasBtn" onclick="cancelEditMode('serviceAreas')" class="hidden px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 flex items-center gap-2 font-medium">
                                ‚úó „Ç≠„É£„É≥„Çª„É´
                            </button>
                        </div>
                    </div>

                    <!-- Èñ≤Ë¶ß„É¢„Éº„Éâ -->
                    <div id="serviceAreasView" class="space-y-4">
                        <div id="serviceAreasDisplay" class="text-sm text-gray-500">Ë®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</div>
                    </div>

                    <!-- Á∑®ÈõÜ„É¢„Éº„Éâ -->
                    <div id="serviceAreasEdit" class="hidden">
                        <div class="border rounded-lg p-4">
                            <p class="text-sm text-gray-600 mb-4">„Çµ„Éº„Éì„ÇπÊèê‰æõÂèØËÉΩ„Å™„Ç®„É™„Ç¢„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºàÊúÄÂ§ß5„Å§„Åæ„ÅßÔºâ</p>

                            <!-- ÈÅ∏ÊäûÁä∂Ê≥Å„Çµ„Éû„É™„Éº -->
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <span class="text-sm text-gray-600">ÈÅ∏ÊäûÊ∏à„ÅøÈÉΩÈÅìÂ∫úÁúåÔºö</span>
                                        <span id="selectedPrefCount" class="font-bold text-lg ml-2">5</span>
                                        <span class="text-sm text-gray-600">/ 5</span>
                                    </div>
                                    <div>
                                        <span class="text-sm text-gray-600">ÈÅ∏ÊäûÊ∏à„ÅøÂ∏ÇÂå∫Áî∫ÊùëÔºö</span>
                                        <span id="selectedCityCount" class="font-bold text-lg ml-2">0</span>
                                    </div>
                                </div>
                            </div>

                            <!-- ÈÉΩÈÅìÂ∫úÁúåÈÅ∏Êäû -->
                            <div class="mb-6">
                                <div id="prefectureGrid" class="grid grid-cols-2 md:grid-cols-4 gap-2">
                                    <!-- JavaScript VideÂãïÁöÑÁîüÊàê„Åï„Çå„Çã -->
                                </div>
                            </div>

                            <!-- STEP 1: ÈÉΩÈÅìÂ∫úÁúå„ÇíÈÅ∏Êäû -->
                            <div id="step1Area" class="mb-6">
                                <h4 class="text-md font-medium mb-3">STEP 1: ÈÉΩÈÅìÂ∫úÁúå„ÇíÈÅ∏ÊäûÔºàÊúÄÂ§ß5ÈÉΩÈÅìÂ∫úÁúåÔºâ</h4>
                                <div id="allPrefecturesGrid" class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2">
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="ÂåóÊµ∑ÈÅì" onclick="togglePrefecture('ÂåóÊµ∑ÈÅì')">
                    ÂåóÊµ∑ÈÅì
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="ÈùíÊ£ÆÁúå" onclick="togglePrefecture('ÈùíÊ£ÆÁúå')">
                    ÈùíÊ£ÆÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Â≤©ÊâãÁúå" onclick="togglePrefecture('Â≤©ÊâãÁúå')">
                    Â≤©ÊâãÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="ÂÆÆÂüéÁúå" onclick="togglePrefecture('ÂÆÆÂüéÁúå')">
                    ÂÆÆÂüéÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="ÁßãÁî∞Áúå" onclick="togglePrefecture('ÁßãÁî∞Áúå')">
                    ÁßãÁî∞Áúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Â±±ÂΩ¢Áúå" onclick="togglePrefecture('Â±±ÂΩ¢Áúå')">
                    Â±±ÂΩ¢Áúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Á¶èÂ≥∂Áúå" onclick="togglePrefecture('Á¶èÂ≥∂Áúå')">
                    Á¶èÂ≥∂Áúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Ëå®ÂüéÁúå" onclick="togglePrefecture('Ëå®ÂüéÁúå')">
                    Ëå®ÂüéÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Ê†ÉÊú®Áúå" onclick="togglePrefecture('Ê†ÉÊú®Áúå')">
                    Ê†ÉÊú®Áúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Áæ§È¶¨Áúå" onclick="togglePrefecture('Áæ§È¶¨Áúå')">
                    Áæ§È¶¨Áúå
                </button>
            
                <button class="area-item p-2 border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm selected bg-blue-500 text-white" data-prefecture="ÂüºÁéâÁúå" onclick="togglePrefecture('ÂüºÁéâÁúå')">
                    ÂüºÁéâÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="ÂçÉËëâÁúå" onclick="togglePrefecture('ÂçÉËëâÁúå')">
                    ÂçÉËëâÁúå
                </button>
            
                <button class="area-item p-2 border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm selected bg-blue-500 text-white" data-prefecture="Êù±‰∫¨ÈÉΩ" onclick="togglePrefecture('Êù±‰∫¨ÈÉΩ')">
                    Êù±‰∫¨ÈÉΩ
                </button>
            
                <button class="area-item p-2 border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm selected bg-blue-500 text-white" data-prefecture="Á•ûÂ•àÂ∑ùÁúå" onclick="togglePrefecture('Á•ûÂ•àÂ∑ùÁúå')">
                    Á•ûÂ•àÂ∑ùÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Êñ∞ÊΩüÁúå" onclick="togglePrefecture('Êñ∞ÊΩüÁúå')">
                    Êñ∞ÊΩüÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="ÂØåÂ±±Áúå" onclick="togglePrefecture('ÂØåÂ±±Áúå')">
                    ÂØåÂ±±Áúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Áü≥Â∑ùÁúå" onclick="togglePrefecture('Áü≥Â∑ùÁúå')">
                    Áü≥Â∑ùÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Á¶è‰∫ïÁúå" onclick="togglePrefecture('Á¶è‰∫ïÁúå')">
                    Á¶è‰∫ïÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Â±±Ê¢®Áúå" onclick="togglePrefecture('Â±±Ê¢®Áúå')">
                    Â±±Ê¢®Áúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Èï∑ÈáéÁúå" onclick="togglePrefecture('Èï∑ÈáéÁúå')">
                    Èï∑ÈáéÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Â≤êÈòúÁúå" onclick="togglePrefecture('Â≤êÈòúÁúå')">
                    Â≤êÈòúÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="ÈùôÂ≤°Áúå" onclick="togglePrefecture('ÈùôÂ≤°Áúå')">
                    ÈùôÂ≤°Áúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="ÊÑõÁü•Áúå" onclick="togglePrefecture('ÊÑõÁü•Áúå')">
                    ÊÑõÁü•Áúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="‰∏âÈáçÁúå" onclick="togglePrefecture('‰∏âÈáçÁúå')">
                    ‰∏âÈáçÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="ÊªãË≥ÄÁúå" onclick="togglePrefecture('ÊªãË≥ÄÁúå')">
                    ÊªãË≥ÄÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="‰∫¨ÈÉΩÂ∫ú" onclick="togglePrefecture('‰∫¨ÈÉΩÂ∫ú')">
                    ‰∫¨ÈÉΩÂ∫ú
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Â§ßÈò™Â∫ú" onclick="togglePrefecture('Â§ßÈò™Â∫ú')">
                    Â§ßÈò™Â∫ú
                </button>
            
                <button class="area-item p-2 border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm selected bg-blue-500 text-white" data-prefecture="ÂÖµÂ∫´Áúå" onclick="togglePrefecture('ÂÖµÂ∫´Áúå')">
                    ÂÖµÂ∫´Áúå
                </button>
            
                <button class="area-item p-2 border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm selected bg-blue-500 text-white" data-prefecture="Â•àËâØÁúå" onclick="togglePrefecture('Â•àËâØÁúå')">
                    Â•àËâØÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="ÂíåÊ≠åÂ±±Áúå" onclick="togglePrefecture('ÂíåÊ≠åÂ±±Áúå')">
                    ÂíåÊ≠åÂ±±Áúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="È≥•ÂèñÁúå" onclick="togglePrefecture('È≥•ÂèñÁúå')">
                    È≥•ÂèñÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Â≥∂Ê†πÁúå" onclick="togglePrefecture('Â≥∂Ê†πÁúå')">
                    Â≥∂Ê†πÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Â≤°Â±±Áúå" onclick="togglePrefecture('Â≤°Â±±Áúå')">
                    Â≤°Â±±Áúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Â∫ÉÂ≥∂Áúå" onclick="togglePrefecture('Â∫ÉÂ≥∂Áúå')">
                    Â∫ÉÂ≥∂Áúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Â±±Âè£Áúå" onclick="togglePrefecture('Â±±Âè£Áúå')">
                    Â±±Âè£Áúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Âæ≥Â≥∂Áúå" onclick="togglePrefecture('Âæ≥Â≥∂Áúå')">
                    Âæ≥Â≥∂Áúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="È¶ôÂ∑ùÁúå" onclick="togglePrefecture('È¶ôÂ∑ùÁúå')">
                    È¶ôÂ∑ùÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="ÊÑõÂ™õÁúå" onclick="togglePrefecture('ÊÑõÂ™õÁúå')">
                    ÊÑõÂ™õÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="È´òÁü•Áúå" onclick="togglePrefecture('È´òÁü•Áúå')">
                    È´òÁü•Áúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Á¶èÂ≤°Áúå" onclick="togglePrefecture('Á¶èÂ≤°Áúå')">
                    Á¶èÂ≤°Áúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="‰ΩêË≥ÄÁúå" onclick="togglePrefecture('‰ΩêË≥ÄÁúå')">
                    ‰ΩêË≥ÄÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Èï∑Â¥éÁúå" onclick="togglePrefecture('Èï∑Â¥éÁúå')">
                    Èï∑Â¥éÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="ÁÜäÊú¨Áúå" onclick="togglePrefecture('ÁÜäÊú¨Áúå')">
                    ÁÜäÊú¨Áúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Â§ßÂàÜÁúå" onclick="togglePrefecture('Â§ßÂàÜÁúå')">
                    Â§ßÂàÜÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="ÂÆÆÂ¥éÁúå" onclick="togglePrefecture('ÂÆÆÂ¥éÁúå')">
                    ÂÆÆÂ¥éÁúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="ÈπøÂÖêÂ≥∂Áúå" onclick="togglePrefecture('ÈπøÂÖêÂ≥∂Áúå')">
                    ÈπøÂÖêÂ≥∂Áúå
                </button>
            
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm" data-prefecture="Ê≤ñÁ∏ÑÁúå" onclick="togglePrefecture('Ê≤ñÁ∏ÑÁúå')">
                    Ê≤ñÁ∏ÑÁúå
                </button>
            </div>
                            </div>

                            <!-- STEP 2: Â∏ÇÂå∫Áî∫Êùë„ÇíÈÅ∏Êäû -->
                            <div id="citySelectionArea" class="mb-6">
                                <h4 class="text-md font-medium mb-3">STEP 2: Â∏ÇÂå∫Áî∫Êùë„ÇíÈÅ∏Êäû</h4>
                                <div id="cityListContainer" class="space-y-4">
                    <div class="border rounded-lg p-4">
                        <div class="mb-3">
                            <div class="flex justify-between items-center mb-2">
                                <h5 class="font-medium text-lg">Êù±‰∫¨ÈÉΩ</h5>
                                <span class="text-sm text-gray-600">
                                    0 / 53 ÈÅ∏Êäû‰∏≠
                                </span>
                            </div>
                            <label class="flex items-center cursor-pointer hover:bg-gray-50 p-1 rounded">
                                <input type="checkbox" onchange="toggleAllCities('Êù±‰∫¨ÈÉΩ', this.checked)">
                                <span class="ml-2 text-sm font-medium">„Åô„Åπ„Å¶ÈÅ∏Êäû</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂçÉ‰ª£Áî∞Âå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'ÂçÉ‰ª£Áî∞Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">ÂçÉ‰ª£Áî∞Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="‰∏≠Â§ÆÂå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', '‰∏≠Â§ÆÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">‰∏≠Â§ÆÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê∏ØÂå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Ê∏ØÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê∏ØÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Êñ∞ÂÆøÂå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Êñ∞ÂÆøÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Êñ∞ÂÆøÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Êñá‰∫¨Âå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Êñá‰∫¨Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Êñá‰∫¨Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Âè∞Êù±Âå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Âè∞Êù±Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Âè∞Êù±Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â¢®Áî∞Âå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Â¢®Áî∞Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Â¢®Áî∞Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê±üÊù±Âå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Ê±üÊù±Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê±üÊù±Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂìÅÂ∑ùÂå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'ÂìÅÂ∑ùÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">ÂìÅÂ∑ùÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÁõÆÈªíÂå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'ÁõÆÈªíÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">ÁõÆÈªíÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â§ßÁî∞Âå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Â§ßÁî∞Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Â§ßÁî∞Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="‰∏ñÁî∞Ë∞∑Âå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', '‰∏ñÁî∞Ë∞∑Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">‰∏ñÁî∞Ë∞∑Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê∏ãË∞∑Âå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Ê∏ãË∞∑Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê∏ãË∞∑Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="‰∏≠ÈáéÂå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', '‰∏≠ÈáéÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">‰∏≠ÈáéÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Êùâ‰∏¶Âå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Êùâ‰∏¶Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Êùâ‰∏¶Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ë±äÂ≥∂Âå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Ë±äÂ≥∂Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ë±äÂ≥∂Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂåóÂå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'ÂåóÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">ÂåóÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ËçíÂ∑ùÂå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'ËçíÂ∑ùÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">ËçíÂ∑ùÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÊùøÊ©ãÂå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'ÊùøÊ©ãÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">ÊùøÊ©ãÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Á∑¥È¶¨Âå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Á∑¥È¶¨Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Á∑¥È¶¨Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ë∂≥Á´ãÂå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Ë∂≥Á´ãÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ë∂≥Á´ãÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ËëõÈ£æÂå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'ËëõÈ£æÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">ËëõÈ£æÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê±üÊà∏Â∑ùÂå∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Ê±üÊà∏Â∑ùÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê±üÊà∏Â∑ùÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂÖ´ÁéãÂ≠êÂ∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'ÂÖ´ÁéãÂ≠êÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÂÖ´ÁéãÂ≠êÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Á´ãÂ∑ùÂ∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Á´ãÂ∑ùÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Á´ãÂ∑ùÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê≠¶ËîµÈáéÂ∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Ê≠¶ËîµÈáéÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ê≠¶ËîµÈáéÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="‰∏âÈ∑πÂ∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', '‰∏âÈ∑πÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">‰∏âÈ∑πÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÈùíÊ¢ÖÂ∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'ÈùíÊ¢ÖÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÈùíÊ¢ÖÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â∫ú‰∏≠Â∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Â∫ú‰∏≠Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Â∫ú‰∏≠Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Êò≠Â≥∂Â∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Êò≠Â≥∂Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Êò≠Â≥∂Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ë™øÂ∏ÉÂ∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Ë™øÂ∏ÉÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ë™øÂ∏ÉÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Áî∫Áî∞Â∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Áî∫Áî∞Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Áî∫Áî∞Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â∞èÈáë‰∫ïÂ∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Â∞èÈáë‰∫ïÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Â∞èÈáë‰∫ïÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â∞èÂπ≥Â∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Â∞èÂπ≥Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Â∞èÂπ≥Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Êó•ÈáéÂ∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Êó•ÈáéÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Êó•ÈáéÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Êù±ÊùëÂ±±Â∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Êù±ÊùëÂ±±Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Êù±ÊùëÂ±±Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂõΩÂàÜÂØ∫Â∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'ÂõΩÂàÜÂØ∫Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÂõΩÂàÜÂØ∫Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂõΩÁ´ãÂ∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'ÂõΩÁ´ãÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÂõΩÁ´ãÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Á¶èÁîüÂ∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Á¶èÁîüÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Á¶èÁîüÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÁãõÊ±üÂ∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'ÁãõÊ±üÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÁãõÊ±üÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Êù±Â§ßÂíåÂ∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Êù±Â§ßÂíåÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Êù±Â§ßÂíåÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê∏ÖÁÄ¨Â∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Ê∏ÖÁÄ¨Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ê∏ÖÁÄ¨Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Êù±‰πÖÁïôÁ±≥Â∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Êù±‰πÖÁïôÁ±≥Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Êù±‰πÖÁïôÁ±≥Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê≠¶ËîµÊùëÂ±±Â∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Ê≠¶ËîµÊùëÂ±±Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ê≠¶ËîµÊùëÂ±±Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â§öÊë©Â∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Â§öÊë©Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Â§öÊë©Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Á®≤ÂüéÂ∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Á®≤ÂüéÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Á®≤ÂüéÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÁæΩÊùëÂ∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'ÁæΩÊùëÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÁæΩÊùëÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="„ÅÇ„Åç„ÇãÈáéÂ∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', '„ÅÇ„Åç„ÇãÈáéÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">„ÅÇ„Åç„ÇãÈáéÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ë•øÊù±‰∫¨Â∏Ç" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Ë•øÊù±‰∫¨Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ë•øÊù±‰∫¨Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÁëûÁ©ÇÁî∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'ÁëûÁ©ÇÁî∫', this.checked)">
                                    <span class="ml-2 text-sm">ÁëûÁ©ÇÁî∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Êó•„ÅÆÂá∫Áî∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Êó•„ÅÆÂá∫Áî∫', this.checked)">
                                    <span class="ml-2 text-sm">Êó•„ÅÆÂá∫Áî∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê™úÂéüÊùë" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Ê™úÂéüÊùë', this.checked)">
                                    <span class="ml-2 text-sm">Ê™úÂéüÊùë</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â••Â§öÊë©Áî∫" onchange="toggleCity('Êù±‰∫¨ÈÉΩ', 'Â••Â§öÊë©Áî∫', this.checked)">
                                    <span class="ml-2 text-sm">Â••Â§öÊë©Áî∫</span>
                                </label>
                            
                        </div>
                    </div>
                
                    <div class="border rounded-lg p-4">
                        <div class="mb-3">
                            <div class="flex justify-between items-center mb-2">
                                <h5 class="font-medium text-lg">ÂüºÁéâÁúå</h5>
                                <span class="text-sm text-gray-600">
                                    0 / 49 ÈÅ∏Êäû‰∏≠
                                </span>
                            </div>
                            <label class="flex items-center cursor-pointer hover:bg-gray-50 p-1 rounded">
                                <input type="checkbox" onchange="toggleAllCities('ÂüºÁéâÁúå', this.checked)">
                                <span class="ml-2 text-sm font-medium">„Åô„Åπ„Å¶ÈÅ∏Êäû</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="„Åï„ÅÑ„Åü„ÅæÂ∏ÇË•øÂå∫" onchange="toggleCity('ÂüºÁéâÁúå', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇË•øÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">„Åï„ÅÑ„Åü„ÅæÂ∏ÇË•øÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂåóÂå∫" onchange="toggleCity('ÂüºÁéâÁúå', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂåóÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂåóÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂ§ßÂÆÆÂå∫" onchange="toggleCity('ÂüºÁéâÁúå', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂ§ßÂÆÆÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂ§ßÂÆÆÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="„Åï„ÅÑ„Åü„ÅæÂ∏ÇË¶ãÊ≤ºÂå∫" onchange="toggleCity('ÂüºÁéâÁúå', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇË¶ãÊ≤ºÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">„Åï„ÅÑ„Åü„ÅæÂ∏ÇË¶ãÊ≤ºÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="„Åï„ÅÑ„Åü„ÅæÂ∏Ç‰∏≠Â§ÆÂå∫" onchange="toggleCity('ÂüºÁéâÁúå', '„Åï„ÅÑ„Åü„ÅæÂ∏Ç‰∏≠Â§ÆÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">„Åï„ÅÑ„Åü„ÅæÂ∏Ç‰∏≠Â§ÆÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="„Åï„ÅÑ„Åü„ÅæÂ∏ÇÊ°úÂå∫" onchange="toggleCity('ÂüºÁéâÁúå', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÊ°úÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">„Åï„ÅÑ„Åü„ÅæÂ∏ÇÊ°úÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="„Åï„ÅÑ„Åü„ÅæÂ∏ÇÊµ¶ÂíåÂå∫" onchange="toggleCity('ÂüºÁéâÁúå', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÊµ¶ÂíåÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">„Åï„ÅÑ„Åü„ÅæÂ∏ÇÊµ¶ÂíåÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂçóÂå∫" onchange="toggleCity('ÂüºÁéâÁúå', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂçóÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂçóÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="„Åï„ÅÑ„Åü„ÅæÂ∏ÇÁ∑ëÂå∫" onchange="toggleCity('ÂüºÁéâÁúå', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÁ∑ëÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">„Åï„ÅÑ„Åü„ÅæÂ∏ÇÁ∑ëÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂ≤©ÊßªÂå∫" onchange="toggleCity('ÂüºÁéâÁúå', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂ≤©ÊßªÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂ≤©ÊßªÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â∑ùË∂äÂ∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'Â∑ùË∂äÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Â∑ùË∂äÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÁÜäË∞∑Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'ÁÜäË∞∑Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÁÜäË∞∑Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â∑ùÂè£Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'Â∑ùÂè£Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Â∑ùÂè£Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ë°åÁî∞Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'Ë°åÁî∞Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ë°åÁî∞Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Áß©Áà∂Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'Áß©Áà∂Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Áß©Áà∂Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÊâÄÊ≤¢Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'ÊâÄÊ≤¢Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÊâÄÊ≤¢Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="È£ØËÉΩÂ∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'È£ØËÉΩÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">È£ØËÉΩÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Âä†È†àÂ∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'Âä†È†àÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Âä†È†àÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Êú¨Â∫ÑÂ∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'Êú¨Â∫ÑÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Êú¨Â∫ÑÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Êù±ÊùæÂ±±Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'Êù±ÊùæÂ±±Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Êù±ÊùæÂ±±Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Êò•Êó•ÈÉ®Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'Êò•Êó•ÈÉ®Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Êò•Êó•ÈÉ®Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Áã≠Â±±Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'Áã≠Â±±Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Áã≠Â±±Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÁæΩÁîüÂ∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'ÁæΩÁîüÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÁæΩÁîüÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="È¥ªÂ∑£Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'È¥ªÂ∑£Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">È¥ªÂ∑£Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê∑±Ë∞∑Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'Ê∑±Ë∞∑Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ê∑±Ë∞∑Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="‰∏äÂ∞æÂ∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', '‰∏äÂ∞æÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">‰∏äÂ∞æÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ËçâÂä†Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'ËçâÂä†Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ËçâÂä†Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ë∂äË∞∑Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'Ë∂äË∞∑Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ë∂äË∞∑Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ëï®Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'Ëï®Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ëï®Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Êà∏Áî∞Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'Êà∏Áî∞Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Êà∏Áî∞Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂÖ•ÈñìÂ∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'ÂÖ•ÈñìÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÂÖ•ÈñìÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÊúùÈúûÂ∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'ÊúùÈúûÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÊúùÈúûÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂøóÊú®Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'ÂøóÊú®Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÂøóÊú®Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂíåÂÖâÂ∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'ÂíåÂÖâÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÂíåÂÖâÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Êñ∞Â∫ßÂ∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'Êñ∞Â∫ßÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Êñ∞Â∫ßÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê°∂Â∑ùÂ∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'Ê°∂Â∑ùÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ê°∂Â∑ùÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="‰πÖÂñúÂ∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', '‰πÖÂñúÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">‰πÖÂñúÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂåóÊú¨Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'ÂåóÊú¨Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÂåóÊú¨Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂÖ´ÊΩÆÂ∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'ÂÖ´ÊΩÆÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÂÖ´ÊΩÆÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂØåÂ£´Ë¶ãÂ∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'ÂØåÂ£´Ë¶ãÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÂØåÂ£´Ë¶ãÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="‰∏âÈÉ∑Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', '‰∏âÈÉ∑Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">‰∏âÈÉ∑Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ËìÆÁî∞Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'ËìÆÁî∞Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ËìÆÁî∞Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂùÇÊà∏Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'ÂùÇÊà∏Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÂùÇÊà∏Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Âπ∏ÊâãÂ∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'Âπ∏ÊâãÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Âπ∏ÊâãÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="È∂¥„É∂Â≥∂Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'È∂¥„É∂Â≥∂Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">È∂¥„É∂Â≥∂Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Êó•È´òÂ∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'Êó•È´òÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Êó•È´òÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂêâÂ∑ùÂ∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'ÂêâÂ∑ùÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÂêâÂ∑ùÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="„Åµ„Åò„ÅøÈáéÂ∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', '„Åµ„Åò„ÅøÈáéÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">„Åµ„Åò„ÅøÈáéÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÁôΩÂ≤°Â∏Ç" onchange="toggleCity('ÂüºÁéâÁúå', 'ÁôΩÂ≤°Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÁôΩÂ≤°Â∏Ç</span>
                                </label>
                            
                        </div>
                    </div>
                
                    <div class="border rounded-lg p-4">
                        <div class="mb-3">
                            <div class="flex justify-between items-center mb-2">
                                <h5 class="font-medium text-lg">Á•ûÂ•àÂ∑ùÁúå</h5>
                                <span class="text-sm text-gray-600">
                                    0 / 44 ÈÅ∏Êäû‰∏≠
                                </span>
                            </div>
                            <label class="flex items-center cursor-pointer hover:bg-gray-50 p-1 rounded">
                                <input type="checkbox" onchange="toggleAllCities('Á•ûÂ•àÂ∑ùÁúå', this.checked)">
                                <span class="ml-2 text-sm font-medium">„Åô„Åπ„Å¶ÈÅ∏Êäû</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™ÊµúÂ∏ÇÈ∂¥Ë¶ãÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™ÊµúÂ∏ÇÈ∂¥Ë¶ãÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™ÊµúÂ∏ÇÈ∂¥Ë¶ãÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™ÊµúÂ∏ÇÁ•ûÂ•àÂ∑ùÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™ÊµúÂ∏ÇÁ•ûÂ•àÂ∑ùÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™ÊµúÂ∏ÇÁ•ûÂ•àÂ∑ùÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™ÊµúÂ∏ÇË•øÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™ÊµúÂ∏ÇË•øÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™ÊµúÂ∏ÇË•øÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™ÊµúÂ∏Ç‰∏≠Âå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™ÊµúÂ∏Ç‰∏≠Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™ÊµúÂ∏Ç‰∏≠Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™ÊµúÂ∏ÇÂçóÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™ÊµúÂ∏ÇÂçóÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™ÊµúÂ∏ÇÂçóÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™ÊµúÂ∏Ç‰øùÂúü„Ç±Ë∞∑Âå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™ÊµúÂ∏Ç‰øùÂúü„Ç±Ë∞∑Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™ÊµúÂ∏Ç‰øùÂúü„Ç±Ë∞∑Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™ÊµúÂ∏ÇÁ£ØÂ≠êÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™ÊµúÂ∏ÇÁ£ØÂ≠êÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™ÊµúÂ∏ÇÁ£ØÂ≠êÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™ÊµúÂ∏ÇÈáëÊ≤¢Âå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™ÊµúÂ∏ÇÈáëÊ≤¢Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™ÊµúÂ∏ÇÈáëÊ≤¢Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™ÊµúÂ∏ÇÊ∏ØÂåóÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™ÊµúÂ∏ÇÊ∏ØÂåóÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™ÊµúÂ∏ÇÊ∏ØÂåóÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™ÊµúÂ∏ÇÊà∏Â°öÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™ÊµúÂ∏ÇÊà∏Â°öÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™ÊµúÂ∏ÇÊà∏Â°öÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™ÊµúÂ∏ÇÊ∏ØÂçóÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™ÊµúÂ∏ÇÊ∏ØÂçóÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™ÊµúÂ∏ÇÊ∏ØÂçóÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™ÊµúÂ∏ÇÊó≠Âå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™ÊµúÂ∏ÇÊó≠Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™ÊµúÂ∏ÇÊó≠Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™ÊµúÂ∏ÇÁ∑ëÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™ÊµúÂ∏ÇÁ∑ëÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™ÊµúÂ∏ÇÁ∑ëÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™ÊµúÂ∏ÇÁÄ¨Ë∞∑Âå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™ÊµúÂ∏ÇÁÄ¨Ë∞∑Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™ÊµúÂ∏ÇÁÄ¨Ë∞∑Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™ÊµúÂ∏ÇÊ†ÑÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™ÊµúÂ∏ÇÊ†ÑÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™ÊµúÂ∏ÇÊ†ÑÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™ÊµúÂ∏ÇÊ≥âÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™ÊµúÂ∏ÇÊ≥âÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™ÊµúÂ∏ÇÊ≥âÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™ÊµúÂ∏ÇÈùíËëâÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™ÊµúÂ∏ÇÈùíËëâÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™ÊµúÂ∏ÇÈùíËëâÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™ÊµúÂ∏ÇÈÉΩÁ≠ëÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™ÊµúÂ∏ÇÈÉΩÁ≠ëÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™ÊµúÂ∏ÇÈÉΩÁ≠ëÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â∑ùÂ¥éÂ∏ÇÂ∑ùÂ¥éÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Â∑ùÂ¥éÂ∏ÇÂ∑ùÂ¥éÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Â∑ùÂ¥éÂ∏ÇÂ∑ùÂ¥éÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â∑ùÂ¥éÂ∏ÇÂπ∏Âå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Â∑ùÂ¥éÂ∏ÇÂπ∏Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Â∑ùÂ¥éÂ∏ÇÂπ∏Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â∑ùÂ¥éÂ∏Ç‰∏≠ÂéüÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Â∑ùÂ¥éÂ∏Ç‰∏≠ÂéüÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Â∑ùÂ¥éÂ∏Ç‰∏≠ÂéüÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â∑ùÂ¥éÂ∏ÇÈ´òÊ¥•Âå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Â∑ùÂ¥éÂ∏ÇÈ´òÊ¥•Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Â∑ùÂ¥éÂ∏ÇÈ´òÊ¥•Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â∑ùÂ¥éÂ∏ÇÂ§öÊë©Âå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Â∑ùÂ¥éÂ∏ÇÂ§öÊë©Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Â∑ùÂ¥éÂ∏ÇÂ§öÊë©Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â∑ùÂ¥éÂ∏ÇÂÆÆÂâçÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Â∑ùÂ¥éÂ∏ÇÂÆÆÂâçÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Â∑ùÂ¥éÂ∏ÇÂÆÆÂâçÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â∑ùÂ¥éÂ∏ÇÈ∫ªÁîüÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Â∑ùÂ¥éÂ∏ÇÈ∫ªÁîüÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Â∑ùÂ¥éÂ∏ÇÈ∫ªÁîüÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Áõ∏Ê®°ÂéüÂ∏ÇÁ∑ëÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Áõ∏Ê®°ÂéüÂ∏ÇÁ∑ëÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Áõ∏Ê®°ÂéüÂ∏ÇÁ∑ëÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Áõ∏Ê®°ÂéüÂ∏Ç‰∏≠Â§ÆÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Áõ∏Ê®°ÂéüÂ∏Ç‰∏≠Â§ÆÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Áõ∏Ê®°ÂéüÂ∏Ç‰∏≠Â§ÆÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Áõ∏Ê®°ÂéüÂ∏ÇÂçóÂå∫" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Áõ∏Ê®°ÂéüÂ∏ÇÂçóÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Áõ∏Ê®°ÂéüÂ∏ÇÂçóÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê®™È†àË≥ÄÂ∏Ç" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ê®™È†àË≥ÄÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ê®™È†àË≥ÄÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Âπ≥Â°öÂ∏Ç" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Âπ≥Â°öÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Âπ≥Â°öÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÈéåÂÄâÂ∏Ç" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'ÈéåÂÄâÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÈéåÂÄâÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ëó§Ê≤¢Â∏Ç" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Ëó§Ê≤¢Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ëó§Ê≤¢Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â∞èÁî∞ÂéüÂ∏Ç" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Â∞èÁî∞ÂéüÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Â∞èÁî∞ÂéüÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ËåÖ„É∂Â¥éÂ∏Ç" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'ËåÖ„É∂Â¥éÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ËåÖ„É∂Â¥éÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÈÄóÂ≠êÂ∏Ç" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'ÈÄóÂ≠êÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÈÄóÂ≠êÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="‰∏âÊµ¶Â∏Ç" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', '‰∏âÊµ¶Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">‰∏âÊµ¶Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Áß¶ÈáéÂ∏Ç" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Áß¶ÈáéÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Áß¶ÈáéÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂéöÊú®Â∏Ç" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'ÂéöÊú®Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÂéöÊú®Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â§ßÂíåÂ∏Ç" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Â§ßÂíåÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Â§ßÂíåÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="‰ºäÂã¢ÂéüÂ∏Ç" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', '‰ºäÂã¢ÂéüÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">‰ºäÂã¢ÂéüÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Êµ∑ËÄÅÂêçÂ∏Ç" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Êµ∑ËÄÅÂêçÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Êµ∑ËÄÅÂêçÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â∫ßÈñìÂ∏Ç" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Â∫ßÈñìÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Â∫ßÈñìÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂçóË∂≥ÊüÑÂ∏Ç" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'ÂçóË∂≥ÊüÑÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÂçóË∂≥ÊüÑÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Á∂æÁÄ¨Â∏Ç" onchange="toggleCity('Á•ûÂ•àÂ∑ùÁúå', 'Á∂æÁÄ¨Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Á∂æÁÄ¨Â∏Ç</span>
                                </label>
                            
                        </div>
                    </div>
                
                    <div class="border rounded-lg p-4">
                        <div class="mb-3">
                            <div class="flex justify-between items-center mb-2">
                                <h5 class="font-medium text-lg">Â•àËâØÁúå</h5>
                                <span class="text-sm text-gray-600">
                                    0 / 12 ÈÅ∏Êäû‰∏≠
                                </span>
                            </div>
                            <label class="flex items-center cursor-pointer hover:bg-gray-50 p-1 rounded">
                                <input type="checkbox" onchange="toggleAllCities('Â•àËâØÁúå', this.checked)">
                                <span class="ml-2 text-sm font-medium">„Åô„Åπ„Å¶ÈÅ∏Êäû</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â•àËâØÂ∏Ç" onchange="toggleCity('Â•àËâØÁúå', 'Â•àËâØÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Â•àËâØÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â§ßÂíåÈ´òÁî∞Â∏Ç" onchange="toggleCity('Â•àËâØÁúå', 'Â§ßÂíåÈ´òÁî∞Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Â§ßÂíåÈ´òÁî∞Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â§ßÂíåÈÉ°Â±±Â∏Ç" onchange="toggleCity('Â•àËâØÁúå', 'Â§ßÂíåÈÉ°Â±±Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Â§ßÂíåÈÉ°Â±±Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â§©ÁêÜÂ∏Ç" onchange="toggleCity('Â•àËâØÁúå', 'Â§©ÁêÜÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Â§©ÁêÜÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê©øÂéüÂ∏Ç" onchange="toggleCity('Â•àËâØÁúå', 'Ê©øÂéüÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ê©øÂéüÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê°ú‰∫ïÂ∏Ç" onchange="toggleCity('Â•àËâØÁúå', 'Ê°ú‰∫ïÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ê°ú‰∫ïÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="‰∫îÊ¢ùÂ∏Ç" onchange="toggleCity('Â•àËâØÁúå', '‰∫îÊ¢ùÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">‰∫îÊ¢ùÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Âæ°ÊâÄÂ∏Ç" onchange="toggleCity('Â•àËâØÁúå', 'Âæ°ÊâÄÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Âæ°ÊâÄÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÁîüÈßíÂ∏Ç" onchange="toggleCity('Â•àËâØÁúå', 'ÁîüÈßíÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÁîüÈßíÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="È¶ôËäùÂ∏Ç" onchange="toggleCity('Â•àËâØÁúå', 'È¶ôËäùÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">È¶ôËäùÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ËëõÂüéÂ∏Ç" onchange="toggleCity('Â•àËâØÁúå', 'ËëõÂüéÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ËëõÂüéÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂÆáÈôÄÂ∏Ç" onchange="toggleCity('Â•àËâØÁúå', 'ÂÆáÈôÄÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÂÆáÈôÄÂ∏Ç</span>
                                </label>
                            
                        </div>
                    </div>
                
                    <div class="border rounded-lg p-4">
                        <div class="mb-3">
                            <div class="flex justify-between items-center mb-2">
                                <h5 class="font-medium text-lg">ÂÖµÂ∫´Áúå</h5>
                                <span class="text-sm text-gray-600">
                                    0 / 37 ÈÅ∏Êäû‰∏≠
                                </span>
                            </div>
                            <label class="flex items-center cursor-pointer hover:bg-gray-50 p-1 rounded">
                                <input type="checkbox" onchange="toggleAllCities('ÂÖµÂ∫´Áúå', this.checked)">
                                <span class="ml-2 text-sm font-medium">„Åô„Åπ„Å¶ÈÅ∏Êäû</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Á•ûÊà∏Â∏ÇÊù±ÁÅòÂå∫" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Á•ûÊà∏Â∏ÇÊù±ÁÅòÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Á•ûÊà∏Â∏ÇÊù±ÁÅòÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Á•ûÊà∏Â∏ÇÁÅòÂå∫" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Á•ûÊà∏Â∏ÇÁÅòÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Á•ûÊà∏Â∏ÇÁÅòÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Á•ûÊà∏Â∏ÇÂÖµÂ∫´Âå∫" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Á•ûÊà∏Â∏ÇÂÖµÂ∫´Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Á•ûÊà∏Â∏ÇÂÖµÂ∫´Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Á•ûÊà∏Â∏ÇÈï∑Áî∞Âå∫" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Á•ûÊà∏Â∏ÇÈï∑Áî∞Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Á•ûÊà∏Â∏ÇÈï∑Áî∞Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Á•ûÊà∏Â∏ÇÈ†àÁ£®Âå∫" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Á•ûÊà∏Â∏ÇÈ†àÁ£®Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Á•ûÊà∏Â∏ÇÈ†àÁ£®Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Á•ûÊà∏Â∏ÇÂûÇÊ∞¥Âå∫" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Á•ûÊà∏Â∏ÇÂûÇÊ∞¥Âå∫', this.checked)">
                                    <span class="ml-2 text-sm">Á•ûÊà∏Â∏ÇÂûÇÊ∞¥Âå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Á•ûÊà∏Â∏ÇÂåóÂå∫" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Á•ûÊà∏Â∏ÇÂåóÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Á•ûÊà∏Â∏ÇÂåóÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Á•ûÊà∏Â∏Ç‰∏≠Â§ÆÂå∫" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Á•ûÊà∏Â∏Ç‰∏≠Â§ÆÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Á•ûÊà∏Â∏Ç‰∏≠Â§ÆÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Á•ûÊà∏Â∏ÇË•øÂå∫" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Á•ûÊà∏Â∏ÇË•øÂå∫', this.checked)">
                                    <span class="ml-2 text-sm">Á•ûÊà∏Â∏ÇË•øÂå∫</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Âß´Ë∑ØÂ∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Âß´Ë∑ØÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Âß´Ë∑ØÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â∞ºÂ¥éÂ∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Â∞ºÂ¥éÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Â∞ºÂ¥éÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÊòéÁü≥Â∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'ÊòéÁü≥Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÊòéÁü≥Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ë•øÂÆÆÂ∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Ë•øÂÆÆÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ë•øÂÆÆÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê¥≤Êú¨Â∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Ê¥≤Êú¨Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ê¥≤Êú¨Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ëä¶Â±ãÂ∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Ëä¶Â±ãÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ëä¶Â±ãÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="‰ºä‰∏πÂ∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', '‰ºä‰∏πÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">‰ºä‰∏πÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Áõ∏ÁîüÂ∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Áõ∏ÁîüÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Áõ∏ÁîüÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ë±äÂ≤°Â∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Ë±äÂ≤°Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ë±äÂ≤°Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Âä†Âè§Â∑ùÂ∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Âä†Âè§Â∑ùÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Âä†Âè§Â∑ùÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ëµ§Á©ÇÂ∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Ëµ§Á©ÇÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ëµ§Á©ÇÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ë•øËÑáÂ∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Ë•øËÑáÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ë•øËÑáÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂÆùÂ°öÂ∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'ÂÆùÂ°öÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÂÆùÂ°öÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="‰∏âÊú®Â∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', '‰∏âÊú®Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">‰∏âÊú®Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="È´òÁ†ÇÂ∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'È´òÁ†ÇÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">È´òÁ†ÇÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â∑ùË•øÂ∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Â∑ùË•øÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Â∑ùË•øÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Â∞èÈáéÂ∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Â∞èÈáéÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Â∞èÈáéÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="‰∏âÁî∞Â∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', '‰∏âÁî∞Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">‰∏âÁî∞Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Âä†Ë•øÂ∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Âä†Ë•øÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Âä†Ë•øÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="‰∏πÊ≥¢ÁØ†Â±±Â∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', '‰∏πÊ≥¢ÁØ†Â±±Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">‰∏πÊ≥¢ÁØ†Â±±Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="È§äÁà∂Â∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'È§äÁà∂Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">È§äÁà∂Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="‰∏πÊ≥¢Â∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', '‰∏πÊ≥¢Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">‰∏πÊ≥¢Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Âçó„ÅÇ„Çè„ÅòÂ∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Âçó„ÅÇ„Çè„ÅòÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Âçó„ÅÇ„Çè„ÅòÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÊúùÊù•Â∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'ÊúùÊù•Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÊúùÊù•Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Ê∑°Ë∑ØÂ∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Ê∑°Ë∑ØÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Ê∑°Ë∑ØÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="ÂÆçÁ≤üÂ∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'ÂÆçÁ≤üÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">ÂÆçÁ≤üÂ∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="Âä†Êù±Â∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', 'Âä†Êù±Â∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">Âä†Êù±Â∏Ç</span>
                                </label>
                            
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="„Åü„Å§„ÅÆÂ∏Ç" onchange="toggleCity('ÂÖµÂ∫´Áúå', '„Åü„Å§„ÅÆÂ∏Ç', this.checked)">
                                    <span class="ml-2 text-sm">„Åü„Å§„ÅÆÂ∏Ç</span>
                                </label>
                            
                        </div>
                    </div>
                </div>
                            </div>

                            <!-- STEP 3: ÂÑ™ÂÖà„Ç®„É™„Ç¢„ÇíË®≠ÂÆö -->
                            <div id="priorityArea" class="hidden mb-6">
                                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 sm:p-6">
                                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-3 gap-2">
                                        <h4 class="font-semibold text-sm sm:text-lg leading-tight">
                                            STEP 3: ÂÑ™ÂÖà„Ç®„É™„Ç¢„ÇíË®≠ÂÆö
                                            <span class="block sm:inline sm:ml-1 text-xs sm:text-base font-normal text-gray-600">
                                                ÔºàÊúÄÂ§ß3„Ç®„É™„Ç¢Ôºâ
                                            </span>
                                        </h4>
                                        <span class="text-orange-500 font-semibold text-base sm:text-lg">
                                            <span id="selectedPriorityCount">2</span> / 3 ÈÅ∏Êäû‰∏≠
                                        </span>
                                    </div>
                                    <p class="text-xs sm:text-sm text-gray-600 mb-3 sm:mb-4">Áâπ„Å´Ê≥®Âäõ„Åó„Åü„ÅÑ„Ç®„É™„Ç¢„ÇíÊúÄÂ§ß3„Å§„Åæ„ÅßÈÅ∏Êäû„Åß„Åç„Åæ„Åô</p>
                                    <div id="prioritySelectionList" class="space-y-3 sm:space-y-4">
                                        <!-- ÂÑ™ÂÖà„Ç®„É™„Ç¢ÈÅ∏Êäû„É™„Çπ„Éà„Åå„Åì„Åì„Å´ÁîüÊàê„Åï„Çå„ÇãÔºàÁúå„Åî„Å®„Å´„Ç´„Éº„ÉâÂΩ¢ÂºèÔºâ -->
                                    </div>
                                </div>
                            </div>

                            <!-- „Ç®„É™„Ç¢ÈÅ∏ÊäûÂÆå‰∫Ü„Éú„Çø„É≥„Çª„ÇØ„Ç∑„Éß„É≥ÂâäÈô§ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‰ºöÁ§æÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="companySection" class="section" style="display: none;">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">‰ºöÁ§æÊÉÖÂ†±</h2>
                        <p class="text-sm text-gray-600 mt-1">ÂÆüÈöõ„Å´„ÅäÂÆ¢Êßò„Å´Ë°®Á§∫„Åï„Çå„ÇãË©≥Á¥∞ÊÉÖÂ†±„Å´„Å™„Çä„Åæ„Åô</p>
                    </div>
                    <button onclick="previewCompanyInfo()" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                        „Éó„É¨„Éì„É•„Éº
                    </button>
                </div>
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>

                    <!-- „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´Ë®≠ÂÆö -->
                    <div id="mainVisualSection" class="group mb-8 border-2 border-gray-300 rounded-lg p-6 bg-white transition-all duration-300 hover:bg-blue-50">
                        <div class="flex justify-between items-center mb-4 section-header">
                            <h3 class="text-lg font-semibold text-gray-900">„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´</h3>
                            <div class="flex gap-2">
                                <button id="editMainVisualBtn" onclick="toggleEditMode('mainVisual', true)" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg flex items-center gap-2 font-medium group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300">
                                    üõ†Ô∏è Á∑®ÈõÜ
                                </button>
                                <button id="saveMainVisualBtn" onclick="saveSection('mainVisual')" class="hidden px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 font-medium shadow-md">
                                    üíæ ‰øùÂ≠ò
                                </button>
                                <button id="cancelMainVisualBtn" onclick="cancelEditMode('mainVisual')" class="hidden px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 flex items-center gap-2 font-medium">
                                    ‚úó „Ç≠„É£„É≥„Çª„É´
                                </button>
                            </div>
                        </div>

                        <!-- Èñ≤Ë¶ß„É¢„Éº„Éâ -->
                        <div id="mainVisualView">
                            <div id="mainVisualPreviewView" class="text-center">
                                <img id="mainVisualImageView" src="" alt="„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´" class="max-w-full h-48 mx-auto object-cover rounded hidden">
                                <div id="mainVisualPlaceholderView" class="text-sm text-gray-500">„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´ÁîªÂÉè„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</div>
                            </div>
                        </div>

                        <!-- Á∑®ÈõÜ„É¢„Éº„Éâ -->
                        <div id="mainVisualEdit" class="hidden">
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center relative" id="mainVisualUploadArea">
                            <input type="file" id="mainVisualInput" class="hidden" accept="image/*" onchange="handleMainVisualUpload(event)">
                            <div id="mainVisualPreview" class="hidden">
                                <img id="mainVisualImage" src="" alt="„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´" class="max-w-full h-48 mx-auto object-cover rounded">
                                <button onclick="removeMainVisual()" class="mt-2 px-4 py-2 text-red-600 hover:text-red-800 border border-red-300 rounded">ÂâäÈô§</button>
                            </div>
                            <div id="mainVisualPlaceholder" class="">
                                <svg class="mx-auto h-12 w-12 text-gray-400 mb-3" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                                <p class="text-sm text-gray-600 mb-2">„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´ÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ</p>
                                <button onclick="document.getElementById('mainVisualInput').click()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                                    ÁîªÂÉè„ÇíÈÅ∏Êäû
                                </button>
                                <p class="text-xs text-gray-500 mt-2">Êé®Â•®: 1920x600px ‰ª•‰∏ä</p>
                            </div>
                        </div>
                        </div>
                    </div>

                    <!-- ÊñΩÂ∑•‰∫ã‰æã -->
                    <div id="constructionExamplesSection" class="group mb-8 border-2 border-gray-300 rounded-lg p-6 bg-white transition-all duration-300 hover:bg-blue-50">
                        <div class="flex justify-between items-center mb-4 section-header">
                            <h3 class="text-lg font-semibold text-gray-900">ÊñΩÂ∑•‰∫ã‰æã</h3>
                            <div class="flex gap-2">
                                <button id="editConstructionExamplesBtn" onclick="toggleEditMode('constructionExamples', true)" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg flex items-center gap-2 font-medium group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300">
                                    üõ†Ô∏è Á∑®ÈõÜ
                                </button>
                                <button id="saveConstructionExamplesBtn" onclick="saveSection('constructionExamples')" class="hidden px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 font-medium shadow-md">
                                    üíæ ‰øùÂ≠ò
                                </button>
                                <button id="cancelConstructionExamplesBtn" onclick="cancelEditMode('constructionExamples')" class="hidden px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 flex items-center gap-2 font-medium">
                                    ‚úó „Ç≠„É£„É≥„Çª„É´
                                </button>
                            </div>
                        </div>

                        <!-- Èñ≤Ë¶ß„É¢„Éº„Éâ -->
                        <div id="constructionExamplesView">
                            <div id="constructionExamplesListView" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="text-sm text-gray-500">ÊñΩÂ∑•‰∫ã‰æã„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>
                            </div>
                        </div>

                        <!-- Á∑®ÈõÜ„É¢„Éº„Éâ -->
                        <div id="constructionExamplesEdit" class="hidden">
                            <button onclick="addConstructionExample()" class="mb-4 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">
                                ÊñΩÂ∑•‰∫ã‰æã„ÇíËøΩÂä†
                            </button>
                            <div id="constructionExamplesList" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- ÊñΩÂ∑•‰∫ã‰æã„ÅåÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Çã -->
                            </div>
                        </div>
                    </div>

                    <!-- ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº -->
                    <div id="photoGallerySection" class="group mb-8 border-2 border-gray-300 rounded-lg p-6 bg-white transition-all duration-300 hover:bg-blue-50">
                        <div class="flex justify-between items-center mb-4 section-header">
                            <h3 class="text-lg font-semibold text-gray-900">ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº</h3>
                            <div class="flex gap-2">
                                <button id="editPhotoGalleryBtn" onclick="toggleEditMode('photoGallery', true)" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg flex items-center gap-2 font-medium group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300">
                                    üõ†Ô∏è Á∑®ÈõÜ
                                </button>
                                <button id="savePhotoGalleryBtn" onclick="saveSection('photoGallery')" class="hidden px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 font-medium shadow-md">
                                    üíæ ‰øùÂ≠ò
                                </button>
                                <button id="cancelPhotoGalleryBtn" onclick="cancelEditMode('photoGallery')" class="hidden px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 flex items-center gap-2 font-medium">
                                    ‚úó „Ç≠„É£„É≥„Çª„É´
                                </button>
                            </div>
                        </div>

                        <!-- Èñ≤Ë¶ß„É¢„Éº„Éâ -->
                        <div id="photoGalleryView" class="hidden">
                            <div id="photoGalleryListView" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div class="text-sm text-gray-500">ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>
                            </div>
                        </div>

                        <!-- Á∑®ÈõÜ„É¢„Éº„Éâ -->
                        <div id="photoGalleryEdit" class="hidden">
                            <div id="photoGalleryList" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                                <!-- ÁîªÂÉè„ÅØ„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÂãïÁöÑ„Å´Ë™≠„ÅøËæº„Åæ„Çå„Åæ„Åô -->
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center flex flex-col items-center justify-center h-24 cursor-pointer hover:border-gray-400" onclick="document.getElementById('galleryInput').click()">
                                    <svg class="w-8 h-8 text-gray-400 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                    </svg>
                                    <span class="text-xs text-gray-500">ÁîªÂÉè„ÇíËøΩÂä†</span>
                                </div>
                            </div>
                            <input type="file" id="galleryInput" class="hidden" accept="image/*" multiple onchange="handleGalleryUpload(event)">
                        </div>
                    </div>

                    <!-- Âü∫Êú¨ÊÉÖÂ†± -->
                    <div id="basicInfoSection" class="group mb-8 border-2 border-gray-300 rounded-lg p-6 bg-white transition-all duration-300 hover:bg-blue-50">
                        <div class="flex justify-between items-center mb-4 section-header">
                            <h3 class="text-lg font-semibold text-gray-900">Âü∫Êú¨ÊÉÖÂ†±</h3>
                            <div class="flex gap-2">
                                <!-- Èñ≤Ë¶ß„É¢„Éº„ÉâÊôÇ„ÅÆ„Éú„Çø„É≥ -->
                                <button id="editBasicInfoBtn" onclick="toggleEditMode('basicInfo', true)" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg flex items-center gap-2 font-medium group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300">
                                    üõ†Ô∏è Á∑®ÈõÜ
                                </button>
                                <!-- Á∑®ÈõÜ„É¢„Éº„ÉâÊôÇ„ÅÆ„Éú„Çø„É≥ÔºàÂàùÊúü„ÅØÈùûË°®Á§∫Ôºâ -->
                                <button id="saveBasicInfoBtn" onclick="saveSection('basicInfo')" class="hidden px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 font-medium shadow-md">
                                    üíæ ‰øùÂ≠ò
                                </button>
                                <button id="cancelBasicInfoBtn" onclick="cancelEditMode('basicInfo')" class="hidden px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 flex items-center gap-2 font-medium">
                                    ‚úó „Ç≠„É£„É≥„Çª„É´
                                </button>
                            </div>
                        </div>

                        <!-- Èñ≤Ë¶ß„É¢„Éº„ÉâË°®Á§∫ÔºàÂàùÊúüË°®Á§∫Ôºâ -->
                        <div id="basicInfoView" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <div class="text-sm font-medium text-gray-500 mb-1">‰ºöÁ§æÂêç</div>
                                    <div id="companyNameView" class="text-base text-gray-900">-</div>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-gray-500 mb-1">‰ºöÁ§æÂêç„Ç´„Éä</div>
                                    <div id="companyNameKanaView" class="text-base text-gray-900">-</div>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-gray-500 mb-1">Â±ãÂè∑</div>
                                    <div id="tradeNameView" class="text-base text-gray-900">-</div>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-gray-500 mb-1">Â±ãÂè∑„Ç´„Éä</div>
                                    <div id="tradeNameKanaView" class="text-base text-gray-900">-</div>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-gray-500 mb-1">‰ª£Ë°®ËÄÖÂêç</div>
                                    <div id="representativeView" class="text-base text-gray-900">-</div>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-gray-500 mb-1">‰ª£Ë°®ËÄÖÂêç„Ç´„Éä</div>
                                    <div id="representativeKanaView" class="text-base text-gray-900">-</div>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-gray-500 mb-1">ÈÉµ‰æøÁï™Âè∑</div>
                                    <div id="zipCodeView" class="text-base text-gray-900">-</div>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-gray-500 mb-1">‰ΩèÊâÄ</div>
                                    <div id="addressView" class="text-base text-gray-900">-</div>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-gray-500 mb-1">ÈõªË©±Áï™Âè∑</div>
                                    <div id="phoneView" class="text-base text-gray-900">-</div>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-gray-500 mb-1">„Ç¶„Çß„Éñ„Çµ„Ç§„ÉàURL</div>
                                    <div id="websiteView" class="text-base text-gray-900">-</div>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-gray-500 mb-1">Ë®≠Á´ãÂπ¥Êúà</div>
                                    <div id="establishedView" class="text-base text-gray-900">-</div>
                                </div>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-500 mb-1">PRÊñá</div>
                                <div id="prTextView" class="text-base text-gray-900 whitespace-pre-wrap">-</div>
                            </div>
                        </div>

                        <!-- Á∑®ÈõÜ„É¢„Éº„ÉâË°®Á§∫ÔºàÂàùÊúü„ÅØÈùûË°®Á§∫Ôºâ -->
                        <div id="basicInfoEdit" class="hidden space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‰ºöÁ§æÂêç <span class="text-red-500">*</span></label>
                                    <input type="text" id="companyName" data-section="basicInfo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‰æã: Ê†™Âºè‰ºöÁ§æ„Åè„Çâ„Åπ„ÇãÂ°óË£Ö">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‰ºöÁ§æÂêç„Ç´„Éä <span class="text-red-500">*</span></label>
                                    <input type="text" id="companyNameKana" data-section="basicInfo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="„Ç´„Çø„Ç´„Éä„ÅßÂÖ•Âäõ">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Â±ãÂè∑</label>
                                    <input type="text" id="tradeName" data-section="basicInfo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‰æã: „Åè„Çâ„Åπ„Çã„Éö„Ç§„É≥„Éà">

                                    <!-- Â±ãÂè∑Ë°®Á§∫„Ç™„Éó„Ç∑„Éß„É≥Ôºà„Éó„É¨„Éì„É•„ÉºÁîªÈù¢„Å´ÁßªÂãïÔºâ -->
                                    <div class="mt-3 p-3 bg-gray-50 rounded-lg" id="tradeNameDisplayOptions" style="display: none;">
                                    <label class="block text-xs font-medium text-gray-700 mb-2">‰ºöÁ§æÂêç„ÅÆË°®Á§∫ÊñπÊ≥ï</label>
                                    <div class="space-y-2">
                                        <!-- „Éë„Çø„Éº„É≥1ÔºöÁ§æÂêçË°®Á§∫ -->
                                        <label class="flex items-center p-2 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                            <input type="radio" name="tradeNameDisplay" value="company" class="mr-2" checked="" onchange="updateCompanyNameDisplay()">
                                            <div class="min-w-0 flex-1">
                                                <span class="text-xs font-medium">„Éë„Çø„Éº„É≥1ÔºöÁ§æÂêçË°®Á§∫</span>
                                                <div class="text-xs text-gray-600 mt-0.5">‰æã: Ê†™Âºè‰ºöÁ§æ„Åè„Çâ„Åπ„ÇãÂ°óË£Ö</div>
                                            </div>
                                        </label>

                                        <!-- „Éë„Çø„Éº„É≥2ÔºöÂ±ãÂè∑Ë°®Á§∫ -->
                                        <label class="flex items-center p-2 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                            <input type="radio" name="tradeNameDisplay" value="trade" class="mr-2" onchange="updateCompanyNameDisplay()">
                                            <div class="min-w-0 flex-1">
                                                <span class="text-xs font-medium">„Éë„Çø„Éº„É≥2ÔºöÂ±ãÂè∑Ë°®Á§∫</span>
                                                <div class="text-xs text-gray-600 mt-0.5">‰æã: „Åè„Çâ„Åπ„Çã„Éö„Ç§„É≥„Éà</div>
                                            </div>
                                        </label>

                                        <!-- „Éë„Çø„Éº„É≥3Ôºö‰∏°ÊñπË°®Á§∫ -->
                                        <label class="flex items-center p-2 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                            <input type="radio" name="tradeNameDisplay" value="both" class="mr-2" onchange="updateCompanyNameDisplay()">
                                            <div class="min-w-0 flex-1">
                                                <span class="text-xs font-medium">„Éë„Çø„Éº„É≥3Ôºö‰∏°ÊñπË°®Á§∫</span>
                                                <div class="text-xs text-gray-600 mt-0.5">‰æã: Ê†™Âºè‰ºöÁ§æ„Åè„Çâ„Åπ„ÇãÂ°óË£ÖÔΩú„Åè„Çâ„Åπ„Çã„Éö„Ç§„É≥„Éà</div>
                                            </div>
                                        </label>

                                        <!-- „Éë„Çø„Éº„É≥3„ÅÆ„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„Ç™„Éó„Ç∑„Éß„É≥ -->
                                        <div id="bothDisplayOptions" class="ml-6 p-2 bg-blue-50 rounded-lg" style="display: none;">
                                            <h4 class="text-xs font-semibold text-gray-700 mb-2">„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„Ç™„Éó„Ç∑„Éß„É≥</h4>

                                            <!-- Ë°®Á§∫È†ÜÂ∫è -->
                                            <div class="mb-2">
                                                <label class="flex items-center">
                                                    <input type="checkbox" id="reverseOrder" class="mr-2" onchange="updateCompanyNameDisplay()">
                                                    <span class="text-xs">È†ÜÁï™„ÇíÂÖ•„ÇåÊõø„Åà„Çã</span>
                                                </label>
                                                <div class="text-xs text-gray-500 ml-6">‚Üí „Åè„Çâ„Åπ„Çã„Éö„Ç§„É≥„ÉàÔΩúÊ†™Âºè‰ºöÁ§æ„Åè„Çâ„Åπ„ÇãÂ°óË£Ö</div>
                                            </div>

                                            <!-- ÊñáÂ≠ó„Çµ„Ç§„Ç∫ -->
                                            <div class="min-w-0 flex-1">
                                                <label class="flex items-center">
                                                    <input type="checkbox" id="smallerSecond" class="mr-2" onchange="updateCompanyNameDisplay()">
                                                    <span class="text-xs">Âæå„Çç„ÅÆÊñáÂ≠ó„ÇíÂ∞è„Åï„Åè„Åô„ÇãÔºà85%„Çµ„Ç§„Ç∫Ôºâ</span>
                                                </label>
                                                <div class="text-xs text-gray-500 ml-6">‚Üí Â§ß„Åç„ÅÑÊñáÂ≠óÔΩú<span style="font-size:85%">Â∞è„Åï„ÅÑÊñáÂ≠ó</span></div>
                                            </div>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Â±ãÂè∑„Ç´„Éä</label>
                                    <input type="text" id="tradeNameKana" data-section="basicInfo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="„Ç´„Çø„Ç´„Éä„ÅßÂÖ•Âäõ">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">
                                        ‰ª£Ë°®ËÄÖÂêç <span class="text-red-500">*</span>
                                        <label class="inline-flex items-center ml-3 text-xs text-gray-600">
                                            <input type="checkbox" id="hideRepresentativeName" class="mr-1 rounded border-gray-300 focus:ring-blue-500">
                                            <span>ÂÖ¨ÈñãÊôÇ„Å´ÈùûË°®Á§∫„Å´„Åô„Çã</span>
                                        </label>
                                    </label>
                                    <input type="text" id="representative" data-section="basicInfo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‰ª£Ë°®ËÄÖÂêç„ÇíÂÖ•Âäõ">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‰ª£Ë°®ËÄÖÂêç„Ç´„Éä <span class="text-red-500">*</span></label>
                                    <input type="text" id="representativeKana" data-section="basicInfo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="„Ç´„Çø„Ç´„Éä„ÅßÂÖ•Âäõ">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ÈÉµ‰æøÁï™Âè∑ <span class="text-red-500">*</span></label>
                                    <input type="text" id="zipCode" data-section="basicInfo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="123-4567">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">
                                        ‰ΩèÊâÄ <span class="text-red-500">*</span>
                                        <label class="inline-flex items-center ml-3 text-xs text-gray-600">
                                            <input type="checkbox" id="hideAddress" class="mr-1 rounded border-gray-300 focus:ring-blue-500">
                                            <span>ÂÖ¨ÈñãÊôÇ„Å´ÈùûË°®Á§∫„Å´„Åô„Çã</span>
                                        </label>
                                    </label>
                                    <input type="text" id="address" data-section="basicInfo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Êù±‰∫¨ÈÉΩÊ∏ØÂå∫ÈùíÂ±±1-1-1">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ÈõªË©±Áï™Âè∑ <span class="text-red-500">*</span></label>
                                    <input type="text" id="phone" data-section="basicInfo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="03-1234-5678">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">„Ç¶„Çß„Éñ„Çµ„Ç§„ÉàURL</label>
                                    <input type="text" id="website" data-section="basicInfo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="https://example.com">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Ë®≠Á´ãÂπ¥Êúà</label>
                                    <input type="text" id="established" data-section="basicInfo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‰æã: 2010Âπ¥4Êúà">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">PRÊñá <span class="text-red-500">*</span></label>
                                <textarea id="prText" data-section="basicInfo" class="w-full px-3 py-2 border border-gray-300 rounded-lg resize-y focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="10" placeholder="‰ºöÁ§æ„ÅÆÁâπÂæ¥„ÇÑPRÊñá„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ" style="min-height: 200px;"></textarea>
                                <p class="text-xs text-gray-500 mt-1 text-right">
                                    <span id="prTextCharCount">0</span>ÊñáÂ≠ó
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- ÊîØÂ∫óÊÉÖÂ†± -->
                    <div id="branchInfoSection" class="group mb-8 border-2 border-gray-300 rounded-lg p-6 bg-white transition-all duration-300 hover:bg-blue-50">
                        <div class="flex justify-between items-center mb-4 section-header">
                            <h3 class="text-lg font-semibold text-gray-900">ÊîØÂ∫óÊÉÖÂ†±</h3>
                            <div class="flex gap-2">
                                <button id="editBranchInfoBtn" onclick="toggleEditMode('branchInfo', true)" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg flex items-center gap-2 font-medium group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300">
                                    üõ†Ô∏è Á∑®ÈõÜ
                                </button>
                                <button id="saveBranchInfoBtn" onclick="saveSection('branchInfo')" class="hidden px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 font-medium shadow-md">
                                    üíæ ‰øùÂ≠ò
                                </button>
                                <button id="cancelBranchInfoBtn" onclick="cancelEditMode('branchInfo')" class="hidden px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 flex items-center gap-2 font-medium">
                                    ‚úó „Ç≠„É£„É≥„Çª„É´
                                </button>
                            </div>
                        </div>

                        <!-- Èñ≤Ë¶ß„É¢„Éº„Éâ -->
                        <div id="branchInfoView">
                            <div id="branchListView" class="space-y-3">
                                <div class="text-sm text-gray-500">ÊîØÂ∫óÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>
                            </div>
                        </div>

                        <!-- Á∑®ÈõÜ„É¢„Éº„Éâ -->
                        <div id="branchInfoEdit" class="hidden">
                            <div id="branchList"><div id="branch-1" class="border rounded-lg p-4 mb-3 bg-gray-50">
                            <div class="flex justify-between items-start mb-3">
                                <h4 class="font-medium text-gray-700">ÊîØÂ∫ó 1</h4>
                                <button onclick="removeBranch(1)" class="text-red-600 hover:text-red-800">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ÊîØÂ∫óÂêç</label>
                                    <input type="text" class="w-full px-3 py-2 border rounded-lg" placeholder="‰æã: Ê®™ÊµúÊîØÂ∫ó" value="ÂêçÂè§Â±ãÊîØÂ∫ó" onchange="updateBranch(1, 'name', this.value)">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ÊîØÂ∫ó‰ΩèÊâÄ</label>
                                    <input type="text" class="w-full px-3 py-2 border rounded-lg" placeholder="‰æã: Á•ûÂ•àÂ∑ùÁúåÊ®™ÊµúÂ∏Ç..." value="ÂêçÂè§Â±ã1-1" onchange="updateBranch(1, 'address', this.value)">
                                </div>
                            </div>
                        </div><div id="branch-2" class="border rounded-lg p-4 mb-3 bg-gray-50">
                            <div class="flex justify-between items-start mb-3">
                                <h4 class="font-medium text-gray-700">ÊîØÂ∫ó 2</h4>
                                <button onclick="removeBranch(2)" class="text-red-600 hover:text-red-800">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ÊîØÂ∫óÂêç</label>
                                    <input type="text" class="w-full px-3 py-2 border rounded-lg" placeholder="‰æã: Ê®™ÊµúÊîØÂ∫ó" value="ÂåóÊµ∑ÈÅì" onchange="updateBranch(2, 'name', this.value)">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ÊîØÂ∫ó‰ΩèÊâÄ</label>
                                    <input type="text" class="w-full px-3 py-2 border rounded-lg" placeholder="‰æã: Á•ûÂ•àÂ∑ùÁúåÊ®™ÊµúÂ∏Ç..." value="Á∂≤Ëµ∞1-1" onchange="updateBranch(2, 'address', this.value)">
                                </div>
                            </div>
                        </div></div>
                            <button onclick="addBranch()" class="mt-3 text-blue-600 hover:text-blue-800 text-sm font-medium">+ ÊîØÂ∫ó„ÇíËøΩÂä†</button>
                        </div>
                    </div>

                    <!-- ÈÄ£Áµ°ÂÖàÊÉÖÂ†±ÔºÜ‰∫ãÊ•≠Ë©≥Á¥∞ -->
                    <div id="contactBusinessSection" class="group mb-8 border-2 border-gray-300 rounded-lg p-6 bg-white transition-all duration-300 hover:bg-blue-50">
                        <div class="flex justify-between items-center mb-4 section-header">
                            <h3 class="text-lg font-semibold text-gray-900">ÈÄ£Áµ°ÂÖàÊÉÖÂ†±ÔºÜ‰∫ãÊ•≠Ë©≥Á¥∞</h3>
                            <div class="flex gap-2">
                                <button id="editContactBusinessBtn" onclick="toggleEditMode('contactBusiness', true)" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg flex items-center gap-2 font-medium group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300">
                                    üõ†Ô∏è Á∑®ÈõÜ
                                </button>
                                <button id="saveContactBusinessBtn" onclick="saveSection('contactBusiness')" class="hidden px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 font-medium shadow-md">
                                    üíæ ‰øùÂ≠ò
                                </button>
                                <button id="cancelContactBusinessBtn" onclick="cancelEditMode('contactBusiness')" class="hidden px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 flex items-center gap-2 font-medium">
                                    ‚úó „Ç≠„É£„É≥„Çª„É´
                                </button>
                            </div>
                        </div>

                        <!-- Èñ≤Ë¶ß„É¢„Éº„Éâ -->
                        <div id="contactBusinessView" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div><div class="text-sm font-medium text-gray-500 mb-1">Ë´ãÊ±ÇÁî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</div><div id="billingEmailView" class="text-base text-gray-900">-</div></div>
                                <div><div class="text-sm font-medium text-gray-500 mb-1">Âñ∂Ê•≠Áî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</div><div id="salesEmailView" class="text-base text-gray-900">-</div></div>
                                <div><div class="text-sm font-medium text-gray-500 mb-1">Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç</div><div id="salesPersonNameView" class="text-base text-gray-900">-</div></div>
                                <div><div class="text-sm font-medium text-gray-500 mb-1">Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„Ç´„Éä</div><div id="salesPersonKanaView" class="text-base text-gray-900">-</div></div>
                                <div><div class="text-sm font-medium text-gray-500 mb-1">ÂæìÊ•≠Âì°Êï∞</div><div id="employeesView" class="text-base text-gray-900">-</div></div>
                                <div><div class="text-sm font-medium text-gray-500 mb-1">Â£≤‰∏äË¶èÊ®°</div><div id="salesScaleView" class="text-base text-gray-900">-</div></div>
                            </div>
                        </div>

                        <!-- Á∑®ÈõÜ„É¢„Éº„Éâ -->
                        <div id="contactBusinessEdit" class="hidden space-y-4">
                            <h4 class="font-medium text-gray-700">ÈÄ£Áµ°ÂÖàÊÉÖÂ†±</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Ë´ãÊ±ÇÁî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ <span class="text-red-500">*</span></label>
                                    <div id="billingEmailContainer">
                                        <div class="billing-email-item mb-2">
                                            <div class="flex gap-2">
                                                <input type="email" name="billingEmail" data-section="contactBusiness" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="billing@example.com">
                                                <button type="button" onclick="addBillingEmail()" class="bg-blue-500 text-white px-3 py-2 rounded-lg hover:bg-blue-600 flex items-center" title="„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíËøΩÂä†">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Âñ∂Ê•≠Áî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ <span class="text-red-500">*</span></label>
                                    <input type="email" id="salesEmail" data-section="contactBusiness" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="sales@company.co.jp">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç <span class="text-red-500">*</span></label>
                                    <input type="text" id="salesPersonName" data-section="contactBusiness" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„ÅÆÊ∞èÂêç„ÇíÂÖ•Âäõ">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„Ç´„Éä <span class="text-red-500">*</span></label>
                                    <input type="text" id="salesPersonKana" data-section="contactBusiness" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="„É§„Éû„ÉÄ „Çø„É≠„Ç¶">
                                </div>
                            </div>

                            <h4 class="font-medium text-gray-700 pt-4">‰∫ãÊ•≠Ë©≥Á¥∞</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ÂæìÊ•≠Âì°Êï∞ <span class="text-red-500">*</span></label>
                                    <select id="employees" data-section="contactBusiness" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                        <option value="1-2">1„Äú2Âêç</option>
                                        <option value="3-5">3„Äú5Âêç</option>
                                        <option value="6-10">6„Äú10Âêç</option>
                                        <option value="11+">11Âêç‰ª•‰∏ä</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Â£≤‰∏äË¶èÊ®° <span class="text-red-500">*</span></label>
                                    <select id="salesScale" data-section="contactBusiness" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                        <option value="under-10m">1,000‰∏áÂÜÜÊú™Ê∫Ä</option>
                                        <option value="10m-30m">1,000‰∏áÂÜÜ„Äú3,000‰∏áÂÜÜ</option>
                                        <option value="30m-50m">3,000‰∏áÂÜÜ„Äú5,000‰∏áÂÜÜ</option>
                                        <option value="50m-100m">5,000‰∏áÂÜÜ„Äú1ÂÑÑÂÜÜ</option>
                                        <option value="100m-300m">1ÂÑÑÂÜÜ„Äú3ÂÑÑÂÜÜ</option>
                                        <option value="over-300m">3ÂÑÑÂÜÜ‰ª•‰∏ä</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- ‰øùÊúâË≥áÊ†º -->
                    <div id="qualificationsSection" class="group mb-8 border-2 border-gray-300 rounded-lg p-6 bg-white transition-all duration-300 hover:bg-blue-50">
                        <div class="flex justify-between items-center mb-4 section-header">
                            <h3 class="text-lg font-semibold text-gray-900">‰øùÊúâË≥áÊ†º</h3>
                            <div class="flex gap-2">
                                <button id="editQualificationsBtn" onclick="toggleEditMode('qualifications', true)" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg flex items-center gap-2 font-medium group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300">
                                    üõ†Ô∏è Á∑®ÈõÜ
                                </button>
                                <button id="saveQualificationsBtn" onclick="saveSection('qualifications')" class="hidden px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 font-medium shadow-md">
                                    üíæ ‰øùÂ≠ò
                                </button>
                                <button id="cancelQualificationsBtn" onclick="cancelEditMode('qualifications')" class="hidden px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 flex items-center gap-2 font-medium">
                                    ‚úó „Ç≠„É£„É≥„Çª„É´
                                </button>
                            </div>
                        </div>

                        <!-- Èñ≤Ë¶ß„É¢„Éº„Éâ -->
                        <div id="qualificationsView">
                            <div id="qualificationsViewList" class="flex flex-wrap gap-2">
                                <span class="text-sm text-gray-500">‰øùÊúâË≥áÊ†º„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</span>
                            </div>
                        </div>

                        <!-- Á∑®ÈõÜ„É¢„Éº„Éâ -->
                        <div id="qualificationsEdit" class="hidden">
                            <p class="text-sm text-gray-600 mb-4">Ë©≤ÂΩì„Åô„ÇãË≥áÊ†º„Çí„Åô„Åπ„Å¶ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºàË§áÊï∞ÈÅ∏ÊäûÂèØÔºâ</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-4">
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="‰∏ÄÁ¥öÂ°óË£ÖÊäÄËÉΩÂ£´" class="mr-3">
                                <span class="text-sm">‰∏ÄÁ¥öÂ°óË£ÖÊäÄËÉΩÂ£´</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="‰∫åÁ¥öÂ°óË£ÖÊäÄËÉΩÂ£´" class="mr-3">
                                <span class="text-sm">‰∫åÁ¥öÂ°óË£ÖÊäÄËÉΩÂ£´</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="Ë∂≥Â†¥ÁµÑÁ´ã‰ΩúÊ•≠‰∏ª‰ªªËÄÖ" class="mr-3">
                                <span class="text-sm">Ë∂≥Â†¥ÁµÑÁ´ã‰ΩúÊ•≠‰∏ª‰ªªËÄÖ</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="Áü≥Á∂ø‰ΩúÊ•≠‰∏ª‰ªªËÄÖ" class="mr-3">
                                <span class="text-sm">Áü≥Á∂øÔºà„Ç¢„Çπ„Éô„Çπ„ÉàÔºâ‰ΩúÊ•≠‰∏ª‰ªªËÄÖ</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="Â§ñÂ£ÅË®∫Êñ≠Â£´" class="mr-3">
                                <span class="text-sm">Â§ñÂ£ÅË®∫Êñ≠Â£´</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="Â§ñÂ£ÅÂä£ÂåñË®∫Êñ≠Â£´" class="mr-3">
                                <span class="text-sm">Â§ñÂ£ÅÂä£ÂåñË®∫Êñ≠Â£´</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="Â§ñÂ£Å„Ç¢„Éâ„Éê„Ç§„Ç∂„Éº" class="mr-3">
                                <span class="text-sm">Â§ñÂ£Å„Ç¢„Éâ„Éê„Ç§„Ç∂„Éº</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="Â±ãÊ†πË®∫Êñ≠Â£´" class="mr-3">
                                <span class="text-sm">Â±ãÊ†πË®∫Êñ≠Â£´</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="Èõ®Êºè„ÇäË®∫Êñ≠Â£´" class="mr-3">
                                <span class="text-sm">Èõ®Êºè„ÇäË®∫Êñ≠Â£´</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="Â¢óÊîπÁØâÁõ∏Ë´áÂì°" class="mr-3">
                                <span class="text-sm">Â¢óÊîπÁØâÁõ∏Ë´áÂì°</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="Á¨¨‰∫åÁ®ÆÈõªÊ∞óÂ∑•‰∫ãÂ£´" class="mr-3">
                                <span class="text-sm">Á¨¨‰∫åÁ®ÆÈõªÊ∞óÂ∑•‰∫ãÂ£´</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="ÊúâÊ©üÊ∫∂Ââ§‰ΩúÊ•≠‰∏ª‰ªªËÄÖ" class="mr-3">
                                <span class="text-sm">ÊúâÊ©üÊ∫∂Ââ§‰ΩúÊ•≠‰∏ª‰ªªËÄÖ</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="‰∏ÄÁ¥öÈò≤Ê∞¥ÊñΩÂ∑•ÊäÄËÉΩÂ£´" class="mr-3">
                                <span class="text-sm">‰∏ÄÁ¥öÈò≤Ê∞¥ÊñΩÂ∑•ÊäÄËÉΩÂ£´</span>
                            </label>
                        </div>
                        <!-- „Åù„ÅÆ‰ªñ„ÅÆË≥áÊ†º„ÇíËøΩÂä† -->
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">„Åù„ÅÆ‰ªñ„ÅÆË≥áÊ†º</label>
                            <div class="flex gap-2" id="customQualifications">
                                <input type="text" id="customQualificationInput" class="flex-1 px-3 py-2 border rounded-lg" placeholder="„Åù„ÅÆ‰ªñ„ÅÆË≥áÊ†º„ÇíÂÖ•Âäõ">
                                <button onclick="addCustomQualification()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                                    ËøΩÂä†
                                </button>
                            </div>
                            <div id="customQualificationsList" class="mt-3 flex flex-wrap gap-2"></div>
                        </div>
                        </div>
                    </div>

                    <!-- Âä†ÂÖ•‰øùÈô∫ -->
                    <div id="insuranceSection" class="group mb-8 border-2 border-gray-300 rounded-lg p-6 bg-white transition-all duration-300 hover:bg-blue-50">
                        <div class="flex justify-between items-center mb-4 section-header">
                            <h3 class="text-lg font-semibold text-gray-900">Âä†ÂÖ•‰øùÈô∫</h3>
                            <div class="flex gap-2">
                                <button id="editInsuranceBtn" onclick="toggleEditMode('insurance', true)" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg flex items-center gap-2 font-medium group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300">
                                    üõ†Ô∏è Á∑®ÈõÜ
                                </button>
                                <button id="saveInsuranceBtn" onclick="saveSection('insurance')" class="hidden px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 font-medium shadow-md">
                                    üíæ ‰øùÂ≠ò
                                </button>
                                <button id="cancelInsuranceBtn" onclick="cancelEditMode('insurance')" class="hidden px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 flex items-center gap-2 font-medium">
                                    ‚úó „Ç≠„É£„É≥„Çª„É´
                                </button>
                            </div>
                        </div>

                        <!-- Èñ≤Ë¶ß„É¢„Éº„Éâ -->
                        <div id="insuranceView">
                            <div id="insuranceViewList" class="flex flex-wrap gap-2">
                                <span class="text-sm text-gray-500">Âä†ÂÖ•‰øùÈô∫„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</span>
                            </div>
                        </div>

                        <!-- Á∑®ÈõÜ„É¢„Éº„Éâ -->
                        <div id="insuranceEdit" class="hidden">
                            <p class="text-sm text-gray-600 mb-4">Âä†ÂÖ•„Åó„Å¶„ÅÑ„Çã‰øùÈô∫„Çí„Åô„Åπ„Å¶ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºàË§áÊï∞ÈÅ∏ÊäûÂèØÔºâ</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-4">
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="insurance" value="Â∑•‰∫ã‰øùÈô∫" class="mr-3">
                                <span class="text-sm">Â∑•‰∫ã‰øùÈô∫</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="insurance" value="Ë≥†ÂÑüË≤¨‰ªª‰øùÈô∫" class="mr-3">
                                <span class="text-sm">Ë≥†ÂÑüË≤¨‰ªª‰øùÈô∫</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="insurance" value="„É™„Éï„Ç©„Éº„É†ÁëïÁñµ‰øùÈô∫" class="mr-3">
                                <span class="text-sm">„É™„Éï„Ç©„Éº„É†ÁëïÁñµ‰øùÈô∫</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="insurance" value="Âª∫Ë®≠Â∑•‰∫ã‰øùÈô∫" class="mr-3">
                                <span class="text-sm">Âª∫Ë®≠Â∑•‰∫ã‰øùÈô∫</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="insurance" value="Ë´ãË≤†Ê•≠ËÄÖË≥†ÂÑüË≤¨‰ªª‰øùÈô∫" class="mr-3">
                                <span class="text-sm">Ë´ãË≤†Ê•≠ËÄÖË≥†ÂÑüË≤¨‰ªª‰øùÈô∫</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="insurance" value="ÁîüÁî£Áâ©Ë≥†ÂÑüË≤¨‰ªª‰øùÈô∫" class="mr-3">
                                <span class="text-sm">ÁîüÁî£Áâ©Ë≥†ÂÑüË≤¨‰ªª‰øùÈô∫ÔºàPL‰øùÈô∫Ôºâ</span>
                            </label>
                        </div>
                        <!-- „Åù„ÅÆ‰ªñ„ÅÆ‰øùÈô∫„ÇíËøΩÂä† -->
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">„Åù„ÅÆ‰ªñ„ÅÆ‰øùÈô∫</label>
                            <div class="flex gap-2" id="customInsurance">
                                <input type="text" id="customInsuranceInput" class="flex-1 px-3 py-2 border rounded-lg" placeholder="„Åù„ÅÆ‰ªñ„ÅÆ‰øùÈô∫„ÇíÂÖ•Âäõ">
                                <button onclick="addCustomInsurance()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                                    ËøΩÂä†
                                </button>
                            </div>
                            <div id="customInsuranceList" class="mt-3 flex flex-wrap gap-2"></div>
                        </div>
                        </div>
                    </div>
            </div>

            <!-- „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="cancelSection" class="section" style="display: none;">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã</h2>
                        <p class="text-sm text-gray-600 mt-1">Áî≥Ë´ãÂèØËÉΩ„Å™Ê°à‰ª∂„ÇíÈÅ∏Êäû„Åó„Å¶„Ç≠„É£„É≥„Çª„É´ÁêÜÁî±„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                    </div>
                </div>

                <!-- „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
                <div class="mb-6 border-b border-gray-200 overflow-x-auto">
                    <nav class="flex space-x-2 sm:space-x-4 min-w-max">
                        <button onclick="switchCancelTab('available')" id="cancelTab-available" class="cancel-tab px-3 sm:px-4 py-2 border-b-2 border-blue-500 text-blue-600 font-medium text-sm sm:text-base whitespace-nowrap">
                            Áî≥Ë´ãÂèØËÉΩ
                        </button>
                        <button onclick="switchCancelTab('pending')" id="cancelTab-pending" class="cancel-tab px-3 sm:px-4 py-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 text-sm sm:text-base whitespace-nowrap">
                            ÂØ©Êüª‰∏≠
                        </button>
                        <button onclick="switchCancelTab('approved')" id="cancelTab-approved" class="cancel-tab px-3 sm:px-4 py-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 text-sm sm:text-base whitespace-nowrap">
                            ÊâøË™çÊ∏à„Åø
                        </button>
                        <button onclick="switchCancelTab('rejected')" id="cancelTab-rejected" class="cancel-tab px-3 sm:px-4 py-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 text-sm sm:text-base whitespace-nowrap">
                            Âç¥‰∏ãÊ∏à„Åø
                        </button>
                    </nav>
                </div>

                <!-- Ê§úÁ¥¢„Éê„Éº -->
                <div class="bg-white rounded-lg shadow p-4 mb-6">
                    <!-- Âü∫Êú¨Ê§úÁ¥¢ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                        <div class="lg:col-span-2">
                            <input type="text" id="cancelSearchInput" placeholder="È°ßÂÆ¢Âêç„ÉªÈõªË©±Áï™Âè∑„Éª‰ΩèÊâÄ„ÅßÊ§úÁ¥¢ÔºàÈÉ®ÂàÜ‰∏ÄËá¥Ôºâ" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500" onkeyup="searchCancelCases()">
                        </div>
                    </div>

                    <!-- ÊúüÈñìÊ§úÁ¥¢ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex flex-col sm:flex-row sm:items-center gap-2">
                            <label class="text-xs text-gray-600 whitespace-nowrap">ÈÖç‰ø°ÊúüÈñì</label>
                            <input type="date" id="cancelStartDate" class="w-full sm:w-auto px-3 py-2 border rounded-lg" onchange="searchCancelCases()">
                            <span class="text-xs text-gray-600 text-center sm:text-left">„Äú</span>
                            <input type="date" id="cancelEndDate" class="w-full sm:w-auto px-3 py-2 border rounded-lg" onchange="searchCancelCases()">
                        </div>
                        <div class="flex items-center justify-start md:justify-end">
                            <button onclick="searchCancelCases()" class="w-full md:w-auto px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
                                Ê§úÁ¥¢
                            </button>
                        </div>
                    </div>
                </div>

                <!-- „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ: Áî≥Ë´ãÂèØËÉΩ -->
                <div id="cancelTabContent-available" class="cancel-tab-content">
                    <div id="cancelCasesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6">
                        <!-- Ê°à‰ª∂„Ç´„Éº„Éâ„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                    </div>
                </div>

                <!-- „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ: ÂØ©Êüª‰∏≠ -->
                <div id="cancelTabContent-pending" class="cancel-tab-content hidden">
                    <div id="cancelPendingList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6">
                        <!-- ÂØ©Êüª‰∏≠Ê°à‰ª∂„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                    </div>
                </div>

                <!-- „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ: ÊâøË™çÊ∏à„Åø -->
                <div id="cancelTabContent-approved" class="cancel-tab-content hidden">
                    <div id="cancelApprovedList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6">
                        <!-- ÊâøË™çÊ∏à„ÅøÊ°à‰ª∂„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                    </div>
                </div>

                <!-- „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ: Âç¥‰∏ãÊ∏à„Åø -->
                <div id="cancelTabContent-rejected" class="cancel-tab-content hidden">
                    <div id="cancelRejectedList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6">
                        <!-- Âç¥‰∏ãÊ∏à„ÅøÊ°à‰ª∂„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                    </div>
                </div>

                <!-- „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„É¢„Éº„ÉÄ„É´ -->
                <div id="cancelModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="p-6">
                            <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-xl font-bold text-gray-900">„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã</h3>
                                <button onclick="closeCancelModal()" class="text-gray-400 hover:text-gray-600">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <!-- „Çπ„ÉÜ„ÉÉ„Éó„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº -->
                            <div class="mb-6">
                                <div class="flex items-center justify-between">
                                    <div class="flex-1 flex items-center" id="cancelStep1Indicator">
                                        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-blue-500 text-white font-semibold">1</div>
                                        <div class="flex-1 h-1 bg-gray-300 mx-2"></div>
                                    </div>
                                    <div class="flex-1 flex items-center" id="cancelStep2Indicator">
                                        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-300 text-gray-600 font-semibold">2</div>
                                        <div class="flex-1 h-1 bg-gray-300 mx-2"></div>
                                    </div>
                                    <div class="flex items-center" id="cancelStep3Indicator">
                                        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-300 text-gray-600 font-semibold">3</div>
                                    </div>
                                </div>
                                <div class="flex justify-between mt-2 text-xs text-gray-600">
                                    <span class="w-1/3 text-center">ÁêÜÁî±„Ç´„ÉÜ„Ç¥„É™</span>
                                    <span class="w-1/3 text-center">Ë©≥Á¥∞ÂÖ•Âäõ</span>
                                    <span class="w-1/3 text-center">Á¢∫Ë™ç</span>
                                </div>
                            </div>

                            <!-- Step 1: „Ç≠„É£„É≥„Çª„É´ÁêÜÁî±„Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû -->
                            <div id="cancelStep1" class="cancel-step">
                                <h4 class="font-semibold text-lg mb-4">„Ç≠„É£„É≥„Çª„É´ÁêÜÁî±„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h4>
                                <div id="cancelCategoryList" class="space-y-3">
                                    <!-- „Ç´„ÉÜ„Ç¥„É™„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                                </div>
                            </div>

                            <!-- Step 2: „Çµ„Éñ„Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû„Å®Ë©≥Á¥∞Ë≥™Âïè -->
                            <div id="cancelStep2" class="cancel-step hidden">
                                <h4 class="font-semibold text-lg mb-4">Ë©≥Á¥∞„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h4>
                                <div id="cancelSubCategoryList" class="space-y-3 mb-6">
                                    <!-- „Çµ„Éñ„Ç´„ÉÜ„Ç¥„É™„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                                </div>
                                <div id="cancelQuestionsForm" class="hidden space-y-4">
                                    <!-- Ë≥™Âïè„Éï„Ç©„Éº„É†„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                                </div>
                                <div class="mt-6 flex justify-between">
                                    <button onclick="cancelGoBack()" class="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                                        Êàª„Çã
                                    </button>
                                    <button id="cancelStep2NextBtn" onclick="cancelGoToStep(3)" class="hidden px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                        Á¢∫Ë™çÁîªÈù¢„Å∏
                                    </button>
                                </div>
                            </div>

                            <!-- Step 3: Á¢∫Ë™çÁîªÈù¢ -->
                            <div id="cancelStep3" class="cancel-step hidden">
                                <h4 class="font-semibold text-lg mb-4">Áî≥Ë´ãÂÜÖÂÆπË©≥Á¥∞</h4>

                                <!-- Áî≥Ë´ãÂÜÖÂÆπË©≥Á¥∞Ôºà„Éï„É™„ÉºÂÖ•Âäõ„ÉªÁ∑®ÈõÜÂèØËÉΩÔºâ -->
                                <div class="mb-6">
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="block text-sm font-semibold text-gray-700">
                                            Áî≥Ë´ãÂÜÖÂÆπË©≥Á¥∞ <span class="text-red-500">*</span>
                                        </label>
                                        <div class="flex gap-2">
                                            <!-- „Ç¢„É≥„Éâ„Ç•/„É™„Éâ„Ç•„Éú„Çø„É≥ -->
                                            <button type="button" id="undoTextBtn" onclick="undoText()"
                                                    class="flex items-center px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
                                                    title="ÂÖÉ„Å´Êàª„Åô (Ctrl+Z)"
                                                    disabled>
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path>
                                                </svg>
                                            </button>
                                            <button type="button" id="redoTextBtn" onclick="redoText()"
                                                    class="flex items-center px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
                                                    title="„ÇÑ„ÇäÁõ¥„Åô (Ctrl+Y)"
                                                    disabled>
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 10h-10a8 8 0 00-8 8v2m18-10l-6 6m6-6l-6-6"></path>
                                                </svg>
                                            </button>
                                            <!-- AIÁîüÊàê„Éú„Çø„É≥ -->
                                            <button type="button" onclick="generateCancelApplicationText()"
                                                    class="flex items-center px-3 py-1 text-xs bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 font-semibold">
                                                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                    <path d="M13 7H7v6h6V7z"></path>
                                                    <path fill-rule="evenodd" d="M7 2a1 1 0 012 0v1h2V2a1 1 0 112 0v1h2a2 2 0 012 2v2h1a1 1 0 110 2h-1v2h1a1 1 0 110 2h-1v2a2 2 0 01-2 2h-2v1a1 1 0 11-2 0v-1H9v1a1 1 0 11-2 0v-1H5a2 2 0 01-2-2v-2H2a1 1 0 110-2h1V9H2a1 1 0 010-2h1V5a2 2 0 012-2h2V2zM5 5h10v10H5V5z" clip-rule="evenodd"></path>
                                                </svg>
                                                AIÁîüÊàê
                                            </button>
                                        </div>
                                    </div>
                                    <textarea id="cancelApplicationText" rows="8" maxlength="1000" required
                                              class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-blue-500"
                                              placeholder="Ëá™ÂãïÁîüÊàê„Åï„Çå„Åü„ÉÜ„É≥„Éó„É¨„Éº„ÉàÊñá„ÇíÁ∑®ÈõÜ„Åß„Åç„Åæ„Åô"></textarea>
                                    <p class="text-xs text-gray-500 mt-1">ÊúÄÂ§ß1000ÊñáÂ≠ó</p>
                                </div>


                                <div class="flex justify-between">
                                    <button onclick="cancelGoToStep(2)" class="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                                        Êàª„Çã
                                    </button>
                                    <button id="submitCancelBtn" onclick="submitCancelApplication()" class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                                        „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÇíÊèêÂá∫
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ËøΩÂÆ¢ÁµÇ‰∫ÜBOX„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="archiveSection" class="section" style="display: none;">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">ËøΩÂÆ¢ÁµÇ‰∫ÜBOX</h2>
                        <p class="text-sm text-gray-600 mt-1">ËøΩÂÆ¢„ÇíÁµÇ‰∫Ü„Åó„ÅüÊ°à‰ª∂„ÅÆ‰∏ÄË¶ßÔºà„ÅÑ„Å§„Åß„ÇÇÂæ©ÂÖÉÂèØËÉΩÔºâ</p>
                    </div>
                </div>

                <!-- „Ç¢„Éº„Ç´„Ç§„ÉñÊ°à‰ª∂‰∏ÄË¶ß -->
                <div id="archiveCasesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6">
                    <!-- Ê°à‰ª∂„Ç´„Éº„Éâ„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                </div>
            </div>

            <!-- ÊúüÈôêÂª∂Èï∑Áî≥Ë´ã„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="extensionSection" class="section" style="display: none;">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">„Ç≠„É£„É≥„Çª„É´ÊúüÈôêÂª∂Èï∑Áî≥Ë´ã</h2>
                        <p class="text-sm text-gray-600 mt-1">ÈÄ£Áµ°„Åå„Å§„ÅÑ„Åü„Åå„Ç¢„Éù„ÅåÊúüÈôêÂ§ñ„ÅÆÂ†¥Âêà„ÄÅÊúüÈôêÂª∂Èï∑„ÇíÁî≥Ë´ã„Åß„Åç„Åæ„ÅôÔºàÈÖç‰ø°Âæå7Êó•‰ª•ÂÜÖ„ÅÆ„ÅøÁî≥Ë´ãÂèØËÉΩÔºâ</p>
                    </div>
                </div>

                <!-- Ê§úÁ¥¢„Éê„Éº -->
                <div class="bg-white rounded-lg shadow p-4 mb-6">
                    <!-- Âü∫Êú¨Ê§úÁ¥¢ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                        <div class="lg:col-span-2">
                            <input type="text" id="extensionSearchInput" placeholder="È°ßÂÆ¢Âêç„ÉªÈõªË©±Áï™Âè∑„Éª‰ΩèÊâÄ„ÅßÊ§úÁ¥¢ÔºàÈÉ®ÂàÜ‰∏ÄËá¥Ôºâ" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500" onkeyup="searchExtensionCases()">
                        </div>
                    </div>

                    <!-- ÊúüÈñìÊ§úÁ¥¢ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex flex-col sm:flex-row sm:items-center gap-2">
                            <label class="text-xs text-gray-600 whitespace-nowrap">ÈÖç‰ø°ÊúüÈñì</label>
                            <input type="date" id="extensionStartDate" class="w-full sm:w-auto px-3 py-2 border rounded-lg" onchange="searchExtensionCases()">
                            <span class="text-xs text-gray-600 text-center sm:text-left">„Äú</span>
                            <input type="date" id="extensionEndDate" class="w-full sm:w-auto px-3 py-2 border rounded-lg" onchange="searchExtensionCases()">
                        </div>
                        <div class="flex items-center justify-start md:justify-end">
                            <button onclick="searchExtensionCases()" class="w-full md:w-auto px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
                                Ê§úÁ¥¢
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Ê°à‰ª∂‰∏ÄË¶ß -->
                <div id="extensionCasesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6">
                    <!-- Ê°à‰ª∂„Ç´„Éº„Éâ„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                </div>

                <!-- ÊúüÈôêÂª∂Èï∑Áî≥Ë´ã„É¢„Éº„ÉÄ„É´ -->
                <div id="extensionModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="p-6">
                            <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-xl font-bold text-gray-900">„Ç≠„É£„É≥„Çª„É´ÊúüÈôêÂª∂Èï∑Áî≥Ë´ã</h3>
                                <button onclick="closeExtensionModal()" class="text-gray-400 hover:text-gray-600">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <!-- È°ßÂÆ¢ÊÉÖÂ†± -->
                            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                                <h4 class="font-semibold text-sm mb-3">È°ßÂÆ¢ÊÉÖÂ†±</h4>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <p class="text-xs text-gray-600">CV ID</p>
                                        <p class="font-semibold" id="extensionModalCvId"></p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-600">È°ßÂÆ¢Âêç</p>
                                        <p class="font-semibold" id="extensionModalCustomerName"></p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-600">ÈõªË©±Áï™Âè∑</p>
                                        <p class="font-semibold" id="extensionModalPhone"></p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-600">ÈÖç‰ø°Êó•</p>
                                        <p class="font-semibold" id="extensionModalDeliveredDate"></p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-600">ÁèæÂú®„ÅÆÊúüÈôê</p>
                                        <p class="font-semibold text-red-600" id="extensionModalCurrentDeadline"></p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-600">Âª∂Èï∑ÂæåÊúüÈôê</p>
                                        <p class="font-semibold text-green-600" id="extensionModalNewDeadline"></p>
                                    </div>
                                </div>
                            </div>

                            <!-- Áî≥Ë´ã„Éï„Ç©„Éº„É† -->
                            <form id="extensionForm" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        ÈÄ£Áµ°„Åå„Å§„ÅÑ„ÅüÊó• <span class="text-red-500">*</span>
                                    </label>
                                    <input type="date" id="extensionContactDate" required
                                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                                </div>

                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        „Ç¢„Éù‰∫àÂÆöÊó• <span class="text-red-500">*</span>
                                    </label>
                                    <input type="date" id="extensionAppointmentDate" required
                                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                                </div>

                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        Âª∂Èï∑ÁêÜÁî± <span class="text-red-500">*</span>
                                    </label>
                                    <div class="relative">
                                        <textarea id="extensionReason" rows="4" required
                                                  placeholder="‰æãÔºö„ÅäÂÆ¢Êßò„Å®ÈÄ£Áµ°„ÅåÂèñ„Çå„Åæ„Åó„Åü„Åå„ÄÅ10Êó•Âæå„Å´Ë®™Âïè‰∫àÂÆö„ÅÆ„Åü„ÇÅÊúüÈôêÂª∂Èï∑„ÇíÁî≥Ë´ã„Åó„Åæ„Åô„ÄÇ"
                                                  class="w-full px-4 py-2 pr-12 border rounded-lg focus:outline-none focus:border-blue-500"></textarea>
                                        <button type="button" onclick="startExtensionReasonVoiceInput()"
                                                class="absolute bottom-2 right-2 p-2 text-gray-400 hover:text-blue-500 transition-colors"
                                                title="Èü≥Â£∞ÂÖ•Âäõ">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                                            </svg>
                                        </button>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">ÊúüÈôêÂª∂Èï∑„ÅåÂøÖË¶Å„Å™ÁêÜÁî±„ÇíÂÖ∑‰ΩìÁöÑ„Å´Ë®òÂÖ•„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                                </div>

                                <div class="flex justify-between pt-4">
                                    <button type="button" onclick="closeExtensionModal()" class="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                                        „Ç≠„É£„É≥„Çª„É´
                                    </button>
                                    <button id="submitExtensionBtn" type="submit" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                        ÊúüÈôêÂª∂Èï∑„ÇíÁî≥Ë´ã
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÊàêÁ¥ÑÂ†±Âëä„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="contractSection" class="section" style="display: none;">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">ÊàêÁ¥ÑÂ†±Âëä</h2>
                        <p class="text-sm text-gray-600 mt-1">ÊàêÁ¥Ñ„Åó„ÅüÊ°à‰ª∂„ÅÆË©≥Á¥∞„ÇíÂ†±Âëä„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                    </div>
                </div>

                <!-- Ê§úÁ¥¢„Éê„Éº -->
                <div class="bg-white rounded-lg shadow p-4 mb-6">
                    <!-- Âü∫Êú¨Ê§úÁ¥¢ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                        <div class="lg:col-span-2">
                            <input type="text" id="contractSearchInput" placeholder="È°ßÂÆ¢Âêç„ÉªÈõªË©±Áï™Âè∑„Éª‰ΩèÊâÄ„ÅßÊ§úÁ¥¢ÔºàÈÉ®ÂàÜ‰∏ÄËá¥Ôºâ" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500" onkeyup="searchContractCases()">
                        </div>
                        <div>
                            <select id="contractAssigneeFilter" class="w-full px-4 py-2 border rounded-lg" onchange="searchContractCases()">
                                <option value="">ÊãÖÂΩìËÄÖ„ÅßÊ§úÁ¥¢</option>
                                <option value="self">Ëá™ÂàÜ„ÅÆÊ°à‰ª∂</option>
                                <option value="Áî∞‰∏≠Â§™ÈÉé">Áî∞‰∏≠Â§™ÈÉé</option>
                                <option value="‰ΩêËó§Ëä±Â≠ê">‰ΩêËó§Ëä±Â≠ê</option>
                                <option value="Èà¥Êú®‰∏ÄÈÉé">Èà¥Êú®‰∏ÄÈÉé</option>
                                <option value="È´òÊ©ã„Åø„ÇÜ„Åç">È´òÊ©ã„Åø„ÇÜ„Åç</option>
                                <option value="‰ºäËó§ÂÅ•">‰ºäËó§ÂÅ•</option>
                                <option value="Êú™Ââ≤ÂΩì">Êú™Ââ≤ÂΩì</option>
                            </select>
                        </div>
                    </div>

                    <!-- ÊúüÈñìÊ§úÁ¥¢ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex flex-col sm:flex-row sm:items-center gap-2">
                            <label class="text-xs text-gray-600 whitespace-nowrap">ÊµÅÂÖ•ÊúüÈñì</label>
                            <input type="date" id="contractStartDate" class="w-full sm:w-auto px-3 py-2 border rounded-lg" onchange="searchContractCases()">
                            <span class="text-xs text-gray-600 text-center sm:text-left">„Äú</span>
                            <input type="date" id="contractEndDate" class="w-full sm:w-auto px-3 py-2 border rounded-lg" onchange="searchContractCases()">
                        </div>
                        <div class="flex items-center justify-start md:justify-end">
                            <button onclick="searchContractCases()" class="w-full md:w-auto px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
                                Ê§úÁ¥¢
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Ê°à‰ª∂‰∏ÄË¶ß -->
                <div id="contractCasesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6">
                    <!-- Ê°à‰ª∂„Ç´„Éº„Éâ„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                </div>

                <!-- ÊàêÁ¥ÑÂ†±Âëä„É¢„Éº„ÉÄ„É´ -->
                <div id="contractModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto relative">
                        <!-- Èñâ„Åò„Çã„Éú„Çø„É≥ÔºàÂè≥‰∏äÔºâ -->
                        <button onclick="closeContractModal()" class="absolute top-4 right-4 p-2 rounded-lg hover:bg-gray-100 transition-colors z-10">
                            <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>

                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-4">ÊàêÁ¥ÑÂ†±Âëä</h3>

                            <!-- È°ßÂÆ¢ÊÉÖÂ†±Ë°®Á§∫ -->
                            <div id="contractCustomerInfo" class="hidden mb-4 p-4 bg-blue-50 rounded-lg">
                                <div class="text-lg font-semibold" id="contractCustomerName"></div>
                                <div class="text-gray-600" id="contractCustomerAddress"></div>
                            </div>

                            <!-- Ë≥™Âïè„Éï„Çß„Éº„Ç∫ -->
                            <div id="contractQuestionContainer">
                                <!-- Ë≥™Âïè„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                            </div>

                            <!-- „Éï„Ç©„Éº„É†„Éï„Çß„Éº„Ç∫ -->
                            <div id="contractFormPhase" class="hidden">
                                <form id="contractReportForm">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <!-- Â•ëÁ¥ÑÈáëÈ°ç -->
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Â•ëÁ¥ÑÈáëÈ°çÔºàÁ®éËæºÔºâ</label>
                                            <div class="flex items-center">
                                                <span class="mr-2">¬•</span>
                                                <input type="number" id="contractAmount" class="flex-1 px-3 py-2 border rounded-lg" placeholder="1234567" min="0" step="1" required="">
                                                <span class="ml-2">ÂÜÜ</span>
                                            </div>
                                        </div>

                                        <!-- ÂÆåÂ∑•Êó• -->
                                        <div class="min-w-0 flex-1">
                                            <label class="block text-sm font-medium text-gray-700 mb-2" id="completionDateLabel">ÂÆåÂ∑•‰∫àÂÆöÊó•</label>
                                            <input type="date" id="completionDate" class="w-full px-3 py-2 border rounded-lg" required="">
                                        </div>

                                        <!-- ÁùÄÈáëÊó• -->
                                        <div class="min-w-0 flex-1">
                                            <label class="block text-sm font-medium text-gray-700 mb-2" id="paymentDateLabel">ÁùÄÈáë‰∫àÂÆöÊó•</label>
                                            <input type="date" id="paymentDate" class="w-full px-3 py-2 border rounded-lg" required="">
                                        </div>

                                        <!-- ÂØæË±°Áâ©‰ª∂Á®ÆÂà• -->
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">ÂØæË±°Áâ©‰ª∂Á®ÆÂà•</label>

                                            <!-- Áâ©‰ª∂„Çø„Ç§„ÉóÔºàË§áÊï∞ÈÅ∏ÊäûÂèØÔºâ -->
                                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3">
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="propertyType" value="Êà∏Âª∫„Å¶" class="mr-2">
                                                    <span>Êà∏Âª∫„Å¶</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="propertyType" value="„Ç¢„Éë„Éº„Éà" class="mr-2">
                                                    <span>„Ç¢„Éë„Éº„Éà</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="propertyType" value="„Éû„É≥„Ç∑„Éß„É≥" class="mr-2">
                                                    <span>„Éû„É≥„Ç∑„Éß„É≥</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="propertyType" value="Â∫óËàó" class="mr-2">
                                                    <span>Â∫óËàó</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="propertyType" value="‰∫ãÂãôÊâÄ" class="mr-2">
                                                    <span>‰∫ãÂãôÊâÄ</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="propertyType" value="Â∑•Â†¥" class="mr-2">
                                                    <span>Â∑•Â†¥</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="propertyType" value="ÂÄâÂ∫´" class="mr-2">
                                                    <span>ÂÄâÂ∫´</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="propertyType" value="„Åù„ÅÆ‰ªñ" class="mr-2" onchange="toggleOtherPropertyDetails()">
                                                    <span>„Åù„ÅÆ‰ªñ</span>
                                                </label>
                                            </div>
                                            <input type="text" id="otherPropertyDetails" class="w-full px-3 py-2 border rounded-lg hidden" placeholder="„Åù„ÅÆ‰ªñ„ÅÆÁâ©‰ª∂Á®ÆÂà•„ÇíÂÖ•Âäõ">

                                            <!-- ÈöéÊï∞ÈÅ∏Êäû -->
                                            <div class="mt-3">
                                                <label class="block text-xs text-gray-600 mb-1">ÈöéÊï∞</label>
                                                <select id="buildingFloors" class="w-full px-3 py-2 border rounded-lg">
                                                    <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                                    <option value="1F">1F</option>
                                                    <option value="2F">2F</option>
                                                    <option value="3F">3F</option>
                                                    <option value="4F">4F</option>
                                                    <option value="5F">5F</option>
                                                    <option value="6F">6F</option>
                                                    <option value="7F">7F</option>
                                                    <option value="8F">8F</option>
                                                    <option value="9F">9F</option>
                                                    <option value="10F‰ª•‰∏ä">10F‰ª•‰∏ä</option>
                                                </select>
                                            </div>
                                        </div>

                                        <!-- ÊñΩÂ∑•ÂÜÖÂÆπ -->
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">ÊñΩÂ∑•ÂÜÖÂÆπÔºàË§áÊï∞ÈÅ∏ÊäûÂèØÔºâ</label>
                                            <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-3">
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â§ñÂ£ÅÂ°óË£Ö" class="mr-2">
                                                    <span>Â§ñÂ£ÅÂ°óË£Ö</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï" class="mr-2">
                                                    <span>Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â§ñÂ£ÅÂºµÊõø„Åà" class="mr-2">
                                                    <span>Â§ñÂ£ÅÂºµÊõø„Åà</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â±ãÊ†πÂ°óË£Ö" class="mr-2">
                                                    <span>Â±ãÊ†πÂ°óË£Ö</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â±ã‰∏äÈò≤Ê∞¥" class="mr-2">
                                                    <span>Â±ã‰∏äÈò≤Ê∞¥</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â±ãÊ†πËë∫„ÅçÊõø„ÅàÔºà„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„ÉêÔºâ" class="mr-2">
                                                    <span>Â±ãÊ†πËë∫„ÅçÊõø„ÅàÔºà„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„ÉêÔºâ</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â±ãÊ†πËë∫„ÅçÊõø„ÅàÔºàÁì¶Ôºâ" class="mr-2">
                                                    <span>Â±ãÊ†πËë∫„ÅçÊõø„ÅàÔºàÁì¶Ôºâ</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï" class="mr-2">
                                                    <span>Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â§ñÂ£ÅË£ú‰øÆ" class="mr-2">
                                                    <span>Â§ñÂ£ÅË£ú‰øÆ</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â±ãÊ†πË£ú‰øÆ" class="mr-2">
                                                    <span>Â±ãÊ†πË£ú‰øÆ</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="„Éô„É©„É≥„ÉÄÈò≤Ê∞¥" class="mr-2">
                                                    <span>„Éô„É©„É≥„ÉÄÈò≤Ê∞¥</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Èõ®Êºè„Çä‰øÆÁπï" class="mr-2">
                                                    <span>Èõ®Êºè„Çä‰øÆÁπï</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="ÂÜÖË£ÖÊ∞¥Âõû„ÇäÔºà„Éê„Çπ„Éª„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éà„Ç§„É¨Ôºâ" class="mr-2">
                                                    <span>ÂÜÖË£ÖÊ∞¥Âõû„Çä</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="ÂÜÖË£ÖÔºàÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâ" class="mr-2">
                                                    <span>ÂÜÖË£ÖÔºàÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâ</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="„Åù„ÅÆ‰ªñ" class="mr-2" onchange="toggleOtherWorkDetails()">
                                                    <span>„Åù„ÅÆ‰ªñ</span>
                                                </label>
                                            </div>
                                            <textarea id="workDetails" class="w-full px-3 py-2 border rounded-lg hidden" rows="3" placeholder="„Åù„ÅÆ‰ªñ„ÅÆÊñΩÂ∑•ÂÜÖÂÆπ„ÇíÂÖ•Âäõ"></textarea>
                                        </div>

                                        <!-- Ë¶ãÁ©çÊõ∏„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ -->
                                        <div class="min-w-0 flex-1">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Ë¶ãÁ©çÊõ∏</label>
                                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                                                <input type="file" id="estimateFile" accept="image/*,application/pdf" class="hidden" onchange="handleFileUpload(event, 'estimate')">
                                                <div id="estimatePreview" class="mb-2">
                                                    <svg class="w-12 h-12 text-gray-400 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                                    </svg>
                                                </div>
                                                <button type="button" onclick="document.getElementById('estimateFile').click()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                                    „Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû
                                                </button>
                                                <p class="text-xs text-gray-500 mt-2">ÁîªÂÉè„Åæ„Åü„ÅØPDF</p>
                                            </div>
                                        </div>

                                        <!-- È†òÂèéÊõ∏„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ -->
                                        <div class="min-w-0 flex-1">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">È†òÂèéÊõ∏</label>
                                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                                                <input type="file" id="receiptFile" accept="image/*,application/pdf" class="hidden" onchange="handleFileUpload(event, 'receipt')">
                                                <div id="receiptPreview" class="mb-2">
                                                    <svg class="w-12 h-12 text-gray-400 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                                    </svg>
                                                </div>
                                                <button type="button" onclick="document.getElementById('receiptFile').click()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                                    „Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû
                                                </button>
                                                <p class="text-xs text-gray-500 mt-2">ÁîªÂÉè„Åæ„Åü„ÅØPDF</p>
                                            </div>
                                        </div>

                                        <!-- ÂÇôËÄÉ -->
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">ÂÇôËÄÉ</label>
                                            <textarea id="contractNotes" class="w-full px-3 py-2 border rounded-lg" rows="3" placeholder="ÁâπË®ò‰∫ãÈ†Ö„Åå„ÅÇ„Çå„Å∞ÂÖ•Âäõ"></textarea>
                                        </div>
                                    </div>

                                    <div class="mt-6 flex justify-center">
                                        <button type="submit" class="px-8 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 font-medium">
                                            ÊàêÁ¥ÑÂ†±Âëä„ÇíÈÄÅ‰ø°
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="settingsSection" class="section" style="display: none;">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Ë®≠ÂÆö</h2>
                
                <!-- „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
                <!-- „Çø„Éñ„ÇíÂâäÈô§„Åó„Å¶1„Éö„Éº„Ç∏Áµ±Âêà -->
                
                <!-- „Éó„É≠„Éï„Ç£„Éº„É´ÊÉÖÂ†± -->
                <div id="profileSection">
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">„Éó„É≠„Éï„Ç£„Éº„É´ÊÉÖÂ†±</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Ê∞èÂêç</label>
                                <input type="text" id="profileName" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="Áî∞‰∏≠Â§™ÈÉé">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ÈõªË©±Áï™Âè∑</label>
                                <input type="tel" id="profilePhone" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="090-1234-5678">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                                <input type="email" id="profileEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="tanaka@example.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">LINE ID</label>
                                <input type="text" id="profileLineId" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="@tanaka_taro">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÈÄöÁü•„Éª„Ç¢„É©„Éº„ÉàË®≠ÂÆö -->
                <div id="notificationSection" class="mt-6">
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">ÈÄöÁü•„Éª„Ç¢„É©„Éº„ÉàË®≠ÂÆö</h3>
                        
                        <!-- ÈÄöÁü•ÊñπÊ≥ï -->
                        <div class="mb-6">
                            <h4 class="text-sm font-medium text-gray-700 mb-3">ÈÄöÁü•ÊñπÊ≥ï</h4>
                            <div class="space-y-3">
                                <label class="flex items-center justify-between">
                                    <span class="text-sm text-gray-700">„É°„Éº„É´ÈÄöÁü•</span>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="notifyEmail" class="toggle-switch" checked="">
                                        <button onclick="testNotification('email')" class="ml-3 text-xs text-blue-600 hover:text-blue-800">„ÉÜ„Çπ„ÉàÈÄÅ‰ø°</button>
                                    </div>
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-sm text-gray-700">SMSÈÄöÁü•</span>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="notifySms" class="toggle-switch">
                                        <button onclick="testNotification('sms')" class="ml-3 text-xs text-blue-600 hover:text-blue-800">„ÉÜ„Çπ„ÉàÈÄÅ‰ø°</button>
                                    </div>
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-sm text-gray-700">LINEÈÄöÁü•</span>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="notifyLine" class="toggle-switch">
                                        <button onclick="testNotification('line')" class="ml-3 text-xs text-blue-600 hover:text-blue-800">„ÉÜ„Çπ„ÉàÈÄÅ‰ø°</button>
                                    </div>
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-sm text-gray-700">„Éñ„É©„Ç¶„Ç∂ÈÄöÁü•</span>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="notifyBrowser" class="toggle-switch" checked="">
                                        <button onclick="testNotification('browser')" class="ml-3 text-xs text-blue-600 hover:text-blue-800">„ÉÜ„Çπ„ÉàÈÄÅ‰ø°</button>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <!-- ÈÄöÁü•Á®ÆÂà• -->
                        <div class="mb-6">
                            <h4 class="text-sm font-medium text-gray-700 mb-3">ÈÄöÁü•Á®ÆÂà•</h4>
                            <div class="space-y-3">
                                <!-- „Ç¢„Éù„Ç§„É≥„Éà„É™„Éû„Ç§„É≥„ÉÄ„Éº -->
                                <div class="border rounded-lg p-3 bg-gray-50 group relative">
                                    <label class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <span class="text-lg mr-2">üìã</span>
                                            <span class="text-sm font-medium text-gray-700">ÁèæË™øÂâçÊó•„É™„Éû„Ç§„É≥„ÉÄ„Éº</span>
                                            <span class="ml-1 text-gray-400 cursor-help">‚ìò</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="time" id="appointmentAlertTime" value="18:00" class="px-2 py-1 border rounded text-sm">
                                            <input type="checkbox" id="appointmentReminder" class="toggle-switch" checked="" onchange="updateAlertSetting('appointment_reminder', this.checked)">
                                        </div>
                                    </label>
                                    <div class="absolute left-0 top-full mt-1 hidden group-hover:block bg-gray-800 text-white text-xs rounded px-2 py-1 z-10 whitespace-nowrap">
                                        ÁèæÂú∞Ë™øÊüª„ÅÆÂâçÊó•„Å´ÈÄöÁü•„Åó„Åæ„Åô
                                    </div>
                                </div>

                                <!-- Êû∂Èõª„É™„Éû„Ç§„É≥„ÉÄ„Éº -->
                                <div class="border rounded-lg p-3 bg-gray-50 group relative">
                                    <label class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <span class="text-lg mr-2">üìû</span>
                                            <span class="text-sm font-medium text-gray-700">Êû∂Èõª„É™„Éû„Ç§„É≥„ÉÄ„Éº</span>
                                            <span class="ml-1 text-gray-400 cursor-help">‚ìò</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="time" id="callAlertTime" value="10:00" class="px-2 py-1 border rounded text-sm">
                                            <input type="checkbox" id="callReminder" class="toggle-switch" checked="" onchange="updateAlertSetting('call_reminder', this.checked)">
                                        </div>
                                    </label>
                                    <div class="absolute left-0 top-full mt-1 hidden group-hover:block bg-gray-800 text-white text-xs rounded px-2 py-1 z-10 whitespace-nowrap">
                                        Êú™ÂØæÂøúÊ°à‰ª∂„ÅÆÁøåÊó•„Å´ÈÄöÁü•„Åó„Åæ„Åô
                                    </div>
                                </div>

                                <!-- Ë¶ãÁ©ç„Éï„Ç©„É≠„Éº -->
                                <div class="border rounded-lg p-3 bg-gray-50 group relative">
                                    <label class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <span class="text-lg mr-2">üìù</span>
                                            <span class="text-sm font-medium text-gray-700">Ë¶ãÁ©ç„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó</span>
                                            <span class="ml-1 text-gray-400 cursor-help">‚ìò</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="number" id="followupDays" value="7" min="1" max="30" class="w-16 px-2 py-1 border rounded text-sm">
                                            <span class="text-sm text-gray-600">Êó•Âæå</span>
                                            <input type="checkbox" id="estimateFollowup" class="toggle-switch" checked="" onchange="updateAlertSetting('estimate_followup', this.checked)">
                                        </div>
                                    </label>
                                    <div class="absolute left-0 top-full mt-1 hidden group-hover:block bg-gray-800 text-white text-xs rounded px-2 py-1 z-10 whitespace-nowrap">
                                        Ë¶ãÁ©çÊèêÂá∫Âæå„Å´Ëá™Âãï„Åß„Éï„Ç©„É≠„ÉºÈÄöÁü•„Åó„Åæ„Åô
                                    </div>
                                </div>

                                <!-- ÂÖ•ÈáëÁ¢∫Ë™ç -->
                                <div class="border rounded-lg p-3 bg-gray-50 group relative">
                                    <label class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <span class="text-lg mr-2">üí∞</span>
                                            <span class="text-sm font-medium text-gray-700">ÂÖ•ÈáëÁ¢∫Ë™ç„Ç¢„É©„Éº„Éà</span>
                                            <span class="ml-1 text-gray-400 cursor-help">‚ìò</span>
                                        </div>
                                        <input type="checkbox" id="paymentAlert" class="toggle-switch" checked="" onchange="updateAlertSetting('payment_alert', this.checked)">
                                    </label>
                                    <div class="absolute left-0 top-full mt-1 hidden group-hover:block bg-gray-800 text-white text-xs rounded px-2 py-1 z-10 whitespace-nowrap">
                                        ÂÖ•Èáë‰∫àÂÆöÊó•„Å´Ëá™Âãï„ÅßÈÄöÁü•„Åó„Åæ„Åô
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ÈÄöÁü•ÊôÇÈñì„Éª‰ºëÊó•Ë®≠ÂÆö -->
                        <div class="mb-6">
                            <h4 class="text-sm font-medium text-gray-700 mb-3">ÈÄöÁü•ÊôÇÈñì„Éª‰ºëÊó•Ë®≠ÂÆö</h4>
                            <div class="space-y-4">
                                <!-- ‰ºëÊó•Ë®≠ÂÆö -->
                                <div class="border rounded-lg p-4 bg-gray-50">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="enableHolidays" onchange="toggleHolidaySettings()" checked="">
                                        <span class="ml-2 text-sm font-medium text-gray-700">üìÖ ‰ºëÊó•Ë®≠ÂÆöÔºà„ÉÅ„Çß„ÉÉ„ÇØ„Åó„ÅüÊõúÊó•„ÅØÈÄöÁü•„Åï„Çå„Åæ„Åõ„ÇìÔºâ</span>
                                    </label>
                                    <div id="holidaySettings" class="mt-3 flex flex-wrap gap-3">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="holidayMon" class="mr-2">
                                            <span class="text-sm">Êúà</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="holidayTue" class="mr-2">
                                            <span class="text-sm">ÁÅ´</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="holidayWed" class="mr-2">
                                            <span class="text-sm">Ê∞¥</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="holidayThu" class="mr-2">
                                            <span class="text-sm">Êú®</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="holidayFri" class="mr-2">
                                            <span class="text-sm">Èáë</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="holidaySat" class="mr-2" checked="">
                                            <span class="text-sm font-medium text-blue-600">Âúü</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="holidaySun" class="mr-2" checked="">
                                            <span class="text-sm font-medium text-red-600">Êó•</span>
                                        </label>
                                    </div>
                                </div>

                                <!-- ÈÄöÁü•Âà∂ÈôêÊôÇÈñì -->
                                <div class="border rounded-lg p-4 bg-gray-50">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="enableQuietHours" onchange="toggleQuietHours()" checked="">
                                        <span class="ml-2 text-sm font-medium text-gray-700">üîï ÈÄöÁü•„ÇíÂà∂Èôê„Åô„ÇãÊôÇÈñìÂ∏Ø</span>
                                    </label>
                                    <div id="quietHoursSettings" class="mt-3 space-y-2">
                                        <div class="flex items-center space-x-2">
                                            <input type="time" id="quietStart" value="22:00" class="px-3 py-2 border border-gray-300 rounded-lg">
                                            <span class="text-sm text-gray-500">„Åã„Çâ</span>
                                            <input type="time" id="quietEnd" value="08:00" class="px-3 py-2 border border-gray-300 rounded-lg">
                                            <span class="text-sm text-gray-500">„Åæ„Åß</span>
                                        </div>
                                        <p class="text-xs text-gray-500">„Åì„ÅÆÊôÇÈñìÂ∏Ø„ÅØÈÄöÁü•„ÇíÈÄÅ‰ø°„Åó„Åæ„Åõ„Çì</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Áµ±Âêà‰øùÂ≠ò„Éú„Çø„É≥ -->
                    <div class="mt-6 flex justify-end">
                        <button onclick="saveAllSettings()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
                            Ë®≠ÂÆö„Çí‰øùÂ≠ò
                        </button>
                    </div>
                </div>
            </div>
        </main></div><!-- settingsSection„ÅÆÁµÇ‰∫Ü -->
    

    <!-- Ê®©ÈôêË®≠ÂÆö„É¢„Éº„ÉÄ„É´ -->
    <div id="permissionModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white">
            <div class="mb-4">
                <h3 class="text-lg font-bold text-gray-900" id="modalTitle">Âñ∂Ê•≠Ê®©ÈôêË®≠ÂÆö</h3>
                <p class="text-sm text-gray-500 mt-1">Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„ÅÆÊ®©Èôê„ÇíË©≥Á¥∞„Å´Ë®≠ÂÆö„Åß„Åç„Åæ„Åô</p>
            </div>
            <!-- Êñ∞Ë¶èËøΩÂä†ÊôÇ„ÅÆÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ -->
            <div id="newSalesFields" class="mb-6 hidden">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Ê∞èÂêç <span class="text-red-500">*</span></label>
                        <input type="text" id="newSalesName" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‰æãÔºöÂ±±Áî∞Â§™ÈÉé">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ <span class="text-red-500">*</span></label>
                        <input type="email" id="newSalesEmail" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="example@company.com">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÈõªË©±Áï™Âè∑</label>
                        <input type="tel" id="newSalesPhone" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="090-1234-5678">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÂΩπËÅ∑</label>
                        <select id="newSalesRole" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="‰∏ÄËà¨Âñ∂Ê•≠">‰∏ÄËà¨Âñ∂Ê•≠</option>
                            <option value="„É™„Éº„ÉÄ„Éº">„É™„Éº„ÉÄ„Éº</option>
                            <option value="‰∏ÄËà¨‰∫ãÂãô">‰∏ÄËà¨‰∫ãÂãô</option>
                            <option value="ÁèæÂ†¥Áõ£Áù£">ÁèæÂ†¥Áõ£Áù£</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Ê®©Èôê„Éó„É™„Çª„ÉÉ„Éà</label>
                <div class="grid grid-cols-4 gap-2">
                    <button onclick="setPreset('office')" class="preset-btn px-4 py-2 border rounded-lg hover:bg-gray-50">‰∏ÄËà¨‰∫ãÂãô</button>
                    <button onclick="setPreset('standard')" class="preset-btn px-4 py-2 border rounded-lg hover:bg-gray-50">‰∏ÄËà¨Âñ∂Ê•≠</button>
                    <button onclick="setPreset('leader')" class="preset-btn px-4 py-2 border rounded-lg hover:bg-gray-50">„É™„Éº„ÉÄ„Éº</button>
                    <button onclick="setPreset('admin')" class="preset-btn px-4 py-2 border rounded-lg hover:bg-gray-50">ÂâØÁÆ°ÁêÜËÄÖ</button>
                </div>
            </div>

            <h3 class="text-sm font-medium text-gray-700 mb-3">„Ç´„Çπ„Çø„É†Ë®≠ÂÆö</h3>
            <div class="permission-grid mb-6">
                <!-- Ê°à‰ª∂Èñ¢ÈÄ£ -->
                <div class="border rounded-lg p-4">
                    <h4 class="font-medium text-gray-900 mb-3">Ê°à‰ª∂Èñ¢ÈÄ£</h4>
                    <div class="space-y-2">
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="case.view.all">
                            <span class="ml-2">‰ªñÊãÖÂΩìËÄÖ„ÅÆÊ°à‰ª∂Èñ≤Ë¶ß</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                ‰ªñ„ÅÆÊãÖÂΩìËÄÖ„ÅÆÊ°à‰ª∂„ÇÇÈñ≤Ë¶ß„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="case.edit">
                            <span class="ml-2">‰ªñÊãÖÂΩìËÄÖ„ÅÆÊ°à‰ª∂Á∑®ÈõÜ</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                ‰ªñ„ÅÆÊãÖÂΩìËÄÖ„ÅÆÊ°à‰ª∂„ÇÇÁ∑®ÈõÜ„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="case.hide">
                            <span class="ml-2">Ê°à‰ª∂ÈùûË°®Á§∫Âåñ</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                ‰ªªÊÑè„ÅÆÊ°à‰ª∂„Çí‰∏ÄÊôÇÁöÑ„Å´ÈùûË°®Á§∫„Å´„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="case.delete">
                            <span class="ml-2">Ê°à‰ª∂ÂâäÈô§Ôºà24ÊôÇÈñì‰ª•ÂÜÖÔºâ</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                Ë™§ÂÖ•Âäõ„Åó„ÅüÊ°à‰ª∂„Çí24ÊôÇÈñì‰ª•ÂÜÖ„Å´Èôê„ÇäÂâäÈô§„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="case.cancel">
                            <span class="ml-2">„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                Ëá™ÂàÜ„ÅåÊãÖÂΩì„Åô„ÇãÊ°à‰ª∂„ÅÆ„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÇíË°å„Åà„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="case.contract">
                            <span class="ml-2">ÊàêÁ¥ÑÂ†±Âëä</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                Ëá™ÂàÜ„ÅåÊãÖÂΩì„Åô„ÇãÊ°à‰ª∂„ÅÆÊàêÁ¥ÑÂ†±Âëä„ÇíÁôªÈå≤„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö -->
                <div class="border rounded-lg p-4">
                    <h4 class="font-medium text-gray-900 mb-3">Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö</h4>
                    <div class="space-y-2">
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="automail.view">
                            <span class="ml-2">ÈÖç‰ø°Êù°‰ª∂Èñ≤Ë¶ß</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                Ëá™ÂãïÈÖç‰ø°„ÅÆË®≠ÂÆö„ÇíÈñ≤Ë¶ß„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="automail.edit">
                            <span class="ml-2">ÈÖç‰ø°Êù°‰ª∂Á∑®ÈõÜ</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                Ëá™ÂãïÈÖç‰ø°„ÅÆÊù°‰ª∂„ÇíÁ∑®ÈõÜ„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Ë≤°ÂãôÊÉÖÂ†± -->
                <div class="border rounded-lg p-4">
                    <h4 class="font-medium text-gray-900 mb-3">Ë≤°ÂãôÊÉÖÂ†±</h4>
                    <div class="space-y-2">
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="finance.view">
                            <span class="ml-2">Â£≤‰∏äÈñ≤Ë¶ß</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                Â£≤‰∏ä„ÉªË≤°ÂãôÊÉÖÂ†±„ÇíÈñ≤Ë¶ß„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="finance.export">
                            <span class="ml-2">„Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                Ë≤°Âãô„Éá„Éº„Çø„ÇíCSVÂá∫Âäõ„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                    </div>
                </div>

                <!-- „É¨„Éù„Éº„Éà„ÉªÂñ∂Ê•≠ÁÆ°ÁêÜ -->
                <div class="border rounded-lg p-4">
                    <h4 class="font-medium text-gray-900 mb-3">„É¨„Éù„Éº„Éà„ÉªÂñ∂Ê•≠ÁÆ°ÁêÜ</h4>
                    <div class="space-y-2">
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="report.self">
                            <span class="ml-2">„É¨„Éù„Éº„ÉàÈñ≤Ë¶ßÔºàËá™ÂàÜ„ÅÆÊàêÁ∏æ„ÅÆ„ÅøÔºâ</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                Ëá™ÂàÜ„ÅÆÊàêÁ∏æ„É¨„Éù„Éº„Éà„ÇíÈñ≤Ë¶ß„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="report.all">
                            <span class="ml-2">ÂÖ®‰Ωì„É¨„Éù„Éº„ÉàÈñ≤Ë¶ß</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                ÂÖ®Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„ÅÆÊàêÁ∏æ„ÇíÈñ≤Ë¶ß„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="report.export">
                            <span class="ml-2">„É¨„Éù„Éº„ÉàCSVÂá∫Âäõ</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                „É¨„Éù„Éº„Éà„Éá„Éº„Çø„ÇíCSVÂá∫Âäõ„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="sales.manage">
                            <span class="ml-2">Âñ∂Ê•≠ÊãÖÂΩìËÄÖÁÆ°ÁêÜ</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„ÇíËøΩÂä†„ÉªÂâäÈô§„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                    </div>
                </div>

                <!-- ‰ºöÁ§æÊÉÖÂ†± -->
                <div class="border rounded-lg p-4">
                    <h4 class="font-medium text-gray-900 mb-3">‰ºöÁ§æÊÉÖÂ†±</h4>
                    <div class="space-y-2">
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="company.view">
                            <span class="ml-2">‰ºöÁ§æÊÉÖÂ†±Èñ≤Ë¶ß</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                ‰ºöÁ§æÊÉÖÂ†±„ÇíÈñ≤Ë¶ß„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="company.edit">
                            <span class="ml-2">‰ºöÁ§æÊÉÖÂ†±‰øÆÊ≠£</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                ‰ºöÁ§æÊÉÖÂ†±„ÇíÁ∑®ÈõÜ„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="flex justify-end space-x-3">
                <button onclick="closePermissionModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">
                    „Ç≠„É£„É≥„Çª„É´
                </button>
                <button onclick="savePermissions()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    ‰øùÂ≠ò
                </button>
            </div>
        </div>
    </div>
    <!-- mainApp end -->

    <!-- „Ç¢„É©„Éº„ÉàÈÄöÁü•„Éë„Éç„É´ -->
    <!-- Êú¨ÈÉ®„Åã„Çâ„ÅÆÈÄöÁü•„Éë„Éç„É´ -->
    <div id="notificationPanel" class="fixed top-20 right-4 w-96 max-h-[600px] bg-white rounded-lg shadow-2xl hidden z-50 overflow-hidden">
        <div class="bg-gradient-to-r from-yellow-500 to-orange-600 text-white p-4">
            <div class="flex items-center justify-between">
                <h3 class="font-bold text-lg flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                    </svg>
                    Êú¨ÈÉ®„Åã„Çâ„ÅÆÈÄöÁü•
                </h3>
                <button onclick="toggleNotificationPanel()" class="hover:bg-white hover:bg-opacity-20 rounded-lg p-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>

        <div class="overflow-y-auto max-h-[500px]">
            <div id="notificationList" class="p-4">
                <p class="text-gray-500 text-center py-8">Êñ∞„Åó„ÅÑÈÄöÁü•„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>
            </div>
        </div>
    </div>

    <!-- „Ç¢„É©„Éº„Éà„Éª„É™„Éû„Ç§„É≥„ÉÄ„Éº„Éë„Éç„É´ -->
    <div id="alertPanel" class="fixed top-20 right-4 w-96 max-h-[600px] bg-white rounded-lg shadow-2xl hidden z-50 overflow-hidden">
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4">
            <div class="flex items-center justify-between">
                <h3 class="font-bold text-lg flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                    </svg>
                    „Ç¢„É©„Éº„Éà„Éª„É™„Éû„Ç§„É≥„ÉÄ„Éº
                </h3>
                <button onclick="toggleAlertPanel()" class="hover:bg-white hover:bg-opacity-20 rounded-lg p-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>

        <div class="overflow-y-auto max-h-[500px]">
            <!-- ‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ -->
            <div class="border-b">
                <div class="p-4">
                    <h4 class="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                        <span class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
                        ‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ
                    </h4>
                    <div id="todayTasks" class="space-y-2">
                        <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                    </div>
                </div>
            </div>

            <!-- ÊòéÊó•„ÅÆ‰∫àÂÆö -->
            <div class="border-b">
                <div class="p-4">
                    <h4 class="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                        <span class="w-2 h-2 bg-yellow-500 rounded-full"></span>
                        ÊòéÊó•„ÅÆ‰∫àÂÆö
                    </h4>
                    <div id="tomorrowTasks" class="space-y-2">
                        <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                    </div>
                </div>
            </div>

            <!-- Ëá™Âãï„Ç¢„É©„Éº„Éà -->
            <div class="border-b">
                <div class="p-4">
                    <h4 class="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                        <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                        Ëá™Âãï„É™„Éû„Ç§„É≥„ÉÄ„Éº
                    </h4>
                    <div id="autoAlerts" class="space-y-2">
                        <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                    </div>
                </div>
            </div>

            <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
            <div class="p-4 bg-gray-50">
                <button onclick="showSection('settings'); setTimeout(() =&gt; { document.getElementById('notificationSection').scrollIntoView({ behavior: 'smooth' }); }, 100)" class="w-full px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                    „Ç¢„É©„Éº„ÉàË®≠ÂÆö„ÇíÈñã„Åè
                </button>
            </div>
        </div>
    </div>


    <!-- ‰ºöÁ§æÊÉÖÂ†±„Éó„É¨„Éì„É•„Éº„É¢„Éº„ÉÄ„É´ -->
    <div id="companyPreviewModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 overflow-y-auto hidden">
        <div class="relative min-h-screen py-12 px-4">
            <div class="relative bg-white rounded-2xl max-w-6xl mx-auto shadow-2xl">
                <!-- „É¢„Éº„ÉÄ„É´„Éò„ÉÉ„ÉÄ„ÉºÔºà„Çπ„Éû„ÉõÊúÄÈÅ©ÂåñÔºâ -->
                <div class="sticky top-0 bg-white rounded-t-2xl border-b z-10">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center p-4 sm:p-6 gap-3 sm:gap-4">
                        <h2 class="text-xl sm:text-2xl font-bold text-gray-900 text-center sm:text-left">‰ºöÁ§æÊÉÖÂ†±„Éó„É¨„Éì„É•„Éº</h2>
                        <div class="flex items-center justify-center sm:justify-end gap-2 sm:gap-4">
                            <button onclick="saveFromPreview()" class="bg-green-600 text-white px-4 sm:px-6 py-2 sm:py-2.5 rounded-lg hover:bg-green-700 flex items-center gap-2 transition font-medium text-sm sm:text-base shadow-md">
                                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"></path>
                                </svg>
                                <span>ÂÖ¨Èñã</span>
                            </button>
                            <button onclick="closePreviewModal()" class="p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors" title="Èñâ„Åò„Çã">
                                <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- „Éó„É¨„Éì„É•„Éº„Ç≥„É≥„ÉÜ„É≥„ÉÑÔºà„Çπ„Éû„ÉõÊúÄÈÅ©ÂåñÔºâ -->
                <div class="px-3 sm:px-6 py-4 sm:py-6">

                    <!-- „Éõ„Éº„É†„Éö„Éº„Ç∏URL„Çª„ÇØ„Ç∑„Éß„É≥Ôºà„Çπ„Éû„ÉõÊúÄÈÅ©ÂåñÔºâ -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-4 sm:p-6 mb-6 sm:mb-8">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4 mb-4">
                            <h3 class="text-base sm:text-lg font-semibold text-blue-900 flex items-center gap-2 text-center sm:text-left">
                                üè† „ÅÇ„Å™„Åü„ÅÆ‰ºöÁ§æ„ÅÆ„Éõ„Éº„É†„Éö„Éº„Ç∏
                            </h3>
                            <button id="previewVisitUrlBtn" onclick="visitPreviewHP()" class="bg-blue-600 text-white px-4 sm:px-6 py-2 sm:py-2.5 rounded-lg hover:bg-blue-700 flex items-center justify-center text-sm font-medium transition-colors shadow-md w-full sm:w-auto" disabled>
                                <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                                „Éõ„Éº„É†„Éö„Éº„Ç∏„ÇíË¶ã„Çã
                            </button>
                        </div>

                        <!-- ÁèæÂú®„ÅÆ„Éõ„Éº„É†„Éö„Éº„Ç∏URLË°®Á§∫Ôºà„Çπ„Éû„ÉõÊúÄÈÅ©ÂåñÔºâ -->
                        <div class="bg-white border border-blue-200 rounded-lg p-3 sm:p-4 shadow-sm">
                            <div class="flex flex-col space-y-2 sm:space-y-3">
                                <div class="bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5 sm:py-3 text-xs sm:text-sm text-gray-700 overflow-hidden">
                                    <div class="break-all leading-relaxed">
                                        <span id="previewCurrentFullUrl" class="text-blue-600 font-medium">Ë™≠„ÅøËæº„Åø‰∏≠...</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„Çª„ÇØ„Ç∑„Éß„É≥ -->
                    <div id="previewMainVisualSection" class="relative mb-12 overflow-hidden hidden">
                        <div class="relative" style="height: 500px; overflow: hidden; cursor: move;" id="mainVisualContainer">
                            <img id="previewMainVisual" src="" alt="" class="w-full h-full object-cover" style="object-position: center;" draggable="false">
                            <div id="brightnessOverlay" class="absolute bottom-0 left-0 right-0 h-[30%] bg-gradient-to-b from-transparent to-transparent" style="pointer-events: none;"></div>

                            <!-- ‰ºöÁ§æÂêç„Å®ÊÉÖÂ†±„Çí„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
                            <div class="absolute bottom-0 left-0 right-0 p-4 sm:p-8 text-white">
                                <h1 id="previewCompanyNameOverlay" class="text-3xl sm:text-5xl md:text-6xl font-bold mb-2 drop-shadow-lg text-center sm:text-left break-words text-gray-800" style="min-width: 0px; color: rgb(31, 41, 55); line-height: 1.2; word-break: break-word; overflow-wrap: break-word;"></h1>
                                <p id="previewTaglineOverlay" class="text-lg sm:text-3xl mb-4 drop-shadow-md text-center sm:text-left text-gray-800" style="color: rgb(31, 41, 55);"></p>
                                <div class="flex flex-wrap gap-4 text-gray-800" style="color: rgb(31, 41, 55);">
                                    <div class="flex items-center bg-white/20 backdrop-blur px-4 py-2 rounded-full text-gray-800" style="color: rgb(31, 41, 55);">
                                        <svg class="w-5 h-5 mr-2 text-gray-800" fill="currentColor" viewBox="0 0 20 20" style="color: rgb(31, 41, 55);">
                                            <path d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm3 1h6v4H7V5zm6 6H7v2h6v-2z" class="text-gray-800" style="color: rgb(31, 41, 55);"></path>
                                        </svg>
                                        <span id="previewEstablishedOverlay" class="text-gray-800" style="color: rgb(31, 41, 55);"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Ë™øÊï¥„Ç≥„É≥„Éà„É≠„Éº„É´„Éà„Ç∞„É´„Éú„Çø„É≥ -->
                        <button onclick="toggleImageControls()" class="absolute top-4 right-4 bg-white rounded-lg shadow-lg p-2 hover:bg-gray-50 transition" title="ÁîªÂÉèË™øÊï¥">
                            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path>
                            </svg>
                        </button>

                        <!-- Ë™øÊï¥„Ç≥„É≥„Éà„É≠„Éº„É´„Éë„Éç„É´ -->
                        <div id="visualControls" class="absolute top-14 right-4 bg-white rounded-lg shadow-lg p-2 hidden w-48">
                            <div class="text-xs font-medium text-gray-700 mb-2">ÁîªÂÉèË™øÊï¥</div>
                            <div class="space-y-2">
                                <div>
                                    <label class="text-xs text-gray-600">‰ΩçÁΩÆË™øÊï¥</label>
                                    <div class="grid grid-cols-3 gap-1 w-24 mx-auto mt-1">
                                        <div class="min-w-0 flex-1"></div>
                                        <button onclick="adjustImagePosition('up')" class="p-1 hover:bg-gray-100 rounded" title="‰∏ä„Å´ÁßªÂãï">
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>
                                        </button>
                                        <div class="min-w-0 flex-1"></div>
                                        <button onclick="adjustImagePosition('left')" class="p-1 hover:bg-gray-100 rounded" title="Â∑¶„Å´ÁßªÂãï">
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                                        </button>
                                        <button onclick="adjustImagePosition('center')" class="p-1 hover:bg-gray-100 rounded" title="‰∏≠Â§Æ„Å´„É™„Çª„ÉÉ„Éà">
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3" stroke-width="2"></circle></svg>
                                        </button>
                                        <button onclick="adjustImagePosition('right')" class="p-1 hover:bg-gray-100 rounded" title="Âè≥„Å´ÁßªÂãï">
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                                        </button>
                                        <div class="min-w-0 flex-1"></div>
                                        <button onclick="adjustImagePosition('down')" class="p-1 hover:bg-gray-100 rounded" title="‰∏ã„Å´ÁßªÂãï">
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                        </button>
                                        <div class="min-w-0 flex-1"></div>
                                    </div>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-600">„Ç∫„Éº„É†</label>
                                    <input type="range" id="imageZoom" min="100" max="150" value="100" class="w-full" onchange="adjustImageZoom(this.value)">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-600">Êòé„Çã„ÅïË™øÊï¥</label>
                                    <input type="range" id="imageOpacity" min="0" max="100" value="100" class="w-full" onchange="adjustImageOpacity(this.value)">
                                    <div class="flex justify-between text-xs text-gray-400">
                                        <span>Èªí</span>
                                        <span>ÁôΩ</span>
                                    </div>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-600 block mb-1">ÊñáÂ≠óËâ≤</label>
                                    <div class="flex gap-1 items-center">
                                        <input type="color" id="textColorPicker" value="#000000" class="w-10 h-6 rounded cursor-pointer" oninput="adjustTextColor(this.value)">
                                        <button onclick="document.getElementById('textColorPicker').value='#ffffff'; adjustTextColor('#ffffff')" class="w-5 h-5 rounded border border-gray-300 bg-white" title="ÁôΩ"></button>
                                        <button onclick="document.getElementById('textColorPicker').value='#000000'; adjustTextColor('#000000')" class="w-5 h-5 rounded border border-gray-300 bg-black" title="Èªí"></button>
                                    </div>
                                </div>

                                <!-- ‰ºöÁ§æÂêçË°®Á§∫ÊñπÊ≥ï -->
                                <div id="previewTradeNameOptions" style="display: block;">
                                    <label class="text-xs text-gray-600 block mb-1">‰ºöÁ§æÂêçË°®Á§∫</label>
                                    <select id="previewCompanyDisplaySelect" class="w-full text-xs border border-gray-300 rounded px-2 py-1" onchange="updatePreviewCompanyName()">
                                        <option value="company">Á§æÂêç„ÅÆ„Åø</option>
                                        <option value="trade">Â±ãÂè∑„ÅÆ„Åø</option>
                                        <option value="both_company_priority">‰∏°ÊñπË°®Á§∫„ÉªÁ§æÂêçÂÑ™ÂÖà</option>
                                        <option value="both_trade_priority">‰∏°ÊñπË°®Á§∫„ÉªÂ±ãÂè∑ÂÑ™ÂÖà</option>
                                    </select>
                                </div>

                                <!-- „Éó„É¨„Éì„É•„ÉºË®≠ÂÆö‰øùÂ≠ò„Éú„Çø„É≥ -->
                                <div class="mt-3 pt-3 border-t border-gray-200">
                                    <button onclick="savePreviewSettingsOnly()" class="w-full bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 text-xs font-medium flex items-center justify-center gap-1">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                                        </svg>
                                        Ë®≠ÂÆö„Çí‰øùÂ≠ò
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- „Éí„Éº„É≠„Éº„Çª„ÇØ„Ç∑„Éß„É≥Ôºà„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„Åå„Å™„ÅÑÂ†¥ÂêàÔºâ -->
                    <div id="heroSection" class="relative bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-12 mb-12 text-white overflow-hidden" style="display: none;">
                        <div class="absolute inset-0 bg-black opacity-10"></div>
                        <div class="relative z-10">
                            <h1 id="previewCompanyNameHero" class="text-2xl sm:text-4xl font-bold mb-2 text-center sm:text-left">Ê†™Âºè‰ºöÁ§æ„ÅÇ„Åü„Çã</h1>
                            <p id="previewTaglineHero" class="text-base sm:text-lg opacity-90 text-center sm:text-left">„Éï„Ç°„Ç§„É≥„ÉÜ„ÉÉ„ÇØ„ÅØ„ÄÅÈñ¢Ë•ø‰∏ÄÂÜÜ„ÅßÂ§ñÂ£Å„ÉªÂ±ãÊ†πÂ°óË£Ö„ÄÅÈò≤Ê∞¥Â∑•‰∫ã„ÄÅ„É™„Éï„Ç©„Éº„É†„ÇíÊâãÊéõ„Åë„ÇãÂ°óË£Ö„Éª„É™„Éï„Ç©„Éº„É†‰ºöÁ§æ„Åß„Åô</p>
                            <div class="flex flex-wrap gap-4 mt-6">
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm3 1h6v4H7V5zm6 6H7v2h6v-2z"></path>
                                    </svg>
                                    <span id="previewEstablishedHero">2010Âπ¥4Êúà</span>
                                </div>
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>ÂÆüÁ∏æ1000‰ª∂‰ª•‰∏ä</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="p-8">
                    <!-- ‰ºöÁ§æ„ÅÆÁâπÂæ¥„ÉªÂº∑„ÅøÔºàÈÅ∏„Å∞„Çå„ÇãÁêÜÁî±Ôºâ -->
                    <div id="preview-prText" class="mb-12">
                        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                            <span class="w-1 h-6 bg-yellow-500 mr-3 rounded"></span>
                            ‰ºöÁ§æ„ÅÆÁâπÂæ¥„ÉªÂº∑„Åø
                        </h3>
                        <div class="bg-gradient-to-br from-yellow-50 to-orange-50 rounded-xl p-8 border border-yellow-200">
                            <p id="previewPrText" class="text-gray-700 leading-relaxed">„Éï„Ç°„Ç§„É≥„ÉÜ„ÉÉ„ÇØ„ÅØ„ÄÅÈñ¢Ë•ø‰∏ÄÂÜÜ„ÅßÂ§ñÂ£Å„ÉªÂ±ãÊ†πÂ°óË£Ö„ÄÅÈò≤Ê∞¥Â∑•‰∫ã„ÄÅ„É™„Éï„Ç©„Éº„É†„ÇíÊâãÊéõ„Åë„ÇãÂ°óË£Ö„Éª„É™„Éï„Ç©„Éº„É†‰ºöÁ§æ„Åß„Åô„ÄÇ‰ª£Ë°®ËÄÖËá™„Çâ„ÅåÁõ¥Êé•Ë¶ãÁ©ç„ÇÇ„Çä„ÇíË°å„ÅÜ„ÄåÊú¨Áâ©„ÅÆËá™Á§æÊñΩÂ∑•„Äç„ÇíÂæπÂ∫ï„Åó„ÄÅ‰∏≠Èñì„Éû„Éº„Ç∏„É≥„ÇíÊéíÈô§„Åô„Çã„Åì„Å®„ÅßÈ´òÂìÅË≥™„Å™„Åå„ÇâÈÅ©Ê≠£‰æ°Ê†º„ÇíÂÆüÁèæ„ÄÇÁã¨Ëá™„ÅÆ3DÂ∑•Ê≥ï„Å´„Çà„ÇãÊÑèÂå†„Çµ„Ç§„Éá„Ç£„É≥„Ç∞„ÅÆÂÜçÁèæÂ°óË£Ö„ÇÑÂ§öËâ≤Â°ó„ÇäÂàÜ„Åë„Éá„Ç∂„Ç§„É≥„Å™„Å©„ÄÅÈ´ò„ÅÑÊäÄË°ìÂäõ„Åß„ÅäÂÆ¢Êßò„ÅÆ„Åì„Å†„Çè„Çä„ÇíÁ¥∞ÈÉ®„Åæ„ÅßÂÜçÁèæ„ÄÇÈï∑Êúü‰øùË®º„Å®‰∏ÅÂØß„Å™„Ç¢„Éï„Çø„Éº„É°„É≥„ÉÜ„Éä„É≥„Çπ„ÅßÊñΩÂ∑•Âæå„ÇÇÂÆâÂøÉ„ÅåÁ∂ö„Åç„Åæ„Åô„ÄÇ</p>
                        </div>
                    </div>

                    <!-- 1. ÊñΩÂ∑•‰∫ã‰æã„Çª„ÇØ„Ç∑„Éß„É≥ÔºàÊúÄÂàù„Å´ÂÆüÁ∏æ„ÇíË¶ã„Åõ„ÇãÔºâ -->
                    <div id="preview-examples" class="mb-12" style="display: block;">
                        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                            <span class="w-1 h-6 bg-pink-600 mr-3 rounded"></span>
                            ÊñΩÂ∑•‰∫ã‰æã
                        </h3>
                        <!-- „Ç´„É´„Éº„Çª„É´„Ç≥„É≥„ÉÜ„Éä -->
                        <div class="relative">
                            <!-- Â∑¶Áü¢Âç∞ -->
                            <button onclick="scrollExamples('left')" class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 z-10 bg-white shadow-lg rounded-full p-2 hover:bg-gray-50 transition">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </button>
                            <!-- ÊñΩÂ∑•‰∫ã‰æã„Ç´„É´„Éº„Çª„É´ -->
                            <div id="examplesCarousel" class="overflow-hidden" style="min-height: 400px;">
                                <div id="previewExamplesList" class="flex gap-4 transition-transform duration-300">
                                    <!-- ÊñΩÂ∑•‰∫ã‰æã„ÅØ„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÂãïÁöÑ„Å´„É≠„Éº„Éâ„Åï„Çå„Åæ„Åô -->
                                </div>
                            </div>
                            <!-- Âè≥Áü¢Âç∞ -->
                            <button onclick="scrollExamples('right')" class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 z-10 bg-white shadow-lg rounded-full p-2 hover:bg-gray-50 transition">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                        </div>
                        <!-- „Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº -->
                        <div id="examplesIndicators" class="flex justify-center gap-1 mt-4">
                            <button onclick="goToExample(0)" class="w-2 h-2 rounded-full transition bg-blue-600"></button>
                        </div>
                    </div>

                    <!-- 2. „Åè„Çâ„Åπ„Çã„Çπ„Ç≥„Ç¢ -->
                    <div id="preview-rating" class="mb-8 sm:mb-12 bg-gradient-to-br from-amber-50 via-orange-50 to-red-50 rounded-2xl p-4 sm:p-6 lg:p-8" style="display: block;">
                        <div class="mb-4 sm:mb-6">
                            <h3 class="text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 mb-2 inline-flex items-center">
                                <span class="w-1 h-5 sm:h-6 bg-gradient-to-b from-amber-500 to-orange-600 mr-2 sm:mr-3 rounded"></span>
                                „Åè„Çâ„Åπ„Çã„Çπ„Ç≥„Ç¢
                            </h3>
                            <p class="text-sm sm:text-base text-gray-600">ÂΩìÁ§æÁã¨Ëá™„ÅÆÁ∑èÂêàË©ï‰æ°„Çπ„Ç≥„Ç¢</p>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 lg:gap-8">
                            <!-- Á∑èÂêàË©ï‰æ° -->
                            <div class="bg-white rounded-xl shadow-lg border-2 border-amber-100 p-4 sm:p-5 lg:p-6">
                                <div class="text-center mb-4 sm:mb-5">
                                    <h4 class="text-base sm:text-lg lg:text-xl font-bold text-gray-800 mb-2 sm:mb-3">Á∑èÂêàË©ï‰æ°</h4>
                                    <div class="flex items-center justify-center mb-2 sm:mb-3">
                                        <span class="text-3xl sm:text-4xl lg:text-5xl font-bold text-amber-600" id="overallRating">4.2</span>
                                        <span class="text-base sm:text-lg lg:text-xl text-gray-500 ml-1">/5.0</span>
                                    </div>
                                    <div class="flex justify-center mb-2 sm:mb-3 gap-1" id="overallStars">
                                        <svg class="w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 text-amber-400 fill-current" viewBox="0 0 20 20">
                                            <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                        </svg>
                                        <svg class="w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 text-amber-400 fill-current" viewBox="0 0 20 20">
                                            <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                        </svg>
                                        <svg class="w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 text-amber-400 fill-current" viewBox="0 0 20 20">
                                            <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                        </svg>
                                        <svg class="w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 text-amber-400 fill-current" viewBox="0 0 20 20">
                                            <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                        </svg>
                                        <svg class="w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 text-gray-300 fill-current" viewBox="0 0 20 20">
                                            <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                        </svg>
                                    </div>
                                    <p class="text-xs sm:text-sm text-gray-500">ÂΩìÁ§æÁã¨Ëá™ÁÆóÂá∫„Çπ„Ç≥„Ç¢</p>
                                </div>

                                <!-- È†ÖÁõÆÂà•Ë©ï‰æ° -->
                                <div class="space-y-2 sm:space-y-3">
                                    <div class="flex justify-between items-center py-1">
                                        <span class="text-sm sm:text-base font-medium text-gray-700">„Ç≥„Çπ„Éà„Éê„É©„É≥„Çπ</span>
                                        <div class="flex items-center">
                                            <div class="flex text-amber-400 mr-2 gap-0.5">
                                                <svg class="w-4 h-4 sm:w-5 sm:h-5 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                            </div>
                                            <span class="text-sm sm:text-base font-medium text-gray-800" id="pricingRating">4.4</span>
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-center py-1">
                                        <span class="text-sm sm:text-base font-medium text-gray-700">‰∫∫ÊüÑ„ÉªÂØæÂøúÂäõ</span>
                                        <div class="flex items-center">
                                            <div class="flex text-amber-400 mr-2">
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 text-gray-300 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                            </div>
                                            <span class="text-sm sm:text-base font-medium text-gray-800" id="communicationRating">4.1</span>
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-center py-1">
                                        <span class="text-sm sm:text-base font-medium text-gray-700">ÊäÄË°ì„ÉªÂìÅË≥™</span>
                                        <div class="flex items-center">
                                            <div class="flex text-amber-400 mr-2">
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 text-gray-300 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                            </div>
                                            <span class="text-sm sm:text-base font-medium text-gray-800" id="technologyRating">4.3</span>
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-center py-1">
                                        <span class="text-sm sm:text-base font-medium text-gray-700">ÂØæÂøú„Çπ„Éî„Éº„Éâ</span>
                                        <div class="flex items-center">
                                            <div class="flex text-amber-400 mr-2">
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 text-gray-300 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                            </div>
                                            <span class="text-sm sm:text-base font-medium text-gray-800" id="scheduleRating">4.0</span>
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-center py-1">
                                        <span class="text-sm sm:text-base font-medium text-gray-700">„Ç¢„Éï„Çø„Éº„Çµ„Éù„Éº„Éà</span>
                                        <div class="flex items-center">
                                            <div class="flex text-amber-400 mr-2">
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 text-gray-300 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                            </div>
                                            <span class="text-sm sm:text-base font-medium text-gray-800" id="serviceRating">4.2</span>
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-center py-1">
                                        <span class="text-sm sm:text-base font-medium text-gray-700">È°ßÂÆ¢Ê∫ÄË∂≥Â∫¶</span>
                                        <div class="flex items-center">
                                            <div class="flex text-amber-400 mr-2">
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                                <svg class="w-4 h-4 text-gray-300 fill-current" viewBox="0 0 20 20">
                                                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                                </svg>
                                            </div>
                                            <span class="text-sm sm:text-base font-medium text-gray-800" id="qualityRating">4.3</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 6ËßíÂΩ¢„É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„Éà -->
                            <div class="bg-white rounded-xl shadow-lg border-2 border-amber-100 p-4 sm:p-5 lg:p-6">
                                <h4 class="text-base sm:text-lg lg:text-xl font-bold text-gray-800 mb-3 sm:mb-4 text-center">È†ÖÁõÆÂà•Ë©ï‰æ°„ÉÅ„É£„Éº„Éà</h4>
                                <div class="flex justify-center overflow-hidden">
                                    <svg width="100%" height="320" viewBox="0 0 400 400" class="radarChart max-w-xs sm:max-w-sm lg:max-w-md" style="width: min(100%, 320px); height: auto;">
                                        <!-- ËÉåÊôØ„Ç∞„É™„ÉÉ„Éâ -->
                                        <g id="radarGrid" transform="translate(200,200)">
                                            <!-- 5ÊÆµÈöé„ÅÆ„Ç∞„É™„ÉÉ„ÉâÂÜÜ -->
                                            <circle cx="0" cy="0" r="20" fill="none" stroke="#f3f4f6" stroke-width="1"/>
                                            <circle cx="0" cy="0" r="40" fill="none" stroke="#e5e7eb" stroke-width="1"/>
                                            <circle cx="0" cy="0" r="60" fill="none" stroke="#d1d5db" stroke-width="1"/>
                                            <circle cx="0" cy="0" r="80" fill="none" stroke="#9ca3af" stroke-width="1"/>
                                            <circle cx="0" cy="0" r="100" fill="none" stroke="#6b7280" stroke-width="1"/>

                                            <!-- Ëª∏Á∑ö -->
                                            <line x1="0" y1="-100" x2="0" y2="100" stroke="#e5e7eb" stroke-width="1"/>
                                            <line x1="-86.6" y1="-50" x2="86.6" y2="50" stroke="#e5e7eb" stroke-width="1"/>
                                            <line x1="-86.6" y1="50" x2="86.6" y2="-50" stroke="#e5e7eb" stroke-width="1"/>
                                        </g>

                                        <!-- „Éá„Éº„Çø„Éù„É™„Ç¥„É≥ -->
                                        <g id="radarData" transform="translate(200,200)">
                                            <polygon id="ratingPolygon" class="chart-data"
                                                points="0,-86 75.1,-43.2 75.1,43.2 0,64 -75.1,43.2 -75.1,-34.4"
                                                fill="rgba(245, 158, 11, 0.2)"
                                                stroke="#f59e0b"
                                                stroke-width="2"
                                                stroke-linejoin="round"/>

                                            <!-- „Éá„Éº„Çø„Éù„Ç§„É≥„Éà -->
                                            <circle cx="0" cy="-86" r="4" fill="#f59e0b" class="data-point-0"/>
                                            <circle cx="75.1" cy="-43.2" r="4" fill="#f59e0b" class="data-point-1"/>
                                            <circle cx="75.1" cy="43.2" r="4" fill="#f59e0b" class="data-point-2"/>
                                            <circle cx="0" cy="64" r="4" fill="#f59e0b" class="data-point-3"/>
                                            <circle cx="-75.1" cy="43.2" r="4" fill="#f59e0b" class="data-point-4"/>
                                            <circle cx="-75.1" cy="-34.4" r="4" fill="#f59e0b" class="data-point-5"/>
                                        </g>

                                        <!-- „É©„Éô„É´ -->
                                        <g id="radarLabels" transform="translate(200,200)">
                                            <text x="0" y="-125" text-anchor="middle" class="text-xs sm:text-sm font-semibold fill-gray-700">„Ç≥„Çπ„Éà„Éê„É©„É≥„Çπ</text>
                                            <text x="115" y="-25" text-anchor="start" class="text-xs sm:text-sm font-semibold fill-gray-700">‰∫∫ÊüÑ„ÉªÂØæÂøúÂäõ</text>
                                            <text x="115" y="65" text-anchor="start" class="text-xs sm:text-sm font-semibold fill-gray-700">ÊäÄË°ì„ÉªÂìÅË≥™</text>
                                            <text x="0" y="145" text-anchor="middle" class="text-xs sm:text-sm font-semibold fill-gray-700">„Ç¢„Éï„Çø„Éº„Çµ„Éù„Éº„Éà</text>
                                            <text x="-115" y="65" text-anchor="end" class="text-xs sm:text-sm font-semibold fill-gray-700">ÂØæÂøú„Çπ„Éî„Éº„Éâ</text>
                                            <text x="-115" y="-35" text-anchor="end" class="text-xs sm:text-sm font-semibold fill-gray-700">È°ßÂÆ¢Ê∫ÄË∂≥Â∫¶</text>
                                        </g>
                                    </svg>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- 10. „ÅäÂïè„ÅÑÂêà„Çè„Åõ„Çª„ÇØ„Ç∑„Éß„É≥ÔºàÊúÄÁµÇCTAÔºâ -->
                    <div id="preview-contact" class="mb-12">
                        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                            <span class="w-1 h-6 bg-purple-600 mr-3 rounded"></span>
                            „ÅäÂïè„ÅÑÂêà„Çè„Åõ
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white border rounded-xl p-4 hover:shadow-lg transition">
                                <div class="flex items-center mb-2">
                                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">„ÅäÈõªË©±„Åß„ÅÆ„ÅäÂïè„ÅÑÂêà„Çè„Åõ</p>
                                        <a href="tel:090-1994-7162" class="text-lg font-semibold text-blue-600 hover:text-blue-800 cursor-pointer transition-colors">090-1994-7162</a>
                                        <p class="text-xs text-gray-500">Âèó‰ªòÊôÇÈñì: 9:00-18:00ÔºàÂπ¥‰∏≠ÁÑ°‰ºëÔºâ</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white border rounded-xl p-4 hover:shadow-lg transition">
                                <div class="flex items-center mb-2">
                                    <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                        </svg>
                                    </div>
                                    <div class="overflow-hidden min-w-0">
                                        <p class="text-sm text-gray-600">„É°„Éº„É´„Åß„ÅÆ„ÅäÂïè„ÅÑÂêà„Çè„Åõ</p>
                                        <a href="mailto:info@gaihekikuraberu.com" class="text-sm sm:text-base font-semibold text-blue-600 hover:text-blue-800 break-all cursor-pointer transition-colors">info@gaihekikuraberu.com</a>
                                        <p class="text-xs text-gray-500">24ÊôÇÈñìÂèó‰ªò‰∏≠</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 9„Å§„ÅÆÁâπÂÖ∏Ë©≥Á¥∞„Çª„ÇØ„Ç∑„Éß„É≥ -->
                    <div class="mb-8 sm:mb-12 bg-gradient-to-br from-orange-50 via-orange-100 to-red-50 rounded-2xl p-4 sm:p-6 lg:p-10">
                        <div class="text-center mb-4 sm:mb-6">
                            <h3 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900 mb-2">üéÅ ‰ªä„Å†„ÅëÔºÅ9„Å§„ÅÆÁÑ°ÊñôÁâπÂÖ∏</h3>
                            <p class="text-sm sm:text-base text-gray-600">ÊúüÈñìÈôêÂÆö„Ç≠„É£„É≥„Éö„Éº„É≥ÂÆüÊñΩ‰∏≠ÔºÅ</p>
                        </div>

                        <div class="max-w-4xl mx-auto mb-4 sm:mb-6 px-2 sm:px-4">
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                                <!-- ÁâπÂÖ∏1: ÁÑ°ÊñôÁÇπÊ§ú -->
                                <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">üîç</span>
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ÁÑ°ÊñôÁÇπÊ§ú</h4>
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">„Éó„É≠„ÅÆÁõÆ„ÅßÂ§ñÂ£Å„ÉªÂ±ãÊ†π„ÇíÂæπÂ∫ï„ÉÅ„Çß„ÉÉ„ÇØÔºÅ„ÅäÂÆ∂„ÅÆÁä∂ÊÖã„ÇíË©≥Á¥∞„Å´Â†±Âëä</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏2: „Ç®„É™„Ç¢ÊúÄ‰Ωé‰æ°Ê†º‰øùË®º -->
                                <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">üí∞</span>
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">„Ç®„É™„Ç¢ÊúÄ‰Ωé‰æ°Ê†º‰øùË®º</h4>
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">Âú∞ÂüüÊúÄÂÆâÂÄ§„Çí„ÅäÁ¥ÑÊùüÔºÅ‰ªñÁ§æ„Çà„ÇäÈ´ò„Åë„Çå„Å∞ÂÄ§Âºï„ÅçÂØæÂøú</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏3: „ÅäÂÄ§Âºï„Åç‰∫§Ê∏â‰ª£Ë°å -->
                                <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ü§ù</span>
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">„ÅäÂÄ§Âºï„Åç‰∫§Ê∏â‰ª£Ë°å</h4>
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">‰ªñÁ§æË¶ãÁ©ç„ÇÇ„Çä„Çí„ÅäÊåÅ„Å°„Å™„Çâ„ÄÅ‰ª£„Çè„Çä„Å´‰∫§Ê∏â„Åó„Å¶ÊúÄÂÆâÂÄ§„ÇíÂÆüÁèæ</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏4: Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà -->
                                <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">üìù</span>
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà</h4>
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">ÊúÄÂ§ß10ÔΩû70‰∏áÂÜÜÔºÅÂêÑÁ®ÆÂä©ÊàêÈáë„ÅÆÁî≥Ë´ãÊâãÁ∂ö„Åç„ÇíÂÆåÂÖ®„Çµ„Éù„Éº„Éà</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏5: ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà -->
                                <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">üèõÔ∏è</span>
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà</h4>
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">Âè∞È¢®„ÉªÈõ™ÂÆ≥Á≠â„ÅÆÊêçÂÆ≥„Å´ÁÅ´ÁÅΩ‰øùÈô∫ÈÅ©Áî®ÂèØËÉΩÔºÅÁÑ°Êñô„ÅßË™øÊüª</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏6: „ÅäÊñ≠„Çä‰ª£Ë°å„Çµ„Éº„Éì„Çπ -->
                                <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">üö´</span>
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">„ÅäÊñ≠„Çä‰ª£Ë°å„Çµ„Éº„Éì„Çπ</h4>
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">ÊàêÁ¥ÑÊôÇ„ÅÆ‰ªñÁ§æ„Å∏„ÅÆ„ÅäÊñ≠„Çä„ÇÇ‰ª£Ë°åÂèØËÉΩÔºÅÈù¢ÂÄí„Å™„ÇÑ„ÇäÂèñ„Çä‰∏çË¶Å</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏7: ÁÑ°Êñô„ÅäÈõªË©±„Çµ„Éù„Éº„Éà -->
                                <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">üìû</span>
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ÁÑ°Êñô„ÅäÈõªË©±„Çµ„Éù„Éº„Éà</h4>
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">Â∑•‰∫ãÂÆå‰∫ÜÂæå„ÇÇÂÆâÂøÉÔºÅ365Êó•ÈõªË©±„Çµ„Éù„Éº„Éà„Åß„ÅäÊÇ©„ÅøËß£Ê±∫</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏8: Ë®™ÂïèÊ•≠ËÄÖ„Éû„Éã„É•„Ç¢„É´ÈÄ≤Âëà -->
                                <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">üìñ</span>
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">Ë®™ÂïèÊ•≠ËÄÖ„Éû„Éã„É•„Ç¢„É´ÈÄ≤Âëà</h4>
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">ÊÇ™Âæ≥Ê•≠ËÄÖ„ÅÆÊâãÂè£„ÇÑÂØæÂá¶Ê≥ï„ÇíÂÆåÂÖ®Ëß£Ë™¨ÔºÅÂÆâÂøÉ„Ç¨„Ç§„Éâ</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏9: „ÅäÂèãÈÅîÁ¥π‰ªã„Ç≠„É£„É≥„Éö„Éº„É≥ -->
                                <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">üë•</span>
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">„ÅäÂèãÈÅîÁ¥π‰ªã„Ç≠„É£„É≥„Éö„Éº„É≥</h4>
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">Á¥π‰ªã„ÅßÂèåÊñπ„Å´ÁâπÂÖ∏ÔºÅÊúÄÂ§ß30,000ÂÜÜÂàÜ„ÅÆ„ÇÆ„Éï„Éà„Ç´„Éº„Éâ</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-4 sm:mt-6">
                            <button class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 sm:px-8 lg:px-10 py-3 sm:py-4 rounded-lg hover:shadow-xl transition font-bold text-base sm:text-lg transform hover:scale-105 w-full sm:w-auto max-w-sm sm:max-w-none">
                                <span class="sm:hidden">‰ªä„Åô„ÅêÁÑ°ÊñôË¶ãÁ©ç„ÇÇ„Çä„Çí‰æùÈ†º</span>
                                <span class="hidden sm:inline">‰ªä„Åô„ÅêÁÑ°ÊñôË¶ãÁ©ç„ÇÇ„Çä„Çí‰æùÈ†º„Åô„Çã</span>
                            </button>
                            <p class="text-xs sm:text-sm text-gray-500 mt-2">‚Äª24ÊôÇÈñì‰ª•ÂÜÖ„Å´„ÅîÈÄ£Áµ°„ÅÑ„Åü„Åó„Åæ„Åô</p>
                        </div>
                    </div>



                    <!-- 8. ÂØæÂøú„Ç®„É™„Ç¢„Çª„ÇØ„Ç∑„Éß„É≥ -->
                    <div id="preview-areas" class="mb-12" style="display: block;">
                        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                            <span class="w-1 h-6 bg-orange-600 mr-3 rounded"></span>
                            ÂØæÂøú„Ç®„É™„Ç¢
                        </h3>
                        <div class="bg-white rounded-xl p-6 border border-gray-200">
                            <div id="previewCitiesContainer"></div>
                        </div>
                    </div>

                    <!-- 4. ÂØæÂøúÂèØËÉΩ„Å™Â∑•‰∫ãÔºà„Çµ„Éº„Éì„ÇπÂÜÖÂÆπÔºâ -->
                    <div id="preview-services" class="mb-12" style="display: block;">
                        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                            <span class="w-1 h-6 bg-green-600 mr-3 rounded"></span>
                            ÂØæÂøúÂèØËÉΩ„Å™Â∑•‰∫ã
                        </h3>
                        <div id="previewServicesList" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"><div class="bg-white border border-green-200 rounded-lg p-3 flex items-center hover:shadow-md transition">
                            <span class="text-2xl mr-2">üé®</span>
                            <span class="text-sm font-medium text-gray-800">Â§ñÂ£ÅÂ°óË£Ö</span>
                        </div><div class="bg-white border border-green-200 rounded-lg p-3 flex items-center hover:shadow-md transition">
                            <span class="text-2xl mr-2">üèóÔ∏è</span>
                            <span class="text-sm font-medium text-gray-800">Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï</span>
                        </div><div class="bg-white border border-green-200 rounded-lg p-3 flex items-center hover:shadow-md transition">
                            <span class="text-2xl mr-2">üî®</span>
                            <span class="text-sm font-medium text-gray-800">Â§ñÂ£ÅÂºµÊõø„Åà</span>
                        </div><div class="bg-white border border-green-200 rounded-lg p-3 flex items-center hover:shadow-md transition">
                            <span class="text-2xl mr-2">üè†</span>
                            <span class="text-sm font-medium text-gray-800">Â±ãÊ†πÂ°óË£Ö</span>
                        </div><div class="bg-white border border-green-200 rounded-lg p-3 flex items-center hover:shadow-md transition">
                            <span class="text-2xl mr-2">üíß</span>
                            <span class="text-sm font-medium text-gray-800">Â±ã‰∏äÈò≤Ê∞¥</span>
                        </div><div class="bg-white border border-green-200 rounded-lg p-3 flex items-center hover:shadow-md transition">
                            <span class="text-2xl mr-2">üèöÔ∏è</span>
                            <span class="text-sm font-medium text-gray-800">Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚Äª„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠â</span>
                        </div><div class="bg-white border border-green-200 rounded-lg p-3 flex items-center hover:shadow-md transition">
                            <span class="text-2xl mr-2">üèØ</span>
                            <span class="text-sm font-medium text-gray-800">Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚ÄªÁì¶</span>
                        </div><div class="bg-white border border-green-200 rounded-lg p-3 flex items-center hover:shadow-md transition">
                            <span class="text-2xl mr-2">üìê</span>
                            <span class="text-sm font-medium text-gray-800">Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï</span>
                        </div><div class="bg-white border border-green-200 rounded-lg p-3 flex items-center hover:shadow-md transition">
                            <span class="text-2xl mr-2">üîß</span>
                            <span class="text-sm font-medium text-gray-800">Â§ñÂ£ÅË£ú‰øÆ</span>
                        </div><div class="bg-white border border-green-200 rounded-lg p-3 flex items-center hover:shadow-md transition">
                            <span class="text-2xl mr-2">üõ†Ô∏è</span>
                            <span class="text-sm font-medium text-gray-800">Â±ãÊ†πË£ú‰øÆ</span>
                        </div><div class="bg-white border border-green-200 rounded-lg p-3 flex items-center hover:shadow-md transition">
                            <span class="text-2xl mr-2">üåä</span>
                            <span class="text-sm font-medium text-gray-800">„Éô„É©„É≥„ÉÄÈò≤Ê∞¥</span>
                        </div><div class="bg-white border border-green-200 rounded-lg p-3 flex items-center hover:shadow-md transition">
                            <span class="text-2xl mr-2">‚úì</span>
                            <span class="text-sm font-medium text-gray-800">Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπï</span>
                        </div><div class="bg-white border border-green-200 rounded-lg p-3 flex items-center hover:shadow-md transition">
                            <span class="text-2xl mr-2">‚úì</span>
                            <span class="text-sm font-medium text-gray-800">ÂÜÖË£ÖÊ∞¥Âõû„ÇäÔºà„Éê„Çπ„Éª„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éà„Ç§„É¨Ôºâ</span>
                        </div><div class="bg-white border border-green-200 rounded-lg p-3 flex items-center hover:shadow-md transition">
                            <span class="text-2xl mr-2">‚úì</span>
                            <span class="text-sm font-medium text-gray-800">ÂÜÖË£ÖÔºà„Éï„É≠„Éº„É™„É≥„Ç∞„ÇÑÁï≥„Å™„Å©„ÅÆÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâ</span>
                        </div></div>
                    </div>

                    <!-- CTA„Éú„Çø„É≥Ôºà1ÂõûÁõÆÔºâÂâäÈô§ -->
                    <div class="hidden">
                        <div class="text-center mb-4 sm:mb-6">
                            <h3 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900 mb-2">üéÅ ‰ªä„Å†„ÅëÔºÅ9„Å§„ÅÆÁÑ°ÊñôÁâπÂÖ∏</h3>
                            <p class="text-sm sm:text-base text-gray-600">ÊúüÈñìÈôêÂÆö„Ç≠„É£„É≥„Éö„Éº„É≥ÂÆüÊñΩ‰∏≠ÔºÅ</p>
                        </div>

                        <div class="max-w-4xl mx-auto mb-4 sm:mb-6 px-2 sm:px-4">
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                                <!-- ÁâπÂÖ∏1: ÁÑ°ÊñôÁÇπÊ§ú -->
                                <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">üîç</span>
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ÁÑ°ÊñôÁÇπÊ§ú</h4>
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">„Éó„É≠„ÅÆÁõÆ„ÅßÂ§ñÂ£Å„ÉªÂ±ãÊ†π„ÇíÂæπÂ∫ï„ÉÅ„Çß„ÉÉ„ÇØÔºÅ„ÅäÂÆ∂„ÅÆÁä∂ÊÖã„ÇíË©≥Á¥∞„Å´Â†±Âëä</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏2: „Ç®„É™„Ç¢ÊúÄ‰Ωé‰æ°Ê†º‰øùË®º -->
                                <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">üí∞</span>
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">„Ç®„É™„Ç¢ÊúÄ‰Ωé‰æ°Ê†º‰øùË®º</h4>
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">Âú∞ÂüüÊúÄÂÆâÂÄ§„Çí„ÅäÁ¥ÑÊùüÔºÅ‰ªñÁ§æ„Çà„ÇäÈ´ò„Åë„Çå„Å∞ÂÄ§Âºï„ÅçÂØæÂøú</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏3: „ÅäÂÄ§Âºï„Åç‰∫§Ê∏â‰ª£Ë°å -->
                                <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ü§ù</span>
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">„ÅäÂÄ§Âºï„Åç‰∫§Ê∏â‰ª£Ë°å</h4>
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">‰ªñÁ§æË¶ãÁ©ç„ÇÇ„Çä„Çí„ÅäÊåÅ„Å°„Å™„Çâ„ÄÅ‰ª£„Çè„Çä„Å´‰∫§Ê∏â„Åó„Å¶ÊúÄÂÆâÂÄ§„ÇíÂÆüÁèæ</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏4: Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà -->
                                <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">üìù</span>
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà</h4>
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">ÊúÄÂ§ß10ÔΩû70‰∏áÂÜÜÔºÅÂêÑÁ®ÆÂä©ÊàêÈáë„ÅÆÁî≥Ë´ãÊâãÁ∂ö„Åç„ÇíÂÆåÂÖ®„Çµ„Éù„Éº„Éà</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏5: ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà -->
                                <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">üèõÔ∏è</span>
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà</h4>
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">Âè∞È¢®„ÉªÈõ™ÂÆ≥Á≠â„ÅÆÊêçÂÆ≥„Å´ÁÅ´ÁÅΩ‰øùÈô∫ÈÅ©Áî®ÂèØËÉΩÔºÅÁÑ°Êñô„ÅßË™øÊüª</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏6: „ÅäÊñ≠„Çä‰ª£Ë°å„Çµ„Éº„Éì„Çπ -->
                                <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">üö´</span>
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">„ÅäÊñ≠„Çä‰ª£Ë°å„Çµ„Éº„Éì„Çπ</h4>
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">ÊàêÁ¥ÑÊôÇ„ÅÆ‰ªñÁ§æ„Å∏„ÅÆ„ÅäÊñ≠„Çä„ÇÇ‰ª£Ë°åÂèØËÉΩÔºÅÈù¢ÂÄí„Å™„ÇÑ„ÇäÂèñ„Çä‰∏çË¶Å</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏8: Ë®™ÂïèÊ•≠ËÄÖ„Éû„Éã„É•„Ç¢„É´ -->
                                <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">üìñ</span>
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">Ë®™ÂïèÊ•≠ËÄÖ„Éû„Éã„É•„Ç¢„É´ÈÄ≤Âëà</h4>
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">ÊÇ™Âæ≥Ê•≠ËÄÖ„ÅÆÊâãÂè£„ÇÑÂØæÂá¶Ê≥ï„ÇíÂÆåÂÖ®Ëß£Ë™¨ÔºÅÂÆâÂøÉ„Ç¨„Ç§„Éâ</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏7: ÁÑ°Êñô„ÅäÈõªË©±„Çµ„Éù„Éº„Éà -->
                                <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">üìû</span>
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ÁÑ°Êñô„ÅäÈõªË©±„Çµ„Éù„Éº„Éà</h4>
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">Â∑•‰∫ãÂÆå‰∫ÜÂæå„ÇÇÂÆâÂøÉÔºÅ365Êó•ÈõªË©±„Çµ„Éù„Éº„Éà„Åß„ÅäÊÇ©„ÅøËß£Ê±∫</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏8: „ÅäÂèãÈÅîÁ¥π‰ªã„Ç≠„É£„É≥„Éö„Éº„É≥ -->
                                <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">üë•</span>
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">„ÅäÂèãÈÅîÁ¥π‰ªã„Ç≠„É£„É≥„Éö„Éº„É≥</h4>
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">Á¥π‰ªã„ÅßÂèåÊñπ„Å´ÁâπÂÖ∏ÔºÅÊúÄÂ§ß30,000ÂÜÜÂàÜ„ÅÆ„ÇÆ„Éï„Éà„Ç´„Éº„Éâ</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="text-center">
                            <button class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-10 py-4 rounded-lg hover:shadow-xl transition font-bold text-lg transform hover:scale-105">
                                ‰ªä„Åô„ÅêÁÑ°ÊñôË¶ãÁ©ç„ÇÇ„Çä„Çí‰æùÈ†º„Åô„Çã
                            </button>
                            <p class="text-xs text-gray-500 mt-2">‚Äª24ÊôÇÈñì‰ª•ÂÜÖ„Å´„ÅîÈÄ£Áµ°„ÅÑ„Åü„Åó„Åæ„Åô</p>
                        </div>
                    </div>

                    <!-- 5. ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„Çª„ÇØ„Ç∑„Éß„É≥Ôºà‰ªï‰∫ã„ÅÆÊßòÂ≠êÔºâ -->
                    <div id="preview-gallery" class="mb-12" style="display: block;">
                        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                            <span class="w-1 h-6 bg-purple-600 mr-3 rounded"></span>
                            ‰øùÊúâË≥áÊ†º
                        </h3>
                        <div id="qualificationsList" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"><div class="bg-purple-50 border border-purple-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üéñÔ∏è</span>
                        <span class="text-sm font-medium">‰∏ÄÁ¥öÂ°óË£ÖÊäÄËÉΩÂ£´</span>
                    </div><div class="bg-purple-50 border border-purple-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üéñÔ∏è</span>
                        <span class="text-sm font-medium">‰∫åÁ¥öÂ°óË£ÖÊäÄËÉΩÂ£´</span>
                    </div><div class="bg-purple-50 border border-purple-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üéñÔ∏è</span>
                        <span class="text-sm font-medium">Ë∂≥Â†¥ÁµÑÁ´ã‰ΩúÊ•≠‰∏ª‰ªªËÄÖ</span>
                    </div><div class="bg-purple-50 border border-purple-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üéñÔ∏è</span>
                        <span class="text-sm font-medium">Áü≥Á∂ø‰ΩúÊ•≠‰∏ª‰ªªËÄÖ</span>
                    </div><div class="bg-purple-50 border border-purple-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üéñÔ∏è</span>
                        <span class="text-sm font-medium">Â§ñÂ£ÅË®∫Êñ≠Â£´</span>
                    </div><div class="bg-purple-50 border border-purple-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üéñÔ∏è</span>
                        <span class="text-sm font-medium">Â§ñÂ£ÅÂä£ÂåñË®∫Êñ≠Â£´</span>
                    </div><div class="bg-purple-50 border border-purple-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üéñÔ∏è</span>
                        <span class="text-sm font-medium">Â§ñÂ£Å„Ç¢„Éâ„Éê„Ç§„Ç∂„Éº</span>
                    </div><div class="bg-purple-50 border border-purple-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üéñÔ∏è</span>
                        <span class="text-sm font-medium">Â±ãÊ†πË®∫Êñ≠Â£´</span>
                    </div><div class="bg-purple-50 border border-purple-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üéñÔ∏è</span>
                        <span class="text-sm font-medium">Èõ®Êºè„ÇäË®∫Êñ≠Â£´</span>
                    </div><div class="bg-purple-50 border border-purple-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üéñÔ∏è</span>
                        <span class="text-sm font-medium">Â¢óÊîπÁØâÁõ∏Ë´áÂì°</span>
                    </div><div class="bg-purple-50 border border-purple-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üéñÔ∏è</span>
                        <span class="text-sm font-medium">Á¨¨‰∫åÁ®ÆÈõªÊ∞óÂ∑•‰∫ãÂ£´</span>
                    </div><div class="bg-purple-50 border border-purple-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üéñÔ∏è</span>
                        <span class="text-sm font-medium">ÊúâÊ©üÊ∫∂Ââ§‰ΩúÊ•≠‰∏ª‰ªªËÄÖ</span>
                    </div><div class="bg-purple-50 border border-purple-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üéñÔ∏è</span>
                        <span class="text-sm font-medium">‰∏ÄÁ¥öÈò≤Ê∞¥ÊñΩÂ∑•ÊäÄËÉΩÂ£´</span>
                    </div></div>
                    </div>

                    <div id="preview-insurance" class="mb-12" style="display: block;">
                        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                            <span class="w-1 h-6 bg-indigo-600 mr-3 rounded"></span>
                            Âä†ÂÖ•‰øùÈô∫
                        </h3>
                        <div id="insuranceList" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"><div class="bg-indigo-50 border border-indigo-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üõ°Ô∏è</span>
                        <span class="text-sm font-medium">Â∑•‰∫ã‰øùÈô∫</span>
                    </div><div class="bg-indigo-50 border border-indigo-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üõ°Ô∏è</span>
                        <span class="text-sm font-medium">Ë≥†ÂÑüË≤¨‰ªª‰øùÈô∫</span>
                    </div><div class="bg-indigo-50 border border-indigo-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üõ°Ô∏è</span>
                        <span class="text-sm font-medium">„É™„Éï„Ç©„Éº„É†ÁëïÁñµ‰øùÈô∫</span>
                    </div><div class="bg-indigo-50 border border-indigo-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üõ°Ô∏è</span>
                        <span class="text-sm font-medium">Âª∫Ë®≠Â∑•‰∫ã‰øùÈô∫</span>
                    </div><div class="bg-indigo-50 border border-indigo-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üõ°Ô∏è</span>
                        <span class="text-sm font-medium">Ë´ãË≤†Ê•≠ËÄÖË≥†ÂÑüË≤¨‰ªª‰øùÈô∫</span>
                    </div><div class="bg-indigo-50 border border-indigo-200 rounded-lg p-3 flex items-center">
                        <span class="text-2xl mr-2">üõ°Ô∏è</span>
                        <span class="text-sm font-medium">ÁîüÁî£Áâ©Ë≥†ÂÑüË≤¨‰ªª‰øùÈô∫</span>
                    </div></div>
                    </div>

                    <!-- CTA„Éú„Çø„É≥Ôºà2ÂõûÁõÆÔºâ -->
                    <div class="text-center py-8 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg">
                        <h3 class="text-lg font-bold text-gray-900 mb-3">ÂÆâÂøÉ„ÅÆ‰øùË®º‰ΩìÂà∂„Åß„ÅäÂÆ¢Êßò„Çí„Çµ„Éù„Éº„Éà</h3>
                        <button class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-8 py-3 rounded-lg hover:shadow-lg transition font-semibold">
                            „Åæ„Åö„ÅØÁÑ°ÊñôÁõ∏Ë´á„Åã„Çâ
                        </button>
                    </div>

                    <!-- 7. ÂΩìÁ§æ„ÅÆÂº∑„ÅøÔºàÁâπÂà•„Å™„É°„É™„ÉÉ„ÉàÔºâ -->
                    <div id="preview-features" class="mb-12" style="display: block;">
                        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                            <span class="w-1 h-6 bg-orange-600 mr-3 rounded"></span>
                            ÂΩìÁ§æ„ÅÆÂº∑„Åø
                        </h3>
                        <div id="previewFeaturesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4">
                        <div class="text-3xl mb-2">üå°</div>
                        <h4 class="font-semibold text-gray-900 mb-1">ÈÅÆÁÜ±„ÉªÊñ≠ÁÜ±Â°óÊñôÊèêÊ°àÂèØËÉΩ</h4>
                    </div><div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4">
                        <div class="text-3xl mb-2">üè°</div>
                        <h4 class="font-semibold text-gray-900 mb-1">„Ç®„ÇØ„Çπ„ÉÜ„É™„Ç¢ÔºàÂ∫≠„ÉªÈßêËªäÂ†¥„ÉªÂ§ñÊßãÔºâ</h4>
                    </div><div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4">
                        <div class="text-3xl mb-2">‚òÄÔ∏è</div>
                        <h4 class="font-semibold text-gray-900 mb-1">Â§™ÈôΩÂÖâ„Éë„Éç„É´ËÑ±ÁùÄÔºàÊí§ÂéªÂê´„ÇÄÔºâ</h4>
                    </div><div class="bg-gradient-to-br from-pink-50 to-pink-100 rounded-xl p-4">
                        <div class="text-3xl mb-2">üè¶</div>
                        <h4 class="font-semibold text-gray-900 mb-1">ÊèêÊê∫ÂÖà„É≠„Éº„É≥Êúâ„Çä</h4>
                    </div><div class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-xl p-4">
                        <div class="text-3xl mb-2">üí≥</div>
                        <h4 class="font-semibold text-gray-900 mb-1">„ÇØ„É¨„Ç∏„ÉÉ„Éà„Ç´„Éº„ÉâÊâï„ÅÑÂèØ</h4>
                    </div><div class="bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-xl p-4">
                        <div class="text-3xl mb-2">üî•</div>
                        <h4 class="font-semibold text-gray-900 mb-1">ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà</h4>
                    </div><div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4">
                        <div class="text-3xl mb-2">üí∞</div>
                        <h4 class="font-semibold text-gray-900 mb-1">Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà</h4>
                    </div><div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4">
                        <div class="text-3xl mb-2">üèó</div>
                        <h4 class="font-semibold text-gray-900 mb-1">Âª∫ÁØâË®±ÂèØË®º</h4>
                    </div><div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4">
                        <div class="text-3xl mb-2">‚ú®</div>
                        <h4 class="font-semibold text-gray-900 mb-1">ÂÖâËß¶Â™íÂ°óÊñôÊèêÊ°àÂèØ</h4>
                    </div></div>
                    </div>

                    <!-- 6. ‰øùÊúâË≥áÊ†º„ÉªÂä†ÂÖ•‰øùÈô∫ÔºàÂÆâÂøÉÊÑüÔºâ -->
                    <div id="preview-qualifications" class="mb-12" style="display: block;">
                        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                            <span class="w-1 h-6 bg-indigo-600 mr-3 rounded"></span>
                            ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº
                        </h3>

                        <!-- „Ç´„É´„Éº„Çª„É´„Ç≥„É≥„ÉÜ„Éä -->
                        <div class="relative">
                            <!-- Â∑¶Áü¢Âç∞ -->
                            <button onclick="scrollGallery('left')" class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 z-10 bg-white shadow-lg rounded-full p-2 hover:bg-gray-50 transition">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </button>

                            <!-- „ÇÆ„É£„É©„É™„Éº„Ç´„É´„Éº„Çª„É´ -->
                            <div id="galleryCarousel" class="overflow-hidden" style="height: 288px;">
                                <div id="previewGalleryList" class="flex gap-4 transition-transform duration-300">
                                    <!-- ÁîªÂÉè„ÅØ„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÂãïÁöÑ„Å´„É≠„Éº„Éâ„Åï„Çå„Åæ„Åô -->
                                </div>
                            </div>

                            <!-- Âè≥Áü¢Âç∞ -->
                            <button onclick="scrollGallery('right')" class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 z-10 bg-white shadow-lg rounded-full p-2 hover:bg-gray-50 transition">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                        </div>

                        <!-- „Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº -->
                        <div id="galleryIndicators" class="flex justify-center gap-1 mt-4">
                        <button onclick="goToGalleryImage(0)" class="w-2 h-2 rounded-full transition bg-blue-600"></button>
                    
                        <button onclick="goToGalleryImage(1)" class="w-2 h-2 rounded-full transition bg-gray-300"></button>
                    
                        <button onclick="goToGalleryImage(2)" class="w-2 h-2 rounded-full transition bg-gray-300"></button>
                    
                        <button onclick="goToGalleryImage(3)" class="w-2 h-2 rounded-full transition bg-gray-300"></button>
                    
                        <button onclick="goToGalleryImage(4)" class="w-2 h-2 rounded-full transition bg-gray-300"></button>
                    
                        <button onclick="goToGalleryImage(5)" class="w-2 h-2 rounded-full transition bg-gray-300"></button>
                    
                        <button onclick="goToGalleryImage(6)" class="w-2 h-2 rounded-full transition bg-gray-300"></button>
                    
                        <button onclick="goToGalleryImage(7)" class="w-2 h-2 rounded-full transition bg-gray-300"></button>
                    
                        <button onclick="goToGalleryImage(8)" class="w-2 h-2 rounded-full transition bg-gray-300"></button>
                    
                        <button onclick="goToGalleryImage(9)" class="w-2 h-2 rounded-full transition bg-gray-300"></button>
                    
                        <button onclick="goToGalleryImage(10)" class="w-2 h-2 rounded-full transition bg-gray-300"></button>
                    </div>
                    </div>

                    <!-- 9. ‰ºöÁ§æÊ¶ÇË¶ÅÔºà‰ø°È†ºÊÄß„ÅÆË£úÂº∑Ôºâ -->
                    <div id="preview-basicInfo" class="mb-12">
                        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                            <span class="w-1 h-6 bg-blue-600 mr-3 rounded"></span>
                            ‰ºöÁ§æÊ¶ÇË¶Å
                        </h3>
                        <div class="bg-gray-50 rounded-xl p-8">
                            <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div id="basicInfo-companyName">
                                    <dt class="text-sm font-medium text-gray-600">‰ºöÁ§æÂêç</dt>
                                    <dd id="previewCompanyNameFull" class="mt-1 text-base sm:text-lg text-gray-900 break-words">Ê†™Âºè‰ºöÁ§æ„ÅÇ„Åü„Çã</dd>
                                </div>
                                <div id="basicInfo-representative">
                                    <dt class="text-sm font-medium text-gray-600">‰ª£Ë°®ËÄÖ</dt>
                                    <dd id="previewRepresentative" class="mt-1 text-lg text-gray-900">Â∞èÊ≥âÁ¥î‰∏Ä</dd>
                                </div>
                                <div id="basicInfo-address">
                                    <dt class="text-sm font-medium text-gray-600">ÊâÄÂú®Âú∞</dt>
                                    <dd id="previewAddress" class="mt-1 text-lg text-gray-900">„Äí2250024 Á•ûÂ•àÂ∑ùÁúåÊ®™ÊµúÂ∏ÇÈùíËëâÂå∫Â∏Ç„Ç±Â∞æÁî∫537-3</dd>
                                </div>
                                <div id="basicInfo-established">
                                    <dt class="text-sm font-medium text-gray-600">Ë®≠Á´ã</dt>
                                    <dd id="previewEstablishedDate" class="mt-1 text-lg text-gray-900">2010Âπ¥4Êúà</dd>
                                </div>
                            </dl>
                        </div>
                        <!-- Google„Éû„ÉÉ„ÉóÂüã„ÇÅËæº„Åø -->
                        <div class="mt-4" id="basicInfo-map">
                            <h4 class="text-sm font-medium text-gray-600 mb-2">„Ç¢„ÇØ„Çª„Çπ</h4>
                            <div id="googleMapContainer" class="w-full h-64 bg-gray-200 rounded-lg overflow-hidden">
                    <iframe width="100%" height="100%" frameborder="0" style="border:0" src="https://www.google.com/maps?q=%E3%80%922250024%20%E7%A5%9E%E5%A5%88%E5%B7%9D%E7%9C%8C%E6%A8%AA%E6%B5%9C%E5%B8%82%E9%9D%92%E8%91%89%E5%8C%BA%E5%B8%82%E3%82%B1%E5%B0%BE%E7%94%BA537-3&amp;output=embed" allowfullscreen="">
                    </iframe>
                </div>
                        </div>
                        <!-- ÊîØÂ∫ó„Éû„ÉÉ„Éó„Ç≥„É≥„ÉÜ„Éä„Éº -->
                        <div id="branchMapsContainer" class="mt-6" style="display: block;">
                        <h4 class="text-sm font-medium text-gray-600 mb-3 mt-4">ÊîØÂ∫óÊÉÖÂ†±</h4>
                        <div class="space-y-4">
                    </div><div class="border rounded-lg p-4 bg-gray-50">
                            <h5 class="text-lg font-semibold text-gray-800 mb-2">ÂêçÂè§Â±ãÊîØÂ∫ó</h5>
                            <p class="text-sm text-gray-600 mb-3">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                ÂêçÂè§Â±ã1-1
                            </p>
                            <div class="w-full h-64 bg-gray-200 rounded-lg overflow-hidden">
                                <iframe width="100%" height="100%" frameborder="0" style="border:0" src="https://www.google.com/maps/embed/v1/place?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&amp;q=%E5%90%8D%E5%8F%A4%E5%B1%8B1-1&amp;zoom=16&amp;language=ja" allowfullscreen="">
                                </iframe>
                            </div>
                        </div><div class="border rounded-lg p-4 bg-gray-50">
                            <h5 class="text-lg font-semibold text-gray-800 mb-2">ÂåóÊµ∑ÈÅì</h5>
                            <p class="text-sm text-gray-600 mb-3">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                Á∂≤Ëµ∞1-1
                            </p>
                            <div class="w-full h-64 bg-gray-200 rounded-lg overflow-hidden">
                                <iframe width="100%" height="100%" frameborder="0" style="border:0" src="https://www.google.com/maps/embed/v1/place?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&amp;q=%E7%B6%B2%E8%B5%B01-1&amp;zoom=16&amp;language=ja" allowfullscreen="">
                                </iframe>
                            </div>
                        </div><div></div></div>
                    </div>

                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-white border rounded-xl p-4 hover:shadow-lg transition">
                                <div class="flex items-center mb-2">
                                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">„ÅäÈõªË©±„Åß„ÅÆ„ÅäÂïè„ÅÑÂêà„Çè„Åõ</p>
                                        <a href="tel:090-1994-7162" class="text-lg font-semibold text-blue-600 hover:text-blue-800 cursor-pointer transition-colors">090-1994-7162</a>
                                        <p class="text-xs text-gray-500">Âèó‰ªòÊôÇÈñì: 9:00-18:00ÔºàÂπ¥‰∏≠ÁÑ°‰ºëÔºâ</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white border rounded-xl p-4 hover:shadow-lg transition">
                                <div class="flex items-center mb-2">
                                    <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                        </svg>
                                    </div>
                                    <div class="overflow-hidden min-w-0">
                                        <p class="text-sm text-gray-600">„É°„Éº„É´„Åß„ÅÆ„ÅäÂïè„ÅÑÂêà„Çè„Åõ</p>
                                        <a href="mailto:info@gaihekikuraberu.com" class="text-sm sm:text-base font-semibold text-blue-600 hover:text-blue-800 break-all cursor-pointer transition-colors">info@gaihekikuraberu.com</a>
                                        <p class="text-xs text-gray-500">24ÊôÇÈñìÂèó‰ªò‰∏≠</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ÊúÄ‰∏ãÈÉ®CTA -->
                    <div class="text-center py-8 border-t">
                        <h3 class="text-2xl font-bold text-gray-900 mb-4">‰ªä„Åô„ÅêÁÑ°ÊñôË¶ãÁ©ç„ÇÇ„Çä„Çí‰æùÈ†º</h3>
                        <p class="text-gray-600 mb-6">„ÅäÊ∞óËªΩ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ</p>
                        <button class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-10 py-4 rounded-lg hover:shadow-xl transition text-lg font-semibold">
                            ÁÑ°ÊñôË¶ãÁ©ç„ÇÇ„Çä„Çí‰æùÈ†º„Åô„Çã
                        </button>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    

    <script>
        // „É°„Éã„É•„Éº„Éà„Ç∞„É´Ê©üËÉΩ
        function toggleMenu() {
            const sidebar = document.getElementById('sidebar');
            if (sidebar) {
                sidebar.classList.toggle('-translate-x-full');
            }
        }

        // „É¶„Éº„Ç∂„ÉºÁä∂ÊÖãÁÆ°ÁêÜ
        let currentUser = 'ÁÆ°ÁêÜËÄÖ';

        // ÊîØÂ∫óÊÉÖÂ†±ÁÆ°ÁêÜ
        window.branches = [];
        let branchIdCounter = 0;

        // ÊîØÂ∫óËøΩÂä†
        function addBranch() {
            const branchId = ++branchIdCounter;
            const branch = {
                id: branchId,
                name: '',
                address: ''
            };
            window.branches.push(branch);

            const branchList = document.getElementById('branchList');
            const branchDiv = document.createElement('div');
            branchDiv.id = `branch-${branchId}`;
            branchDiv.className = 'border rounded-lg p-4 mb-3 bg-gray-50';
            branchDiv.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h4 class="font-medium text-gray-700">ÊîØÂ∫ó ${branchId}</h4>
                    <button onclick="removeBranch(${branchId})" class="text-red-600 hover:text-red-800">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                    </button>
                </div>
                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÊîØÂ∫óÂêç</label>
                        <input type="text" class="w-full px-3 py-2 border rounded-lg" placeholder="‰æã: Ê®™ÊµúÊîØÂ∫ó"
                               onchange="updateBranch(${branchId}, 'name', this.value)">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‰ΩèÊâÄ</label>
                        <input type="text" class="w-full px-3 py-2 border rounded-lg" placeholder="‰æã: Á•ûÂ•àÂ∑ùÁúåÊ®™ÊµúÂ∏Ç..."
                               onchange="updateBranch(${branchId}, 'address', this.value)">
                    </div>
                </div>
            `;
            branchList.appendChild(branchDiv);
        }

        // ÊîØÂ∫óÊÉÖÂ†±Êõ¥Êñ∞
        function updateBranch(branchId, field, value) {
            const branch = window.branches.find(b => b.id === branchId);
            if (branch) {
                branch[field] = value;
                updateBranchMaps();
            }
        }

        // ÊîØÂ∫óÂâäÈô§
        function removeBranch(branchId) {
            window.branches = window.branches.filter(b => b.id !== branchId);
            const branchDiv = document.getElementById(`branch-${branchId}`);
            if (branchDiv) {
                branchDiv.remove();
            }
            updateBranchMaps();
        }

        // ÊîØÂ∫ó„Éû„ÉÉ„ÉóÊõ¥Êñ∞
        function updateBranchMaps() {
            // „Éó„É¨„Éì„É•„Éº„ÅÆÊîØÂ∫ó„Éû„ÉÉ„Éó„ÇíÊõ¥Êñ∞
            const branchMapsContainer = document.getElementById('branchMapsContainer');
            if (branchMapsContainer) {
                const validBranches = window.branches.filter(b => b.name && b.address);
                if (validBranches.length > 0) {
                    branchMapsContainer.innerHTML = `
                        <h4 class="text-sm font-medium text-gray-600 mb-3 mt-4">ÊîØÂ∫óÊÉÖÂ†±</h4>
                        <div class="space-y-4">
                    `;

                    // üöÄ ‰ΩèÊâÄÈùûË°®Á§∫Ë®≠ÂÆö„ÇíÁ¢∫Ë™ç
                    const hideAddress = document.getElementById('hideAddress')?.checked || false;

                    validBranches.forEach((branch, index) => {
                        const mapDiv = document.createElement('div');
                        mapDiv.className = 'border rounded-lg p-4 bg-gray-50';

                        // üöÄ ÊîØÂ∫ó‰ΩèÊâÄ„ÅÆÂá¶ÁêÜÔºà‰ΩèÊâÄÈùûË°®Á§∫Ë®≠ÂÆö„Å´Âæì„Å£„Å¶Áï™Âú∞„Ç´„ÉÉ„ÉàÔºâ
                        let displayAddress = branch.address;
                        if (hideAddress) {
                            // ‰ΩèÊâÄ„ÅÆÁï™Âú∞ÈÉ®ÂàÜ„ÇíÈô§ÂéªÔºàÊï∞Â≠ó„Å®„Éè„Ç§„Éï„É≥„ÇíÂê´„ÇÄÈÉ®ÂàÜ„Çí„Ç´„ÉÉ„ÉàÔºâ
                            displayAddress = branch.address.replace(/[\d\-]+.*$/, '').trim();
                            console.log(`[updateBranchMaps] ÊîØÂ∫ó‰ΩèÊâÄ„ÅÆÁï™Âú∞„Çí„Ç´„ÉÉ„Éà: ${branch.address} ‚Üí ${displayAddress}`);
                        }

                        mapDiv.innerHTML = `
                            <h5 class="text-lg font-semibold text-gray-800 mb-2">${branch.name}</h5>
                            <p class="text-sm text-gray-600 mb-3">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                ${displayAddress}
                            </p>
                            <div class="w-full h-64 bg-gray-200 rounded-lg overflow-hidden">
                                <iframe
                                    width="100%"
                                    height="100%"
                                    frameborder="0"
                                    style="border:0"
                                    src="https://www.google.com/maps/embed/v1/place?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&q=${encodeURIComponent(branch.address)}&zoom=16&language=ja"
                                    allowfullscreen>
                                </iframe>
                            </div>
                        `;
                        branchMapsContainer.appendChild(mapDiv);
                    });
                    const closeDiv = document.createElement('div');
                    closeDiv.innerHTML = '</div>';
                    branchMapsContainer.appendChild(closeDiv);
                    branchMapsContainer.style.display = 'block';
                } else {
                    branchMapsContainer.style.display = 'none';
                }
            }
        }
        let userRole = 'admin';

        // „É≠„Ç∞„Ç§„É≥Âá¶ÁêÜ
        // GAS API„ÅÆURLÔºàenv-loader.js„Åã„ÇâÂèñÂæóÔºâ
        const GAS_URL = ENV.GAS_URL;

        // „Çπ„ÉÜ„Éº„Çø„Çπ„Çí„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâË™≠„ÅøËæº„ÇÄÈñ¢Êï∞

        // „Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫„ÇíÊõ¥Êñ∞„Åô„ÇãÈñ¢Êï∞
        function updateHeaderStatus(status) {
            const statusSpan = document.getElementById('merchantStatus');
            if (!statusSpan) return;

            // „Çπ„Éó„Ç∑„ÅÆAJÂàó„ÅÆÂÄ§„Çí„Åù„ÅÆ„Åæ„ÅæË°®Á§∫
            statusSpan.textContent = status;

            // „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„ÅüËâ≤„ÇíË®≠ÂÆö
            statusSpan.classList.remove('bg-green-100', 'text-green-800', 'border-green-300');
            statusSpan.classList.remove('bg-yellow-100', 'text-yellow-800', 'border-yellow-300');
            statusSpan.classList.remove('bg-gray-100', 'text-gray-800', 'border-gray-300');
            statusSpan.classList.remove('bg-red-100', 'text-red-800', 'border-red-300');

            if (status === '„Ç¢„ÇØ„ÉÜ„Ç£„Éñ') {
                statusSpan.classList.add('bg-green-100', 'text-green-800', 'border-green-300');
            } else if (status === '‰∏ÄÊôÇÂÅúÊ≠¢') {
                statusSpan.classList.add('bg-yellow-100', 'text-yellow-800', 'border-yellow-300');
            } else if (status === '‰ºëÊ≠¢') {
                statusSpan.classList.add('bg-red-100', 'text-red-800', 'border-red-300');
            } else {
                statusSpan.classList.add('bg-gray-100', 'text-gray-800', 'border-gray-300');
            }
        }

        // „Éò„ÉÉ„ÉÄ„Éº„Çπ„ÉÜ„Éº„Çø„Çπ„ÇØ„É™„ÉÉ„ÇØÊôÇ„ÅÆÂá¶ÁêÜÔºàV1703Ôºâ
        async function handleHeaderStatusClick() {
            const statusSpan = document.getElementById('merchantStatus');
            if (!statusSpan) return;

            const currentStatus = statusSpan.textContent.trim();
            console.log('[handleHeaderStatusClick] Current status:', currentStatus);

            // ‰ºëÊ≠¢„ÅÆ„Å®„Åç„ÅÆ„Åø„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´Â§âÊõ¥ÂèØËÉΩ
            if (currentStatus === '‰ºëÊ≠¢') {
                if (!confirm('ÈÅãÁî®„Çπ„ÉÜ„Éº„Çø„Çπ„Çí„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´Â§âÊõ¥„Åó„Åæ„Åô„ÅãÔºü\n‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„ÇÇËß£Èô§„Åï„Çå„Åæ„Åô„ÄÇ')) {
                    return;
                }

                try {
                    await resumeAutoDelivery();
                } catch (error) {
                    console.error('[handleHeaderStatusClick] Error:', error);
                    showToast('„Çπ„ÉÜ„Éº„Çø„Çπ„ÅÆÂ§âÊõ¥„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                }
            } else if (currentStatus === '„Ç¢„ÇØ„ÉÜ„Ç£„Éñ') {
                showToast('„Åô„Åß„Å´„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„Åß„Åô„ÄÇ‰∏ÄÊôÇÂÅúÊ≠¢„Å´„Åô„Çã„Å´„ÅØËá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Åã„ÇâÂ§âÊõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'info');
            } else if (currentStatus === '‰∏ÄÊôÇÂÅúÊ≠¢' || currentStatus === '‰∏ÄÊôÇÂÅúÊ≠¢‰∏≠') {
                showToast('‰∏ÄÊôÇÂÅúÊ≠¢‰∏≠„Åß„Åô„ÄÇ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´„Åô„Çã„Å´„ÅØËá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Åã„ÇâÂ§âÊõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'info');
            }
        }

        // ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„ÅÆ„Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫„ÇíÊõ¥Êñ∞„Åô„ÇãÈñ¢Êï∞Ôºà„Éò„ÉÉ„ÉÄ„Éº„Å®Áµ±‰∏ÄÔºâ
        function updatePauseStatus(status) {
            const pauseStatusDisplay = document.getElementById('pauseStatusDisplay');
            if (!pauseStatusDisplay) return;

            pauseStatusDisplay.textContent = status;

            if (status === '„Ç¢„ÇØ„ÉÜ„Ç£„Éñ') {
                pauseStatusDisplay.className = 'px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 cursor-pointer hover:opacity-80 transition-opacity';
            } else if (status === '‰∏ÄÊôÇÂÅúÊ≠¢' || status === '‰∏ÄÊôÇÂÅúÊ≠¢‰∏≠') {
                pauseStatusDisplay.className = 'px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800 cursor-pointer hover:opacity-80 transition-opacity';
            } else if (status === '‰ºëÊ≠¢') {
                pauseStatusDisplay.className = 'px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800 cursor-pointer hover:opacity-80 transition-opacity';
            } else {
                pauseStatusDisplay.className = 'px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800 cursor-pointer hover:opacity-80 transition-opacity';
            }
        }

        // „Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Éê„ÉÉ„Ç∏„ÇØ„É™„ÉÉ„ÇØÊôÇ„ÅÆÂá¶ÁêÜ
        async function handleStatusClick() {
            const pauseStatusDisplay = document.getElementById('pauseStatusDisplay');
            if (!pauseStatusDisplay) return;

            const currentStatus = pauseStatusDisplay.textContent.trim();
            console.log('[handleStatusClick] Current status:', currentStatus);

            // ‰ºëÊ≠¢„Åæ„Åü„ÅØ‰∏ÄÊôÇÂÅúÊ≠¢‰∏≠„ÅÆÂ†¥Âêà„ÅÆ„Åø„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´Â§âÊõ¥ÂèØËÉΩ
            if (currentStatus === '‰ºëÊ≠¢' || currentStatus === '‰∏ÄÊôÇÂÅúÊ≠¢‰∏≠' || currentStatus === '‰∏ÄÊôÇÂÅúÊ≠¢') {
                const confirmMessage = currentStatus === '‰ºëÊ≠¢'
                    ? 'ÈÅãÁî®„Çπ„ÉÜ„Éº„Çø„Çπ„Çí„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´Â§âÊõ¥„Åó„Åæ„Åô„ÅãÔºü\n‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„ÇÇËß£Èô§„Åï„Çå„Åæ„Åô„ÄÇ'
                    : '‰∏ÄÊôÇÂÅúÊ≠¢„ÇíËß£Èô§„Åó„Å¶„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´Â§âÊõ¥„Åó„Åæ„Åô„ÅãÔºü';

                if (!confirm(confirmMessage)) {
                    return;
                }

                try {
                    await resumeAutoDelivery();
                } catch (error) {
                    console.error('[handleStatusClick] Error:', error);
                    showToast('„Çπ„ÉÜ„Éº„Çø„Çπ„ÅÆÂ§âÊõ¥„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                }
            } else if (currentStatus === '„Ç¢„ÇØ„ÉÜ„Ç£„Éñ') {
                showToast('„Åô„Åß„Å´„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„Åß„Åô', 'info');
            }
        }

        // ‰∏ÄÊôÇÂÅúÊ≠¢„ÇíËß£Èô§„Åó„Å¶„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´Êàª„ÅôÈñ¢Êï∞
        async function resumeAutoDelivery() {
            console.log('[resumeAutoDelivery] ‰∏ÄÊôÇÂÅúÊ≠¢Ëß£Èô§ÈñãÂßã');

            try {
                const requestData = {
                    action: 'resumeAutoDelivery',
                    merchantId: window.merchantId
                };

                console.log('[resumeAutoDelivery] Sending request:', requestData);

                // GAS„Å´ÈÄÅ‰ø°
                const response = await fetch(window.ENV.GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(requestData)
                });

                console.log('[resumeAutoDelivery] Response status:', response.status);
                const result = await response.json();

                console.log('[resumeAutoDelivery] Response:', result);

                if (result.success) {
                    showToast('ÈÅãÁî®„Çπ„ÉÜ„Éº„Çø„Çπ„Çí„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´Â§âÊõ¥„Åó„Åæ„Åó„Åü', 'success');

                    // V1703-FIX2: localStorage„Åã„Çâ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„Çí„ÇØ„É™„Ç¢
                    if (window.merchantId) {
                        localStorage.removeItem(`pauseSettings_${window.merchantId}`);
                        console.log('[resumeAutoDelivery] Cleared localStorage pause settings');
                    }

                    // „Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÂç≥Â∫ß„Å´Êõ¥Êñ∞ÔºàV1703Ôºâ
                    updateHeaderStatus('„Ç¢„ÇØ„ÉÜ„Ç£„Éñ');
                    updatePauseStatus('„Ç¢„ÇØ„ÉÜ„Ç£„Éñ');

                    // ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„ÅÆUI„ÇÇ„É™„Çª„ÉÉ„Éà
                    const autoPauseToggle = document.getElementById('autoPauseToggle');
                    if (autoPauseToggle) {
                        autoPauseToggle.checked = false;
                    }

                    // Èñ≤Ë¶ß„É¢„Éº„Éâ„ÅÆ‰∏ÄÊôÇÂÅúÊ≠¢Êó•ÊôÇË°®Á§∫„ÇíÈùûË°®Á§∫
                    const pauseDateDisplay = document.getElementById('pauseDateDisplay');
                    if (pauseDateDisplay) {
                        pauseDateDisplay.classList.add('hidden');
                    }

                    // ÊúÄÊñ∞„Éá„Éº„Çø„ÇíÂÜçÂèñÂæó„Åó„Å¶ÁîªÈù¢„ÇíÊõ¥Êñ∞ÔºàV1703 FIXÔºâ
                    await fetchMerchantData(window.merchantId);
                    if (window.merchantData) {
                        window.loadAutodeliverySettings(window.merchantData);
                    }

                } else {
                    throw new Error(result.error || '‰∏ÄÊôÇÂÅúÊ≠¢„ÅÆËß£Èô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }

            } catch (error) {
                console.error('[resumeAutoDelivery] Error:', error);
                throw error;
            }
        }

        // Âä†ÁõüÂ∫ó„Éá„Éº„Çø„ÇíÂèñÂæó„Åô„ÇãÈñ¢Êï∞
        async function fetchMerchantData(merchantId) {
            console.log('[fetchMerchantData] ÈñãÂßã merchantId:', merchantId);
            try {
                const result = await new Promise((resolve, reject) => {
                    const callbackName = 'jsonp_data_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    const script = document.createElement('script');

                    window[callbackName] = (data) => {
                        delete window[callbackName];
                        if (script.parentNode) {
                            script.parentNode.removeChild(script);
                        }
                        resolve(data);
                    };

                    script.src = `${window.ENV.GAS_URL}?action=getMerchantData&merchantId=${encodeURIComponent(merchantId)}&callback=${callbackName}`;
                    script.onerror = () => {
                        delete window[callbackName];
                        if (script.parentNode) {
                            script.parentNode.removeChild(script);
                        }
                        reject(new Error('JSONP request failed'));
                    };
                    document.body.appendChild(script);
                });

                console.log('[fetchMerchantData] ÂèñÂæóÁµêÊûú:', result);
                if (result.success && result.data) {
                    window.merchantData = result.data;
                    window.merchantId = merchantId;

                    const salesPersonName = result.data['Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç'] || result.data.salesPersonName || result.data.sales_person_name || '';
                    console.log('[fetchMerchantData] Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç:', salesPersonName);
                    if (salesPersonName) {
                        window.merchantData.salesPerson = salesPersonName;
                    }

                    // „Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Çí„Çπ„Éó„Ç∑„ÅÆAJÂàó„Åã„ÇâÂèçÊò†
                    const status = result.data['„Çπ„ÉÜ„Éº„Çø„Çπ'];
                    console.log('[fetchMerchantData] „Çπ„ÉÜ„Éº„Çø„Çπ:', status);
                    if (status) {
                        updateHeaderStatus(status);
                        // V1703: ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„ÅÆÁä∂ÊÖãË°®Á§∫„ÇÇÂêåÊúü
                        updatePauseStatus(status);
                    }

                    // „Éò„ÉÉ„ÉÄ„Éº„ÅÆÂñ∂Ê•≠ÊãÖÂΩìËÄÖ„ÇíÊõ¥Êñ∞
                    console.log('[fetchMerchantData] updateRoleDisplayÂëº„Å≥Âá∫„ÅóÂâç currentUser:', currentUser);
                    updateRoleDisplay();
                } else {
                    console.log('[fetchMerchantData] Â§±Êïó result:', result);
                    window.merchantData = {};
                }
            } catch (error) {
                console.error('[fetchMerchantData] „Ç®„É©„Éº:', error);
                window.merchantData = {};
            }
        }

        // Ê±éÁî®GAS APIÂëº„Å≥Âá∫„ÅóÔºàJSONPÔºâ
        async function callGasApi(action, params = {}) {
            console.log('[callGasApi] Calling action:', action, 'with params:', params);
            return new Promise((resolve, reject) => {
                const callbackName = 'jsonp_' + action + '_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                const script = document.createElement('script');

                window[callbackName] = (data) => {
                    delete window[callbackName];
                    if (script.parentNode) {
                        script.parentNode.removeChild(script);
                    }
                    resolve(data);
                };

                const queryParams = new URLSearchParams({
                    action: action,
                    callback: callbackName,
                    ...params
                });

                script.src = `${window.ENV.GAS_URL}?${queryParams.toString()}`;
                script.onerror = () => {
                    delete window[callbackName];
                    if (script.parentNode) {
                        script.parentNode.removeChild(script);
                    }
                    reject(new Error('Script load error'));
                };

                document.body.appendChild(script);
            });
        }

        // Âñ∂Ê•≠ÊãÖÂΩìËÄÖÂêçÁ∑®ÈõÜ
        function editSalesPerson() {
            const userRoleDiv = document.getElementById('userRole');
            const userRoleInput = document.getElementById('userRoleInput');

            userRoleInput.value = userRoleDiv.textContent;
            userRoleDiv.classList.add('hidden');
            userRoleInput.classList.remove('hidden');
            userRoleInput.focus();
            userRoleInput.select();
        }

        // Âñ∂Ê•≠ÊãÖÂΩìËÄÖÂêç‰øùÂ≠ò
        async function saveSalesPerson() {
            const userRoleDiv = document.getElementById('userRole');
            const userRoleInput = document.getElementById('userRoleInput');
            const newSalesPerson = userRoleInput.value.trim();

            if (!newSalesPerson) {
                alert('Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            try {
                // JSONP „Åß„Éá„Éº„Çø‰øùÂ≠ò
                const result = await new Promise((resolve, reject) => {
                    const callbackName = 'jsonp_sales_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    const script = document.createElement('script');

                    window[callbackName] = (data) => {
                        delete window[callbackName];
                        if (script.parentNode) {
                            script.parentNode.removeChild(script);
                        }
                        resolve(data);
                    };

                    script.src = `${window.ENV.GAS_URL}?action=updateSalesPerson&merchantId=${encodeURIComponent(currentUser)}&salesPerson=${encodeURIComponent(newSalesPerson)}&callback=${callbackName}`;
                    script.onerror = () => {
                        delete window[callbackName];
                        if (script.parentNode) {
                            script.parentNode.removeChild(script);
                        }
                        reject(new Error('JSONP request failed'));
                    };
                    document.body.appendChild(script);
                });

                if (result.success) {
                    // ÊàêÂäü - Ë°®Á§∫„ÇíÊõ¥Êñ∞
                    userRoleDiv.textContent = newSalesPerson;
                    if (window.merchantData) {
                        window.merchantData.salesPerson = newSalesPerson;
                    }
                } else {
                    // Â§±Êïó - ÂÖÉ„Å´Êàª„Åô
                    console.error('Save failed:', result.error);
                }
            } catch (error) {
                console.error('Save error:', error);
            }

            // ÂÖ•ÂäõÊ¨Ñ„ÇíÈùûË°®Á§∫„ÄÅ„ÉÜ„Ç≠„Çπ„Éà„ÇíË°®Á§∫
            userRoleInput.classList.add('hidden');
            userRoleDiv.classList.remove('hidden');
        }

        // „É≠„Éº„É´Ë°®Á§∫Êõ¥Êñ∞
        function updateRoleDisplay() {
            // „É¶„Éº„Ç∂„ÉºÂêç„Å®„É≠„Éº„É´„ÇíË°®Á§∫
            document.getElementById('userName').textContent = currentUser;

            // Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç„ÇíË°®Á§∫Ôºàwindow.merchantData„ÅÆXÂàó„Åã„ÇâÂèñÂæóÔºâ
            let salesPerson = 'Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊú™Ë®≠ÂÆö';
            if (window.merchantData && window.merchantData.salesPerson) {
                salesPerson = window.merchantData.salesPerson;
            }
            document.getElementById('userRole').textContent = salesPerson;
            
            // Ê®©Èôê„Å´Âøú„Åò„Å¶UI„ÇíÂ§âÊõ¥
            if (userRole === 'admin') {
                // ÁÆ°ÁêÜËÄÖ: „Åô„Åπ„Å¶Ë°®Á§∫„ÄÅÁ¥´Á≥ª„ÅÆÈÖçËâ≤
                document.getElementById('systemTitle').textContent = 'Âä†ÁõüÂ∫óÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†';
                document.getElementById('companyLogo').style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                document.getElementById('userRole').className = 'ml-2 text-xs px-2 py-1 rounded-full bg-purple-100 text-purple-800';
            } else {
                // Âñ∂Ê•≠: Âü∫Êú¨Ê©üËÉΩ„ÅÆ„Åø„ÄÅÈùíÁ≥ª„ÅÆÈÖçËâ≤
                document.getElementById('systemTitle').textContent = 'Âä†ÁõüÂ∫óÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†';
                document.getElementById('companyLogo').style.background = 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)';
                document.getElementById('userRole').className = 'ml-2 text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-800';
            }
            
            // ÁÆ°ÁêÜËÄÖÂ∞ÇÁî®„É°„Éã„É•„Éº„ÅÆË°®Á§∫Âà∂Âæ°
            const adminElements = document.querySelectorAll('.admin-only');
            adminElements.forEach(el => {
                el.style.display = userRole === 'admin' ? 'flex' : 'none';
            });
            
            // „É™„Éº„ÉÄ„ÉºÂ∞ÇÁî®Ë¶ÅÁ¥†„Åå„ÅÇ„Çå„Å∞ÁÆ°ÁêÜËÄÖ„ÅÆ„ÅøË°®Á§∫
            const leaderElements = document.querySelectorAll('.leader-only');
            leaderElements.forEach(el => {
                el.style.display = userRole === 'admin' ? 'flex' : 'none';
            });
        }

        // ÈÄöÁü•Ê®©Èôê„É™„ÇØ„Ç®„Çπ„Éà
        // ÈÄöÁü•Ë®±ÂèØ„É™„ÇØ„Ç®„Çπ„Éà„Çí„Ç¢„É©„Éº„Éà„Éë„Éç„É´ÂÜÖ„Å´Áµ±Âêà
        window.requestNotificationPermission = function() {
            if ('Notification' in window && Notification.permission !== 'granted') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        showNotification('ÈÄöÁü•Ë®≠ÂÆö', '„Éñ„É©„Ç¶„Ç∂ÈÄöÁü•„ÇíÊúâÂäπ„Å´„Åó„Åæ„Åó„Åü', 'success');
                    } else {
                        showInAppNotification('ÈÄöÁü•Ë®≠ÂÆö', '„Éñ„É©„Ç¶„Ç∂ÈÄöÁü•„ÅØÁÑ°Âäπ„Åß„Åô', 'warning');
                    }
                });
            }
        }

        // „Ç¢„É©„Éº„Éà„Éë„Éç„É´„ÇíÈñã„ÅèÊôÇ„Å´ÈÄöÁü•Ë®±ÂèØ„ÇíÁ¢∫Ë™ç
        function checkNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                const alertPanel = document.getElementById('alertPanel');
                if (alertPanel && !alertPanel.classList.contains('hidden')) {
                    // ÈÄöÁü•Ë®±ÂèØ„Éê„Éä„Éº„ÇíË°®Á§∫
                    const banner = document.createElement('div');
                    banner.className = 'bg-yellow-100 border-l-4 border-yellow-500 p-3 m-3';
                    banner.innerHTML = `
                        <div class="flex items-center justify-between">
                            <span class="text-sm">üîî „Éñ„É©„Ç¶„Ç∂ÈÄöÁü•„ÇíÊúâÂäπ„Å´„Åó„Åæ„Åô„ÅãÔºü</span>
                            <button onclick="requestNotificationPermission(); this.parentElement.parentElement.remove()"
                                    class="text-sm bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600">
                                ÊúâÂäπ„Å´„Åô„Çã
                            </button>
                        </div>
                    `;
                    alertPanel.insertBefore(banner, alertPanel.firstChild.nextSibling);
                }
            }
        }

        // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò
        async function saveAutoDeliverySettings() {
            console.log('[saveAutoDeliverySettings] Function called');
            const saveBtn = document.getElementById('saveAutodeliveryBtn');
            const originalText = saveBtn ? saveBtn.innerHTML : '';

            try {
                // „Éú„Çø„É≥„Çí„É≠„Éº„Éá„Ç£„É≥„Ç∞Áä∂ÊÖã„Å´
                if (saveBtn) {
                    saveBtn.disabled = true;
                    saveBtn.innerHTML = '<svg class="animate-spin inline-block w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>‰øùÂ≠ò‰∏≠...';
                }

                console.log('[saveAutoDeliverySettings] Collecting data...');
                const autoDeliveryData = collectAutoDeliveryData();
                console.log('[saveAutoDeliverySettings] Data collected:', autoDeliveryData);

                if (!autoDeliveryData) {
                    alert('„Ç®„É©„Éº: ÂøÖÈ†àÈ†ÖÁõÆ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                console.log('[saveAutoDeliverySettings] Sending data:', autoDeliveryData);

                // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Çí‰øùÂ≠ò
                const response = await fetch(window.ENV.GAS_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: JSON.stringify({
                        action: 'updateAutoDeliverySettings',
                        merchantId: window.merchantId,
                        ...autoDeliveryData
                    })
                });

                console.log('[saveAutoDeliverySettings] Response status:', response.status);
                const result = await response.json();
                console.log('[saveAutoDeliverySettings] Result:', result);

                if (result.success) {
                    // ÊàêÂäüÊôÇ: „ÉÅ„Çß„ÉÉ„ÇØ„Éû„Éº„ÇØ„ÇíË°®Á§∫
                    if (saveBtn) {
                        saveBtn.innerHTML = '<svg class="inline-block w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>‰øùÂ≠òÂÆå‰∫Ü';
                    }

                    setTimeout(() => {
                        alert('‰øùÂ≠òÂÆå‰∫Ü: Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
                    }, 300);

                    resetAutodeliveryChanged();

                    // „Çπ„ÉÜ„Éº„Çø„Çπ„ÅåÂ§âÊõ¥„Åï„Çå„ÅüÂ†¥Âêà„ÄÅ„Éò„ÉÉ„ÉÄ„Éº„ÅÆË°®Á§∫„ÇíÂç≥Â∫ß„Å´Êõ¥Êñ∞
                    console.log('[saveAutoDeliverySettings] autoDeliveryData.status:', autoDeliveryData.status);
                    if (autoDeliveryData.status) {
                        console.log('[saveAutoDeliverySettings] Calling updateHeaderStatus with:', autoDeliveryData.status);
                        updateHeaderStatus(autoDeliveryData.status);
                    } else {
                        console.warn('[saveAutoDeliverySettings] No status in autoDeliveryData');
                    }

                    // 2ÁßíÂæå„Å´„Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
                    setTimeout(() => {
                        if (saveBtn) {
                            saveBtn.innerHTML = originalText;
                            saveBtn.disabled = false;
                        }
                    }, 2000);
                } else {
                    alert('„Ç®„É©„Éº: ' + (result.error || '‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'));
                }
            } catch (error) {
                console.error('[saveAutoDeliverySettings] Error:', error);
                alert('„Ç®„É©„Éº: ‰øùÂ≠ò‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
            } finally {
                // „Ç®„É©„ÉºÊôÇ„ÅØ„Åô„Åê„Å´ÂÖÉ„Å´Êàª„Åô
                if (saveBtn && saveBtn.disabled) {
                    setTimeout(() => {
                        saveBtn.innerHTML = originalText;
                        saveBtn.disabled = false;
                    }, 500);
                }
            }
        }

        // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Éá„Éº„Çø„ÇíÂèéÈõÜ
        function collectAutoDeliveryData() {
            // Áâ©‰ª∂Á®ÆÂà•ÔºàautodeliverySection„Å´ÈôêÂÆöÔºâ
            const propertyTypes = Array.from(document.querySelectorAll('#autodeliverySection input[name="propertyType"]:checked'))
                .map(cb => {
                    const typeMap = {
                        'house': 'Êà∏Âª∫„Å¶‰ΩèÂÆÖ',
                        'apartment': '„Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥',
                        'commercial': 'Â∫óËàó„Éª‰∫ãÂãôÊâÄ',
                        'factory': 'Â∑•Â†¥„ÉªÂÄâÂ∫´'
                    };
                    return typeMap[cb.value];
                });

            // Áâ©‰ª∂Á®ÆÂà•„Åå1„Å§„ÇÇÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØ„Ç®„É©„Éº
            if (propertyTypes.length === 0) {
                alert('„Ç®„É©„Éº: ÂØæÂøúÂèØËÉΩÁâ©‰ª∂Á®ÆÂà•„ÇíÊúÄ‰Ωé1„Å§ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return null;
            }

            // ÊúÄÂ§ßÂØæÂøúÈöéÊï∞
            const selects = document.querySelectorAll('#autodeliverySection select');
            const maxFloorsList = [];
            const typeNames = ['Êà∏Âª∫„Å¶‰ΩèÂÆÖ', '„Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥', 'Â∫óËàó„Éª‰∫ãÂãôÊâÄ', 'Â∑•Â†¥„ÉªÂÄâÂ∫´'];
            selects.forEach((select, idx) => {
                if (propertyTypes.includes(typeNames[idx])) {
                    // selectË¶ÅÁ¥†„ÅÆÈÅ∏Êäû„Åï„Çå„Åüoption„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÇíÂèñÂæó
                    const selectedOption = select.options[select.selectedIndex];
                    const optionText = selectedOption ? selectedOption.text : select.value;
                    maxFloorsList.push(`${typeNames[idx]}(${optionText}„Åæ„Åß)`);
                }
            });

            // ÁØâÂπ¥Êï∞ÁØÑÂõ≤
            const ageSliders = document.querySelectorAll('#autodeliverySection input[type="range"]');
            const ageMin = ageSliders[0] ? parseInt(ageSliders[0].value) : 0;
            const ageMax = ageSliders[1] ? parseInt(ageSliders[1].value) : 50;

            // ÊñΩÂ∑•ÁÆáÊâÄÔºàÂÆåÂÖ®‰∏ÄËá¥„Åß‰øùÂ≠òÔºâÔºàautodeliverySection„Å´ÈôêÂÆöÔºâ
            const constructionTypes = Array.from(document.querySelectorAll('#autodeliverySection input[name="constructionTypes"]:checked'))
                .map(cb => cb.value);

            // ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆÔºàÂÆåÂÖ®‰∏ÄËá¥„Åß‰øùÂ≠òÔºâÔºàautodeliverySection„Å´ÈôêÂÆöÔºâ
            const specialServices = Array.from(document.querySelectorAll('#autodeliverySection input[name="specialServices"]:checked'))
                .map(cb => cb.value);

            // ÂØæÂøúÈÉΩÈÅìÂ∫úÁúå„ÉªÂ∏ÇÂå∫Áî∫Êùë
            const prefectures = window.areaSelectionData.prefectures.join(',');

            // Â∏ÇÂå∫Áî∫Êùë„ÇíJSONÂúßÁ∏ÆÂΩ¢Âºè„Åß‰øùÂ≠òÔºà„Çπ„Éó„Ç∑„Å®Âêå„ÅòÂΩ¢ÂºèÔºâ
            const allCities = [];
            Object.entries(window.areaSelectionData.cities).forEach(([pref, cities]) => {
                allCities.push(...cities);
            });
            const citiesStr = JSON.stringify({
                type: "compressed",
                full: allCities.join(','),
                preview: allCities.slice(0, 100).join(',') + (allCities.length > 100 ? '...' : '')
            });

            // ÂÑ™ÂÖà„Ç®„É™„Ç¢: „Ç¢„É≥„ÉÄ„Éº„Çπ„Ç≥„Ç¢ÂΩ¢Âºè„ÅÆ„Åæ„Åæ‰øùÂ≠òÔºà„Çπ„Éó„Ç∑„ÅÆÂΩ¢Âºè„Å´Âêà„Çè„Åõ„ÇãÔºâ
            const priorities = window.areaSelectionData.priorities.join(',');

            // ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„Éá„Éº„Çø
            const autoPauseToggle = document.getElementById('autoPauseToggle');
            const pauseStartDate = document.getElementById('pauseStartDate');
            const pauseEndDate = document.getElementById('pauseEndDate');
            const indefinitePause = document.getElementById('indefinitePause');

            const pauseFlag = autoPauseToggle ? autoPauseToggle.checked : false;
            const pauseStart = pauseFlag && pauseStartDate ? pauseStartDate.value : '';
            const pauseEnd = pauseFlag && pauseEndDate && !indefinitePause.checked ? pauseEndDate.value : '';
            const isIndefinite = pauseFlag && indefinitePause && indefinitePause.checked;

            // ‰∏ÄÊôÇÂÅúÊ≠¢„Éê„É™„Éá„Éº„Ç∑„Éß„É≥
            if (pauseFlag) {
                // ‰∏ÄÊôÇÂÅúÊ≠¢ON„ÅÆÂ†¥Âêà„ÄÅÈñãÂßãÊó•„ÅØÂøÖÈ†à
                if (!pauseStart) {
                    showNotification('„Ç®„É©„Éº', '‰∏ÄÊôÇÂÅúÊ≠¢ÈñãÂßãÊó•„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                    return null;
                }
                // ÂÜçÈñã‰∫àÂÆöÊó•„ÇÇÂøÖÈ†àÔºàÊú™ÂÆö„ÉÅ„Çß„ÉÉ„ÇØ„ÅåOFF„ÅÆÂ†¥ÂêàÔºâ
                if (!isIndefinite && !pauseEnd) {
                    showNotification('„Ç®„É©„Éº', '‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñã‰∫àÂÆöÊó•„ÇíÂÖ•Âäõ„Åô„Çã„Åã„ÄÅ„ÄåÊú™ÂÆö„Äç„Å´„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÂÖ•„Çå„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                    return null;
                }
            }

            // „Çπ„ÉÜ„Éº„Çø„Çπ„ÅÆÊ±∫ÂÆö
            // - ‰∏ÄÊôÇÂÅúÊ≠¢OFF ‚Üí „Ç¢„ÇØ„ÉÜ„Ç£„Éñ
            // - ‰∏ÄÊôÇÂÅúÊ≠¢ON + ÈñãÂßãÊó•„ÅåÊú™Êù• ‚Üí „Ç¢„ÇØ„ÉÜ„Ç£„ÉñÔºà„Çπ„Ç±„Ç∏„É•„Éº„É´‰∫àÁ¥ÑÔºâ
            // - ‰∏ÄÊôÇÂÅúÊ≠¢ON + ÈñãÂßãÊó•„Åå‰ªäÊó•‰ª•Ââç + ÂÜçÈñãÊó•Êú™ÂÆö ‚Üí ‰ºëÊ≠¢
            // - ‰∏ÄÊôÇÂÅúÊ≠¢ON + ÈñãÂßãÊó•„Åå‰ªäÊó•‰ª•Ââç + ÂÜçÈñãÊó•„ÅÇ„Çä ‚Üí ‰∏ÄÊôÇÂÅúÊ≠¢
            let status = '„Ç¢„ÇØ„ÉÜ„Ç£„Éñ';
            if (pauseFlag && pauseStart) {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const startDate = new Date(pauseStart);
                startDate.setHours(0, 0, 0, 0);

                // ÈñãÂßãÊó•„Åå‰ªäÊó•„Åæ„Åü„ÅØÈÅéÂéª„ÅÆÂ†¥Âêà„ÅÆ„Åø„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥
                if (startDate <= today) {
                    status = isIndefinite ? '‰ºëÊ≠¢' : '‰∏ÄÊôÇÂÅúÊ≠¢';
                }
                // ÈñãÂßãÊó•„ÅåÊú™Êù•„ÅÆÂ†¥Âêà„ÅØ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„ÅÆ„Åæ„ÅæÔºà‰∫àÁ¥ÑÁä∂ÊÖãÔºâ
            }

            return {
                // GAS„ÅÆupdateAutoDeliverySettings„ÅßÊúüÂæÖ„Åô„Çã„Éï„Ç£„Éº„É´„ÉâÂêç„Å´Âêà„Çè„Åõ„Çã
                propertyTypes: propertyTypes.join(','),               // ÂØæÂøúÁâ©‰ª∂Á®ÆÂà•
                maxFloors: maxFloorsList.join(','),                    // ÊúÄÂ§ßÂØæÂøúÈöéÊï∞
                ageRange: `{min=${ageMin}, max=${ageMax}}`,           // ÁØâÂπ¥Êï∞ÂØæÂøúÁØÑÂõ≤
                constructionTypes: constructionTypes.join(','),        // ÂØæÂøúÂ∑•‰∫ãÁ®ÆÂà•ÔºàÊñΩÂ∑•ÁÆáÊâÄÂàó„Å´‰øùÂ≠òÔºâ
                specialServices: specialServices.join(','),           // ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ
                prefectures: prefectures,                             // ÂØæÂøúÈÉΩÈÅìÂ∫úÁúå
                cities: citiesStr,                                    // ÂØæÂøúÂ∏ÇÂå∫Áî∫Êùë
                priorities: priorities,                               // ÂÑ™ÂÖà„Ç®„É™„Ç¢
                // ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö
                status: status,                                       // „Çπ„ÉÜ„Éº„Çø„Çπ (AJÂàó)
                pauseFlag: pauseFlag ? 'true' : 'false',             // ‰∏ÄÊôÇÂÅúÊ≠¢„Éï„É©„Ç∞ (AOÂàó) - GASÂÅ¥„Å´Âêà„Çè„Åõ„Å¶Â∞èÊñáÂ≠ó
                pauseStartDate: pauseFlag ? (pauseStart || '') : '',  // ‰∏ÄÊôÇÂÅúÊ≠¢ÈñãÂßãÊó• (APÂàó) - OFF„ÅÆÊôÇ„ÅØÁ©∫
                pauseEndDate: pauseFlag ? (isIndefinite ? 'Êú™ÂÆö' : (pauseEnd || '')) : '' // ‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñã‰∫àÂÆöÊó• (AQÂàó) - OFF„ÅÆÊôÇ„ÅØÁ©∫
            };
        }

        // Â±ãÂè∑Ë°®Á§∫„Ç™„Éó„Ç∑„Éß„É≥„ÅÆË°®Á§∫/ÈùûË°®Á§∫
        function updateTradeNameDisplay() {
            const tradeName = document.getElementById('tradeName').value;
            const tradeNameOptions = document.getElementById('tradeNameDisplayOptions');

            if (tradeName && tradeName.trim() !== '') {
                tradeNameOptions.style.display = 'block';
            } else {
                tradeNameOptions.style.display = 'none';
            }
        }

        // ÊóßÈñ¢Êï∞Âêç„ÅÆ‰∫íÊèõÊÄßÁ∂≠ÊåÅ
        function updateBranchDisplay() {
            updateTradeNameDisplay();
        }

        // ‰ºöÁ§æÂêçË°®Á§∫„ÇíÊõ¥Êñ∞
        function updateCompanyNameDisplay() {
            // ‰∏°ÊñπË°®Á§∫„Ç™„Éó„Ç∑„Éß„É≥„ÅÆË°®Á§∫/ÈùûË°®Á§∫
            const displayOption = document.querySelector('input[name="tradeNameDisplay"]:checked')?.value;
            const bothOptions = document.getElementById('bothDisplayOptions');

            if (displayOption === 'both' && bothOptions) {
                bothOptions.style.display = 'block';
            } else if (bothOptions) {
                bothOptions.style.display = 'none';
            }
        }

        // Ëá™Âãï‰øùÂ≠ò
        async function autoSave() {
            // ‰øùÂ≠ò„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº„ÇíË°®Á§∫
            const saveIndicator = document.querySelector('#companySection .text-green-500');
            if (saveIndicator) {
                saveIndicator.parentElement.parentElement.style.opacity = '0.5';
            }

            // ÁîªÂÉè„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂá¶ÁêÜÔºà„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´Ôºâ
            if (mainVisualData && mainVisualFileName) {
                try {
                    console.log('[autoSave] Uploading main visual...');
                    const response = await fetch(GAS_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/plain' },
                        body: JSON.stringify({
                            action: 'companyinfo_uploadImage',
                            merchantId: window.merchantId,
                            base64Data: mainVisualData,
                            fileName: mainVisualFileName,
                            imageType: 'main-visual'
                        })
                    });
                    const result = await response.json();
                    console.log('[autoSave] Main visual response:', result);
                    if (result.success) {
                        mainVisualUrl = result.url;
                        console.log('[autoSave] Main visual uploaded:', result.url);
                    } else {
                        console.error('[autoSave] Main visual upload failed:', result.error);
                    }
                } catch (error) {
                    console.error('[autoSave] Main visual upload error:', error);
                }
            }

            // ÁîªÂÉè„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂá¶ÁêÜÔºàÂÜôÁúü„ÇÆ„É£„É©„É™„ÉºÔºâ
            // GAS„ÅÆaddGalleryPhoto„Åå„Ç´„É≥„ÉûÂå∫Âàá„ÇäÊñáÂ≠óÂàó„Åß‰øùÂ≠ò„Åô„Çã„ÅÆ„Åß„ÄÅ„Éï„É≠„É≥„Éà„Åß„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            if (galleryFilesToUpload.length > 0) {
                try {
                    console.log('[autoSave] üì§ ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÈñãÂßã:', galleryFilesToUpload.length, 'Êûö');

                    for (const file of galleryFilesToUpload) {
                        console.log('[autoSave] „Ç¢„ÉÉ„Éó„É≠„Éº„Éâ‰∏≠:', file.fileName);

                        const response = await fetch(GAS_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'text/plain' },
                            body: JSON.stringify({
                                action: 'companyinfo_uploadImage',
                                merchantId: window.merchantId,
                                base64Data: file.base64Data,
                                fileName: file.fileName,
                                imageType: 'gallery'
                            })
                        });

                        const result = await response.json();
                        console.log('[autoSave] „Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÁµêÊûú:', result);

                        if (result.success) {
                            console.log('[autoSave] ‚úì „Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊàêÂäü:', result.url);

                            // URL„ÇíthumbnailÂΩ¢Âºè„Å´Â§âÊèõÔºà„Éó„É¨„Éì„É•„ÉºË°®Á§∫Áî®Ôºâ
                            let displayUrl = result.url;
                            const idMatch = result.url.match(/[?&]id=([^&]+)/);
                            if (idMatch) {
                                displayUrl = `https://drive.google.com/thumbnail?id=${idMatch[1]}&sz=w800`;
                            }

                            // ‰ºöÁ§æÊÉÖÂ†±„Çø„Éñ„ÅÆ„Éó„É¨„Éì„É•„Éº„ÇíÊõ¥Êñ∞Ôºà„É≠„Éº„Ç´„É´URL„Åã„ÇâDrive URL„Å´ÁΩÆ„ÅçÊèõ„ÅàÔºâ
                            const imageElement = document.getElementById(file.id);
                            if (imageElement) {
                                const img = imageElement.querySelector('img');
                                if (img) {
                                    img.src = displayUrl;
                                    console.log('[autoSave] ‰ºöÁ§æÊÉÖÂ†±„Çø„ÉñÁîªÂÉèÊõ¥Êñ∞:', file.id, '->', displayUrl);
                                }
                            }

                            // galleryImagesÈÖçÂàó„Å´ËøΩÂä†ÔºàthumbnailÂΩ¢Âºè„ÅßÔºâ
                            galleryImages.push({
                                id: file.id,
                                src: displayUrl,
                                name: file.fileName
                            });
                            console.log('[autoSave] galleryImagesÈÖçÂàó„Å´ËøΩÂä†:', galleryImages.length, '‰ª∂', displayUrl);

                            // „Éó„É¨„Éì„É•„ÉºÁîªÈù¢„ÇíÊõ¥Êñ∞
                            updateGalleryPreview();
                        } else {
                            console.error('[autoSave] ‚úó „Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂ§±Êïó:', result.error);
                        }
                    }

                    // „Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂÆå‰∫ÜÂæå„ÄÅÈÖçÂàó„Çí„ÇØ„É™„Ç¢
                    galleryFilesToUpload = [];
                    console.log('[autoSave] üì§ ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂÆå‰∫Ü');

                } catch (error) {
                    console.error('[autoSave] Gallery upload error:', error);
                    console.error('[autoSave] „Ç®„É©„ÉºË©≥Á¥∞:', error.stack);
                }
            }

            // ÊñΩÂ∑•‰∫ã‰æã„ÅÆ‰øùÂ≠òÂá¶ÁêÜÔºàÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØÂº∑ÂåñÁâàÔºâ
            if (constructionExamples && constructionExamples.length > 0) {
                try {
                    console.log('[autoSave] ÊñΩÂ∑•‰∫ã‰æã„Çí‰øùÂ≠òÈñãÂßã:', constructionExamples.length, '‰ª∂');
                    console.log('[autoSave] ÊñΩÂ∑•‰∫ã‰æã„ÅÆÂÜÖÂÆπ:', JSON.stringify(constructionExamples, null, 2));

                    // ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØÁî®Ôºö‰øùÂ≠òÊ∏à„ÅøÁîªÂÉèURL„Éö„Ç¢„ÇíË®òÈå≤ÔºàÊ≠£Ë¶èÂåñÊ∏à„ÅøÔºâ
                    const savedExampleUrls = new Set();

                    for (const example of constructionExamples) {
                        // „Çø„Ç§„Éà„É´„Åæ„Åü„ÅØÂÜÖÂÆπ„Åå„ÅÇ„Çå„Å∞‰øùÂ≠òÔºàÁîªÂÉè„ÅØ‰ªªÊÑèÔºâ
                        if (example.title || example.content || example.beforeImage || example.afterImage) {
                            // ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØÔºöÊ≠£Ë¶èÂåñ„Åó„ÅüID„Éö„Ç¢„ÅßÂà§ÂÆö
                            const beforeId = normalizeGoogleDriveUrl(example.beforeImage || 'NONE');
                            const afterId = normalizeGoogleDriveUrl(example.afterImage || 'NONE');
                            const urlPair = `${beforeId}|${afterId}`;

                            if (savedExampleUrls.has(urlPair)) {
                                console.log('[autoSave] üî• ÈáçË§á„Çπ„Ç≠„ÉÉ„ÉóÔºàÂêå„ÅòID„Éö„Ç¢Ôºâ:', example.title, 'ID pair:', urlPair);
                                continue;
                            }
                            savedExampleUrls.add(urlPair);
                            console.log('[autoSave] ‰øùÂ≠ò„Åô„Çã‰∫ã‰æã:', {
                                id: example.id,
                                title: example.title,
                                ageRange: example.ageRange,
                                price: example.price,
                                content: example.content,
                                hasBeforeImage: !!example.beforeImage,
                                hasAfterImage: !!example.afterImage
                            });

                            const payload = {
                                action: 'companyinfo_saveConstructionExample',
                                merchantId: window.merchantId,
                                exampleData: {
                                    id: example.id,  // ID„ÇíÂøÖ„ÅöÈÄÅ‰ø°ÔºàÈáçË§áÂà§ÂÆö„Å´ÂøÖË¶ÅÔºâ
                                    title: example.title || '',
                                    age: example.ageRange || '',  // „Éï„Ç£„Éº„É´„ÉâÂêç„ÇíÁµ±‰∏Ä
                                    cost: example.price || '',     // „Éï„Ç£„Éº„É´„ÉâÂêç„ÇíÁµ±‰∏Ä
                                    description: example.content || '',  // „Éï„Ç£„Éº„É´„ÉâÂêç„ÇíÁµ±‰∏Ä
                                    beforeImage: example.beforeImage || '',
                                    afterImage: example.afterImage || ''
                                }
                            };

                            console.log('[autoSave] GAS„Å´ÈÄÅ‰ø°„Åô„Çã„Éö„Ç§„É≠„Éº„Éâ:', JSON.stringify(payload, null, 2));

                            const response = await fetch(GAS_URL, {
                                method: 'POST',
                                headers: { 'Content-Type': 'text/plain' },
                                body: JSON.stringify(payload)
                            });

                            const result = await response.json();
                            console.log('[autoSave] GAS„Åã„Çâ„ÅÆ„É¨„Çπ„Éù„É≥„Çπ:', result);

                            if (result.success) {
                                console.log('[autoSave] ‚úì ÊñΩÂ∑•‰∫ã‰æã‰øùÂ≠òÊàêÂäü:', result.exampleId);
                            } else {
                                console.error('[autoSave] ‚úó ÊñΩÂ∑•‰∫ã‰æã‰øùÂ≠òÂ§±Êïó:', result.error);
                            }
                        } else {
                            console.log('[autoSave] „Çπ„Ç≠„ÉÉ„ÉóÔºàÂÜÖÂÆπ„Å™„ÅóÔºâ:', example.id);
                        }
                    }
                    console.log('[autoSave] ÊñΩÂ∑•‰∫ã‰æã‰øùÂ≠òÂÆå‰∫Ü');
                } catch (error) {
                    console.error('[autoSave] ÊñΩÂ∑•‰∫ã‰æã‰øùÂ≠ò„Ç®„É©„Éº:', error);
                    console.error('[autoSave] „Ç®„É©„ÉºË©≥Á¥∞:', error.stack);
                }
            } else {
                console.log('[autoSave] ÊñΩÂ∑•‰∫ã‰æã„Å™„ÅóÔºà‰øùÂ≠ò„Çπ„Ç≠„ÉÉ„ÉóÔºâ');
            }

            // „Éï„Ç©„Éº„É†„Åã„Çâ„Éá„Éº„Çø„ÇíÂèéÈõÜ
            // ‚Äª„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆÂàó„Å®„ÅÆÂØæÂøú:
            // CÂàó: ‰ºöÁ§æÂêç, DÂàó: ‰ºöÁ§æÂêç„Ç´„Éä, EÂàó: Â±ãÂè∑, FÂàó: Â±ãÂè∑„Ç´„Éä
            // GÂàó: ‰ª£Ë°®ËÄÖÂêç, HÂàó: ‰ª£Ë°®ËÄÖÂêç„Ç´„Éä, IÂàó: ÈÉµ‰æøÁï™Âè∑, JÂàó: ‰ΩèÊâÄ
            // KÂàó: ÈõªË©±Áï™Âè∑, LÂàó: „Ç¶„Çß„Éñ„Çµ„Ç§„ÉàURL, MÂàó: Ë®≠Á´ãÂπ¥Êúà, NÂàó: PR„ÉÜ„Ç≠„Çπ„Éà
            // OÂàó: ÊîØÂ∫óÂêç, PÂàó: ÊîØÂ∫ó‰ΩèÊâÄ
            // VÂàó: Ë´ãÊ±ÇÁî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ, WÂàó: Âñ∂Ê•≠Áî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ
            // XÂàó: Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç, YÂàó: Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„Ç´„Éä
            // ZÂàó: ÂæìÊ•≠Âì°Êï∞, AAÂàó: Â£≤‰∏äË¶èÊ®°
            // ARÂàó: „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´, ASÂàó: ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº
            // ATÂàó: ‰øùÊúâË≥áÊ†º, AUÂàó: Âä†ÂÖ•‰øùÈô∫

            const formData = {
                // Âü∫Êú¨ÊÉÖÂ†±
                companyName: document.getElementById('companyName')?.value || '', // CÂàó: ‰ºöÁ§æÂêç
                companyNameKana: document.getElementById('companyNameKana')?.value || '', // DÂàó: ‰ºöÁ§æÂêç„Ç´„Éä
                tradeName: document.getElementById('tradeName')?.value || '', // EÂàó: Â±ãÂè∑
                tradeNameKana: document.getElementById('tradeNameKana')?.value || '', // FÂàó: Â±ãÂè∑„Ç´„Éä
                representative: document.getElementById('representative')?.value || '', // GÂàó: ‰ª£Ë°®ËÄÖÂêç
                representativeKana: document.getElementById('representativeKana')?.value || '', // HÂàó: ‰ª£Ë°®ËÄÖÂêç„Ç´„Éä
                postalCode: document.getElementById('zipCode')?.value || '', // IÂàó: ÈÉµ‰æøÁï™Âè∑
                address: document.getElementById('address')?.value || '', // JÂàó: ‰ΩèÊâÄ
                phone: document.getElementById('phone')?.value || '', // KÂàó: ÈõªË©±Áï™Âè∑
                website: document.getElementById('website')?.value || '', // LÂàó: „Ç¶„Çß„Éñ„Çµ„Ç§„ÉàURL
                established: document.getElementById('established')?.value || '', // MÂàó: Ë®≠Á´ãÂπ¥Êúà
                prText: document.getElementById('prText')?.value || '', // NÂàó: PR„ÉÜ„Ç≠„Çπ„Éà

                // OÂàó: ÊîØÂ∫óÂêç, PÂàó: ÊîØÂ∫ó‰ΩèÊâÄ
                branchName: (window.branches || []).map(b => b.name).filter(v => v).join('„ÄÅ') || '',
                branchAddress: (window.branches || []).map(b => b.address).filter(v => v).join('„ÄÅ') || '',

                // VÂàó: Ë´ãÊ±ÇÁî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ, WÂàó: Âñ∂Ê•≠Áî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ
                // XÂàó: Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç, YÂàó: Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„Ç´„Éä
                billingEmail: (() => {
                    const inputs = document.querySelectorAll('#billingEmailContainer input[name="billingEmail"]');
                    const emails = Array.from(inputs)
                        .map(input => input.value.trim())
                        .filter(email => email !== '');
                    return emails.join(', ');
                })(),
                salesEmail: document.getElementById('salesEmail')?.value || '',
                salesPersonName: document.getElementById('salesPersonName')?.value || '',
                salesPersonKana: document.getElementById('salesPersonKana')?.value || '',

                // ZÂàó: ÂæìÊ•≠Âì°Êï∞, AAÂàó: Â£≤‰∏äË¶èÊ®°
                employees: document.getElementById('employees')?.value || '',
                salesScale: document.getElementById('salesScale')?.value || '',

                // ATÂàó: ‰øùÊúâË≥áÊ†º, AUÂàó: Âä†ÂÖ•‰øùÈô∫Ôºà„Ç´„Çπ„Çø„É†È†ÖÁõÆ„ÇÇÂê´„ÇÅ„ÇãÔºâ
                qualifications: (() => {
                    const checked = Array.from(document.querySelectorAll('input[name="qualifications"]:checked')).map(cb => cb.value);
                    const custom = Array.from(document.querySelectorAll('#customQualificationsList > div > span')).map(el => el.textContent.trim());
                    return [...checked, ...custom].filter(v => v).join(',') || '';
                })(),
                insurance: (() => {
                    const checked = Array.from(document.querySelectorAll('input[name="insurance"]:checked')).map(cb => cb.value);
                    const custom = Array.from(document.querySelectorAll('#customInsuranceList > div > span')).map(el => el.textContent.trim());
                    return [...checked, ...custom].filter(v => v).join(',') || '';
                })()
            };

            // ÁîªÂÉèURL„ÇíËøΩÂä†Ôºà„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊ∏à„Åø„ÅÆÂ†¥ÂêàÔºâ
            if (mainVisualUrl) {
                formData['„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´'] = mainVisualUrl; // ARÂàó: „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´
                console.log('[autoSave] Added main visual to formData:', mainVisualUrl);
            }

            // „Éó„É¨„Éì„É•„ÉºË®≠ÂÆö„Çí„Éó„É¨„Éì„É•„Éº„Ç∑„Éº„Éà„Å´‰øùÂ≠ò
            try {
                const previewData = {
                    imagePositionX: imagePositionX,
                    imagePositionY: imagePositionY,
                    imageZoom: currentZoom,
                    imageBrightness: document.getElementById('imageOpacity')?.value || 100,
                    textColor: currentTextColor
                };

                const previewResponse = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'savePreviewSettings',
                        merchantId: window.merchantId,
                        previewSettings: previewData
                    })
                });
                const previewResult = await previewResponse.json();
                console.log('[autoSave] Preview settings saved:', previewResult);
            } catch (error) {
                console.error('[autoSave] Preview settings save error:', error);
            }

            // ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„ÅÆ‰øùÂ≠ò„ÅØ‰∏çË¶Å
            // GAS„ÅÆaddGalleryPhoto„Åå„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊôÇ„Å´Êó¢„Å´„Ç´„É≥„ÉûÂå∫Âàá„ÇäÊñáÂ≠óÂàó„Åß‰øùÂ≠òÊ∏à„Åø
            console.log('[autoSave] ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„ÅØ„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊôÇ„Å´‰øùÂ≠òÊ∏à„ÅøÔºà‰øùÂ≠òÂá¶ÁêÜ„Çπ„Ç≠„ÉÉ„ÉóÔºâ');

            try {
                console.log('[‰øùÂ≠ò] ÈÄÅ‰ø°„Éá„Éº„Çø:', formData);
                console.log('[‰øùÂ≠ò] merchantId:', window.merchantId);

                // GAS„Å´‰øùÂ≠ò„É™„ÇØ„Ç®„Çπ„Éà„ÇíÈÄÅ‰ø°
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: JSON.stringify({
                        action: 'updateMerchantData',
                        merchantId: window.merchantId,
                        data: formData
                    })
                });

                const result = await response.json();
                console.log('[‰øùÂ≠ò] GAS„É¨„Çπ„Éù„É≥„Çπ:', result);

                if (result.success) {
                    console.log('‚úÖ ‰øùÂ≠òÂÆå‰∫Ü');
                    console.log('‰øùÂ≠ò„Åó„ÅüÈ†ÖÁõÆÊï∞:', Object.keys(formData).length);

                    // ‰øùÂ≠ò„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº„ÇíÂÖÉ„Å´Êàª„Åô
                    if (saveIndicator) {
                        setTimeout(() => {
                            saveIndicator.parentElement.parentElement.style.opacity = '1';
                        }, 500);
                    }
                } else {
                    console.error('‚ùå ‰øùÂ≠ò„Ç®„É©„Éº:', result.error);
                    showNotification('„Ç®„É©„Éº', '‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                }
            } catch (error) {
                console.error('‚ùå ÈÄö‰ø°„Ç®„É©„Éº:', error);
                // „Ç®„É©„ÉºÊôÇ„ÇÇË¶ã„ÅüÁõÆ„ÇíÂÖÉ„Å´Êàª„Åô
                if (saveIndicator) {
                    saveIndicator.parentElement.parentElement.style.opacity = '1';
                }
            }
        }

        // ========================================
        // Á∑®ÈõÜ„É¢„Éº„ÉâÁÆ°ÁêÜÔºà„Çª„ÇØ„Ç∑„Éß„É≥„Åî„Å®Ôºâ
        // ========================================

        // ÂêÑ„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂÖÉ„Éá„Éº„Çø‰øùÂ≠òÁî®
        const sectionBackupData = {};

        /**
         * Á∑®ÈõÜ„É¢„Éº„Éâ„ÅÆÂàá„ÇäÊõø„Åà
         * @param {string} sectionName - „Çª„ÇØ„Ç∑„Éß„É≥ÂêçÔºàbasicInfo, mainVisualÁ≠âÔºâ
         * @param {boolean} isEditMode - true: Á∑®ÈõÜ„É¢„Éº„Éâ, false: Èñ≤Ë¶ß„É¢„Éº„Éâ
         */
        function toggleEditMode(sectionName, isEditMode) {
            console.log(`[toggleEditMode] „Çª„ÇØ„Ç∑„Éß„É≥: ${sectionName}, Á∑®ÈõÜ„É¢„Éº„Éâ: ${isEditMode}`);

            // „Éú„Çø„É≥„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
            const sectionNameCapitalized = sectionName.charAt(0).toUpperCase() + sectionName.slice(1);
            const editBtn = document.getElementById(`edit${sectionNameCapitalized}Btn`);
            const saveBtn = document.getElementById(`save${sectionNameCapitalized}Btn`);
            const cancelBtn = document.getElementById(`cancel${sectionNameCapitalized}Btn`);

            // „Çª„ÇØ„Ç∑„Éß„É≥Êú¨‰Ωì„ÅÆË¶ÅÁ¥†
            const sectionElement = document.getElementById(`${sectionName}Section`);
            const viewElement = document.getElementById(`${sectionName}View`);
            const editElement = document.getElementById(`${sectionName}Edit`);

            if (isEditMode) {
                // Á∑®ÈõÜ„É¢„Éº„Éâ„Å´Âàá„ÇäÊõø„Åà
                editBtn.classList.add('hidden');
                saveBtn.classList.remove('hidden');
                cancelBtn.classList.remove('hidden');

                // „Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÊû†„ÇíÈùíËâ≤„Å´Â§âÊõ¥ÔºàÁ∑®ÈõÜ‰∏≠„ÇíË¶ñË¶öÁöÑ„Å´Ë°®ÁèæÔºâ
                if (sectionElement) {
                    sectionElement.classList.remove('border-gray-300');
                    sectionElement.classList.add('border-blue-500', 'shadow-lg');
                }

                // Èñ≤Ë¶ß„É¢„Éº„Éâ„ÇíÈùûË°®Á§∫„ÄÅÁ∑®ÈõÜ„É¢„Éº„Éâ„ÇíË°®Á§∫
                if (viewElement) viewElement.classList.add('hidden');
                if (editElement) editElement.classList.remove('hidden');

                // ÁèæÂú®„ÅÆ„Éá„Éº„Çø„Çí„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó
                backupSectionData(sectionName);

            } else {
                // Èñ≤Ë¶ß„É¢„Éº„Éâ„Å´Âàá„ÇäÊõø„Åà
                editBtn.classList.remove('hidden');
                saveBtn.classList.add('hidden');
                cancelBtn.classList.add('hidden');

                // „Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÊû†„Çí„Ç∞„É¨„Éº„Å´Êàª„Åô
                if (sectionElement) {
                    sectionElement.classList.add('border-gray-300');
                    sectionElement.classList.remove('border-blue-500', 'shadow-lg');
                }

                // Á∑®ÈõÜ„É¢„Éº„Éâ„ÇíÈùûË°®Á§∫„ÄÅÈñ≤Ë¶ß„É¢„Éº„Éâ„ÇíË°®Á§∫
                if (viewElement) viewElement.classList.remove('hidden');
                if (editElement) editElement.classList.add('hidden');

                // Èñ≤Ë¶ß„É¢„Éº„Éâ„ÅÆ„Éá„Éº„Çø„ÇíÊõ¥Êñ∞
                updateViewData(sectionName);
            }
        }

        /**
         * Èñ≤Ë¶ß„É¢„Éº„Éâ„ÅÆË°®Á§∫„Éá„Éº„Çø„ÇíÊõ¥Êñ∞
         */
        function updateViewData(sectionName) {
            console.log('[updateViewData] Updating section:', sectionName);

            if (sectionName === 'basicInfo') {
                // Âü∫Êú¨ÊÉÖÂ†±„ÅÆÈñ≤Ë¶ß„É¢„Éº„ÉâÊõ¥Êñ∞Ôºà„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Éá„Éº„Çø„Åã„ÇâÂãïÁöÑ„Å´Ôºâ
                const data = window.merchantData || {};
                console.log('[updateViewData] basicInfo - updating from merchant data');

                document.getElementById('companyNameView').textContent = data['‰ºöÁ§æÂêç'] || '-';
                document.getElementById('companyNameKanaView').textContent = data['‰ºöÁ§æÂêç„Ç´„Éä'] || '-';
                document.getElementById('tradeNameView').textContent = data['Â±ãÂè∑'] || '-';
                document.getElementById('tradeNameKanaView').textContent = data['Â±ãÂè∑„Ç´„Éä'] || '-';
                document.getElementById('representativeView').textContent = data['‰ª£Ë°®ËÄÖÂêç'] || '-';
                document.getElementById('representativeKanaView').textContent = data['‰ª£Ë°®ËÄÖÂêç„Ç´„Éä'] || '-';
                document.getElementById('zipCodeView').textContent = data['ÈÉµ‰æøÁï™Âè∑'] || '-';
                document.getElementById('addressView').textContent = data['‰ΩèÊâÄ'] || '-';
                document.getElementById('phoneView').textContent = data['ÈõªË©±Áï™Âè∑'] || '-';
                document.getElementById('websiteView').textContent = data['„Ç¶„Çß„Éñ„Çµ„Ç§„ÉàURL'] || '-';
                document.getElementById('establishedView').textContent = formatEstablishedDate(data['Ë®≠Á´ãÂπ¥Êúà'] || '-');
                document.getElementById('prTextView').textContent = data['PR„ÉÜ„Ç≠„Çπ„Éà'] || '-';
            } else if (sectionName === 'branchInfo') {
                // ÊîØÂ∫óÊÉÖÂ†±„ÅÆÈñ≤Ë¶ß„É¢„Éº„Éâ„ÇíÊõ¥Êñ∞
                const branchListView = document.getElementById('branchListView');
                if (!branchListView) return;

                if (window.branches && window.branches.length > 0) {
                    branchListView.innerHTML = window.branches.map(branch => `
                        <div class="border-l-4 border-blue-500 pl-4 py-2">
                            <div class="font-medium text-gray-900">${branch.name || '-'}</div>
                            <div class="text-sm text-gray-600">${branch.address || '-'}</div>
                        </div>
                    `).join('');
                } else {
                    branchListView.innerHTML = '<div class="text-sm text-gray-500">ÊîØÂ∫óÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                }
            } else if (sectionName === 'contactBusiness') {
                // ÈÄ£Áµ°ÂÖàÊÉÖÂ†±ÔºÜ‰∫ãÊ•≠Ë©≥Á¥∞„ÅÆÈñ≤Ë¶ß„É¢„Éº„ÉâÊõ¥Êñ∞Ôºà„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Éá„Éº„Çø„Åã„ÇâÂãïÁöÑ„Å´Ôºâ
                const data = window.merchantData || {};
                console.log('[updateViewData] contactBusiness - updating from merchant data');

                document.getElementById('billingEmailView').textContent = data['Ë´ãÊ±ÇÁî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ'] || '-';
                document.getElementById('salesEmailView').textContent = data['Âñ∂Ê•≠Áî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ'] || '-';
                document.getElementById('salesPersonNameView').textContent = data['Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç'] || '-';
                document.getElementById('salesPersonKanaView').textContent = data['Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„Ç´„Éä'] || '-';
                // ÂæìÊ•≠Âì°Êï∞„ÅÆÊó•Êú¨Ë™ûË°®Ë®òÂ§âÊèõ
                const employeesMapping = {
                    '1-2': '1„Äú2Âêç',
                    '3-5': '3„Äú5Âêç',
                    '6-10': '6„Äú10Âêç',
                    '11+': '11Âêç‰ª•‰∏ä'
                };
                const employeesDisplay = employeesMapping[data['ÂæìÊ•≠Âì°Êï∞']] || data['ÂæìÊ•≠Âì°Êï∞'] || '-';
                document.getElementById('employeesView').textContent = employeesDisplay;

                // Â£≤‰∏äË¶èÊ®°„ÅÆÊó•Êú¨Ë™ûË°®Ë®òÂ§âÊèõ
                const salesScaleMapping = {
                    'under-10m': '1,000‰∏áÂÜÜÊú™Ê∫Ä',
                    '10m-30m': '1,000‰∏áÂÜÜ„Äú3,000‰∏áÂÜÜ',
                    '30m-50m': '3,000‰∏áÂÜÜ„Äú5,000‰∏áÂÜÜ',
                    '50m-100m': '5,000‰∏áÂÜÜ„Äú1ÂÑÑÂÜÜ',
                    '100m-300m': '1ÂÑÑÂÜÜ„Äú3ÂÑÑÂÜÜ',
                    'over-300m': '3ÂÑÑÂÜÜ‰ª•‰∏ä'
                };
                const salesScaleDisplay = salesScaleMapping[data['Â£≤‰∏äË¶èÊ®°']] || data['Â£≤‰∏äË¶èÊ®°'] || '-';
                document.getElementById('salesScaleView').textContent = salesScaleDisplay;
            } else if (sectionName === 'qualifications') {
                // ‰øùÊúâË≥áÊ†º„ÅÆÈñ≤Ë¶ß„É¢„Éº„ÉâÊõ¥Êñ∞Ôºà„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Éá„Éº„Çø„Åã„ÇâÂãïÁöÑ„Å´Ôºâ
                const qualificationsViewList = document.getElementById('qualificationsViewList');
                if (!qualificationsViewList) return;

                const data = window.merchantData || {};
                const qualificationsString = data['‰øùÊúâË≥áÊ†º'] || '';
                const allQuals = qualificationsString ? qualificationsString.split(',').map(q => q.trim()).filter(q => q) : [];

                console.log('[updateViewData] qualifications - from spreadsheet:', allQuals);

                if (allQuals.length > 0) {
                    qualificationsViewList.innerHTML = allQuals.map(qual => `
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-100 text-purple-800">
                            üéñÔ∏è ${qual}
                        </span>
                    `).join('');
                } else {
                    qualificationsViewList.innerHTML = '<span class="text-sm text-gray-500">‰øùÊúâË≥áÊ†º„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</span>';
                }
            } else if (sectionName === 'insurance') {
                // Âä†ÂÖ•‰øùÈô∫„ÅÆÈñ≤Ë¶ß„É¢„Éº„ÉâÊõ¥Êñ∞Ôºà„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Éá„Éº„Çø„Åã„ÇâÂãïÁöÑ„Å´Ôºâ
                const insuranceViewList = document.getElementById('insuranceViewList');
                if (!insuranceViewList) return;

                const data = window.merchantData || {};
                const insuranceString = data['Âä†ÂÖ•‰øùÈô∫'] || '';
                const allIns = insuranceString ? insuranceString.split(',').map(i => i.trim()).filter(i => i) : [];

                console.log('[updateViewData] insurance - from spreadsheet:', allIns);

                if (allIns.length > 0) {
                    insuranceViewList.innerHTML = allIns.map(ins => `
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                            üõ°Ô∏è ${ins}
                        </span>
                    `).join('');
                } else {
                    insuranceViewList.innerHTML = '<span class="text-sm text-gray-500">Âä†ÂÖ•‰øùÈô∫„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</span>';
                }
            } else if (sectionName === 'mainVisual') {
                // „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„ÅÆÈñ≤Ë¶ß„É¢„Éº„Éâ„ÇíÊõ¥Êñ∞ÔºàÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„Å®Âêå„Åò„Ç∑„É≥„Éó„É´„Éë„Çø„Éº„É≥Ôºâ
                const mainVisualImageView = document.getElementById('mainVisualImageView');
                const mainVisualPlaceholderView = document.getElementById('mainVisualPlaceholderView');

                console.log('[updateViewData] mainVisual - window.mainVisualUrl:', window.mainVisualUrl);
                console.log('[updateViewData] mainVisual - window.mainVisualDisplayUrl:', window.mainVisualDisplayUrl);

                // loadMerchantData„ÅßË®≠ÂÆö„Åï„Çå„ÇãË°®Á§∫Áî®URL„Çí‰ΩøÁî®
                const displayUrl = window.mainVisualDisplayUrl || window.mainVisualUrl;

                if (displayUrl && displayUrl.trim() !== '') {
                    console.log('[updateViewData] mainVisual - using display URL:', displayUrl);
                    mainVisualImageView.src = displayUrl;
                    mainVisualImageView.classList.remove('hidden');
                    mainVisualPlaceholderView.classList.add('hidden');
                } else {
                    console.log('[updateViewData] mainVisual - no URL found, showing placeholder');
                    mainVisualImageView.src = '';
                    mainVisualImageView.classList.add('hidden');
                    mainVisualPlaceholderView.classList.remove('hidden');
                }
            } else if (sectionName === 'constructionExamples') {
                // ÊñΩÂ∑•‰∫ã‰æã„ÅÆÈñ≤Ë¶ß„É¢„Éº„Éâ„ÇíÊõ¥Êñ∞
                const constructionExamplesListView = document.getElementById('constructionExamplesListView');
                if (!constructionExamplesListView) {
                    console.error('[updateViewData] constructionExamplesListViewË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                    return;
                }

                console.log('[updateViewData] constructionExamples „Éá„Éº„Çø:', window.constructionExamples);
                console.log('[updateViewData] window.constructionExamples check:', !!window.constructionExamples, 'length:', window.constructionExamples?.length);

                if (window.constructionExamples && window.constructionExamples.length > 0) {
                    constructionExamplesListView.innerHTML = window.constructionExamples.map(example => {
                        // beforeImage/afterImage „Åæ„Åü„ÅØ beforeUrl/afterUrl „ÅÆ„Å©„Å°„Çâ„ÇÇÂØæÂøú
                        const beforeImg = example.beforeImage || example.beforeUrl || '';
                        const afterImg = example.afterImage || example.afterUrl || '';
                        const content = example.description || example.content || '';

                        return `
                            <div class="border rounded-lg p-4 bg-gray-50">
                                <div class="grid grid-cols-2 gap-2 mb-2">
                                    <img src="${beforeImg}" alt="ÊñΩÂ∑•Ââç" class="w-full h-32 object-cover rounded">
                                    <img src="${afterImg}" alt="ÊñΩÂ∑•Âæå" class="w-full h-32 object-cover rounded">
                                </div>
                                <div class="text-sm font-medium text-gray-900">${example.title || 'ÊñΩÂ∑•‰∫ã‰æã'}</div>
                                <div class="text-xs text-gray-600 mt-1">${content}</div>
                            </div>
                        `;
                    }).join('');
                    console.log('[updateViewData] constructionExamplesË°®Á§∫„ÇíÊõ¥Êñ∞:', window.constructionExamples.length, '‰ª∂');
                } else {
                    constructionExamplesListView.innerHTML = '<div class="text-sm text-gray-500">ÊñΩÂ∑•‰∫ã‰æã„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                    console.log('[updateViewData] constructionExamples„ÅåÁ©∫„Åß„Åô');
                }
            } else if (sectionName === 'photoGallery') {
                // ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„ÅÆÈñ≤Ë¶ß„É¢„Éº„Éâ„ÇíÊõ¥Êñ∞Ôºà„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„Å®Âêå„Åò„Éë„Çø„Éº„É≥Ôºâ
                const photoGalleryListView = document.getElementById('photoGalleryListView');
                const photoGalleryView = document.getElementById('photoGalleryView');

                console.log('[updateViewData] photoGallery - window.galleryImages:', window.galleryImages);
                console.log('[updateViewData] photoGallery - „Éá„Éº„ÇøË©≥Á¥∞:', {
                    exist: !!window.galleryImages,
                    isArray: Array.isArray(window.galleryImages),
                    length: (window.galleryImages || []).length,
                    firstImageSrc: (window.galleryImages && window.galleryImages[0]) ? window.galleryImages[0].src : '„Å™„Åó'
                });

                // „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„ÅÆdisplayUrl„Å®Âêå„ÅòÊ¶ÇÂøµÔºögalleryImages„Çí‰ΩøÁî®
                const galleryData = window.galleryImages;

                if (galleryData && galleryData.length > 0) {
                    console.log('[updateViewData] photoGallery - showing gallery with', galleryData.length, 'images');
                    console.log('[updateViewData] photoGallery - ÂêÑÁîªÂÉèURLÁ¢∫Ë™ç:', galleryData.map((img, i) => ({
                        index: i,
                        src: img.src,
                        name: img.name,
                        srcValid: img.src && img.src.startsWith('http')
                    })));
                    photoGalleryListView.innerHTML = galleryData.map((img, index) => `
                        <div class="relative">
                            <img src="${img.src}" alt="${img.name}" class="w-full h-24 object-cover rounded-lg">
                        </div>
                    `).join('');
                    photoGalleryListView.classList.remove('hidden');
                    photoGalleryView.classList.remove('hidden');
                } else {
                    console.log('[updateViewData] photoGallery - no images found, showing placeholder');
                    photoGalleryListView.innerHTML = '<div class="text-sm text-gray-500">ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                    photoGalleryListView.classList.remove('hidden');
                    photoGalleryView.classList.remove('hidden');
                }
            } else if (sectionName === 'propertyTypes') {
                // ÂØæÂøúÂèØËÉΩÁâ©‰ª∂Á®ÆÂà•„ÅÆÈñ≤Ë¶ß„É¢„Éº„Éâ„ÇíÊõ¥Êñ∞
                const propertyTypesDisplay = document.getElementById('propertyTypesDisplay');
                if (!propertyTypesDisplay) return;

                const checkedPropertyTypes = Array.from(document.querySelectorAll('input[name="propertyType"]:checked')).map(cb => cb.value);
                if (checkedPropertyTypes.length > 0) {
                    // Ëã±Ë™û„ÅÆvalueÂ±ûÊÄß„ÇíÊó•Êú¨Ë™ûË°®Á§∫„Å´Â§âÊèõ
                    const propertyTypeNames = {
                        'house': 'üè† Êà∏Âª∫„Å¶‰ΩèÂÆÖ',
                        'apartment': 'üè¢ „Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥',
                        'commercial': 'üè™ Â∫óËàó„Éª‰∫ãÂãôÊâÄ',
                        'factory': 'üè≠ Â∑•Â†¥„ÉªÂÄâÂ∫´',
                        // Êó•Êú¨Ë™û„ÅÆvalueÂ±ûÊÄß„ÅØ„Åù„ÅÆ„Åæ„ÅæË°®Á§∫
                        'Êà∏Âª∫„Å¶': 'üè† Êà∏Âª∫„Å¶',
                        '„Ç¢„Éë„Éº„Éà': 'üè¢ „Ç¢„Éë„Éº„Éà',
                        '„Éû„É≥„Ç∑„Éß„É≥': 'üè¢ „Éû„É≥„Ç∑„Éß„É≥',
                        'Â∫óËàó': 'üè™ Â∫óËàó',
                        '‰∫ãÂãôÊâÄ': 'üè¢ ‰∫ãÂãôÊâÄ',
                        'Â∑•Â†¥': 'üè≠ Â∑•Â†¥',
                        'ÂÄâÂ∫´': 'üè≠ ÂÄâÂ∫´',
                        '„Åù„ÅÆ‰ªñ': 'üèóÔ∏è „Åù„ÅÆ‰ªñ'
                    };

                    propertyTypesDisplay.innerHTML = checkedPropertyTypes.map(type => {
                        const displayName = propertyTypeNames[type] || `üè† ${type}`;
                        return `
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 mr-2 mb-2">
                                ${displayName}
                            </span>
                        `;
                    }).join('');
                } else {
                    propertyTypesDisplay.innerHTML = '<span class="text-sm text-gray-500">Ë®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</span>';
                }
            } else if (sectionName === 'constructionAreas') {
                // ÊñΩÂ∑•ÁÆáÊâÄ„ÅÆÈñ≤Ë¶ß„É¢„Éº„Éâ„ÇíÊõ¥Êñ∞
                const constructionAreasDisplay = document.getElementById('constructionAreasDisplay');
                if (!constructionAreasDisplay) return;

                const checkedConstructionTypes = Array.from(document.querySelectorAll('input[name="constructionTypes"]:checked')).map(cb => cb.value);
                if (checkedConstructionTypes.length > 0) {
                    constructionAreasDisplay.innerHTML = checkedConstructionTypes.map(type => `
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800 mr-2 mb-2">
                            üî® ${type}
                        </span>
                    `).join('');
                } else {
                    constructionAreasDisplay.innerHTML = '<span class="text-sm text-gray-500">Ë®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</span>';
                }
            } else if (sectionName === 'specialServices') {
                // ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ„ÅÆÈñ≤Ë¶ß„É¢„Éº„Éâ„ÇíÊõ¥Êñ∞
                const specialServicesDisplay = document.getElementById('specialServicesDisplay');
                if (!specialServicesDisplay) return;

                const checkedSpecialServices = Array.from(document.querySelectorAll('input[name="specialServices"]:checked')).map(cb => cb.value);
                if (checkedSpecialServices.length > 0) {
                    specialServicesDisplay.innerHTML = checkedSpecialServices.map(service => `
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-100 text-purple-800 mr-2 mb-2">
                            ‚≠ê ${service}
                        </span>
                    `).join('');
                } else {
                    specialServicesDisplay.innerHTML = '<span class="text-sm text-gray-500">Ë®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</span>';
                }
            } else if (sectionName === 'serviceAreas') {
                // ÂØæÂøú„Ç®„É™„Ç¢ÈÅ∏Êäû„ÅÆÈñ≤Ë¶ß„É¢„Éº„Éâ„ÇíÊõ¥Êñ∞
                const serviceAreasDisplay = document.getElementById('serviceAreasDisplay');
                if (!serviceAreasDisplay) return;

                // „Åì„Åì„Åß„ÅØÁ∞°Âçò„Å™Ë°®Á§∫„Å®„Åó„Å¶„ÄÅÈÅ∏Êäû„Åï„Çå„ÅüÈÉΩÈÅìÂ∫úÁúåÊï∞„Å®Â∏ÇÂå∫Áî∫ÊùëÊï∞„ÇíË°®Á§∫
                const selectedPrefCount = document.getElementById('selectedPrefCount')?.textContent || '0';
                const selectedCityCount = document.getElementById('selectedCityCount')?.textContent || '0';

                serviceAreasDisplay.innerHTML = `
                    <div class="text-sm">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-indigo-100 text-indigo-800 mr-2">
                            üìç ${selectedPrefCount}ÈÉΩÈÅìÂ∫úÁúå
                        </span>
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-indigo-100 text-indigo-800">
                            üèòÔ∏è ${selectedCityCount}Â∏ÇÂå∫Áî∫Êùë
                        </span>
                    </div>
                `;
            } else if (sectionName === 'pause') {
                // ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„ÅÆÈñ≤Ë¶ß„É¢„Éº„Éâ„ÇíÊõ¥Êñ∞
                const pauseStatusDisplay = document.getElementById('pauseStatusDisplay');
                const pauseDateDisplay = document.getElementById('pauseDateDisplay');
                const pauseStartDisplay = document.getElementById('pauseStartDisplay');
                const pauseEndDisplay = document.getElementById('pauseEndDisplay');

                if (!pauseStatusDisplay) return;

                // „Éà„Ç∞„É´„ÅÆÁä∂ÊÖã„ÇíÁ¢∫Ë™ç
                const autoPauseToggle = document.getElementById('autoPauseToggle');
                const pauseStartDate = document.getElementById('pauseStartDate');
                const pauseEndDate = document.getElementById('pauseEndDate');
                const indefinitePause = document.getElementById('indefinitePause');

                const isPaused = autoPauseToggle?.checked || false;

                if (isPaused) {
                    // ‰∏ÄÊôÇÂÅúÊ≠¢‰∏≠„ÅÆË°®Á§∫ÔºàÁµ±‰∏ÄÈñ¢Êï∞‰ΩøÁî®Ôºâ
                    updatePauseStatus('‰∏ÄÊôÇÂÅúÊ≠¢‰∏≠');

                    // Êó•‰ªò„ÅÆË°®Á§∫
                    if (pauseDateDisplay && pauseStartDisplay && pauseEndDisplay) {
                        pauseStartDisplay.textContent = pauseStartDate?.value || '-';
                        pauseEndDisplay.textContent = indefinitePause?.checked ? 'Êú™ÂÆö' : (pauseEndDate?.value || '-');
                        pauseDateDisplay.classList.remove('hidden');
                    }
                } else {
                    // „Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÅÆË°®Á§∫ÔºàÁµ±‰∏ÄÈñ¢Êï∞‰ΩøÁî®Ôºâ
                    updatePauseStatus('„Ç¢„ÇØ„ÉÜ„Ç£„Éñ');

                    // Êó•‰ªòË°®Á§∫„ÇíÈùûË°®Á§∫
                    if (pauseDateDisplay) {
                        pauseDateDisplay.classList.add('hidden');
                    }
                }

                console.log('[updateViewData] Updated pause view:', { isPaused, startDate: pauseStartDate?.value, endDate: pauseEndDate?.value });
            }
        }

        /**
         * „Çª„ÇØ„Ç∑„Éß„É≥„ÅÆ„Éá„Éº„Çø„Çí„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó
         */
        function backupSectionData(sectionName) {
            const fields = document.querySelectorAll(`[data-section="${sectionName}"]`);
            sectionBackupData[sectionName] = {};

            fields.forEach(field => {
                sectionBackupData[sectionName][field.id] = field.value;
            });

            // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆ„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó
            if (['propertyTypes', 'constructionAreas', 'specialServices', 'serviceAreas'].includes(sectionName)) {
                sectionBackupData[sectionName] = {};

                if (sectionName === 'propertyTypes') {
                    // Áâ©‰ª∂Á®ÆÂà•„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„ÇπÁä∂ÊÖã„Çí„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó
                    const checkboxes = document.querySelectorAll('input[name="propertyType"]');
                    const checkedValues = [];
                    checkboxes.forEach(cb => {
                        if (cb.checked) {
                            checkedValues.push(cb.value);
                        }
                    });
                    sectionBackupData[sectionName].checkedPropertyTypes = checkedValues;
                    console.log(`[backupSectionData] ${sectionName} „ÉÅ„Çß„ÉÉ„ÇØÁä∂ÊÖã:`, checkedValues);

                } else if (sectionName === 'constructionAreas') {
                    // ÊñΩÂ∑•ÁÆáÊâÄ„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„ÇπÁä∂ÊÖã„Çí„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó
                    const checkboxes = document.querySelectorAll('input[name="constructionTypes"]');
                    const checkedValues = [];
                    checkboxes.forEach(cb => {
                        if (cb.checked) {
                            checkedValues.push(cb.value);
                        }
                    });
                    sectionBackupData[sectionName].checkedConstructionTypes = checkedValues;
                    console.log(`[backupSectionData] ${sectionName} „ÉÅ„Çß„ÉÉ„ÇØÁä∂ÊÖã:`, checkedValues);

                } else if (sectionName === 'specialServices') {
                    // ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„ÇπÁä∂ÊÖã„Çí„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó
                    const checkboxes = document.querySelectorAll('input[name="specialServices"]');
                    const checkedValues = [];
                    checkboxes.forEach(cb => {
                        if (cb.checked) {
                            checkedValues.push(cb.value);
                        }
                    });
                    sectionBackupData[sectionName].checkedSpecialServices = checkedValues;
                    console.log(`[backupSectionData] ${sectionName} „ÉÅ„Çß„ÉÉ„ÇØÁä∂ÊÖã:`, checkedValues);

                } else if (sectionName === 'serviceAreas') {
                    // ÂØæÂøú„Ç®„É™„Ç¢„ÅÆ„Éá„Éº„Çø„Çí„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó
                    const selectedPrefCount = document.getElementById('selectedPrefCount')?.textContent || '0';
                    const selectedCityCount = document.getElementById('selectedCityCount')?.textContent || '0';
                    sectionBackupData[sectionName].prefectureCount = selectedPrefCount;
                    sectionBackupData[sectionName].cityCount = selectedCityCount;
                    console.log(`[backupSectionData] ${sectionName} „Ç®„É™„Ç¢Áä∂ÊÖã:`, { prefectureCount: selectedPrefCount, cityCount: selectedCityCount });
                }
            }

            // ÁîªÂÉèÁ≥ª„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆ„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó
            if (sectionName === 'mainVisual') {
                sectionBackupData[sectionName].mainVisualUrl = window.mainVisualUrl || '';
            } else if (sectionName === 'photoGallery') {
                sectionBackupData[sectionName].galleryImages = JSON.parse(JSON.stringify(window.galleryImages || []));
            } else if (sectionName === 'constructionExamples') {
                sectionBackupData[sectionName].constructionExamples = JSON.parse(JSON.stringify(window.constructionExamples || []));
            }

            console.log(`[backupSectionData] ${sectionName}„ÅÆ„Éá„Éº„Çø„Çí„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó:`, sectionBackupData[sectionName]);
        }

        /**
         * „Ç≠„É£„É≥„Çª„É´ÊôÇ„ÅÆÂá¶ÁêÜ
         */
        function cancelEditMode(sectionName) {
            // Á¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞
            if (!confirm('‰øùÂ≠ò„Åõ„Åö„Å´Á∑®ÈõÜ„ÇíÁµÇ‰∫Ü„Åó„Åæ„Åô„ÅãÔºü\nÂ§âÊõ¥ÂÜÖÂÆπ„ÅØÁ†¥Ê£Ñ„Åï„Çå„Åæ„Åô„ÄÇ')) {
                return;
            }

            console.log(`[cancelEditMode] ${sectionName}„ÅÆÁ∑®ÈõÜ„Çí„Ç≠„É£„É≥„Çª„É´`);

            // „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ
            if (sectionBackupData[sectionName]) {
                const fields = document.querySelectorAll(`[data-section="${sectionName}"]`);
                fields.forEach(field => {
                    if (sectionBackupData[sectionName][field.id] !== undefined) {
                        field.value = sectionBackupData[sectionName][field.id];
                    }
                });
            }

            // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂæ©ÂÖÉ
            if (['propertyTypes', 'constructionAreas', 'specialServices', 'serviceAreas'].includes(sectionName) && sectionBackupData[sectionName]) {
                if (sectionName === 'propertyTypes') {
                    // Áâ©‰ª∂Á®ÆÂà•„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„ÇπÁä∂ÊÖã„ÇíÂæ©ÂÖÉ
                    const checkboxes = document.querySelectorAll('input[name="propertyType"]');
                    checkboxes.forEach(cb => cb.checked = false); // ÂÖ®„Å¶„É™„Çª„ÉÉ„Éà

                    const checkedValues = sectionBackupData[sectionName].checkedPropertyTypes || [];
                    checkedValues.forEach(value => {
                        const checkbox = document.querySelector(`input[name="propertyType"][value="${value}"]`);
                        if (checkbox) {
                            checkbox.checked = true;
                        }
                    });
                    console.log(`[cancelEditMode] ${sectionName} „ÉÅ„Çß„ÉÉ„ÇØÁä∂ÊÖã„ÇíÂæ©ÂÖÉ:`, checkedValues);

                } else if (sectionName === 'constructionAreas') {
                    // ÊñΩÂ∑•ÁÆáÊâÄ„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„ÇπÁä∂ÊÖã„ÇíÂæ©ÂÖÉ
                    const checkboxes = document.querySelectorAll('input[name="constructionTypes"]');
                    checkboxes.forEach(cb => cb.checked = false); // ÂÖ®„Å¶„É™„Çª„ÉÉ„Éà

                    const checkedValues = sectionBackupData[sectionName].checkedConstructionTypes || [];
                    checkedValues.forEach(value => {
                        const checkbox = document.querySelector(`input[name="constructionTypes"][value="${value}"]`);
                        if (checkbox) {
                            checkbox.checked = true;
                        }
                    });
                    console.log(`[cancelEditMode] ${sectionName} „ÉÅ„Çß„ÉÉ„ÇØÁä∂ÊÖã„ÇíÂæ©ÂÖÉ:`, checkedValues);

                } else if (sectionName === 'specialServices') {
                    // ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„ÇπÁä∂ÊÖã„ÇíÂæ©ÂÖÉ
                    const checkboxes = document.querySelectorAll('input[name="specialServices"]');
                    checkboxes.forEach(cb => cb.checked = false); // ÂÖ®„Å¶„É™„Çª„ÉÉ„Éà

                    const checkedValues = sectionBackupData[sectionName].checkedSpecialServices || [];
                    checkedValues.forEach(value => {
                        const checkbox = document.querySelector(`input[name="specialServices"][value="${value}"]`);
                        if (checkbox) {
                            checkbox.checked = true;
                        }
                    });
                    console.log(`[cancelEditMode] ${sectionName} „ÉÅ„Çß„ÉÉ„ÇØÁä∂ÊÖã„ÇíÂæ©ÂÖÉ:`, checkedValues);

                } else if (sectionName === 'serviceAreas') {
                    // ÂØæÂøú„Ç®„É™„Ç¢„ÅÆ„Éá„Éº„Çø„ÇíÂæ©ÂÖÉÔºàÁèæÂú®„ÅØË°®Á§∫„ÅÆ„ÅøÔºâ
                    console.log(`[cancelEditMode] ${sectionName} „Ç®„É™„Ç¢Áä∂ÊÖã„ÇíÂæ©ÂÖÉ:`, sectionBackupData[sectionName]);
                }
            }

            // ÁîªÂÉèÁ≥ª„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂæ©ÂÖÉ
            if (sectionName === 'mainVisual' && sectionBackupData[sectionName]) {
                // „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Åã„ÇâURL„ÇíÂæ©ÂÖÉ
                window.mainVisualUrl = sectionBackupData[sectionName].mainVisualUrl || '';
                mainVisualData = null;
                mainVisualFileName = null;

                // UI„ÇíÂæ©ÂÖÉ
                const mainVisualImage = document.getElementById('mainVisualImage');
                const mainVisualPreview = document.getElementById('mainVisualPreview');
                const mainVisualPlaceholder = document.getElementById('mainVisualPlaceholder');

                if (window.mainVisualUrl) {
                    // ÁîªÂÉè„Åå„ÅÇ„ÇãÂ†¥Âêà
                    mainVisualImage.src = window.mainVisualUrl;
                    mainVisualPreview.classList.remove('hidden');
                    mainVisualPlaceholder.classList.add('hidden');
                } else {
                    // ÁîªÂÉè„Åå„Å™„ÅÑÂ†¥Âêà
                    mainVisualImage.src = '';
                    mainVisualPreview.classList.add('hidden');
                    mainVisualPlaceholder.classList.remove('hidden');
                }

                console.log('[cancelEditMode] „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„ÇíÂæ©ÂÖÉ:', window.mainVisualUrl);
            } else if (sectionName === 'photoGallery' && sectionBackupData[sectionName]) {
                window.galleryImages = JSON.parse(JSON.stringify(sectionBackupData[sectionName].galleryImages || []));
                galleryImages = [...window.galleryImages];
                galleryFilesToUpload = [];
                console.log('[cancelEditMode] ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„ÇíÂæ©ÂÖÉ:', window.galleryImages.length, '‰ª∂');
            } else if (sectionName === 'constructionExamples' && sectionBackupData[sectionName]) {
                window.constructionExamples = JSON.parse(JSON.stringify(sectionBackupData[sectionName].constructionExamples || []));
                constructionExamples = [...window.constructionExamples];
                console.log('[cancelEditMode] ÊñΩÂ∑•‰∫ã‰æã„ÇíÂæ©ÂÖÉ:', window.constructionExamples.length, '‰ª∂');
            }

            // Èñ≤Ë¶ß„É¢„Éº„Éâ„Å´Êàª„Åô
            toggleEditMode(sectionName, false);
        }

        /**
         * „Çª„ÇØ„Ç∑„Éß„É≥‰øùÂ≠òÂá¶ÁêÜ
         */
        async function saveSection(sectionName) {
            console.log('[saveSection] Called with sectionName:', sectionName);

            // „Çª„ÇØ„Ç∑„Éß„É≥„Åî„Å®„ÅÆ‰øùÂ≠òÂá¶ÁêÜ„ÇíÂëº„Å≥Âá∫„ÅôÔºàÂêÑÈñ¢Êï∞ÂÜÖ„ÅßÈñ≤Ë¶ß„É¢„Éº„Éâ„Å´Êàª„ÅôÂá¶ÁêÜ„ÇÇÂÆüË£ÖÔºâ
            if (sectionName === 'basicInfo') {
                console.log('[saveSection] Calling saveBasicInfo');
                await saveBasicInfo();
            } else if (sectionName === 'branchInfo') {
                console.log('[saveSection] Calling saveBranchInfo');
                await saveBranchInfo();
            } else if (sectionName === 'contactBusiness') {
                console.log('[saveSection] Calling saveContactBusiness');
                await saveContactBusiness();
            } else if (sectionName === 'qualifications') {
                console.log('[saveSection] Calling saveQualifications');
                await saveQualifications();
            } else if (sectionName === 'insurance') {
                console.log('[saveSection] Calling saveInsurance');
                await saveInsurance();
            } else if (sectionName === 'mainVisual') {
                console.log('[saveSection] Calling saveMainVisual');
                await saveMainVisual();
            } else if (sectionName === 'constructionExamples') {
                console.log('[saveSection] Calling saveConstructionExamples');
                await saveConstructionExamples();
            } else if (sectionName === 'photoGallery') {
                console.log('[saveSection] Calling savePhotoGallery');
                await savePhotoGallery();
            } else if (sectionName === 'propertyTypes') {
                console.log('[saveSection] Calling saveAutoDeliverySection for propertyTypes');
                await saveAutoDeliverySection('propertyTypes');
            } else if (sectionName === 'constructionAreas') {
                console.log('[saveSection] Calling saveAutoDeliverySection for constructionAreas');
                await saveAutoDeliverySection('constructionAreas');
            } else if (sectionName === 'specialServices') {
                console.log('[saveSection] Calling saveAutoDeliverySection for specialServices');
                await saveAutoDeliverySection('specialServices');
            } else if (sectionName === 'serviceAreas') {
                console.log('[saveSection] Calling saveAutoDeliverySection for serviceAreas');
                await saveAutoDeliverySection('serviceAreas');
            } else if (sectionName === 'pause') {
                console.log('[saveSection] Calling savePauseSettings for pause');
                await savePauseSettings();
                // Èñ≤Ë¶ß„É¢„Éº„Éâ„Å´Êàª„Åô
                toggleEditMode('pause', false);
            } else {
                console.error('[saveSection] Unknown sectionName:', sectionName);
            }
        }

        /**
         * Âü∫Êú¨ÊÉÖÂ†±„ÅÆ‰øùÂ≠ò
         */
        async function saveBasicInfo() {
            console.log('[saveBasicInfo] Âü∫Êú¨ÊÉÖÂ†±‰øùÂ≠òÈñãÂßã');

            if (!window.merchantId) {
                showToast('„Ç®„É©„Éº: merchantId„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                return;
            }

            // ‰øùÂ≠ò„Éú„Çø„É≥„Å®„Éó„É¨„Éì„É•„Éº„Éú„Çø„É≥„Çí‰øùÂ≠ò‰∏≠Ë°®Á§∫„Å´Â§âÊõ¥
            const saveBtn = document.getElementById('saveBasicInfoBtn');
            const previewBtn = document.querySelector('[onclick="showPreview()"]');

            if (!saveBtn) {
                console.error('[saveBasicInfo] ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                showToast('„Ç®„É©„Éº: ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                return;
            }

            const originalSaveText = saveBtn.innerHTML;
            const originalPreviewText = previewBtn ? previewBtn.innerHTML : '';

            saveBtn.innerHTML = 'üíæ ‰øùÂ≠ò‰∏≠...';
            saveBtn.disabled = true;
            if (previewBtn) {
                previewBtn.innerHTML = '‚è≥ ‰øùÂ≠ò‰∏≠...';
                previewBtn.disabled = true;
            }

            // Âü∫Êú¨ÊÉÖÂ†±„ÅÆ„Éá„Éº„ÇøÂèéÈõÜÔºàAYÂàó„ÉªAZÂàó„ÅÆÈùûË°®Á§∫Ë®≠ÂÆö„ÇÇÂê´„ÇÄÔºâ
            const basicInfoData = {
                companyName: document.getElementById('companyName').value,
                companyNameKana: document.getElementById('companyNameKana').value,
                tradeName: document.getElementById('tradeName').value,
                tradeNameKana: document.getElementById('tradeNameKana').value,
                representative: document.getElementById('representative').value,
                representativeKana: document.getElementById('representativeKana').value,
                zipCode: document.getElementById('zipCode').value,
                address: document.getElementById('address').value,
                phone: document.getElementById('phone').value,
                website: document.getElementById('website').value,
                established: document.getElementById('established').value,
                prText: document.getElementById('prText').value,
                // üöÄ AYÂàó„ÉªAZÂàó„ÅÆÈùûË°®Á§∫Ë®≠ÂÆö
                representativeHide: document.getElementById('hideRepresentativeName').checked ? 'TRUE' : 'FALSE', // AYÂàó
                addressHide: document.getElementById('hideAddress').checked ? 'TRUE' : 'FALSE' // AZÂàó
            };

            console.log('[saveBasicInfo] ÈÄÅ‰ø°„Éá„Éº„Çø:', basicInfoData);
            console.log('[saveBasicInfo] üîç „Éó„É©„Ç§„Éê„Ç∑„ÉºË®≠ÂÆöË©≥Á¥∞:', {
                hideRepresentativeCheckbox: document.getElementById('hideRepresentativeName'),
                hideRepresentativeChecked: document.getElementById('hideRepresentativeName')?.checked,
                hideAddressCheckbox: document.getElementById('hideAddress'),
                hideAddressChecked: document.getElementById('hideAddress')?.checked,
                representativeHide: basicInfoData.representativeHide,
                addressHide: basicInfoData.addressHide
            });

            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'updateMerchantData',
                        merchantId: window.merchantId,
                        data: basicInfoData
                    })
                });

                const result = await response.json();
                console.log('[saveBasicInfo] „É¨„Çπ„Éù„É≥„Çπ:', result);

                if (result.success) {
                    // window.merchantData„ÇíÊõ¥Êñ∞ÔºàÂç≥ÊôÇ„Éó„É¨„Éì„É•„ÉºÁî®Ôºâ
                    window.merchantData['‰ºöÁ§æÂêç'] = basicInfoData.companyName;
                    window.merchantData['‰ºöÁ§æÂêç„Ç´„Éä'] = basicInfoData.companyNameKana;
                    window.merchantData['Â±ãÂè∑'] = basicInfoData.tradeName;
                    window.merchantData['Â±ãÂè∑„Ç´„Éä'] = basicInfoData.tradeNameKana;
                    window.merchantData['‰ª£Ë°®ËÄÖÂêç'] = basicInfoData.representative;
                    window.merchantData['‰ª£Ë°®ËÄÖÂêç„Ç´„Éä'] = basicInfoData.representativeKana;
                    window.merchantData['ÈÉµ‰æøÁï™Âè∑'] = basicInfoData.zipCode;
                    window.merchantData['‰ΩèÊâÄ'] = basicInfoData.address;
                    window.merchantData['ÈõªË©±Áï™Âè∑'] = basicInfoData.phone;
                    window.merchantData['„Ç¶„Çß„Éñ„Çµ„Ç§„ÉàURL'] = basicInfoData.website;
                    window.merchantData['Ë®≠Á´ãÂπ¥Êúà'] = basicInfoData.established;
                    window.merchantData['PR„ÉÜ„Ç≠„Çπ„Éà'] = basicInfoData.prText;

                    showToast('Âü∫Êú¨ÊÉÖÂ†±„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü', 'success');
                    // Èñ≤Ë¶ß„É¢„Éº„Éâ„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
                    updateViewData('basicInfo');
                    // Èñ≤Ë¶ß„É¢„Éº„Éâ„Å´Êàª„Åô
                    toggleEditMode('basicInfo', false);
                } else {
                    showToast('‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + (result.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'), 'error');
                    // „Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
                    saveBtn.innerHTML = originalSaveText;
                    saveBtn.disabled = false;
                }
            } catch (error) {
                console.error('[saveBasicInfo] „Ç®„É©„Éº:', error);
                showToast('ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
                // „Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
                saveBtn.innerHTML = originalSaveText;
                saveBtn.disabled = false;
            } finally {
                // „Éó„É¨„Éì„É•„Éº„Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
                if (previewBtn) {
                    previewBtn.innerHTML = originalPreviewText;
                    previewBtn.disabled = false;
                }
            }
        }

        /**
         * ÊîØÂ∫óÊÉÖÂ†±„ÅÆ‰øùÂ≠ò
         */
        async function saveBranchInfo() {
            if (!window.merchantId) {
                showToast('„Ç®„É©„Éº: merchantId„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                return;
            }

            const saveBtn = document.getElementById('saveBranchInfoBtn');
            const previewBtn = document.querySelector('[onclick="showPreview()"]');

            if (!saveBtn) {
                console.error('[saveBranchInfo] ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                showToast('„Ç®„É©„Éº: ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                return;
            }

            const originalSaveText = saveBtn.innerHTML;
            const originalPreviewText = previewBtn ? previewBtn.innerHTML : '';

            saveBtn.innerHTML = 'üíæ ‰øùÂ≠ò‰∏≠...';
            saveBtn.disabled = true;
            if (previewBtn) {
                previewBtn.innerHTML = '‚è≥ ‰øùÂ≠ò‰∏≠...';
                previewBtn.disabled = true;
            }

            const branchesData = window.branches || [];

            // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàÁî®„Å´ÊîØÂ∫óÂêç„Å®‰ΩèÊâÄ„Çí„Äå„ÄÅ„ÄçÂå∫Âàá„Çä„ÅßÁµêÂêà
            const branchNames = branchesData.map(b => b.name).filter(v => v).join('„ÄÅ');
            const branchAddresses = branchesData.map(b => b.address).filter(v => v).join('„ÄÅ');

            console.log('[saveBranchInfo] Saving branches:', { branchNames, branchAddresses });

            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'updateMerchantData',
                        merchantId: window.merchantId,
                        data: {
                            branchName: branchNames,
                            branchAddress: branchAddresses
                        }
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showToast('ÊîØÂ∫óÊÉÖÂ†±„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü', 'success');
                    updateViewData('branchInfo');
                    toggleEditMode('branchInfo', false);
                } else {
                    showToast('‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + (result.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'), 'error');
                    saveBtn.innerHTML = originalSaveText;
                    saveBtn.disabled = false;
                }
            } catch (error) {
                console.error('[saveBranchInfo] „Ç®„É©„Éº:', error);
                showToast('ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
                saveBtn.innerHTML = originalSaveText;
                saveBtn.disabled = false;
            } finally {
                if (previewBtn) {
                    previewBtn.innerHTML = originalPreviewText;
                    previewBtn.disabled = false;
                }
            }
        }

        /**
         * ÈÄ£Áµ°ÂÖàÊÉÖÂ†±ÔºÜ‰∫ãÊ•≠Ë©≥Á¥∞„ÅÆ‰øùÂ≠ò
         */
        async function saveContactBusiness() {
            if (!window.merchantId) {
                showToast('„Ç®„É©„Éº: merchantId„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                return;
            }

            const saveBtn = document.getElementById('saveContactBusinessBtn');
            const previewBtn = document.querySelector('[onclick="showPreview()"]');

            if (!saveBtn) {
                console.error('[saveContactBusiness] ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                showToast('„Ç®„É©„Éº: ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                return;
            }

            const originalSaveText = saveBtn.innerHTML;
            const originalPreviewText = previewBtn ? previewBtn.innerHTML : '';

            saveBtn.innerHTML = 'üíæ ‰øùÂ≠ò‰∏≠...';
            saveBtn.disabled = true;
            if (previewBtn) {
                previewBtn.innerHTML = '‚è≥ ‰øùÂ≠ò‰∏≠...';
                previewBtn.disabled = true;
            }

            const contactBusinessData = {
                billingEmail: (() => {
                    const inputs = document.querySelectorAll('#billingEmailContainer input[name="billingEmail"]');
                    const emails = Array.from(inputs)
                        .map(input => input.value.trim())
                        .filter(email => email !== '');
                    return emails.join(', ');
                })(),
                salesEmail: document.getElementById('salesEmail').value,
                salesPersonName: document.getElementById('salesPersonName').value,
                salesPersonKana: document.getElementById('salesPersonKana').value,
                employees: document.getElementById('employees').value,
                salesScale: document.getElementById('salesScale').value
            };

            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'updateMerchantData',
                        merchantId: window.merchantId,
                        data: contactBusinessData
                    })
                });

                const result = await response.json();

                if (result.success) {
                    // window.merchantData„ÇíÊõ¥Êñ∞ÔºàÂç≥ÊôÇ„Éó„É¨„Éì„É•„ÉºÁî®Ôºâ
                    window.merchantData['Ë´ãÊ±ÇÁî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ'] = contactBusinessData.billingEmail;
                    window.merchantData['Âñ∂Ê•≠Áî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ'] = contactBusinessData.salesEmail;
                    window.merchantData['Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç'] = contactBusinessData.salesPersonName;
                    window.merchantData['Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„Ç´„Éä'] = contactBusinessData.salesPersonKana;
                    window.merchantData['ÂæìÊ•≠Âì°Êï∞'] = contactBusinessData.employees;
                    window.merchantData['Â£≤‰∏äË¶èÊ®°'] = contactBusinessData.salesScale;

                    showToast('ÈÄ£Áµ°ÂÖàÊÉÖÂ†±ÔºÜ‰∫ãÊ•≠Ë©≥Á¥∞„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü', 'success');
                    updateViewData('contactBusiness');
                    toggleEditMode('contactBusiness', false);
                } else {
                    showToast('‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + (result.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'), 'error');
                    saveBtn.innerHTML = originalSaveText;
                    saveBtn.disabled = false;
                }
            } catch (error) {
                console.error('[saveContactBusiness] „Ç®„É©„Éº:', error);
                showToast('ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
                saveBtn.innerHTML = originalSaveText;
                saveBtn.disabled = false;
            } finally {
                if (previewBtn) {
                    previewBtn.innerHTML = originalPreviewText;
                    previewBtn.disabled = false;
                }
            }
        }

        /**
         * ‰øùÊúâË≥áÊ†º„ÅÆ‰øùÂ≠ò
         */
        async function saveQualifications() {
            if (!window.merchantId) {
                showToast('„Ç®„É©„Éº: merchantId„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                return;
            }

            const saveBtn = document.getElementById('saveQualificationsBtn');
            const previewBtn = document.querySelector('[onclick="showPreview()"]');

            if (!saveBtn) {
                console.error('[saveQualifications] ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                showToast('„Ç®„É©„Éº: ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                return;
            }

            const originalSaveText = saveBtn.innerHTML;
            const originalPreviewText = previewBtn ? previewBtn.innerHTML : '';

            saveBtn.innerHTML = 'üíæ ‰øùÂ≠ò‰∏≠...';
            saveBtn.disabled = true;
            if (previewBtn) {
                previewBtn.innerHTML = '‚è≥ ‰øùÂ≠ò‰∏≠...';
                previewBtn.disabled = true;
            }

            const checkedQuals = Array.from(document.querySelectorAll('input[name="qualifications"]:checked')).map(cb => cb.value);
            const customQuals = Array.from(document.querySelectorAll('#customQualificationsList > div > span')).map(el => el.textContent.trim());
            const allQuals = [...checkedQuals, ...customQuals].filter(q => q);
            const qualificationsString = allQuals.join(',');

            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'updateMerchantData',
                        merchantId: window.merchantId,
                        data: {
                            qualifications: qualificationsString
                        }
                    })
                });

                const result = await response.json();

                if (result.success) {
                    // window.merchantData„ÇíÊõ¥Êñ∞ÔºàÂç≥ÊôÇ„Éó„É¨„Éì„É•„ÉºÁî®Ôºâ
                    window.merchantData['‰øùÊúâË≥áÊ†º'] = qualificationsString;

                    showToast('‰øùÊúâË≥áÊ†º„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü', 'success');
                    updateViewData('qualifications');
                    toggleEditMode('qualifications', false);
                } else {
                    showToast('‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + (result.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'), 'error');
                    saveBtn.innerHTML = originalSaveText;
                    saveBtn.disabled = false;
                }
            } catch (error) {
                console.error('[saveQualifications] „Ç®„É©„Éº:', error);
                showToast('ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
                saveBtn.innerHTML = originalSaveText;
                saveBtn.disabled = false;
            } finally {
                if (previewBtn) {
                    previewBtn.innerHTML = originalPreviewText;
                    previewBtn.disabled = false;
                }
            }
        }

        /**
         * Âä†ÂÖ•‰øùÈô∫„ÅÆ‰øùÂ≠ò
         */
        async function saveInsurance() {
            if (!window.merchantId) {
                showToast('„Ç®„É©„Éº: merchantId„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                return;
            }

            const saveBtn = document.getElementById('saveInsuranceBtn');
            const previewBtn = document.querySelector('[onclick="showPreview()"]');

            if (!saveBtn) {
                console.error('[saveInsurance] ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                showToast('„Ç®„É©„Éº: ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                return;
            }

            const originalSaveText = saveBtn.innerHTML;
            const originalPreviewText = previewBtn ? previewBtn.innerHTML : '';

            saveBtn.innerHTML = 'üíæ ‰øùÂ≠ò‰∏≠...';
            saveBtn.disabled = true;
            if (previewBtn) {
                previewBtn.innerHTML = '‚è≥ ‰øùÂ≠ò‰∏≠...';
                previewBtn.disabled = true;
            }

            const checkedIns = Array.from(document.querySelectorAll('input[name="insurance"]:checked')).map(cb => cb.value);
            const customIns = Array.from(document.querySelectorAll('#customInsuranceList > div > span')).map(el => el.textContent.trim());
            const allIns = [...checkedIns, ...customIns].filter(i => i);
            const insuranceString = allIns.join(',');

            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'updateMerchantData',
                        merchantId: window.merchantId,
                        data: {
                            insurance: insuranceString
                        }
                    })
                });

                const result = await response.json();

                if (result.success) {
                    // window.merchantData„ÇíÊõ¥Êñ∞ÔºàÂç≥ÊôÇ„Éó„É¨„Éì„É•„ÉºÁî®Ôºâ
                    window.merchantData['Âä†ÂÖ•‰øùÈô∫'] = insuranceString;

                    showToast('Âä†ÂÖ•‰øùÈô∫„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü', 'success');
                    updateViewData('insurance');
                    toggleEditMode('insurance', false);
                } else {
                    showToast('‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + (result.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'), 'error');
                    saveBtn.innerHTML = originalSaveText;
                    saveBtn.disabled = false;
                }
            } catch (error) {
                console.error('[saveInsurance] „Ç®„É©„Éº:', error);
                showToast('ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
                saveBtn.innerHTML = originalSaveText;
                saveBtn.disabled = false;
            } finally {
                if (previewBtn) {
                    previewBtn.innerHTML = originalPreviewText;
                    previewBtn.disabled = false;
                }
            }
        }

        /**
         * „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„ÅÆ‰øùÂ≠ò
         */
        async function saveMainVisual() {
            if (!window.merchantId) {
                showToast('„Ç®„É©„Éº: merchantId„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                return;
            }

            const saveBtn = document.getElementById('saveMainVisualBtn');
            const previewBtn = document.querySelector('[onclick="showPreview()"]');

            if (!saveBtn) {
                console.error('[saveMainVisual] ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                showToast('„Ç®„É©„Éº: ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                return;
            }

            const originalSaveText = saveBtn.innerHTML;
            const originalPreviewText = previewBtn ? previewBtn.innerHTML : '';

            saveBtn.innerHTML = 'üíæ ‰øùÂ≠ò‰∏≠...';
            saveBtn.disabled = true;
            if (previewBtn) {
                previewBtn.innerHTML = '‚è≥ ‰øùÂ≠ò‰∏≠...';
                previewBtn.disabled = true;
            }

            try {
                let mainVisualUrl = window.mainVisualUrl || '';

                console.log('[saveMainVisual] Current mainVisualUrl:', mainVisualUrl);
                console.log('[saveMainVisual] mainVisualData exists:', !!mainVisualData);

                // Êñ∞„Åó„ÅÑÁîªÂÉè„Éá„Éº„Çø„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØÂÖà„Å´Google Drive„Å´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
                if (mainVisualData && mainVisualFileName) {
                    console.log('[saveMainVisual] Uploading new image to Google Drive...');
                    const uploadResponse = await fetch(GAS_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/plain' },
                        body: JSON.stringify({
                            action: 'companyinfo_uploadImage',
                            merchantId: window.merchantId,
                            base64Data: mainVisualData,
                            fileName: mainVisualFileName,
                            imageType: 'main-visual'
                        })
                    });

                    const uploadResult = await uploadResponse.json();
                    console.log('[saveMainVisual] Upload result:', uploadResult);

                    if (uploadResult.success) {
                        mainVisualUrl = uploadResult.url;
                        window.mainVisualUrl = uploadResult.url;

                        // Ë°®Á§∫Áî®URL„ÇÇÂç≥Â∫ß„Å´Ë®≠ÂÆöÔºàGoogle Drive URL„ÇíthumbnailÂΩ¢Âºè„Å´Â§âÊèõÔºâ
                        let displayUrl = uploadResult.url;
                        if (uploadResult.url.includes('drive.google.com')) {
                            const idMatch = uploadResult.url.match(/[?&]id=([^&]+)/);
                            if (idMatch) {
                                displayUrl = `https://drive.google.com/thumbnail?id=${idMatch[1]}&sz=w1000`;
                            }
                        }
                        window.mainVisualDisplayUrl = displayUrl;

                        console.log('[saveMainVisual] Image uploaded successfully:', mainVisualUrl);
                        console.log('[saveMainVisual] Display URL set immediately:', window.mainVisualDisplayUrl);
                        // „Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂæå„ÅØ„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢
                        mainVisualData = null;
                        mainVisualFileName = null;
                    } else {
                        throw new Error('ÁîªÂÉè„ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + (uploadResult.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'));
                    }
                }

                console.log('[saveMainVisual] Saving to spreadsheet, URL:', mainVisualUrl);
                console.log('[saveMainVisual] URL length:', mainVisualUrl.length);
                console.log('[saveMainVisual] URL type:', typeof mainVisualUrl);

                const requestData = {
                    action: 'updateMerchantData',
                    merchantId: window.merchantId,
                    data: {
                        '„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´': mainVisualUrl  // Japanese field name to match GAS
                    }
                };

                console.log('[saveMainVisual] Request data:', JSON.stringify(requestData));

                // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´‰øùÂ≠ò
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();

                console.log('[saveMainVisual] GAS response:', result);

                if (result.success) {
                    // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÊúÄÊñ∞„Éá„Éº„Çø„ÇíÂÜçË™≠„ÅøËæº„ÅøÔºàÂãïÁöÑË™≠„ÅøËæº„ÅøÔºâ
                    console.log('[saveMainVisual] „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÊúÄÊñ∞„Éá„Éº„Çø„ÇíÂÜçË™≠„ÅøËæº„Åø‰∏≠...');
                    if (window.merchantData) {
                        const reloadResponse = await fetch(GAS_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'text/plain' },
                            body: JSON.stringify({
                                action: 'getMerchantData',
                                merchantId: window.merchantId
                            })
                        });
                        const reloadResult = await reloadResponse.json();
                        if (reloadResult.success && reloadResult.data) {
                            // ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„Å®Âêå„Åò„Éë„Çø„Éº„É≥ÔºömerchantData„ÇÇÊõ¥Êñ∞
                            window.merchantData = reloadResult.data;

                            const mainVisualUrlFromSheet = reloadResult.data['„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´'] || '';
                            window.mainVisualUrl = mainVisualUrlFromSheet;

                            // Ë°®Á§∫Áî®URL„ÇÇÊõ¥Êñ∞ÔºàÂâäÈô§ÊôÇ„ÅØÁ©∫ÊñáÂ≠óÂàó„ÄÅÊñ∞Ë¶èÊôÇ„ÅØthumbnailÂΩ¢ÂºèÔºâ
                            if (mainVisualUrlFromSheet && mainVisualUrlFromSheet.trim() !== '') {
                                // Google Drive URL„ÇíthumbnailÂΩ¢Âºè„Å´Â§âÊèõ
                                let displayUrl = mainVisualUrlFromSheet;
                                if (mainVisualUrlFromSheet.includes('drive.google.com')) {
                                    const idMatch = mainVisualUrlFromSheet.match(/[?&]id=([^&]+)/);
                                    if (idMatch) {
                                        displayUrl = `https://drive.google.com/thumbnail?id=${idMatch[1]}&sz=w1000`;
                                    }
                                }
                                window.mainVisualDisplayUrl = displayUrl;
                            } else {
                                // ÂâäÈô§ÊôÇ„ÅØË°®Á§∫Áî®URL„ÇÇÁ©∫ÊñáÂ≠óÂàó„Å´„Åô„Çã
                                window.mainVisualDisplayUrl = '';
                            }

                            console.log('[saveMainVisual] ÂÜçË™≠„ÅøËæº„ÅøÂÆå‰∫Ü:', window.mainVisualUrl);
                            console.log('[saveMainVisual] Ë°®Á§∫Áî®URLÊõ¥Êñ∞:', window.mainVisualDisplayUrl);
                        }
                    }

                    // ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„Å®Âêå„Åò„Éë„Çø„Éº„É≥ÔºöÁ∑®ÈõÜ„Ç®„É™„Ç¢„ÅÆ„Éó„É¨„Éì„É•„Éº„ÇíÊõ¥Êñ∞„Åó„Å¶„Åã„ÇâÈñ≤Ë¶ß„É¢„Éº„Éâ„ÇíÊõ¥Êñ∞
                    console.log('[saveMainVisual] Updating main visual preview - window.mainVisualUrl:', window.mainVisualUrl);

                    // „Éó„É¨„Éì„É•„Éº„ÇíÊõ¥Êñ∞ÔºàÁ∑®ÈõÜ„Ç®„É™„Ç¢Ôºâ
                    updateMainVisualPreview();

                    showToast('„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü', 'success');

                    // Á∑®ÈõÜ„É¢„Éº„Éâ„ÇíÁµÇ‰∫Ü
                    toggleEditMode('mainVisual', false);
                } else {
                    console.error('[saveMainVisual] Save failed:', result);
                    showToast('‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + (result.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'), 'error');
                }
            } catch (error) {
                console.error('[saveMainVisual] „Ç®„É©„Éº:', error);
                showToast('ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
            } finally {
                saveBtn.innerHTML = originalSaveText;
                saveBtn.disabled = false;
                if (previewBtn) {
                    previewBtn.innerHTML = originalPreviewText;
                    previewBtn.disabled = false;
                }
            }
        }

        /**
         * ÊñΩÂ∑•‰∫ã‰æã„ÅÆ‰øùÂ≠ò
         */
        async function saveConstructionExamples() {
            if (!window.merchantId) {
                showToast('„Ç®„É©„Éº: merchantId„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                return;
            }

            const saveBtn = document.getElementById('saveConstructionExamplesBtn');
            const previewBtn = document.querySelector('[onclick="showPreview()"]');

            if (!saveBtn) {
                console.error('[saveConstructionExamples] ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                showToast('„Ç®„É©„Éº: ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                return;
            }

            const originalSaveText = saveBtn.innerHTML;
            const originalPreviewText = previewBtn ? previewBtn.innerHTML : '';

            saveBtn.innerHTML = 'üíæ ‰øùÂ≠ò‰∏≠...';
            saveBtn.disabled = true;
            if (previewBtn) {
                previewBtn.innerHTML = '‚è≥ ‰øùÂ≠ò‰∏≠...';
                previewBtn.disabled = true;
            }

            try {
                const examples = window.constructionExamples || [];

                console.log('[saveConstructionExamples] Saving examples:', examples.length, '‰ª∂');

                // 1. „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÊó¢Â≠ò‰∫ã‰æã„ÇíÂèñÂæóÔºàÂâäÈô§Ê§úÂá∫Áî®Ôºâ
                const existingResponse = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'companyinfo_getConstructionExamples',
                        merchantId: window.merchantId
                    })
                });
                const existingResult = await existingResponse.json();
                const existingExamples = existingResult.success ? existingResult.examples : [];
                console.log('[saveConstructionExamples] Existing examples in spreadsheet:', existingExamples.length, '‰ª∂');

                // 2. ÂâäÈô§„Åï„Çå„Åü‰∫ã‰æã„ÇíÊ§úÂá∫ÔºàÊ≠£Ë¶èÂåñ„Åó„ÅüID„Éö„Ç¢„Éô„Éº„ÇπÔºâ
                const currentUrlPairs = new Set(examples.map(e => {
                    const beforeId = normalizeGoogleDriveUrl(e.beforeImage || 'NONE');
                    const afterId = normalizeGoogleDriveUrl(e.afterImage || 'NONE');
                    return `${beforeId}|${afterId}`;
                }));

                const deletedExamples = existingExamples.filter(e => {
                    const beforeId = normalizeGoogleDriveUrl(e.beforeUrl || e.beforeImage || 'NONE');
                    const afterId = normalizeGoogleDriveUrl(e.afterUrl || e.afterImage || 'NONE');
                    const existingUrlPair = `${beforeId}|${afterId}`;
                    return !currentUrlPairs.has(existingUrlPair);
                });
                console.log('[saveConstructionExamples] Deleted examples:', deletedExamples.length, '‰ª∂');

                // 3. ÂâäÈô§„Åï„Çå„Åü‰∫ã‰æã„Çí„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÂâäÈô§
                for (const deleted of deletedExamples) {
                    console.log('[saveConstructionExamples] Deleting example:', deleted.exampleId);
                    const deleteResponse = await fetch(GAS_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/plain' },
                        body: JSON.stringify({
                            action: 'companyinfo_deleteConstructionExample',
                            merchantId: window.merchantId,
                            exampleId: deleted.exampleId
                        })
                    });
                    const deleteResult = await deleteResponse.json();
                    if (deleteResult.success) {
                        console.log('[saveConstructionExamples] Successfully deleted:', deleted.exampleId);
                    } else {
                        console.error('[saveConstructionExamples] Failed to delete:', deleted.exampleId, deleteResult.error);
                    }
                }

                // ÂêÑÊñΩÂ∑•‰∫ã‰æã„ÅÆÁîªÂÉè„ÇíGoogle Drive„Å´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
                const processedExamples = [];

                for (const example of examples) {
                    const processedExample = {
                        id: example.id,
                        title: example.title || '',
                        ageRange: example.ageRange || '',
                        content: example.content || '',
                        price: example.price || '',
                        beforeImage: '',
                        afterImage: ''
                    };

                    // ÊñΩÂ∑•ÂâçÁîªÂÉè„ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
                    if (example.beforeImage && example.beforeImage.startsWith('data:')) {
                        console.log('[saveConstructionExamples] Uploading before image for', example.id);
                        const uploadResponse = await fetch(GAS_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'text/plain' },
                            body: JSON.stringify({
                                action: 'companyinfo_uploadImage',
                                merchantId: window.merchantId,
                                base64Data: example.beforeImage,
                                fileName: `construction_before_${example.id}_${Date.now()}.jpg`,
                                imageType: 'construction-example'
                            })
                        });

                        const uploadResult = await uploadResponse.json();
                        if (uploadResult.success) {
                            processedExample.beforeImage = uploadResult.url;
                            console.log('[saveConstructionExamples] Before image uploaded:', uploadResult.url);
                        } else {
                            throw new Error('ÊñΩÂ∑•ÂâçÁîªÂÉè„ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Å´Â§±Êïó: ' + (uploadResult.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'));
                        }
                    } else if (example.beforeImage) {
                        // Êó¢Â≠ò„ÅÆURL
                        processedExample.beforeImage = example.beforeImage;
                    }

                    // ÊñΩÂ∑•ÂæåÁîªÂÉè„ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
                    if (example.afterImage && example.afterImage.startsWith('data:')) {
                        console.log('[saveConstructionExamples] Uploading after image for', example.id);
                        const uploadResponse = await fetch(GAS_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'text/plain' },
                            body: JSON.stringify({
                                action: 'companyinfo_uploadImage',
                                merchantId: window.merchantId,
                                base64Data: example.afterImage,
                                fileName: `construction_after_${example.id}_${Date.now()}.jpg`,
                                imageType: 'construction-example'
                            })
                        });

                        const uploadResult = await uploadResponse.json();
                        if (uploadResult.success) {
                            processedExample.afterImage = uploadResult.url;
                            console.log('[saveConstructionExamples] After image uploaded:', uploadResult.url);
                        } else {
                            throw new Error('ÊñΩÂ∑•ÂæåÁîªÂÉè„ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Å´Â§±Êïó: ' + (uploadResult.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'));
                        }
                    } else if (example.afterImage) {
                        // Êó¢Â≠ò„ÅÆURL
                        processedExample.afterImage = example.afterImage;
                    }

                    processedExamples.push(processedExample);
                }

                // „Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂÆå‰∫ÜÂæå„ÄÅwindow.constructionExamples„ÇíÊõ¥Êñ∞Ôºàbase64„ÇíURL„Å´ÁΩÆ„ÅçÊèõ„ÅàÔºâ
                window.constructionExamples = processedExamples;

                console.log('[saveConstructionExamples] Saving', processedExamples.length, 'examples to separate sheet');

                // ÂêÑÊñΩÂ∑•‰∫ã‰æã„ÇíÂÄãÂà•„Å´API„Åß‰øùÂ≠òÔºàÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ‰ªò„ÅçÔºâ
                let savedCount = 0;
                const savedUrlPairs = new Set();

                for (const example of processedExamples) {
                    // ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØÔºöÊ≠£Ë¶èÂåñ„Åó„ÅüID„Éö„Ç¢„ÅßÂà§ÂÆö
                    const beforeId = normalizeGoogleDriveUrl(example.beforeImage || 'NONE');
                    const afterId = normalizeGoogleDriveUrl(example.afterImage || 'NONE');
                    const urlPair = `${beforeId}|${afterId}`;

                    if (savedUrlPairs.has(urlPair)) {
                        console.log('[saveConstructionExamples] üî• ÈáçË§á„Çπ„Ç≠„ÉÉ„ÉóÔºàÂêå„ÅòID„Éö„Ç¢Ôºâ:', example.title, 'ID pair:', urlPair);
                        continue;
                    }
                    savedUrlPairs.add(urlPair);
                    const response = await fetch(GAS_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/plain' },
                        body: JSON.stringify({
                            action: 'companyinfo_saveConstructionExample',
                            merchantId: window.merchantId,
                            exampleData: {
                                id: example.id,
                                title: example.title,
                                age: example.ageRange,
                                cost: example.price,
                                description: example.content,
                                beforeImage: example.beforeImage,
                                afterImage: example.afterImage
                            }
                        })
                    });

                    const result = await response.json();
                    console.log('[saveConstructionExamples] Example saved:', example.id, result);

                    if (result.success) {
                        savedCount++;
                    } else {
                        console.error('[saveConstructionExamples] Failed to save example:', example.id, result.error);
                        throw new Error(`ÊñΩÂ∑•‰∫ã‰æã ${example.title} „ÅÆ‰øùÂ≠ò„Å´Â§±Êïó: ${result.error}`);
                    }
                }

                console.log('[saveConstructionExamples] ‰øùÂ≠òÊàêÂäü:', savedCount, '‰ª∂');

                // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÊúÄÊñ∞„Éá„Éº„Çø„ÇíÂÜçË™≠„ÅøËæº„ÅøÔºàÂãïÁöÑË™≠„ÅøËæº„ÅøÔºâ
                console.log('[saveConstructionExamples] „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÊúÄÊñ∞„Éá„Éº„Çø„ÇíÂÜçË™≠„ÅøËæº„Åø‰∏≠...');
                await loadConstructionExamples();

                // „Éó„É¨„Éì„É•„Éº„ÇíÊõ¥Êñ∞
                updateExamplesPreview();

                // Èñ≤Ë¶ß„É¢„Éº„Éâ„ÇíÊõ¥Êñ∞
                updateViewData('constructionExamples');

                showToast(`ÊñΩÂ∑•‰∫ã‰æã„Çí${savedCount}‰ª∂‰øùÂ≠ò„Åó„Åæ„Åó„Åü`, 'success');

                // Á∑®ÈõÜ„É¢„Éº„Éâ„ÇíÁµÇ‰∫Ü
                toggleEditMode('constructionExamples', false);
            } catch (error) {
                console.error('[saveConstructionExamples] „Ç®„É©„Éº:', error);
                showToast('ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
            } finally {
                // ‰øùÂ≠ò„Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
                saveBtn.innerHTML = originalSaveText;
                saveBtn.disabled = false;

                // „Éó„É¨„Éì„É•„Éº„Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
                if (previewBtn) {
                    previewBtn.innerHTML = originalPreviewText;
                    previewBtn.disabled = false;
                }
            }
        }

        /**
         * ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„ÅÆ‰øùÂ≠ò
         */
        async function savePhotoGallery() {
            if (!window.merchantId) {
                showToast('„Ç®„É©„Éº: merchantId„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                return;
            }

            const saveBtn = document.getElementById('savePhotoGalleryBtn');
            const previewBtn = document.querySelector('[onclick="previewCompanyInfo()"]');

            if (!saveBtn) {
                console.error('[savePhotoGallery] ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                showToast('„Ç®„É©„Éº: ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                return;
            }

            const originalSaveText = saveBtn.innerHTML;
            const originalPreviewText = previewBtn ? previewBtn.innerHTML : '';

            saveBtn.innerHTML = 'üíæ ‰øùÂ≠ò‰∏≠...';
            saveBtn.disabled = true;
            if (previewBtn) {
                previewBtn.innerHTML = '‚è≥ ‰øùÂ≠ò‰∏≠...';
                previewBtn.disabled = true;
            }

            try {
                // Êñ∞„Åó„ÅÑÁîªÂÉè„ÇíGoogle Drive„Å´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
                if (galleryFilesToUpload.length > 0) {
                    console.log('[savePhotoGallery] Uploading', galleryFilesToUpload.length, 'new images...');

                    for (const file of galleryFilesToUpload) {
                        const uploadResponse = await fetch(GAS_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'text/plain' },
                            body: JSON.stringify({
                                action: 'companyinfo_uploadImage',
                                merchantId: window.merchantId,
                                base64Data: file.base64Data,
                                fileName: file.fileName,
                                imageType: 'gallery'
                            })
                        });

                        const uploadResult = await uploadResponse.json();
                        console.log('[savePhotoGallery] Upload result:', uploadResult);
                        console.log('[savePhotoGallery] üîç uploadResult.urlË©≥Á¥∞:', {
                            url: uploadResult.url,
                            urlType: typeof uploadResult.url,
                            urlLength: uploadResult.url ? uploadResult.url.length : 0,
                            startsWithHttp: uploadResult.url ? uploadResult.url.startsWith('http') : false,
                            includesDrive: uploadResult.url ? uploadResult.url.includes('drive.google.com') : false
                        });

                        if (uploadResult.success) {
                            // üöÄ „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„Å®Âêå„ÅòÂá¶ÁêÜÔºöGoogle Drive URL„ÇíË°®Á§∫ÂèØËÉΩ„Å™ÂΩ¢Âºè„Å´Â§âÊèõ
                            let displayUrl = uploadResult.url;
                            if (uploadResult.url.includes('drive.google.com')) {
                                const idMatch = uploadResult.url.match(/[?&]id=([^&]+)/);
                                if (idMatch) {
                                    displayUrl = `https://drive.google.com/thumbnail?id=${idMatch[1]}&sz=w800`;
                                    console.log('[savePhotoGallery] üîç Google Drive URLÂ§âÊèõ:', {
                                        original: uploadResult.url,
                                        converted: displayUrl,
                                        idExtracted: idMatch[1]
                                    });
                                }
                            }

                            // „Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊàêÂäü„Åó„Åü„ÇâgalleryImages„Å´ËøΩÂä†
                            const newImageData = {
                                id: 'gallery_' + Date.now(),
                                src: displayUrl, // Â§âÊèõÂæå„ÅÆURL„Çí‰ΩøÁî®
                                name: file.fileName
                            };
                            window.galleryImages.push(newImageData);
                            console.log('[savePhotoGallery] üîç Êñ∞ÁîªÂÉè„Çíwindow.galleryImages„Å´ËøΩÂä†:', newImageData);
                            console.log('[savePhotoGallery] üîç ÁèæÂú®„ÅÆwindow.galleryImages.length:', window.galleryImages.length);
                        } else {
                            throw new Error('ÁîªÂÉè„ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + (uploadResult.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'));
                        }
                    }

                    // „Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂÆå‰∫Ü„Åó„Åü„Çâ„ÇØ„É™„Ç¢
                    galleryFilesToUpload = [];
                }

                const gallery = window.galleryImages || [];
                const galleryUrls = gallery.map(img => img.src).join(',');

                console.log('[savePhotoGallery] Saving gallery URLs:', {
                    count: gallery.length,
                    urls: galleryUrls,
                    urlsLength: galleryUrls.length,
                    urlsType: typeof galleryUrls
                });

                const requestData = {
                    action: 'updateMerchantData',
                    merchantId: window.merchantId,
                    data: {
                        'ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº': galleryUrls  // Japanese field name to match GAS
                    }
                };

                console.log('[savePhotoGallery] Request data:', JSON.stringify(requestData));

                // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´‰øùÂ≠ò
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();

                console.log('[savePhotoGallery] Save result:', result);

                if (result.success) {
                    console.log('‚úÖ [savePhotoGallery] ‰øùÂ≠òÊàêÂäüÔºÅ');

                    // üöÄ „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„Å®Âêå„Åò„Éë„Çø„Éº„É≥Ôºö„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÊúÄÊñ∞„Éá„Éº„Çø„ÇíÂÜçË™≠„ÅøËæº„ÅøÔºàÂãïÁöÑË™≠„ÅøËæº„ÅøÔºâ
                    console.log('[savePhotoGallery] „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÊúÄÊñ∞„Éá„Éº„Çø„ÇíÂÜçË™≠„ÅøËæº„Åø‰∏≠...');
                    if (window.merchantData) {
                        const reloadResponse = await fetch(GAS_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'text/plain' },
                            body: JSON.stringify({
                                action: 'getMerchantData',
                                merchantId: window.merchantId
                            })
                        });
                        const reloadResult = await reloadResponse.json();
                        if (reloadResult.success && reloadResult.data) {
                            // „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„Å®Âêå„Åò„Éë„Çø„Éº„É≥ÔºömerchantData„ÇÇÊõ¥Êñ∞
                            window.merchantData = reloadResult.data;

                            const galleryString = reloadResult.data['ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº'] || '';
                            console.log('[savePhotoGallery] „Çπ„Éó„Ç∑„Åã„ÇâË™≠„ÅøËæº„Çì„Å†„ÇÆ„É£„É©„É™„Éº„Éá„Éº„Çø:', galleryString);

                            if (galleryString && galleryString.trim() !== '') {
                                const galleryUrls = galleryString.split(',').map(url => url.trim()).filter(url => url);
                                console.log('[savePhotoGallery] üîç „Çπ„Éó„Ç∑„Åã„ÇâË™≠„ÅøËæº„Çì„Å†URL‰∏ÄË¶ß:', galleryUrls);

                                window.galleryImages = galleryUrls.map((url, index) => {
                                    // üöÄ Google Drive URL„ÇíË°®Á§∫ÂèØËÉΩ„Å™ÂΩ¢Âºè„Å´Â§âÊèõ
                                    let displayUrl = url;
                                    if (url.includes('drive.google.com')) {
                                        const idMatch = url.match(/[?&]id=([^&]+)/);
                                        if (idMatch) {
                                            displayUrl = `https://drive.google.com/thumbnail?id=${idMatch[1]}&sz=w800`;
                                            console.log('[savePhotoGallery] üîç „Çπ„Éó„Ç∑URLÂ§âÊèõ:', {
                                                original: url,
                                                converted: displayUrl,
                                                index: index
                                            });
                                        }
                                    }

                                    return {
                                        id: 'gallery_loaded_' + index,
                                        src: displayUrl, // Â§âÊèõÂæå„ÅÆURL„Çí‰ΩøÁî®
                                        name: '„ÇÆ„É£„É©„É™„ÉºÁîªÂÉè' + (index + 1)
                                    };
                                });
                                console.log('‚úÖ [savePhotoGallery] „Çπ„Éó„Ç∑ÂÜçË™≠„ÅøËæº„ÅøÂÆå‰∫Ü:', window.galleryImages.length, '‰ª∂');
                                console.log('[savePhotoGallery] üîç ÊúÄÁµÇÁöÑ„Å™window.galleryImages:', window.galleryImages);
                            } else {
                                window.galleryImages = [];
                                console.log('[savePhotoGallery] „ÇÆ„É£„É©„É™„Éº„Éá„Éº„Çø„ÅåÁ©∫„Åß„Åô');
                            }
                        }
                    }

                    // „Éó„É¨„Éì„É•„Éº„ÇíÊõ¥Êñ∞ÔºàÁ∑®ÈõÜ„Ç®„É™„Ç¢Ôºâ
                    updateGalleryPreview();

                    // üöÄ „Éó„É¨„Éì„É•„Éº„É¢„Éº„ÉÄ„É´„ÅåÈñã„ÅÑ„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÂç≥Â∫ß„Å´ÂèçÊò†
                    const previewModal = document.getElementById('companyPreviewModal');
                    if (previewModal && !previewModal.classList.contains('hidden')) {
                        console.log('üöÄ [savePhotoGallery] „Éó„É¨„Éì„É•„Éº„É¢„Éº„ÉÄ„É´Èñã„ÅÑ„Å¶„ÅÑ„Çã„Åü„ÇÅÂç≥Â∫ß„Å´ÂèçÊò†');
                        setTimeout(async () => {
                            await previewCompanyInfo();
                        }, 100);
                    }

                    showToast('ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü', 'success');

                    // üöÄ „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÂÜçË™≠„ÅøËæº„Åø„Åó„ÅüÊúÄÊñ∞„Éá„Éº„Çø„ÇíÈñ≤Ë¶ß„É¢„Éº„Éâ„Å´Á¢∫ÂÆü„Å´ÂèçÊò†
                    console.log('[savePhotoGallery] Èñ≤Ë¶ß„É¢„Éº„ÉâË°®Á§∫„ÇíÊúÄÊñ∞„Éá„Éº„Çø„ÅßÊõ¥Êñ∞ÈñãÂßã');
                    updateViewData('photoGallery');
                    console.log('[savePhotoGallery] Èñ≤Ë¶ß„É¢„Éº„ÉâË°®Á§∫Êõ¥Êñ∞ÂÆå‰∫Ü - window.galleryImages.length:', (window.galleryImages || []).length);

                    // Á∑®ÈõÜ„É¢„Éº„Éâ„ÇíÁµÇ‰∫Ü
                    toggleEditMode('photoGallery', false);
                } else {
                    console.error('[savePhotoGallery] ‰øùÂ≠òÂ§±Êïó:', result.error);
                    showToast('‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + (result.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'), 'error');
                }
            } catch (error) {
                console.error('[savePhotoGallery] „Ç®„É©„Éº:', error);
                showToast('ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
            } finally {
                // ‰øùÂ≠ò„Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
                saveBtn.innerHTML = originalSaveText;
                saveBtn.disabled = false;

                // „Éó„É¨„Éì„É•„Éº„Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
                if (previewBtn) {
                    previewBtn.innerHTML = originalPreviewText;
                    previewBtn.disabled = false;
                }
            }
        }

        // ‰ºöÁ§æÊÉÖÂ†±„ÅÆ‰øùÂ≠ò
        async function saveCompanyInfo(event) {
            console.log('[saveCompanyInfo] ‰øùÂ≠òÈñãÂßã');
            console.log('[saveCompanyInfo] GAS_URL:', GAS_URL);
            console.log('[saveCompanyInfo] window.merchantId:', window.merchantId);

            if (!window.merchantId) {
                alert('„Ç®„É©„Éº: merchantId„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ„É≠„Ç∞„Ç§„É≥„ÅóÁõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                console.error('[saveCompanyInfo] merchantId„ÅåÊú™Ë®≠ÂÆö');
                return;
            }

            // „Ç§„Éô„É≥„Éà„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Åå„Å™„ÅÑÂ†¥ÂêàÔºàonclickÂ±ûÊÄß„Åã„Çâ„ÅÆÂëº„Å≥Âá∫„ÅóÔºâ„ÅØ„Éú„Çø„É≥„ÇíÊ§úÁ¥¢
            let saveButton = null;
            if (event && event.target) {
                saveButton = event.target.closest('button');
            } else {
                // „Ç§„Éô„É≥„Éà„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ‰øùÂ≠ò„Éú„Çø„É≥„ÇíDOM„Åã„ÇâÊ§úÁ¥¢
                saveButton = document.querySelector('button[onclick="saveCompanyInfo()"]');
            }

            if (!saveButton) {
                console.error('[saveCompanyInfo] ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }

            saveButton.disabled = true;
            const originalHTML = saveButton.innerHTML;
            saveButton.innerHTML = '<svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> ‰øùÂ≠ò‰∏≠...';

            try {
                const result = await autoSave();
                console.log('[saveCompanyInfo] ‰øùÂ≠òÁµêÊûú:', result);
                showNotification('‰øùÂ≠òÂÆå‰∫Ü', '‰ºöÁ§æÊÉÖÂ†±„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
            } catch (error) {
                console.error('[saveCompanyInfo] „Ç®„É©„Éº:', error);
                showNotification('„Ç®„É©„Éº', '‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
            } finally {
                saveButton.disabled = false;
                saveButton.innerHTML = originalHTML;
            }
        }

        // ‰ºöÁ§æÊÉÖÂ†±„ÅÆ„É™„Çª„ÉÉ„Éà
        function resetCompanyInfo() {
            if (confirm('ÂÖ•ÂäõÂÜÖÂÆπ„Çí„É™„Çª„ÉÉ„Éà„Åó„Å¶„ÄÅ„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÂÜçË™≠„ÅøËæº„Åø„Åó„Åæ„Åô„ÅãÔºü')) {
                if (window.merchantData) {
                    loadMerchantData(window.merchantId, window.merchantData);
                    showNotification('„É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü', 'ÊúÄÊñ∞„ÅÆ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü');
                }
            }
        }

        // „Ç´„Çπ„Çø„É†Ë≥áÊ†º„ÇíËøΩÂä†
        function addCustomQualification() {
            const input = document.getElementById('customQualificationInput');
            const value = input.value.trim();

            if (value) {
                const list = document.getElementById('customQualificationsList');
                const tag = document.createElement('div');
                tag.className = 'inline-flex items-center bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm';
                tag.innerHTML = `
                    <span>${value}</span>
                    <button onclick="this.parentElement.remove()" class="ml-2 text-blue-600 hover:text-blue-800">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                `;
                list.appendChild(tag);
                input.value = '';
            }
        }

        // „Ç´„Çπ„Çø„É†‰øùÈô∫„ÇíËøΩÂä†
        function addCustomInsurance() {
            const input = document.getElementById('customInsuranceInput');
            const value = input.value.trim();

            if (value) {
                const list = document.getElementById('customInsuranceList');
                const tag = document.createElement('div');
                tag.className = 'inline-flex items-center bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm';
                tag.innerHTML = `
                    <span>${value}</span>
                    <button onclick="this.parentElement.remove()" class="ml-2 text-green-600 hover:text-green-800">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                `;
                list.appendChild(tag);
                input.value = '';
            }
        }

        // Ë´ãÊ±ÇÁî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíËøΩÂä†
        function addBillingEmail() {
            const container = document.getElementById('billingEmailContainer');
            const items = container.querySelectorAll('.billing-email-item');

            // ÊúÄÂ§ß3„Å§„Åæ„Åß
            if (items.length >= 3) {
                alert('Ë´ãÊ±ÇÁî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅØÊúÄÂ§ß3„Å§„Åæ„ÅßËøΩÂä†„Åß„Åç„Åæ„Åô„ÄÇ');
                return;
            }

            const newItem = document.createElement('div');
            newItem.className = 'billing-email-item mb-2';
            newItem.innerHTML = `
                <div class="flex gap-2">
                    <input type="email" name="billingEmail" data-section="contactBusiness" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="billing@example.com">
                    <button type="button" onclick="removeBillingEmail(this)" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 flex items-center" title="„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíÂâäÈô§">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `;

            container.appendChild(newItem);

            // ÊúÄÂàù„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÅÆËøΩÂä†„Éú„Çø„É≥„ÇíÂâäÈô§„Éú„Çø„É≥„Å´Â§âÊõ¥
            updateBillingEmailButtons();
        }

        // Ë´ãÊ±ÇÁî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíÂâäÈô§
        function removeBillingEmail(button) {
            const item = button.closest('.billing-email-item');
            const container = document.getElementById('billingEmailContainer');

            // ÊúÄ‰Ωé1„Å§„ÅØÊÆã„Åô
            if (container.querySelectorAll('.billing-email-item').length > 1) {
                item.remove();
                updateBillingEmailButtons();
            }
        }

        // Ë´ãÊ±ÇÁî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅÆ„Éú„Çø„É≥Ë°®Á§∫„ÇíÊõ¥Êñ∞
        function updateBillingEmailButtons() {
            const container = document.getElementById('billingEmailContainer');
            const items = container.querySelectorAll('.billing-email-item');

            items.forEach((item, index) => {
                const buttonContainer = item.querySelector('.flex');
                const existingButton = buttonContainer.querySelector('button');

                if (index === 0 && items.length === 1) {
                    // ÊúÄÂàù„ÅÆ„Ç¢„Ç§„ÉÜ„É†„Åß1„Å§„Åó„Åã„Å™„ÅÑÂ†¥Âêà„ÅØËøΩÂä†„Éú„Çø„É≥
                    existingButton.outerHTML = `
                        <button type="button" onclick="addBillingEmail()" class="bg-blue-500 text-white px-3 py-2 rounded-lg hover:bg-blue-600 flex items-center" title="„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíËøΩÂä†">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                        </button>
                    `;
                } else if (index === 0) {
                    // ÊúÄÂàù„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÅßË§áÊï∞„ÅÇ„ÇãÂ†¥Âêà„ÅØËøΩÂä†„Éú„Çø„É≥ÔºàÊúÄÂ§ßÊï∞Êú™Ê∫Ä„ÅÆÂ†¥ÂêàÔºâ
                    const isMaxReached = items.length >= 3;
                    if (isMaxReached) {
                        existingButton.outerHTML = `
                            <button type="button" onclick="removeBillingEmail(this)" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 flex items-center" title="„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíÂâäÈô§">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        `;
                    } else {
                        existingButton.outerHTML = `
                            <button type="button" onclick="addBillingEmail()" class="bg-blue-500 text-white px-3 py-2 rounded-lg hover:bg-blue-600 flex items-center" title="„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíËøΩÂä†">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                            </button>
                        `;
                    }
                }
            });
        }

        /**
         * Ë®≠Á´ãÂπ¥Êúà„ÅÆ„Éï„Ç©„Éº„Éû„ÉÉ„ÉàÁµ±‰∏ÄÈñ¢Êï∞
         * ISOÂΩ¢ÂºèÔºà2012-06-30T15:00:00.000ZÔºâ„ÇíÊó•Êú¨Ë™ûÂΩ¢ÂºèÔºà2012Âπ¥6ÊúàÔºâ„Å´Â§âÊèõ
         */
        function formatEstablishedDate(dateValue) {
            if (!dateValue || dateValue === '-') return dateValue;

            // Âûã„ÉÅ„Çß„ÉÉ„ÇØ - ÊñáÂ≠óÂàó„Åß„Å™„ÅÑÂ†¥Âêà„ÅØÊñáÂ≠óÂàó„Å´Â§âÊèõ
            if (typeof dateValue !== 'string') {
                dateValue = String(dateValue);
            }

            if (dateValue.includes('T') || dateValue.includes('Z')) {
                const date = new Date(dateValue);
                const year = date.getFullYear();
                const month = date.getMonth() + 1;
                return `${year}Âπ¥${month}Êúà`;
            }
            return dateValue; // Êó¢„Å´Ê≠£„Åó„ÅÑÂΩ¢Âºè„ÅÆÂ†¥Âêà„ÅØ„Åù„ÅÆ„Åæ„Åæ
        }

        // ‰ºöÁ§æÊÉÖÂ†±„ÅÆ„Éó„É¨„Éì„É•„Éº
        async function previewCompanyInfo() {
            console.log('[previewCompanyInfo] „Éó„É¨„Éì„É•„ÉºÈñãÂßã');

            // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆ„Éá„Éº„Çø„ÇíÂÑ™ÂÖàÁöÑ„Å´Á¢∫Ë™ç
            let spreadsheetData = {};
            if (window.merchantData && Object.keys(window.merchantData).length > 0) {
                spreadsheetData = window.merchantData;
                console.log('[previewCompanyInfo] „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Éá„Éº„Çø‰ΩøÁî®:', spreadsheetData);
            } else {
                console.log('[previewCompanyInfo] „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Éá„Éº„Çø„Å™„Åó - Á∑®ÈõÜ„É¢„Éº„Éâ„ÅÆÂÄ§„ÅÆ„ÅøË°®Á§∫');
            }

            // ÂÖ•ÂäõÂÄ§„ÇíÂèñÂæóÔºà„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Éá„Éº„Çø„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„Éá„Éï„Ç©„É´„ÉàÂÄ§„Å™„ÅóÔºâ
            const companyName = spreadsheetData['‰ºöÁ§æÂêç'] || document.getElementById('companyName')?.value || '';
            const tradeName = spreadsheetData['Â±ãÂè∑'] || document.getElementById('tradeName')?.value || '';
            const displayOption = document.querySelector('input[name="tradeNameDisplay"]:checked')?.value || 'company';
            const representative = spreadsheetData['‰ª£Ë°®ËÄÖÂêç'] || document.getElementById('representative')?.value || '';
            const zipCode = spreadsheetData['ÈÉµ‰æøÁï™Âè∑'] || document.getElementById('zipCode')?.value || '';
            const address = spreadsheetData['ÊâÄÂú®Âú∞'] || document.getElementById('address')?.value || '';
            const established = formatEstablishedDate(spreadsheetData['Ë®≠Á´ãÂπ¥Êúà'] || document.getElementById('established')?.value || '');

            const prText = spreadsheetData['PRÊñá'] || document.getElementById('prText')?.value || '';

            console.log('[previewCompanyInfo] ÂèñÂæó„Åó„ÅüÂÄ§:');
            console.log('[previewCompanyInfo] Ë®≠Á´ãÂπ¥Êúà - „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà:', spreadsheetData['Ë®≠Á´ãÂπ¥Êúà']);
            console.log('[previewCompanyInfo] Ë®≠Á´ãÂπ¥Êúà - ÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ:', document.getElementById('established')?.value);
            console.log('[previewCompanyInfo] Ë®≠Á´ãÂπ¥Êúà - ÊúÄÁµÇÂÄ§:', established);
            console.log('  companyName:', companyName);
            console.log('  tradeName:', tradeName);
            console.log('  representative:', representative);
            console.log('  address:', address);
            console.log('  prText:', prText.substring(0, 50) + '...');

            // ‰ºöÁ§æÂêç„ÅÆË°®Á§∫„ÇíÊ±∫ÂÆö
            let displayName = companyName;
            let displayHtml = companyName; // HTMLÁî®Ôºà„Çµ„Ç§„Ç∫Ë™øÊï¥Âê´„ÇÄÔºâ

            if (tradeName && tradeName.trim() !== '') {
                const reverseOrder = document.getElementById('reverseOrder')?.checked || false;
                const smallerSecond = document.getElementById('smallerSecond')?.checked || false;

                switch(displayOption) {
                    case 'trade':
                        displayName = tradeName;
                        displayHtml = tradeName;
                        break;
                    case 'both':
                        if (reverseOrder) {
                            displayName = `${tradeName}ÔΩú${companyName}`;
                            if (smallerSecond) {
                                displayHtml = `${tradeName}ÔΩú<span style="font-size:85%">${companyName}</span>`;
                            } else {
                                displayHtml = displayName;
                            }
                        } else {
                            displayName = `${companyName}ÔΩú${tradeName}`;
                            if (smallerSecond) {
                                displayHtml = `${companyName}ÔΩú<span style="font-size:85%">${tradeName}</span>`;
                            } else {
                                displayHtml = displayName;
                            }
                        }
                        break;
                    case 'company':
                    default:
                        displayName = companyName;
                        displayHtml = companyName;
                        break;
                }
            }

            // „Éó„É¨„Éì„É•„Éº„Å´ÂèçÊò†
            const setElementText = (id, text) => {
                const element = document.getElementById(id);
                if (element) element.textContent = text;
            };

            const setElementHtml = (id, html) => {
                const element = document.getElementById(id);
                if (element) element.innerHTML = html;
            };

            // ‰ºöÁ§æÂêç„ÅØHTML„Å®„Åó„Å¶Ë®≠ÂÆöÔºà„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫Â§âÊõ¥„ÇíÂèçÊò†„Åô„Çã„Åü„ÇÅÔºâ
            // previewCompanyNameË¶ÅÁ¥†„ÅØÂ≠òÂú®„Åó„Å™„ÅÑ„Åü„ÇÅ„Çπ„Ç≠„ÉÉ„Éó
            setElementHtml('previewCompanyNameHero', displayHtml);
            setElementHtml('previewCompanyNameOverlay', displayHtml);
            setElementHtml('previewCompanyNameFull', displayHtml);

            console.log('[previewCompanyInfo] ‰ºöÁ§æÂêçË®≠ÂÆöÂÆå‰∫Ü:', displayHtml);

            // üöÄ „Éó„É©„Ç§„Éê„Ç∑„ÉºË®≠ÂÆö„ÇíÁ¢∫Ë™ç„Åó„Å¶‰ª£Ë°®ËÄÖÂêç„ÇíË°®Á§∫/ÈùûË°®Á§∫
            const hideRepresentative = document.getElementById('hideRepresentativeName')?.checked || false;
            const representativeSection = document.getElementById('basicInfo-representative');

            if (hideRepresentative) {
                // ‰ª£Ë°®ËÄÖÂêç„Çª„ÇØ„Ç∑„Éß„É≥ÂÖ®‰Ωì„ÇíÈùûË°®Á§∫
                if (representativeSection) {
                    representativeSection.style.display = 'none';
                }
                console.log('[previewCompanyInfo] ‰ª£Ë°®ËÄÖÂêç„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÂÆåÂÖ®ÈùûË°®Á§∫„Å´Ë®≠ÂÆö');
            } else {
                // ‰ª£Ë°®ËÄÖÂêç„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
                if (representativeSection) {
                    representativeSection.style.display = '';
                }
                setElementText('previewRepresentative', representative);
                console.log('[previewCompanyInfo] ‰ª£Ë°®ËÄÖÂêç„ÇíË°®Á§∫:', representative);
            }

            // üöÄ „Éó„É©„Ç§„Éê„Ç∑„ÉºË®≠ÂÆö„ÇíÁ¢∫Ë™ç„Åó„Å¶‰ΩèÊâÄ„ÇíË°®Á§∫/ÈùûË°®Á§∫
            const hideAddress = document.getElementById('hideAddress')?.checked || false;
            const fullAddress = zipCode ? `„Äí${zipCode} ${address}` : address;

            if (hideAddress) {
                // ‰ΩèÊâÄ„ÅÆÁï™Âú∞ÈÉ®ÂàÜ„ÇíÈô§ÂéªÔºàÊï∞Â≠ó„Å®„Éè„Ç§„Éï„É≥„ÇíÂê´„ÇÄÈÉ®ÂàÜ„Çí„Ç´„ÉÉ„ÉàÔºâ
                const addressWithoutBanchi = address.replace(/[\d\-]+.*$/, '').trim();
                const partialAddress = zipCode ? `„Äí${zipCode} ${addressWithoutBanchi}` : addressWithoutBanchi;
                setElementText('previewAddress', partialAddress);
                console.log('[previewCompanyInfo] ‰ΩèÊâÄ„ÅÆÁï™Âú∞„ÇíÈô§Âéª„Åó„Å¶Ë°®Á§∫:', partialAddress);
            } else {
                setElementText('previewAddress', fullAddress);
                console.log('[previewCompanyInfo] ‰ΩèÊâÄ„ÇíÂÆåÂÖ®Ë°®Á§∫:', fullAddress);
            }

            setElementText('previewEstablishedDate', established);

            // PRÊñá„ÇíË°®Á§∫
            setElementText('previewPrText', prText);

            // Âü∫Êú¨ÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÁ¢∫ÂÆü„Å´Ë°®Á§∫
            const basicInfoSection = document.getElementById('preview-basicInfo');
            if (basicInfoSection) {
                basicInfoSection.style.display = 'block';
                console.log('[previewCompanyInfo] Âü∫Êú¨ÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥Ë°®Á§∫Ë®≠ÂÆöÂÆå‰∫Ü');
            } else {
                console.error('[previewCompanyInfo] Âü∫Êú¨ÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥Ë¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
            }

            // „Ç≠„É£„ÉÉ„ÉÅ„Éï„É¨„Éº„Ç∫„ÇíPRÊñá„ÅÆÊúÄÂàù„ÅÆ‰∏ÄÊñá„Åã„ÇâÊäΩÂá∫ÔºàÂè•ÁÇπ„Åæ„Åß„ÅßÂàá„ÇãÔºâ
            const firstSentence = prText.split('„ÄÇ')[0];
            const tagline = firstSentence || '‰ø°È†º„Å®ÂÆüÁ∏æ„ÅÆÂ§ñÂ£ÅÂ°óË£ÖÂ∞ÇÈñÄÂ∫ó';
            setElementText('previewTagline', tagline || '‰ø°È†º„Å®ÂÆüÁ∏æ„ÅÆÂ§ñÂ£ÅÂ°óË£ÖÂ∞ÇÈñÄÂ∫ó');
            setElementText('previewTaglineHero', tagline || '‰ø°È†º„Å®ÂÆüÁ∏æ„ÅÆÂ§ñÂ£ÅÂ°óË£ÖÂ∞ÇÈñÄÂ∫ó');
            setElementText('previewTaglineOverlay', tagline || '‰ø°È†º„Å®ÂÆüÁ∏æ„ÅÆÂ§ñÂ£ÅÂ°óË£ÖÂ∞ÇÈñÄÂ∫ó');

            console.log('[previewCompanyInfo] Ë®≠Á´ãÂπ¥Êúà„ÇíË®≠ÂÆö‰∏≠:', established);
            // „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´‰∏ä„ÅÆË®≠Á´ãÂπ¥Êúà„Å´„ÄåË®≠Á´ã„Äç„ÇíËøΩÂä†
            const establishedWithSuffix = established && established !== '-' ? `${established}Ë®≠Á´ã` : established;
            setElementText('previewEstablishedHero', establishedWithSuffix);
            setElementText('previewEstablishedOverlay', establishedWithSuffix);

            // Ë®≠ÂÆöÂæå„ÅÆÁ¢∫Ë™ç
            const overlayElement = document.getElementById('previewEstablishedOverlay');
            console.log('[previewCompanyInfo] previewEstablishedOverlay Ë¶ÅÁ¥†:', !!overlayElement);
            console.log('[previewCompanyInfo] previewEstablishedOverlay ÂÜÖÂÆπ:', overlayElement?.textContent);

            // „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„ÅÆÂèñÂæóÔºà„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Éá„Éº„Çø„ÇíÂÑ™ÂÖàÔºâ
            let mainVisual = '';

            // 1. „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆ„Éá„Éº„Çø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            if (spreadsheetData['„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´'] && spreadsheetData['„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´'] !== '') {
                let rawMainVisual = spreadsheetData['„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´'];

                // Google Drive URL„ÇíthumbnailÂΩ¢Âºè„Å´Â§âÊèõ
                if (rawMainVisual.includes('drive.google.com') && rawMainVisual.includes('uc?export=view')) {
                    const idMatch = rawMainVisual.match(/[?&]id=([^&]+)/);
                    const driveId = idMatch ? idMatch[1] : null;

                    if (driveId) {
                        mainVisual = `https://drive.google.com/thumbnail?id=${driveId}&sz=w800`;
                        console.log('[previewCompanyInfo] Converted Drive URL to thumbnail:', mainVisual);
                    } else {
                        mainVisual = rawMainVisual;
                    }
                } else {
                    mainVisual = rawMainVisual;
                }

                console.log('[previewCompanyInfo] Using spreadsheet main visual:', mainVisual);
            }
            // 2. Á∑®ÈõÜ„É¢„Éº„Éâ„Åß„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åï„Çå„ÅüÁîªÂÉè„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            else if (window.mainVisualDisplayUrl && window.mainVisualDisplayUrl !== '') {
                mainVisual = window.mainVisualDisplayUrl;
                console.log('[previewCompanyInfo] Using edited main visual:', mainVisual);
            }
            // 3. „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: ÁèæÂú®Ë°®Á§∫„Åï„Çå„Å¶„ÅÑ„Çã„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´ÁîªÂÉè„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            else {
                const currentMainVisual = document.getElementById('mainVisualImage');
                if (currentMainVisual && currentMainVisual.src && !currentMainVisual.src.includes('data:,')) {
                    mainVisual = currentMainVisual.src;
                    console.log('[previewCompanyInfo] Using current mainVisualImage src as fallback:', mainVisual);
                }
            }

            console.log('[previewCompanyInfo] window.mainVisualDisplayUrl:', window.mainVisualDisplayUrl);
            console.log('[previewCompanyInfo] mainVisualDisplayUrl (global):', mainVisualDisplayUrl);
            console.log('[previewCompanyInfo] mainVisualImage element:', document.getElementById('mainVisualImage'));
            console.log('[previewCompanyInfo] Final mainVisual src:', mainVisual);
            console.log('[previewCompanyInfo] Condition check - mainVisual exists:', !!mainVisual);
            console.log('[previewCompanyInfo] Condition check - not empty string:', mainVisual !== '');
            console.log('[previewCompanyInfo] Condition check - not data URL:', !mainVisual.includes('data:,'));
            console.log('[previewCompanyInfo] Full condition result:', mainVisual && mainVisual !== '' && !mainVisual.includes('data:,'));
            if (mainVisual && mainVisual !== '' && !mainVisual.includes('data:,')) {
                console.log('[previewCompanyInfo] Setting previewMainVisual src to:', mainVisual);

                const previewMainVisualElement = document.getElementById('previewMainVisual');
                const mainVisualSectionElement = document.getElementById('previewMainVisualSection');
                const heroSectionElement = document.getElementById('heroSection');

                console.log('[previewCompanyInfo] Elements check:');
                console.log('  previewMainVisual:', !!previewMainVisualElement);
                console.log('  mainVisualSection:', !!mainVisualSectionElement);
                console.log('  heroSection:', !!heroSectionElement);

                if (previewMainVisualElement) {
                    console.log('[previewCompanyInfo] Setting image src...');
                    previewMainVisualElement.src = mainVisual;

                    // ÁîªÂÉè„É≠„Éº„ÉâÂÆå‰∫Ü„ÇíÂæÖ„Å§
                    previewMainVisualElement.onload = function() {
                        console.log('[previewCompanyInfo] Image loaded successfully:', mainVisual);

                        // ÁîªÂÉè„É≠„Éº„ÉâÂæå„Å´‰ΩçÁΩÆ„Éª„Ç∫„Éº„É†Ë®≠ÂÆö„ÇíÂÜçÈÅ©Áî®
                        if (typeof imagePositionX !== 'undefined' && typeof imagePositionY !== 'undefined' && typeof currentZoom !== 'undefined') {
                            updateImagePosition();
                            console.log('[previewCompanyInfo] Applied position & zoom after image load:', imagePositionX, imagePositionY, currentZoom);
                        }
                    };

                    previewMainVisualElement.onerror = function() {
                        console.error('[previewCompanyInfo] Image failed to load:', mainVisual);
                    };

                    console.log('[previewCompanyInfo] Current img src after setting:', previewMainVisualElement.src);
                }

                if (mainVisualSectionElement) {
                    mainVisualSectionElement.classList.remove('hidden');
                    mainVisualSectionElement.classList.add('block');
                    console.log('[previewCompanyInfo] mainVisualSection hidden class removed, block class added');
                    console.log('[previewCompanyInfo] mainVisualSection classes:', mainVisualSectionElement.className);
                    console.log('[previewCompanyInfo] mainVisualSection computed style:', window.getComputedStyle(mainVisualSectionElement).display);
                }

                if (heroSectionElement) {
                    heroSectionElement.style.display = 'none';
                }

                console.log('[previewCompanyInfo] mainVisualSection display setting complete');
            } else {
                console.log('[previewCompanyInfo] No main visual, hiding previewMainVisualSection');
                const mainVisualSectionElement = document.getElementById('previewMainVisualSection');
                if (mainVisualSectionElement) {
                    mainVisualSectionElement.classList.add('hidden');
                    mainVisualSectionElement.classList.remove('block');
                }
                document.getElementById('heroSection').style.display = 'block';
            }

            // Ë≥áÊ†º„ÇíË°®Á§∫
            const qualificationsList = document.getElementById('qualificationsList');
            if (qualificationsList) {
                qualificationsList.innerHTML = '';
                // „ÉÅ„Çß„ÉÉ„ÇØ„Åï„Çå„ÅüË≥áÊ†º„ÇíÂèñÂæó
                const checkedQualifications = companySection.querySelectorAll('input[name="qualifications"]:checked');
                checkedQualifications.forEach(qual => {
                    const div = document.createElement('div');
                    div.className = 'bg-purple-50 border border-purple-200 rounded-lg p-3 flex items-center';
                    div.innerHTML = `
                        <span class="text-2xl mr-2">üéñÔ∏è</span>
                        <span class="text-sm font-medium">${qual.value}</span>
                    `;
                    qualificationsList.appendChild(div);
                });
                // „Ç´„Çπ„Çø„É†Ë≥áÊ†º„ÇíËøΩÂä†
                const customQuals = document.querySelectorAll('#customQualificationsList > div');
                customQuals.forEach(qual => {
                    const qualText = qual.querySelector('span').textContent;
                    const div = document.createElement('div');
                    div.className = 'bg-purple-50 border border-purple-200 rounded-lg p-3 flex items-center';
                    div.innerHTML = `
                        <span class="text-2xl mr-2">üéñÔ∏è</span>
                        <span class="text-sm font-medium">${qualText}</span>
                    `;
                    qualificationsList.appendChild(div);
                });
                // Ë≥áÊ†º„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„Åø„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
                const qualSection = document.getElementById('preview-qualifications');
                if (qualSection) {
                    qualSection.style.display = qualificationsList.children.length > 0 ? 'block' : 'none';
                }
            }

            // ‰øùÈô∫„ÇíË°®Á§∫
            const insuranceList = document.getElementById('insuranceList');
            if (insuranceList) {
                insuranceList.innerHTML = '';
                // „ÉÅ„Çß„ÉÉ„ÇØ„Åï„Çå„Åü‰øùÈô∫„ÇíÂèñÂæó
                const checkedInsurance = companySection.querySelectorAll('input[name="insurance"]:checked');
                checkedInsurance.forEach(ins => {
                    const div = document.createElement('div');
                    div.className = 'bg-indigo-50 border border-indigo-200 rounded-lg p-3 flex items-center';
                    div.innerHTML = `
                        <span class="text-2xl mr-2">üõ°Ô∏è</span>
                        <span class="text-sm font-medium">${ins.value}</span>
                    `;
                    insuranceList.appendChild(div);
                });
                // „Ç´„Çπ„Çø„É†‰øùÈô∫„ÇíËøΩÂä†
                const customInsurance = document.querySelectorAll('#customInsuranceList > div');
                customInsurance.forEach(ins => {
                    const insText = ins.querySelector('span').textContent;
                    const div = document.createElement('div');
                    div.className = 'bg-indigo-50 border border-indigo-200 rounded-lg p-3 flex items-center';
                    div.innerHTML = `
                        <span class="text-2xl mr-2">üõ°Ô∏è</span>
                        <span class="text-sm font-medium">${insText}</span>
                    `;
                    insuranceList.appendChild(div);
                });
                // ‰øùÈô∫„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„Åø„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
                const insSection = document.getElementById('preview-insurance');
                if (insSection) {
                    insSection.style.display = insuranceList.children.length > 0 ? 'block' : 'none';
                }
            }

            // ÂØæÂøúÂèØËÉΩ„Å™Â∑•‰∫ã„ÇíË°®Á§∫
            const previewServicesList = document.getElementById('previewServicesList');
            const serviceIconMap = {
                'Â§ñÂ£ÅÂ°óË£Ö': 'üé®',
                'Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï': 'üèóÔ∏è',
                'Â§ñÂ£ÅÂºµÊõø„Åà': 'üî®',
                'Â±ãÊ†πÂ°óË£ÖÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üè†',
                'Â±ã‰∏äÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üíß',
                'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚Äª„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠â': 'üèöÔ∏è',
                'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚ÄªÁì¶': 'üèØ',
                'Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï': 'üìê',
                'Â§ñÂ£ÅË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üîß',
                'Â±ãÊ†πË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üõ†Ô∏è',
                '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üåä'
            };

            if (previewServicesList) {
                previewServicesList.innerHTML = '';
                const checkedServices = document.querySelectorAll('input[name="constructionTypes"]:checked');

                if (checkedServices.length > 0) {
                    checkedServices.forEach(service => {
                        const serviceName = service.value;

                        // ÂçòÂìÅÈ†ÖÁõÆÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ„Çí„Éó„É¨„Éì„É•„Éº„Åã„ÇâÈô§Â§ñ
                        if (serviceName.includes('Ôºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ')) {
                            return;
                        }

                        // Ë°®Á§∫Âêç„Åã„ÇâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ„ÇíÂâäÈô§
                        const displayName = serviceName.replace('ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ', '');
                        const icon = serviceIconMap[serviceName] || '‚úì';
                        const div = document.createElement('div');
                        div.className = 'bg-white border border-green-200 rounded-lg p-3 flex items-center hover:shadow-md transition';
                        div.innerHTML = `
                            <span class="text-2xl mr-2">${icon}</span>
                            <span class="text-sm font-medium text-gray-800">${displayName}</span>
                        `;
                        previewServicesList.appendChild(div);
                    });
                    document.getElementById('preview-services').style.display = 'block';
                } else {
                    document.getElementById('preview-services').style.display = 'none';
                }
            }

            // ÂØæÂøú„Ç®„É™„Ç¢„ÇíË°®Á§∫
            console.log('[previewCompanyInfo] üöÄ ÂØæÂøú„Ç®„É™„Ç¢Ë°®Á§∫Âá¶ÁêÜÈñãÂßã');
            console.log('[previewCompanyInfo] window.areaSelectionData:', window.areaSelectionData);
            const previewCitiesContainer = document.getElementById('previewCitiesContainer');
            const areasSection = document.getElementById('preview-areas');

            if (previewCitiesContainer) {
                previewCitiesContainer.innerHTML = '';

                // „Éá„Éº„Çø„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥Âêà„ÅÆË°®Á§∫
                if (window.areaSelectionData && window.areaSelectionData.prefectures && window.areaSelectionData.prefectures.length > 0) {
                    console.log('[previewCompanyInfo] ÂØæÂøú„Ç®„É™„Ç¢„Éá„Éº„ÇøÁô∫Ë¶ã:', window.areaSelectionData.prefectures.length, 'ÈÉΩÈÅìÂ∫úÁúå');
                    console.log('[previewCompanyInfo] ÈÉΩÈÅìÂ∫úÁúå‰∏ÄË¶ß:', window.areaSelectionData.prefectures);
                    console.log('[previewCompanyInfo] Â∏ÇÂå∫Áî∫Êùë„Éá„Éº„Çø:', window.areaSelectionData.cities);

                    let hasAnyCities = false;
                    // „Åæ„ÅöÂ∏ÇÂå∫Áî∫Êùë„Éá„Éº„Çø„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                    window.areaSelectionData.prefectures.forEach(pref => {
                        const cities = window.areaSelectionData.cities[pref];
                        if (cities && cities.length > 0) {
                            hasAnyCities = true;
                        }
                    });

                    if (hasAnyCities) {
                        // Â∏ÇÂå∫Áî∫Êùë„Éá„Éº„Çø„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆË°®Á§∫
                        window.areaSelectionData.prefectures.forEach((pref, index) => {
                            const cities = window.areaSelectionData.cities[pref];
                            if (cities && cities.length > 0) {
                                const prefDiv = document.createElement('div');
                                prefDiv.className = index < window.areaSelectionData.prefectures.length - 1 ? 'mb-6 pb-6 border-b border-gray-200' : 'mb-0';
                            prefDiv.innerHTML = `
                                <div class="flex items-center mb-3">
                                    <span class="text-base font-bold text-blue-600">${pref}</span>
                                </div>
                                <div class="flex flex-wrap gap-2">
                                    ${cities.map(city => `<span class="px-3 py-1.5 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg text-sm transition">${city}</span>`).join('')}
                                </div>
                            `;
                            previewCitiesContainer.appendChild(prefDiv);
                        }
                        });
                    } else {
                        // ÈÉΩÈÅìÂ∫úÁúå„Éá„Éº„Çø„ÅØ„ÅÇ„Çã„ÅåÂ∏ÇÂå∫Áî∫Êùë„Éá„Éº„Çø„Åå„Å™„ÅÑÂ†¥Âêà
                        console.log('[previewCompanyInfo] ÈÉΩÈÅìÂ∫úÁúå„Éá„Éº„Çø„ÅÇ„Çä„ÄÅÂ∏ÇÂå∫Áî∫Êùë„Éá„Éº„Çø„Å™„Åó');
                        const prefDiv = document.createElement('div');
                        prefDiv.innerHTML = `
                            <div class="text-center py-6 text-gray-600">
                                <div class="text-lg mb-3">üìç</div>
                                <p class="text-sm font-medium mb-2">ÂØæÂøúÈÉΩÈÅìÂ∫úÁúå</p>
                                <div class="flex flex-wrap gap-2 justify-center">
                                    ${window.areaSelectionData.prefectures.map(pref =>
                                        `<span class="px-3 py-1.5 bg-blue-50 text-blue-700 rounded-lg text-sm">${pref}</span>`
                                    ).join('')}
                                </div>
                            </div>
                        `;
                        previewCitiesContainer.appendChild(prefDiv);
                    }

                    if (areasSection) {
                        areasSection.style.display = 'block';
                    }
                } else {
                    // „Éá„Éº„Çø„Åå„Å™„ÅÑÂ†¥Âêà„ÅÆ„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„ÉºË°®Á§∫
                    console.log('[previewCompanyInfo] ÂØæÂøú„Ç®„É™„Ç¢„Éá„Éº„Çø„Å™„Åó');
                    console.log('[previewCompanyInfo] prefectures:', window.areaSelectionData?.prefectures);
                    console.log('[previewCompanyInfo] cities:', window.areaSelectionData?.cities);
                    previewCitiesContainer.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <div class="text-lg mb-2">üìç</div>
                            <p class="text-sm">ÂØæÂøú„Ç®„É™„Ç¢„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                            <p class="text-xs mt-1">Ë®≠ÂÆöÁîªÈù¢„Åã„ÇâÈÉΩÈÅìÂ∫úÁúå„ÉªÂ∏ÇÂå∫Áî∫Êùë„ÇíÈÅ∏Êäû„Åß„Åç„Åæ„Åô</p>
                        </div>
                    `;

                    if (areasSection) {
                        areasSection.style.display = 'block';
                    }
                }
            }

            // ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ„ÇíË°®Á§∫
            const previewFeaturesList = document.getElementById('previewFeaturesList');
            if (previewFeaturesList) {
                previewFeaturesList.innerHTML = '';
                const checkedSpecialServices = document.querySelectorAll('input[name="specialServices"]:checked');
                const excludeItems = ['Á´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÊâãÊ∏°„ÅóÂ∏åÊúõ', 'ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÈÉµÈÄÅ„ÉªÈõªË©±„ÅßÂïÜË´áÂèØ'];

                const colors = [
                    'from-blue-50 to-blue-100',
                    'from-purple-50 to-purple-100',
                    'from-green-50 to-green-100',
                    'from-pink-50 to-pink-100',
                    'from-yellow-50 to-yellow-100',
                    'from-indigo-50 to-indigo-100'
                ];

                let colorIndex = 0;
                checkedSpecialServices.forEach(service => {
                    const serviceText = service.value;
                    // Èô§Â§ñÈ†ÖÁõÆ„Çí„Çπ„Ç≠„ÉÉ„Éó
                    if (excludeItems.some(item => serviceText.includes(item))) {
                        return;
                    }

                    // ÁµµÊñáÂ≠ó„Å®„ÉÜ„Ç≠„Çπ„Éà„ÇíÂàÜÈõ¢
                    const parts = serviceText.split(' ');
                    const emoji = parts[0];
                    const text = parts.slice(1).join(' ');

                    const div = document.createElement('div');
                    div.className = `bg-gradient-to-br ${colors[colorIndex % colors.length]} rounded-xl p-4`;
                    div.innerHTML = `
                        <div class="text-3xl mb-2">${emoji}</div>
                        <h4 class="font-semibold text-gray-900 mb-1">${text}</h4>
                    `;
                    previewFeaturesList.appendChild(div);
                    colorIndex++;
                });

                // Âº∑„Åø„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„Åø„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
                const featuresSection = document.getElementById('preview-features');
                if (featuresSection) {
                    featuresSection.style.display = previewFeaturesList.children.length > 0 ? 'block' : 'none';
                }
            }

            // „É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
            document.getElementById('companyPreviewModal').classList.remove('hidden');

            // „É¢„Éº„ÉÄ„É´Ë°®Á§∫Âæå„Å´„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„ÇíÂÜçË®≠ÂÆöÔºà„Çø„Ç§„Éü„É≥„Ç∞ÂïèÈ°å„ÇíËß£Ê±∫Ôºâ
            if (mainVisual && mainVisual !== '' && !mainVisual.includes('data:,')) {
                setTimeout(() => {
                    const previewMainVisualElement = document.getElementById('previewMainVisual');
                    const mainVisualSectionElement = document.getElementById('previewMainVisualSection');
                    const heroSectionElement = document.getElementById('heroSection');

                    console.log('[previewCompanyInfo] „É¢„Éº„ÉÄ„É´Ë°®Á§∫Âæå„ÅÆ„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´ÂÜçË®≠ÂÆö');

                    if (previewMainVisualElement) {
                        previewMainVisualElement.src = mainVisual;
                        console.log('[previewCompanyInfo] ModalÂæå - Image src set to:', mainVisual);
                    }

                    if (mainVisualSectionElement) {
                        mainVisualSectionElement.classList.remove('hidden');
                        mainVisualSectionElement.classList.add('block');
                        console.log('[previewCompanyInfo] ModalÂæå - mainVisualSection classes:', mainVisualSectionElement.className);
                        console.log('[previewCompanyInfo] ModalÂæå - computed display:', window.getComputedStyle(mainVisualSectionElement).display);
                    }

                    if (heroSectionElement) {
                        heroSectionElement.style.display = 'none';
                    }
                }, 50);
            }

            // Ë°®Á§∫„Ç™„Éó„Ç∑„Éß„É≥„ÇíÂ∏∏„Å´Ë°®Á§∫ÔºàÂ±ãÂè∑„Åå„Å™„Åè„Å¶„ÇÇË®≠ÂÆöÂèØËÉΩÔºâ
            const tradeNameOptions = document.getElementById('previewTradeNameOptions');
            const sidebarCompanyDisplaySettings = document.getElementById('companyNameDisplaySettings');

            // „Éó„É¨„Éì„É•„Éº„Ç™„Éó„Ç∑„Éß„É≥„ÅØÂ±ãÂè∑„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„ÅøË°®Á§∫
            if (tradeName) {
                tradeNameOptions.style.display = 'block';
            } else {
                tradeNameOptions.style.display = 'none';
            }

            // „Çµ„Ç§„Éâ„Éê„Éº„ÅÆË®≠ÂÆö„ÅØÂ∏∏„Å´Ë°®Á§∫
            if (sidebarCompanyDisplaySettings) {
                sidebarCompanyDisplaySettings.style.display = 'block';
            }

            // Â±ãÂè∑„ÅÆÂÄ§„Çí‰øùÂ≠òÔºàupdatePreviewCompanyNameÁî®Ôºâ
            window.currentTradeName = tradeName;
            window.currentCompanyName = companyName;

            // „Éâ„É©„ÉÉ„Ç∞Ê©üËÉΩ„ÇíÂàùÊúüÂåñ
            setTimeout(initImageDrag, 100);

            // Google„Éû„ÉÉ„Éó„ÇíË™≠„ÅøËæº„Åø
            setTimeout(loadGoogleMap, 200);

            // üöÄ ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº: „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„Å®Âêå„Åò„Éë„Çø„Éº„É≥„Åßwindow.galleryImages„Çí‰ΩøÁî®
            console.log('[previewCompanyInfo] üöÄ ÂÜôÁúü„ÇÆ„É£„É©„É™„ÉºÂá¶ÁêÜÈñãÂßã - window.galleryImages:', (window.galleryImages || []).length);

            // window.galleryImages„ÅåÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà„ÅÆ„ÅøDOM„Åã„ÇâÂèéÈõÜ
            if (!window.galleryImages || window.galleryImages.length === 0) {
                const galleryList = document.getElementById('photoGalleryList');
                console.log('[previewCompanyInfo] window.galleryImagesÁ©∫ - DOM„Åã„ÇâÂèéÈõÜ. galleryList:', galleryList);
                window.galleryImages = [];
                if (galleryList) {
                    const images = galleryList.querySelectorAll('img');
                    console.log('[previewCompanyInfo] DOMÂÜÖÁîªÂÉèÁô∫Ë¶ã:', images.length);
                    images.forEach((img, index) => {
                        if (img.src && img.src !== '' && !img.src.includes('data:,')) {
                            console.log('[previewCompanyInfo] „ÇÆ„É£„É©„É™„ÉºÁîªÂÉè', index, ':', img.src);
                            window.galleryImages.push({
                                src: img.src,
                                name: img.alt || `„ÇÆ„É£„É©„É™„ÉºÁîªÂÉè${index + 1}`
                            });
                        }
                    });
                }
            }
            console.log('[previewCompanyInfo] üöÄ ÊúÄÁµÇ„ÇÆ„É£„É©„É™„ÉºÁîªÂÉèÊï∞:', (window.galleryImages || []).length);

            // ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„Å®ÊñΩÂ∑•‰∫ã‰æã„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
            updateGalleryPreview();
            updateExamplesPreview();

            // „Éó„É¨„Éì„É•„ÉºË®≠ÂÆö„ÇíË™≠„ÅøËæº„Çì„ÅßÈÅ©Áî®
            await loadPreviewSettings();

            // „Éá„Éº„Çø„ÅåÁ©∫„ÅÆÂ†¥Âêà„ÅÆÂà∂Âæ°
            console.log('[previewCompanyInfo] „Éá„Éº„Çø„ÉÅ„Çß„ÉÉ„ÇØÈñãÂßã');
            console.log('[previewCompanyInfo] companyName:', companyName);
            console.log('[previewCompanyInfo] mainVisual:', mainVisual);
            console.log('[previewCompanyInfo] spreadsheetData keys:', Object.keys(spreadsheetData));

            // ÈáçË¶Å„Å™„Éá„Éº„Çø„ÅåÂÖ®„Å¶Á©∫„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            const hasCompanyName = companyName && companyName.trim() !== '';
            const hasMainVisual = mainVisual && mainVisual !== '' && !mainVisual.includes('data:,');
            const hasSpreadsheetData = Object.keys(spreadsheetData).length > 0;

            console.log('[previewCompanyInfo] „Éá„Éº„ÇøÁä∂Ê≥Å:');
            console.log('  hasCompanyName:', hasCompanyName);
            console.log('  hasMainVisual:', hasMainVisual);
            console.log('  hasSpreadsheetData:', hasSpreadsheetData);

            // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅåÁ©∫„Åß„ÄÅÁ∑®ÈõÜ„É¢„Éº„Éâ„Åß„ÇÇÂü∫Êú¨„Éá„Éº„Çø„Åå„Å™„ÅÑÂ†¥Âêà
            if (!hasSpreadsheetData && !hasCompanyName) {
                console.log('[previewCompanyInfo] „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅåÁ©∫„ÅßÂü∫Êú¨„Éá„Éº„Çø„Å™„Åó - „Éá„Éï„Ç©„É´„ÉàÁä∂ÊÖã„Å´Âà∂Âæ°');

                // „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈùûË°®Á§∫
                const mainVisualSectionElement = document.getElementById('previewMainVisualSection');
                if (mainVisualSectionElement) {
                    mainVisualSectionElement.classList.add('hidden');
                    mainVisualSectionElement.classList.remove('block');
                }

                // „Éí„Éº„É≠„Éº„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
                const heroSectionElement = document.getElementById('heroSection');
                if (heroSectionElement) {
                    heroSectionElement.style.display = 'block';
                }
            }

        }

        // „Éó„É¨„Éì„É•„Éº„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closePreviewModal() {
            document.getElementById('companyPreviewModal').classList.add('hidden');
        }

        // „Éó„É¨„Éì„É•„Éº„Åã„Çâ‰øùÂ≠òÔºà„Éó„É¨„Éì„É•„ÉºË®≠ÂÆö„ÅÆ„Åø‰øùÂ≠òÔºâ
        async function saveFromPreview() {
            console.log('[saveFromPreview] „Éó„É¨„Éì„É•„ÉºË®≠ÂÆö„ÅÆ‰øùÂ≠òÈñãÂßã');

            if (!window.merchantId) {
                alert('„Ç®„É©„Éº: merchantId„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ„É≠„Ç∞„Ç§„É≥„ÅóÁõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                console.error('[saveFromPreview] merchantId„ÅåÊú™Ë®≠ÂÆö');
                return;
            }

            const saveButton = event.target.closest('button');
            if (!saveButton) {
                console.error('[saveFromPreview] ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }

            saveButton.disabled = true;
            const originalHTML = saveButton.innerHTML;
            saveButton.innerHTML = '<svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> ‰øùÂ≠ò‰∏≠...';

            try {
                // ‰ºöÁ§æÂêçË°®Á§∫Ë®≠ÂÆö„ÇíÂèñÂæó
                const displaySelect = document.getElementById('previewCompanyDisplaySelect');
                const companyNameDisplay = displaySelect ? displaySelect.value : 'company';

                // „Éó„É¨„Éì„É•„ÉºË®≠ÂÆö„ÅÆ„Åø„Çí‰øùÂ≠ò
                const previewData = {
                    imagePositionX: imagePositionX,
                    imagePositionY: imagePositionY,
                    imageZoom: currentZoom,
                    imageBrightness: document.getElementById('imageOpacity')?.value || 100,
                    textColor: currentTextColor,
                    companyNameDisplay: companyNameDisplay
                };

                console.log('[saveFromPreview] „Éó„É¨„Éì„É•„ÉºË®≠ÂÆö:', previewData);

                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'savePreviewSettings',
                        merchantId: window.merchantId,
                        previewSettings: previewData
                    })
                });

                const result = await response.json();
                console.log('[saveFromPreview] ‰øùÂ≠òÁµêÊûú:', result);

                if (result.success) {
                    // „Éó„É¨„Éì„É•„ÉºË®≠ÂÆö‰øùÂ≠òÊàêÂäüÂæå„ÄÅHPÊõ¥Êñ∞„Éª„Éá„Éó„É≠„Ç§„ÇíÂÆüË°å
                    console.log('[saveFromPreview] „Éó„É¨„Éì„É•„ÉºË®≠ÂÆö‰øùÂ≠òÂÆå‰∫Ü„ÄÅHPÊõ¥Êñ∞ÈñãÂßã');

                    try {
                        // URL„Çπ„É©„ÉÉ„Ç∞„ÇíÂèñÂæóÔºàÂøÖÈ†à„Éë„É©„É°„Éº„ÇøÔºâ
                        if (!currentMerchantUrlSlug) {
                            console.error('[saveFromPreview] URL„Çπ„É©„ÉÉ„Ç∞„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                            showToast('URL„Çπ„É©„ÉÉ„Ç∞„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åü„ÇÅ„ÄÅHPÊõ¥Êñ∞„Åß„Åç„Åæ„Åõ„Çì', 'error');
                            return;
                        }

                        const hpResponse = await fetch(GAS_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'text/plain' },
                            body: JSON.stringify({
                                action: 'updateMerchantUrlAndPreviewHp',
                                merchantId: window.merchantId,
                                urlSlug: currentMerchantUrlSlug
                            })
                        });

                        const hpResult = await hpResponse.json();
                        console.log('[saveFromPreview] HPÊõ¥Êñ∞ÁµêÊûú:', hpResult);

                        if (hpResult.success) {
                            // HPÊõ¥Êñ∞ÊàêÂäüÂæå„ÄÅFTPÂêåÊúü„ÇíÂÆüË°å
                            console.log('[saveFromPreview] FTPÂêåÊúüÈñãÂßã');

                            try {
                                const ftpResponse = await fetch(GAS_URL, {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'text/plain' },
                                    body: JSON.stringify({
                                        action: 'triggerFTPSync'
                                    })
                                });

                                const ftpResult = await ftpResponse.json();
                                console.log('[saveFromPreview] FTPÂêåÊúüÁµêÊûú:', ftpResult);

                                if (ftpResult.success) {
                                    showNotification('ÂÖ¨ÈñãÂÆå‰∫Ü', `HP„ÇíÊõ¥Êñ∞„Åó„ÄÅ„Çµ„Éº„Éê„Éº„Å´ÂÖ¨Èñã„Åó„Åæ„Åó„Åü<br><a href="${hpResult.fullUrl}" target="_blank" class="text-blue-600 underline">ÂÖ¨Èñã„Åï„Çå„ÅüHP„ÇíÁ¢∫Ë™ç</a>`);
                                } else {
                                    showNotification('ÈÉ®ÂàÜÊàêÂäü', `HP„ÅØÊõ¥Êñ∞„Åï„Çå„Åæ„Åó„Åü„Åå„ÄÅ„Çµ„Éº„Éê„ÉºÂÖ¨Èñã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇÊï∞ÂàÜÂæå„Å´Ëá™ÂãïÂÖ¨Èñã„Åï„Çå„Åæ„Åô<br><a href="${hpResult.fullUrl}" target="_blank" class="text-blue-600 underline">HP„ÇíÁ¢∫Ë™ç</a>`, 'warning');
                                }
                            } catch (ftpError) {
                                console.error('[saveFromPreview] FTPÂêåÊúü„Ç®„É©„Éº:', ftpError);
                                showNotification('ÈÉ®ÂàÜÊàêÂäü', `HP„ÅØÊõ¥Êñ∞„Åï„Çå„Åæ„Åó„Åü„Åå„ÄÅ„Çµ„Éº„Éê„ÉºÂÖ¨Èñã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇÊï∞ÂàÜÂæå„Å´Ëá™ÂãïÂÖ¨Èñã„Åï„Çå„Åæ„Åô<br><a href="${hpResult.fullUrl}" target="_blank" class="text-blue-600 underline">HP„ÇíÁ¢∫Ë™ç</a>`, 'warning');
                            }
                        } else {
                            showNotification('ÈÉ®ÂàÜÊàêÂäü', `„Éó„É¨„Éì„É•„ÉºË®≠ÂÆö„ÅØ‰øùÂ≠ò„Åï„Çå„Åæ„Åó„Åü„Åå„ÄÅHPÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${hpResult.error}`, 'warning');
                        }
                    } catch (hpError) {
                        console.error('[saveFromPreview] HPÊõ¥Êñ∞„Ç®„É©„Éº:', hpError);
                        showNotification('ÈÉ®ÂàÜÊàêÂäü', `„Éó„É¨„Éì„É•„ÉºË®≠ÂÆö„ÅØ‰øùÂ≠ò„Åï„Çå„Åæ„Åó„Åü„Åå„ÄÅHPÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${hpError.message}`, 'warning');
                    }
                } else {
                    showNotification('„Ç®„É©„Éº', '‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + (result.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'), 'error');
                }
            } catch (error) {
                console.error('[saveFromPreview] „Ç®„É©„Éº:', error);
                showNotification('„Ç®„É©„Éº', '‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
            } finally {
                saveButton.disabled = false;
                saveButton.innerHTML = originalHTML;
            }
        }

        // „Éó„É¨„Éì„É•„ÉºË®≠ÂÆö„ÅÆ„Åø„Çí‰øùÂ≠òÔºàHPÊõ¥Êñ∞„Å™„ÅóÔºâ
        async function savePreviewSettingsOnly() {
            console.log('[savePreviewSettingsOnly] „Éó„É¨„Éì„É•„ÉºË®≠ÂÆö„ÅÆ‰øùÂ≠òÈñãÂßãÔºàHPÊõ¥Êñ∞„Å™„ÅóÔºâ');

            if (!window.merchantId) {
                alert('„Ç®„É©„Éº: merchantId„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ„É≠„Ç∞„Ç§„É≥„ÅóÁõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                console.error('[savePreviewSettingsOnly] merchantId„ÅåÊú™Ë®≠ÂÆö');
                return;
            }

            try {
                // ‰ºöÁ§æÂêçË°®Á§∫Ë®≠ÂÆö„ÇíÂèñÂæó
                const displaySelect = document.getElementById('previewCompanyDisplaySelect');
                const companyNameDisplay = displaySelect ? displaySelect.value : 'company';

                // „Éó„É¨„Éì„É•„ÉºË®≠ÂÆö„ÅÆ„Åø„Çí‰øùÂ≠ò
                const previewData = {
                    imagePositionX: imagePositionX,
                    imagePositionY: imagePositionY,
                    imageZoom: currentZoom,
                    imageBrightness: document.getElementById('imageOpacity')?.value || 100,
                    textColor: currentTextColor,
                    companyNameDisplay: companyNameDisplay
                };

                console.log('[savePreviewSettingsOnly] „Éó„É¨„Éì„É•„ÉºË®≠ÂÆö:', previewData);

                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'savePreviewSettings',
                        merchantId: window.merchantId,
                        previewSettings: previewData
                    })
                });

                const result = await response.json();
                console.log('[savePreviewSettingsOnly] ‰øùÂ≠òÁµêÊûú:', result);

                if (result.success) {
                    showToast('„Éó„É¨„Éì„É•„ÉºË®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü', 'success');
                } else {
                    showToast('‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + (result.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'), 'error');
                }
            } catch (error) {
                console.error('[savePreviewSettingsOnly] „Ç®„É©„Éº:', error);
                showToast('‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
            }
        }

        // „Éó„É¨„Éì„É•„ÉºË®≠ÂÆö„ÇíË™≠„ÅøËæº„Åø
        async function loadPreviewSettings() {
            try {
                if (!window.merchantId) {
                    applyDefaultPreviewSettings();
                    return;
                }

                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'getPreviewSettings',
                        merchantId: window.merchantId
                    })
                });

                const result = await response.json();

                if (result.success && result.settings) {
                    const settings = result.settings;

                    imagePositionX = settings.imagePositionX !== undefined && settings.imagePositionX !== '' ? settings.imagePositionX : 50;
                    imagePositionY = settings.imagePositionY !== undefined && settings.imagePositionY !== '' ? settings.imagePositionY : 50;
                    currentZoom = settings.imageZoom !== undefined && settings.imageZoom !== '' ? settings.imageZoom : 100;

                    // ‰ΩçÁΩÆ„Çπ„É©„Ç§„ÉÄ„Éº„ÅÆÂÄ§„ÇíÊõ¥Êñ∞
                    const positionXSlider = document.getElementById('imagePositionX');
                    if (positionXSlider) {
                        positionXSlider.value = imagePositionX;
                    }

                    const positionYSlider = document.getElementById('imagePositionY');
                    if (positionYSlider) {
                        positionYSlider.value = imagePositionY;
                    }

                    // „Ç∫„Éº„É†„Çπ„É©„Ç§„ÉÄ„Éº„ÅÆÂÄ§„ÇíÊõ¥Êñ∞
                    const zoomSlider = document.getElementById('imageZoom');
                    if (zoomSlider) {
                        zoomSlider.value = currentZoom;
                    }

                    // Êòé„Çã„Åï„Çπ„É©„Ç§„ÉÄ„Éº„ÅÆÂÄ§„ÇíÊõ¥Êñ∞
                    const opacitySlider = document.getElementById('imageOpacity');
                    if (opacitySlider) {
                        opacitySlider.value = settings.imageBrightness !== undefined && settings.imageBrightness !== '' ? settings.imageBrightness : 100;
                    }

                    // ÊñáÂ≠óËâ≤„ÇíÂèçÊò†Ôºà„Éî„ÉÉ„Ç´„Éº„Å®„Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„ÇíÊõ¥Êñ∞Ôºâ
                    const textColor = settings.textColor || '#000000';
                    currentTextColor = textColor;
                    const colorPicker = document.getElementById('textColorPicker');
                    if (colorPicker) {
                        colorPicker.value = textColor;
                    }

                    // ‰ºöÁ§æÂêçË°®Á§∫Ë®≠ÂÆö„ÇíÂèçÊò†
                    const companyNameDisplay = settings.companyNameDisplay || 'company';

                    // „Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÇíË®≠ÂÆö
                    const displaySelect = document.getElementById('previewCompanyDisplaySelect');
                    if (displaySelect) {
                        displaySelect.value = companyNameDisplay;
                    }

                    // Ë®≠ÂÆö„ÅØÂ§âÊï∞„Å´‰øùÂ≠òÊ∏à„Åø„ÄÇÁîªÂÉèonload„Ç§„Éô„É≥„Éà„ÅßÈÅ©Áî®„Åï„Çå„Çã„ÄÇ

                    // Êòé„Çã„Åï„ÅØ‰øùÂ≠ò„Åï„Çå„ÅüÂÄ§„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„ÅøÈÅ©Áî®ÔºàËá™ÂãïË®≠ÂÆö„Åó„Å™„ÅÑÔºâ
                    if (settings.imageBrightness !== undefined) {
                        adjustImageOpacity(settings.imageBrightness);
                    }
                    adjustTextColor(textColor);
                    updatePreviewCompanyName();

                    console.log('[loadPreviewSettings] Ë®≠ÂÆöË™≠„ÅøËæº„ÅøÂÆå‰∫Ü:', settings);
                } else {
                    console.log('[loadPreviewSettings] ‰øùÂ≠ò„Åï„Çå„ÅüË®≠ÂÆö„Å™„Åó„ÄÅ„Éá„Éï„Ç©„É´„ÉàÂÄ§„Çí‰ΩøÁî®');
                    applyDefaultPreviewSettings();
                }
            } catch (error) {
                console.error('[loadPreviewSettings] „Ç®„É©„Éº:', error);
                applyDefaultPreviewSettings();
            }
        }

        // „Éá„Éï„Ç©„É´„Éà„ÅÆ„Éó„É¨„Éì„É•„ÉºË®≠ÂÆö„ÇíÈÅ©Áî®
        function applyDefaultPreviewSettings() {
            imagePositionX = 50;
            imagePositionY = 50;
            currentZoom = 100;
            currentTextColor = '#000000';

            const opacitySlider = document.getElementById('imageOpacity');
            if (opacitySlider) opacitySlider.value = 100;

            const colorPicker = document.getElementById('textColorPicker');
            if (colorPicker) colorPicker.value = '#000000';

            const zoomSlider = document.getElementById('imageZoom');
            if (zoomSlider) zoomSlider.value = 100;

            // ‰ºöÁ§æÂêçË°®Á§∫„Çí„Éá„Éï„Ç©„É´„ÉàÂÄ§„Å´Ë®≠ÂÆö
            const displaySelect = document.getElementById('previewCompanyDisplaySelect');
            if (displaySelect) displaySelect.value = 'company';

            updateImagePosition();
            // Êòé„Çã„Åï„ÅØËá™ÂãïË®≠ÂÆö„Åó„Å™„ÅÑÔºà„É¶„Éº„Ç∂„Éº„ÅåÊâãÂãï„ÅßË®≠ÂÆö„Åô„Çã„Åæ„ÅßËß¶„Çâ„Å™„ÅÑÔºâ
            adjustTextColor('#000000');
        }

        // „Éó„É¨„Éì„É•„ÉºË®≠ÂÆö„Éë„Éç„É´„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
        function togglePreviewSettings() {
            const settings = document.getElementById('previewSettings');
            settings.classList.toggle('hidden');
        }

        // „Éó„É¨„Éì„É•„Éº„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
        function togglePreviewSection(sectionName) {
            const section = document.getElementById('preview-' + sectionName);
            if (section) {
                section.classList.toggle('hidden');
            }

            // ‰ºöÁ§æÊ¶ÇË¶Å„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÄÅË©≥Á¥∞Ë®≠ÂÆö„ÅÆË°®Á§∫„ÇÇÂàá„ÇäÊõø„Åà
            if (sectionName === 'basicInfo') {
                const detailSettings = document.getElementById('basicInfoDetailSettings');
                if (detailSettings) {
                    if (section && section.classList.contains('hidden')) {
                        detailSettings.style.display = 'none';
                    } else {
                        detailSettings.style.display = 'block';
                    }
                }
            }
        }

        // ‰ºöÁ§æÊ¶ÇË¶Å„ÅÆÂÄãÂà•„Éï„Ç£„Éº„É´„Éâ„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
        function toggleBasicInfoField(fieldName) {
            const field = document.getElementById('basicInfo-' + fieldName);
            if (field) {
                field.classList.toggle('hidden');
            }
        }

        // ÁØâÂπ¥Êï∞ÁØÑÂõ≤„ÅÆÊõ¥Êñ∞Ôºà‰ºöÁ§æÊÉÖÂ†±Áî®Ôºâ
        function updateAgeRange() {
            const minSlider = document.querySelector('#companySection input[type="range"][min="0"][max="50"]');
            const maxSlider = document.querySelector('#companySection input[type="range"][min="0"][max="100"]');
            if (minSlider && maxSlider) {
                const minValue = parseInt(minSlider.value);
                const maxValue = parseInt(maxSlider.value);

                // ‰∏ãÈôê„Åå‰∏äÈôê„ÇíË∂Ö„Åà„Å™„ÅÑ„Çà„ÅÜ„Å´Âà∂Á¥Ñ
                if (minValue > maxValue) {
                    maxSlider.value = minValue;
                }
                if (maxValue < minValue) {
                    minSlider.value = maxValue;
                }

                const minElement = document.getElementById('ageRangeMin');
                const maxElement = document.getElementById('ageRangeMax');
                if (minElement) minElement.textContent = minSlider.value;
                if (maxElement) maxElement.textContent = maxSlider.value;
            }
        }

        // ÁØâÂπ¥Êï∞ÁØÑÂõ≤„ÅÆÊõ¥Êñ∞ÔºàËá™ÂãïÈÖç‰ø°Ë®≠ÂÆöÁî®Ôºâ
        function updateAgeRangeAuto() {
            const minSlider = document.querySelector('#autodeliverySection input[type="range"][min="0"][max="50"]');
            const maxSlider = document.querySelector('#autodeliverySection input[type="range"][min="0"][max="100"]');
            if (minSlider && maxSlider) {
                const minValue = parseInt(minSlider.value);
                const maxValue = parseInt(maxSlider.value);

                // ‰∏ãÈôê„Åå‰∏äÈôê„ÇíË∂Ö„Åà„ÅüÂ†¥Âêà„ÄÅ‰∏äÈôê„Çí‰∏ãÈôê„Å´Âêà„Çè„Åõ„Çã
                if (minValue > maxValue) {
                    maxSlider.value = minValue;
                }

                // ‰∏äÈôê„Åå‰∏ãÈôê„Çí‰∏ãÂõû„Å£„ÅüÂ†¥Âêà„ÄÅ‰∏ãÈôê„Çí‰∏äÈôê„Å´Âêà„Çè„Åõ„Çã
                if (maxValue < minValue) {
                    minSlider.value = maxValue;
                }

                const minElement = document.getElementById('ageRangeMinAuto');
                const maxElement = document.getElementById('ageRangeMaxAuto');
                if (minElement) minElement.textContent = minSlider.value;
                if (maxElement) maxElement.textContent = maxSlider.value;
            }
        }

        // „Çµ„Éº„Éì„Çπ„Ç´„Éº„Éâ„ÅÆÂàá„ÇäÊõø„Åà
        function toggleServiceCard(element) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            const card = element.querySelector('div');

            if (checkbox.checked) {
                checkbox.checked = false;
                card.classList.remove('border-blue-500', 'bg-blue-50');
            } else {
                checkbox.checked = true;
                card.classList.add('border-blue-500', 'bg-blue-50');
            }
        }

        // Êàª„Çã„Éú„Çø„É≥
        function goBack() {
            showSection('dashboard');
        }

        // Ë°®Á§∫„ÉªÈùûË°®Á§∫„ÅÆÂàá„ÇäÊõø„Åà
        function toggleVisibility(button) {
            const icon = button.querySelector('svg');
            const parent = button.closest('.border');

            if (parent.classList.contains('opacity-50')) {
                parent.classList.remove('opacity-50');
                icon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                `;
            } else {
                parent.classList.add('opacity-50');
                icon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>
                `;
            }
        }

        // „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂá¶ÁêÜÔºà„Éó„É¨„Éì„É•„Éº„ÅÆ„Åø„ÄÅ‰øùÂ≠ò„ÅØÂæå„ÅßÔºâ
        let mainVisualData = null;
        let mainVisualFileName = null;
        let mainVisualUrl = null; // ÂÖÉ„ÅÆURLÔºàuc?export=viewÂΩ¢ÂºèÔºâ
        let mainVisualDisplayUrl = null; // Ë°®Á§∫Áî®URLÔºàthumbnailÂΩ¢ÂºèÔºâ
        function handleMainVisualUpload(event) {
            const file = event.target.files[0];
            if (file) {
                console.log('[handleMainVisualUpload] File type:', file.type);

                // AVIFÁîªÂÉè„ÅÆÂ†¥Âêà„ÅØJPEG„Å´Â§âÊèõ
                if (file.type === 'image/avif' || file.type === 'image/webp') {
                    console.log('[handleMainVisualUpload] Converting AVIF/WebP to JPEG...');
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = new Image();
                        img.onload = function() {
                            // Canvas„ÅßÁîªÂÉè„ÇíÊèèÁîª„Åó„Å¶JPEG„Å´Â§âÊèõ
                            const canvas = document.createElement('canvas');
                            canvas.width = img.width;
                            canvas.height = img.height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0);

                            // JPEG„Å´Â§âÊèõÔºàÂìÅË≥™90%Ôºâ
                            mainVisualData = canvas.toDataURL('image/jpeg', 0.9);
                            mainVisualFileName = file.name.replace(/\.(avif|webp)$/i, '.jpg');

                            // „Éó„É¨„Éì„É•„ÉºË°®Á§∫
                            document.getElementById('mainVisualImage').src = mainVisualData;
                            document.getElementById('mainVisualPreview').classList.remove('hidden');
                            document.getElementById('mainVisualPlaceholder').classList.add('hidden');
                            console.log('[handleMainVisualUpload] Image converted to JPEG and ready for upload');
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                } else {
                    // JPEG/PNG/GIF„ÅØ„Åù„ÅÆ„Åæ„Åæ
                    mainVisualFileName = file.name;
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        mainVisualData = e.target.result;
                        // „Éó„É¨„Éì„É•„ÉºË°®Á§∫„ÅÆ„Åø
                        document.getElementById('mainVisualImage').src = mainVisualData;
                        document.getElementById('mainVisualPreview').classList.remove('hidden');
                        document.getElementById('mainVisualPlaceholder').classList.add('hidden');
                        console.log('[handleMainVisualUpload] Image ready for upload on save');
                    };
                    reader.readAsDataURL(file);
                }
            }
        }

        // „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´ÂâäÈô§
        function removeMainVisual() {
            mainVisualData = null;
            window.mainVisualUrl = ''; // ‰øùÂ≠òÊôÇ„Å´Á©∫ÊñáÂ≠óÂàó„ÇíÈÄÅ‰ø°„Åó„Å¶ÂâäÈô§
            window.mainVisualDisplayUrl = ''; // Ë°®Á§∫Áî®URL„ÇÇ„ÇØ„É™„Ç¢
            document.getElementById('mainVisualImage').src = '';
            document.getElementById('mainVisualPreview').classList.add('hidden');
            document.getElementById('mainVisualPlaceholder').classList.remove('hidden');
            document.getElementById('mainVisualInput').value = '';
            console.log('[removeMainVisual] „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„Çí‰ªÆÂâäÈô§„ÄÇ‰øùÂ≠ò„Éú„Çø„É≥„ÇíÊäº„Åô„Å®„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´ÂèçÊò†„Åï„Çå„Åæ„Åô');

            // „Éó„É¨„Éì„É•„Éº„ÇíÊõ¥Êñ∞ÔºàÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„Å®Âêå„Åò„Éë„Çø„Éº„É≥Ôºâ
            updateMainVisualPreview();
            updateViewData('mainVisual');
        }

        // ÁîªÂÉè‰ΩçÁΩÆË™øÊï¥
        let imagePositionX = 50;
        let imagePositionY = 50;
        let currentZoom = 100;
        let currentTextColor = '#000000';

        function adjustImagePosition(position) {
            const image = document.getElementById('previewMainVisual');
            if (image) {
                const step = 5; // 5%„Åö„Å§ÁßªÂãï
                // Âà∂Èôê„Å™„ÅóÔºàËá™Áî±„Å´Âãï„Åã„Åõ„ÇãÔºâ
                switch(position) {
                    case 'up':
                        imagePositionY -= step;
                        break;
                    case 'down':
                        imagePositionY += step;
                        break;
                    case 'left':
                        imagePositionX -= step;
                        break;
                    case 'right':
                        imagePositionX += step;
                        break;
                    case 'center':
                        imagePositionX = 50;
                        imagePositionY = 50;
                        break;
                }
                updateImagePosition();
            }
        }

        function updateImagePosition() {
            const image = document.getElementById('previewMainVisual');
            if (image) {
                const scale = currentZoom / 100;
                const translateX = (imagePositionX - 50) * 2;
                const translateY = (imagePositionY - 50) * 2;
                image.style.transform = `scale(${scale}) translate(${translateX}%, ${translateY}%)`;
            }
        }

        // „Éâ„É©„ÉÉ„Ç∞„ÅßÁîªÂÉè‰ΩçÁΩÆ„ÇíË™øÊï¥
        let isDragging = false;
        let startX, startY;
        let startPosX, startPosY;

        function initImageDrag() {
            const container = document.getElementById('mainVisualContainer');
            const image = document.getElementById('previewMainVisual');

            if (!container || !image) return;

            // Êó¢Â≠ò„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂâäÈô§
            const newContainer = container.cloneNode(true);
            container.parentNode.replaceChild(newContainer, container);

            newContainer.addEventListener('mousedown', (e) => {
                // Á∑®ÈõÜ„Éë„Éç„É´„ÅåÈñã„ÅÑ„Å¶„ÅÑ„ÇãÊôÇ„ÅÆ„Åø„Éâ„É©„ÉÉ„Ç∞ÂèØËÉΩ
                const visualControls = document.getElementById('visualControls');
                if (!visualControls || visualControls.classList.contains('hidden')) {
                    return; // Á∑®ÈõÜ„Éë„Éç„É´„ÅåÈñâ„Åò„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„Éâ„É©„ÉÉ„Ç∞ÁÑ°Âäπ
                }

                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                startPosX = imagePositionX;
                startPosY = imagePositionY;
                newContainer.style.cursor = 'grabbing';
                e.preventDefault();
            });

            // mousemove„Å®mouseup„Ç§„Éô„É≥„Éà„ÅØ‰∏ÄÂ∫¶„Å†„ÅëËøΩÂä†
            if (!window.imageDragListenersAdded) {
                window.imageDragListenersAdded = true;

                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;

                    const containerRect = document.getElementById('mainVisualContainer')?.getBoundingClientRect();
                    if (!containerRect) return;

                    // „Éû„Ç¶„Çπ„ÅÆÁßªÂãïÈáè„ÇíË®àÁÆó
                    const deltaX = (e.clientX - startX) / containerRect.width * 100;
                    const deltaY = (e.clientY - startY) / containerRect.height * 100;

                    // Âà∂Èôê„Å™„ÅóÔºàËá™Áî±„Å´Âãï„Åã„Åõ„ÇãÔºâ
                    const sensitivityX = 1.0;
                    imagePositionX = startPosX + deltaX * sensitivityX;

                    const sensitivityY = 1.0;
                    imagePositionY = startPosY + deltaY * sensitivityY;

                    updateImagePosition();
                });

                document.addEventListener('mouseup', () => {
                    if (isDragging) {
                        isDragging = false;
                        const newContainer = document.getElementById('mainVisualContainer');
                        if (newContainer) newContainer.style.cursor = 'move';
                    }
                });
            }
        }

        // ÁîªÂÉè„Ç∫„Éº„É†Ë™øÊï¥
        function adjustImageZoom(value) {
            currentZoom = parseInt(value);
            // updateImagePosition()„Åß‰∏ÄÊã¨ÈÅ©Áî®„Åï„Çå„Çã„ÅÆ„Åß„ÄÅ„Åì„Åì„Åß„ÅØË®≠ÂÆö„ÅÆ„Åø
            updateImagePosition();
        }

        // ÁîªÂÉèÊòéÂ∫¶Ë™øÊï¥Ôºà‰∏ãÈÉ®30%„ÅÆ„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥Ôºâ
        function adjustImageOpacity(value) {
            const overlay = document.getElementById('brightnessOverlay');
            if (overlay) {
                const numValue = parseInt(value);

                if (numValue < 50) {
                    // 0-50: Èªí„ÅÑ„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥ÔºàÂ∑¶ÂÅ¥Ôºâ
                    const opacity = (50 - numValue) / 50; // 1.0 ‚Üí 0
                    overlay.style.background = `linear-gradient(to bottom, transparent, rgba(0, 0, 0, ${opacity * 0.7}))`;
                } else if (numValue === 50) {
                    // 50: ÈÄèÊòéÔºà„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥„Å™„ÅóÔºâ
                    overlay.style.background = 'linear-gradient(to bottom, transparent, transparent)';
                } else {
                    // 50-100: ÁôΩ„ÅÑ„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥ÔºàÂè≥ÂÅ¥Ôºâ
                    const opacity = (numValue - 50) / 50; // 0 ‚Üí 1.0
                    overlay.style.background = `linear-gradient(to bottom, transparent, rgba(255, 255, 255, ${opacity * 0.7}))`;
                }
            }
        }

        // ÁîªÂÉèË™øÊï¥„Éë„Éç„É´„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
        function toggleImageControls() {
            const controls = document.getElementById('visualControls');
            const container = document.getElementById('mainVisualContainer');

            if (controls) {
                controls.classList.toggle('hidden');

                // „Ç´„Éº„ÇΩ„É´„ÅÆË°®Á§∫„ÇíÂàá„ÇäÊõø„Åà
                if (container) {
                    if (controls.classList.contains('hidden')) {
                        container.style.cursor = 'default'; // Á∑®ÈõÜ„Éë„Éç„É´Èñâ„Åò„ÅüÊôÇ
                    } else {
                        container.style.cursor = 'move'; // Á∑®ÈõÜ„Éë„Éç„É´Èñã„ÅÑ„ÅüÊôÇ
                    }
                }
            }
        }

        // ÊñáÂ≠óËâ≤Âàá„ÇäÊõø„Åà
        function adjustTextColor(color) {
            currentTextColor = color;
            // „Éó„É¨„Éì„É•„Éº„É¢„Éº„ÉÄ„É´ÂÜÖ„ÅÆÊ≠£„Åó„ÅÑID„Çí‰ΩøÁî®
            const overlayTexts = document.querySelectorAll('#previewMainVisualSection .absolute.bottom-0 *');

            overlayTexts.forEach(el => {
                // „Å©„Çì„Å™Ëâ≤„Åß„ÇÇÁõ¥Êé•ÈÅ©Áî®
                el.style.color = color;
            });
        }

        // „Éó„É¨„Éì„É•„ÉºÁîªÈù¢„ÅÆ‰ºöÁ§æÂêçË°®Á§∫„ÇíÊõ¥Êñ∞
        function updatePreviewCompanyName() {
            console.log('[updatePreviewCompanyName] === CALLED ===');
            const companyName = window.currentCompanyName || 'Ê†™Âºè‰ºöÁ§æ„Åè„Çâ„Åπ„ÇãÂ°óË£Ö';
            const tradeName = window.currentTradeName || '';
            const displaySelect = document.getElementById('previewCompanyDisplaySelect');
            const displayOption = displaySelect ? displaySelect.value : 'company';

            console.log('[updatePreviewCompanyName] displayOption:', displayOption);

            let displayHtml = '';

            if (displayOption === 'company') {
                // Á§æÂêç„ÅÆ„Åø
                displayHtml = companyName;
            } else if (displayOption === 'trade') {
                // Â±ãÂè∑„ÅÆ„Åø
                displayHtml = tradeName;
            } else if (displayOption === 'both_company_priority') {
                // ‰∏°ÊñπË°®Á§∫„ÉªÁ§æÂêçÂÑ™ÂÖà (Á§æÂêçÂ§ß„ÄÅÂ±ãÂè∑Â∞è)
                displayHtml = `<span style="font-size: 120%; font-weight: bold;">${companyName}</span><br><span style="font-size: 70%; opacity: 0.8;">${tradeName}</span>`;
            } else if (displayOption === 'both_trade_priority') {
                // ‰∏°ÊñπË°®Á§∫„ÉªÂ±ãÂè∑ÂÑ™ÂÖà (Â±ãÂè∑Â§ß„ÄÅÁ§æÂêçÂ∞è)
                displayHtml = `<span style="font-size: 120%; font-weight: bold;">${tradeName}</span><br><span style="font-size: 70%; opacity: 0.8;">${companyName}</span>`;
            }

            // „Åô„Åπ„Å¶„ÅÆ‰ºöÁ§æÂêçË°®Á§∫ÁÆáÊâÄ„ÇíÊõ¥Êñ∞
            const elements = [
                'previewCompanyName',
                'previewCompanyNameHero',
                'previewCompanyNameOverlay',
                'previewCompanyNameFull'
            ];

            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.innerHTML = displayHtml;

                    // „Ç™„Éº„Éê„Éº„É¨„Ç§„ÅÆÂ†¥Âêà„ÄÅÊñáÂ≠óÊï∞„Å´Âøú„Åò„Å¶„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫„ÇíËá™ÂãïË™øÊï¥
                    if (id === 'previewCompanyNameOverlay') {
                        const textLength = element.textContent.length;
                        if (textLength > 30) {
                            element.className = 'text-2xl sm:text-3xl md:text-4xl font-bold mb-2 drop-shadow-lg text-center sm:text-left break-words text-gray-800';
                        } else if (textLength > 20) {
                            element.className = 'text-2xl sm:text-4xl md:text-5xl font-bold mb-2 drop-shadow-lg text-center sm:text-left break-words text-gray-800';
                        } else {
                            element.className = 'text-3xl sm:text-5xl md:text-6xl font-bold mb-2 drop-shadow-lg text-center sm:text-left break-words text-gray-800';
                        }
                    }
                }
            });
        }

        // „Çµ„Ç§„Éâ„Éê„ÉºÔºàÂè≥ÂÅ¥„Éë„Éç„É´ÔºâÁî®„ÅÆ‰ºöÁ§æÂêçË°®Á§∫Êõ¥Êñ∞
        // üö´ ÂâäÈô§Ê∏à„ÅøÔºö„Çµ„Ç§„Éâ„Éê„Éº‰ºöÁ§æÂêçÊõ¥Êñ∞Ê©üËÉΩ
        // ÔºàÊ≠ØËªäË®≠ÂÆö„Éë„Éç„É´„Åã„ÇâÂâäÈô§„Åï„Çå„Åü„Åü„ÇÅ‰∏çË¶ÅÔºâ

        // „ÇÆ„É£„É©„É™„ÉºÁîªÂÉèÈÖçÂàó
        let galleryImages = [];
        let galleryFilesToUpload = []; // ‰øùÂ≠ò„Éú„Çø„É≥Êäº‰∏ãÊôÇ„Å´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åô„Çã„Éï„Ç°„Ç§„É´

        // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóË®≠ÂÆö
        function setupGalleryDragDrop() {
            const galleryList = document.getElementById('photoGalleryList');
            if (!galleryList) return;

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                galleryList.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                galleryList.addEventListener(eventName, () => {
                    galleryList.classList.add('border-blue-500', 'bg-blue-50');
                }, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                galleryList.addEventListener(eventName, () => {
                    galleryList.classList.remove('border-blue-500', 'bg-blue-50');
                }, false);
            });

            galleryList.addEventListener('drop', (e) => {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleGalleryFiles(files);
            }, false);
        }

        // „Éï„Ç°„Ç§„É´Âá¶ÁêÜ„ÇíÂÖ±ÈÄöÂåñ
        function handleGalleryFiles(files) {
            const galleryList = document.getElementById('photoGalleryList');
            const currentImages = galleryList.querySelectorAll('.gallery-item').length;

            if (currentImages >= 20) {
                showNotification('ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº‰∏äÈôê', 'ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„ÅØÊúÄÂ§ß20Êûö„Åæ„Åß„Åß„Åô„ÄÇ„Åì„Çå‰ª•‰∏äËøΩÂä†„Åß„Åç„Åæ„Åõ„Çì„ÄÇ', 'error');
                return;
            }

            const remainingSlots = 20 - currentImages;
            const filesToAdd = Array.from(files).slice(0, remainingSlots);

            if (files.length > remainingSlots) {
                showNotification('ÂÜôÁúü„ÇÆ„É£„É©„É™„ÉºÂà∂Èôê', `ÊÆã„Çä${remainingSlots}Êûö„Åæ„ÅßËøΩÂä†ÂèØËÉΩ„Åß„Åô„ÄÇÊúÄÂàù„ÅÆ${remainingSlots}Êûö„ÅÆ„ÅøËøΩÂä†„Åó„Åæ„Åô„ÄÇ`, 'warning');
            }

            filesToAdd.forEach(file => {
                if (file && file.type.startsWith('image/')) {
                    const imageId = 'gallery_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    const localUrl = URL.createObjectURL(file);
                    const addButton = galleryList.querySelector('.border-dashed');

                    const imageDiv = document.createElement('div');
                    imageDiv.className = 'relative group gallery-item';
                    imageDiv.id = imageId;
                    imageDiv.innerHTML = `
                        <img src="${localUrl}" class="w-full h-24 object-cover rounded-lg" alt="${file.name}">
                        <button type="button" onclick="removeGalleryImage('${imageId}')" class="absolute top-1 right-1 bg-red-500 text-white p-1 rounded opacity-0 group-hover:opacity-100 transition">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    `;

                    galleryList.insertBefore(imageDiv, addButton);

                    // AVIF/WebP„ÅÆÂ†¥Âêà„ÅØJPEG„Å´Â§âÊèõ
                    if (file.type === 'image/avif' || file.type === 'image/webp') {
                        console.log('[handleGalleryFiles] Converting AVIF/WebP to JPEG:', file.name);
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const img = new Image();
                            img.onload = function() {
                                const canvas = document.createElement('canvas');
                                canvas.width = img.width;
                                canvas.height = img.height;
                                const ctx = canvas.getContext('2d');
                                ctx.drawImage(img, 0, 0);
                                const jpegData = canvas.toDataURL('image/jpeg', 0.9);
                                const jpegFileName = file.name.replace(/\.(avif|webp)$/i, '.jpg');

                                galleryFilesToUpload.push({
                                    id: imageId,
                                    base64Data: jpegData,
                                    fileName: jpegFileName
                                });
                                console.log('[handleGalleryFiles] Converted to JPEG, ready for upload:', jpegFileName);
                            };
                            img.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    } else {
                        // JPEG/PNG/GIF„ÅØ„Åù„ÅÆ„Åæ„Åæ
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            galleryFilesToUpload.push({
                                id: imageId,
                                base64Data: e.target.result,
                                fileName: file.name
                            });
                            console.log('[handleGalleryFiles] File ready for upload on save:', file.name);
                        };
                        reader.readAsDataURL(file);
                    }
                }
            });
        }

        // „ÇÆ„É£„É©„É™„ÉºÁîªÂÉèËøΩÂä†Ôºà„Éó„É¨„Éì„É•„Éº„ÅÆ„Åø„ÄÅ‰øùÂ≠ò„ÅØÂæå„ÅßÔºâ
        function handleGalleryUpload(event) {
            handleGalleryFiles(event.target.files);
            event.target.value = '';
        }


        // „ÇÆ„É£„É©„É™„Éº„Éá„Éº„Çø„Çí‰øùÂ≠ò
        async function saveGalleryData() {
            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: JSON.stringify({
                        action: 'saveGalleryData',
                        merchantId: window.merchantId,
                        galleryData: galleryImages
                    })
                });

                const result = await response.json();
                if (!result.success) {
                    console.error('„ÇÆ„É£„É©„É™„Éº‰øùÂ≠ò„Ç®„É©„Éº:', result.error);
                }
            } catch (error) {
                console.error('„ÇÆ„É£„É©„É™„Éº‰øùÂ≠òÈÄö‰ø°„Ç®„É©„Éº:', error);
            }
        }

        // „ÇÆ„É£„É©„É™„ÉºÁîªÂÉè„ÇíÂâäÈô§
        // „ÇÆ„É£„É©„É™„ÉºÁîªÂÉè„ÇíÂâäÈô§ÔºàÂç≥Â∫ß„Å´„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„Çâ„ÇÇÂâäÈô§Ôºâ
        function removeGalleryImage(imageId) {
            console.log('[removeGalleryImage] üöÄ ‰ªÆÂâäÈô§ÈñãÂßã:', imageId);
            console.log('[removeGalleryImage] üîç ÂâäÈô§Ââç„ÅÆDOMÁä∂ÊÖã:', {
                photoGalleryListItems: document.getElementById('photoGalleryList')?.children.length || 0,
                galleryImagesLength: (window.galleryImages || []).length,
                localGalleryLength: galleryImages.length
            });

            const element = document.getElementById(imageId);
            if (!element) {
                console.error('[removeGalleryImage] Ë¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:', imageId);
                return;
            }

            // Á∑®ÈõÜ„É¢„Éº„Éâ‰∏≠„ÅØ‰ªÆÂâäÈô§„ÅÆ„ÅøÔºà‰øùÂ≠ò„Éú„Çø„É≥„ÇíÊäº„Åô„Åæ„Åß„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´ÂèçÊò†„Åó„Å™„ÅÑÔºâ
            console.log('[removeGalleryImage] üîç DOMË¶ÅÁ¥†ÂâäÈô§ÂÆüË°å‰∏≠...');
            element.remove();

            // galleryImagesÈÖçÂàó„Åã„ÇâÂâäÈô§Ôºà‰ªÆÂâäÈô§Ôºâ
            console.log('[removeGalleryImage] üîç ÈÖçÂàóÊõ¥Êñ∞ÂÆüË°å‰∏≠...');
            galleryImages = galleryImages.filter(img => img.id !== imageId);
            window.galleryImages = window.galleryImages.filter(img => img.id !== imageId);

            console.log('[removeGalleryImage] ‰ªÆÂâäÈô§ÂÆå‰∫Ü„ÄÇ‰øùÂ≠ò„Éú„Çø„É≥„ÇíÊäº„Åô„Å®„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´ÂèçÊò†„Åï„Çå„Åæ„Åô');
            console.log('[removeGalleryImage] ÊÆã„Çä„ÅÆÁîªÂÉèÊï∞:', window.galleryImages.length);
            console.log('[removeGalleryImage] ÊÆã„Çä„ÅÆÁîªÂÉè:', window.galleryImages);

            // üöÄ Á∑®ÈõÜ„É¢„Éº„Éâ‰∏≠„ÅØ‰∏ÄÂàá„ÅÆÂÜçÊèèÁîªÂá¶ÁêÜ„ÇíË°å„Çè„Å™„ÅÑ
            // DOMÂâäÈô§Ôºàelement.remove()Ôºâ„Å®ÈÖçÂàóÊõ¥Êñ∞„ÅÆ„Åø„ÅßÂçÅÂàÜ
            // updateGalleryPreview(); // ‚Üê „Éó„É¨„Éì„É•„Éº„É¢„Éº„ÉÄ„É´Áî®ÔºàÁ∑®ÈõÜ„É¢„Éº„Éâ„Åß„ÅØ‰∏çË¶ÅÔºâ
            // updateViewData('photoGallery'); // ‚Üê Èñ≤Ë¶ß„É¢„Éº„ÉâÁî®ÔºàÁ∑®ÈõÜ„É¢„Éº„Éâ„Åß„ÅØ‰∏çË¶ÅÔºâ

            console.log('[removeGalleryImage] üöÄ Á∑®ÈõÜ„É¢„Éº„Éâ‰∏≠„ÅÆ„Åü„ÇÅÂÜçÊèèÁîªÂá¶ÁêÜ„Çí„Çπ„Ç≠„ÉÉ„Éó');

            // üîç ÂâäÈô§Âæå„ÅÆÁä∂ÊÖãÁ¢∫Ë™ç
            setTimeout(() => {
                console.log('[removeGalleryImage] üîç ÂâäÈô§Âæå„ÅÆDOMÁä∂ÊÖãÁ¢∫Ë™ç:', {
                    photoGalleryListItems: document.getElementById('photoGalleryList')?.children.length || 0,
                    galleryImagesLength: (window.galleryImages || []).length,
                    localGalleryLength: galleryImages.length,
                    actualDOMImages: document.querySelectorAll('#photoGalleryList .gallery-item').length
                });
            }, 100);
        }

        // „Ç´„É´„Éº„Çª„É´ÁÆ°ÁêÜÂ§âÊï∞
        let currentGalleryIndex = 0;
        let currentExampleIndex = 0;

        // „Éó„É¨„Éì„É•„Éº„ÅÆ„ÇÆ„É£„É©„É™„Éº„ÇíÊõ¥Êñ∞Ôºà„Ç´„É´„Éº„Çª„É´ÂºèÔºâ
        function updateMainVisualPreview() {
            const mainVisualImage = document.getElementById('mainVisualImage');
            const mainVisualPreview = document.getElementById('mainVisualPreview');
            const mainVisualPlaceholder = document.getElementById('mainVisualPlaceholder');

            if (window.mainVisualUrl && window.mainVisualUrl.trim() !== '') {
                // ÁîªÂÉè„Åå„ÅÇ„ÇãÂ†¥ÂêàÔºöÁ∑®ÈõÜ„Ç®„É™„Ç¢„ÅÆ„Éó„É¨„Éì„É•„Éº„ÇíÊõ¥Êñ∞
                console.log('[updateMainVisualPreview] Updating edit area with URL:', window.mainVisualUrl);
                if (mainVisualImage) {
                    mainVisualImage.src = window.mainVisualUrl;
                }
                if (mainVisualPreview) {
                    mainVisualPreview.classList.remove('hidden');
                }
                if (mainVisualPlaceholder) {
                    mainVisualPlaceholder.classList.add('hidden');
                }
            } else {
                // ÁîªÂÉè„Åå„Å™„ÅÑÂ†¥ÂêàÔºö„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº„ÇíË°®Á§∫
                console.log('[updateMainVisualPreview] No image data - showing placeholder');
                if (mainVisualImage) {
                    mainVisualImage.src = '';
                }
                if (mainVisualPreview) {
                    mainVisualPreview.classList.add('hidden');
                }
                if (mainVisualPlaceholder) {
                    mainVisualPlaceholder.classList.remove('hidden');
                }
            }
        }

        function updateGalleryPreview() {
            const previewGalleryList = document.getElementById('previewGalleryList');
            const indicators = document.getElementById('galleryIndicators');

            // üöÄ „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„Å®Âêå„Åò„Éë„Çø„Éº„É≥Ôºöwindow.galleryImages„ÇíÁõ¥Êé•‰ΩøÁî®
            if (previewGalleryList && window.galleryImages && window.galleryImages.length > 0) {
                console.log('üöÄ [updateGalleryPreview] „Éó„É¨„Éì„É•„ÉºÊèèÁîªÈñãÂßã:', window.galleryImages.length, '‰ª∂');

                // ÁÑ°Èôê„É´„Éº„ÉóÁî®„Å´Ë§áË£Ω„Çí‰ΩúÊàê
                const extendedImages = [...window.galleryImages, ...window.galleryImages, ...window.galleryImages];

                previewGalleryList.innerHTML = extendedImages.map((img, index) => {
                    return `
                        <div class="flex-shrink-0 w-72 aspect-square overflow-hidden rounded-lg cursor-pointer" onclick="openImageModal('${img.src}', '${img.name || '„ÇÆ„É£„É©„É™„ÉºÁîªÂÉè'}')">
                            <img src="${img.src}" alt="${img.name}" class="w-full h-full object-cover hover:scale-110 transition-transform duration-300">
                        </div>
                    `;
                }).join('');

                // „Ç§„É≥„Ç∏„Ç±„Éº„Çø„ÉºÁîüÊàê
                if (indicators) {
                    indicators.innerHTML = window.galleryImages.map((_, index) => `
                        <button onclick="goToGalleryImage(${index})" class="w-2 h-2 rounded-full transition ${index === currentGalleryIndex % window.galleryImages.length ? 'bg-blue-600' : 'bg-gray-300'}"></button>
                    `).join('');
                }

                // ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
                document.getElementById('preview-qualifications').style.display = 'block';
                console.log('üöÄ [updateGalleryPreview] „Çª„ÇØ„Ç∑„Éß„É≥Ë°®Á§∫ÂÆå‰∫Ü');
                // ÁÑ°Èôê„É´„Éº„Éó„ÅÆ‰∏≠Â§Æ‰ΩçÁΩÆÔºàÊúÄÂàù„ÅÆ„Çª„ÉÉ„ÉàÔºâ„Åã„ÇâÈñãÂßã
                currentGalleryIndex = window.galleryImages.length;
                updateGalleryCarouselPosition();
            } else {
                console.log('‚ö†Ô∏è [updateGalleryPreview] „Éó„É¨„Éì„É•„ÉºÈùûË°®Á§∫ - ÁîªÂÉèÊï∞:', (window.galleryImages || []).length);
                document.getElementById('preview-qualifications').style.display = 'none';
            }
        }

        // „ÇÆ„É£„É©„É™„Éº„Ç´„É´„Éº„Çª„É´„Çπ„ÇØ„É≠„Éº„É´
        function scrollGallery(direction) {
            if (!window.galleryImages || window.galleryImages.length === 0) return;

            if (direction === 'left') {
                currentGalleryIndex--;
            } else {
                currentGalleryIndex++;
            }

            updateGalleryCarouselPosition();
        }

        // ÁâπÂÆö„ÅÆ„ÇÆ„É£„É©„É™„ÉºÁîªÂÉè„Å∏ÁßªÂãï
        function goToGalleryImage(index) {
            currentGalleryIndex = index + (window.galleryImages ? window.galleryImages.length : 0);
            updateGalleryCarouselPosition();
        }

        // „ÇÆ„É£„É©„É™„Éº„Ç´„É´„Éº„Çª„É´‰ΩçÁΩÆÊõ¥Êñ∞
        function updateGalleryCarouselPosition() {
            const carousel = document.getElementById('previewGalleryList');
            const indicators = document.getElementById('galleryIndicators');

            if (carousel && window.galleryImages && window.galleryImages.length > 0) {
                const cardWidth = 288 + 16; // w-72 (18rem = 288px) + gap-4 (16px)

                // ÁÑ°Èôê„É´„Éº„Éó„ÅÆ„Åü„ÇÅ„ÅÆ‰ΩçÁΩÆË™øÊï¥
                const position = -currentGalleryIndex * cardWidth;
                carousel.style.transform = `translateX(${position}px)`;

                console.log('[updateGalleryCarouselPosition] currentGalleryIndex:', currentGalleryIndex, 'position:', position);

                // „Çπ„É†„Éº„Ç∫„Å™ÁÑ°Èôê„É´„Éº„Éó
                if (currentGalleryIndex < 0) {
                    setTimeout(() => {
                        carousel.style.transition = 'none';
                        currentGalleryIndex = window.galleryImages.length - 1;
                        const newPosition = -currentGalleryIndex * cardWidth;
                        carousel.style.transform = `translateX(${newPosition}px)`;
                        setTimeout(() => {
                            carousel.style.transition = 'transform 300ms';
                        }, 50);
                    }, 300);
                } else if (currentGalleryIndex >= window.galleryImages.length * 2) {
                    setTimeout(() => {
                        carousel.style.transition = 'none';
                        currentGalleryIndex = window.galleryImages.length;
                        const newPosition = -currentGalleryIndex * cardWidth;
                        carousel.style.transform = `translateX(${newPosition}px)`;
                        setTimeout(() => {
                            carousel.style.transition = 'transform 300ms';
                        }, 50);
                    }, 300);
                }

                // „Ç§„É≥„Ç∏„Ç±„Éº„Çø„ÉºÊõ¥Êñ∞
                if (indicators) {
                    const actualIndex = ((currentGalleryIndex % window.galleryImages.length) + window.galleryImages.length) % window.galleryImages.length;
                    indicators.querySelectorAll('button').forEach((btn, index) => {
                        btn.className = `w-2 h-2 rounded-full transition ${index === actualIndex ? 'bg-blue-600' : 'bg-gray-300'}`;
                    });
                }
            }
        }

        // ÊñΩÂ∑•‰∫ã‰æãÈÖçÂàó
        let constructionExamples = [];
        let exampleIdCounter = 0;

        // ÊñΩÂ∑•‰∫ã‰æã„ÇíËøΩÂä†
        function addConstructionExample() {
            let exampleId = 'example_' + (++exampleIdCounter);
            const examplesList = document.getElementById('constructionExamplesList');

            // ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØÔºöÊó¢„Å´Âêå„ÅòID„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥Âêà„ÅØÁï™Âè∑„ÇíÂ¢ó„ÇÑ„ÅôÔºàIDÈáçË§áÈò≤Ê≠¢Ôºâ
            while (constructionExamples.some(e => e.id === exampleId) ||
                   (window.constructionExamples && window.constructionExamples.some(e => e.id === exampleId))) {
                exampleIdCounter++;
                exampleId = 'example_' + exampleIdCounter;
                console.log('[addConstructionExample] IDÈáçË§áÊ§úÂá∫„ÄÅÊñ∞„Åó„ÅÑID„Å´Â§âÊõ¥:', exampleId);
            }

            const newExample = {
                id: exampleId,
                title: '',
                ageRange: '',
                content: '',
                price: '',
                beforeImage: null,
                afterImage: null
            };
            constructionExamples.push(newExample);
            window.constructionExamples = constructionExamples;  // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Å´„ÇÇÂêåÊúü
            console.log('[addConstructionExample] Added example:', exampleId, 'Total:', constructionExamples.length);

            const exampleDiv = document.createElement('div');
            exampleDiv.className = 'border rounded-lg p-4';
            exampleDiv.id = exampleId;
            exampleDiv.innerHTML = `
                <input type="text" class="w-full px-3 py-2 border rounded mb-2" placeholder="ÊñΩÂ∑•„Çø„Ç§„Éà„É´Ôºà‰æãÔºöÊà∏Âª∫„Å¶Â§ñÂ£ÅÂ°óË£ÖÔºâ" onchange="updateConstructionExample('${exampleId}', 'title', this.value)">
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <div>
                        <label class="text-xs text-gray-600 mb-1 block">ÁØâÂπ¥Êï∞</label>
                        <div class="flex items-center">
                            <input type="number" class="w-full px-3 py-2 border rounded" placeholder="15" min="0" max="100" onchange="updateConstructionExample('${exampleId}', 'ageRange', this.value)">
                            <span class="ml-2 text-sm text-gray-600">Âπ¥</span>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs text-gray-600 mb-1 block">ÊñΩÂ∑•ÈáëÈ°çÔºà‰∏áÂÜÜÔºâ</label>
                        <div class="flex items-center">
                            <input type="number" class="w-full px-3 py-2 border rounded" placeholder="150" min="0" onchange="updateConstructionExample('${exampleId}', 'price', this.value)">
                            <span class="ml-2 text-sm text-gray-600">‰∏áÂÜÜ</span>
                        </div>
                    </div>
                </div>
                <textarea class="w-full px-3 py-2 border rounded mb-2" rows="2" placeholder="ÊñΩÂ∑•ÂÜÖÂÆπÔºà‰æãÔºö„Ç∑„É™„Ç≥„É≥Â°óÊñô„Å´„Çà„Çã3ÂõûÂ°ó„Çä„ÄÅËâ≤Ë§™„Åõ„Å®Ê±ö„Çå„ÇíËß£Ê∂àÔºâ" onchange="updateConstructionExample('${exampleId}', 'content', this.value)"></textarea>

                <!-- „Éì„Éï„Ç©„Éº„Ç¢„Éï„Çø„ÉºÁîªÂÉè -->
                <div class="grid grid-cols-2 gap-4 mb-2">
                    <div>
                        <label class="text-xs font-semibold text-gray-600 mb-1 block">ÊñΩÂ∑•ÂâçÔºàBeforeÔºâ</label>
                        <input type="file" id="beforeImage_${exampleId}" accept="image/*" style="display: none;" onchange="handleExampleImage('${exampleId}', 'before', event)">
                        <div id="beforePreview_${exampleId}" class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer hover:border-blue-500" onclick="document.getElementById('beforeImage_${exampleId}').click()">
                            <svg class="w-8 h-8 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span class="text-xs text-gray-500">„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÁîªÂÉè„ÇíÈÅ∏Êäû</span>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs font-semibold text-gray-600 mb-1 block">ÊñΩÂ∑•ÂæåÔºàAfterÔºâ</label>
                        <input type="file" id="afterImage_${exampleId}" accept="image/*" style="display: none;" onchange="handleExampleImage('${exampleId}', 'after', event)">
                        <div id="afterPreview_${exampleId}" class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer hover:border-blue-500" onclick="document.getElementById('afterImage_${exampleId}').click()">
                            <svg class="w-8 h-8 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span class="text-xs text-gray-500">„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÁîªÂÉè„ÇíÈÅ∏Êäû</span>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end">
                    <button onclick="removeConstructionExample('${exampleId}')" class="text-red-600 hover:text-red-800 text-sm">
                        <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                        „Åì„ÅÆ‰∫ã‰æã„ÇíÂâäÈô§
                    </button>
                </div>
            `;

            examplesList.appendChild(exampleDiv);
        }

        // ÊñΩÂ∑•‰∫ã‰æã„ÇíÊõ¥Êñ∞
        function updateConstructionExample(exampleId, field, value) {
            const example = constructionExamples.find(e => e.id === exampleId);
            if (example) {
                example[field] = value;
                window.constructionExamples = constructionExamples;  // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Å´ÂêåÊúü
                updateExamplesPreview();
                console.log('[updateConstructionExample]', exampleId, field, '=', value);
            }
        }

        // ÊñΩÂ∑•‰∫ã‰æã„ÅÆÁîªÂÉè„ÇíÂá¶ÁêÜ
        function handleExampleImage(exampleId, type, event) {
            const file = event.target.files[0];
            if (file) {
                console.log('[handleExampleImage] File type:', file.type, 'for', type);

                // AVIF/WebP„ÅÆÂ†¥Âêà„ÅØJPEG„Å´Â§âÊèõ
                if (file.type === 'image/avif' || file.type === 'image/webp') {
                    console.log('[handleExampleImage] Converting AVIF/WebP to JPEG...');
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = new Image();
                        img.onload = function() {
                            const canvas = document.createElement('canvas');
                            canvas.width = img.width;
                            canvas.height = img.height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0);
                            const jpegData = canvas.toDataURL('image/jpeg', 0.9);

                            const example = constructionExamples.find(ex => ex.id === exampleId);
                            if (example) {
                                if (type === 'before') {
                                    example.beforeImage = jpegData;
                                    const preview = document.getElementById(`beforePreview_${exampleId}`);
                                    if (preview) {
                                        preview.innerHTML = `<img src="${jpegData}" class="w-full h-32 object-cover rounded" alt="ÊñΩÂ∑•Ââç">`;
                                    }
                                } else {
                                    example.afterImage = jpegData;
                                    const preview = document.getElementById(`afterPreview_${exampleId}`);
                                    if (preview) {
                                        preview.innerHTML = `<img src="${jpegData}" class="w-full h-32 object-cover rounded" alt="ÊñΩÂ∑•Âæå">`;
                                    }
                                }
                                window.constructionExamples = constructionExamples;  // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Å´ÂêåÊúü
                                updateExamplesPreview();
                                console.log('[handleExampleImage] Image converted to JPEG and synced');
                            }
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                } else {
                    // JPEG/PNG/GIF„ÅØ„Åù„ÅÆ„Åæ„Åæ
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const example = constructionExamples.find(ex => ex.id === exampleId);
                        if (example) {
                            if (type === 'before') {
                                example.beforeImage = e.target.result;
                                const preview = document.getElementById(`beforePreview_${exampleId}`);
                                if (preview) {
                                    preview.innerHTML = `<img src="${e.target.result}" class="w-full h-32 object-cover rounded" alt="ÊñΩÂ∑•Ââç">`;
                                }
                            } else {
                                example.afterImage = e.target.result;
                                const preview = document.getElementById(`afterPreview_${exampleId}`);
                                if (preview) {
                                    preview.innerHTML = `<img src="${e.target.result}" class="w-full h-32 object-cover rounded" alt="ÊñΩÂ∑•Âæå">`;
                                }
                            }
                            window.constructionExamples = constructionExamples;  // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Å´ÂêåÊúü
                            updateExamplesPreview();
                            console.log('[handleExampleImage] Image loaded and synced');
                        }
                    };
                    reader.readAsDataURL(file);
                }
            }
        }

        // ÊñΩÂ∑•‰∫ã‰æã„ÇíÂâäÈô§ÔºàÂç≥Â∫ß„Å´„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„Çâ„ÇÇÂâäÈô§Ôºâ
        function removeConstructionExample(exampleId) {
            console.log('[removeConstructionExample] ‰ªÆÂâäÈô§ÈñãÂßã:', exampleId);

            // Á∑®ÈõÜ„É¢„Éº„Éâ‰∏≠„ÅØ‰ªÆÂâäÈô§„ÅÆ„ÅøÔºà‰øùÂ≠ò„Éú„Çø„É≥„ÇíÊäº„Åô„Åæ„Åß„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´ÂèçÊò†„Åó„Å™„ÅÑÔºâ
            const element = document.getElementById(exampleId);
            if (element) {
                element.remove();
            }

            // ÈÖçÂàó„Åã„ÇâÂâäÈô§Ôºà‰ªÆÂâäÈô§Ôºâ
            constructionExamples = constructionExamples.filter(e => e.id !== exampleId);
            window.constructionExamples = constructionExamples;  // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Å´ÂêåÊúü

            console.log('[removeConstructionExample] ‰ªÆÂâäÈô§ÂÆå‰∫Ü„ÄÇ‰øùÂ≠ò„Éú„Çø„É≥„ÇíÊäº„Åô„Å®„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´ÂèçÊò†„Åï„Çå„Åæ„Åô');

            // „Éó„É¨„Éì„É•„Éº„ÇíÊõ¥Êñ∞
            updateExamplesPreview();
            updateViewData('constructionExamples');
        }

        // Google Drive„ÅÆURLÊ≠£Ë¶èÂåñÈñ¢Êï∞ÔºàID„ÅÆ„ÅøÊäΩÂá∫Ôºâ
        function normalizeGoogleDriveUrl(url) {
            if (!url || url === 'NONE') return 'NONE';

            // Google Drive URL„Åã„ÇâID„ÇíÊäΩÂá∫
            const patterns = [
                /[?&]id=([^&]+)/,  // uc?export=view&id=... „Åæ„Åü„ÅØ thumbnail?id=...&sz=...
                /\/d\/([^\/]+)/,   // /drive/d/ID/view
                /\/file\/d\/([^\/]+)/ // /file/d/ID/view
            ];

            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match) {
                    return match[1]; // ID„ÅÆ„ÅøËøî„Åô
                }
            }

            return url; // Google Drive URL„Åß„Å™„ÅÑÂ†¥Âêà„ÅØ„Åù„ÅÆ„Åæ„Åæ
        }

        // „Ç´„ÉäÊ≠£Ë¶èÂåñÈñ¢Êï∞Ôºà„Ç´„Çø„Ç´„Éä‚Üí„Å≤„Çâ„Åå„Å™Â§âÊèõ + Â∞èÊñáÂ≠óÂåñÔºâ
        // „Äå„Ç™„Ç™„Çµ„Ç´„Äç‚Üí„Äå„Åä„Åä„Åï„Åã„Äç„Å´Â§âÊèõ„Åó„Å¶Ê§úÁ¥¢„Éû„ÉÉ„ÉÅ„Åï„Åõ„Çã
        function normalizeKana(str) {
            if (!str) return '';
            return str
                .split('')
                .map(char => {
                    const code = char.charCodeAt(0);
                    // „Ç´„Çø„Ç´„ÉäÔºàU+30A0ÔΩûU+30FFÔºâ„Çí„Å≤„Çâ„Åå„Å™ÔºàU+3040ÔΩûU+309FÔºâ„Å´Â§âÊèõ
                    if (code >= 0x30A0 && code <= 0x30FF) {
                        return String.fromCharCode(code - 0x60);
                    }
                    return char;
                })
                .join('')
                .toLowerCase()
                .trim();
        }

        // ÊñΩÂ∑•‰∫ã‰æã„ÅÆÈáçË§áÈô§ÂéªÂÖ±ÈÄöÈñ¢Êï∞ÔºàURLÊ≠£Ë¶èÂåñÂØæÂøúÔºâ
        function getUniqueExamples(examples) {
            console.log('[getUniqueExamples] ÂÖ•Âäõ:', examples.length, '‰ª∂');
            const seenUrlPairs = new Set();
            const result = examples.filter((example, index) => {
                const beforeUrl = example.beforeImage || example.beforeUrl || 'NONE';
                const afterUrl = example.afterImage || example.afterUrl || 'NONE';

                // URLÊ≠£Ë¶èÂåñÔºàID„ÅÆ„Åø„ÅßÊØîËºÉÔºâ
                const normalizedBeforeId = normalizeGoogleDriveUrl(beforeUrl);
                const normalizedAfterId = normalizeGoogleDriveUrl(afterUrl);
                const urlPair = `${normalizedBeforeId}|${normalizedAfterId}`;

                console.log(`[getUniqueExamples] ${index + 1}‰ª∂ÁõÆ:`, {
                    title: example.title,
                    beforeUrl: beforeUrl.substring(0, 50) + (beforeUrl.length > 50 ? '...' : ''),
                    afterUrl: afterUrl.substring(0, 50) + (afterUrl.length > 50 ? '...' : ''),
                    normalizedPair: urlPair
                });

                if (seenUrlPairs.has(urlPair)) {
                    console.log(`[getUniqueExamples] üî• ÈáçË§áÈô§Âéª:`, example.title, 'ID pair:', urlPair);
                    return false;
                }
                seenUrlPairs.add(urlPair);
                return true;
            });
            console.log('[getUniqueExamples] Âá∫Âäõ:', result.length, '‰ª∂Ôºà', examples.length - result.length, '‰ª∂Èô§ÂéªÔºâ');
            return result;
        }

        // „Éó„É¨„Éì„É•„Éº„ÅÆÊñΩÂ∑•‰∫ã‰æã„ÇíÊõ¥Êñ∞ÔºàÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„Å®Âêå„ÅòÊñπÂºèÔºâ
        function updateExamplesPreview() {
            const previewExamplesList = document.getElementById('previewExamplesList');

            if (!previewExamplesList) {
                console.error('[updateExamplesPreview] previewExamplesList not found');
                return;
            }

            const examples = window.constructionExamples || constructionExamples || [];
            const validExamples = examples.filter(e => e.beforeImage || e.afterImage);
            const uniqueValidExamples = getUniqueExamples(validExamples);

            console.log('[updateExamplesPreview] Rendering examples:', uniqueValidExamples.length, 'ÔºàÈáçË§áÈô§ÂéªÂæåÔºâ');

            if (uniqueValidExamples.length > 0) {
                // 1Êûö„ÅÆÂ†¥Âêà„ÅØPCÊôÇ‰∏≠Â§ÆË°®Á§∫„ÅÆ„Åü„ÇÅ„ÅÆ„Çπ„Çø„Ç§„É´Ë™øÊï¥
                if (uniqueValidExamples.length === 1) {
                    previewExamplesList.className = 'flex gap-4 transition-transform duration-300 justify-center';
                } else {
                    previewExamplesList.className = 'flex gap-4 transition-transform duration-300';
                }

                previewExamplesList.innerHTML = uniqueValidExamples.map((example, index) => {
                    console.log('[updateExamplesPreview] Rendering example', index, 'beforeImage:', example.beforeImage?.substring(0, 50), 'afterImage:', example.afterImage?.substring(0, 50));
                    return `
                        <div class="flex-shrink-0 w-full md:w-80 lg:w-96 bg-white rounded-lg shadow-lg border overflow-hidden">
                            <div class="grid grid-cols-2 gap-1 p-2">
                                ${example.beforeImage ? `
                                    <div class="relative">
                                        <img src="${example.beforeImage}" alt="ÊñΩÂ∑•Ââç" class="w-full h-40 md:h-48 object-cover rounded">
                                        <div class="absolute top-1 left-1 bg-black bg-opacity-70 text-white px-2 py-1 text-xs rounded">BEFORE</div>
                                    </div>
                                ` : ''}
                                ${example.afterImage ? `
                                    <div class="relative">
                                        <img src="${example.afterImage}" alt="ÊñΩÂ∑•Âæå" class="w-full h-40 md:h-48 object-cover rounded">
                                        <div class="absolute top-1 right-1 bg-blue-600 text-white px-2 py-1 text-xs rounded">AFTER</div>
                                    </div>
                                ` : ''}
                            </div>
                            <div class="p-3 md:p-4">
                                <h4 class="font-bold text-gray-900 text-sm md:text-base">${example.title || 'ÊñΩÂ∑•‰∫ã‰æã'}</h4>
                                ${example.ageRange ? `<p class="text-xs md:text-sm text-gray-600">ÁØâ${example.ageRange}Âπ¥</p>` : ''}
                                ${example.price ? `<p class="text-red-600 font-bold text-sm md:text-base">${Number(example.price).toLocaleString()}‰∏áÂÜÜ</p>` : ''}
                                ${example.content ? `<p class="text-xs md:text-sm text-gray-600 mt-2">${example.content}</p>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');

                // „Ç§„É≥„Ç∏„Ç±„Éº„Çø„ÉºÔºà„Éö„Éº„Ç∏„É£„ÉºÔºâ„Å®Áü¢Âç∞„Éú„Çø„É≥„ÅÆË°®Á§∫Âà∂Âæ°
                const indicators = document.getElementById('examplesIndicators');
                const leftArrow = document.querySelector('button[onclick="scrollExamples(\'left\')"]');
                const rightArrow = document.querySelector('button[onclick="scrollExamples(\'right\')"]');

                if (uniqueValidExamples.length <= 1) {
                    // 1Êûö‰ª•‰∏ã„ÅÆÂ†¥Âêà„ÅØ„Éö„Éº„Ç∏„É£„Éº„Å®Áü¢Âç∞„ÇíÈùûË°®Á§∫
                    if (indicators) indicators.style.display = 'none';
                    if (leftArrow) leftArrow.style.display = 'none';
                    if (rightArrow) rightArrow.style.display = 'none';
                } else {
                    // Ë§áÊï∞Êûö„ÅÆÂ†¥Âêà„ÅØ„Éö„Éº„Ç∏„É£„Éº„Å®Áü¢Âç∞„ÇíË°®Á§∫„Åó„ÄÅÂãïÁöÑ„Å´ÁîüÊàê
                    if (indicators) {
                        indicators.style.display = 'flex';
                        indicators.innerHTML = uniqueValidExamples.map((_, index) =>
                            `<button onclick="goToExample(${index})" class="w-2 h-2 rounded-full transition ${index === 0 ? 'bg-blue-600' : 'bg-gray-300'}"></button>`
                        ).join('');
                    }
                    if (leftArrow) leftArrow.style.display = 'block';
                    if (rightArrow) rightArrow.style.display = 'block';
                }

                // ÊñΩÂ∑•‰∫ã‰æã„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
                document.getElementById('preview-examples').style.display = 'block';
                console.log('[updateExamplesPreview] Display set to block');

                // üöÄ „Çø„ÉÉ„ÉÅ„Çπ„ÉØ„Ç§„ÉóÊ©üËÉΩ„ÇíÂàùÊúüÂåñÔºàÊñΩÂ∑•‰∫ã‰æã„Åå„ÅÇ„Çã„Å®„Åç„ÅÆ„ÅøÔºâ
                setTimeout(() => {
                    initializeExamplesSwipe();
                }, 100); // DOMÊõ¥Êñ∞Âæå„Å´ÂàùÊúüÂåñ
            } else {
                console.log('[updateExamplesPreview] No examples');
                document.getElementById('preview-examples').style.display = 'none';
            }
        }

        // üöÄ „Çπ„Éû„ÉõÁî®„Çø„ÉÉ„ÉÅ„Çπ„ÉØ„Ç§„ÉóÊ©üËÉΩ„ÇíÂàùÊúüÂåñ
        let swipeInitialized = false; // ÈáçË§áÂàùÊúüÂåñÈò≤Ê≠¢„Éï„É©„Ç∞
        function initializeExamplesSwipe() {
            if (swipeInitialized) {
                console.log('[initializeExamplesSwipe] Êó¢„Å´ÂàùÊúüÂåñÊ∏à„Åø„ÅÆ„Åü„ÇÅ „Çπ„Ç≠„ÉÉ„Éó');
                return;
            }

            const carousel = document.getElementById('examplesCarousel');
            const carouselList = document.getElementById('previewExamplesList');

            if (!carousel || !carouselList) {
                console.warn('[initializeExamplesSwipe] „Ç´„É´„Éº„Çª„É´Ë¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }

            swipeInitialized = true;

            let startX = 0;
            let currentX = 0;
            let startTransform = 0;
            let isDragging = false;
            let startTime = 0;
            let velocity = 0;
            let animationId = null;

            // „Çø„ÉÉ„ÉÅÈñãÂßã
            function handleTouchStart(e) {
                // „Éû„Ç¶„ÇπÊìç‰ΩúÊôÇ„ÅØÂ∑¶„ÇØ„É™„ÉÉ„ÇØ„ÅÆ„ÅøË®±ÂèØ
                if (e.type === 'mousedown' && e.button !== 0) return;

                const touch = e.touches ? e.touches[0] : e;
                startX = touch.clientX;
                currentX = startX;
                startTime = Date.now();
                isDragging = true;

                // ÁèæÂú®„ÅÆtransformÂÄ§„ÇíÂèñÂæó
                const style = window.getComputedStyle(carouselList);
                const matrix = new DOMMatrixReadOnly(style.transform);
                startTransform = matrix.m41 || 0;

                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÇíÂÅúÊ≠¢
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }

                // „Éà„É©„É≥„Ç∏„Ç∑„Éß„É≥„ÇíÁÑ°ÂäπÂåñÔºà„Éâ„É©„ÉÉ„Ç∞‰∏≠„ÅØÂç≥Â∫ß„Å´ÂèçÂøúÔºâ
                carouselList.style.transition = 'none';

                console.log('[handleTouchStart] Start:', { startX, startTransform });
            }

            // „Çø„ÉÉ„ÉÅÁßªÂãï‰∏≠
            function handleTouchMove(e) {
                if (!isDragging) return;

                // „Éû„Ç¶„ÇπÊìç‰ΩúÊôÇ„ÅØ„Éú„Çø„É≥„ÅåÊäº„Åï„Çå„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                if (e.type === 'mousemove' && !e.buttons) {
                    isDragging = false;
                    return;
                }

                e.preventDefault(); // „Çπ„ÇØ„É≠„Éº„É´Èò≤Ê≠¢

                const touch = e.touches ? e.touches[0] : e;
                currentX = touch.clientX;
                const deltaX = currentX - startX;

                // „É™„Ç¢„É´„Çø„Ç§„É†„Åß„Ç´„É´„Éº„Çª„É´„ÇíÁßªÂãï
                const newTransform = startTransform + deltaX;
                carouselList.style.transform = `translateX(${newTransform}px)`;

                // ÈÄüÂ∫¶Ë®àÁÆóÁî®
                const currentTime = Date.now();
                const timeDelta = currentTime - startTime;
                if (timeDelta > 0) {
                    velocity = deltaX / timeDelta; // px per ms
                }
            }

            // „Çø„ÉÉ„ÉÅÁµÇ‰∫Ü
            function handleTouchEnd(e) {
                if (!isDragging) return;
                isDragging = false;

                const deltaX = currentX - startX;
                const endTime = Date.now();
                const timeDelta = endTime - startTime;

                // „Éà„É©„É≥„Ç∏„Ç∑„Éß„É≥„ÇíÂæ©Ê¥ª
                carouselList.style.transition = 'transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';

                // „Çπ„ÉØ„Ç§„ÉóÂà§ÂÆö: 50px‰ª•‰∏ä„Åæ„Åü„ÅØÈÄüÂ∫¶„Åå0.3px/ms‰ª•‰∏ä
                const isSwipe = Math.abs(deltaX) > 50 || Math.abs(velocity) > 0.3;
                const direction = deltaX > 0 ? 'right' : 'left';

                console.log('[handleTouchEnd] Swipe:', {
                    deltaX,
                    timeDelta,
                    velocity,
                    isSwipe,
                    direction
                });

                if (isSwipe) {
                    // üöÄ „Éì„É•„É≥„Éì„É•„É≥ÂäπÊûú: ÈÄüÂ∫¶„Å´Âøú„Åò„Å¶„Çπ„É©„Ç§„Éâ
                    const swipeDirection = direction === 'right' ? 'left' : 'right';

                    // ÈÄüÂ∫¶„Å´Âøú„Åò„Å¶ÁßªÂãïË∑ùÈõ¢„ÇíÊ±∫ÂÆöÔºàÈ´òÈÄü„Çπ„ÉØ„Ç§„Éó„ÅßË§áÊï∞ÊûöÁßªÂãïÔºâ
                    let slidesToMove = 1;
                    if (Math.abs(velocity) > 0.8) {
                        slidesToMove = 2; // È´òÈÄü„Çπ„ÉØ„Ç§„Éó„Åß2ÊûöÁßªÂãï
                    } else if (Math.abs(velocity) > 1.2) {
                        slidesToMove = 3; // Ë∂ÖÈ´òÈÄü„Çπ„ÉØ„Ç§„Éó„Åß3ÊûöÁßªÂãï
                    }

                    // üöÄ „Éì„É•„É≥„Éì„É•„É≥ÈÄ£Á∂ö„Çπ„É©„Ç§„Éâ
                    for (let i = 0; i < slidesToMove; i++) {
                        setTimeout(() => {
                            scrollExamples(swipeDirection);
                        }, i * 150); // 150msÈñìÈöî„Åß„Çπ„É†„Éº„Ç∫„Å´ÈÄ£Á∂öÂÆüË°å
                    }

                    console.log('[handleTouchEnd] „Éì„É•„É≥„Éì„É•„É≥ÂäπÊûú:', {
                        velocity: Math.abs(velocity),
                        slidesToMove,
                        direction: swipeDirection
                    });
                } else {
                    // „Çπ„ÉØ„Ç§„ÉóÂà§ÂÆö„Åó„Å™„ÅÑÂ†¥Âêà„ÅØÂÖÉ„ÅÆ‰ΩçÁΩÆ„Å´Êàª„Çã
                    updateExamplesCarouselPosition();
                }
            }

            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºËøΩÂä†Ôºà„É¢„Éê„Ç§„É´ÂÑ™ÂÖàÔºâ
            carousel.addEventListener('touchstart', handleTouchStart, { passive: false });
            carousel.addEventListener('touchmove', handleTouchMove, { passive: false });
            carousel.addEventListener('touchend', handleTouchEnd, { passive: false });

            // „Éû„Ç¶„ÇπÊìç‰Ωú„ÇÇÂØæÂøúÔºàPCÁî®„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºâ
            carousel.addEventListener('mousedown', handleTouchStart);
            carousel.addEventListener('mousemove', handleTouchMove);
            carousel.addEventListener('mouseup', handleTouchEnd);
            carousel.addEventListener('mouseleave', handleTouchEnd); // „Ç´„Éº„ÇΩ„É´„ÅåÂ§ñ„Çå„ÅüÊôÇ„ÇÇÁµÇ‰∫Ü

            console.log('[initializeExamplesSwipe] üöÄ „Çπ„Éû„ÉõÁî®„Çø„ÉÉ„ÉÅ„Çπ„ÉØ„Ç§„ÉóÊ©üËÉΩ„ÇíÂàùÊúüÂåñÂÆå‰∫Ü');
        }

        // ÊñΩÂ∑•‰∫ã‰æã„Ç´„É´„Éº„Çª„É´„Çπ„ÇØ„É≠„Éº„É´
        function scrollExamples(direction) {
            const examples = (window.constructionExamples || constructionExamples).filter(e => (e.title || e.content) && (e.beforeImage || e.afterImage));
            const validExamples = getUniqueExamples(examples);
            if (validExamples.length === 0) return;

            if (direction === 'left') {
                currentExampleIndex--;
                // üöÄ ÊúÄÂàù„Çà„ÇäÂâç„Å´Ë°å„Å£„Åü„ÇâÊúÄÂæå„Å´„É´„Éº„Éó
                if (currentExampleIndex < 0) {
                    currentExampleIndex = validExamples.length - 1;
                }
            } else {
                currentExampleIndex++;
                // üöÄ ÊúÄÂæå„Çà„ÇäÂæå„Å´Ë°å„Å£„Åü„ÇâÊúÄÂàù„Å´„É´„Éº„Éó
                if (currentExampleIndex >= validExamples.length) {
                    currentExampleIndex = 0;
                }
            }

            console.log('[scrollExamples] üîÑ „É´„Éº„ÉóÊ©üËÉΩ:', {
                direction,
                currentIndex: currentExampleIndex,
                totalExamples: validExamples.length,
                isLooping: direction === 'left' ? currentExampleIndex === validExamples.length - 1 : currentExampleIndex === 0
            });

            updateExamplesCarouselPosition();
        }

        // ÁâπÂÆö„ÅÆÊñΩÂ∑•‰∫ã‰æã„Å∏ÁßªÂãï
        function goToExample(index) {
            const examples = (window.constructionExamples || constructionExamples).filter(e => (e.title || e.content) && (e.beforeImage || e.afterImage));
            const validExamples = getUniqueExamples(examples);

            // „Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÇíÊúâÂäπÁØÑÂõ≤ÂÜÖ„Å´Ë™øÊï¥
            currentExampleIndex = Math.max(0, Math.min(index, validExamples.length - 1));

            console.log('[goToExample] Áõ¥Êé•ÁßªÂãï:', {
                targetIndex: index,
                adjustedIndex: currentExampleIndex,
                totalExamples: validExamples.length
            });

            updateExamplesCarouselPosition();
        }

        // ÊñΩÂ∑•‰∫ã‰æã„Ç´„É´„Éº„Çª„É´‰ΩçÁΩÆÊõ¥Êñ∞
        function updateExamplesCarouselPosition() {
            const carousel = document.getElementById('previewExamplesList');
            const indicators = document.getElementById('examplesIndicators');
            const examples = (window.constructionExamples || constructionExamples).filter(e => (e.title || e.content) && (e.beforeImage || e.afterImage));
            const validExamples = getUniqueExamples(examples);

            console.log('[updateExamplesCarouselPosition] DEBUG: carousel:', !!carousel, 'validExamples.length:', validExamples.length);

            if (carousel && validExamples.length > 0) {
                // üöÄ ÂÆüÈöõ„ÅÆ„Ç´„Éº„ÉâË¶ÅÁ¥†„Åã„ÇâÂãïÁöÑ„Å´ÂπÖ„ÇíÂèñÂæó
                const firstCard = carousel.querySelector('.flex-shrink-0');
                if (!firstCard) {
                    console.warn('[updateExamplesCarouselPosition] „Ç´„Éº„ÉâË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                    return;
                }

                // ÂÆüÈöõ„ÅÆ„Ç´„Éº„ÉâÂπÖ + gap-4 (16px) „ÇíË®àÁÆó
                const cardRect = firstCard.getBoundingClientRect();
                const carouselRect = carousel.getBoundingClientRect();
                const gap = 16; // gap-4 = 16px

                // „Ç≥„É≥„ÉÜ„ÉäÂπÖ„Å´Âü∫„Å•„ÅÑ„Å¶„Ç´„Éº„ÉâÂπÖ„ÇíÊ±∫ÂÆö
                let cardWidth;
                if (window.innerWidth >= 768) { // md‰ª•‰∏äÔºàPCÔºâ
                    cardWidth = cardRect.width + gap;
                } else { // „É¢„Éê„Ç§„É´
                    cardWidth = carouselRect.width; // „Éï„É´widthÔºà1‰ª∂„Åö„Å§Ë°®Á§∫Ôºâ
                }

                // „Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÅØ scrollExamples() „ÅßÊó¢„Å´ÈÅ©Âàá„Å´„É´„Éº„ÉóÂá¶ÁêÜÊ∏à„Åø

                // 1‰ª∂„Åö„Å§Ê≠£Á¢∫„Å´„Çπ„É©„Ç§„Éâ
                const position = -currentExampleIndex * cardWidth;
                carousel.style.transform = `translateX(${position}px)`;

                console.log('[updateExamplesCarouselPosition] üîç Ë®àÁÆóË©≥Á¥∞:', {
                    currentExampleIndex,
                    totalExamples: validExamples.length,
                    cardWidth,
                    cardRectWidth: cardRect.width,
                    carouselWidth: carouselRect.width,
                    windowWidth: window.innerWidth,
                    position,
                    device: window.innerWidth >= 768 ? 'PC' : 'Mobile',
                    infiniteLoopReady: '‚úÖ 1‚Üí2‚Üí3‚Üí1‚Üí2‚Üí3‚Üí1...'
                });

                // „Ç§„É≥„Ç∏„Ç±„Éº„Çø„ÉºÊõ¥Êñ∞
                if (indicators) {
                    indicators.innerHTML = validExamples.map((_, index) => `
                        <button onclick="goToExample(${index})" class="w-2 h-2 rounded-full transition ${index === currentExampleIndex ? 'bg-blue-600' : 'bg-gray-300'}"></button>
                    `).join('');
                }
            } else {
                console.log('‚ö†Ô∏è [updateExamplesCarouselPosition] No valid examples or carousel');
            }
        }

        // „Ç®„É™„Ç¢ÈÅ∏ÊäûÈñ¢ÈÄ£Èñ¢Êï∞Ôºà„Ç∞„É≠„Éº„Éê„É´ÂåñÔºâ
        window.areaSelectionData = {
            prefectures: [],
            cities: {},
            priorities: [],
            totalCount: 0
        };
        const maxPrefectures = 5;
        const maxPriorityAreas = 3;

        // ÈÉΩÈÅìÂ∫úÁúå„É™„Çπ„Éà
        const allPrefectures = [
            'ÂåóÊµ∑ÈÅì', 'ÈùíÊ£ÆÁúå', 'Â≤©ÊâãÁúå', 'ÂÆÆÂüéÁúå', 'ÁßãÁî∞Áúå', 'Â±±ÂΩ¢Áúå', 'Á¶èÂ≥∂Áúå',
            'Ëå®ÂüéÁúå', 'Ê†ÉÊú®Áúå', 'Áæ§È¶¨Áúå', 'ÂüºÁéâÁúå', 'ÂçÉËëâÁúå', 'Êù±‰∫¨ÈÉΩ', 'Á•ûÂ•àÂ∑ùÁúå',
            'Êñ∞ÊΩüÁúå', 'ÂØåÂ±±Áúå', 'Áü≥Â∑ùÁúå', 'Á¶è‰∫ïÁúå', 'Â±±Ê¢®Áúå', 'Èï∑ÈáéÁúå', 'Â≤êÈòúÁúå',
            'ÈùôÂ≤°Áúå', 'ÊÑõÁü•Áúå', '‰∏âÈáçÁúå', 'ÊªãË≥ÄÁúå', '‰∫¨ÈÉΩÂ∫ú', 'Â§ßÈò™Â∫ú', 'ÂÖµÂ∫´Áúå',
            'Â•àËâØÁúå', 'ÂíåÊ≠åÂ±±Áúå', 'È≥•ÂèñÁúå', 'Â≥∂Ê†πÁúå', 'Â≤°Â±±Áúå', 'Â∫ÉÂ≥∂Áúå', 'Â±±Âè£Áúå',
            'Âæ≥Â≥∂Áúå', 'È¶ôÂ∑ùÁúå', 'ÊÑõÂ™õÁúå', 'È´òÁü•Áúå', 'Á¶èÂ≤°Áúå', '‰ΩêË≥ÄÁúå', 'Èï∑Â¥éÁúå',
            'ÁÜäÊú¨Áúå', 'Â§ßÂàÜÁúå', 'ÂÆÆÂ¥éÁúå', 'ÈπøÂÖêÂ≥∂Áúå', 'Ê≤ñÁ∏ÑÁúå'
        ];

        // Â∏ÇÂå∫Áî∫Êùë„Éá„Éº„Çø„Éô„Éº„Çπ
        // Â∏ÇÂå∫Áî∫Êùë„Éá„Éº„Çø„Éô„Éº„ÇπÔºà‰∏ªË¶Å11ÈÉΩÂ∫úÁúå„ÅÆÂÆåÂÖ®„Éá„Éº„ÇøÔºâ
        const cityDatabase = {
            'Êù±‰∫¨ÈÉΩ': [
                'ÂçÉ‰ª£Áî∞Âå∫', '‰∏≠Â§ÆÂå∫', 'Ê∏ØÂå∫', 'Êñ∞ÂÆøÂå∫', 'Êñá‰∫¨Âå∫', 'Âè∞Êù±Âå∫',
                'Â¢®Áî∞Âå∫', 'Ê±üÊù±Âå∫', 'ÂìÅÂ∑ùÂå∫', 'ÁõÆÈªíÂå∫', 'Â§ßÁî∞Âå∫', '‰∏ñÁî∞Ë∞∑Âå∫',
                'Ê∏ãË∞∑Âå∫', '‰∏≠ÈáéÂå∫', 'Êùâ‰∏¶Âå∫', 'Ë±äÂ≥∂Âå∫', 'ÂåóÂå∫', 'ËçíÂ∑ùÂå∫',
                'ÊùøÊ©ãÂå∫', 'Á∑¥È¶¨Âå∫', 'Ë∂≥Á´ãÂå∫', 'ËëõÈ£æÂå∫', 'Ê±üÊà∏Â∑ùÂå∫',
                'ÂÖ´ÁéãÂ≠êÂ∏Ç', 'Á´ãÂ∑ùÂ∏Ç', 'Ê≠¶ËîµÈáéÂ∏Ç', '‰∏âÈ∑πÂ∏Ç', 'ÈùíÊ¢ÖÂ∏Ç', 'Â∫ú‰∏≠Â∏Ç',
                'Êò≠Â≥∂Â∏Ç', 'Ë™øÂ∏ÉÂ∏Ç', 'Áî∫Áî∞Â∏Ç', 'Â∞èÈáë‰∫ïÂ∏Ç', 'Â∞èÂπ≥Â∏Ç', 'Êó•ÈáéÂ∏Ç',
                'Êù±ÊùëÂ±±Â∏Ç', 'ÂõΩÂàÜÂØ∫Â∏Ç', 'ÂõΩÁ´ãÂ∏Ç', 'Á¶èÁîüÂ∏Ç', 'ÁãõÊ±üÂ∏Ç', 'Êù±Â§ßÂíåÂ∏Ç',
                'Ê∏ÖÁÄ¨Â∏Ç', 'Êù±‰πÖÁïôÁ±≥Â∏Ç', 'Ê≠¶ËîµÊùëÂ±±Â∏Ç', 'Â§öÊë©Â∏Ç', 'Á®≤ÂüéÂ∏Ç', 'ÁæΩÊùëÂ∏Ç',
                '„ÅÇ„Åç„ÇãÈáéÂ∏Ç', 'Ë•øÊù±‰∫¨Â∏Ç', 'ÁëûÁ©ÇÁî∫', 'Êó•„ÅÆÂá∫Áî∫', 'Ê™úÂéüÊùë', 'Â••Â§öÊë©Áî∫'
            ],
            'Á•ûÂ•àÂ∑ùÁúå': [
                'Ê®™ÊµúÂ∏ÇÈ∂¥Ë¶ãÂå∫', 'Ê®™ÊµúÂ∏ÇÁ•ûÂ•àÂ∑ùÂå∫', 'Ê®™ÊµúÂ∏ÇË•øÂå∫', 'Ê®™ÊµúÂ∏Ç‰∏≠Âå∫',
                'Ê®™ÊµúÂ∏ÇÂçóÂå∫', 'Ê®™ÊµúÂ∏Ç‰øùÂúü„Ç±Ë∞∑Âå∫', 'Ê®™ÊµúÂ∏ÇÁ£ØÂ≠êÂå∫', 'Ê®™ÊµúÂ∏ÇÈáëÊ≤¢Âå∫',
                'Ê®™ÊµúÂ∏ÇÊ∏ØÂåóÂå∫', 'Ê®™ÊµúÂ∏ÇÊà∏Â°öÂå∫', 'Ê®™ÊµúÂ∏ÇÊ∏ØÂçóÂå∫', 'Ê®™ÊµúÂ∏ÇÊó≠Âå∫',
                'Ê®™ÊµúÂ∏ÇÁ∑ëÂå∫', 'Ê®™ÊµúÂ∏ÇÁÄ¨Ë∞∑Âå∫', 'Ê®™ÊµúÂ∏ÇÊ†ÑÂå∫', 'Ê®™ÊµúÂ∏ÇÊ≥âÂå∫',
                'Ê®™ÊµúÂ∏ÇÈùíËëâÂå∫', 'Ê®™ÊµúÂ∏ÇÈÉΩÁ≠ëÂå∫', 'Â∑ùÂ¥éÂ∏ÇÂ∑ùÂ¥éÂå∫', 'Â∑ùÂ¥éÂ∏ÇÂπ∏Âå∫',
                'Â∑ùÂ¥éÂ∏Ç‰∏≠ÂéüÂå∫', 'Â∑ùÂ¥éÂ∏ÇÈ´òÊ¥•Âå∫', 'Â∑ùÂ¥éÂ∏ÇÂ§öÊë©Âå∫', 'Â∑ùÂ¥éÂ∏ÇÂÆÆÂâçÂå∫',
                'Â∑ùÂ¥éÂ∏ÇÈ∫ªÁîüÂå∫', 'Áõ∏Ê®°ÂéüÂ∏ÇÁ∑ëÂå∫', 'Áõ∏Ê®°ÂéüÂ∏Ç‰∏≠Â§ÆÂå∫', 'Áõ∏Ê®°ÂéüÂ∏ÇÂçóÂå∫',
                'Ê®™È†àË≥ÄÂ∏Ç', 'Âπ≥Â°öÂ∏Ç', 'ÈéåÂÄâÂ∏Ç', 'Ëó§Ê≤¢Â∏Ç', 'Â∞èÁî∞ÂéüÂ∏Ç', 'ËåÖ„É∂Â¥éÂ∏Ç',
                'ÈÄóÂ≠êÂ∏Ç', '‰∏âÊµ¶Â∏Ç', 'Áß¶ÈáéÂ∏Ç', 'ÂéöÊú®Â∏Ç', 'Â§ßÂíåÂ∏Ç', '‰ºäÂã¢ÂéüÂ∏Ç',
                'Êµ∑ËÄÅÂêçÂ∏Ç', 'Â∫ßÈñìÂ∏Ç', 'ÂçóË∂≥ÊüÑÂ∏Ç', 'Á∂æÁÄ¨Â∏Ç'
            ],
            'ÂüºÁéâÁúå': [
                '„Åï„ÅÑ„Åü„ÅæÂ∏ÇË•øÂå∫', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂåóÂå∫', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂ§ßÂÆÆÂå∫', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇË¶ãÊ≤ºÂå∫',
                '„Åï„ÅÑ„Åü„ÅæÂ∏Ç‰∏≠Â§ÆÂå∫', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÊ°úÂå∫', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÊµ¶ÂíåÂå∫', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂçóÂå∫',
                '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÁ∑ëÂå∫', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂ≤©ÊßªÂå∫', 'Â∑ùË∂äÂ∏Ç', 'ÁÜäË∞∑Â∏Ç', 'Â∑ùÂè£Â∏Ç',
                'Ë°åÁî∞Â∏Ç', 'Áß©Áà∂Â∏Ç', 'ÊâÄÊ≤¢Â∏Ç', 'È£ØËÉΩÂ∏Ç', 'Âä†È†àÂ∏Ç', 'Êú¨Â∫ÑÂ∏Ç',
                'Êù±ÊùæÂ±±Â∏Ç', 'Êò•Êó•ÈÉ®Â∏Ç', 'Áã≠Â±±Â∏Ç', 'ÁæΩÁîüÂ∏Ç', 'È¥ªÂ∑£Â∏Ç', 'Ê∑±Ë∞∑Â∏Ç',
                '‰∏äÂ∞æÂ∏Ç', 'ËçâÂä†Â∏Ç', 'Ë∂äË∞∑Â∏Ç', 'Ëï®Â∏Ç', 'Êà∏Áî∞Â∏Ç', 'ÂÖ•ÈñìÂ∏Ç',
                'ÊúùÈúûÂ∏Ç', 'ÂøóÊú®Â∏Ç', 'ÂíåÂÖâÂ∏Ç', 'Êñ∞Â∫ßÂ∏Ç', 'Ê°∂Â∑ùÂ∏Ç', '‰πÖÂñúÂ∏Ç',
                'ÂåóÊú¨Â∏Ç', 'ÂÖ´ÊΩÆÂ∏Ç', 'ÂØåÂ£´Ë¶ãÂ∏Ç', '‰∏âÈÉ∑Â∏Ç', 'ËìÆÁî∞Â∏Ç', 'ÂùÇÊà∏Â∏Ç',
                'Âπ∏ÊâãÂ∏Ç', 'È∂¥„É∂Â≥∂Â∏Ç', 'Êó•È´òÂ∏Ç', 'ÂêâÂ∑ùÂ∏Ç', '„Åµ„Åò„ÅøÈáéÂ∏Ç', 'ÁôΩÂ≤°Â∏Ç'
            ],
            'ÂçÉËëâÁúå': [
                'ÂçÉËëâÂ∏Ç‰∏≠Â§ÆÂå∫', 'ÂçÉËëâÂ∏ÇËä±Ë¶ãÂ∑ùÂå∫', 'ÂçÉËëâÂ∏ÇÁ®≤ÊØõÂå∫', 'ÂçÉËëâÂ∏ÇËã•ËëâÂå∫',
                'ÂçÉËëâÂ∏ÇÁ∑ëÂå∫', 'ÂçÉËëâÂ∏ÇÁæéÊµúÂå∫', 'ÈäöÂ≠êÂ∏Ç', 'Â∏ÇÂ∑ùÂ∏Ç', 'ËàπÊ©ãÂ∏Ç',
                'È§®Â±±Â∏Ç', 'Êú®Êõ¥Ê¥•Â∏Ç', 'ÊùæÊà∏Â∏Ç', 'ÈáéÁî∞Â∏Ç', 'ËåÇÂéüÂ∏Ç', 'ÊàêÁî∞Â∏Ç',
                '‰ΩêÂÄâÂ∏Ç', 'Êù±ÈáëÂ∏Ç', 'Êó≠Â∏Ç', 'ÁøíÂøóÈáéÂ∏Ç', 'ÊüèÂ∏Ç', 'ÂãùÊµ¶Â∏Ç',
                'Â∏ÇÂéüÂ∏Ç', 'ÊµÅÂ±±Â∏Ç', 'ÂÖ´ÂçÉ‰ª£Â∏Ç', 'ÊàëÂ≠´Â≠êÂ∏Ç', 'È¥®Â∑ùÂ∏Ç', 'Èéå„Ç±Ë∞∑Â∏Ç',
                'ÂêõÊ¥•Â∏Ç', 'ÂØåÊ¥•Â∏Ç', 'Êµ¶ÂÆâÂ∏Ç', 'ÂõõË°óÈÅìÂ∏Ç', 'Ë¢ñ„Ç±Êµ¶Â∏Ç', 'ÂÖ´Ë°óÂ∏Ç',
                'Âç∞Ë•øÂ∏Ç', 'ÁôΩ‰∫ïÂ∏Ç', 'ÂØåÈáåÂ∏Ç', 'ÂçóÊàøÁ∑èÂ∏Ç', 'ÂåùÁë≥Â∏Ç', 'È¶ôÂèñÂ∏Ç',
                'Â±±Ê≠¶Â∏Ç', '„ÅÑ„Åô„ÅøÂ∏Ç', 'Â§ßÁ∂≤ÁôΩÈáåÂ∏Ç'
            ],
            'Â≤êÈòúÁúå': [
                'Â≤êÈòúÂ∏Ç', 'Â§ßÂû£Â∏Ç', 'È´òÂ±±Â∏Ç', 'Â§öÊ≤ªË¶ãÂ∏Ç', 'Èñ¢Â∏Ç', '‰∏≠Ê¥•Â∑ùÂ∏Ç',
                'ÁæéÊøÉÂ∏Ç', 'ÁëûÊµ™Â∏Ç', 'ÁæΩÂ≥∂Â∏Ç', 'ÊÅµÈÇ£Â∏Ç', 'ÁæéÊøÉÂä†ËåÇÂ∏Ç', 'ÂúüÂ≤êÂ∏Ç',
                'ÂêÑÂãôÂéüÂ∏Ç', 'ÂèØÂÖêÂ∏Ç', 'Â±±ÁúåÂ∏Ç', 'ÁëûÁ©ÇÂ∏Ç', 'È£õÈ®®Â∏Ç', 'Êú¨Â∑£Â∏Ç',
                'ÈÉ°‰∏äÂ∏Ç', '‰∏ãÂëÇÂ∏Ç', 'Êµ∑Ê¥•Â∏Ç'
            ],
            'ÊÑõÁü•Áúå': [
                'ÂêçÂè§Â±ãÂ∏ÇÂçÉÁ®ÆÂå∫', 'ÂêçÂè§Â±ãÂ∏ÇÊù±Âå∫', 'ÂêçÂè§Â±ãÂ∏ÇÂåóÂå∫', 'ÂêçÂè§Â±ãÂ∏ÇË•øÂå∫',
                'ÂêçÂè§Â±ãÂ∏Ç‰∏≠ÊùëÂå∫', 'ÂêçÂè§Â±ãÂ∏Ç‰∏≠Âå∫', 'ÂêçÂè§Â±ãÂ∏ÇÊò≠ÂíåÂå∫', 'ÂêçÂè§Â±ãÂ∏ÇÁëûÁ©ÇÂå∫',
                'ÂêçÂè§Â±ãÂ∏ÇÁÜ±Áî∞Âå∫', 'ÂêçÂè§Â±ãÂ∏Ç‰∏≠Â∑ùÂå∫', 'ÂêçÂè§Â±ãÂ∏ÇÊ∏ØÂå∫', 'ÂêçÂè§Â±ãÂ∏ÇÂçóÂå∫',
                'ÂêçÂè§Â±ãÂ∏ÇÂÆàÂ±±Âå∫', 'ÂêçÂè§Â±ãÂ∏ÇÁ∑ëÂå∫', 'ÂêçÂè§Â±ãÂ∏ÇÂêçÊù±Âå∫', 'ÂêçÂè§Â±ãÂ∏ÇÂ§©ÁôΩÂå∫',
                'Ë±äÊ©ãÂ∏Ç', 'Â≤°Â¥éÂ∏Ç', '‰∏ÄÂÆÆÂ∏Ç', 'ÁÄ¨Êà∏Â∏Ç', 'ÂçäÁî∞Â∏Ç', 'Êò•Êó•‰∫ïÂ∏Ç',
                'Ë±äÂ∑ùÂ∏Ç', 'Ê¥•Â≥∂Â∏Ç', 'Á¢ßÂçóÂ∏Ç', 'ÂààË∞∑Â∏Ç', 'Ë±äÁî∞Â∏Ç', 'ÂÆâÂüéÂ∏Ç',
                'Ë•øÂ∞æÂ∏Ç', 'Ëí≤ÈÉ°Â∏Ç', 'Áä¨Â±±Â∏Ç', 'Â∏∏ÊªëÂ∏Ç', 'Ê±üÂçóÂ∏Ç', 'Â∞èÁâßÂ∏Ç',
                'Á®≤Ê≤¢Â∏Ç', 'Êñ∞ÂüéÂ∏Ç', 'Êù±Êµ∑Â∏Ç', 'Â§ßÂ∫úÂ∏Ç', 'Áü•Â§öÂ∏Ç', 'Áü•Á´ãÂ∏Ç',
                'Â∞æÂºµÊó≠Â∏Ç', 'È´òÊµúÂ∏Ç', 'Â≤©ÂÄâÂ∏Ç', 'Ë±äÊòéÂ∏Ç', 'Êó•ÈÄ≤Â∏Ç', 'Áî∞ÂéüÂ∏Ç',
                'ÊÑõË•øÂ∏Ç', 'Ê∏ÖÈ†àÂ∏Ç', 'ÂåóÂêçÂè§Â±ãÂ∏Ç', 'Âº•ÂØåÂ∏Ç', '„Åø„Çà„ÅóÂ∏Ç', '„ÅÇ„ÅæÂ∏Ç',
                'Èï∑‰πÖÊâãÂ∏Ç'
            ],
            'Â§ßÈò™Â∫ú': [
                'Â§ßÈò™Â∏ÇÈÉΩÂ≥∂Âå∫', 'Â§ßÈò™Â∏ÇÁ¶èÂ≥∂Âå∫', 'Â§ßÈò™Â∏ÇÊ≠§Ëä±Âå∫', 'Â§ßÈò™Â∏ÇË•øÂå∫',
                'Â§ßÈò™Â∏ÇÊ∏ØÂå∫', 'Â§ßÈò™Â∏ÇÂ§ßÊ≠£Âå∫', 'Â§ßÈò™Â∏ÇÂ§©ÁéãÂØ∫Âå∫', 'Â§ßÈò™Â∏ÇÊµ™ÈÄüÂå∫',
                'Â§ßÈò™Â∏ÇË•øÊ∑ÄÂ∑ùÂå∫', 'Â§ßÈò™Â∏ÇÊù±Ê∑ÄÂ∑ùÂå∫', 'Â§ßÈò™Â∏ÇÊù±ÊàêÂå∫', 'Â§ßÈò™Â∏ÇÁîüÈáéÂå∫',
                'Â§ßÈò™Â∏ÇÊó≠Âå∫', 'Â§ßÈò™Â∏ÇÂüéÊù±Âå∫', 'Â§ßÈò™Â∏ÇÈòøÂÄçÈáéÂå∫', 'Â§ßÈò™Â∏Ç‰ΩèÂêâÂå∫',
                'Â§ßÈò™Â∏ÇÊù±‰ΩèÂêâÂå∫', 'Â§ßÈò™Â∏ÇË•øÊàêÂå∫', 'Â§ßÈò™Â∏ÇÊ∑ÄÂ∑ùÂå∫', 'Â§ßÈò™Â∏ÇÈ∂¥Ë¶ãÂå∫',
                'Â§ßÈò™Â∏Ç‰Ωè‰πãÊ±üÂå∫', 'Â§ßÈò™Â∏ÇÂπ≥ÈáéÂå∫', 'Â§ßÈò™Â∏ÇÂåóÂå∫', 'Â§ßÈò™Â∏Ç‰∏≠Â§ÆÂå∫',
                'Â†∫Â∏ÇÂ†∫Âå∫', 'Â†∫Â∏Ç‰∏≠Âå∫', 'Â†∫Â∏ÇÊù±Âå∫', 'Â†∫Â∏ÇË•øÂå∫', 'Â†∫Â∏ÇÂçóÂå∫',
                'Â†∫Â∏ÇÂåóÂå∫', 'Â†∫Â∏ÇÁæéÂéüÂå∫', 'Â≤∏ÂíåÁî∞Â∏Ç', 'Ë±ä‰∏≠Â∏Ç', 'Ê±†Áî∞Â∏Ç',
                'ÂêπÁî∞Â∏Ç', 'Ê≥âÂ§ßÊ¥•Â∏Ç', 'È´òÊßªÂ∏Ç', 'Ë≤ùÂ°öÂ∏Ç', 'ÂÆàÂè£Â∏Ç', 'ÊûöÊñπÂ∏Ç',
                'Ëå®Êú®Â∏Ç', 'ÂÖ´Â∞æÂ∏Ç', 'Ê≥â‰ΩêÈáéÂ∏Ç', 'ÂØåÁî∞ÊûóÂ∏Ç', 'ÂØùÂ±ãÂ∑ùÂ∏Ç', 'Ê≤≥ÂÜÖÈï∑ÈáéÂ∏Ç',
                'ÊùæÂéüÂ∏Ç', 'Â§ßÊù±Â∏Ç', 'ÂíåÊ≥âÂ∏Ç', 'ÁÆïÈù¢Â∏Ç', 'ÊüèÂéüÂ∏Ç', 'ÁæΩÊõ≥ÈáéÂ∏Ç',
                'ÈñÄÁúüÂ∏Ç', 'ÊëÇÊ¥•Â∏Ç', 'È´òÁü≥Â∏Ç', 'Ëó§‰∫ïÂØ∫Â∏Ç', 'Êù±Â§ßÈò™Â∏Ç', 'Ê≥âÂçóÂ∏Ç',
                'ÂõõÊ¢ùÁï∑Â∏Ç', '‰∫§ÈáéÂ∏Ç', 'Â§ßÈò™Áã≠Â±±Â∏Ç', 'Èò™ÂçóÂ∏Ç'
            ],
            '‰∫¨ÈÉΩÂ∫ú': [
                '‰∫¨ÈÉΩÂ∏ÇÂåóÂå∫', '‰∫¨ÈÉΩÂ∏Ç‰∏ä‰∫¨Âå∫', '‰∫¨ÈÉΩÂ∏ÇÂ∑¶‰∫¨Âå∫', '‰∫¨ÈÉΩÂ∏Ç‰∏≠‰∫¨Âå∫',
                '‰∫¨ÈÉΩÂ∏ÇÊù±Â±±Âå∫', '‰∫¨ÈÉΩÂ∏Ç‰∏ã‰∫¨Âå∫', '‰∫¨ÈÉΩÂ∏ÇÂçóÂå∫', '‰∫¨ÈÉΩÂ∏ÇÂè≥‰∫¨Âå∫',
                '‰∫¨ÈÉΩÂ∏Ç‰ºèË¶ãÂå∫', '‰∫¨ÈÉΩÂ∏ÇÂ±±ÁßëÂå∫', '‰∫¨ÈÉΩÂ∏ÇË•ø‰∫¨Âå∫', 'Á¶èÁü•Â±±Â∏Ç',
                'ËàûÈ∂¥Â∏Ç', 'Á∂æÈÉ®Â∏Ç', 'ÂÆáÊ≤ªÂ∏Ç', 'ÂÆÆÊ¥•Â∏Ç', '‰∫ÄÂ≤°Â∏Ç', 'ÂüéÈôΩÂ∏Ç',
                'ÂêëÊó•Â∏Ç', 'Èï∑Â≤°‰∫¨Â∏Ç', 'ÂÖ´Âπ°Â∏Ç', '‰∫¨Áî∞Ëæ∫Â∏Ç', '‰∫¨‰∏πÂæåÂ∏Ç', 'Âçó‰∏πÂ∏Ç',
                'Êú®Ê¥•Â∑ùÂ∏Ç'
            ],
            'ÂÖµÂ∫´Áúå': [
                'Á•ûÊà∏Â∏ÇÊù±ÁÅòÂå∫', 'Á•ûÊà∏Â∏ÇÁÅòÂå∫', 'Á•ûÊà∏Â∏ÇÂÖµÂ∫´Âå∫', 'Á•ûÊà∏Â∏ÇÈï∑Áî∞Âå∫',
                'Á•ûÊà∏Â∏ÇÈ†àÁ£®Âå∫', 'Á•ûÊà∏Â∏ÇÂûÇÊ∞¥Âå∫', 'Á•ûÊà∏Â∏ÇÂåóÂå∫', 'Á•ûÊà∏Â∏Ç‰∏≠Â§ÆÂå∫',
                'Á•ûÊà∏Â∏ÇË•øÂå∫', 'Âß´Ë∑ØÂ∏Ç', 'Â∞ºÂ¥éÂ∏Ç', 'ÊòéÁü≥Â∏Ç', 'Ë•øÂÆÆÂ∏Ç', 'Ê¥≤Êú¨Â∏Ç',
                'Ëä¶Â±ãÂ∏Ç', '‰ºä‰∏πÂ∏Ç', 'Áõ∏ÁîüÂ∏Ç', 'Ë±äÂ≤°Â∏Ç', 'Âä†Âè§Â∑ùÂ∏Ç', 'Ëµ§Á©ÇÂ∏Ç',
                'Ë•øËÑáÂ∏Ç', 'ÂÆùÂ°öÂ∏Ç', '‰∏âÊú®Â∏Ç', 'È´òÁ†ÇÂ∏Ç', 'Â∑ùË•øÂ∏Ç', 'Â∞èÈáéÂ∏Ç',
                '‰∏âÁî∞Â∏Ç', 'Âä†Ë•øÂ∏Ç', '‰∏πÊ≥¢ÁØ†Â±±Â∏Ç', 'È§äÁà∂Â∏Ç', '‰∏πÊ≥¢Â∏Ç', 'Âçó„ÅÇ„Çè„ÅòÂ∏Ç',
                'ÊúùÊù•Â∏Ç', 'Ê∑°Ë∑ØÂ∏Ç', 'ÂÆçÁ≤üÂ∏Ç', 'Âä†Êù±Â∏Ç', '„Åü„Å§„ÅÆÂ∏Ç'
            ],
            'Â•àËâØÁúå': [
                'Â•àËâØÂ∏Ç', 'Â§ßÂíåÈ´òÁî∞Â∏Ç', 'Â§ßÂíåÈÉ°Â±±Â∏Ç', 'Â§©ÁêÜÂ∏Ç', 'Ê©øÂéüÂ∏Ç', 'Ê°ú‰∫ïÂ∏Ç',
                '‰∫îÊ¢ùÂ∏Ç', 'Âæ°ÊâÄÂ∏Ç', 'ÁîüÈßíÂ∏Ç', 'È¶ôËäùÂ∏Ç', 'ËëõÂüéÂ∏Ç', 'ÂÆáÈôÄÂ∏Ç'
            ],
            'ÊÑõÂ™õÁúå': [
                'ÊùæÂ±±Â∏Ç', '‰ªäÊ≤ªÂ∏Ç', 'ÂÆáÂíåÂ≥∂Â∏Ç', 'ÂÖ´Âπ°ÊµúÂ∏Ç', 'Êñ∞Â±ÖÊµúÂ∏Ç', 'Ë•øÊù°Â∏Ç',
                'Â§ßÊ¥≤Â∏Ç', '‰ºä‰∫àÂ∏Ç', 'ÂõõÂõΩ‰∏≠Â§ÆÂ∏Ç', 'Ë•ø‰∫àÂ∏Ç', 'Êù±Ê∏©Â∏Ç'
            ]
        };

        // „Éá„Éï„Ç©„É´„Éà„ÅÆÂ∏ÇÂå∫Áî∫Êùë„É™„Çπ„ÉàÔºà‰∏ªË¶Å10Â∏ÇÔºâ- Âä†ÁõüÂ∫óÁôªÈå≤„Ç∑„Çπ„ÉÜ„É†„Å®ÂêåÊúü
        const defaultCities = {
            'ÂåóÊµ∑ÈÅì': ['Êú≠ÂπåÂ∏Ç', 'ÂáΩÈ§®Â∏Ç', 'Â∞èÊ®ΩÂ∏Ç', 'Êó≠Â∑ùÂ∏Ç', 'ÂÆ§Ëò≠Â∏Ç', 'ÈáßË∑ØÂ∏Ç', 'Â∏ØÂ∫ÉÂ∏Ç', 'ÂåóË¶ãÂ∏Ç', 'Â§ïÂºµÂ∏Ç', 'Â≤©Ë¶ãÊ≤¢Â∏Ç'],
            'ÈùíÊ£ÆÁúå': ['ÈùíÊ£ÆÂ∏Ç', 'ÂºòÂâçÂ∏Ç', 'ÂÖ´Êà∏Â∏Ç', 'ÈªíÁü≥Â∏Ç', '‰∫îÊâÄÂ∑ùÂéüÂ∏Ç', 'ÂçÅÂíåÁî∞Â∏Ç', '‰∏âÊ≤¢Â∏Ç', '„ÇÄ„Å§Â∏Ç', '„Å§„Åå„ÇãÂ∏Ç', 'Âπ≥Â∑ùÂ∏Ç'],
            'Â≤©ÊâãÁúå': ['ÁõõÂ≤°Â∏Ç', 'ÂÆÆÂè§Â∏Ç', 'Â§ßËàπÊ∏°Â∏Ç', 'Ëä±Â∑ªÂ∏Ç', 'Âåó‰∏äÂ∏Ç', '‰πÖÊÖàÂ∏Ç', 'ÈÅ†ÈáéÂ∏Ç', '‰∏ÄÈñ¢Â∏Ç', 'Èô∏ÂâçÈ´òÁî∞Â∏Ç', 'ÈáúÁü≥Â∏Ç'],
            'ÂÆÆÂüéÁúå': ['‰ªôÂè∞Â∏ÇÈùíËëâÂå∫', '‰ªôÂè∞Â∏ÇÂÆÆÂüéÈáéÂå∫', '‰ªôÂè∞Â∏ÇËã•ÊûóÂå∫', '‰ªôÂè∞Â∏ÇÂ§™ÁôΩÂå∫', '‰ªôÂè∞Â∏ÇÊ≥âÂå∫', 'Áü≥Â∑ªÂ∏Ç', 'Â°©Á´àÂ∏Ç', 'Ê∞ó‰ªôÊ≤ºÂ∏Ç', 'ÁôΩÁü≥Â∏Ç', 'ÂêçÂèñÂ∏Ç'],
            'ÁßãÁî∞Áúå': ['ÁßãÁî∞Â∏Ç', 'ËÉΩ‰ª£Â∏Ç', 'Ê®™ÊâãÂ∏Ç', 'Â§ßÈ§®Â∏Ç', 'Áî∑ÈπøÂ∏Ç', 'ÊπØÊ≤¢Â∏Ç', 'ÈπøËßíÂ∏Ç', 'Áî±Âà©Êú¨ËçòÂ∏Ç', 'ÊΩü‰∏äÂ∏Ç', 'Â§ß‰ªôÂ∏Ç'],
            'Â±±ÂΩ¢Áúå': ['Â±±ÂΩ¢Â∏Ç', 'Á±≥Ê≤¢Â∏Ç', 'È∂¥Â≤°Â∏Ç', 'ÈÖíÁî∞Â∏Ç', 'Êñ∞Â∫ÑÂ∏Ç', 'ÂØíÊ≤≥Ê±üÂ∏Ç', '‰∏äÂ±±Â∏Ç', 'ÊùëÂ±±Â∏Ç', 'Èï∑‰∫ïÂ∏Ç', 'Â§©Á´•Â∏Ç'],
            'Á¶èÂ≥∂Áúå': ['Á¶èÂ≥∂Â∏Ç', '‰ºöÊ¥•Ëã•ÊùæÂ∏Ç', 'ÈÉ°Â±±Â∏Ç', '„ÅÑ„Çè„ÅçÂ∏Ç', 'ÁôΩÊ≤≥Â∏Ç', 'È†àË≥ÄÂ∑ùÂ∏Ç', 'ÂñúÂ§öÊñπÂ∏Ç', 'Áõ∏È¶¨Â∏Ç', '‰∫åÊú¨ÊùæÂ∏Ç', 'Áî∞ÊùëÂ∏Ç']
        };

        // Â∏ÇÂå∫Áî∫Êùë„ÅÆÂèñÂæóÔºàÂä†ÁõüÂ∫óÁôªÈå≤„Ç∑„Çπ„ÉÜ„É†„Å®Âêå„Åò„É≠„Ç∏„ÉÉ„ÇØÔºâ
        function getCitiesForPrefecture(prefecture) {
            // „Åæ„ÅöÂÆåÂÖ®„Éá„Éº„Çø„ÇíÁ¢∫Ë™ç
            if (cityDatabase[prefecture]) {
                return cityDatabase[prefecture];
            }
            // „Éá„Éï„Ç©„É´„Éà„ÅÆ‰∏ªË¶Å10Â∏Ç„ÇíËøî„Åô
            if (defaultCities[prefecture]) {
                return defaultCities[prefecture];
            }
            // Ë©≤ÂΩì„Å™„Åó„ÅÆÂ†¥Âêà„ÅØ„ÄåÂÖ®Âüü„Äç
            return ['ÂÖ®Âüü'];
        }

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´ÈÉΩÈÅìÂ∫úÁúå„Éú„Çø„É≥„ÇíÁîüÊàê
        document.addEventListener('DOMContentLoaded', function() {
            initializeAreaSelection();
        });

        // „Ç®„É™„Ç¢ÈÅ∏Êäû„ÇíÂàùÊúüÂåñ
        function initializeAreaSelection() {
            const grid = document.getElementById('allPrefecturesGrid');
            if (!grid) return;

            grid.innerHTML = allPrefectures.map(pref => `
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm"
                        data-prefecture="${pref}"
                        onclick="togglePrefecture('${pref}')">
                    ${pref}
                </button>
            `).join('');
        }

        // ÈÉΩÈÅìÂ∫úÁúåÈÅ∏Êäû„Éà„Ç∞„É´
        function togglePrefecture(prefecture) {
            const button = document.querySelector(`[data-prefecture="${prefecture}"]`);
            const isSelected = button.classList.contains('selected');

            if (isSelected) {
                // ÈÅ∏ÊäûËß£Èô§
                button.classList.remove('selected', 'bg-blue-500', 'text-white');
                button.classList.add('bg-white');
                window.areaSelectionData.prefectures = window.areaSelectionData.prefectures.filter(p => p !== prefecture);
                delete window.areaSelectionData.cities[prefecture];
                window.areaSelectionData.priorities = window.areaSelectionData.priorities.filter(p => !p.startsWith(prefecture));
            } else {
                // ÈÅ∏Êäû‰∏äÈôê„ÉÅ„Çß„ÉÉ„ÇØ
                if (window.areaSelectionData.prefectures.length >= maxPrefectures) {
                    showNotification('‰∏äÈôê„ÇíË∂Ö„Åà„Åæ„Åó„Åü', `ÈÉΩÈÅìÂ∫úÁúå„ÅØÊúÄÂ§ß${maxPrefectures}„Å§„Åæ„ÅßÈÅ∏ÊäûÂèØËÉΩ„Åß„Åô`);
                    return;
                }
                // ÈÅ∏ÊäûËøΩÂä†
                button.classList.add('selected', 'bg-blue-500', 'text-white');
                button.classList.remove('bg-white');
                window.areaSelectionData.prefectures.push(prefecture);
                // „Éá„Éï„Ç©„É´„Éà„ÅßÂÖ®Â∏ÇÂå∫Áî∫Êùë„ÇíÈÅ∏Êäû
                window.areaSelectionData.cities[prefecture] = getCitiesForPrefecture(prefecture);
            }

            updateAreaSelectionUI();
        }

        // „Ç®„É™„Ç¢ÈÅ∏ÊäûUIÊõ¥Êñ∞
        function updateAreaSelectionUI() {
            // „Ç´„Ç¶„É≥„ÉàÊõ¥Êñ∞
            const prefCountEl = document.getElementById('selectedPrefCount');
            const cityCountEl = document.getElementById('selectedCityCount');

            if (prefCountEl) {
                prefCountEl.textContent = window.areaSelectionData.prefectures.length;
            }

            const totalCities = Object.values(window.areaSelectionData.cities).reduce((sum, cities) => sum + cities.length, 0);
            if (cityCountEl) {
                cityCountEl.textContent = totalCities;
            }
            window.areaSelectionData.totalCount = totalCities;

            // Â∏ÇÂå∫Áî∫ÊùëÈÅ∏Êäû„Ç®„É™„Ç¢„ÅÆË°®Á§∫/ÈùûË°®Á§∫
            const cityArea = document.getElementById('citySelectionArea');
            if (cityArea) {
                if (window.areaSelectionData.prefectures.length > 0) {
                    cityArea.classList.remove('hidden');
                    updateCitySelectionArea();
                } else {
                    cityArea.classList.add('hidden');
                }
            }

            // ÂÑ™ÂÖà„Ç®„É™„Ç¢Ë®≠ÂÆö„ÅÆË°®Á§∫/ÈùûË°®Á§∫
            const priorityArea = document.getElementById('priorityArea');
            if (priorityArea) {
                if (totalCities > 0) {
                    priorityArea.classList.remove('hidden');
                    updatePriorityArea();
                } else {
                    priorityArea.classList.add('hidden');
                }
            }

            // Á¢∫Ë™ç„Éú„Çø„É≥„ÅÆÊúâÂäπ/ÁÑ°Âäπ
            const confirmBtn = document.getElementById('areaConfirmBtn');
            if (confirmBtn) {
                confirmBtn.disabled = window.areaSelectionData.prefectures.length === 0;
            }
        }

        // Â∏ÇÂå∫Áî∫ÊùëÈÅ∏Êäû„Ç®„É™„Ç¢Êõ¥Êñ∞
        function updateCitySelectionArea() {
            const cityContainer = document.getElementById('cityListContainer');
            if (!cityContainer) return;

            cityContainer.innerHTML = window.areaSelectionData.prefectures.map(prefecture => {
                const allCities = getCitiesForPrefecture(prefecture);
                const selectedCities = window.areaSelectionData.cities[prefecture] || [];

                return `
                    <div class="border rounded-lg p-4">
                        <div class="mb-3">
                            <div class="flex justify-between items-center mb-2">
                                <h5 class="font-medium text-lg">${prefecture}</h5>
                                <span class="text-sm text-gray-600">
                                    ${selectedCities.length} / ${allCities.length} ÈÅ∏Êäû‰∏≠
                                </span>
                            </div>
                            <label class="flex items-center cursor-pointer hover:bg-gray-50 p-1 rounded">
                                <input type="checkbox"
                                       ${selectedCities.length === allCities.length ? 'checked' : ''}
                                       onchange="toggleAllCities('${prefecture}', this.checked)">
                                <span class="ml-2 text-sm font-medium">„Åô„Åπ„Å¶ÈÅ∏Êäû</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                            ${allCities.map(city => `
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox"
                                           value="${city}"
                                           ${selectedCities.includes(city) ? 'checked' : ''}
                                           onchange="toggleCity('${prefecture}', '${city}', this.checked)">
                                    <span class="ml-2 text-sm">${city}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Â∏ÇÂå∫Áî∫ÊùëÈÅ∏Êäû„Éà„Ç∞„É´
        function toggleCity(prefecture, city, checked) {
            console.log('[toggleCity]', prefecture, city, checked);
            // window.areaSelectionData„ÇíÁ¢∫ÂÆü„Å´‰ΩøÁî®
            if (!window.areaSelectionData.cities[prefecture]) {
                window.areaSelectionData.cities[prefecture] = [];
            }

            if (checked) {
                if (!window.areaSelectionData.cities[prefecture].includes(city)) {
                    window.areaSelectionData.cities[prefecture].push(city);
                }
            } else {
                window.areaSelectionData.cities[prefecture] = window.areaSelectionData.cities[prefecture].filter(c => c !== city);
                // ÂÑ™ÂÖà„Ç®„É™„Ç¢„Åã„Çâ„ÇÇÂâäÈô§
                const priorityKey = `${prefecture}_${city}`;
                window.areaSelectionData.priorities = window.areaSelectionData.priorities.filter(p => p !== priorityKey);
            }

            console.log('[toggleCity] Updated cities:', window.areaSelectionData.cities);
            updateAreaSelectionUI();
        }

        // ÂÖ®Â∏ÇÂå∫Áî∫ÊùëÈÅ∏ÊäûÂàá„ÇäÊõø„Åà
        function toggleAllCities(prefecture, checked) {
            console.log('[toggleAllCities]', prefecture, checked);
            const allCities = getCitiesForPrefecture(prefecture);

            if (checked) {
                window.areaSelectionData.cities[prefecture] = [...allCities];
            } else {
                window.areaSelectionData.cities[prefecture] = [];
                // ÂÑ™ÂÖà„Ç®„É™„Ç¢„Åã„Çâ„ÇÇÂâäÈô§
                window.areaSelectionData.priorities = window.areaSelectionData.priorities.filter(
                    p => !p.startsWith(prefecture + '_')
                );
            }

            console.log('[toggleAllCities] Updated cities:', window.areaSelectionData.cities);
            updateCitySelectionArea();
            updateAreaSelectionUI();
        }

        // ÂÑ™ÂÖà„Ç®„É™„Ç¢Êõ¥Êñ∞
        function updatePriorityArea() {
            const listContainer = document.getElementById('prioritySelectionList');
            if (!listContainer) return;

            // „Ç´„Ç¶„É≥„Çø„ÉºÊõ¥Êñ∞„ÅØtogglePriorityAreaÂÜÖ„ÅßË°å„ÅÜ„ÅÆ„Åß„Åì„Åì„Åß„ÅØ‰∏çË¶Å

            // ÈÉΩÈÅìÂ∫úÁúå„Åî„Å®„Å´„Ç∞„É´„Éº„ÉóÂåñ
            const groupedByPref = {};
            Object.keys(window.areaSelectionData.cities).forEach(pref => {
                if (!groupedByPref[pref]) {
                    groupedByPref[pref] = [];
                }
                window.areaSelectionData.cities[pref].forEach(city => {
                    groupedByPref[pref].push({
                        key: `${pref}_${city}`,
                        city: city
                    });
                });
            });

            if (Object.keys(groupedByPref).length === 0) {
                listContainer.innerHTML = '<p class="text-gray-500 text-sm">Â∏ÇÂå∫Áî∫Êùë„ÇíÈÅ∏Êäû„Åô„Çã„Å®„ÄÅÂÑ™ÂÖà„Ç®„É™„Ç¢„ÅÆË®≠ÂÆö„ÅåÂèØËÉΩ„Å´„Å™„Çä„Åæ„Åô</p>';
                return;
            }

            // Áúå„Åî„Å®„Å´„Ç´„Éº„ÉâÂΩ¢Âºè„ÅßË°®Á§∫Ôºà„É¢„Éê„Ç§„É´ÂØæÂøúÔºâ
            listContainer.innerHTML = `
                <div class="border border-gray-200 rounded-lg bg-white p-3 sm:p-4">
                    <h5 class="font-semibold text-sm sm:text-base mb-3 flex items-center">
                        <span class="text-red-500 mr-2">üìç</span>
                        <span class="flex-1">ÈÅ∏ÊäûÂèØËÉΩ„Å™„Ç®„É™„Ç¢</span>
                        <span class="text-xs sm:text-sm text-gray-600">ÂÖ®${Object.values(groupedByPref).reduce((sum, cities) => sum + cities.length, 0)}„Ç®„É™„Ç¢</span>
                    </h5>
                    <div class="space-y-3 sm:space-y-4 max-h-96 overflow-y-auto">
                        ${Object.entries(groupedByPref).map(([pref, cities]) => `
                            <div class="bg-gray-50 rounded-lg p-2 sm:p-3">
                                <h6 class="font-medium text-xs sm:text-sm mb-2 flex items-center text-gray-700">
                                    <span class="text-red-500 mr-1 sm:mr-2">üìç</span>
                                    ${pref}
                                </h6>
                                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1.5 sm:gap-2 ml-0 sm:ml-6">
                                    ${cities.map(city => `
                                        <label class="flex items-center p-1.5 sm:p-2 bg-white hover:bg-yellow-50 rounded cursor-pointer text-xs sm:text-sm transition-colors">
                                            <input type="checkbox"
                                                   class="w-4 h-4 sm:w-auto sm:h-auto"
                                                   value="${city.key}"
                                                   ${window.areaSelectionData.priorities.includes(city.key) ? 'checked' : ''}
                                                   onchange="togglePriorityArea('${city.key}', this.checked)">
                                            <span class="ml-1.5 sm:ml-2 leading-tight">${city.city}</span>
                                        </label>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // ÂÑ™ÂÖà„Ç®„É™„Ç¢„Éà„Ç∞„É´
        function togglePriorityArea(areaKey, checked) {
            console.log('togglePriorityArea called:', areaKey, checked, 'current priorities:', window.areaSelectionData.priorities.length);

            if (checked) {
                // 3„Å§‰ª•‰∏äÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÈÅ∏Êäû„ÇíÈò≤„Åê
                if (window.areaSelectionData.priorities.length >= 3) {
                    showNotification('‰∏äÈôê„ÇíË∂Ö„Åà„Åæ„Åó„Åü', 'ÂÑ™ÂÖà„Ç®„É™„Ç¢„ÅØÊúÄÂ§ß3„Å§„Åæ„ÅßÈÅ∏ÊäûÂèØËÉΩ„Åß„Åô');
                    // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÇíÂÖÉ„Å´Êàª„Åô
                    setTimeout(() => {
                        const checkbox = document.querySelector(`input[value="${areaKey}"]`);
                        if (checkbox) {
                            checkbox.checked = false;
                        }
                    }, 0);
                    return;
                }
                if (!window.areaSelectionData.priorities.includes(areaKey)) {
                    window.areaSelectionData.priorities.push(areaKey);
                }
            } else {
                window.areaSelectionData.priorities = window.areaSelectionData.priorities.filter(p => p !== areaKey);
            }

            console.log('After update, priorities:', window.areaSelectionData.priorities.length, window.areaSelectionData.priorities);

            // ÂÑ™ÂÖà„Ç®„É™„Ç¢„Ç´„Ç¶„É≥„Çø„Éº„ÇíÊõ¥Êñ∞
            const selectedCount = document.getElementById('selectedPriorityCount');
            if (selectedCount) {
                selectedCount.textContent = window.areaSelectionData.priorities.length;

                // „Ç´„Ç¶„É≥„Çø„Éº„ÅÆË¶ã„ÅüÁõÆ„ÇÇÊõ¥Êñ∞ÔºàÈÅ∏ÊäûÊï∞„Å´Âøú„Åò„Å¶Ëâ≤„ÇíÂ§âÊõ¥Ôºâ
                const countContainer = selectedCount.parentElement;
                if (countContainer) {
                    if (window.areaSelectionData.priorities.length >= 3) {
                        countContainer.classList.add('text-red-600');
                        countContainer.classList.remove('text-orange-500');
                    } else if (window.areaSelectionData.priorities.length > 0) {
                        countContainer.classList.add('text-orange-500');
                        countContainer.classList.remove('text-red-600');
                    } else {
                        countContainer.classList.remove('text-red-600', 'text-orange-500');
                    }
                }
            } else {
                console.error('selectedPriorityCount element not found!');
            }

            // „É™„Çπ„Éà„ÇíÂÜçÊèèÁîªÔºà„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÅÆÁä∂ÊÖã„ÇíÂèçÊò†Ôºâ
            updatePriorityArea();
        }

        // „Ç®„É™„Ç¢ÈÅ∏Êäû„Çí„É™„Çª„ÉÉ„Éà
        function resetAreaSelection() {
            window.areaSelectionData.prefectures = [];
            window.areaSelectionData.cities = {};
            window.areaSelectionData.priorities = [];
            window.areaSelectionData.totalCount = 0;

            // „Éú„Çø„É≥„ÅÆÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
            document.querySelectorAll('[data-prefecture]').forEach(button => {
                button.classList.remove('selected', 'bg-blue-500', 'text-white');
                button.classList.add('bg-white');
            });

            // ÂÑ™ÂÖà„Ç®„É™„Ç¢„Ç´„Ç¶„É≥„Çø„Éº„ÇÇ„É™„Çª„ÉÉ„Éà
            const selectedCount = document.getElementById('selectedPriorityCount');
            if (selectedCount) {
                selectedCount.textContent = '0';
                const countContainer = selectedCount.parentElement;
                if (countContainer) {
                    countContainer.classList.remove('text-red-600', 'text-orange-500');
                }
            }

            updateAreaSelectionUI();
        }

        // „Ç®„É™„Ç¢ÈÅ∏Êäû„ÇíÁ¢∫ÂÆö
        function confirmAreaSelection() {
            showNotification('ÊàêÂäü', `${window.areaSelectionData.prefectures.length}ÈÉΩÈÅìÂ∫úÁúå„ÄÅ${window.areaSelectionData.totalCount}Â∏ÇÂå∫Áî∫Êùë„ÇíÈÅ∏Êäû„Åó„Åæ„Åó„Åü`);
        }

        // Â∏ÇÂå∫Áî∫Êùë„É™„Çπ„Éà„ÇíÊõ¥Êñ∞
        function updateCityList() {
            const cityListElement = document.getElementById('cityList');
            let html = '';

            selectedPrefectures.forEach(pref => {
                if (cityData[pref]) {
                    cityData[pref].forEach(city => {
                        html += `
                            <label class="flex items-center p-2 bg-white border rounded hover:bg-gray-50 cursor-pointer">
                                <input type="checkbox" data-city="${city}" name="manual-city" value="${city}" class="mr-2" onchange="updateCompanyAreaDisplay();">
                                <span class="text-sm">${city}</span>
                            </label>
                        `;
                    });
                }
            });

            cityListElement.innerHTML = html || '<p class="text-gray-500 text-center py-4">ÈÉΩÈÅìÂ∫úÁúå„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>';
        }

        // ÂÑ™ÂÖà„Ç®„É™„Ç¢„ÅÆÂàá„ÇäÊõø„Åà
        // Âè§„ÅÑtogglePriorityAreaÈñ¢Êï∞„ÅØÂâäÈô§ÔºàÊñ∞„Åó„ÅÑ„Éê„Éº„Ç∏„Éß„É≥„Çí‰∏ä„ÅßÂÆöÁæ©Ê∏à„ÅøÔºâ

        // updatePriorityAreasDisplayÈñ¢Êï∞„ÅØÂâäÈô§

        // ÂÖ®ÈÉΩÈÅìÂ∫úÁúå„ÇíË°®Á§∫
        function showAllPrefectures() {
            const container = event.target.parentElement.querySelector('.grid');
            container.innerHTML = allPrefectures.map(pref => `
                <label class="flex items-center p-2 bg-white border rounded cursor-pointer hover:bg-blue-50">
                    <input type="checkbox" name="prefecture" value="${pref}" class="mr-2" onchange="updateSelectedAreas()"
                           ${selectedPrefectures.includes(pref) ? 'checked' : ''}>
                    <span class="text-sm">${pref}</span>
                </label>
            `).join('');
            event.target.textContent = 'Èñâ„Åò„Çã';
            event.target.onclick = () => location.reload();
        }

        // Â∏ÇÂå∫Áî∫ÊùëÊ§úÁ¥¢
        function searchCities(query) {
            const cityListElement = document.getElementById('cityList');
            const allButtons = cityListElement.querySelectorAll('button');

            allButtons.forEach(button => {
                const cityName = button.textContent.replace('‚≠ê ', '');
                if (cityName.toLowerCase().includes(query.toLowerCase())) {
                    button.style.display = '';
                } else {
                    button.style.display = 'none';
                }
            });
        }

        // ‰ºöÁ§æÊÉÖÂ†±„ÅÆ„Ç®„É™„Ç¢Ë°®Á§∫„ÇíÊõ¥Êñ∞
        function updateCompanyAreaDisplay() {
            const displayElement = document.getElementById('companyAreaDisplay');
            if (!displayElement) return;

            let html = '';

            // ÈÉΩÈÅìÂ∫úÁúå
            if (selectedPrefectures.length > 0) {
                html += `
                    <div>
                        <p class="text-sm font-medium text-gray-700 mb-2">ÂØæÂøúÈÉΩÈÅìÂ∫úÁúå</p>
                        <div class="flex flex-wrap gap-2">
                            ${selectedPrefectures.map(pref =>
                                `<span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">${pref}</span>`
                            ).join('')}
                        </div>
                    </div>
                `;
            }

            // ÈÅ∏Êäû„Åï„Çå„ÅüÂ∏ÇÂå∫Áî∫Êùë„ÇíË°®Á§∫ÔºàÊâãÂãïË®≠ÂÆö„ÅÆÂ†¥ÂêàÔºâ
            const manualCities = document.querySelectorAll('input[name="manual-city"]:checked');
            if (manualCities.length > 0) {
                html += `
                    <div>
                        <p class="text-sm font-medium text-gray-700 mb-2">ÂØæÂøúÂ∏ÇÂå∫Áî∫Êùë</p>
                        <div class="flex flex-wrap gap-2">
                            ${Array.from(manualCities).map(checkbox =>
                                `<span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm">${checkbox.value}</span>`
                            ).join('')}
                        </div>
                    </div>
                `;
            }

            displayElement.innerHTML = html || '<p class="text-gray-500">„Ç®„É™„Ç¢„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>';
        }

        // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Çí‰øùÂ≠ò
        // „Ç®„É™„Ç¢Ë®≠ÂÆö„ÅÆÂêåÊúüÂàá„ÇäÊõø„Åà
        function toggleAreaSync() {
            const isSync = document.getElementById('syncAreaSettings').checked;
            const autoDiv = document.getElementById('companyAreaAuto');
            const manualDiv = document.getElementById('companyAreaManual');

            if (isSync) {
                autoDiv.classList.remove('hidden');
                manualDiv.classList.add('hidden');
            } else {
                autoDiv.classList.add('hidden');
                manualDiv.classList.remove('hidden');
            }
        }

        // Â∑•‰∫ãÂÜÖÂÆπË®≠ÂÆö„ÅÆÂêåÊúüÂàá„ÇäÊõø„Åà
        function toggleConstructionSync() {
            const isSync = document.getElementById('syncConstructionSettings').checked;
            const autoDiv = document.getElementById('companyConstructionAuto');
            const manualDiv = document.getElementById('companyConstructionManual');

            if (isSync) {
                autoDiv.classList.remove('hidden');
                manualDiv.classList.add('hidden');
            } else {
                autoDiv.classList.add('hidden');
                manualDiv.classList.remove('hidden');
            }
        }

        // ‰ºöÁ§æÊÉÖÂ†±Áî®„ÅÆÂÖ®ÈÉΩÈÅìÂ∫úÁúåË°®Á§∫
        function showAllCompanyPrefectures() {
            const container = event.target.parentElement.querySelector('.grid');
            container.innerHTML = allPrefectures.map(pref => `
                <label class="flex items-center p-2 bg-white border rounded cursor-pointer hover:bg-blue-50">
                    <input type="checkbox" name="company-prefecture" value="${pref}" class="mr-2">
                    <span class="text-sm">${pref}</span>
                </label>
            `).join('');
            event.target.textContent = 'Èñâ„Åò„Çã';
            event.target.onclick = () => location.reload();
        }

        // ‰ºöÁ§æÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂàùÊúüÂåñÔºà‰øùÂ≠ò„Éú„Çø„É≥ÊñπÂºè„Å´Â§âÊõ¥Ôºâ
        document.addEventListener('DOMContentLoaded', () => {
            const companySection = document.getElementById('companySection');
            if (companySection) {
                console.log('[‰ºöÁ§æÊÉÖÂ†±] „Çª„ÇØ„Ç∑„Éß„É≥ÂàùÊúüÂåñÂÆå‰∫Ü - ‰øùÂ≠ò„Éú„Çø„É≥ÊñπÂºè„Çí‰ΩøÁî®');

                // „Ç´„Çπ„Çø„É†Ë≥áÊ†ºÂÖ•Âäõ„ÅÆEnter„Ç≠„ÉºÂØæÂøú
                const customQualInput = document.getElementById('customQualificationInput');
                if (customQualInput) {
                    customQualInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            addCustomQualification();
                        }
                    });
                }

                // „Ç´„Çπ„Çø„É†‰øùÈô∫ÂÖ•Âäõ„ÅÆEnter„Ç≠„ÉºÂØæÂøú
                const customInsInput = document.getElementById('customInsuranceInput');
                if (customInsInput) {
                    customInsInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            addCustomInsurance();
                        }
                    });
                }

                // PRÊñá„ÅÆÊñáÂ≠óÊï∞„Ç´„Ç¶„É≥„Çø„Éº
                const prTextArea = document.getElementById('prText');
                const prTextCharCount = document.getElementById('prTextCharCount');
                if (prTextArea && prTextCharCount) {
                    // ÂàùÊúüË°®Á§∫
                    prTextCharCount.textContent = prTextArea.value.length;

                    // ÂÖ•ÂäõÊôÇ„ÅÆ„Ç´„Ç¶„É≥„ÉàÊõ¥Êñ∞„Å®„ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„ÅÆÈ´ò„ÅïËá™ÂãïË™øÊï¥
                    prTextArea.addEventListener('input', (e) => {
                        const length = e.target.value.length;
                        prTextCharCount.textContent = length;

                        // „ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„ÅÆÈ´ò„Åï„ÇíÂÜÖÂÆπ„Å´Âêà„Çè„Åõ„Å¶Ëá™ÂãïË™øÊï¥
                        e.target.style.height = 'auto';
                        e.target.style.height = Math.max(200, e.target.scrollHeight) + 'px';
                    });
                }

                // ÂàùÊúüË°®Á§∫„ÅßÈñ≤Ë¶ß„É¢„Éº„Éâ„ÅÆ„Éá„Éº„Çø„ÇíÊõ¥Êñ∞
                setTimeout(() => {
                    updateViewData('basicInfo');
                }, 100);
            }
        });

        // „Çµ„Éº„Éì„Çπ„Ç´„Éº„Éâ„ÅÆ„Éà„Ç∞„É´Ê©üËÉΩ
        function toggleServiceCard(element) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            const card = element.querySelector('div');

            checkbox.checked = !checkbox.checked;

            if (checkbox.checked) {
                card.classList.add('bg-blue-50', 'border-blue-500');
                card.classList.remove('bg-white');
            } else {
                card.classList.remove('bg-blue-50', 'border-blue-500');
                card.classList.add('bg-white');
            }
        }

        // Google„Éû„ÉÉ„Éó„ÇíÂüã„ÇÅËæº„Åø
        function loadGoogleMap() {
            const mapContainer = document.getElementById('googleMapContainer');
            const address = document.getElementById('previewAddress')?.textContent || '';

            if (!mapContainer) return;

            if (address && address !== '-') {
                const encodedAddress = encodeURIComponent(address);
                // Google Maps Embed API„Çí‰ΩøÁî®ÔºàÈÄöÂ∏∏„ÅØAPI„Ç≠„Éº„ÅåÂøÖË¶Å„Åß„Åô„Åå„ÄÅ„Ç∑„É≥„Éó„É´„Å™iframeÂüã„ÇÅËæº„Åø„Çí‰ΩøÁî®Ôºâ
                const mapHtml = `
                    <iframe
                        width="100%"
                        height="100%"
                        frameborder="0"
                        style="border:0"
                        src="https://www.google.com/maps?q=${encodedAddress}&output=embed"
                        allowfullscreen>
                    </iframe>
                `;
                mapContainer.innerHTML = mapHtml;
            } else {
                mapContainer.innerHTML = `
                    <div class="w-full h-full flex items-center justify-center text-gray-500 bg-gray-100">
                        <div class="text-center">
                            <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            <p class="text-sm">ÊâÄÂú®Âú∞ÊÉÖÂ†±„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                        </div>
                    </div>
                `;
            }
        }

        // ÈÄöÁü•Ë°®Á§∫
        function showNotification(title, body, type = 'info') {
            // „Éñ„É©„Ç¶„Ç∂ÈÄöÁü•
            if (Notification.permission === 'granted') {
                new Notification(title, {
                    body: body,
                    icon: '/favicon.ico',
                    badge: '/favicon.ico'
                });
            }

            // „Ç§„É≥„Ç¢„Éó„É™ÈÄöÁü•„ÇÇË°®Á§∫
            showInAppNotification(title, body, type);
        }

        // „Ç§„É≥„Ç¢„Éó„É™ÈÄöÁü•
        function showInAppNotification(title, body, type = 'info') {
            const colors = {
                'info': 'bg-blue-500',
                'success': 'bg-green-500',
                'warning': 'bg-yellow-500',
                'error': 'bg-red-500'
            };

            const notification = document.createElement('div');
            notification.className = `fixed top-20 right-4 ${colors[type]} text-white px-6 py-4 rounded-lg shadow-lg z-[100] animate-slide-in`;
            notification.innerHTML = `
                <div class="flex items-start gap-3">
                    <div class="flex-1">
                        <div class="font-semibold">${title}</div>
                        <div class="text-sm opacity-90">${body}</div>
                    </div>
                    <button onclick="this.closest('div').remove()" class="hover:opacity-70">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `;
            document.body.appendChild(notification);

            // 5ÁßíÂæå„Å´Ëá™Âãï„ÅßÊ∂àÂéª
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.classList.add('animate-slide-out');
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }

        // „Ç¢„É©„Éº„Éà„Éë„Éç„É´„ÅÆË°®Á§∫/ÈùûË°®Á§∫
        function toggleAlertPanel() {
            const panel = document.getElementById('alertPanel');
            if (panel.classList.contains('hidden')) {
                panel.classList.remove('hidden');
                loadAlerts();
                updateTotalBadgeCount();
            } else {
                panel.classList.add('hidden');
            }
        }

        // Êú¨ÈÉ®„Åã„Çâ„ÅÆÈÄöÁü•„Éë„Éç„É´Âàá„ÇäÊõø„Åà
        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            if (panel.classList.contains('hidden')) {
                panel.classList.remove('hidden');
                loadNotifications();
            } else {
                panel.classList.add('hidden');
            }
        }

        // ÈÄöÁü•„Éë„Éç„É´„ÅÆÂÜÖÂÆπ„ÇíÊõ¥Êñ∞
        function loadNotifications() {
            const list = document.getElementById('notificationList');
            if (!list) return;

            // Êñ∞ÁùÄÊ°à‰ª∂Êï∞„Çí„Ç´„Ç¶„É≥„Éà
            let newCount = 0;
            merchantCasesData.forEach(c => {
                if (c.detailStatus === 'Êñ∞ÁùÄ') newCount++;
            });

            if (newCount > 0) {
                list.innerHTML = `
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <div class="flex-shrink-0">
                                <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="font-bold text-blue-800">Êñ∞ÁùÄÊ°à‰ª∂„Åå ${newCount}‰ª∂ „ÅÇ„Çä„Åæ„Åô</p>
                                <p class="text-sm text-blue-600 mt-1">Ê°à‰ª∂ÁÆ°ÁêÜ„Åã„ÇâÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                                <button onclick="showSection('cases'); toggleNotificationPanel();" class="mt-3 px-4 py-2 bg-blue-500 text-white text-sm font-bold rounded-lg hover:bg-blue-600 transition-all">
                                    Ê°à‰ª∂ÁÆ°ÁêÜ„ÇíÈñã„Åè
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                list.innerHTML = '<p class="text-gray-500 text-center py-8">Êñ∞„Åó„ÅÑÈÄöÁü•„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
            }
        }

        // Âä†ÁõüÂ∫ó„Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞
        // updateMerchantStatusÈñ¢Êï∞„ÅØÂâäÈô§Ôºà„Çπ„ÉÜ„Éº„Çø„Çπ„ÅØË™≠„ÅøÂèñ„ÇäÂ∞ÇÁî®„ÄÅ„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÂãïÁöÑÂèñÂæóÔºâ

        // „Éê„ÉÉ„Ç∏„Ç´„Ç¶„É≥„Éà„ÇíÁµ±ÂêàÊõ¥Êñ∞
        function updateTotalBadgeCount() {
            // Êú™Ââ≤ÂΩìÊ°à‰ª∂Êï∞„ÇíÂèñÂæó
            const unassignedBadge = document.getElementById('unassignedBadge');
            const unassignedCount = unassignedBadge && !unassignedBadge.classList.contains('hidden')
                ? parseInt(unassignedBadge.textContent) || 0
                : 0;

            // „Ç¢„É©„Éº„ÉàÊï∞„ÇíÂèñÂæó
            const alertItems = document.querySelectorAll('#todayAlerts .alert-item').length || 0;

            // ÂêàË®à„Çí„Éô„É´„Éû„Éº„ÇØ„Å´Ë°®Á§∫
            const totalCount = unassignedCount + alertItems;
            const alertCountBadge = document.getElementById('alertCount');

            if (totalCount > 0) {
                alertCountBadge.textContent = totalCount;
                alertCountBadge.classList.remove('hidden');
            } else {
                alertCountBadge.classList.add('hidden');
            }
        }

        // „Ç¢„É©„Éº„ÉàË™≠„ÅøËæº„Åø
        function loadAlerts() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);

            // ‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ
            const todayTasks = [
                { time: '10:00', text: 'Áî∞‰∏≠Êßò„Å∏Êû∂Èõª', type: 'call', caseId: 1 },
                { time: '14:00', text: '‰ΩêËó§Êßò ÁèæÂú∞Ë™øÊüª', type: 'appointment', caseId: 2 },
                { time: '16:00', text: 'Èà¥Êú®Êßò Ë¶ãÁ©çÊõ∏ÊèêÂá∫ÊúüÈôê', type: 'estimate', caseId: 3 }
            ];

            const todayTasksHtml = todayTasks.map(task => `
                <div class="flex items-center justify-between p-2 bg-red-50 rounded-lg hover:bg-red-100 cursor-pointer"
                     onclick="handleAlertClick(${task.caseId}, '${task.type}')">
                    <div class="flex items-center gap-2">
                        <span class="text-xs font-medium text-red-600">${task.time}</span>
                        <span class="text-sm">${task.text}</span>
                    </div>
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </div>
            `).join('');
            document.getElementById('todayTasks').innerHTML = todayTasksHtml || '<div class="text-sm text-gray-500">„Çø„Çπ„ÇØ„Å™„Åó</div>';

            // ÊòéÊó•„ÅÆ‰∫àÂÆö
            const tomorrowTasks = [
                { time: '11:00', text: 'Â±±Áî∞Êßò „Ç¢„Éù„Ç§„É≥„Éà', type: 'appointment', caseId: 4 },
                { time: '15:00', text: 'È´òÊ©ãÊßò „Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó', type: 'followup', caseId: 5 }
            ];

            const tomorrowTasksHtml = tomorrowTasks.map(task => `
                <div class="flex items-center justify-between p-2 bg-yellow-50 rounded-lg hover:bg-yellow-100 cursor-pointer"
                     onclick="handleAlertClick(${task.caseId}, '${task.type}')">
                    <div class="flex items-center gap-2">
                        <span class="text-xs font-medium text-yellow-600">${task.time}</span>
                        <span class="text-sm">${task.text}</span>
                    </div>
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </div>
            `).join('');
            document.getElementById('tomorrowTasks').innerHTML = tomorrowTasksHtml || '<div class="text-sm text-gray-500">‰∫àÂÆö„Å™„Åó</div>';

            // Ëá™Âãï„Ç¢„É©„Éº„Éà
            const autoAlerts = [
                { text: 'Êú™ÂØæÂøúÊ°à‰ª∂3‰ª∂„ÅÇ„Çä„Åæ„Åô', type: 'warning' },
                { text: 'Ë¶ãÁ©çÊèêÂá∫Âæå7Êó•ÁµåÈÅé: 2‰ª∂', type: 'info' },
                { text: 'ÂÖ•Èáë‰∫àÂÆöÊó•: Áî∞‰∏≠Êßò', type: 'payment' }
            ];

            const autoAlertsHtml = autoAlerts.map(alert => `
                <div class="flex items-center justify-between p-2 bg-blue-50 rounded-lg">
                    <span class="text-sm">${alert.text}</span>
                    <button onclick="dismissAlert(this)" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `).join('');
            document.getElementById('autoAlerts').innerHTML = autoAlertsHtml || '<div class="text-sm text-gray-500">„Ç¢„É©„Éº„Éà„Å™„Åó</div>';
        }

        // „Ç¢„É©„Éº„Éà„ÇØ„É™„ÉÉ„ÇØÂá¶ÁêÜ
        function handleAlertClick(caseId, type) {
            toggleAlertPanel();

            if (type === 'call') {
                // ÈõªË©±Áô∫‰ø°
                const caseData = casesData.find(c => c.id === caseId);
                if (caseData && caseData.phone) {
                    callCustomer(caseData.phone);
                }
            } else if (type === 'appointment' || type === 'estimate') {
                // Ê°à‰ª∂Ë©≥Á¥∞„ÇíË°®Á§∫
                showSection('cases');
                setTimeout(() => {
                    const caseCard = document.querySelector(`[data-case-id="${caseId}"]`);
                    if (caseCard) {
                        caseCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        caseCard.classList.add('ring-2', 'ring-yellow-400');
                        setTimeout(() => {
                            caseCard.classList.remove('ring-2', 'ring-yellow-400');
                        }, 3000);
                    }
                }, 100);
            }
        }

        // „Ç¢„É©„Éº„ÉàÊ∂àÂéª
        function dismissAlert(button) {
            button.closest('div').remove();
        }


        // „Ç¢„É©„Éº„ÉàË®≠ÂÆöÊõ¥Êñ∞ÔºàË®≠ÂÆö„É°„Éã„É•„Éº„Å®„Ç¢„É©„Éº„Éà„Éë„Éç„É´„ÅÆÂêåÊúüÔºâ
        function updateAlertSetting(settingName, enabled) {
            // localStorage „Å´‰øùÂ≠ò
            let alertSettings = JSON.parse(localStorage.getItem('alertSettings') || '{}');
            alertSettings[settingName] = enabled;
            localStorage.setItem('alertSettings', JSON.stringify(alertSettings));

            // ÂØæÂøú„Åô„ÇãË®≠ÂÆö„É°„Éã„É•„Éº„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÇíÂêåÊúü
            const idMap = {
                'appointment_reminder': 'appointmentReminder',
                'call_reminder': 'callReminder',
                'estimate_followup': 'estimateFollowup',
                'payment_alert': 'paymentAlert'
            };

            const checkboxId = idMap[settingName];
            if (checkboxId) {
                const checkbox = document.getElementById(checkboxId);
                if (checkbox && checkbox.checked !== enabled) {
                    checkbox.checked = enabled;
                }
            }
        }

        // „Ç´„É¨„É≥„ÉÄ„Éº„ÅÆËá™ÂãïÂêåÊúüÔºàÊ°à‰ª∂„Éá„Éº„Çø„Åã„ÇâËá™ÂãïÁöÑ„Å´„Ç´„É¨„É≥„ÉÄ„Éº„Ç§„Éô„É≥„Éà„ÇíÁîüÊàêÔºâ
        function autoSyncToCalendar() {
            // Êó¢Â≠ò„ÅÆÊ°à‰ª∂Áî±Êù•„Ç§„Éô„É≥„Éà„Çí„ÇØ„É™„Ç¢
            calendarEvents = calendarEvents.filter(event => !event.fromCase);

            // ÂÖ®Ê°à‰ª∂„Åã„Çâ„Éç„ÇØ„Çπ„Éà„Çπ„ÉÜ„ÉÉ„Éó„ÇíÂèñÂæó„Åó„Å¶„Ç´„É¨„É≥„ÉÄ„Éº„Å´ËøΩÂä†
            const allCases = getCasesData();

            allCases.forEach(caseItem => {
                // „Éç„ÇØ„Çπ„Éà„Çπ„ÉÜ„ÉÉ„Éó„Åå„ÅÇ„ÇãÂ†¥Âêà
                if (caseItem.nextAction) {
                    const today = new Date();
                    const eventDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + Math.floor(Math.random() * 7));
                    const eventTitle = `${caseItem.nextAction}: ${caseItem.customer}Êßò`;

                    // „Ç§„Éô„É≥„Éà„Çø„Ç§„Éó„ÇíÂà§ÂÆö
                    let eventType = 'todo';
                    let eventColor = '#6b7280';

                    if (caseItem.nextAction.includes('ÁèæË™ø') || caseItem.nextAction.includes('„Ç¢„Éù')) {
                        eventType = 'meeting';
                        eventColor = '#3b82f6';
                    } else if (caseItem.nextAction.includes('Êû∂Èõª') || caseItem.nextAction.includes('ÈõªË©±')) {
                        eventType = 'call';
                        eventColor = '#10b981';
                    } else if (caseItem.nextAction.includes('Ë¶ãÁ©ç')) {
                        eventType = 'estimate';
                        eventColor = '#f59e0b';
                    }

                    calendarEvents.push({
                        id: `case-${caseItem.id}`,
                        title: eventTitle,
                        date: eventDate.toISOString().split('T')[0],
                        time: '10:00',
                        type: eventType,
                        color: eventColor,
                        fromCase: true,  // Ê°à‰ª∂Áî±Êù•„ÅÆ„Ç§„Éô„É≥„Éà„Éû„Éº„ÇØ
                        caseId: caseItem.id
                    });
                }
            });

            // „Ç´„É¨„É≥„ÉÄ„Éº„ÇíÂÜçÊèèÁîª
            if (typeof renderCalendar !== 'undefined') {
                renderCalendar();
            }
            if (typeof renderMiniCalendar !== 'undefined') {
                renderMiniCalendar();
            }
        }

        // Ê°à‰ª∂„Éá„Éº„ÇøÊõ¥Êñ∞ÊôÇ„Å´Ëá™ÂãïÁöÑ„Å´„Ç´„É¨„É≥„ÉÄ„Éº„ÇíÂêåÊúü
        function onCaseUpdate() {
            autoSyncToCalendar();
        }

        // Google„Ç´„É¨„É≥„ÉÄ„ÉºÂêåÊúüÔºàÂ∞ÜÊù•ÁöÑ„Å´ÂÆüË£ÖÔºâ
        function syncWithGoogleCalendar() {
            // Google Calendar API„Çí‰ΩøÁî®„Åó„ÅüÂêåÊúü
            showNotification('Ê©üËÉΩÈñãÁô∫‰∏≠', 'Google„Ç´„É¨„É≥„ÉÄ„ÉºÂêåÊúü„ÅØÊ¨°Âõû„Ç¢„ÉÉ„Éó„Éá„Éº„Éà„ÅßÊèê‰æõ‰∫àÂÆö', 'info');
        }

        // „Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥ÊôÇ„ÅÆËá™Âãï„Ç¢„É©„Éº„ÉàË®≠ÂÆö
        function scheduleStatusAlert(caseId, newStatus) {
            const alertTiming = {
                '„Ç¢„ÉùÊ∏à': { delay: 86400000, message: 'ÊòéÊó•„ÅÆÁèæÂú∞Ë™øÊüª‰∫àÂÆö' }, // 1Êó•Ââç
                'ÁèæË™øÊ∏à': { delay: 3600000, message: 'Ë¶ãÁ©çÊõ∏‰ΩúÊàê„ÇíÈñãÂßã' }, // 1ÊôÇÈñìÂæå
                'Ë¶ãÁ©çÊèêÂá∫Ê∏à': { delay: 604800000, message: '„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó„ÅåÂøÖË¶Å' }, // 7Êó•Âæå
                'ÂÖ•Èáë‰∫àÂÆö': { delay: 86400000, message: 'ÂÖ•ÈáëÁ¢∫Ë™ç„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô' } // 1Êó•Âæå
            };

            if (alertTiming[newStatus]) {
                const alert = alertTiming[newStatus];
                setTimeout(() => {
                    showNotification('„É™„Éû„Ç§„É≥„ÉÄ„Éº', alert.message, 'warning');
                    // „Ç¢„É©„Éº„Éà„Ç´„Ç¶„É≥„Éà„ÇíÂ¢ó„ÇÑ„Åô
                    const countBadge = document.getElementById('alertCount');
                    const currentCount = parseInt(countBadge.textContent) || 0;
                    countBadge.textContent = currentCount + 1;
                    countBadge.classList.remove('hidden');
                }, alert.delay);
            }
        }

        // „É°„Éã„É•„Éº„Éà„Ç∞„É´
        window.toggleMenu = function() {
            const sideMenu = document.getElementById('sideMenu');
            const isOpen = !sideMenu.classList.contains('-translate-x-full');

            if (isOpen) {
                // „É°„Éã„É•„Éº„ÇíÈñâ„Åò„Çã
                sideMenu.classList.add('-translate-x-full');
                document.removeEventListener('click', handleOutsideClick);
            } else {
                // „É°„Éã„É•„Éº„ÇíÈñã„Åè
                sideMenu.classList.remove('-translate-x-full');
                // Ê¨°„ÅÆ„Éï„É¨„Éº„É†„Åß„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†ÔºàtoggleMenu„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„ÇíÁÑ°Ë¶ñ„Åô„Çã„Åü„ÇÅÔºâ
                setTimeout(() => {
                    document.addEventListener('click', handleOutsideClick);
                }, 0);
            }
        }

        // „É°„Éã„É•„ÉºÂ§ñ„ÇØ„É™„ÉÉ„ÇØ„Åß„É°„Éã„É•„Éº„ÇíÈñâ„Åò„Çã
        function handleOutsideClick(event) {
            const sideMenu = document.getElementById('sideMenu');
            const menuButton = event.target.closest('button[onclick*="toggleMenu"]');

            // „É°„Éã„É•„Éº„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà„ÅØÁÑ°Ë¶ñ
            if (menuButton) return;

            // „É°„Éã„É•„ÉºÂÜÖ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà„ÅØÁÑ°Ë¶ñ
            if (sideMenu.contains(event.target)) return;

            // „É°„Éã„É•„ÉºÂ§ñ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà„ÅØÈñâ„Åò„Çã
            sideMenu.classList.add('-translate-x-full');
            document.removeEventListener('click', handleOutsideClick);
        }
        
        // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„É°„Éã„É•„Éº„ÅÆÊõ¥Êñ∞
        window.updateActiveMenu = function(sectionName) {
            // „Åô„Åπ„Å¶„ÅÆ„É°„Éã„É•„Éº„Ç¢„Ç§„ÉÜ„É†„Åã„Çâ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Çπ„Çø„Ç§„É´„ÇíÂâäÈô§
            document.querySelectorAll('#sideMenu a').forEach(link => {
                link.classList.remove('bg-gradient-to-r', 'from-blue-600', 'to-blue-500', 'text-gray-100');
                link.classList.add('text-gray-400', 'hover:bg-gray-800', 'hover:text-gray-100');
            });
            
            // ÂØæÂøú„Åô„Çã„É°„Éã„É•„Éº„Ç¢„Ç§„ÉÜ„É†„Å´„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
            const activeLink = document.querySelector(`#sideMenu a[onclick*="showSection('${sectionName}')"]`);
            if (activeLink) {
                activeLink.classList.remove('text-gray-400', 'hover:bg-gray-800', 'hover:text-gray-100');
                activeLink.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-blue-500', 'text-gray-100');
            }
        }
        
        // „Çª„ÇØ„Ç∑„Éß„É≥Âàá„ÇäÊõø„Åà
        // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅÆÂ§âÊõ¥Ê§úÁü•Áî®„Éï„É©„Ç∞
        let autodeliverySettingsChanged = false;

        // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅÆÂ§âÊõ¥„ÇíÊ§úÁü•
        function markAutodeliveryChanged() {
            autodeliverySettingsChanged = true;
            console.log('[Autodelivery] Settings changed, not saved yet');
        }

        // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅÆÂ§âÊõ¥„Çí„É™„Çª„ÉÉ„Éà
        function resetAutodeliveryChanged() {
            autodeliverySettingsChanged = false;
            console.log('[Autodelivery] Settings saved, change flag reset');
        }

        window.showSection = function(sectionName) {
            // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥„Åã„Çâ‰ªñ„ÅÆ„Çª„ÇØ„Ç∑„Éß„É≥„Å´ÁßªÂãï„Åô„ÇãÂ†¥Âêà„ÄÅÊú™‰øùÂ≠ò„ÉÅ„Çß„ÉÉ„ÇØ
            const currentSection = document.querySelector('.section[style*="display: block"]');
            if (currentSection && currentSection.id === 'autodeliverySection' && sectionName !== 'autodelivery') {
                if (autodeliverySettingsChanged) {
                    if (!confirm('Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Å´‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ§âÊõ¥„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ\n\n‰øùÂ≠ò„Åõ„Åö„Å´ÁßªÂãï„Åó„Åæ„Åô„ÅãÔºü')) {
                        return; // ÁßªÂãï„Çí„Ç≠„É£„É≥„Çª„É´
                    }
                    // ÁßªÂãï„ÇíË®±ÂèØ„Åó„ÅüÂ†¥Âêà„ÄÅ„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
                    autodeliverySettingsChanged = false;
                }
            }

            // „Åô„Åπ„Å¶„ÅÆ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈùûË°®Á§∫
            document.querySelectorAll('.section').forEach(section => {
                section.style.display = 'none';
            });

            // ÈÅ∏Êäû„Åï„Çå„Åü„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.style.display = 'block';

                // „É°„Éã„É•„Éº„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                updateActiveMenu(sectionName);

                // „Ç´„É¨„É≥„ÉÄ„Éº„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÅØÂàùÊúüÂåñ
                if (sectionName === 'calendar') {
                    setTimeout(() => {
                        renderCalendar();
                        renderMiniCalendar();
                    }, 10);
                }

                // ‰ºöÁ§æÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÄÅÂä†ÁõüÂ∫ó„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
                if (sectionName === 'company') {
                    if (window.merchantId) {
                        if (!window.merchantData || Object.keys(window.merchantData).length === 0) {
                            fetchMerchantData(window.merchantId).then(() => {
                                loadMerchantData(window.merchantId, window.merchantData);
                            });
                        } else {
                            setTimeout(() => loadMerchantData(window.merchantId, window.merchantData), 100);
                        }
                    }
                }


                // ‰ºöÁ§æÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÅØÊîØÂ∫ó„Éû„ÉÉ„Éó„ÇíÊõ¥Êñ∞
                if (sectionName === 'company') {
                    setTimeout(() => {
                        updateBranchMaps();
                        loadGoogleMap();
                    }, 100);
                }

                // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÅØÁî≥Ë´ãÂèØËÉΩÊ°à‰ª∂„ÇíË™≠„ÅøËæº„Åø
                if (sectionName === 'cancel') {
                    loadCancelableCases();
                }

                // ËøΩÂÆ¢ÁµÇ‰∫ÜBOX„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÅØ„Ç¢„Éº„Ç´„Ç§„ÉñÊ°à‰ª∂„ÇíË™≠„ÅøËæº„Åø
                if (sectionName === 'archive') {
                    loadArchivedCases();
                }

                // ÊúüÈôêÂª∂Èï∑Áî≥Ë´ã„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÅØÁî≥Ë´ãÂèØËÉΩÊ°à‰ª∂„ÇíË™≠„ÅøËæº„Åø
                if (sectionName === 'extension') {
                    loadExtensionEligibleCases();
                }

                // ÊàêÁ¥ÑÂ†±Âëä„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÅØÈÖç‰ø°Ê∏à„ÅøÊ°à‰ª∂„ÇíË™≠„ÅøËæº„Åø
                if (sectionName === 'contract') {
                    loadContractCases();
                }

                // V2007: Ê°à‰ª∂ÁÆ°ÁêÜ„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÅØÊ°à‰ª∂„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
                if (sectionName === 'cases') {
                    loadMerchantCases();
                }
            }

            // „É°„Éã„É•„Éº„ÇíÈñâ„Åò„Çã
            document.getElementById('sideMenu').classList.add('-translate-x-full');
        }

        // Ê®©Èôê„É¢„Éº„ÉÄ„É´
        function openPermissionModal(name = null, isNew = true) {
            const modal = document.getElementById('permissionModal');
            const modalTitle = document.getElementById('modalTitle');
            const newSalesFields = document.getElementById('newSalesFields');

            if (isNew) {
                // Êñ∞Ë¶èËøΩÂä†„É¢„Éº„Éâ
                modalTitle.textContent = 'Êñ∞Ë¶èÂñ∂Ê•≠ÊãÖÂΩìËÄÖËøΩÂä†';
                newSalesFields.classList.remove('hidden');
                // „Éï„Ç©„Éº„É†„Çí„ÇØ„É™„Ç¢
                document.getElementById('newSalesName').value = '';
                document.getElementById('newSalesEmail').value = '';
                document.getElementById('newSalesPhone').value = '';
                document.getElementById('newSalesRole').value = '‰∏ÄËà¨Âñ∂Ê•≠';
                // ÂÖ®Ê®©Èôê„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Çí„ÇØ„É™„Ç¢
                document.querySelectorAll('.permission-checkbox').forEach(cb => cb.checked = false);
            } else {
                // Á∑®ÈõÜ„É¢„Éº„Éâ
                modalTitle.textContent = `${name}„ÅÆÊ®©ÈôêË®≠ÂÆö`;
                newSalesFields.classList.add('hidden');
                // Êó¢Â≠ò„ÅÆÊ®©Èôê„ÇíË™≠„ÅøËæº„ÇÄÔºà„Éá„É¢Áî®„Å´„É©„É≥„ÉÄ„É†„Å´Ë®≠ÂÆöÔºâ
                loadExistingPermissions(name);
            }

            modal.classList.remove('hidden');
        }

        function closePermissionModal() {
            document.getElementById('permissionModal').classList.add('hidden');
        }

        function editPermissions(name) {
            openPermissionModal(name, false);
        }

        // Êó¢Â≠ò„ÅÆÊ®©Èôê„ÇíË™≠„ÅøËæº„ÇÄ
        function loadExistingPermissions(name) {
            // „Éá„É¢Áî®Ôºö„É©„É≥„ÉÄ„É†„Å´Ê®©Èôê„ÇíË®≠ÂÆö
            document.querySelectorAll('.permission-checkbox').forEach(cb => {
                cb.checked = Math.random() > 0.5;
            });
        }

        // Âñ∂Ê•≠ÊãÖÂΩìËÄÖÂâäÈô§Á¢∫Ë™ç
        function confirmDeleteSales(name) {
            // ÂâäÈô§Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´„Çí‰ΩúÊàê
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.id = 'deleteConfirmModal';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-md">
                    <div class="flex items-center mb-4">
                        <svg class="w-6 h-6 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                        <h3 class="text-lg font-bold text-gray-900">Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„ÅÆÂâäÈô§Á¢∫Ë™ç</h3>
                    </div>
                    <p class="text-gray-600 mb-4">
                        <span class="font-semibold">${name}</span>„Åï„Çì„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü
                    </p>
                    <div class="bg-yellow-50 border border-yellow-300 rounded-lg p-3 mb-4">
                        <p class="text-sm text-yellow-800">
                            <strong>Ê≥®ÊÑèÔºö</strong>„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ<br>
                            ÂâäÈô§„Åô„Çã„Å®‰ª•‰∏ã„ÅÆÊÉÖÂ†±„ÅåÂ§±„Çè„Çå„Åæ„ÅôÔºö
                        </p>
                        <ul class="mt-2 text-sm text-yellow-700 list-disc list-inside">
                            <li>Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„ÅÆÂü∫Êú¨ÊÉÖÂ†±</li>
                            <li>Ê®©ÈôêË®≠ÂÆö</li>
                            <li>ÈÅéÂéª„ÅÆÊ¥ªÂãïÂ±•Ê≠¥</li>
                            <li>ÊãÖÂΩìÊ°à‰ª∂„ÅÆÂâ≤„ÇäÂΩì„Å¶ÔºàÂÜçÂâ≤„ÇäÂΩì„Å¶„ÅåÂøÖË¶ÅÔºâ</li>
                        </ul>
                    </div>
                    <div class="flex items-center mb-4">
                        <input type="checkbox" id="reassignCases" class="rounded mr-2">
                        <label for="reassignCases" class="text-sm text-gray-700">
                            ÊãÖÂΩìÊ°à‰ª∂„Çí‰ªñ„ÅÆÂñ∂Ê•≠„Å´Âºï„ÅçÁ∂ô„Åê
                        </label>
                    </div>
                    <div id="reassignSection" class="hidden mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Âºï„ÅçÁ∂ô„ÅéÂÖà</label>
                        <select id="reassignTo" class="w-full px-3 py-2 border rounded-lg">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <option value="Áî∞‰∏≠Â§™ÈÉé">Áî∞‰∏≠Â§™ÈÉéÔºà„É™„Éº„ÉÄ„ÉºÔºâ</option>
                            <option value="‰ΩêËó§Ëä±Â≠ê">‰ΩêËó§Ëä±Â≠êÔºà‰∏ÄËà¨Âñ∂Ê•≠Ôºâ</option>
                            <option value="Èà¥Êú®Ê¨°ÈÉé">Èà¥Êú®Ê¨°ÈÉéÔºàÊñ∞‰∫∫Âñ∂Ê•≠Ôºâ</option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeDeleteModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                        <button onclick="deleteSales('${name}')" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            ÂâäÈô§„Åô„Çã
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Âºï„ÅçÁ∂ô„Åé„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÅÆ„Ç§„Éô„É≥„Éà
            document.getElementById('reassignCases').addEventListener('change', function(e) {
                const reassignSection = document.getElementById('reassignSection');
                if (e.target.checked) {
                    reassignSection.classList.remove('hidden');
                } else {
                    reassignSection.classList.add('hidden');
                }
            });

            // ÂâäÈô§ÂØæË±°„ÇíÈÅ∏ÊäûËÇ¢„Åã„ÇâÈô§Â§ñ
            const reassignSelect = document.getElementById('reassignTo');
            Array.from(reassignSelect.options).forEach(option => {
                if (option.value === name) {
                    option.remove();
                }
            });
        }

        // ÂâäÈô§„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeDeleteModal() {
            const modal = document.getElementById('deleteConfirmModal');
            if (modal) {
                modal.remove();
            }
        }

        // Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„ÇíÂâäÈô§
        function deleteSales(name) {
            const reassignCases = document.getElementById('reassignCases').checked;
            const reassignTo = document.getElementById('reassignTo').value;

            if (reassignCases && !reassignTo) {
                alert('Âºï„ÅçÁ∂ô„ÅéÂÖà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            // ÂâäÈô§Âá¶ÁêÜÔºàÂÆüÈöõ„Å´„ÅØAPI„ÇíÂëº„Å∂Ôºâ
            if (reassignCases) {
                showNotification('ÂâäÈô§ÂÆå‰∫Ü', `${name}„Åï„Çì„ÇíÂâäÈô§„Åó„ÄÅÊ°à‰ª∂„Çí${reassignTo}„Åï„Çì„Å´Âºï„ÅçÁ∂ô„Åé„Åæ„Åó„Åü`);
            } else {
                showNotification('ÂâäÈô§ÂÆå‰∫Ü', `${name}„Åï„Çì„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`);
            }

            // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
            closeDeleteModal();

            // „ÉÜ„Éº„Éñ„É´„Åã„ÇâË°å„ÇíÂâäÈô§Ôºà„Éá„É¢Áî®Ôºâ
            const rows = document.querySelectorAll('#salesSection tbody tr');
            rows.forEach(row => {
                if (row.textContent.includes(name)) {
                    row.style.transition = 'opacity 0.3s';
                    row.style.opacity = '0';
                    setTimeout(() => {
                        row.remove();
                    }, 300);
                }
            });
        }

        // Ê®©Èôê„Éó„É™„Çª„ÉÉ„ÉàË®≠ÂÆö
        function setPreset(preset) {
            const presets = {
                office: ['case.cancel', 'case.contract', 'automail.view', 'report.self', 'company.view'],
                standard: ['case.cancel', 'case.contract', 'automail.view', 'report.self', 'company.view'],
                leader: ['case.view.all', 'case.edit', 'case.hide', 'case.delete', 'case.cancel', 'case.contract', 'finance.view', 'automail.view', 'automail.edit', 'report.self', 'report.all', 'report.export', 'company.view'],
                admin: ['case.view.all', 'case.edit', 'case.hide', 'case.delete', 'case.cancel', 'case.contract', 'automail.view', 'automail.edit', 'finance.view', 'finance.export', 'report.self', 'report.all', 'report.export', 'sales.manage', 'company.view', 'company.edit']
            };
            
            // „Åô„Åπ„Å¶„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Çí„ÇØ„É™„Ç¢
            document.querySelectorAll('.permission-checkbox').forEach(cb => {
                cb.checked = false;
            });
            
            // „Éó„É™„Çª„ÉÉ„Éà„Å´Âü∫„Å•„ÅÑ„Å¶„ÉÅ„Çß„ÉÉ„ÇØ
            if (presets[preset]) {
                presets[preset].forEach(permission => {
                    const checkbox = document.querySelector(`[data-permission="${permission}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            
            // „Éú„Çø„É≥„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white');
            });
            event.target.classList.add('bg-blue-600', 'text-white');
        }

        function savePermissions() {
            const modalTitle = document.getElementById('modalTitle').textContent;
            const isNewSales = modalTitle.includes('Êñ∞Ë¶è');

            if (isNewSales) {
                // Êñ∞Ë¶èËøΩÂä†„ÅÆÂ†¥Âêà
                const name = document.getElementById('newSalesName').value;
                const email = document.getElementById('newSalesEmail').value;
                const phone = document.getElementById('newSalesPhone').value;
                const role = document.getElementById('newSalesRole').value;

                // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥
                if (!name || !email) {
                    alert('Ê∞èÂêç„Å®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅØÂøÖÈ†àÈ†ÖÁõÆ„Åß„Åô');
                    return;
                }

                // „ÉÜ„Éº„Éñ„É´„Å´Êñ∞„Åó„ÅÑË°å„ÇíËøΩÂä†
                addSalesPersonToTable(name, role, email, phone);

                showNotification('ËøΩÂä†ÂÆå‰∫Ü', `${name}„Åï„Çì„ÇíÂñ∂Ê•≠ÊãÖÂΩìËÄÖ„Å®„Åó„Å¶ËøΩÂä†„Åó„Åæ„Åó„Åü`);
            } else {
                // Á∑®ÈõÜ„ÅÆÂ†¥Âêà
                showNotification('Êõ¥Êñ∞ÂÆå‰∫Ü', 'Ê®©ÈôêË®≠ÂÆö„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü');
            }

            closePermissionModal();
        }

        // „ÉÜ„Éº„Éñ„É´„Å´Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„ÇíËøΩÂä†
        function addSalesPersonToTable(name, role, email, phone) {
            const tbody = document.querySelector('#salesSection tbody');
            const newRow = document.createElement('tr');

            // „É≠„Éº„É´„Å´Âøú„Åò„ÅüËâ≤„ÇíË®≠ÂÆö
            let roleColor = 'green';
            let statsDisplay = ['0', '0%'];

            if (role === '„É™„Éº„ÉÄ„Éº') {
                roleColor = 'purple';
            } else if (role === '‰∏ÄËà¨Âñ∂Ê•≠') {
                roleColor = 'blue';
            } else if (role === '‰∏ÄËà¨‰∫ãÂãô') {
                roleColor = 'green';
                statsDisplay = ['-', '-'];  // ‰∫ãÂãô„ÅØÊàêÁ¥ÑÊï∞„ÉªÊàêÁ¥ÑÁéá„Å™„Åó
            } else if (role === 'ÁèæÂ†¥Áõ£Áù£') {
                roleColor = 'yellow';
                statsDisplay = ['-', '-'];  // ÁèæÂ†¥Áõ£Áù£„ÇÇÊàêÁ¥ÑÊï∞„ÉªÊàêÁ¥ÑÁéá„Å™„Åó
            }

            newRow.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${name}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-${roleColor}-100 text-${roleColor}-800">${role}</span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${statsDisplay[0]}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${statsDisplay[1]}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">
                    <button onclick="editPermissions('${name}')" class="text-blue-600 hover:text-blue-900 mr-3">Ê®©ÈôêÁ∑®ÈõÜ</button>
                    <button onclick="confirmDeleteSales('${name}')" class="text-red-600 hover:text-red-900">ÂâäÈô§</button>
                </td>
            `;

            tbody.appendChild(newRow);
        }

        // „É≠„Ç∞„Ç¢„Ç¶„Éà
        window.logout = function() {
            // ‰∏°Êñπ„ÅÆ„Çπ„Éà„É¨„Éº„Ç∏„Çí„ÇØ„É™„Ç¢
            localStorage.removeItem('franchiseUser');
            localStorage.removeItem('franchiseRole');
            localStorage.removeItem('loginTime');
            localStorage.removeItem('rememberLogin');
            sessionStorage.clear();
            location.reload();
        }

        // „Éë„Çπ„ÉØ„Éº„ÉâÂøò„ÇåÂá¶ÁêÜ
        function showForgotPassword() {
            const email = prompt('ÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Çã„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:');
            if (email) {
                alert(`„Éë„Çπ„ÉØ„Éº„Éâ„É™„Çª„ÉÉ„Éà„É™„É≥„ÇØ„Çí ${email} „Å´ÈÄÅ‰ø°„Åó„Åæ„Åó„Åü„ÄÇ\nÔºà„Éá„É¢Áâà„ÅÆ„Åü„ÇÅÂÆüÈöõ„Å´„ÅØÈÄÅ‰ø°„Åï„Çå„Åæ„Åõ„ÇìÔºâ`);
            }
        }
        
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂá¶ÁêÜ
        window.addEventListener('DOMContentLoaded', function() {
            // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åæ„Åü„ÅØ„Çª„ÉÉ„Ç∑„Éß„É≥„Çπ„Éà„É¨„Éº„Ç∏„Åã„ÇâÂæ©ÂÖÉ
            let savedUser = localStorage.getItem('franchiseUser') || sessionStorage.getItem('franchiseUser');
            let savedRole = localStorage.getItem('franchiseRole') || sessionStorage.getItem('franchiseRole');

            if (savedUser && savedRole) {
                // „É≠„Ç∞„Ç§„É≥ÊôÇÈñì„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºà24ÊôÇÈñì„ÅßËá™Âãï„É≠„Ç∞„Ç¢„Ç¶„ÉàÔºâ
                const loginTime = localStorage.getItem('loginTime') || sessionStorage.getItem('loginTime');
                if (loginTime) {
                    const hoursSinceLogin = (new Date() - new Date(loginTime)) / (1000 * 60 * 60);
                    if (hoursSinceLogin > 24) {
                        // „Çª„ÉÉ„Ç∑„Éß„É≥ÊúüÈôêÂàá„Çå - „É≠„Ç∞„Ç§„É≥„Éö„Éº„Ç∏„Å∏
                        localStorage.removeItem('franchiseUser');
                        localStorage.removeItem('franchiseRole');
                        localStorage.removeItem('loginTime');
                        sessionStorage.removeItem('franchiseUser');
                        sessionStorage.removeItem('franchiseRole');
                        sessionStorage.removeItem('loginTime');
                        window.location.href = 'merchant-portal/login.html';
                        return;
                    }
                }

                // „É≠„Ç∞„Ç§„É≥Áä∂ÊÖãÊúâÂäπ - „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâË°®Á§∫
                currentUser = savedUser;
                userRole = savedRole;
                document.getElementById('mainApp').classList.remove('hidden');

                // Âä†ÁõüÂ∫ó„Éá„Éº„Çø„ÇíÂèñÂæó„Åó„Å¶„Åã„ÇâË°®Á§∫„ÇíÊõ¥Êñ∞
                fetchMerchantData(savedUser).then(() => {
                    updateRoleDisplay();
                    showSection('dashboard');
                    initializeFirstLoginSettings();
                }).catch(error => {
                    updateRoleDisplay();
                    showSection('dashboard');
                    initializeFirstLoginSettings();
                });

                // Ê°à‰ª∂„Ç´„Éº„Éâ„ÅØ V2007 „Åß showSection('cases') ÊôÇ„Å´ loadMerchantCases() „ÅßËá™ÂãïË™≠„ÅøËæº„Åø

                // „Ç´„É¨„É≥„ÉÄ„Éº„ÇíÂàùÊúüÂåñ
                setTimeout(() => {
                    initCalendar();
                }, 100);

            } else {
                // Êú™„É≠„Ç∞„Ç§„É≥ - „É≠„Ç∞„Ç§„É≥„Éö„Éº„Ç∏„Å∏„É™„ÉÄ„Ç§„É¨„ÇØ„Éà
                window.location.href = 'merchant-portal/login.html';
            }
        });

        // Áµ±ÂêàË®≠ÂÆö‰øùÂ≠ò
        async function saveAllSettings() {
            try {
                // „Éó„É≠„Éï„Ç£„Éº„É´‰øùÂ≠ò
                saveProfile();

                // ÈÄöÁü•Ë®≠ÂÆö‰øùÂ≠ò
                saveNotificationSettings();

                // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö‰øùÂ≠ò
                await saveAutoDeliverySettings();

                showNotification('Ë®≠ÂÆö‰øùÂ≠ò', '„Åô„Åπ„Å¶„ÅÆË®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü', 'success');
            } catch (error) {
                console.error('[saveAllSettings] Error:', error);
                showNotification('‰øùÂ≠ò„Ç®„É©„Éº', 'Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
            }
        }
        
        // ÈÄöÁü•„ÉÜ„Çπ„Éà
        function testNotification(type) {
            const messages = {
                'email': '„ÉÜ„Çπ„Éà„É°„Éº„É´„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü',
                'sms': '„ÉÜ„Çπ„ÉàSMS„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü',
                'line': '„ÉÜ„Çπ„ÉàLINE„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü',
                'browser': '„Éñ„É©„Ç¶„Ç∂ÈÄöÁü•„ÅÆ„ÉÜ„Çπ„Éà'
            };
            
            if (type === 'browser') {
                showNotification('ÈÄöÁü•„ÉÜ„Çπ„Éà', messages[type]);
            } else {
                alert(messages[type] + '\nÔºà„Éá„É¢Áâà„ÅÆ„Åü„ÇÅÂÆüÈöõ„Å´„ÅØÈÄÅ‰ø°„Åï„Çå„Åæ„Åõ„ÇìÔºâ');
            }
        }
        
        // ÈÄöÁü•ÊôÇÈñìË®≠ÂÆö„ÅÆË°®Á§∫/ÈùûË°®Á§∫
        function toggleQuietHours() {
            const enabled = document.getElementById('enableQuietHours').checked;
            const settings = document.getElementById('quietHoursSettings');
            settings.classList.toggle('hidden', !enabled);
        }

        // ‰ºëÊó•Ë®≠ÂÆö„ÅÆË°®Á§∫/ÈùûË°®Á§∫Âàá„ÇäÊõø„Åà
        function toggleHolidaySettings() {
            const enabled = document.getElementById('enableHolidays').checked;
            const settings = document.getElementById('holidaySettings');
            settings.classList.toggle('hidden', !enabled);
        }
        
        // „Éó„É≠„Éï„Ç£„Éº„É´‰øùÂ≠ò
        function saveProfile() {
            const profile = {
                name: document.getElementById('profileName').value,
                phone: document.getElementById('profilePhone').value,
                email: document.getElementById('profileEmail').value,
                lineId: document.getElementById('profileLineId').value
            };
            localStorage.setItem('userProfile', JSON.stringify(profile));
            alert('„Éó„É≠„Éï„Ç£„Éº„É´„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
        }
        
        // ÈÄöÁü•Ë®≠ÂÆö‰øùÂ≠ò
        function saveNotificationSettings() {
            const settings = {
                email: document.getElementById('notifyEmail').checked,
                sms: document.getElementById('notifySms').checked,
                line: document.getElementById('notifyLine').checked,
                browser: document.getElementById('notifyBrowser').checked,
                alerts: {
                    appointment_reminder: {
                        enabled: document.getElementById('appointmentReminder').checked,
                        time: document.getElementById('appointmentAlertTime').value
                    },
                    call_reminder: {
                        enabled: document.getElementById('callReminder').checked,
                        time: document.getElementById('callAlertTime').value
                    },
                    estimate_followup: {
                        enabled: document.getElementById('estimateFollowup').checked,
                        days: document.getElementById('followupDays').value
                    },
                    payment_alert: {
                        enabled: document.getElementById('paymentAlert').checked
                    }
                },
                holidays: {
                    enabled: document.getElementById('enableHolidays').checked,
                    mon: document.getElementById('holidayMon').checked,
                    tue: document.getElementById('holidayTue').checked,
                    wed: document.getElementById('holidayWed').checked,
                    thu: document.getElementById('holidayThu').checked,
                    fri: document.getElementById('holidayFri').checked,
                    sat: document.getElementById('holidaySat').checked,
                    sun: document.getElementById('holidaySun').checked
                },
                quietHours: {
                    enabled: document.getElementById('enableQuietHours').checked,
                    start: document.getElementById('quietStart').value,
                    end: document.getElementById('quietEnd').value
                }
            };
            localStorage.setItem('notificationSettings', JSON.stringify(settings));
        }
        
        // Ë°®Á§∫Ë®≠ÂÆö‰øùÂ≠ò
        function saveDisplaySettings() {
            alert('Ë°®Á§∫Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
        }
        
        // „Ç´„É¨„É≥„ÉÄ„ÉºÊ©üËÉΩ
        let currentDate = new Date();
        let currentView = 'month';
        
        // Êó•Êú¨„ÅÆÁ•ùÊó•„Éá„Éº„ÇøÔºà2024Âπ¥„Éª2025Âπ¥Ôºâ
        const japaneseHolidays = {
            '2024-01-01': 'ÂÖÉÊó•',
            '2024-01-08': 'Êàê‰∫∫„ÅÆÊó•',
            '2024-02-11': 'Âª∫ÂõΩË®òÂøµ„ÅÆÊó•',
            '2024-02-12': 'ÊåØÊõø‰ºëÊó•',
            '2024-02-23': 'Â§©ÁöáË™ïÁîüÊó•',
            '2024-03-20': 'Êò•ÂàÜ„ÅÆÊó•',
            '2024-04-29': 'Êò≠Âíå„ÅÆÊó•',
            '2024-05-03': 'ÊÜ≤Ê≥ïË®òÂøµÊó•',
            '2024-05-04': '„Åø„Å©„Çä„ÅÆÊó•',
            '2024-05-05': '„Åì„Å©„ÇÇ„ÅÆÊó•',
            '2024-05-06': 'ÊåØÊõø‰ºëÊó•',
            '2024-07-15': 'Êµ∑„ÅÆÊó•',
            '2024-08-11': 'Â±±„ÅÆÊó•',
            '2024-08-12': 'ÊåØÊõø‰ºëÊó•',
            '2024-09-16': 'Êï¨ËÄÅ„ÅÆÊó•',
            '2024-09-22': 'ÁßãÂàÜ„ÅÆÊó•',
            '2024-09-23': 'ÊåØÊõø‰ºëÊó•',
            '2024-10-14': '„Çπ„Éù„Éº„ÉÑ„ÅÆÊó•',
            '2024-11-03': 'ÊñáÂåñ„ÅÆÊó•',
            '2024-11-04': 'ÊåØÊõø‰ºëÊó•',
            '2024-11-23': 'Âã§Âä¥ÊÑüË¨ù„ÅÆÊó•',
            '2025-01-01': 'ÂÖÉÊó•',
            '2025-01-13': 'Êàê‰∫∫„ÅÆÊó•',
            '2025-02-11': 'Âª∫ÂõΩË®òÂøµ„ÅÆÊó•',
            '2025-02-23': 'Â§©ÁöáË™ïÁîüÊó•',
            '2025-02-24': 'ÊåØÊõø‰ºëÊó•',
            '2025-03-20': 'Êò•ÂàÜ„ÅÆÊó•',
            '2025-04-29': 'Êò≠Âíå„ÅÆÊó•',
            '2025-05-03': 'ÊÜ≤Ê≥ïË®òÂøµÊó•',
            '2025-05-04': '„Åø„Å©„Çä„ÅÆÊó•',
            '2025-05-05': '„Åì„Å©„ÇÇ„ÅÆÊó•',
            '2025-05-06': 'ÊåØÊõø‰ºëÊó•',
            '2025-07-21': 'Êµ∑„ÅÆÊó•',
            '2025-08-11': 'Â±±„ÅÆÊó•',
            '2025-09-15': 'Êï¨ËÄÅ„ÅÆÊó•',
            '2025-09-23': 'ÁßãÂàÜ„ÅÆÊó•',
            '2025-10-13': '„Çπ„Éù„Éº„ÉÑ„ÅÆÊó•',
            '2025-11-03': 'ÊñáÂåñ„ÅÆÊó•',
            '2025-11-23': 'Âã§Âä¥ÊÑüË¨ù„ÅÆÊó•',
            '2025-11-24': 'ÊåØÊõø‰ºëÊó•'
        };
        
        let calendarEvents = [
            {
                id: 1,
                title: 'Áî∞‰∏≠Êßò ÁèæÂú∞Ë™øÊüª',
                date: '2024-01-15',
                time: '14:00',
                type: 'hearing',
                color: 'blue'
            },
            {
                id: 2,
                title: '‰ΩêËó§Êßò Â∑•‰∫ãÈñãÂßã',
                date: '2024-01-20',
                time: '09:00',
                type: 'construction',
                color: 'green'
            },
            {
                id: 3,
                title: 'Èà¥Êú®Êßò Ë¶ãÁ©ç„ÇÇ„ÇäÊèêÂá∫',
                date: '2024-01-25',
                time: '16:00',
                type: 'estimate',
                color: 'yellow'
            }
        ];
        
        // „Ç´„É¨„É≥„ÉÄ„ÉºÂàùÊúüÂåñ
        function initCalendar() {
            renderCalendar();
            renderMiniCalendar();
        }
        
        // „Ç´„É¨„É≥„ÉÄ„ÉºÊèèÁîª
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // ÊúàË°®Á§∫„ÇíÊõ¥Êñ∞
            const monthNames = ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà', '7Êúà', '8Êúà', '9Êúà', '10Êúà', '11Êúà', '12Êúà'];
            const monthElement = document.getElementById('currentMonth');
            if (monthElement) {
                monthElement.textContent = `${year}Âπ¥${monthNames[month]}`;
            }
            
            // „Ç´„É¨„É≥„ÉÄ„Éº„Ç∞„É™„ÉÉ„Éâ„ÇíÁîüÊàê
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            const prevLastDate = new Date(year, month, 0).getDate();
            
            let html = '';
            let date = 1;
            
            // 6ÈÄ±ÈñìÂàÜ„ÅÆ„Ç∞„É™„ÉÉ„Éâ„ÇíÁîüÊàê
            for (let week = 0; week < 6; week++) {
                let weekHasDate = false;
                for (let day = 0; day < 7; day++) {
                    let cellDate = '';
                    let cellStyle = 'border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;';
                    let cellContent = '';
                    
                    if (week === 0 && day < firstDay) {
                        // ÂâçÊúà„ÅÆÊó•‰ªò
                        cellDate = prevLastDate - firstDay + day + 1;
                        cellStyle += ' color: #9ca3af; background: #f9fafb;';
                        html += `
                            <div style="${cellStyle}" data-date="${cellDate}">
                                <div style="font-weight: 500; font-size: 14px;">${cellDate}</div>
                            </div>
                        `;
                    } else if (date > lastDate) {
                        // Ê¨°Êúà„ÅÆÊó•‰ªò
                        cellDate = date - lastDate;
                        cellStyle += ' color: #9ca3af; background: #f9fafb;';
                        html += `
                            <div style="${cellStyle}" data-date="${cellDate}">
                                <div style="font-weight: 500; font-size: 14px;">${cellDate}</div>
                            </div>
                        `;
                        date++;
                    } else {
                        weekHasDate = true;
                        // ÂΩìÊúà„ÅÆÊó•‰ªò
                        cellDate = date;
                        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                        
                        // ÈÄ±Êú´„Å®Á•ùÊó•„ÅÆËÉåÊôØËâ≤Ë®≠ÂÆö
                        const isHoliday = japaneseHolidays[dateStr];
                        if (day === 0 || isHoliday) {
                            // Êó•ÊõúÊó•„Åæ„Åü„ÅØÁ•ùÊó•„ÅØËñÑ„ÅÑËµ§
                            cellStyle += ' background: #fee2e2;';
                        } else if (day === 6) {
                            // ÂúüÊõúÊó•„ÅØËñÑ„ÅÑÊ∞¥Ëâ≤
                            cellStyle += ' background: #e0f2fe;';
                        }
                        
                        // ‰ªäÊó•„ÅÆÊó•‰ªò„ÇíÂº∑Ë™ø
                        const today = new Date();
                        const isToday = year === today.getFullYear() && month === today.getMonth() && date === today.getDate();
                        if (isToday) {
                            cellStyle = cellStyle.replace(/background:[^;]+;/, 'background: #eff6ff;');
                            cellStyle += ' border: 2px solid #3b82f6;';
                        }
                        
                        // „Ç§„Éô„É≥„Éà„ÇíË°®Á§∫
                        const dayEvents = calendarEvents.filter(e => e.date === dateStr);
                        if (dayEvents.length > 0) {
                            cellContent = '<div class="mt-1 space-y-1">';
                            dayEvents.forEach(event => {
                                const bgColor = {
                                    'blue': 'bg-blue-500',
                                    'green': 'bg-green-500',
                                    'yellow': 'bg-yellow-500',
                                    'purple': 'bg-purple-500',
                                    'red': 'bg-red-500'
                                }[event.color] || 'bg-gray-500';
                                
                                cellContent += `
                                    <div class="text-xs p-1 ${bgColor} text-white rounded truncate cursor-pointer hover:opacity-80 event-item" 
                                         draggable="true"
                                         data-event-id="${event.id}"
                                         onclick="showEventDetail(${event.id})" 
                                         oncontextmenu="showEventMenu(event, ${event.id})"
                                         ondragstart="handleDragStart(event, ${event.id})"
                                         title="${event.title}">
                                        ${event.time ? event.time + ' ' : ''}${event.title}
                                    </div>
                                `;
                            });
                            cellContent += '</div>';
                        }
                        
                        // Á•ùÊó•Âêç„ÇíËøΩÂä†
                        let holidayLabel = '';
                        if (isHoliday) {
                            holidayLabel = `<div style="font-size: 10px; color: #dc2626; font-weight: 500;">${isHoliday}</div>`;
                        }
                        
                        // html„Å´ËøΩÂä†
                        const originalBg = isToday ? '#eff6ff' : (day === 0 || isHoliday ? '#fee2e2' : day === 6 ? '#e0f2fe' : 'white');
                        const hoverBg = isToday ? '#dbeafe' : (day === 0 || isHoliday ? '#fecaca' : day === 6 ? '#bae6fd' : '#f9fafb');
                        
                        html += `
                            <div style="${cellStyle}" 
                                 data-date="${cellDate}"
                                 data-full-date="${dateStr}"
                                 ondrop="handleDrop(event)"
                                 ondragover="handleDragOver(event)"
                                 ondragleave="handleDragLeave(event)"
                                 onclick="handleCellClick(event)"
                                 onmouseover="this.style.background='${hoverBg}'"
                                 onmouseout="this.style.background='${originalBg}'">
                                <div style="font-weight: 500; font-size: 14px; ${day === 0 || isHoliday ? 'color: #dc2626;' : day === 6 ? 'color: #0284c7;' : ''}">${cellDate}</div>
                                ${holidayLabel}
                                ${cellContent}
                            </div>
                        `;
                        
                        date++;
                    }
                }
                
                // ÈÄ±„Å´Êó•‰ªò„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÁµÇ‰∫Ü
                if (!weekHasDate && date > lastDate) break;
            }
            
            const calendarGrid = document.getElementById('calendarGrid');
            if (calendarGrid) {
                calendarGrid.innerHTML = html;
            }
        }
        
        // „Éü„Éã„Ç´„É¨„É≥„ÉÄ„ÉºÊèèÁîª
        function renderMiniCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const today = new Date();
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            
            let html = '<div class="grid grid-cols-7 gap-1 text-xs">';
            
            // ÊõúÊó•„Éò„ÉÉ„ÉÄ„Éº
            const weekDays = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            weekDays.forEach(day => {
                html += `<div class="text-center font-medium text-gray-500 py-1">${day}</div>`;
            });
            
            // Á©∫ÁôΩ„Çª„É´
            for (let i = 0; i < firstDay; i++) {
                html += '<div></div>';
            }
            
            // Êó•‰ªò„Çª„É´
            for (let date = 1; date <= lastDate; date++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const hasEvent = calendarEvents.some(e => e.date === dateStr);
                const isToday = year === today.getFullYear() && month === today.getMonth() && date === today.getDate();
                
                let cellClass = 'text-center py-1 cursor-pointer hover:bg-gray-100 rounded';
                if (isToday) cellClass += ' bg-blue-500 text-white hover:bg-blue-600';
                else if (hasEvent) cellClass += ' font-bold text-blue-600';
                
                html += `<div class="${cellClass}" onclick="goToDate('${dateStr}')">${date}</div>`;
            }
            
            html += '</div>';
            
            const miniCalendar = document.getElementById('miniCalendar');
            if (miniCalendar) {
                miniCalendar.innerHTML = html;
            }
        }
        
        // „Ç´„É¨„É≥„ÉÄ„Éº„Éì„É•„ÉºÂàá„ÇäÊõø„Åà
        function changeCalendarView(view) {
            currentView = view;
            
            // „Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.calendar-view-btn').forEach(btn => {
                btn.classList.remove('text-blue-600', 'bg-blue-50');
                btn.classList.add('text-gray-600');
            });
            
            // „ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åü„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÊõ¥Êñ∞
            if (event && event.target) {
                event.target.classList.remove('text-gray-600');
                event.target.classList.add('text-blue-600', 'bg-blue-50');
            }
            
            // „Éì„É•„Éº„ÇíÂàá„ÇäÊõø„Åà
            document.getElementById('calendarMonthView').classList.toggle('hidden', view !== 'month');
            document.getElementById('calendarWeekView').classList.toggle('hidden', view !== 'week');
            document.getElementById('calendarDayView').classList.toggle('hidden', view !== 'day');
            
            // ÂØæÂøú„Åô„Çã„Éì„É•„Éº„ÇíÊèèÁîª
            if (view === 'month') {
                renderCalendar();
            } else if (view === 'week') {
                renderWeekView();
            } else if (view === 'day') {
                renderDayView();
            }
        }

        // ÈÄ±Ë°®Á§∫„ÇíÊèèÁîª
        function renderWeekView() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const date = currentDate.getDate();
            
            // ‰ªäÈÄ±„ÅÆÊó•ÊõúÊó•„ÇíË®àÁÆó
            const today = new Date(year, month, date);
            const dayOfWeek = today.getDay();
            const weekStart = new Date(today);
            weekStart.setDate(date - dayOfWeek);
            
            // ÈÄ±Ë°®Á§∫„ÅÆ„Éò„ÉÉ„ÉÄ„Éº
            let html = '';
            
            // ÊôÇÈñìËª∏„Éò„ÉÉ„ÉÄ„Éº
            html += '<div class="border-b border-r p-2 bg-gray-50 font-medium text-center">ÊôÇÈñì</div>';
            
            // ÊõúÊó•„Éò„ÉÉ„ÉÄ„Éº
            const weekDays = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            for (let i = 0; i < 7; i++) {
                const dayDate = new Date(weekStart);
                dayDate.setDate(weekStart.getDate() + i);
                const dayStr = `${dayDate.getMonth() + 1}/${dayDate.getDate()}`;
                const isToday = dayDate.toDateString() === new Date().toDateString();
                
                html += `<div class="border-b border-r p-2 bg-gray-50 text-center ${isToday ? 'bg-blue-50 text-blue-600 font-bold' : ''}">
                    <div class="text-xs text-gray-500">${weekDays[i]}</div>
                    <div class="font-medium">${dayStr}</div>
                </div>`;
            }
            
            // ÊôÇÈñì„Çπ„É≠„ÉÉ„ÉàÔºà8:00-20:00Ôºâ
            for (let hour = 8; hour <= 20; hour++) {
                // ÊôÇÈñì„É©„Éô„É´
                html += `<div class="border-b border-r p-2 bg-gray-50 text-xs text-center">${String(hour).padStart(2, '0')}:00</div>`;
                
                // ÂêÑÊõúÊó•„ÅÆ„Çª„É´
                for (let i = 0; i < 7; i++) {
                    const dayDate = new Date(weekStart);
                    dayDate.setDate(weekStart.getDate() + i);
                    const dateStr = dayDate.toISOString().split('T')[0];
                    
                    // „Åù„ÅÆÊôÇÈñìÂ∏Ø„ÅÆ„Ç§„Éô„É≥„Éà„ÇíÂèñÂæó
                    const hourEvents = calendarEvents.filter(e => {
                        if (e.date !== dateStr || !e.time) return false;
                        const eventHour = parseInt(e.time.split(':')[0]);
                        return eventHour === hour;
                    });
                    
                    let cellContent = '';
                    if (hourEvents.length > 0) {
                        hourEvents.forEach(event => {
                            const bgColor = {
                                'blue': 'bg-blue-500',
                                'green': 'bg-green-500',
                                'yellow': 'bg-yellow-500',
                                'purple': 'bg-purple-500',
                                'red': 'bg-red-500'
                            }[event.color] || 'bg-gray-500';
                            
                            cellContent += `<div class="text-xs p-1 ${bgColor} text-white rounded mb-1 cursor-pointer hover:opacity-80" 
                                onclick="showEventDetail(${event.id})" title="${event.title}">
                                ${event.time} ${event.title}
                            </div>`;
                        });
                    }
                    
                    html += `<div class="border-b border-r p-1 h-12 hover:bg-gray-50 cursor-pointer" 
                        data-date="${dateStr}" data-hour="${hour}" onclick="createEventAtTime('${dateStr}', ${hour})">
                        ${cellContent}
                    </div>`;
                }
            }
            
            document.getElementById('weekGrid').innerHTML = html;
        }

        // Êó•Ë°®Á§∫„ÇíÊèèÁîª
        function renderDayView() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const date = currentDate.getDate();
            
            const dayDate = new Date(year, month, date);
            const dateStr = dayDate.toISOString().split('T')[0];
            const weekDays = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            const dayOfWeek = dayDate.getDay();
            
            // Êó•‰ªòË°®Á§∫„ÇíÊõ¥Êñ∞
            document.getElementById('dayViewDate').textContent = 
                `${year}Âπ¥${month + 1}Êúà${date}Êó•Ôºà${weekDays[dayOfWeek]}Ôºâ`;
            
            // ÊôÇÈñì„Çπ„É≠„ÉÉ„Éà„ÇíÁîüÊàê
            let html = '';
            for (let hour = 6; hour <= 22; hour++) {
                const hourEvents = calendarEvents.filter(e => {
                    if (e.date !== dateStr || !e.time) return false;
                    const eventHour = parseInt(e.time.split(':')[0]);
                    return eventHour === hour;
                });
                
                let eventContent = '';
                if (hourEvents.length > 0) {
                    hourEvents.forEach(event => {
                        const bgColor = {
                            'blue': 'bg-blue-500',
                            'green': 'bg-green-500',
                            'yellow': 'bg-yellow-500',
                            'purple': 'bg-purple-500',
                            'red': 'bg-red-500'
                        }[event.color] || 'bg-gray-500';
                        
                        eventContent += `<div class="p-2 ${bgColor} text-white rounded mb-2 cursor-pointer hover:opacity-80" 
                            onclick="showEventDetail(${event.id})">
                            <div class="font-medium">${event.time} ${event.title}</div>
                            <div class="text-sm opacity-90">${event.type}</div>
                        </div>`;
                    });
                }
                
                html += `
                    <div class="flex border-b hover:bg-gray-50">
                        <div class="w-20 p-3 bg-gray-50 text-sm font-medium text-center border-r">
                            ${String(hour).padStart(2, '0')}:00
                        </div>
                        <div class="flex-1 p-3 min-h-16 cursor-pointer" 
                             data-date="${dateStr}" data-hour="${hour}" 
                             onclick="createEventAtTime('${dateStr}', ${hour})">
                            ${eventContent}
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('dayTimeSlots').innerHTML = html;
        }

        // ÁâπÂÆö„ÅÆÊôÇÈñì„Å´Êñ∞Ë¶è„Ç§„Éô„É≥„Éà„Çí‰ΩúÊàê
        function createEventAtTime(date, hour) {
            const time = `${String(hour).padStart(2, '0')}:00`;
            showEventModal(null, date, time);
        }
        
        // ÂâçÊúà„Å∏
        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }
        
        // Ê¨°Êúà„Å∏
        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }
        
        // ÁâπÂÆö„ÅÆÊó•‰ªò„Å∏„Ç∏„É£„É≥„Éó
        function goToDate(dateStr) {
            const [year, month, day] = dateStr.split('-').map(Number);
            currentDate = new Date(year, month - 1, day);
            showSection('calendar');
            renderCalendar();
        }
        
        // „Ç§„Éô„É≥„ÉàË©≥Á¥∞Ë°®Á§∫
        function showEventDetail(eventId) {
            const event = calendarEvents.find(e => e.id === eventId);
            if (event) {
                alert(`${event.title}\nÊó•ÊôÇ: ${event.date} ${event.time || ''}\nÁ®ÆÂà•: ${event.type}`);
            }
        }
        
        // „Éâ„É©„ÉÉ„Ç∞ & „Éâ„É≠„ÉÉ„ÉóÊ©üËÉΩ
        let draggedEventId = null;

        function handleDragStart(e, eventId) {
            draggedEventId = eventId;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.outerHTML);
            e.target.classList.add('opacity-50');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            const cell = e.currentTarget;
            if (cell.dataset.fullDate) {
                cell.classList.add('bg-blue-100', 'border-2', 'border-blue-400');
            }
        }

        function handleDragLeave(e) {
            const cell = e.currentTarget;
            cell.classList.remove('bg-blue-100', 'border-2', 'border-blue-400');
        }

        function handleDrop(e) {
            e.preventDefault();
            const cell = e.currentTarget;
            cell.classList.remove('bg-blue-100', 'border-2', 'border-blue-400');
            
            const newDate = cell.dataset.fullDate;
            if (newDate && draggedEventId) {
                // „Ç§„Éô„É≥„Éà„ÅÆÊó•‰ªò„ÇíÊõ¥Êñ∞
                const eventIndex = calendarEvents.findIndex(event => event.id === draggedEventId);
                if (eventIndex !== -1) {
                    calendarEvents[eventIndex].date = newDate;
                    renderCalendar();
                    renderMiniCalendar();
                    showNotification('‰∫àÂÆöÁßªÂãï', `‰∫àÂÆö„Çí${newDate}„Å´ÁßªÂãï„Åó„Åæ„Åó„Åü`);
                }
            }
            draggedEventId = null;
        }

        // „Çª„É´„ÇØ„É™„ÉÉ„ÇØÔºàÊñ∞Ë¶è„Ç§„Éô„É≥„Éà‰ΩúÊàêÔºâ
        function handleCellClick(e) {
            if (e.target.classList.contains('event-item')) return; // „Ç§„Éô„É≥„Éà„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà„ÅØÁÑ°Ë¶ñ
            
            const cell = e.currentTarget;
            const date = cell.dataset.fullDate;
            if (date) {
                showEventModal(null, date);
            }
        }

        // „Ç§„Éô„É≥„ÉàÂè≥„ÇØ„É™„ÉÉ„ÇØ„É°„Éã„É•„Éº
        function showEventMenu(e, eventId) {
            e.preventDefault();
            if (confirm('„Åì„ÅÆ‰∫àÂÆö„ÇíÁ∑®ÈõÜ„Åó„Åæ„Åô„ÅãÔºü')) {
                const event = calendarEvents.find(ev => ev.id === eventId);
                if (event) {
                    showEventModal(event);
                }
            }
        }


        // „Ç§„Éô„É≥„Éà„É¢„Éº„ÉÄ„É´Ë°®Á§∫
        function showEventModal(event = null, date = null, time = '') {
            const isEdit = !!event;
            const modalTitle = isEdit ? '‰∫àÂÆö„ÇíÁ∑®ÈõÜ' : 'Êñ∞Ë¶è‰∫àÂÆö„ÇíËøΩÂä†';
            
            const title = isEdit ? event.title : '';
            const eventDate = isEdit ? event.date : (date || new Date().toISOString().split('T')[0]);
            const eventTime = isEdit ? (event.time || '') : time;
            const type = isEdit ? event.type : 'custom';
            const color = isEdit ? event.color : 'blue';
            
            const modal = `
                <div id="eventModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-lg p-6 w-96 max-w-full mx-4">
                        <h3 class="text-lg font-semibold mb-4">${modalTitle}</h3>
                        <form id="eventForm" onsubmit="saveEvent(event, ${isEdit ? event.id : 'null'})">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">„Çø„Ç§„Éà„É´</label>
                                    <input type="text" id="eventTitle" value="${title}" class="w-full px-3 py-2 border rounded-md" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Êó•‰ªò</label>
                                    <input type="date" id="eventDate" value="${eventDate}" class="w-full px-3 py-2 border rounded-md" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ÊôÇÈñì</label>
                                    <input type="time" id="eventTime" value="${eventTime}" class="w-full px-3 py-2 border rounded-md">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Á®ÆÂà•</label>
                                    <select id="eventType" class="w-full px-3 py-2 border rounded-md">
                                        <option value="hearing" ${type === 'hearing' ? 'selected' : ''}>ÁèæÂú∞Ë™øÊüª</option>
                                        <option value="construction" ${type === 'construction' ? 'selected' : ''}>Â∑•‰∫ã</option>
                                        <option value="estimate" ${type === 'estimate' ? 'selected' : ''}>Ë¶ãÁ©ç„ÇÇ„Çä</option>
                                        <option value="meeting" ${type === 'meeting' ? 'selected' : ''}>Êâì„Å°Âêà„Çè„Åõ</option>
                                        <option value="custom" ${type === 'custom' ? 'selected' : ''}>„Åù„ÅÆ‰ªñ</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Ëâ≤</label>
                                    <div class="flex space-x-2">
                                        <button type="button" onclick="selectColor('blue')" class="w-8 h-8 rounded-full bg-blue-500 ${color === 'blue' ? 'ring-2 ring-offset-2 ring-blue-400' : ''}"></button>
                                        <button type="button" onclick="selectColor('green')" class="w-8 h-8 rounded-full bg-green-500 ${color === 'green' ? 'ring-2 ring-offset-2 ring-green-400' : ''}"></button>
                                        <button type="button" onclick="selectColor('yellow')" class="w-8 h-8 rounded-full bg-yellow-500 ${color === 'yellow' ? 'ring-2 ring-offset-2 ring-yellow-400' : ''}"></button>
                                        <button type="button" onclick="selectColor('purple')" class="w-8 h-8 rounded-full bg-purple-500 ${color === 'purple' ? 'ring-2 ring-offset-2 ring-purple-400' : ''}"></button>
                                        <button type="button" onclick="selectColor('red')" class="w-8 h-8 rounded-full bg-red-500 ${color === 'red' ? 'ring-2 ring-offset-2 ring-red-400' : ''}"></button>
                                    </div>
                                    <input type="hidden" id="eventColor" value="${color}">
                                </div>
                            </div>
                            <div class="flex justify-end space-x-3 mt-6">
                                ${isEdit ? '<button type="button" onclick="deleteEvent(' + event.id + ')" class="px-4 py-2 text-red-600 hover:bg-red-50 rounded-md">ÂâäÈô§</button>' : ''}
                                <button type="button" onclick="closeEventModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">„Ç≠„É£„É≥„Çª„É´</button>
                                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">‰øùÂ≠ò</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
        }

        // Ëâ≤ÈÅ∏Êäû
        let selectedColor = 'blue';
        function selectColor(color) {
            selectedColor = color;
            document.getElementById('eventColor').value = color;
            
            // „Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÊõ¥Êñ∞
            document.querySelectorAll('#eventModal button[onclick^="selectColor"]').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-offset-2');
            });
            event.target.classList.add('ring-2', 'ring-offset-2');
        }

        // „Ç§„Éô„É≥„Éà‰øùÂ≠ò
        function saveEvent(e, eventId) {
            e.preventDefault();
            
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const type = document.getElementById('eventType').value;
            const color = document.getElementById('eventColor').value;
            
            if (eventId) {
                // Á∑®ÈõÜ
                const eventIndex = calendarEvents.findIndex(event => event.id === eventId);
                if (eventIndex !== -1) {
                    calendarEvents[eventIndex] = {
                        ...calendarEvents[eventIndex],
                        title, date, time, type, color
                    };
                }
            } else {
                // Êñ∞Ë¶è‰ΩúÊàê
                const newEvent = {
                    id: Math.max(...calendarEvents.map(e => e.id), 0) + 1,
                    title, date, time, type, color
                };
                calendarEvents.push(newEvent);
            }
            
            renderCalendar();
            renderMiniCalendar();
            closeEventModal();
            showNotification('‰∫àÂÆö‰øùÂ≠ò', eventId ? '‰∫àÂÆö„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü' : 'Êñ∞„Åó„ÅÑ‰∫àÂÆö„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü');
        }

        // „Ç§„Éô„É≥„ÉàÂâäÈô§
        function deleteEvent(eventId) {
            if (confirm('„Åì„ÅÆ‰∫àÂÆö„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                const eventIndex = calendarEvents.findIndex(event => event.id === eventId);
                if (eventIndex !== -1) {
                    calendarEvents.splice(eventIndex, 1);
                    renderCalendar();
                    renderMiniCalendar();
                    closeEventModal();
                    showNotification('‰∫àÂÆöÂâäÈô§', '‰∫àÂÆö„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
                }
            }
        }

        // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeEventModal() {
            const modal = document.getElementById('eventModal');
            if (modal) {
                modal.remove();
            }
        }

        // Êñ∞Ë¶è„Ç§„Éô„É≥„ÉàËøΩÂä†Ôºà„Éú„Çø„É≥„Åã„ÇâÔºâ
        function addNewEvent() {
            const today = new Date().toISOString().split('T')[0];
            showEventModal(null, today);
        }
        
        // ========== Ë´ãÊ±ÇÁÆ°ÁêÜÊ©üËÉΩ ==========
        
        // Ë´ãÊ±ÇÁÆ°ÁêÜ„Çø„ÉñÂàá„ÇäÊõø„Åà
        function showBillingTab(tabName) {
            // ÂÖ®„Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÈùûË°®Á§∫
            document.querySelectorAll('.billing-tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // ÂÖ®„Çø„Éñ„Éú„Çø„É≥„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíËß£Èô§
            document.querySelectorAll('.billing-tab').forEach(tab => {
                tab.classList.remove('billing-tab-active', 'text-blue-600', 'border-blue-600');
                tab.classList.add('text-gray-500', 'border-transparent');
            });
            
            // „Çø„ÉñÂêç„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞ÔºàÊñ∞„Åó„ÅÑ„Çø„ÉñÂêç„Å´ÂØæÂøúÔºâ
            const tabMapping = {
                'purchase': 'purchaseTab',
                'commission': 'commissionTab',
                'payment': 'paymentTab',
                'analysis': 'analysisTab',
                // ‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅÂè§„ÅÑ„Çø„ÉñÂêç„ÇÇÊÆã„Åô
                'referral': 'purchaseTab',
                'success': 'commissionTab',
                'invoices': 'paymentTab',
                'schedule': 'analysisTab'
            };

            // ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Éñ„ÇíË°®Á§∫
            const tabId = tabMapping[tabName] || (tabName + 'Tab');
            const selectedContent = document.getElementById(tabId);
            if (selectedContent) {
                selectedContent.style.display = 'block';
            }
            
            // ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Éñ„Éú„Çø„É≥„Çí„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´
            const selectedTab = document.querySelector(`[data-tab="${tabName}"]`);
            if (selectedTab) {
                selectedTab.classList.remove('text-gray-500', 'border-transparent');
                selectedTab.classList.add('billing-tab-active', 'text-blue-600', 'border-blue-600');
            }
        }

        // Ë≤°Âãô„Éá„Éº„ÇøÊõ¥Êñ∞Èñ¢Êï∞
        function updateFinancialData(month) {
            const date = new Date(month + '-01');
            const monthNum = date.getMonth() + 1;
            const year = date.getFullYear();

            // „Çµ„Éû„É™„Éº„Ç´„Éº„Éâ„ÇíÊõ¥Êñ∞
            const referralFeeMonth = document.getElementById('referralFeeMonth');
            if (referralFeeMonth) {
                referralFeeMonth.textContent = `${monthNum}ÊúàÁ¥π‰ªãÊñô`;
            }
            const commissionMonth = document.getElementById('commissionMonth');
            if (commissionMonth) {
                commissionMonth.textContent = `${monthNum}ÊúàÊàêÁ¥ÑÊâãÊï∞Êñô`;
            }
            const roiLabel = document.getElementById('roiLabel');
            if (roiLabel) {
                roiLabel.textContent = `${monthNum}ÊúàROI`;
            }

            // „ÉÜ„Éº„Éñ„É´„Éá„Éº„Çø„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞ÔºàÂÆüÈöõ„Å´„ÅØ„Çµ„Éº„Éê„Éº„Åã„ÇâÂèñÂæóÔºâ
            const tbody = document.getElementById('referralFeeTableBody');
            if (tbody) {
                const rows = tbody.getElementsByTagName('tr');
                for (let row of rows) {
                    const dateCell = row.cells[0];
                    if (dateCell) {
                        const rowDate = new Date(dateCell.textContent);
                        const rowMonth = rowDate.getMonth() + 1;
                        const rowYear = rowDate.getFullYear();
                        if (rowMonth === monthNum && rowYear === year) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    }
                }
            }

            // ÂêÑ„Çø„Éñ„ÅÆ„Éá„Éº„Çø„ÇÇÊõ¥Êñ∞
            updateAllFinancialTabs(month);
        }

        // „Éá„Éù„Ç∏„ÉÉ„ÉàÁÆ°ÁêÜÈñ¢Êï∞
        function showDepositModal() {
            const quantity = prompt('Ë≥ºÂÖ•„Åô„Çã„Éá„Éù„Ç∏„ÉÉ„ÉàÊï∞Ôºà‰ª∂Êï∞Ôºâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:', '10');
            if (quantity && !isNaN(quantity) && quantity > 0) {
                const total = parseInt(quantity) * 22000;
                const today = new Date();
                const dueDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 7);
                const message = `
„Éá„Éù„Ç∏„ÉÉ„Éà${quantity}‰ª∂ÂàÜÔºà¬•${total.toLocaleString()}Ôºâ„ÅÆË´ãÊ±ÇÊõ∏„ÇíÁô∫Ë°å„Åó„Åæ„Åô„ÄÇ

„ÄêË´ãÊ±ÇÂÜÖÂÆπ„Äë
„Éª„Éá„Éù„Ç∏„ÉÉ„ÉàÔºö${quantity}‰ª∂ √ó ¬•22,000 = ¬•${total.toLocaleString()}
„ÉªÊîØÊâïÊúüÈôêÔºö${dueDate.getFullYear()}Âπ¥${dueDate.getMonth() + 1}Êúà${dueDate.getDate()}Êó•
„ÉªÊúâÂäπÊúüÈôêÔºöÂÖ•ÈáëÁ¢∫Ë™ç„ÅÆÁøå„ÄÖÊúàÊú´„Åæ„Åß

„Äê„ÅîÊ≥®ÊÑè‰∫ãÈ†Ö„Äë
„ÉªÂÖ•ÈáëÁ¢∫Ë™çÂæå„Å´„Éá„Éù„Ç∏„ÉÉ„Éà„ÅåÂèçÊò†„Åï„Çå„Åæ„Åô
„ÉªÂèçÊò†Âæå„ÄÅ„É©„É≥„Ç≠„É≥„Ç∞„Åå1„É©„É≥„ÇØUP„Åó„Åæ„Åô
„ÉªËøîÈáëÊôÇ„ÅÆÊåØËæºÊâãÊï∞Êñô„ÅØ„ÅäÂÆ¢ÊßòË≤†ÊãÖ„Å®„Å™„Çä„Åæ„Åô

Ë´ãÊ±ÇÊõ∏„ÇíÁô∫Ë°å„Åó„Å¶„Çà„Çç„Åó„ÅÑ„Åß„Åó„Çá„ÅÜ„ÅãÔºü`;

                if (confirm(message)) {
                    // Ë´ãÊ±ÇÊõ∏Áô∫Ë°å„ÅÆÂá¶ÁêÜ
                    const invoiceNo = 'INV-' + Date.now().toString().slice(-8);
                    alert(`Ë´ãÊ±ÇÊõ∏„ÇíÁô∫Ë°å„Åó„Åæ„Åó„Åü„ÄÇ\n\nË´ãÊ±ÇÊõ∏Áï™Âè∑Ôºö${invoiceNo}\n„Éá„Éù„Ç∏„ÉÉ„ÉàÊï∞Ôºö${quantity}‰ª∂\nË´ãÊ±ÇÈáëÈ°çÔºö¬•${total.toLocaleString()}\n\nÂÖ•ÈáëÁ¢∫Ë™çÂæå„ÄÅ1Âñ∂Ê•≠Êó•‰ª•ÂÜÖ„Å´„Éá„Éù„Ç∏„ÉÉ„Éà„ÅåÂèçÊò†„Åï„Çå„Åæ„Åô„ÄÇ`);
                    // Ë≥ºÂÖ•Áî≥Ë´ãÂ±•Ê≠¥„Å´ËøΩÂä†ÔºàÂÆüÈöõ„ÅØ„Çµ„Éº„Éê„ÉºÂÅ¥„ÅßÂá¶ÁêÜÔºâ
                    location.reload();
                }
            }
        }

        function updateDepositSetting() {
            const selectedValue = document.querySelector('input[name="depositHandling"]:checked').value;
            const message = selectedValue === 'rollover'
                ? 'Áπ∞Ë∂äË®≠ÂÆö„Å´Â§âÊõ¥„Åó„Åæ„Åó„Åü„ÄÇÊúüÈôêÂàá„ÇåÂæå„ÇÇÁ∂ôÁ∂ö„Åó„Å¶Âà©Áî®„Åß„Åç„Åæ„Åô„ÄÇ'
                : 'ËøîÈáëË®≠ÂÆö„Å´Â§âÊõ¥„Åó„Åæ„Åó„Åü„ÄÇÊúüÈôêÂàá„ÇåÊôÇ„Å´Êú™‰ΩøÁî®ÂàÜ„ÅåËøîÈáë„Åï„Çå„Åæ„Åô„ÄÇ';
            alert(message);
        }

        // Ë´ãÊ±ÇÊõ∏„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÊ©üËÉΩ
        function downloadInvoice(invoiceNo) {
            alert(`Ë´ãÊ±ÇÊõ∏Ôºà${invoiceNo}Ôºâ„ÅÆ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„ÇíÈñãÂßã„Åó„Åæ„Åô„ÄÇ\n\n‚ÄªÂÆüÈöõ„ÅÆÂÆüË£Ö„Åß„ÅØ„ÄÅ„Çµ„Éº„Éê„Éº„Åã„ÇâË´ãÊ±ÇÊõ∏PDF„ÇíÂèñÂæó„Åó„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åô„ÄÇ`);
            // ÂÆüÈöõ„ÅÆÂÆüË£Ö„Åß„ÅØ‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å™Âá¶ÁêÜ„ÇíË°å„ÅÜ
            // window.location.href = `/api/invoices/${invoiceNo}/download`;
        }

        // „Éá„Éù„Ç∏„ÉÉ„ÉàÂ±•Ê≠¥„Éï„Ç£„É´„Çø„ÉºÊ©üËÉΩ
        function filterDepositHistory() {
            const typeFilter = document.getElementById('depositTypeFilter').value;
            const monthFilter = document.getElementById('depositMonthFilter').value;
            const rows = document.querySelectorAll('.deposit-row');

            rows.forEach(row => {
                const rowType = row.getAttribute('data-type');
                const rowDate = row.getAttribute('data-date');

                let showRow = true;

                // Á®ÆÂà•„Éï„Ç£„É´„Çø„Éº
                if (typeFilter !== 'all' && rowType !== typeFilter) {
                    showRow = false;
                }

                // Êúà„Éï„Ç£„É´„Çø„Éº
                if (monthFilter && rowDate !== monthFilter) {
                    showRow = false;
                }

                // Ë°®Á§∫/ÈùûË°®Á§∫
                row.style.display = showRow ? '' : 'none';
            });
        }

        // „Éá„Éù„Ç∏„ÉÉ„ÉàÈáëÈ°çË®àÁÆó
        document.addEventListener('DOMContentLoaded', function() {
            const depositInput = document.getElementById('depositAmount');
            const depositTotal = document.getElementById('depositTotal');
            if (depositInput && depositTotal) {
                depositInput.addEventListener('input', function() {
                    const amount = parseInt(this.value) || 0;
                    const total = amount * 22000;
                    depositTotal.textContent = '¬•' + total.toLocaleString();
                });
            }
        })

        // ÂÖ®Ë≤°Âãô„Çø„Éñ„ÅÆ„Éá„Éº„ÇøÊõ¥Êñ∞
        function updateAllFinancialTabs(month) {
            // ÊàêÁ¥ÑÊâãÊï∞Êñô„ÄÅÊîØÊâïÂ±•Ê≠¥„ÄÅÂèéÊîØÂàÜÊûê„Çø„Éñ„ÇÇÊõ¥Êñ∞
            console.log('ÂÖ®Ë≤°Âãô„Çø„Éñ„Çí' + month + '„Å´Êõ¥Êñ∞');
        }

        // Á¥π‰ªãÊñôË®àÁÆó
        function calculateReferralFee(projectType, buildingType, floors, competitors) {
            let baseFee = 0;
            const TAX_RATE = 0.10;
            
            // „Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥3Èöé‰ª•‰∏ä„ÅÆÁâπÂà•ÊñôÈáë
            if (buildingType === 'apartment' && floors >= 3) {
                if (projectType.includes('Â§ñÂ£Å')) {
                    baseFee = 30000;
                }
            }
            // ÂçòÂìÅÈ†ÖÁõÆÔºàÁõ∏Ë¶ãÁ©ç„ÇÇ„ÇäÔºâ
            else if (competitors > 1) {
                if (projectType === 'Â±ãÊ†πÂ°óË£Ö' || projectType === 'Â±ã‰∏äÈò≤Ê∞¥') {
                    baseFee = 10000;
                } else if (projectType === 'Â§ñÂ£ÅË£ú‰øÆ' || projectType === 'Â±ãÊ†πË£ú‰øÆ' || projectType === '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥') {
                    baseFee = 5000;
                }
            }
            // Âü∫Êú¨È†ÖÁõÆ
            else {
                baseFee = 20000;
            }
            
            const tax = Math.floor(baseFee * TAX_RATE);
            return {
                base: baseFee,
                tax: tax,
                total: baseFee + tax
            };
        }
        
        // ÊàêÁ¥ÑÊâãÊï∞ÊñôË®àÁÆó
        function calculateSuccessFee(contractAmount, rate = 0.10) {
            const TAX_RATE = 0.10;
            const baseFee = Math.floor(contractAmount * rate);
            const tax = Math.floor(baseFee * TAX_RATE);
            
            return {
                base: baseFee,
                tax: tax,
                total: baseFee + tax,
                rate: rate
            };
        }
        
        // ÊîØÊâï‰∫àÂÆöÊó•Ë®àÁÆóÔºàÂúüÊó•Á•ùÊó•„ÅÆÂæå„ÇçÂÄí„ÅóÔºâ
        function calculatePaymentDate(paymentMethod) {
            const today = new Date();
            const nextMonth = new Date(today.getFullYear(), today.getMonth() + 1, 1);
            let paymentDate;
            
            if (paymentMethod === 'BANK_TRANSFER') {
                // ÁøåÊúà15Êó•
                paymentDate = new Date(nextMonth.getFullYear(), nextMonth.getMonth(), 15);
            } else {
                // ÁøåÊúà27Êó•ÔºàÂè£Â∫ßÊåØÊõøÔºâ
                paymentDate = new Date(nextMonth.getFullYear(), nextMonth.getMonth(), 27);
            }
            
            // ÂúüÊó•Á•ùÊó•„ÉÅ„Çß„ÉÉ„ÇØÔºàÁ∞°ÊòìÁâàÔºâ
            while (paymentDate.getDay() === 0 || paymentDate.getDay() === 6) {
                paymentDate.setDate(paymentDate.getDate() + 1);
            }
            
            // Á•ùÊó•„ÉÅ„Çß„ÉÉ„ÇØ
            const holidayStr = paymentDate.toISOString().split('T')[0];
            if (japaneseHolidays[holidayStr]) {
                paymentDate.setDate(paymentDate.getDate() + 1);
                // ÂÜçÂ∫¶ÂúüÊó•„ÉÅ„Çß„ÉÉ„ÇØ
                while (paymentDate.getDay() === 0 || paymentDate.getDay() === 6) {
                    paymentDate.setDate(paymentDate.getDate() + 1);
                }
            }
            
            return paymentDate;
        }
        
        // Ë´ãÊ±ÇÊõ∏Áô∫Ë°å
        function issueInvoice(invoiceId) {
            if (confirm('Ë´ãÊ±ÇÊõ∏„ÇíÁô∫Ë°å„Åó„Åæ„Åô„ÅãÔºü')) {
                // „Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÊõ¥Êñ∞Ôºà„Éá„É¢Ôºâ
                const statusCell = document.querySelector(`[value="${invoiceId}"]`).closest('tr').querySelector('.bg-yellow-100');
                if (statusCell) {
                    statusCell.classList.remove('bg-yellow-100', 'text-yellow-800');
                    statusCell.classList.add('bg-green-100', 'text-green-800');
                    statusCell.textContent = 'Áô∫Ë°åÊ∏à';
                }
                
                showNotification('Ë´ãÊ±ÇÊõ∏Áô∫Ë°å', `Ë´ãÊ±ÇÊõ∏ ${invoiceId} „ÇíÁô∫Ë°å„Åó„Åæ„Åó„Åü`);
            }
        }
        
        // ÊàêÁ¥ÑÊâãÊï∞ÊñôË´ãÊ±ÇÊõ∏Áô∫Ë°å
        function issueSuccessFee(feeId) {
            if (confirm('ÊàêÁ¥ÑÊâãÊï∞Êñô„ÅÆË´ãÊ±ÇÊõ∏„ÇíÁô∫Ë°å„Åó„Åæ„Åô„ÅãÔºü')) {
                showNotification('ÊàêÁ¥ÑÊâãÊï∞ÊñôË´ãÊ±Ç', `Ë´ãÊ±ÇÊõ∏„ÇíÁô∫Ë°å„Åó„Åæ„Åó„ÅüÔºà${feeId}Ôºâ`);
                
                // Ë°å„ÇíÈùûË°®Á§∫„Å´Ôºà„Éá„É¢Ôºâ
                const row = document.querySelector(`button[onclick="issueSuccessFee('${feeId}')"]`).closest('tr');
                if (row) {
                    row.style.opacity = '0.5';
                    setTimeout(() => {
                        row.style.display = 'none';
                    }, 500);
                }
            }
        }
        
        // ÊâãÂãïÁô∫Ë°å
        function manualIssueSuccessFee(feeId) {
            const reason = prompt('ÊâãÂãïÁô∫Ë°å„ÅÆÁêÜÁî±„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö');
            if (reason) {
                issueSuccessFee(feeId);
                console.log('ÊâãÂãïÁô∫Ë°åÁêÜÁî±:', reason);
            }
        }
        
        // ÊúàÊ¨°Ë´ãÊ±ÇÊõ∏‰∏ÄÊã¨Áô∫Ë°å
        function generateMonthlyInvoices() {
            const checkedBoxes = document.querySelectorAll('.invoice-checkbox:checked');
            if (checkedBoxes.length === 0) {
                alert('Áô∫Ë°å„Åô„ÇãË´ãÊ±ÇÊõ∏„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            if (confirm(`${checkedBoxes.length}‰ª∂„ÅÆË´ãÊ±ÇÊõ∏„Çí‰∏ÄÊã¨Áô∫Ë°å„Åó„Åæ„Åô„ÅãÔºü`)) {
                checkedBoxes.forEach(checkbox => {
                    issueInvoice(checkbox.value);
                });
                showNotification('‰∏ÄÊã¨Áô∫Ë°åÂÆå‰∫Ü', `${checkedBoxes.length}‰ª∂„ÅÆË´ãÊ±ÇÊõ∏„ÇíÁô∫Ë°å„Åó„Åæ„Åó„Åü`);
            }
        }
        
        // ÂÖ®ÈÅ∏Êäû
        function selectAllInvoices(checkbox) {
            document.querySelectorAll('.invoice-checkbox').forEach(cb => {
                cb.checked = checkbox.checked;
            });
        }
        
        // Ë´ãÊ±ÇÊõ∏Ë©≥Á¥∞Ë°®Á§∫
        function showInvoiceDetail(invoiceId) {
            alert(`Ë´ãÊ±ÇÊõ∏Ë©≥Á¥∞: ${invoiceId}\n\nÂÆüË£Ö‰∫àÂÆöÔºö\n- ÊòéÁ¥∞Ë°®Á§∫\n- Á∑®ÈõÜÊ©üËÉΩ\n- „É°„Éº„É´ÈÄÅ‰ø°`);
        }
        
        // PDFÂá∫Âäõ
        function downloadPDF(invoiceId) {
            showNotification('PDFÂá∫Âäõ', `${invoiceId}.pdf „Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü`);
        }
        
        // Ë≤°Âãô„É¨„Éù„Éº„Éà CSVÂá∫Âäõ
        function exportFinancialReport() {
            const data = [
                ['Ë≥ºÂÖ•Êó•', 'Ê°à‰ª∂ID', 'È°ßÂÆ¢Âêç', '„Ç®„É™„Ç¢', 'Ë≥ºÂÖ•ÈáëÈ°ç', 'ÊàêÁ¥ÑÈáëÈ°ç', 'ÊâãÊï∞Êñô', 'ROI'],
                ['2025-01-15', 'C2025-001', 'Áî∞‰∏≠Êßò', 'Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫', '85000', '', '', ''],
                ['2025-01-10', 'C2025-002', '‰ΩêËó§Êßò', 'Á•ûÂ•àÂ∑ùÁúåÂ∑ùÂ¥éÂ∏Ç', '22000', '1200000', '132000', '475%'],
                ['2025-01-08', 'C2025-003', 'Èà¥Êú®Êßò', 'ÂüºÁéâÁúåË∂äË∞∑Â∏Ç', '80000', '800000', '80000', '100%']
            ];
            
            const csv = data.map(row => row.join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `invoices_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            
            showNotification('CSVÂá∫Âäõ', 'Ë´ãÊ±ÇÊõ∏‰∏ÄË¶ß„ÇíCSV„ÅßÂá∫Âäõ„Åó„Åæ„Åó„Åü');
        }

        // „É¨„Éù„Éº„ÉàÁî®„ÅÆ„Ç∞„É©„ÉïÂàùÊúüÂåñ
        let salesChart = null;
        let conversionChart = null;
        let leadTimeChart = null;

        // „É¨„Éù„Éº„ÉàÊõ¥Êñ∞Èñ¢Êï∞
        function updateReports() {
            const period = document.getElementById('reportPeriod').value;
            // ÊúüÈñì„Å´Âøú„Åò„Åü„Éá„Éº„ÇøÂèñÂæó„Å®Êõ¥Êñ∞Âá¶ÁêÜ
            renderCharts();
        }

        // „Ç∞„É©„ÉïÊèèÁîªÈñ¢Êï∞
        function renderCharts() {
            // Â£≤‰∏äÊé®Áßª„Ç∞„É©„Éï
            const salesCtx = document.getElementById('salesChart');
            if (salesCtx) {
                if (salesChart) {
                    salesChart.destroy();
                }
                salesChart = new Chart(salesCtx, {
                    type: 'line',
                    data: {
                        labels: ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà'],
                        datasets: [{
                            label: 'Â£≤‰∏äÔºàÂçÉÂÜÜÔºâ',
                            data: [6200, 7500, 6800, 8450, 7900, 8450],
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '¬•' + value.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // ÊàêÁ¥ÑÁéáÊé®Áßª„Ç∞„É©„Éï
            const conversionCtx = document.getElementById('conversionChart');
            if (conversionCtx) {
                if (conversionChart) {
                    conversionChart.destroy();
                }
                conversionChart = new Chart(conversionCtx, {
                    type: 'bar',
                    data: {
                        labels: ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà'],
                        datasets: [{
                            label: 'ÊàêÁ¥ÑÁéáÔºà%Ôºâ',
                            data: [65, 62, 68, 70, 67, 68.5],
                            backgroundColor: [
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(34, 197, 94, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // „É™„Éº„Éâ„Çø„Ç§„É†„ÉÅ„É£„Éº„Éà
            const leadTimeCtx = document.getElementById('leadTimeChart');
            if (leadTimeCtx) {
                if (leadTimeChart) {
                    leadTimeChart.destroy();
                }
                leadTimeChart = new Chart(leadTimeCtx, {
                    type: 'line',
                    data: {
                        labels: ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà'],
                        datasets: [
                            {
                                label: 'ÂïèÂêà„Åõ‚ÜíË™øÊüª',
                                data: [3.5, 3.8, 3.2, 3.0, 3.1, 3.2],
                                borderColor: 'rgb(59, 130, 246)',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.3
                            },
                            {
                                label: 'Ë™øÊüª‚ÜíË¶ãÁ©ç',
                                data: [3.0, 2.9, 3.1, 2.7, 2.8, 2.8],
                                borderColor: 'rgb(34, 197, 94)',
                                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                tension: 0.3
                            },
                            {
                                label: 'Ë¶ãÁ©ç‚ÜíÊàêÁ¥Ñ',
                                data: [6.0, 5.8, 5.5, 5.2, 5.3, 5.5],
                                borderColor: 'rgb(168, 85, 247)',
                                backgroundColor: 'rgba(168, 85, 247, 0.1)',
                                tension: 0.3
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: {
                                        size: 10
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + context.parsed.y + 'Êó•';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value + 'Êó•';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        // „É™„Éº„Éâ„Çø„Ç§„É†Ë°®Á§∫ÂàáÊõøÔºàÂπ≥Âùá/‰∏≠Â§ÆÂÄ§Ôºâ
        function updateLeadTimeDisplay() {
            const showMedian = document.getElementById('showMedian').checked;

            if (showMedian) {
                document.getElementById('leadTime1').textContent = '3.0Êó•';
                document.getElementById('leadTime2').textContent = '2.5Êó•';
                document.getElementById('leadTime3').textContent = '5.0Êó•';
            } else {
                document.getElementById('leadTime1').textContent = '3.2Êó•';
                document.getElementById('leadTime2').textContent = '2.8Êó•';
                document.getElementById('leadTime3').textContent = '5.5Êó•';
            }
        }

        // „É¨„Éù„Éº„Éà„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÈñ¢Êï∞
        function exportReport() {
            const period = document.getElementById('reportPeriod').value;
            const periodText = document.getElementById('reportPeriod').options[document.getElementById('reportPeriod').selectedIndex].text;

            // CSVÂΩ¢Âºè„Åß„Éá„Éº„Çø„ÇíÁîüÊàê
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Âä†ÁõüÂ∫óÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É† „É¨„Éù„Éº„Éà - " + periodText + "\n\n";

            // KPI„Çµ„Éû„É™„Éº
            csvContent += "KPI„Çµ„Éû„É™„Éº\n";
            csvContent += "È†ÖÁõÆ,Êï∞ÂÄ§,ÂâçÊúàÊØî\n";
            csvContent += "Á∑èÂ£≤‰∏ä,¬•8450000,+12%\n";
            csvContent += "ÊàêÁ¥ÑÁéá,68.5%,+5.2%\n";
            csvContent += "Âπ≥ÂùáÂçò‰æ°,¬•952000,-3%\n";
            csvContent += "Êñ∞Ë¶èÊ°à‰ª∂,42‰ª∂,+8‰ª∂\n\n";

            // Âñ∂Ê•≠Âà•ÊàêÁ∏æ
            csvContent += "Âñ∂Ê•≠Âà•ÊàêÁ∏æ\n";
            csvContent += "Âñ∂Ê•≠Âêç,ÊàêÁ¥ÑÊï∞,ÊàêÁ¥ÑÁéá,Â£≤‰∏ä\n";
            csvContent += "Áî∞‰∏≠Â§™ÈÉé,12,75%,¬•3200000\n";
            csvContent += "‰ΩêËó§Ëä±Â≠ê,8,62%,¬•2100000\n";
            csvContent += "Èà¥Êú®Ê¨°ÈÉé,5,45%,¬•1450000\n\n";

            // „Ç®„É™„Ç¢Âà•ÊàêÁ∏æ
            csvContent += "„Ç®„É™„Ç¢Âà•ÊàêÁ∏æ\n";
            csvContent += "„Ç®„É™„Ç¢,Ê°à‰ª∂Êï∞,ÊàêÁ¥ÑÁéá,Â£≤‰∏ä\n";
            csvContent += "Êù±‰∫¨ÈÉΩ,18,72%,¬•4200000\n";
            csvContent += "Á•ûÂ•àÂ∑ùÁúå,12,65%,¬•2800000\n";
            csvContent += "ÂüºÁéâÁúå,8,58%,¬•1450000\n";

            // „ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÂÆüË°å
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "report_" + new Date().toISOString().split('T')[0] + ".csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showNotification('„É¨„Éù„Éº„ÉàÂá∫Âäõ', 'CSV„Éï„Ç°„Ç§„É´„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü');
        }

        // „Çª„ÇØ„Ç∑„Éß„É≥Ë°®Á§∫ÊôÇ„Å´„Ç∞„É©„Éï„ÇíÂàùÊúüÂåñ
        const originalShowSection = showSection;
        showSection = function(section) {
            originalShowSection(section);

            if (section === 'reports') {
                setTimeout(() => {
                    renderCharts();
                }, 100);
            }

            // Ê°à‰ª∂ÁÆ°ÁêÜÊ©üËÉΩ
            if (section === 'cancel') {
                displayCancelCases();
            } else if (section === 'contract') {
                displayContractCases();
            }

            // ‰ºöÁ§æÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥
            if (section === 'company') {
                setTimeout(loadCurrentUrlInfo, 500);
            }

            // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥
            if (section === 'autodelivery') {
                const merchantId = window.merchantId || sessionStorage.getItem('currentUser');

                if (merchantId && window.merchantData) {
                    window.loadAutodeliverySettings(window.merchantData);
                } else {
                    const savedUser = sessionStorage.getItem('currentUser');
                    if (savedUser) {
                        window.merchantId = savedUser;
                        fetchMerchantDataForAutodelivery(savedUser);
                    }
                }
            }
            // Ê°à‰ª∂ÁÆ°ÁêÜ„Çª„ÇØ„Ç∑„Éß„É≥„ÅØ originalShowSection „ÅßÂá¶ÁêÜÊ∏à„Åø
        }

        // =====================================================
        // V2007: Ê°à‰ª∂ÁÆ°ÁêÜÊ©üËÉΩÔºàÂÆü„Éá„Éº„ÇøÈÄ£Êê∫Ôºâ
        // =====================================================
        let merchantCasesData = [];
        let merchantCasesStats = {};
        let currentFilter = 'all';
        let currentMemoCase = null;
        let currentStatusCase = null;

        // „ÇΩ„Éº„Éà„ÉªÊúüÈñì„Éª‰∏¶„Å≥È†Ü„ÅÆÁä∂ÊÖãÂ§âÊï∞
        let selectedStatuses = [];
        let dateFilterType = 'none'; // none/delivery/call
        let dateFilterFrom = null;
        let dateFilterTo = null;
        let currentSortOrder = 'date-desc'; // date-desc/nextcall-asc/status

        // „Çπ„ÉÜ„Éº„Çø„Çπ‚Üí„Çπ„Çø„Ç§„É´„Éû„ÉÉ„Éî„É≥„Ç∞ÔºàÊ∏©Â∫¶ÊÑü„ÅßÁµ±‰∏ÄÔºâ
        // Èùí=„Éï„É¨„ÉÉ„Ç∑„É•/„ÇØ„Éº„É´ ‚Üí „Ç™„É¨„É≥„Ç∏=Ê∏© ‚Üí Á∑ë=ÊàêÁ¥Ñ ‚Üí „Ç∞„É¨„Éº=ÁµÇ‰∫Ü„Éª„Éç„Ç¨„ÉÜ„Ç£„Éñ
        const statusStyles = {
            // ÈÄ≤Ë°å‰∏≠ÔºàÊ∏©Â∫¶‰∏äÊòáÈ†ÜÔºâ
            'Êñ∞ÁùÄ': { bg: 'bg-blue-100', text: 'text-blue-800', border: 'border-blue-300' },
            'Êú™ÂØæÂøú': { bg: 'bg-blue-100', text: 'text-blue-800', border: 'border-blue-300' },
            'Êú™„Ç¢„Éù': { bg: 'bg-pink-100', text: 'text-pink-700', border: 'border-pink-300' },
            'Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù': { bg: 'bg-pink-100', text: 'text-pink-700', border: 'border-pink-300' },
            '„Ç¢„ÉùÊ∏à': { bg: 'bg-orange-100', text: 'text-orange-800', border: 'border-orange-300' },
            'ÁèæË™øÊ∏à': { bg: 'bg-purple-100', text: 'text-purple-800', border: 'border-purple-300' },
            'Ë¶ãÁ©çÊèêÂá∫Ê∏à„Åø': { bg: 'bg-amber-100', text: 'text-amber-800', border: 'border-amber-300' },
            'Ë¶ãÁ©çÊèêÂá∫Ê∏à': { bg: 'bg-amber-100', text: 'text-amber-800', border: 'border-amber-300' },
            'ÂÖ•Èáë‰∫àÂÆö': { bg: 'bg-cyan-100', text: 'text-cyan-800', border: 'border-cyan-300' },
            // „Ç¥„Éº„É´
            'ÊàêÁ¥Ñ': { bg: 'bg-green-100', text: 'text-green-800', border: 'border-green-300' },
            'ÂÖ•ÈáëÊ∏à': { bg: 'bg-emerald-100', text: 'text-emerald-800', border: 'border-emerald-300' },
            // „Éç„Ç¨„ÉÜ„Ç£„ÉñÁµÇ‰∫Ü
            'ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´': { bg: 'bg-gray-100', text: 'text-gray-600', border: 'border-gray-300' },
            'ÁèæË™øÂæåÂ§±Ê≥®': { bg: 'bg-gray-200', text: 'text-gray-700', border: 'border-gray-400' },
            '‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à': { bg: 'bg-gray-100', text: 'text-gray-600', border: 'border-gray-300' },
            'Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à': { bg: 'bg-indigo-100', text: 'text-indigo-700', border: 'border-indigo-300' },
            '„ÇØ„É¨„Éº„É†': { bg: 'bg-red-100', text: 'text-red-800', border: 'border-red-300' },
            '„Ç≠„É£„É≥„Çª„É´': { bg: 'bg-gray-100', text: 'text-gray-600', border: 'border-gray-300' },
            // „Éá„Éï„Ç©„É´„ÉàÔºàÊñ∞ÁùÄÊâ±„ÅÑÔºâ
            '': { bg: 'bg-blue-100', text: 'text-blue-800', border: 'border-blue-300' }
        };

        // Ê°à‰ª∂„Éá„Éº„Çø„ÇíAPI„Åã„ÇâÂèñÂæó
        async function loadMerchantCases() {
            const merchantId = window.merchantId || sessionStorage.getItem('currentUser');
            if (!merchantId) {
                console.warn('[Ê°à‰ª∂ÁÆ°ÁêÜ] merchantId „ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }

            const loadingEl = document.getElementById('casesLoading');
            if (loadingEl) loadingEl.classList.remove('hidden');

            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        system: 'merchant',
                        subsystem: 'contract',
                        action: 'getMerchantCases',
                        merchantId: merchantId
                    })
                });

                const result = await response.json();
                console.log('[Ê°à‰ª∂ÁÆ°ÁêÜ] getMerchantCases response:', result);

                if (result.success) {
                    merchantCasesData = result.cases || [];
                    merchantCasesStats = result.stats || {};
                    updateCasesStats();
                    updateQuickFilterStats();  // Êñ∞UIÁî®Áµ±Ë®à
                    renderCases();
                } else {
                    showNotification('„Ç®„É©„Éº', result.error || 'Ê°à‰ª∂„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                }
            } catch (error) {
                console.error('[Ê°à‰ª∂ÁÆ°ÁêÜ] loadMerchantCases error:', error);
                showNotification('„Ç®„É©„Éº', 'ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
            } finally {
                if (loadingEl) loadingEl.classList.add('hidden');
            }
        }

        // Áµ±Ë®àË°®Á§∫„ÇíÊõ¥Êñ∞
        function updateCasesStats() {
            const setIfExists = (id, value) => {
                const el = document.getElementById(id);
                if (el) el.textContent = value || 0;
            };
            setIfExists('stat-total', merchantCasesStats.total);
            setIfExists('stat-pending', merchantCasesStats.pending);
            setIfExists('stat-contracted', merchantCasesStats.contracted);
        }

        // =====================================================
        // Áµ±ÂêàÁµû„ÇäËæº„Åø„É¢„Éº„ÉÄ„É´Èñ¢Êï∞Ôºà„Çπ„ÉÜ„Éº„Çø„ÇπÔºãÈÖç‰ø°Êó•„ÇíÂêà‰ΩìÔºâ
        // =====================================================
        let ufSelectedStatuses = [];  // Áµ±Âêà„É¢„Éº„ÉÄ„É´Áî®„ÅÆ„Çπ„ÉÜ„Éº„Çø„ÇπÈÅ∏Êäû
        let ufDateFrom = null;        // Áµ±Âêà„É¢„Éº„ÉÄ„É´Áî®„ÅÆÊó•‰ªòÈñãÂßã
        let ufDateTo = null;          // Áµ±Âêà„É¢„Éº„ÉÄ„É´Áî®„ÅÆÊó•‰ªòÁµÇ‰∫Ü
        let ufSelectedMonth = null;   // Áµ±Âêà„É¢„Éº„ÉÄ„É´Áî®„ÅÆÊúàÈÅ∏Êäû

        function openUnifiedFilterModal() {
            document.getElementById('unifiedFilterModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            initUnifiedFilterModal();
        }

        function closeUnifiedFilterModal() {
            document.getElementById('unifiedFilterModal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        function initUnifiedFilterModal() {
            // „Éó„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
            ufUpdatePresetButtonStates();

            // ÊúüÈñì„Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
            ufUpdatePeriodButtonStates();

            // ÂÄãÂà•„Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫Ôºà„Éó„É™„Çª„ÉÉ„ÉàÈÅ∏ÊäûÊ∏à„Åø„ÅÆÂ†¥Âêà„ÅÆ„ÅøÔºâ
            const detailSection = document.getElementById('uf-detail-statuses');
            if (detailSection) {
                if (ufCurrentPreset) {
                    detailSection.classList.remove('hidden');
                } else {
                    detailSection.classList.add('hidden');
                }
            }

            // „Çπ„ÉÜ„Éº„Çø„Çπ„Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
            ufUpdateStatusButtonStates();
            ufUpdateSelectedStatusCount();

            // Êó•‰ªòÂÖ•Âäõ„ÅÆÁä∂ÊÖãÂæ©ÂÖÉ
            const dateFromEl = document.getElementById('ufModalDateFrom');
            const dateToEl = document.getElementById('ufModalDateTo');
            if (dateFromEl) dateFromEl.value = ufDateFrom || '';
            if (dateToEl) dateToEl.value = ufDateTo || '';

            // Á¥∞„Åã„ÅÑÊó•‰ªòÁØÑÂõ≤Ë°®Á§∫Ôºà‰ªäÊúà/ÂÖàÊúà„ÅÆÂ†¥Âêà„ÅÆ„ÅøÔºâ
            const customDateRange = document.getElementById('uf-custom-date-range');
            if (customDateRange) {
                if (ufCurrentPeriod === 'thismonth' || ufCurrentPeriod === 'lastmonth') {
                    customDateRange.classList.remove('hidden');
                } else {
                    customDateRange.classList.add('hidden');
                }
            }

            // „Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫Êõ¥Êñ∞
            ufUpdateFilterStatusText();
        }

        // „Çπ„ÉÜ„Éº„Çø„Çπ„Éú„Çø„É≥„ÅÆ„Éà„Ç∞„É´
        function ufToggleStatusFilter(status) {
            const index = ufSelectedStatuses.indexOf(status);
            if (index > -1) {
                ufSelectedStatuses.splice(index, 1);
            } else {
                ufSelectedStatuses.push(status);
            }
            ufUpdateStatusButtonStates();
            ufUpdateSelectedStatusCount();
        }

        // „Çπ„ÉÜ„Éº„Çø„Çπ„Éú„Çø„É≥„ÅÆË¶ã„ÅüÁõÆÊõ¥Êñ∞
        // „Çπ„ÉÜ„Éº„Çø„Çπ„Åî„Å®„ÅÆËâ≤ÂÆöÁæ©ÔºàstatusStyles„Å®Âêå„ÅòËâ≤Ôºâ
        const statusColorMap = {
            'Êñ∞ÁùÄ': { bg: 'bg-blue-100', text: 'text-blue-800', border: 'border-blue-300' },
            'Êú™„Ç¢„Éù': { bg: 'bg-pink-100', text: 'text-pink-700', border: 'border-pink-300' },
            '„Ç¢„ÉùÊ∏à': { bg: 'bg-orange-100', text: 'text-orange-800', border: 'border-orange-300' },
            'ÁèæË™øÊ∏à': { bg: 'bg-purple-100', text: 'text-purple-800', border: 'border-purple-300' },
            'Ë¶ãÁ©çÊèêÂá∫Ê∏à': { bg: 'bg-amber-100', text: 'text-amber-800', border: 'border-amber-300' },
            'ÂÖ•Èáë‰∫àÂÆö': { bg: 'bg-cyan-100', text: 'text-cyan-800', border: 'border-cyan-300' },
            'ÊàêÁ¥Ñ': { bg: 'bg-green-100', text: 'text-green-800', border: 'border-green-300' },
            'ÂÖ•ÈáëÊ∏à': { bg: 'bg-emerald-100', text: 'text-emerald-800', border: 'border-emerald-300' },
            'ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´': { bg: 'bg-gray-100', text: 'text-gray-600', border: 'border-gray-300' },
            'ÁèæË™øÂæåÂ§±Ê≥®': { bg: 'bg-gray-200', text: 'text-gray-700', border: 'border-gray-400' },
            '‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à': { bg: 'bg-gray-100', text: 'text-gray-600', border: 'border-gray-300' },
            'Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à': { bg: 'bg-indigo-100', text: 'text-indigo-700', border: 'border-indigo-300' },
            '„ÇØ„É¨„Éº„É†': { bg: 'bg-red-100', text: 'text-red-800', border: 'border-red-300' }
        };

        function ufUpdateStatusButtonStates() {
            const buttons = document.querySelectorAll('#uf-detail-statuses .uf-status-filter-btn');
            buttons.forEach(button => {
                const onclick = button.getAttribute('onclick');
                const match = onclick.match(/ufToggleStatusFilter\('([^']+)'\)/);
                if (match) {
                    const status = match[1];
                    const colors = statusColorMap[status] || { bg: 'bg-gray-500', border: 'border-gray-500' };

                    if (ufSelectedStatuses.includes(status)) {
                        // ÈÅ∏Êäû‰∏≠: „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„ÉÉ„Ç∏„Å®Âêå„ÅòËâ≤
                        button.className = `uf-status-filter-btn px-2 py-2 border-2 ${colors.border} ${colors.bg} ${colors.text} rounded-lg transition-all text-xs font-medium shadow-md`;
                    } else {
                        // Êú™ÈÅ∏Êäû: ÁôΩ
                        button.className = 'uf-status-filter-btn px-2 py-2 border-2 border-gray-200 bg-white text-gray-600 rounded-lg hover:border-gray-400 transition-all text-xs font-medium';
                    }
                }
            });
        }

        // ÈÅ∏Êäû‰∏≠„Çπ„ÉÜ„Éº„Çø„ÇπÊï∞„ÅÆÊõ¥Êñ∞
        function ufUpdateSelectedStatusCount() {
            const countEl = document.getElementById('ufSelectedStatusCount');
            if (countEl) {
                if (ufSelectedStatuses.length === 0) {
                    countEl.textContent = '„Åô„Åπ„Å¶';
                    countEl.className = 'ml-auto text-xs px-2 py-0.5 bg-gray-100 text-gray-600 rounded-full font-medium';
                } else {
                    countEl.textContent = `${ufSelectedStatuses.length}‰ª∂ÈÅ∏Êäû`;
                    countEl.className = 'ml-auto text-xs px-2 py-0.5 bg-blue-100 text-blue-600 rounded-full font-medium';
                }
            }
        }

        // „Ç¢„ÉùÂâç„Éó„É™„Çª„ÉÉ„ÉàÔºàÊñ∞ÁùÄ„ÄÅÊú™„Ç¢„ÉùÔºâ
        // ÁèæÂú®ÈÅ∏Êäû‰∏≠„ÅÆ„Éó„É™„Çª„ÉÉ„ÉàÔºà'before'/'after'/nullÔºâ
        let ufCurrentPreset = null;
        // ÁèæÂú®ÈÅ∏Êäû‰∏≠„ÅÆÊúüÈñìÔºà'all'/'thismonth'/'lastmonth'Ôºâ
        let ufCurrentPeriod = 'all';

        // „Ç¢„ÉùÂâç„Éó„É™„Çª„ÉÉ„Éà
        function ufSelectCallTargetStatuses() {
            ufCurrentPreset = 'before';
            ufSelectedStatuses = ['Êñ∞ÁùÄ', 'Êú™„Ç¢„Éù'];
            ufShowDetailStatuses();
            ufUpdatePresetButtonStates();
            ufUpdateStatusButtonStates();
            ufUpdateSelectedStatusCount();
        }

        // „Ç¢„ÉùÂæå„Éó„É™„Çª„ÉÉ„ÉàÔºà„Ç¢„ÉùÊ∏à„ÄÅÁèæË™øÊ∏à„ÄÅË¶ãÁ©çÊèêÂá∫Ê∏à„ÄÅÂÖ•Èáë‰∫àÂÆöÔºâ
        function ufSelectInProgressStatuses() {
            ufCurrentPreset = 'after';
            ufSelectedStatuses = ['„Ç¢„ÉùÊ∏à', 'ÁèæË™øÊ∏à', 'Ë¶ãÁ©çÊèêÂá∫Ê∏à', 'ÂÖ•Èáë‰∫àÂÆö'];
            ufShowDetailStatuses();
            ufUpdatePresetButtonStates();
            ufUpdateStatusButtonStates();
            ufUpdateSelectedStatusCount();
        }

        // ÂÄãÂà•„Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫
        function ufShowDetailStatuses() {
            const detail = document.getElementById('uf-detail-statuses');
            if (detail) {
                detail.classList.remove('hidden');
            }
        }

        // „Éó„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
        function ufUpdatePresetButtonStates() {
            const beforeBtn = document.getElementById('uf-preset-before');
            const afterBtn = document.getElementById('uf-preset-after');

            if (beforeBtn) {
                if (ufCurrentPreset === 'before') {
                    beforeBtn.className = 'flex-1 px-4 py-4 bg-blue-100 text-blue-700 border-2 border-blue-300 rounded-xl transition-all font-bold text-base shadow-md';
                } else {
                    beforeBtn.className = 'flex-1 px-4 py-4 bg-white text-gray-600 border-2 border-gray-300 rounded-xl hover:border-blue-400 transition-all font-bold text-base';
                }
            }
            if (afterBtn) {
                if (ufCurrentPreset === 'after') {
                    afterBtn.className = 'flex-1 px-4 py-4 bg-orange-100 text-orange-700 border-2 border-orange-300 rounded-xl transition-all font-bold text-base shadow-md';
                } else {
                    afterBtn.className = 'flex-1 px-4 py-4 bg-white text-gray-600 border-2 border-gray-300 rounded-xl hover:border-orange-400 transition-all font-bold text-base';
                }
            }
        }

        // ÊúüÈñì„Éï„Ç£„É´„Çø„ÉºË®≠ÂÆö
        function ufSetPeriodFilter(period) {
            ufCurrentPeriod = period;
            const now = new Date();

            if (period === 'all') {
                ufSelectedMonth = null;
                ufDateFrom = null;
                ufDateTo = null;
                document.getElementById('ufModalDateFrom').value = '';
                document.getElementById('ufModalDateTo').value = '';
                document.getElementById('uf-custom-date-range').classList.add('hidden');
            } else if (period === 'thismonth') {
                const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
                const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                ufSelectedMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
                ufDateFrom = formatDateForInput(firstDay);
                ufDateTo = formatDateForInput(lastDay);
                document.getElementById('ufModalDateFrom').value = ufDateFrom;
                document.getElementById('ufModalDateTo').value = ufDateTo;
                document.getElementById('uf-custom-date-range').classList.remove('hidden');
            } else if (period === 'lastmonth') {
                const firstDay = new Date(now.getFullYear(), now.getMonth() - 1, 1);
                const lastDay = new Date(now.getFullYear(), now.getMonth(), 0);
                ufSelectedMonth = `${firstDay.getFullYear()}-${String(firstDay.getMonth() + 1).padStart(2, '0')}`;
                ufDateFrom = formatDateForInput(firstDay);
                ufDateTo = formatDateForInput(lastDay);
                document.getElementById('ufModalDateFrom').value = ufDateFrom;
                document.getElementById('ufModalDateTo').value = ufDateTo;
                document.getElementById('uf-custom-date-range').classList.remove('hidden');
            }

            ufUpdatePeriodButtonStates();
            ufUpdateDateLabel();
        }

        // Êó•‰ªò„Éï„Ç©„Éº„Éû„ÉÉ„ÉàÔºàYYYY-MM-DDÔºâ
        function formatDateForInput(date) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }

        // ÊúüÈñì„Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
        function ufUpdatePeriodButtonStates() {
            const allBtn = document.getElementById('uf-period-all');
            const thisMonthBtn = document.getElementById('uf-period-thismonth');
            const lastMonthBtn = document.getElementById('uf-period-lastmonth');

            const baseClass = 'flex-1 px-3 py-3 border-2 rounded-xl transition-all font-bold text-sm';
            const activeClass = 'bg-yellow-100 text-yellow-700 border-yellow-300 shadow-md';
            const inactiveClass = 'bg-white text-gray-600 border-gray-300 hover:border-yellow-400';

            if (allBtn) allBtn.className = `${baseClass} ${ufCurrentPeriod === 'all' ? activeClass : inactiveClass}`;
            if (thisMonthBtn) thisMonthBtn.className = `${baseClass} ${ufCurrentPeriod === 'thismonth' ? activeClass : inactiveClass}`;
            if (lastMonthBtn) lastMonthBtn.className = `${baseClass} ${ufCurrentPeriod === 'lastmonth' ? activeClass : inactiveClass}`;
        }

        // Êó•‰ªò„É©„Éô„É´„ÅÆÊõ¥Êñ∞
        function ufUpdateDateLabel() {
            const labelEl = document.getElementById('ufDateFilterLabel');
            if (!labelEl) return;

            if (ufCurrentPeriod === 'thismonth') {
                labelEl.textContent = '‰ªäÊúà';
                labelEl.className = 'ml-auto text-xs px-2 py-0.5 bg-amber-100 text-amber-600 rounded-full font-medium';
            } else if (ufCurrentPeriod === 'lastmonth') {
                labelEl.textContent = 'ÂÖàÊúà';
                labelEl.className = 'ml-auto text-xs px-2 py-0.5 bg-amber-100 text-amber-600 rounded-full font-medium';
            } else {
                labelEl.textContent = '„Åô„Åπ„Å¶';
                labelEl.className = 'ml-auto text-xs px-2 py-0.5 bg-gray-100 text-gray-600 rounded-full font-medium';
            }
        }

        // „Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„ÉÜ„Ç≠„Çπ„ÉàÊõ¥Êñ∞
        function ufUpdateFilterStatusText() {
            const parts = [];

            if (ufSelectedStatuses.length > 0) {
                parts.push(`„Çπ„ÉÜ„Éº„Çø„Çπ${ufSelectedStatuses.length}‰ª∂`);
            }
            if (ufCurrentPeriod === 'thismonth') {
                parts.push('‰ªäÊúà');
            } else if (ufCurrentPeriod === 'lastmonth') {
                parts.push('ÂÖàÊúà');
            }

            const statusEl = document.getElementById('unifiedFilterStatus');
            if (statusEl) {
                statusEl.textContent = parts.length > 0 ? parts.join(' / ') : '„Åô„Åπ„Å¶Ë°®Á§∫‰∏≠';
            }

            ufUpdateDateLabel();
        }

        // „ÇØ„É™„Ç¢
        function clearUnifiedFilter() {
            ufSelectedStatuses = [];
            ufSelectedMonth = null;
            ufDateFrom = null;
            ufDateTo = null;
            ufCurrentPreset = null;
            ufCurrentPeriod = 'all';
            initUnifiedFilterModal();
        }

        // ÈÅ©Áî®
        function applyUnifiedFilter() {
            // Êó•‰ªòÂÖ•Âäõ„ÇíÂèñÂæó
            const dateFromEl = document.getElementById('ufModalDateFrom');
            const dateToEl = document.getElementById('ufModalDateTo');
            if (dateFromEl && dateFromEl.value) {
                ufDateFrom = dateFromEl.value;
                ufSelectedMonth = null;  // Êó•‰ªòÊåáÂÆö„Åå„ÅÇ„Çå„Å∞ÊúàÈÅ∏Êäû„ÅØ„ÇØ„É™„Ç¢
            }
            if (dateToEl && dateToEl.value) {
                ufDateTo = dateToEl.value;
                ufSelectedMonth = null;
            }

            closeUnifiedFilterModal();

            // Áµû„ÇäËæº„Åø„ÅåÊúâÂäπ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            const hasFilter = ufSelectedStatuses.length > 0 || ufCurrentPeriod !== 'all';

            if (hasFilter) {
                // Áµû„ÇäËæº„Åø„É¢„Éº„Éâ„Å´Âàá„ÇäÊõø„ÅàÔºà„ÇØ„Ç§„ÉÉ„ÇØ„Éï„Ç£„É´„Çø„Éº„ÅØÈùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´Ôºâ
                currentFilter = 'unified';
                updateFilterButtonStyles('unified');

                // „Éï„Ç£„É´„Çø„Éº„Éú„Çø„É≥„ÅÆ„É©„Éô„É´Êõ¥Êñ∞
                const label = document.getElementById('unifiedFilterLabel');
                if (label) {
                    const parts = [];
                    if (ufSelectedStatuses.length > 0) {
                        parts.push(`${ufSelectedStatuses.length}‰ª∂`);
                    }
                    if (ufCurrentPeriod === 'thismonth') {
                        parts.push('‰ªäÊúà');
                    } else if (ufCurrentPeriod === 'lastmonth') {
                        parts.push('ÂÖàÊúà');
                    }
                    label.textContent = parts.length > 0 ? parts.join('„Éª') : 'Áµû„ÇäËæº„Åø';
                }
            } else {
                // Áµû„ÇäËæº„Åø„Å™„Åó ‚Üí ÂÖ®Ê°à‰ª∂„Å´Êàª„Åô
                currentFilter = 'all';
                updateFilterButtonStyles('all');
            }

            // ÂÖÉ„ÅÆ„Éï„Ç£„É´„Çø„Éº„Å´„ÇÇÂèçÊò†ÔºàÂæåÊñπ‰∫íÊèõÔºâ
            selectedStatuses = [...ufSelectedStatuses];
            if (ufSelectedMonth) {
                const [y, m] = ufSelectedMonth.split('-');
                const startDate = new Date(parseInt(y), parseInt(m) - 1, 1);
                const endDate = new Date(parseInt(y), parseInt(m), 0);
                dateFilterFrom = startDate.toISOString().split('T')[0];
                dateFilterTo = endDate.toISOString().split('T')[0];
            } else {
                dateFilterFrom = ufDateFrom;
                dateFilterTo = ufDateTo;
            }

            renderCases();
        }

        // Áµ±Âêà„Éï„Ç£„É´„Çø„Éº„Å´ÂêàËá¥„Åô„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
        function matchesUnifiedFilter(caseItem) {
            // „Çπ„ÉÜ„Éº„Çø„Çπ„Éï„Ç£„É´„Çø„ÉºÔºàË§áÊï∞ÈÅ∏ÊäûÔºâ
            if (ufSelectedStatuses.length > 0) {
                const status = caseItem.detailStatus || '';
                if (!ufSelectedStatuses.includes(status)) {
                    return false;
                }
            }

            // Êúà„Éï„Ç£„É´„Çø„Éº
            if (ufSelectedMonth) {
                const deliveryDate = caseItem.deliveryDate || '';
                if (!deliveryDate.startsWith(ufSelectedMonth)) {
                    return false;
                }
            }

            // Êó•‰ªòÁØÑÂõ≤„Éï„Ç£„É´„Çø„Éº
            if (ufDateFrom || ufDateTo) {
                const deliveryDate = caseItem.deliveryDate || '';
                if (ufDateFrom && deliveryDate < ufDateFrom) return false;
                if (ufDateTo && deliveryDate > ufDateTo) return false;
            }

            return true;
        }

        // Áµ±Ë®à„Ç´„Ç¶„É≥„ÉàÊõ¥Êñ∞
        // „Çπ„ÉÜ„Éº„Çø„Çπ‰∏ÄË¶ß:
        // 1. Êñ∞ÁùÄ: ÈÖç‰ø°ÂæåÊú™ÁùÄÊâã
        // 2. Êú™„Ç¢„Éù: ÈõªË©±„Åó„Åü„Åå„Ç¢„ÉùÂèñ„Çå„Åö
        // 3. „Ç¢„ÉùÊ∏à: ÁèæË™øÊó•ÊôÇÁ¢∫ÂÆö
        // 4. ÁèæË™øÊ∏à: ÁèæÂú∞Ë™øÊüªÂÆå‰∫Ü
        // 5. ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´: ÁèæË™øÂâç„Å´È°ßÂÆ¢ÈÉΩÂêà„Åß„Ç≠„É£„É≥„Çª„É´
        // 6. ÁèæË™øÂæåÂ§±Ê≥®: ÁèæË™øÂæåÊñ≠„Çâ„Çå„Åü
        // 7. Ë¶ãÁ©çÊèêÂá∫Ê∏à: Ë¶ãÁ©çÊõ∏„ÇíÈ°ßÂÆ¢„Å´ÊèêÂá∫
        // 8. ÊàêÁ¥Ñ: Ëá™Á§æ„ÅßÂ•ëÁ¥ÑÁ∑†Áµê
        // 9. ‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à: ‰ªñ„ÅÆ‰∏ÄËà¨Ê•≠ËÄÖ„ÅßÂ•ëÁ¥Ñ
        // 10. Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à: ‰ªñ„ÅÆÂä†ÁõüÂ∫ó„ÅßÂ•ëÁ¥Ñ
        // 11. ÂÖ•Èáë‰∫àÂÆö: Â•ëÁ¥ÑÈáë„ÅÆÂÖ•ÈáëÂæÖ„Å°
        // 12. ÂÖ•ÈáëÊ∏à: ÂÖ•ÈáëÁ¢∫Ë™çÂÆå‰∫Ü
        // 13. „ÇØ„É¨„Éº„É†: ÂïèÈ°åÁô∫Áîü„Åæ„Åü„ÅØÂ§±Ê≥®
        function updateQuickFilterStats() {
            let pending = 0;
            let contracted = 0;
            let newCount = 0;

            merchantCasesData.forEach(c => {
                const status = c.detailStatus || '';
                // Êñ∞ÁùÄ„Ç´„Ç¶„É≥„Éà
                if (status === 'Êñ∞ÁùÄ') {
                    newCount++;
                }
                // Ë¶ÅÂØæÂøú: Êñ∞ÁùÄ„ÄÅÊú™„Ç¢„Éù„ÄÅ„Ç¢„ÉùÊ∏à„ÄÅÁèæË™øÊ∏à„ÄÅË¶ãÁ©çÊèêÂá∫Ê∏à„ÄÅÂÖ•Èáë‰∫àÂÆö
                if (['Êñ∞ÁùÄ', 'Êú™„Ç¢„Éù', '„Ç¢„ÉùÊ∏à', 'ÁèæË™øÊ∏à', 'Ë¶ãÁ©çÊèêÂá∫Ê∏à', 'ÂÖ•Èáë‰∫àÂÆö'].includes(status)) {
                    pending++;
                }
                // ÊàêÁ¥ÑÊ∏à: ÊàêÁ¥Ñ„ÄÅÂÖ•ÈáëÊ∏à
                if (['ÊàêÁ¥Ñ', 'ÂÖ•ÈáëÊ∏à'].includes(status)) {
                    contracted++;
                }
            });

            const setIfExists = (id, value) => {
                const el = document.getElementById(id);
                if (el) el.textContent = value;
            };

            setIfExists('stat-total', merchantCasesData.length);
            setIfExists('stat-pending', pending);
            setIfExists('stat-contracted', contracted);

            // „Çµ„Ç§„Éâ„É°„Éã„É•„Éº„ÅÆÊ°à‰ª∂ÁÆ°ÁêÜ„Éê„ÉÉ„Ç∏„ÇíÊñ∞ÁùÄÊï∞„ÅßÊõ¥Êñ∞
            const badge = document.getElementById('unassignedBadge');
            if (badge) {
                badge.textContent = newCount;
                badge.style.display = newCount > 0 ? 'block' : 'none';
            }

            // „Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Éô„É´„Ç¢„Ç§„Ç≥„É≥„Éê„ÉÉ„Ç∏„ÇíÊñ∞ÁùÄÊï∞„ÅßÊõ¥Êñ∞
            const notifBadge = document.getElementById('notificationCount');
            if (notifBadge) {
                notifBadge.textContent = newCount;
                if (newCount > 0) {
                    notifBadge.classList.remove('hidden');
                } else {
                    notifBadge.classList.add('hidden');
                }
            }
        }

        // „Éï„Ç£„É´„Çø„ÉºÂá¶ÁêÜÔºàÊóß‰∫íÊèõÔºâ
        function filterCases(filter) {
            currentFilter = filter;

            // Áµû„ÇäËæº„Åø„É¢„Éº„ÉÄ„É´„ÅÆË®≠ÂÆö„Çí„É™„Çª„ÉÉ„Éà
            ufSelectedStatuses = [];
            ufSelectedMonth = null;
            ufDateFrom = null;
            ufDateTo = null;
            ufCurrentPreset = null;
            ufCurrentPeriod = 'all';
            selectedStatuses = [];
            dateFilterFrom = null;
            dateFilterTo = null;

            // „Éú„Çø„É≥„Çπ„Çø„Ç§„É´„ÇíÂç≥ÊôÇÊõ¥Êñ∞
            updateFilterButtonStyles(filter);

            renderCases();
        }

        // „Éï„Ç£„É´„Çø„Éº„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´Êõ¥Êñ∞ÔºàÂÖ±ÈÄöÈñ¢Êï∞Ôºâ
        function updateFilterButtonStyles(activeFilter) {
            const btnAll = document.getElementById('filterBtnAll');
            const btnPending = document.getElementById('filterBtnPending');
            const btnContracted = document.getElementById('filterBtnContracted');
            const btnUnified = document.getElementById('unifiedFilterBtn');
            const btnLabel = document.getElementById('unifiedFilterLabel');

            // ÂÖ®Ê°à‰ª∂„Éú„Çø„É≥
            if (btnAll) {
                if (activeFilter === 'all') {
                    btnAll.className = 'flex flex-col items-center justify-center py-3 px-2 bg-indigo-200 text-indigo-800 border border-indigo-400 rounded-xl shadow-md transition-all cursor-pointer';
                } else {
                    btnAll.className = 'flex flex-col items-center justify-center py-3 px-2 bg-indigo-50 text-indigo-400 border border-indigo-200 rounded-xl shadow-md transition-all cursor-pointer';
                }
            }

            // Ë¶ÅÂØæÂøú„Éú„Çø„É≥
            if (btnPending) {
                if (activeFilter === 'pending') {
                    btnPending.className = 'flex flex-col items-center justify-center py-3 px-2 bg-pink-200 text-pink-800 border border-pink-400 rounded-xl shadow-md transition-all cursor-pointer';
                } else {
                    btnPending.className = 'flex flex-col items-center justify-center py-3 px-2 bg-pink-50 text-pink-400 border border-pink-200 rounded-xl shadow-md transition-all cursor-pointer';
                }
            }

            // ÊàêÁ¥ÑÊ∏à„Éú„Çø„É≥
            if (btnContracted) {
                if (activeFilter === 'contracted') {
                    btnContracted.className = 'flex flex-col items-center justify-center py-3 px-2 bg-green-200 text-green-800 border border-green-400 rounded-xl shadow-md transition-all cursor-pointer';
                } else {
                    btnContracted.className = 'flex flex-col items-center justify-center py-3 px-2 bg-green-50 text-green-500 border border-green-200 rounded-xl shadow-md transition-all cursor-pointer';
                }
            }

            // Áµû„ÇäËæº„Åø„Éú„Çø„É≥
            if (btnUnified) {
                if (activeFilter === 'unified') {
                    btnUnified.classList.remove('bg-purple-50', 'text-purple-600', 'border-purple-200');
                    btnUnified.classList.add('bg-purple-200', 'text-purple-800', 'border-purple-400');
                } else {
                    btnUnified.classList.remove('bg-purple-200', 'text-purple-800', 'border-purple-400');
                    btnUnified.classList.add('bg-purple-50', 'text-purple-600', 'border-purple-200');
                    if (btnLabel) btnLabel.textContent = 'Áµû„ÇäËæº„Åø';
                }
            }
        }

        // „Éï„Ç£„É´„Çø„ÉºÊù°‰ª∂„Å´ÂêàËá¥„Åô„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
        // „Çπ„ÉÜ„Éº„Çø„Çπ‰∏ÄË¶ß:
        // 1. Êñ∞ÁùÄ: ÈÖç‰ø°ÂæåÊú™ÁùÄÊâã
        // 2. Êú™„Ç¢„Éù: ÈõªË©±„Åó„Åü„Åå„Ç¢„ÉùÂèñ„Çå„Åö
        // 3. „Ç¢„ÉùÊ∏à: ÁèæË™øÊó•ÊôÇÁ¢∫ÂÆö
        // 4. ÁèæË™øÊ∏à: ÁèæÂú∞Ë™øÊüªÂÆå‰∫Ü
        // 5. ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´: ÁèæË™øÂâç„Å´È°ßÂÆ¢ÈÉΩÂêà„Åß„Ç≠„É£„É≥„Çª„É´
        // 6. ÁèæË™øÂæåÂ§±Ê≥®: ÁèæË™øÂæåÊñ≠„Çâ„Çå„Åü
        // 7. Ë¶ãÁ©çÊèêÂá∫Ê∏à: Ë¶ãÁ©çÊõ∏„ÇíÈ°ßÂÆ¢„Å´ÊèêÂá∫
        // 8. ÊàêÁ¥Ñ: Ëá™Á§æ„ÅßÂ•ëÁ¥ÑÁ∑†Áµê
        // 9. ‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à: ‰ªñ„ÅÆ‰∏ÄËà¨Ê•≠ËÄÖ„ÅßÂ•ëÁ¥Ñ
        // 10. Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à: ‰ªñ„ÅÆÂä†ÁõüÂ∫ó„ÅßÂ•ëÁ¥Ñ
        // 11. ÂÖ•Èáë‰∫àÂÆö: Â•ëÁ¥ÑÈáë„ÅÆÂÖ•ÈáëÂæÖ„Å°
        // 12. ÂÖ•ÈáëÊ∏à: ÂÖ•ÈáëÁ¢∫Ë™çÂÆå‰∫Ü
        // 13. „ÇØ„É¨„Éº„É†: ÂïèÈ°åÁô∫Áîü„Åæ„Åü„ÅØÂ§±Ê≥®
        function matchesFilter(caseItem) {
            if (currentFilter === 'all') return true;

            // Áµû„ÇäËæº„Åø„É¢„Éº„ÉÄ„É´„Åã„Çâ„ÅÆ„Éï„Ç£„É´„Çø„Éº
            if (currentFilter === 'unified') {
                return matchesUnifiedFilter(caseItem);
            }

            const status = caseItem.detailStatus || '';

            const filterMap = {
                // Ë¶ÅÂØæÂøú: Êñ∞ÁùÄ„ÄÅÊú™„Ç¢„Éù„ÄÅ„Ç¢„ÉùÊ∏à„ÄÅÁèæË™øÊ∏à„ÄÅË¶ãÁ©çÊèêÂá∫Ê∏à„ÄÅÂÖ•Èáë‰∫àÂÆö
                'pending': ['Êñ∞ÁùÄ', 'Êú™„Ç¢„Éù', '„Ç¢„ÉùÊ∏à', 'ÁèæË™øÊ∏à', 'Ë¶ãÁ©çÊèêÂá∫Ê∏à', 'ÂÖ•Èáë‰∫àÂÆö'],
                // ÊàêÁ¥ÑÊ∏à: ÊàêÁ¥Ñ„ÄÅÂÖ•ÈáëÊ∏à
                'contracted': ['ÊàêÁ¥Ñ', 'ÂÖ•ÈáëÊ∏à'],
                // „Ç≠„É£„É≥„Çª„É´„ÉªÂ§±Ê≥®Á≥ª
                'cancelled': ['ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´', 'ÁèæË™øÂæåÂ§±Ê≥®', '‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à', 'Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à', '„ÇØ„É¨„Éº„É†']
            };

            return filterMap[currentFilter]?.includes(status);
        }

        // =====================================================
        // „ÇΩ„Éº„Éà„É¢„Éº„ÉÄ„É´Èñ¢Êï∞
        // =====================================================
        function openSortModal() {
            document.getElementById('sortModal').classList.remove('hidden');
            updateStatusButtonStates();
            updateSelectedCount();
        }

        function closeSortModal() {
            document.getElementById('sortModal').classList.add('hidden');
        }

        function toggleStatusFilter(status) {
            const index = selectedStatuses.indexOf(status);
            if (index > -1) {
                selectedStatuses.splice(index, 1);
            } else {
                selectedStatuses.push(status);
            }
            updateStatusButtonStates();
            updateSelectedCount();
        }

        function updateStatusButtonStates() {
            const buttons = document.querySelectorAll('#sortModal .status-filter-btn');
            buttons.forEach(button => {
                const onclick = button.getAttribute('onclick');
                const match = onclick.match(/toggleStatusFilter\('([^']+)'\)/);
                if (match) {
                    const status = match[1];
                    const originalText = button.dataset.originalText || button.textContent.replace('‚úì ', '');
                    button.dataset.originalText = originalText;

                    if (selectedStatuses.includes(status)) {
                        button.style.opacity = '1';
                        button.style.transform = 'scale(0.95)';
                        button.style.boxShadow = '0 0 0 3px rgba(59, 130, 246, 0.5)';
                        button.textContent = '‚úì ' + originalText;
                    } else {
                        button.style.opacity = '0.6';
                        button.style.transform = 'scale(1)';
                        button.style.boxShadow = '';
                        button.textContent = originalText;
                    }
                }
            });
        }

        function updateSelectedCount() {
            const countElement = document.getElementById('selectedStatusCount');
            if (countElement) {
                if (selectedStatuses.length === 0) {
                    countElement.textContent = '„Åô„Åπ„Å¶Ë°®Á§∫‰∏≠';
                    countElement.className = 'text-sm text-gray-500';
                } else {
                    countElement.textContent = `${selectedStatuses.length}‰ª∂ÈÅ∏Êäû‰∏≠`;
                    countElement.className = 'text-sm text-blue-600 font-semibold';
                }
            }

            // „Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Éú„Çø„É≥„É©„Éô„É´Êõ¥Êñ∞
            const filterLabel = document.getElementById('statusFilterLabel');
            const filterBtn = document.getElementById('statusFilterBtn');
            if (filterLabel && filterBtn) {
                if (selectedStatuses.length === 0) {
                    filterLabel.textContent = '„Çπ„ÉÜ„Éº„Çø„Çπ';
                    // ÈùûÈÅ∏ÊäûÊôÇ: ËñÑ„ÅÑËâ≤
                    filterBtn.classList.remove('bg-purple-500', 'text-white', 'ring-2', 'ring-white', 'ring-offset-2', 'ring-offset-purple-500', 'shadow-lg', 'border-transparent');
                    filterBtn.classList.add('bg-purple-50', 'text-purple-500', 'border', 'border-purple-200', 'shadow-md');
                } else {
                    const arraysEqual = (a, b) => a.length === b.length && a.every(v => b.includes(v)) && b.every(v => a.includes(v));
                    const CALL_TARGET = ['Êú™ÂØæÂøú', 'Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù'];
                    const IN_PROGRESS = ['„Ç¢„ÉùÊ∏à', 'ÁèæË™øÊ∏à', 'Ë¶ãÁ©çÊèêÂá∫Ê∏à', 'ÂÖ•Èáë‰∫àÂÆö'];

                    let labelText = `${selectedStatuses.length}‰ª∂`;
                    if (arraysEqual(selectedStatuses, CALL_TARGET)) {
                        labelText = 'Êû∂ÈõªÂØæË±°';
                    } else if (arraysEqual(selectedStatuses, IN_PROGRESS)) {
                        labelText = 'ÈÄ≤Ë°å‰∏≠';
                    }

                    filterLabel.textContent = labelText;
                    // ÈÅ∏ÊäûÊôÇ: ÊøÉ„ÅÑËâ≤+„É™„É≥„Ç∞
                    filterBtn.classList.remove('bg-purple-50', 'text-purple-500', 'border', 'border-purple-200', 'shadow-md');
                    filterBtn.classList.add('bg-purple-500', 'text-white', 'ring-2', 'ring-white', 'ring-offset-2', 'ring-offset-purple-500', 'shadow-lg', 'border-transparent');
                }
            }
        }

        function selectCallTargetStatuses() {
            selectedStatuses = ['Êñ∞ÁùÄ', 'Êú™„Ç¢„Éù'];
            updateStatusButtonStates();
            updateSelectedCount();
        }

        function selectInProgressStatuses() {
            selectedStatuses = ['„Ç¢„ÉùÊ∏à', 'ÁèæË™øÊ∏à', 'Ë¶ãÁ©çÊèêÂá∫Ê∏à', 'ÂÖ•Èáë‰∫àÂÆö'];
            updateStatusButtonStates();
            updateSelectedCount();
        }

        function clearStatusFilter() {
            selectedStatuses = [];
            updateStatusButtonStates();
            updateSelectedCount();
            renderCases();
        }

        function applyStatusFilter() {
            closeSortModal();
            renderCases();
        }

        // =====================================================
        // ÈÖç‰ø°Êó•„Éï„Ç£„É´„Çø„É¢„Éº„ÉÄ„É´Èñ¢Êï∞
        // =====================================================
        let selectedMonth = null; // ÈÅ∏Êäû‰∏≠„ÅÆÊúà (‰æã: '2024-12')

        function openDateFilterModal() {
            document.getElementById('modalDateFrom').value = dateFilterFrom || '';
            document.getElementById('modalDateTo').value = dateFilterTo || '';
            generateMonthButtons();
            document.getElementById('dateFilterModal').classList.remove('hidden');
        }

        function closeDateFilterModal() {
            document.getElementById('dateFilterModal').classList.add('hidden');
        }

        // Áõ¥Ëøë6„É∂Êúà„ÅÆÊúà„Éú„Çø„É≥„ÇíÁîüÊàê
        function generateMonthButtons() {
            const container = document.getElementById('monthButtonsContainer');
            const now = new Date();
            let html = '';

            for (let i = 0; i < 6; i++) {
                const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const year = d.getFullYear();
                const month = d.getMonth() + 1;
                const key = `${year}-${String(month).padStart(2, '0')}`;
                const label = `${month}Êúà`;
                const isSelected = selectedMonth === key;

                html += `<button onclick="selectMonth('${key}')" class="py-3 px-4 rounded-xl border-2 font-bold text-base transition-all ${isSelected ? 'border-indigo-500 bg-indigo-50 text-indigo-700' : 'border-gray-200 bg-white text-gray-700 hover:bg-gray-50'}">${label}</button>`;
            }

            container.innerHTML = html;
        }

        // Êúà„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ
        function selectMonth(key) {
            selectedMonth = key;
            const [year, month] = key.split('-').map(Number);

            // „Åù„ÅÆÊúà„ÅÆÂàùÊó•„Å®Êú´Êó•„ÇíË®≠ÂÆö
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);

            const formatDate = (d) => `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;

            document.getElementById('modalDateFrom').value = formatDate(firstDay);
            document.getElementById('modalDateTo').value = formatDate(lastDay);

            generateMonthButtons(); // ÈÅ∏ÊäûÁä∂ÊÖã„ÇíÊõ¥Êñ∞
        }

        function clearDateFilter() {
            selectedMonth = null;
            dateFilterFrom = null;
            dateFilterTo = null;
            document.getElementById('modalDateFrom').value = '';
            document.getElementById('modalDateTo').value = '';
            generateMonthButtons();
            updateDateFilterLabel();
            closeDateFilterModal();
            renderCases();
        }

        function applyDateFilter() {
            dateFilterFrom = document.getElementById('modalDateFrom').value || null;
            dateFilterTo = document.getElementById('modalDateTo').value || null;

            updateDateFilterLabel();
            closeDateFilterModal();
            renderCases();
        }

        function updateDateFilterLabel() {
            const label = document.getElementById('dateFilterLabel');
            const btn = document.getElementById('dateFilterBtn');
            let displayText = '';

            // Êúà„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Çå„Å∞ÊúàË°®Á§∫
            if (selectedMonth && dateFilterFrom && dateFilterTo) {
                const month = parseInt(selectedMonth.split('-')[1]);
                displayText = `${month}Êúà`;
            } else if (dateFilterFrom && dateFilterTo) {
                if (dateFilterFrom === dateFilterTo) {
                    displayText = dateFilterFrom.slice(5).replace('-', '/');
                } else {
                    displayText = `${dateFilterFrom.slice(5).replace('-', '/')}„Äú${dateFilterTo.slice(5).replace('-', '/')}`;
                }
            } else if (dateFilterFrom) {
                displayText = `${dateFilterFrom.slice(5).replace('-', '/')}„Äú`;
            } else if (dateFilterTo) {
                displayText = `„Äú${dateFilterTo.slice(5).replace('-', '/')}`;
            }

            if (displayText) {
                label.textContent = displayText;
                if (btn) {
                    // ÈÅ∏ÊäûÊôÇ: ÊøÉ„ÅÑËâ≤+„É™„É≥„Ç∞
                    btn.classList.remove('bg-amber-50', 'text-amber-500', 'border', 'border-amber-200', 'shadow-md');
                    btn.classList.add('bg-amber-500', 'text-white', 'ring-2', 'ring-white', 'ring-offset-2', 'ring-offset-amber-500', 'shadow-lg', 'border-transparent');
                }
            } else {
                label.textContent = 'ÈÖç‰ø°Êó•';
                if (btn) {
                    // ÈùûÈÅ∏ÊäûÊôÇ: ËñÑ„ÅÑËâ≤
                    btn.classList.remove('bg-amber-500', 'text-white', 'ring-2', 'ring-white', 'ring-offset-2', 'ring-offset-amber-500', 'shadow-lg', 'border-transparent');
                    btn.classList.add('bg-amber-50', 'text-amber-500', 'border', 'border-amber-200', 'shadow-md');
                }
            }
        }

        // =====================================================
        // ‰∏¶„Å≥È†Ü„É¢„Éº„ÉÄ„É´Èñ¢Êï∞
        // =====================================================
        function openSortOrderModal() {
            updateSortOrderButtons();
            document.getElementById('sortOrderModal').classList.remove('hidden');
        }

        function closeSortOrderModal() {
            document.getElementById('sortOrderModal').classList.add('hidden');
        }

        function selectSortOrder(value) {
            currentSortOrder = value;

            const labels = {
                'date-desc': 'Êñ∞ÁùÄÈ†Ü',
                'nextcall-asc': 'Ê¨°ÂõûÊû∂ÈõªÈ†Ü',
                'status': '„Çπ„ÉÜ„Éº„Çø„ÇπÈ†Ü'
            };
            document.getElementById('sortOrderLabel').textContent = labels[value] || 'Êñ∞ÁùÄÈ†Ü';

            closeSortOrderModal();
            renderCases();
        }

        // „Éó„É´„ÉÄ„Ç¶„É≥„Åã„ÇâÁõ¥Êé•‰∏¶„Å≥È†ÜÂ§âÊõ¥
        function selectSortOrderDirect(value) {
            currentSortOrder = value;
            renderCases();
        }

        function updateSortOrderButtons() {
            document.querySelectorAll('.sort-order-btn').forEach(btn => {
                const val = btn.dataset.value;
                if (val === currentSortOrder) {
                    btn.className = 'sort-order-btn py-3 px-4 rounded-xl border-2 border-amber-500 bg-amber-50 text-gray-900 font-bold text-sm text-center';
                } else {
                    btn.className = 'sort-order-btn py-3 px-4 rounded-xl border-2 border-gray-200 bg-white text-gray-900 font-bold text-sm text-center hover:bg-gray-50 transition-all';
                }
            });
        }

        // Ê§úÁ¥¢Âá¶ÁêÜ
        function searchCases() {
            renderCases();
        }

        // Ê°à‰ª∂„Ç´„Éº„Éâ„ÇíÊèèÁîª
        function renderCases() {
            const searchTerm = (document.getElementById('caseSearchInput')?.value || '').toLowerCase();
            const cardView = document.getElementById('caseCardView');
            const listBody = document.getElementById('caseListBody');

            // „Éï„Ç£„É´„Çø„ÉºÔºÜÊ§úÁ¥¢ÈÅ©Áî®
            let filteredCases = merchantCasesData.filter(c => {
                // Áµ±Âêà„Éï„Ç£„É´„Çø„ÉºÔºàÊñ∞UIÔºâ
                if (!matchesUnifiedFilter(c)) return false;

                // Êóß„Éï„Ç£„É´„Çø„ÉºÔºàÂæåÊñπ‰∫íÊèõÁî®Ôºâ
                if (!matchesFilter(c)) return false;

                // „Çπ„ÉÜ„Éº„Çø„Çπ„Éï„Ç£„É´„Çø„ÉºÔºà„ÇΩ„Éº„Éà„É¢„Éº„ÉÄ„É´„ÅßÈÅ∏ÊäûÔºâ- ÊóßUIÁî®
                if (selectedStatuses.length > 0) {
                    const status = c.detailStatus || '';
                    if (!selectedStatuses.includes(status)) return false;
                }

                // Êó•‰ªò„Éï„Ç£„É´„Çø„Éº - ÊóßUIÁî®
                if (dateFilterType !== 'none' && dateFilterFrom && dateFilterTo) {
                    let dateStr = dateFilterType === 'call' ? c.nextCallDate : c.deliveredAt;
                    if (!dateStr) return false;
                    const dateOnly = dateStr.split(' ')[0];
                    if (dateOnly < dateFilterFrom || dateOnly > dateFilterTo) return false;
                }

                // Ê§úÁ¥¢„Éï„Ç£„É´„Çø„Éº
                if (searchTerm) {
                    const searchFields = [c.customerName, c.fullAddress, c.city, c.customerTel, c.cvId].join(' ').toLowerCase();
                    if (!searchFields.includes(searchTerm)) return false;
                }
                return true;
            });

            // „ÇΩ„Éº„ÉàÈ†Ü„ÇíÈÅ©Áî®
            const STATUS_ORDER = ['Êú™ÂØæÂøú', 'Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù', '„Ç¢„ÉùÊ∏à', 'ÁèæË™øÊ∏à', 'Ë¶ãÁ©çÊèêÂá∫Ê∏à', 'ÂÖ•Èáë‰∫àÂÆö', 'ÊàêÁ¥Ñ', 'ÂÖ•ÈáëÊ∏à', 'ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´', 'ÁèæË™øÂæåÂ§±Ê≥®', '‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à', 'Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à', '„ÇØ„É¨„Éº„É†'];
            filteredCases.sort((a, b) => {
                switch (currentSortOrder) {
                    case 'date-desc':
                        return new Date(b.deliveredAt || 0) - new Date(a.deliveredAt || 0);
                    case 'nextcall-asc':
                        const dateA = a.nextCallDate || '9999-12-31';
                        const dateB = b.nextCallDate || '9999-12-31';
                        return dateA.localeCompare(dateB);
                    case 'status':
                        const indexA = STATUS_ORDER.indexOf(a.detailStatus || '');
                        const indexB = STATUS_ORDER.indexOf(b.detailStatus || '');
                        return (indexA === -1 ? 999 : indexA) - (indexB === -1 ? 999 : indexB);
                    default:
                        return 0;
                }
            });

            // ‰ª∂Êï∞Ë°®Á§∫„ÇíÊõ¥Êñ∞
            const displayCountEl = document.getElementById('displayCount');
            if (displayCountEl) {
                displayCountEl.textContent = filteredCases.length;
            }

            // „Ç´„Éº„Éâ„Éì„É•„ÉºÊèèÁîªÔºà„É≠„Éº„Éá„Ç£„É≥„Ç∞Ë¶ÅÁ¥†„ÇíÈô§„ÅÑ„Å¶„ÇØ„É™„Ç¢Ôºâ
            const loadingEl = document.getElementById('casesLoading');
            if (loadingEl) loadingEl.classList.add('hidden');

            // Êó¢Â≠ò„ÅÆ„Ç´„Éº„Éâ„ÅÆ„Åø„ÇíÂâäÈô§Ôºà„É≠„Éº„Éá„Ç£„É≥„Ç∞Ë¶ÅÁ¥†„ÅØ‰øùÊåÅÔºâ
            Array.from(cardView.children).forEach(child => {
                if (child.id !== 'casesLoading') {
                    cardView.removeChild(child);
                }
            });

            if (filteredCases.length === 0) {
                cardView.innerHTML += `
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <p>Ë©≤ÂΩì„Åô„ÇãÊ°à‰ª∂„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                    </div>
                `;
            } else {
                filteredCases.forEach(c => {
                    cardView.innerHTML += createCaseCard(c);
                });
            }

            // „É™„Çπ„Éà„Éì„É•„ÉºÊèèÁîª
            if (listBody) {
                listBody.innerHTML = filteredCases.map(c => createCaseRow(c)).join('');
            }
        }

        // Ê°à‰ª∂„ÅÆ„É©„Éô„É´„ÇíÂèñÂæó„Åó„Å¶HTMLÁîüÊàê
        function getCaseLabelsHtml(c) {
            // callHistory„Åã„Çâ„É©„Éô„É´‰ªò„Åç„Ç¢„Ç§„ÉÜ„É†„ÇíÊäΩÂá∫
            const history = c.callHistory || [];
            const labelsMap = {};
            history.forEach(item => {
                if (item.label && item.labelColor) {
                    labelsMap[item.label] = item.labelColor;
                }
            });
            const labels = Object.entries(labelsMap);
            if (labels.length === 0) return '';

            const labelColorMap = {
                red: { bg: 'bg-red-100', text: 'text-red-700', dot: 'bg-red-500' },
                yellow: { bg: 'bg-yellow-100', text: 'text-yellow-700', dot: 'bg-yellow-500' },
                blue: { bg: 'bg-blue-100', text: 'text-blue-700', dot: 'bg-blue-500' },
                purple: { bg: 'bg-purple-100', text: 'text-purple-700', dot: 'bg-purple-500' },
                green: { bg: 'bg-green-100', text: 'text-green-700', dot: 'bg-green-500' },
                gray: { bg: 'bg-gray-100', text: 'text-gray-700', dot: 'bg-gray-500' }
            };

            return `
                <div class="flex flex-wrap gap-1 mb-3">
                    ${labels.map(([text, color]) => {
                        const style = labelColorMap[color] || labelColorMap.gray;
                        return `<span class="text-xs px-2 py-0.5 rounded-full ${style.bg} ${style.text} font-medium flex items-center gap-1"><span class="w-2 h-2 rounded-full ${style.dot}"></span>${escapeHtml(text)}</span>`;
                    }).join('')}
                </div>
            `;
        }

        // „É™„Çπ„ÉàÁî®„Ç≥„É≥„Éë„ÇØ„Éà„É©„Éô„É´Ë°®Á§∫
        function getCaseLabelsHtmlCompact(c) {
            const history = c.callHistory || [];
            const labelsMap = {};
            history.forEach(item => {
                if (item.label && item.labelColor) {
                    labelsMap[item.label] = item.labelColor;
                }
            });
            const labels = Object.entries(labelsMap);
            if (labels.length === 0) return '';

            const labelColorMap = {
                red: { bg: 'bg-red-100', text: 'text-red-700', dot: 'bg-red-500' },
                yellow: { bg: 'bg-yellow-100', text: 'text-yellow-700', dot: 'bg-yellow-500' },
                blue: { bg: 'bg-blue-100', text: 'text-blue-700', dot: 'bg-blue-500' },
                purple: { bg: 'bg-purple-100', text: 'text-purple-700', dot: 'bg-purple-500' },
                green: { bg: 'bg-green-100', text: 'text-green-700', dot: 'bg-green-500' },
                gray: { bg: 'bg-gray-100', text: 'text-gray-700', dot: 'bg-gray-500' }
            };

            return `
                <div class="flex flex-wrap gap-1 mt-1">
                    ${labels.map(([text, color]) => {
                        const style = labelColorMap[color] || labelColorMap.gray;
                        return `<span class="text-[10px] px-1.5 py-0.5 rounded ${style.bg} ${style.text} font-medium">${escapeHtml(text)}</span>`;
                    }).join('')}
                </div>
            `;
        }

        // Ê°à‰ª∂„Ç´„Éº„ÉâHTMLÁîüÊàêÔºàV2022 ÂÖ®ÊÉÖÂ†±ÂØæÂøú + Êû∂ÈõªÂõûÊï∞Ë°®Á§∫Ôºâ
        function createCaseCard(c) {
            const status = c.detailStatus || 'ÂØæÂøúÂæÖ„Å°';
            const style = statusStyles[status] || statusStyles[''];
            const hasMemo = c.merchantMemo && c.merchantMemo.trim();
            const assignee = c.assignee || '';

            // Áâ©‰ª∂ÊÉÖÂ†±„ÅÆÁ∞°ÊòìË°®Á§∫Ôºàfloors„Å´„ÅØ„Åù„ÅÆ„Åæ„Åæ„Äå2ÈöéÂª∫„Å¶„ÄçÁ≠â„ÅåÂÖ•„Å£„Å¶„ÅÑ„ÇãÔºâ
            const propertyInfo = [c.propertyType, c.floors].filter(v => v).join(' / ');

            // Ê¨°ÂõûÊû∂ÈõªÊó•„ÅÆÁü≠Á∏ÆË°®Á§∫ÔºàÊôÇÂàªËæº„ÅøÔºâ
            let nextCallShort = '';
            if (c.nextCallDate) {
                const dateMatch = c.nextCallDate.match(/(\d+)[-\/](\d+)[-\/](\d+)/);
                const timeMatch = c.nextCallDate.match(/(\d+):(\d+)/);
                if (dateMatch) {
                    nextCallShort = `${dateMatch[2]}/${dateMatch[3]}`;
                    if (timeMatch) nextCallShort += ` ${timeMatch[1]}:${timeMatch[2]}`;
                }
            }

            const fullAddress = c.fullAddress || c.city || '-';
            const shortAddress = fullAddress.replace(/^(Êù±‰∫¨ÈÉΩ|ÂåóÊµ∑ÈÅì|.{2,3}[ÈÉΩÈÅìÂ∫úÁúå])/, '');
            const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(fullAddress)}`;

            // ÈÖç‰ø°Êó•„ÇíÁü≠Á∏ÆË°®Á§∫ÔºàMM/DDÔºâ
            let deliveryShort = '-';
            if (c.deliveredAt) {
                const match = c.deliveredAt.match(/(\d+)\/(\d+)\/(\d+)/);
                if (match) deliveryShort = `${match[2]}/${match[3]}`;
            }

            // ÁèæË™øÊó•„ÇíÁü≠Á∏ÆË°®Á§∫ÔºàMM/DD HH:mmÔºâ
            let surveyShort = '';
            if (c.surveyDate) {
                const dateMatch = c.surveyDate.match(/(\d+)[-\/](\d+)[-\/](\d+)/);
                const timeMatch = c.surveyDate.match(/(\d+):(\d+)/);
                if (dateMatch) {
                    surveyShort = `${dateMatch[2]}/${dateMatch[3]}`;
                    if (timeMatch) surveyShort += ` ${timeMatch[1]}:${timeMatch[2]}`;
                }
            }

            return `
                <div class="bg-white rounded-xl shadow-lg border-2 border-gray-200 p-5 hover:shadow-xl transition-shadow" data-cv-id="${c.cvId}">
                    <div class="flex justify-between items-center mb-4">
                        <span class="px-3 py-1.5 text-sm font-bold rounded-full ${style.bg} ${style.text}">${status}</span>
                        ${assignee && assignee !== '-'
                            ? `<span class="text-base text-gray-700 font-medium">${escapeHtml(assignee)}</span>`
                            : `<button onclick="event.stopPropagation(); openAssignModal('${c.cvId}')" class="px-3 py-1.5 text-sm font-bold text-purple-600 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors">Ê°à‰ª∂ÊåØ„ÇäÂàÜ„Åë</button>`
                        }
                    </div>
                    <h3 class="font-bold text-xl mb-2">${escapeHtml(c.customerName || '-')}</h3>
                    <a href="${mapUrl}" target="_blank" class="text-base text-blue-600 hover:text-blue-800 hover:underline block mb-2" title="${escapeHtml(fullAddress)}">üìç${escapeHtml(shortAddress)}</a>
                    ${propertyInfo ? `<p class="text-sm text-gray-500 mb-3">${escapeHtml(propertyInfo)}</p>` : ''}
                    <!-- üìûüìã + Êó•Á®ãË°®Á§∫ -->
                    <div class="flex items-center gap-3 mb-3">
                        <button onclick="openConnectionModalDirect('${c.cvId}')" class="text-lg text-blue-600 hover:text-blue-800 font-medium" title="Êû∂ÈõªÂ±•Ê≠¥„ÇíËøΩÂä†">
                            ${getCallCountBadge(c)}
                        </button>
                        <button onclick="openMemoModal('${c.cvId}')" class="text-lg text-amber-600 hover:text-amber-800 font-medium" title="„É°„É¢„ÉªÂ±•Ê≠¥">
                            ${getMemoCountBadge(c)}
                        </button>
                    </div>
                    <!-- Êó•Á®ã„Ç®„É™„Ç¢ÔºàÊ¨°ÂõûÊû∂Èõª„ÉªÁèæË™øÔºâ -->
                    <div class="flex flex-wrap gap-2 mb-3 text-sm">
                        <button onclick="openNextCallModal('${c.cvId}')" class="flex items-center gap-1 px-2 py-1 rounded-lg ${nextCallShort ? 'bg-blue-50 text-blue-700' : 'bg-gray-50 text-gray-500'} hover:bg-blue-100 transition-colors" title="Ê¨°ÂõûÊû∂ÈõªÊó•„ÇíË®≠ÂÆö">
                            <span>üóìÔ∏è</span><span class="font-medium">${nextCallShort ? 'Ê¨°ÂõûÊû∂Èõª' + nextCallShort : 'Êû∂Èõª‰∫àÂÆö'}</span>
                        </button>
                        ${surveyShort ? `<button onclick="openSurveyModal('${c.cvId}')" class="flex items-center gap-1 px-2 py-1 rounded-lg bg-orange-50 text-orange-700 hover:bg-orange-100 transition-colors" title="ÁèæË™øÊó•ÊôÇ„ÇíÂ§âÊõ¥">
                            <span>üè†</span><span class="font-medium">ÁèæË™ø${surveyShort}</span>
                        </button>` : ''}
                    </div>
                    <div class="text-xs text-gray-400 mb-3">
                        <span>ÈÖç‰ø°: ${deliveryShort}</span>
                    </div>
                    ${getCaseLabelsHtml(c)}
                    ${hasMemo ? `<div class="text-sm text-gray-600 bg-gray-50 p-3 rounded-lg mb-4 line-clamp-2">${escapeHtml(c.merchantMemo)}</div>` : ''}
                    <div class="flex gap-2">
                        <a href="tel:${c.customerTel}" onclick="startPhoneCall('${c.cvId}')" class="flex-1 px-4 py-3 bg-green-100 text-green-700 rounded-lg text-base font-bold hover:bg-green-200 transition-colors text-center">
                            üìû ÈõªË©±
                        </a>
                        <button onclick="openDetailModal('${c.cvId}')" class="flex-1 px-4 py-3 bg-blue-100 text-blue-700 rounded-lg text-base font-bold hover:bg-blue-200 transition-colors">
                            Ë©≥Á¥∞
                        </button>
                    </div>
                </div>
            `;
        }

        // ÈÄ≤ÊçóË°®Á§∫„ÇíÊ±∫ÂÆöÔºà„Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„Å¶Ôºâ
        function getProgressDisplayForRow(c, status, surveyDisplay, estimateDisplay) {
            // ÊúÄÊñ∞„ÅÆÈÄ≤Êçó„É°„É¢„ÇíÂèñÂæóÔºàcallHistory„Åã„Çâquick_progress„Çø„Ç§„Éó„ÇíÊé¢„ÅôÔºâ
            let latestProgress = null;
            if (c.callHistory && Array.isArray(c.callHistory)) {
                const progressEntry = c.callHistory.find(h => h.type === 'quick_progress');
                if (progressEntry) {
                    latestProgress = progressEntry.note;
                }
            }

            // „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„Å¶Ë°®Á§∫„ÇíÊ±∫ÂÆö
            if (status === '„Ç¢„ÉùÊ∏à') {
                // ÁèæË™øÊó•ÊôÇ„Åå„ÅÇ„Çå„Å∞Ë°®Á§∫
                if (surveyDisplay !== '-') {
                    return {
                        html: `<button onclick="openSurveyDateModal('${c.cvId}')" class="text-sm text-orange-600 font-medium hover:text-orange-700 hover:bg-orange-50 px-1.5 py-0.5 rounded transition-colors" title="ÁèæË™øÊó•ÊôÇ„ÇíÂ§âÊõ¥">üè†${surveyDisplay}</button>`
                    };
                }
                // ÈÄ≤Êçó„É°„É¢„Åå„ÅÇ„Çå„Å∞Ë°®Á§∫
                if (latestProgress) {
                    return { html: `<span class="text-xs text-orange-600">${latestProgress}</span>` };
                }
                return { html: '<span class="text-gray-300">-</span>' };
            }

            if (status === 'ÁèæË™øÊ∏à') {
                // ÂïÜË´áÊó•ÊôÇ„Åå„ÅÇ„Çå„Å∞Ë°®Á§∫
                if (estimateDisplay !== '-') {
                    return {
                        html: `<button onclick="openEstimateDateModal('${c.cvId}')" class="text-sm text-emerald-600 font-medium hover:text-emerald-700 hover:bg-emerald-50 px-1.5 py-0.5 rounded transition-colors" title="ÂïÜË´áÊó•ÊôÇ„ÇíÂ§âÊõ¥">üìã${estimateDisplay}</button>`
                    };
                }
                // ÈÄ≤Êçó„É°„É¢„Åå„ÅÇ„Çå„Å∞Ë°®Á§∫
                if (latestProgress) {
                    return { html: `<span class="text-xs text-emerald-600">${latestProgress}</span>` };
                }
                return { html: '<span class="text-gray-300">-</span>' };
            }

            if (status === 'Ë¶ãÁ©çÊèêÂá∫Ê∏à') {
                // Ê∏©Â∫¶„Å™„Å©„ÅÆÈÄ≤Êçó„ÇíË°®Á§∫
                if (latestProgress) {
                    // Ê∏©Â∫¶„Å´Âøú„Åò„ÅüËâ≤
                    let colorClass = 'text-gray-600';
                    if (latestProgress.includes('üî•') || latestProgress.includes('Ê∏©Â∫¶È´ò')) colorClass = 'text-red-600';
                    else if (latestProgress.includes('üòê') || latestProgress.includes('Ê∏©Â∫¶‰∏≠')) colorClass = 'text-yellow-600';
                    else if (latestProgress.includes('‚ùÑÔ∏è') || latestProgress.includes('Ê∏©Â∫¶‰Ωé')) colorClass = 'text-blue-600';
                    return { html: `<span class="text-xs font-medium ${colorClass}">${latestProgress}</span>` };
                }
                return { html: '<span class="text-gray-300">-</span>' };
            }

            if (status === 'Êú™„Ç¢„Éù') {
                // ÈÄ≤Êçó„É°„É¢„Åå„ÅÇ„Çå„Å∞Ë°®Á§∫
                if (latestProgress) {
                    return { html: `<span class="text-xs text-gray-600">${latestProgress}</span>` };
                }
                return { html: '<span class="text-gray-300">-</span>' };
            }

            // „Åù„ÅÆ‰ªñ„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ
            return { html: '<span class="text-gray-300">-</span>' };
        }

        // Ê°à‰ª∂„É™„Çπ„ÉàË°åHTMLÁîüÊàêÔºàV2035 ÁúåÂêç„Ç´„ÉÉ„ÉàÔºâ
        function createCaseRow(c) {
            const status = c.detailStatus || 'Êñ∞ÁùÄ';
            const displayStatus = status === 'Êú™ÂØæÂøú' ? 'Êñ∞ÁùÄ' : status;
            const style = statusStyles[status] || statusStyles[''];
            const fullAddress = c.fullAddress || c.city || '-';
            // ÁúåÂêç„Çí„Ç´„ÉÉ„Éà„Åó„Å¶Â∏ÇÂå∫Áî∫Êùë‰ª•Èôç„ÇíË°®Á§∫
            const shortAddress = fullAddress.replace(/^(Êù±‰∫¨ÈÉΩ|ÂåóÊµ∑ÈÅì|.{2,3}[ÈÉΩÈÅìÂ∫úÁúå])/, '');
            const address = escapeHtml(fullAddress);
            const displayAddress = escapeHtml(shortAddress);
            const hasMemo = c.merchantMemo && c.merchantMemo.trim();

            // ÈÖç‰ø°Êó•„ÇíÁü≠Á∏ÆË°®Á§∫ÔºàMM/DDÔºâ
            let shortDate = '-';
            if (c.deliveredAt) {
                const match = c.deliveredAt.match(/(\d+)\/(\d+)/);
                if (match) shortDate = `${match[1]}/${match[2]}`;
            }

            // Ê¨°ÂõûÊû∂ÈõªÊó•„ÇíÁü≠Á∏ÆË°®Á§∫ÔºàMM/DD HH:mmÔºâ
            let nextCallDisplay = '-';
            if (c.nextCallDate) {
                const dateMatch = c.nextCallDate.match(/(\d+)[-\/](\d+)[-\/](\d+)/);
                const timeMatch = c.nextCallDate.match(/(\d+):(\d+)/);
                if (dateMatch) {
                    nextCallDisplay = `${dateMatch[2]}/${dateMatch[3]}`;
                    if (timeMatch) nextCallDisplay += ` ${timeMatch[1]}:${timeMatch[2]}`;
                }
            }

            // ÁèæË™øÊó•„ÇíÁü≠Á∏ÆË°®Á§∫ÔºàMM/DD HH:mmÔºâ
            let surveyDisplay = '-';
            if (c.surveyDate) {
                const dateMatch = c.surveyDate.match(/(\d+)[-\/](\d+)[-\/](\d+)/);
                const timeMatch = c.surveyDate.match(/(\d+):(\d+)/);
                if (dateMatch) {
                    surveyDisplay = `${dateMatch[2]}/${dateMatch[3]}`;
                    if (timeMatch) surveyDisplay += ` ${timeMatch[1]}:${timeMatch[2]}`;
                }
            }

            // ÂïÜË´áÊó•„ÇíÁü≠Á∏ÆË°®Á§∫ÔºàMM/DD HH:mmÔºâ
            let estimateDisplay = '-';
            if (c.estimateDate) {
                const dateMatch = c.estimateDate.match(/(\d+)[-\/](\d+)[-\/](\d+)/);
                const timeMatch = c.estimateDate.match(/(\d+):(\d+)/);
                if (dateMatch) {
                    estimateDisplay = `${dateMatch[2]}/${dateMatch[3]}`;
                    if (timeMatch) estimateDisplay += ` ${timeMatch[1]}:${timeMatch[2]}`;
                }
            }

            // ÈÄ≤ÊçóË°®Á§∫„ÇíÊ±∫ÂÆöÔºà„Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„Å¶Ôºâ
            const progressDisplay = getProgressDisplayForRow(c, status, surveyDisplay, estimateDisplay);

            // ÊãÖÂΩìËÄÖÂêç
            const assignee = c.assignee || '-';

            return `
                <tr data-cv-id="${c.cvId}" class="hover:bg-gray-50 transition-colors">
                    <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÔºà„Çø„ÉÉ„Éó„ÅßÂ§âÊõ¥Ôºâ -->
                    <td class="px-3 py-3">
                        <button onclick="openStatusModal('${c.cvId}')" class="px-2 py-1 text-xs font-semibold rounded-full ${style.bg} ${style.text} ${style.border} border hover:opacity-80 transition-opacity cursor-pointer" title="„ÇØ„É™„ÉÉ„ÇØ„ÅßÂ§âÊõ¥">
                            ${displayStatus}
                        </button>
                    </td>
                    <!-- È°ßÂÆ¢ÊÉÖÂ†±ÔºàÂêçÂâç+‰ΩèÊâÄ‚ÜíGoogle„Éû„ÉÉ„ÉóÔºâ -->
                    <td class="px-3 py-3">
                        <div class="flex flex-col">
                            <span class="font-medium text-gray-900">${escapeHtml(c.customerName || '-')}</span>
                            ${c.googleMapsLink
                                ? `<a href="${c.googleMapsLink}" target="_blank" class="text-xs text-gray-500 hover:text-blue-600 truncate max-w-[180px] transition-colors" title="${address}Ôºà„Çø„ÉÉ„Éó„ÅßÂú∞Âõ≥Ôºâ">üìç${displayAddress}</a>`
                                : `<span class="text-xs text-gray-500 truncate max-w-[180px]" title="${address}">üìç${displayAddress}</span>`
                            }
                            ${getCaseLabelsHtmlCompact(c)}
                        </div>
                    </td>
                    <!-- Êû∂ÈõªÂõûÊï∞Ôºà„Çø„ÉÉ„Éó„ÅßÊé•Á∂ö/‰∏çÂú®Ë®òÈå≤Ôºâ -->
                    <td class="px-2 py-3 text-center">
                        <button onclick="openConnectionModalDirect('${c.cvId}')" class="text-base font-medium text-blue-600 hover:text-blue-800" title="Êû∂ÈõªÂ±•Ê≠¥„ÇíËøΩÂä†">
                            ${getCallCountBadge(c)}
                        </button>
                    </td>
                    <!-- „É°„É¢Ôºà‰ª∂Êï∞Ôºâ -->
                    <td class="px-2 py-3 text-center">
                        <button onclick="openMemoModal('${c.cvId}')" class="text-base font-medium text-amber-600 hover:text-amber-800" title="„É°„É¢">
                            ${getMemoCountBadge(c)}
                        </button>
                    </td>
                    <!-- Ê¨°ÂõûÊû∂Èõª -->
                    <td class="px-2 py-3 text-center">
                        <button onclick="openNextCallModal('${c.cvId}')" class="text-sm ${nextCallDisplay !== '-' ? 'text-blue-600' : 'text-gray-400'} hover:text-blue-700 hover:bg-blue-50 px-1.5 py-0.5 rounded transition-colors" title="Ê¨°ÂõûÊû∂ÈõªÊó•„ÇíË®≠ÂÆö">${nextCallDisplay !== '-' ? nextCallDisplay : 'üóìÔ∏è'}</button>
                    </td>
                    <!-- ÈÄ≤Êçó -->
                    <td class="px-2 py-3 text-center">
                        ${progressDisplay.html}
                    </td>
                    <!-- ÊãÖÂΩì -->
                    <td class="px-3 py-3 text-sm">
                        ${assignee && assignee !== '-'
                            ? `<span class="text-gray-600">${escapeHtml(assignee)}</span>`
                            : `<button onclick="openAssignModal('${c.cvId}')" class="px-2 py-1 text-xs font-medium text-purple-600 bg-purple-50 rounded hover:bg-purple-100 transition-colors">Ê°à‰ª∂ÊåØ„ÇäÂàÜ„Åë</button>`
                        }
                    </td>
                    <!-- ÈÖç‰ø°Êó• -->
                    <td class="px-3 py-3 hidden lg:table-cell text-sm text-gray-500">${shortDate}</td>
                    <!-- Ë©≥Á¥∞ -->
                    <td class="px-2 py-3 text-center">
                        <button onclick="openDetailModal('${c.cvId}')" class="px-2 py-1 text-xs font-medium text-blue-600 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors">
                            Ë©≥Á¥∞
                        </button>
                    </td>
                    <!-- Áô∫‰ø°ÔºàÈõªË©±„Ç¢„Éó„É™Ëµ∑ÂãïÔºâ -->
                    <td class="px-2 py-3 text-center">
                        <a href="tel:${c.customerTel}" onclick="startPhoneCall('${c.cvId}')" class="px-2 py-1 text-xs font-medium text-green-700 bg-green-100 rounded-lg hover:bg-green-200 transition-colors inline-block">
                            üìûÁô∫‰ø°
                        </a>
                    </td>
                </tr>
            `;
        }

        // HTML „Ç®„Çπ„Ç±„Éº„Éó
        function escapeHtml(str) {
            if (!str) return '';
            return String(str).replace(/[&<>"']/g, s => ({
                '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
            }[s]));
        }

        // Ê°à‰ª∂„Çí CV ID „ÅßÊ§úÁ¥¢
        function findCaseByCvId(cvId) {
            return merchantCasesData.find(c => String(c.cvId) === String(cvId));
        }

        // „É°„É¢„É¢„Éº„ÉÄ„É´
        let selectedMemoHistoryIndex = -1;

        function openMemoModal(cvId) {
            const c = findCaseByCvId(cvId);
            if (!c) return;

            currentMemoCase = c;
            selectedMemoHistoryIndex = -1;
            document.getElementById('memoTargetName').textContent = `${c.customerName || '-'} Êßò`;
            document.getElementById('memoTargetAddress').textContent = c.fullAddress || c.city || '-';
            document.getElementById('caseMemoTextarea').value = '';
            document.getElementById('caseMemoModal').classList.remove('hidden');
            loadMemoHistory();
            showMemoQuickOptions(c.detailStatus);
        }

        function closeMemoModal() {
            document.getElementById('caseMemoModal').classList.add('hidden');
            document.getElementById('caseMemoTextarea').value = '';
            currentMemoCase = null;
            selectedMemoHistoryIndex = -1;
            isAfterCallMode = false;
            // „ÇØ„Ç§„ÉÉ„ÇØÈÅ∏ÊäûËÇ¢„ÇíÂâäÈô§
            const quickContainer = document.getElementById('memoQuickOptionsContainer');
            if (quickContainer) quickContainer.remove();
        }

        // ÈÄöË©±Âæå„Éï„É≠„ÉºÁî®„ÅÆ„É°„É¢„É¢„Éº„ÉÄ„É´
        let isAfterCallMode = false;

        function openMemoModalForCall(cvId) {
            const c = findCaseByCvId(cvId);
            if (!c) return;

            currentMemoCase = c;
            isAfterCallMode = true;
            selectedMemoHistoryIndex = -1;
            document.getElementById('memoTargetName').textContent = `${c.customerName || '-'} Êßò`;
            document.getElementById('memoTargetAddress').textContent = c.fullAddress || c.city || '-';
            document.getElementById('caseMemoTextarea').value = '';
            document.getElementById('caseMemoModal').classList.remove('hidden');
            loadMemoHistory();
            showMemoQuickOptions(c.detailStatus);
        }

        // „É°„É¢Â±•Ê≠¥„ÇíË™≠„ÅøËæº„Åø
        function loadMemoHistory() {
            const historyList = document.getElementById('memoHistoryList');
            const countEl = document.getElementById('memoHistoryCount');

            if (!currentMemoCase) {
                historyList.innerHTML = '<p class="text-gray-400 text-sm text-center py-8">Ê°à‰ª∂„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                if (countEl) countEl.textContent = '0‰ª∂';
                return;
            }

            const allHistory = currentMemoCase.callHistory || [];
            if (countEl) countEl.textContent = `${allHistory.length}‰ª∂`;

            if (allHistory.length === 0) {
                historyList.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-4xl mb-3">üìù</div>
                        <p class="text-gray-400 text-sm">„Åæ„Å†Â±•Ê≠¥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                        <p class="text-gray-300 text-xs mt-1">‰∏ä„ÅÆ„Éï„Ç©„Éº„É†„Åã„Çâ„É°„É¢„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                    </div>
                `;
                return;
            }

            // „Çø„Ç§„É†„É©„Ç§„É≥ÂΩ¢Âºè„ÅßË°®Á§∫
            historyList.innerHTML = allHistory.map((item, idx) => {
                const isSelected = idx === selectedMemoHistoryIndex;
                const note = item.note || '';
                const date = item.date || '';
                const type = item.type || detectHistoryType(note);

                // Êó•‰ªò„Çí„Éï„Ç©„Éº„Éû„ÉÉ„ÉàÔºàMM/DD HH:mmÂΩ¢ÂºèÔºâ
                let formattedDate = date;
                try {
                    const d = new Date(date);
                    if (!isNaN(d.getTime())) {
                        formattedDate = `${d.getMonth()+1}/${d.getDate()} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
                    }
                } catch(e) {}

                // Â±•Ê≠¥„Çø„Ç§„Éó„Å´Âøú„Åò„ÅüË°®Á§∫
                const { icon, label, bgColor, textColor, dotColor } = getHistoryStyle(type, note);

                // „É°„É¢ÈÉ®ÂàÜ„ÅÆ„ÅøÊäΩÂá∫Ôºà„Ç¢„Ç§„Ç≥„É≥„Éó„É¨„Éï„Ç£„ÉÉ„ÇØ„Çπ„ÇíÈô§ÂéªÔºâ
                const cleanNote = note.replace(/^(üìû\s*(Êé•Á∂ö|‰∏çÂú®)|üìµ\s*‰∏çÂú®|üè∑Ô∏è|üè†|üìÖ)/, '').trim();

                // „É©„Éô„É´Ë°®Á§∫Áî®
                const itemLabel = item.label || '';
                const itemLabelColor = item.labelColor || 'gray';
                const labelColorMap = {
                    red: { bg: 'bg-red-100', text: 'text-red-700', dot: 'bg-red-500' },
                    yellow: { bg: 'bg-yellow-100', text: 'text-yellow-700', dot: 'bg-yellow-500' },
                    blue: { bg: 'bg-blue-100', text: 'text-blue-700', dot: 'bg-blue-500' },
                    purple: { bg: 'bg-purple-100', text: 'text-purple-700', dot: 'bg-purple-500' },
                    green: { bg: 'bg-green-100', text: 'text-green-700', dot: 'bg-green-500' },
                    gray: { bg: 'bg-gray-100', text: 'text-gray-700', dot: 'bg-gray-500' }
                };
                const labelStyle = labelColorMap[itemLabelColor] || labelColorMap.gray;

                return `
                <div onclick="selectMemoHistory(${idx})" class="relative cursor-pointer group">
                    <!-- „Çø„Ç§„É†„É©„Ç§„É≥„É©„Ç§„É≥ -->
                    <div class="absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200 ${idx === allHistory.length - 1 ? 'h-6' : ''}"></div>

                    <!-- „Çø„Ç§„É†„É©„Ç§„É≥„Éâ„ÉÉ„Éà -->
                    <div class="absolute left-2.5 top-2 w-3 h-3 rounded-full ${isSelected ? 'bg-amber-500' : dotColor} border-2 border-white shadow-sm"></div>

                    <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç´„Éº„Éâ -->
                    <div class="ml-8 rounded-xl p-3 ${isSelected ? 'bg-amber-50 border-2 border-amber-400 shadow-md' : 'bg-white border border-gray-200 hover:border-gray-300 hover:shadow-sm'} transition-all">
                        <div class="flex justify-between items-start gap-2">
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2 mb-1 flex-wrap">
                                    <span class="text-xs text-gray-400 font-medium">${formattedDate}</span>
                                    <span class="text-xs px-1.5 py-0.5 rounded ${bgColor} ${textColor} font-medium">${icon} ${label}</span>
                                    ${itemLabel ? `<span class="text-xs px-1.5 py-0.5 rounded ${labelStyle.bg} ${labelStyle.text} font-medium flex items-center gap-1"><span class="w-2 h-2 rounded-full ${labelStyle.dot}"></span>${itemLabel}</span>` : ''}
                                </div>
                                ${cleanNote ? `<div class="text-sm text-gray-700 whitespace-pre-wrap leading-relaxed">${escapeHtml(cleanNote)}</div>` : ''}
                            </div>
                            ${isSelected ? `
                            <div class="flex gap-1 flex-shrink-0">
                                <button onclick="event.stopPropagation(); editMemoHistory(${idx})" class="w-7 h-7 flex items-center justify-center text-amber-600 hover:bg-amber-100 rounded-lg transition-all text-sm" title="Á∑®ÈõÜ">‚úèÔ∏è</button>
                                <button onclick="event.stopPropagation(); setMemoLabel(${idx})" class="w-7 h-7 flex items-center justify-center text-blue-500 hover:bg-blue-100 rounded-lg transition-all text-sm" title="„É©„Éô„É´">üè∑Ô∏è</button>
                                ${itemLabel ? `<button onclick="event.stopPropagation(); removeLabel(${idx})" class="w-7 h-7 flex items-center justify-center text-gray-400 hover:bg-gray-100 rounded-lg transition-all text-xs" title="„É©„Éô„É´Ëß£Èô§">‚úñÔ∏è</button>` : ''}
                                <button onclick="event.stopPropagation(); deleteMemoHistory(${idx})" class="w-7 h-7 flex items-center justify-center text-red-500 hover:bg-red-100 rounded-lg transition-all text-sm" title="ÂâäÈô§">üóëÔ∏è</button>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        // Â±•Ê≠¥„Çø„Ç§„Éó„ÇíÊ§úÂá∫ÔºàÊó¢Â≠ò„Éá„Éº„ÇøÂØæÂøúÔºâ
        function detectHistoryType(note) {
            if (!note) return 'memo';
            if (note.startsWith('üìû Êé•Á∂ö') || note.startsWith('üìûÊé•Á∂ö')) return 'call_connected';
            if (note.startsWith('üìû ‰∏çÂú®') || note.startsWith('üìµ') || note.startsWith('üìû‰∏çÂú®')) return 'call_absent';
            if (note.startsWith('üè∑Ô∏è')) return 'status_change';
            if (note.startsWith('üè†')) return 'survey_set';
            return 'memo';
        }

        // Â±•Ê≠¥„Çø„Ç§„Éó„Å´Âøú„Åò„Åü„Çπ„Çø„Ç§„É´
        function getHistoryStyle(type, note) {
            switch(type) {
                case 'call_connected':
                    return { icon: 'üìû', label: 'Êé•Á∂ö', bgColor: 'bg-green-100', textColor: 'text-green-700', dotColor: 'bg-green-400' };
                case 'call_absent':
                    return { icon: 'üìµ', label: '‰∏çÂú®', bgColor: 'bg-red-100', textColor: 'text-red-600', dotColor: 'bg-red-400' };
                case 'status_change':
                    // „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„ÅüËâ≤
                    const statusColor = getStatusColorFromNote(note);
                    return { icon: statusColor.dot, label: '„Çπ„ÉÜ„Éº„Çø„Çπ', bgColor: statusColor.bg, textColor: statusColor.text, dotColor: statusColor.dotColor };
                case 'survey_set':
                    return { icon: 'üè†', label: 'ÁèæË™ø', bgColor: 'bg-orange-100', textColor: 'text-orange-700', dotColor: 'bg-orange-400' };
                case 'next_call_set':
                    return { icon: 'üìÖ', label: 'Ê¨°ÂõûÊû∂Èõª', bgColor: 'bg-blue-100', textColor: 'text-blue-700', dotColor: 'bg-blue-400' };
                default:
                    return { icon: 'üìã', label: '„É°„É¢', bgColor: 'bg-amber-100', textColor: 'text-amber-700', dotColor: 'bg-gray-300' };
            }
        }

        // „Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥„ÅÆËâ≤„ÇíÂèñÂæó
        function getStatusColorFromNote(note) {
            if (!note) return { dot: '‚ö™', bg: 'bg-gray-100', text: 'text-gray-700', dotColor: 'bg-gray-400' };
            // note„Åã„ÇâÂ§âÊõ¥Âæå„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÊäΩÂá∫Ôºà„Äå‚Üí „Ç¢„ÉùÊ∏à„Äç„Å™„Å©Ôºâ
            const match = note.match(/‚Üí\s*(.+)$/);
            const newStatus = match ? match[1].trim() : '';

            // statusStyles„Å´Âêà„Çè„Åõ„Åü„Ç´„É©„ÉºÔºàÂÖ®„Å¶‰∏∏„ÅßÁµ±‰∏Ä„ÉªË¢´„ÇäÊúÄÂ∞èÂåñÔºâ
            // üîµÈùí üî¥Ëµ§ üü†Ê©ô üü°ÈªÑ üü¢Á∑ë üü£Á¥´ üü§Ëå∂ ‚ö´Èªí ‚ö™ÁôΩ
            switch(newStatus) {
                case 'Êñ∞ÁùÄ':
                case 'Êú™ÂØæÂøú':
                    return { dot: 'üîµ', bg: 'bg-blue-100', text: 'text-blue-800', dotColor: 'bg-blue-400' };
                case 'Êú™„Ç¢„Éù':
                case 'Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù':
                    return { dot: 'üü†', bg: 'bg-pink-100', text: 'text-pink-700', dotColor: 'bg-pink-400' }; // pink‚Üí„Ç™„É¨„É≥„Ç∏ÂØÑ„Çä
                case '„Ç¢„ÉùÊ∏à':
                    return { dot: 'üü°', bg: 'bg-orange-100', text: 'text-orange-800', dotColor: 'bg-orange-400' }; // orange‚ÜíÈªÑÂØÑ„Çä
                case 'ÁèæË™øÊ∏à':
                    return { dot: 'üü£', bg: 'bg-purple-100', text: 'text-purple-800', dotColor: 'bg-purple-400' };
                case 'Ë¶ãÁ©çÊèêÂá∫Ê∏à„Åø':
                case 'Ë¶ãÁ©çÊèêÂá∫Ê∏à':
                    return { dot: 'üü°', bg: 'bg-amber-100', text: 'text-amber-800', dotColor: 'bg-amber-400' };
                case 'ÂÖ•Èáë‰∫àÂÆö':
                    return { dot: 'üîµ', bg: 'bg-cyan-100', text: 'text-cyan-800', dotColor: 'bg-cyan-400' }; // cyan‚ÜíÈùíÁ≥ª
                case 'ÊàêÁ¥Ñ':
                    return { dot: 'üü¢', bg: 'bg-green-100', text: 'text-green-800', dotColor: 'bg-green-400' };
                case 'ÂÖ•ÈáëÊ∏à':
                    return { dot: 'üü¢', bg: 'bg-emerald-100', text: 'text-emerald-800', dotColor: 'bg-emerald-400' };
                case 'ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´':
                case '‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à':
                case 'ÁèæË™øÂæåÂ§±Ê≥®':
                    return { dot: '‚ö´', bg: 'bg-gray-100', text: 'text-gray-600', dotColor: 'bg-gray-400' };
                case 'Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à':
                    return { dot: 'üü§', bg: 'bg-indigo-100', text: 'text-indigo-700', dotColor: 'bg-indigo-400' }; // indigo‚ÜíËå∂„ÅßÂå∫Âà•
                case '„ÇØ„É¨„Éº„É†':
                    return { dot: 'üî¥', bg: 'bg-red-100', text: 'text-red-800', dotColor: 'bg-red-400' };
                default:
                    return { dot: '‚ö™', bg: 'bg-gray-100', text: 'text-gray-700', dotColor: 'bg-gray-400' };
            }
        }

        // „ÇØ„Ç§„ÉÉ„ÇØ„É°„É¢ËøΩÂä†
        function appendQuickMemo(text) {
            const textarea = document.getElementById('caseMemoTextarea');
            const current = textarea.value.trim();
            if (current) {
                textarea.value = current + '\n' + text;
            } else {
                textarea.value = text;
            }
            textarea.focus();
        }

        function selectMemoHistory(index) {
            selectedMemoHistoryIndex = index;
            loadMemoHistory();
        }

        async function editMemoHistory(index) {
            if (!currentMemoCase) return;
            const history = currentMemoCase.callHistory || [];
            if (!history[index]) return;

            const item = history[index];
            const newNote = prompt('„É°„É¢„ÇíÁ∑®ÈõÜ:', item.note || '');
            if (newNote !== null && newNote !== item.note) {
                history[index].note = newNote;
                // GAS„Å´‰øùÂ≠ò
                await saveCallHistoryToGAS();
                loadMemoHistory();
                renderCases();
            }
        }

        async function deleteMemoHistory(index) {
            if (!currentMemoCase) return;
            if (!confirm('„Åì„ÅÆÂ±•Ê≠¥„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;

            const history = currentMemoCase.callHistory || [];
            if (!history[index]) return;

            history.splice(index, 1);
            selectedMemoHistoryIndex = -1;
            // GAS„Å´‰øùÂ≠ò
            await saveCallHistoryToGAS();
            loadMemoHistory();
            renderCases();
        }

        // „É©„Éô„É´Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´Ë°®Á§∫
        let labelTargetIndex = -1;
        function setMemoLabel(index) {
            if (!currentMemoCase) return;
            labelTargetIndex = index;
            document.getElementById('labelModal').classList.remove('hidden');
        }

        function closeLabelModal() {
            document.getElementById('labelModal').classList.add('hidden');
            labelTargetIndex = -1;
        }

        async function applyLabel(labelText, labelColor) {
            if (!currentMemoCase || labelTargetIndex < 0) return;
            const history = currentMemoCase.callHistory || [];
            if (!history[labelTargetIndex]) return;

            // „É©„Éô„É´„ÇíÂ±•Ê≠¥„Ç¢„Ç§„ÉÜ„É†„Å´Ë®≠ÂÆö
            history[labelTargetIndex].label = labelText;
            history[labelTargetIndex].labelColor = labelColor;

            // Ê°à‰ª∂„Å´„ÇÇ„É©„Éô„É´ÊÉÖÂ†±„Çí‰øùÊåÅÔºàÊúÄÊñ∞„ÅÆ„É©„Éô„É´„Çí„Ç´„Éº„Éâ„Å´Ë°®Á§∫Áî®Ôºâ
            if (!currentMemoCase.labels) currentMemoCase.labels = [];
            // Âêå„Åò„ÉÜ„Ç≠„Çπ„Éà„ÅÆ„É©„Éô„É´„Åå„Å™„Åë„Çå„Å∞ËøΩÂä†
            const existingIdx = currentMemoCase.labels.findIndex(l => l.text === labelText);
            if (existingIdx === -1) {
                currentMemoCase.labels.push({ text: labelText, color: labelColor });
            }

            closeLabelModal();
            await saveCallHistoryToGAS();
            loadMemoHistory();
            renderCases();
        }

        async function removeLabel(index) {
            if (!currentMemoCase) return;
            const history = currentMemoCase.callHistory || [];
            if (!history[index]) return;

            const labelText = history[index].label;
            delete history[index].label;
            delete history[index].labelColor;

            // Ê°à‰ª∂„ÅÆ„É©„Éô„É´„É™„Çπ„Éà„Åã„Çâ„ÇÇÂâäÈô§Ôºà„Åù„ÅÆ„É©„Éô„É´„Åå‰ªñ„Åß‰Ωø„Çè„Çå„Å¶„ÅÑ„Å™„Åë„Çå„Å∞Ôºâ
            if (currentMemoCase.labels && labelText) {
                const stillUsed = history.some(h => h.label === labelText);
                if (!stillUsed) {
                    currentMemoCase.labels = currentMemoCase.labels.filter(l => l.text !== labelText);
                }
            }

            selectedMemoHistoryIndex = -1;
            await saveCallHistoryToGAS();
            loadMemoHistory();
            renderCases();
        }

        // ÈÄöË©±Â±•Ê≠¥„ÇíGAS„Å´‰øùÂ≠ò
        async function saveCallHistoryToGAS() {
            if (!currentMemoCase) return;
            const merchantId = window.merchantId || sessionStorage.getItem('currentUser');

            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        system: 'merchant',
                        subsystem: 'contract',
                        action: 'updateCallHistory',
                        merchantId: merchantId,
                        cvId: currentMemoCase.cvId,
                        callHistory: currentMemoCase.callHistory,
                        callCount: currentMemoCase.callCount
                    })
                });
                const result = await response.json();
                if (!result.success) {
                    console.error('Â±•Ê≠¥‰øùÂ≠ò„Ç®„É©„Éº:', result.error);
                }
            } catch (error) {
                console.error('Â±•Ê≠¥‰øùÂ≠ò„Ç®„É©„Éº:', error);
            }
        }

        async function saveCaseMemo() {
            if (!currentMemoCase) return;

            const memo = document.getElementById('caseMemoTextarea').value.trim();
            if (!memo) {
                showNotification('„Ç®„É©„Éº', '„É°„É¢„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            const merchantId = window.merchantId || sessionStorage.getItem('currentUser');
            const timestamp = new Date().toLocaleString('ja-JP');

            // callHistory„Å´ËøΩÂä†
            if (!currentMemoCase.callHistory) {
                currentMemoCase.callHistory = [];
            }
            currentMemoCase.callHistory.unshift({
                date: timestamp,
                note: memo
            });

            // ‰øùÂ≠òÂØæË±°„ÇíÈÄÄÈÅøÔºà„É¢„Éº„ÉÄ„É´Èñâ„Åò„ÇãÂâç„Å´Ôºâ
            const saveTarget = {
                cvId: currentMemoCase.cvId,
                callHistory: [...currentMemoCase.callHistory],
                callCount: currentMemoCase.callCount,
                customerName: currentMemoCase.customerName
            };

            // ÈÄöË©±Âæå„É¢„Éº„Éâ„Åã„Å©„ÅÜ„Åã„ÇíÈÄÄÈÅø
            const wasAfterCallMode = isAfterCallMode;

            // Âç≥Â∫ß„Å´„É¢„Éº„ÉÄ„É´Èñâ„Åò„Çã & ÁîªÈù¢Êõ¥Êñ∞
            closeMemoModal();
            renderCases();

            // ÈÄöË©±Âæå„É¢„Éº„Éâ„Å™„Çâ„Çπ„ÉÜ„Éº„Çø„ÇπÈÅ∏Êäû„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
            if (wasAfterCallMode) {
                openStatusModalForCall(saveTarget.cvId, saveTarget.customerName);
            }

            // „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„Åß‰øùÂ≠òÔºàawait‰∏çË¶ÅÔºâ
            fetch(GAS_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify({
                    system: 'merchant',
                    subsystem: 'contract',
                    action: 'updateCallHistory',
                    merchantId: merchantId,
                    cvId: saveTarget.cvId,
                    callHistory: saveTarget.callHistory,
                    callCount: saveTarget.callCount
                })
            }).then(response => response.json()).then(result => {
                if (!result.success) {
                    console.error('[Ê°à‰ª∂ÁÆ°ÁêÜ] saveCaseMemo error:', result.error);
                    showNotification('‰øùÂ≠ò„Ç®„É©„Éº', result.error || '„É°„É¢„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                }
            }).catch(error => {
                console.error('[Ê°à‰ª∂ÁÆ°ÁêÜ] saveCaseMemo error:', error);
                showNotification('ÈÄö‰ø°„Ç®„É©„Éº', '‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            });
        }

        // ===== ÈÄöË©±ÁµêÊûú„É¢„Éº„ÉÄ„É´Èñ¢ÈÄ£ =====
        let currentCallCase = null;
        let connectionStatus = null;
        let quickCallTime = null;
        let quickCallDay = null;
        let pendingMemo = '';
        let pendingStatus = null;

        // ÈÄöË©±ÂõûÊï∞„Å®„É°„É¢‰ª∂Êï∞„Çí„Ç´„Ç¶„É≥„Éà
        function getCallAndMemoCounts(caseData) {
            const history = caseData.callHistory || [];

            // Êé•Á∂öÂõûÊï∞Ôºàüìû Êé•Á∂öÔºâ
            const connectedRecords = history.filter(item => {
                const note = item.note || '';
                return note.startsWith('üìû Êé•Á∂ö') || note.startsWith('üìûÊé•Á∂ö');
            });

            // ‰∏çÂú®ÂõûÊï∞Ôºàüìû ‰∏çÂú® „Åæ„Åü„ÅØ üìµÔºâ
            const absentRecords = history.filter(item => {
                const note = item.note || '';
                return note.startsWith('üìû ‰∏çÂú®') || note.startsWith('üìµ');
            });

            // „É°„É¢Ë®òÈå≤ÔºàÊû∂ÈõªË®òÈå≤‰ª•Â§ñÔºâ
            const memoRecords = history.filter(item => {
                const note = item.note || '';
                return !note.startsWith('üìû') && !note.startsWith('üìµ') && note.trim() !== '';
            });

            return {
                connectedCount: connectedRecords.length,
                absentCount: absentRecords.length,
                callTotal: connectedRecords.length + absentRecords.length,
                memoTotal: memoRecords.length
            };
        }

        // ÈÄöË©±Â±•Ê≠¥„Ç´„Ç¶„É≥„ÉàË°®Á§∫Ôºàüìû1Êé•Á∂ö/2Êû∂Èõª ÂΩ¢ÂºèÔºâ
        function getCallCountBadge(caseData) {
            const counts = getCallAndMemoCounts(caseData);
            if (counts.callTotal === 0) return 'üìû';
            return `üìû${counts.connectedCount}Êé•Á∂ö/${counts.callTotal}Êû∂Èõª`;
        }

        // „É°„É¢„Ç´„Ç¶„É≥„ÉàË°®Á§∫Ôºàüìù2‰ª∂ ÂΩ¢ÂºèÔºâ
        function getMemoCountBadge(caseData) {
            const counts = getCallAndMemoCounts(caseData);
            if (counts.memoTotal === 0) return 'üìù';
            return `üìù${counts.memoTotal}‰ª∂`;
        }

        // üìû„Éû„Éº„ÇØÊäº‰∏ãÊôÇÔºöÈõªË©±„Ç¢„Éó„É™Â§ñ„ÅßÊû∂Èõª„Åó„Åü‰∫∫Áî®ÔºàÂç≥Êé•Á∂ö/‰∏çÂú®„É¢„Éº„ÉÄ„É´Ôºâ
        function openConnectionModalDirect(cvId) {
            const c = findCaseByCvId(cvId);
            if (!c) return;

            currentCallCase = c;
            connectionStatus = null;

            // ÈÄöË©±ÁµêÊûú„É¢„Éº„ÉÄ„É´„ÇíÁõ¥Êé•Ë°®Á§∫
            document.getElementById('connectionBtnsContainer')?.classList.remove('hidden');
            document.getElementById('memoSection')?.classList.add('hidden');
            document.getElementById('statusSection')?.classList.add('hidden');
            document.getElementById('nextCallQuickSettings')?.classList.add('hidden');
            document.getElementById('connectionModal')?.classList.remove('hidden');
        }

        // ÈõªË©±Áô∫‰ø°ÊôÇ„ÅÆÂá¶ÁêÜÔºàÈÄöË©±‰∏≠„Éê„ÉºË°®Á§∫Ôºâ
        function startPhoneCall(cvId) {
            const c = findCaseByCvId(cvId);
            if (!c) return;

            currentCallCase = c;

            // localStorage„Å´ÈÄöË©±‰∏≠Áä∂ÊÖã„Çí‰øùÂ≠ò
            localStorage.setItem('callingInProgress', 'true');
            localStorage.setItem('callingCvId', cvId);
            localStorage.setItem('callingStartTime', Date.now().toString());

            // ÈÄöË©±‰∏≠„Éê„Éº„ÇíË°®Á§∫
            showCallingBar(c);
        }

        // ÈÄöË©±‰∏≠„Éê„Éº„ÇíË°®Á§∫
        function showCallingBar(c) {
            const bar = document.getElementById('callingBar');
            const nameSpan = document.getElementById('callingBarName');
            if (bar && nameSpan) {
                nameSpan.textContent = c.customerName || c.name || 'È°ßÂÆ¢';
                bar.classList.remove('hidden');
            }
        }

        // ÈÄöË©±ÁµÇ‰∫Ü„Éú„Çø„É≥Êäº‰∏ãÊôÇ
        function endPhoneCall() {
            const bar = document.getElementById('callingBar');
            if (bar) bar.classList.add('hidden');

            // localStorage„Çí„ÇØ„É™„Ç¢
            localStorage.removeItem('callingInProgress');
            localStorage.removeItem('callingCvId');
            localStorage.removeItem('callingStartTime');

            // ÈÄöË©±ÁµêÊûú„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
            showConnectionModal();
        }

        window.endPhoneCall = endPhoneCall;

        // ÈÄöË©±‰∏≠„Éê„Éº„Åã„ÇâË©≥Á¥∞„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè/Èñâ„Åò„ÇãÔºà„Éà„Ç∞„É´Ôºâ
        function openCallingCaseDetail() {
            const modal = document.getElementById('caseDetailModal');
            if (modal && !modal.classList.contains('hidden')) {
                // „É¢„Éº„ÉÄ„É´„ÅåÈñã„ÅÑ„Å¶„ÅÑ„Åü„ÇâÈñâ„Åò„Çã
                modal.classList.add('hidden');
                return;
            }
            const cvId = localStorage.getItem('callingCvId');
            if (!cvId) return;
            // Ë©≥Á¥∞„É¢„Éº„ÉÄ„É´„ÇíÈñã„ÅèÔºà„Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞„Å®„Åó„Å¶Âëº„Å≥Âá∫„ÅóÔºâ
            window.openDetailModalFromBar(cvId);
        }

        window.openCallingCaseDetail = openCallingCaseDetail;

        // „Éö„Éº„Ç∏Âæ©Â∏∞ÊôÇ„Å´ÈÄöË©±‰∏≠„Éê„Éº„ÇíÂæ©ÂÖÉ
        function checkCallingState() {
            const callingInProgress = localStorage.getItem('callingInProgress');
            const cvId = localStorage.getItem('callingCvId');
            const callTime = parseInt(localStorage.getItem('callingStartTime') || '0');
            const elapsed = Date.now() - callTime;

            // 30ÂàÜ‰ª•ÂÜÖ„ÅÆÈÄöË©±‰∏≠Áä∂ÊÖã„ÇíÂæ©ÂÖÉ
            if (callingInProgress === 'true' && cvId && elapsed < 1800000) {
                const c = findCaseByCvId(cvId);
                if (c) {
                    currentCallCase = c;
                    showCallingBar(c);
                }
            } else if (callingInProgress === 'true') {
                // 30ÂàÜ‰ª•‰∏äÁµåÈÅé„Åó„Åü„Çâ„ÇØ„É™„Ç¢
                localStorage.removeItem('callingInProgress');
                localStorage.removeItem('callingCvId');
                localStorage.removeItem('callingStartTime');
            }
        }

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´„ÉÅ„Çß„ÉÉ„ÇØ
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(checkCallingState, 500);
        });

        // ÈÄöË©±ÁµêÊûú„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
        function showConnectionModal() {
            const modal = document.getElementById('connectionModal');
            if (!modal) return;

            // ÂÖ®Áä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
            connectionStatus = null;
            quickCallTime = null;
            quickCallDay = null;
            pendingMemo = '';
            pendingStatus = null;

            // Êé•Á∂ö/‰∏çÂú®„Éú„Çø„É≥„ÇíË°®Á§∫
            const connectionBtns = document.getElementById('connectionBtnsContainer');
            if (connectionBtns) connectionBtns.classList.remove('hidden');

            // ‰ªñ„ÅÆ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈö†„Åô
            document.getElementById('nextCallQuickSettings')?.classList.add('hidden');
            document.getElementById('memoSection')?.classList.add('hidden');
            document.getElementById('statusSection')?.classList.add('hidden');
            document.getElementById('selectedNextCall')?.classList.add('hidden');

            modal.classList.remove('hidden');
        }

        // ÈÄöË©±ÁµêÊûú„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeConnectionModal() {
            document.getElementById('connectionModal')?.classList.add('hidden');
            currentCallCase = null;
        }

        // ÈÄöË©±Âæå„Éï„É≠„ÉºÁî®„ÅÆÁä∂ÊÖãÁÆ°ÁêÜ
        let afterCallCase = null;
        let selectedStatusValue = null;

        // Êé•Á∂ö/‰∏çÂú®„ÇíÈÅ∏Êäû
        function selectConnectionStatus(status) {
            connectionStatus = status;
            console.log('[selectConnectionStatus] status:', status);

            if (status === 'connected') {
                // Êé•Á∂öÊôÇÔºöÈÄöË©±ÁµêÊûú„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Å¶„ÄÅÊñ∞„Åó„ÅÑ„É°„É¢„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
                const cvId = currentCallCase?.cvId;
                afterCallCase = currentCallCase;
                const merchantId = window.merchantId || sessionStorage.getItem('currentUser');
                console.log('[selectConnectionStatus] connected - cvId:', cvId, 'merchantId:', merchantId);

                // Êé•Á∂öÂ±•Ê≠¥„ÇíËøΩÂä†Ôºà„É≠„Éº„Ç´„É´Ôºâ
                if (currentCallCase) {
                    if (!currentCallCase.callHistory) {
                        currentCallCase.callHistory = [];
                    }
                    currentCallCase.callHistory.unshift({
                        date: new Date().toLocaleString('ja-JP'),
                        note: 'üìû Êé•Á∂ö'
                    });
                    console.log('[selectConnectionStatus] callHistory updated:', currentCallCase.callHistory.length);
                    renderCases(); // UIÂç≥ÊôÇÂèçÊò†
                }

                // Êñ∞ÁùÄ‚ÜíÊú™„Ç¢„Éù„Å´Ëá™ÂãïÂ§âÊõ¥
                if (currentCallCase && currentCallCase.detailStatus === 'Êñ∞ÁùÄ') {
                    currentCallCase.detailStatus = 'Êú™„Ç¢„Éù';
                }

                // „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„ÅßÈõªË©±ÂõûÊï∞„Çí‰øùÂ≠ò
                console.log('[selectConnectionStatus] GAS„Å´ÈõªË©±ÂõûÊï∞‰øùÂ≠òÈñãÂßã...');
                fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        system: 'merchant',
                        subsystem: 'contract',
                        action: 'updateCallHistory',
                        merchantId: merchantId,
                        cvId: cvId,
                        callHistory: currentCallCase?.callHistory || [],
                        callCount: currentCallCase?.callCount || 1
                    })
                })
                .then(res => res.json())
                .then(result => console.log('[selectConnectionStatus] ÈõªË©±ÂõûÊï∞‰øùÂ≠òÁµêÊûú:', result))
                .catch(err => console.error('[selectConnectionStatus] ÈõªË©±ÂõûÊï∞‰øùÂ≠ò„Ç®„É©„Éº:', err));

                // Êñ∞ÁùÄ„Å†„Å£„ÅüÂ†¥Âêà„ÅØ„Çπ„ÉÜ„Éº„Çø„Çπ„ÇÇÊõ¥Êñ∞
                if (currentCallCase && currentCallCase.detailStatus === 'Êú™„Ç¢„Éù') {
                    fetch(GAS_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/plain' },
                        body: JSON.stringify({
                            system: 'merchant',
                            subsystem: 'contract',
                            action: 'updateCaseStatus',
                            merchantId: merchantId,
                            cvId: cvId,
                            status: 'Êú™„Ç¢„Éù'
                        })
                    }).catch(err => console.error('„Çπ„ÉÜ„Éº„Çø„ÇπËá™ÂãïÊõ¥Êñ∞„Ç®„É©„Éº:', err));
                }

                document.getElementById('connectionModal')?.classList.add('hidden');

                if (cvId) {
                    // „Çπ„ÉÜ„Éº„Çø„ÇπÈÅ∏Êäû„É¢„Éº„ÉÄ„É´„ÇíÈÄöË©±Âæå„É¢„Éº„Éâ„ÅßÈñã„Åè
                    isAfterCallMode = true;
                    openStatusModalForCall(cvId, currentCallCase?.customerName);
                }
            } else {
                // ‰∏çÂú®ÊôÇÔºöÈÄöË©±„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Å¶Ê¨°ÂõûÊû∂Èõª„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
                const cvId = currentCallCase?.cvId;

                // ‰∏çÂú®„ÇíÂ±•Ê≠¥„Å´Ë®òÈå≤
                if (currentCallCase) {
                    if (!currentCallCase.callHistory) {
                        currentCallCase.callHistory = [];
                    }
                    currentCallCase.callHistory.unshift({
                        date: new Date().toLocaleString('ja-JP'),
                        note: 'üìû ‰∏çÂú®'
                    });
                    // ÈõªË©±ÂõûÊï∞„Çí„Ç§„É≥„ÇØ„É™„É°„É≥„Éà
                    currentCallCase.callCount = (parseInt(currentCallCase.callCount || 0) + 1);

                    // „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„ÅßGAS„Å´‰øùÂ≠ò
                    const merchantId = window.merchantId || sessionStorage.getItem('currentUser');
                    fetch(GAS_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/plain' },
                        body: JSON.stringify({
                            system: 'merchant',
                            subsystem: 'contract',
                            action: 'updateCallHistory',
                            merchantId: merchantId,
                            cvId: cvId,
                            callHistory: currentCallCase.callHistory,
                            callCount: currentCallCase.callCount
                        })
                    }).catch(err => console.error('‰∏çÂú®Ë®òÈå≤‰øùÂ≠ò„Ç®„É©„Éº:', err));
                }

                // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Å¶ÁîªÈù¢Êõ¥Êñ∞
                document.getElementById('connectionModal')?.classList.add('hidden');
                renderCases();

                // Ê¨°ÂõûÊû∂Èõª„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
                if (cvId) {
                    currentCallCase = null;
                    openNextCallModal(cvId);
                }
            }
        }

        // Êé•Á∂ö/‰∏çÂú®ÈÅ∏Êäû„Å´Êàª„Çã
        function backToConnectionSelect() {
            document.getElementById('memoSection')?.classList.add('hidden');
            document.getElementById('statusSection')?.classList.add('hidden');
            document.getElementById('connectionBtnsContainer')?.classList.remove('hidden');
        }

        // ÈÄöË©±„É°„É¢„Å´„ÇØ„Ç§„ÉÉ„ÇØËøΩÂä†
        function appendConnectionMemo(text) {
            const textarea = document.getElementById('connectionMemo');
            const current = textarea.value.trim();
            if (current) {
                textarea.value = current + '\n' + text;
            } else {
                textarea.value = text;
            }
            textarea.focus();
        }

        // „É°„É¢Á¢∫ÂÆö‚Üí„Çπ„ÉÜ„Éº„Çø„ÇπÈÅ∏Êäû„Å∏
        function confirmMemoAndShowStatus() {
            pendingMemo = document.getElementById('connectionMemo')?.value || '';
            document.getElementById('memoSection')?.classList.add('hidden');
            document.getElementById('statusSection')?.classList.remove('hidden');
        }

        // „Çπ„ÉÜ„Éº„Çø„ÇπÈÅ∏Êäû
        function selectCaseStatus(status) {
            pendingStatus = status;
            // Ê¨°ÂõûÊû∂ÈõªË®≠ÂÆö„Å∏
            document.getElementById('statusSection')?.classList.add('hidden');
            document.getElementById('nextCallQuickSettings')?.classList.remove('hidden');
        }

        // „Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥„Çí„Çπ„Ç≠„ÉÉ„Éó
        function skipStatusChange() {
            pendingStatus = null;
            document.getElementById('statusSection')?.classList.add('hidden');
            document.getElementById('nextCallQuickSettings')?.classList.remove('hidden');
        }

        // „ÇØ„Ç§„ÉÉ„ÇØÊó•‰ªòÈÅ∏Êäû
        function setQuickCallDay(day) {
            quickCallDay = day;

            // „Éú„Çø„É≥„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.quick-day-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'bg-blue-50');
                btn.classList.add('border-gray-300');
                if (btn.dataset.day === day) {
                    btn.classList.add('border-blue-500', 'bg-blue-50');
                    btn.classList.remove('border-gray-300');
                }
            });

            updateSelectedNextCallDisplay();
        }

        // „ÇØ„Ç§„ÉÉ„ÇØÊôÇÈñìÈÅ∏Êäû
        function setQuickCallTime(hour) {
            quickCallTime = hour;

            // „Éú„Çø„É≥„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.quick-time-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'bg-blue-50');
                btn.classList.add('border-gray-300');
                if (parseInt(btn.dataset.hour) === hour) {
                    btn.classList.add('border-blue-500', 'bg-blue-50');
                    btn.classList.remove('border-gray-300');
                }
            });

            updateSelectedNextCallDisplay();
        }

        // ÈÅ∏Êäû„Åï„Çå„ÅüÊ¨°ÂõûÊû∂ÈõªÊó•ÊôÇ„ÇíË°®Á§∫
        function updateSelectedNextCallDisplay() {
            const el = document.getElementById('selectedNextCall');
            if (!el) return;

            if (!quickCallDay || !quickCallTime) {
                el.classList.add('hidden');
                return;
            }

            const minute = document.getElementById('quickCallMinute')?.value || '0';
            const dateStr = getNextCallDateString(quickCallDay);
            el.textContent = `Ê¨°Âõû: ${dateStr} ${quickCallTime}:${minute.padStart(2, '0')}`;
            el.classList.remove('hidden');
        }

        // Êó•‰ªòÊñáÂ≠óÂàó„ÇíÂèñÂæó
        function getNextCallDateString(day) {
            const now = new Date();
            let targetDate = new Date();

            if (day === 'today') {
                // ‰ªäÊó•
            } else if (day === 'tomorrow') {
                targetDate.setDate(now.getDate() + 1);
            } else if (day === 'saturday') {
                const dayOfWeek = now.getDay();
                const daysUntilSat = (6 - dayOfWeek + 7) % 7 || 7;
                targetDate.setDate(now.getDate() + daysUntilSat);
            } else if (day === 'sunday') {
                const dayOfWeek = now.getDay();
                const daysUntilSun = (7 - dayOfWeek) % 7 || 7;
                targetDate.setDate(now.getDate() + daysUntilSun);
            }

            const month = targetDate.getMonth() + 1;
            const date = targetDate.getDate();
            const weekdays = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            const weekday = weekdays[targetDate.getDay()];

            return `${month}/${date}(${weekday})`;
        }

        // Ê¨°ÂõûÊû∂ÈõªË®≠ÂÆö„Çí„Çπ„Ç≠„ÉÉ„Éó
        function skipNextCallSetting() {
            confirmConnectionResult(true);
        }

        // ÈÄöË©±ÁµêÊûú„ÇíÁ¢∫ÂÆö„Åó„Å¶‰øùÂ≠ò
        async function confirmConnectionResult(skipNextCall = false) {
            if (!currentCallCase) return;

            const merchantId = window.merchantId || sessionStorage.getItem('currentUser');

            // „É≠„Ç∞„Ç§„É≥„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„ÇíÂèñÂæóÔºàË¶™„Ç¢„Ç´„Ç¶„É≥„Éà„ÅÆÂêçÂâçÔºâ
            const merchantData = window.merchantData || {};
            const operatorName = merchantData.salesPerson || merchantData.companyName || merchantId;

            // Ê¨°ÂõûÊû∂ÈõªÊó•ÊôÇ„ÇíË®àÁÆó
            let nextCallDateTime = null;
            if (!skipNextCall && quickCallDay && quickCallTime) {
                nextCallDateTime = calculateNextCallDateTime();
            }

            // UIÂç≥ÊôÇÊõ¥Êñ∞ÔºÜ„É¢„Éº„ÉÄ„É´„ÇØ„É≠„Éº„Ç∫
            closeConnectionModal();
            showNotification('‰øùÂ≠ò‰∏≠...', 'ÈÄöË©±ÁµêÊûú„ÇíË®òÈå≤„Åó„Å¶„ÅÑ„Åæ„Åô');

            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        system: 'merchant',
                        subsystem: 'contract',
                        action: 'saveCallResult',
                        merchantId: merchantId,
                        cvId: currentCallCase.cvId,
                        connectionStatus: connectionStatus, // 'connected' or 'absent'
                        memo: pendingMemo,
                        newStatus: pendingStatus,
                        nextCallDateTime: nextCallDateTime,
                        operatorName: operatorName  // ÊãÖÂΩìËÄÖÂêç„ÇíÈÄÅ‰ø°
                    })
                });

                const result = await response.json();
                if (result.success) {
                    // „É≠„Éº„Ç´„É´„Éá„Éº„Çø„ÇíÊõ¥Êñ∞ÔºàÊé•Á∂ö„Éª‰∏çÂú®„Å©„Å°„Çâ„Åß„ÇÇÈõªË©±ÂõûÊï∞„ÇíÂ¢ó„ÇÑ„ÅôÔºâ
                    currentCallCase.callCount = (parseInt(currentCallCase.callCount || 0) + 1);
                    if (pendingMemo) {
                        currentCallCase.merchantMemo = pendingMemo;
                    }
                    if (pendingStatus) {
                        currentCallCase.detailStatus = pendingStatus;
                        recalculateStats();
                        updateCasesStats();
                    }
                    renderCases();
                    showNotification('‰øùÂ≠òÂÆå‰∫Ü', 'ÈÄöË©±ÁµêÊûú„ÇíË®òÈå≤„Åó„Åæ„Åó„Åü');
                } else {
                    showNotification('„Ç®„É©„Éº', result.error || '‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                }
            } catch (error) {
                console.error('[Ê°à‰ª∂ÁÆ°ÁêÜ] confirmConnectionResult error:', error);
                showNotification('„Ç®„É©„Éº', 'ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // Ê¨°ÂõûÊû∂ÈõªÊó•ÊôÇ„ÇíË®àÁÆó
        function calculateNextCallDateTime() {
            if (!quickCallDay || !quickCallTime) return null;

            const now = new Date();
            let targetDate = new Date();

            if (quickCallDay === 'today') {
                // ‰ªäÊó•
            } else if (quickCallDay === 'tomorrow') {
                targetDate.setDate(now.getDate() + 1);
            } else if (quickCallDay === 'saturday') {
                const dayOfWeek = now.getDay();
                const daysUntilSat = (6 - dayOfWeek + 7) % 7 || 7;
                targetDate.setDate(now.getDate() + daysUntilSat);
            } else if (quickCallDay === 'sunday') {
                const dayOfWeek = now.getDay();
                const daysUntilSun = (7 - dayOfWeek) % 7 || 7;
                targetDate.setDate(now.getDate() + daysUntilSun);
            }

            const minute = parseInt(document.getElementById('quickCallMinute')?.value || '0');
            targetDate.setHours(quickCallTime, minute, 0, 0);

            return targetDate.toISOString();
        }

        // „Çπ„ÉÜ„Éº„Çø„Çπ„Ç´„É©„Éº„Éû„ÉÉ„ÉóÔºàÈÅ∏ÊäûÊôÇ„ÅÆËâ≤Ôºâ
        const statusSelectedStyles = {
            'Êñ∞ÁùÄ': { bg: 'bg-blue-100', border: 'border-blue-400', text: 'text-blue-800' },
            'Êú™„Ç¢„Éù': { bg: 'bg-pink-100', border: 'border-pink-400', text: 'text-pink-700' },
            '„Ç¢„ÉùÊ∏à': { bg: 'bg-orange-100', border: 'border-orange-400', text: 'text-orange-800' },
            'ÁèæË™øÊ∏à': { bg: 'bg-purple-100', border: 'border-purple-400', text: 'text-purple-800' },
            'Ë¶ãÁ©çÊèêÂá∫Ê∏à': { bg: 'bg-amber-100', border: 'border-amber-400', text: 'text-amber-800' },
            'ÂÖ•Èáë‰∫àÂÆö': { bg: 'bg-cyan-100', border: 'border-cyan-400', text: 'text-cyan-800' },
            'ÊàêÁ¥Ñ': { bg: 'bg-green-100', border: 'border-green-400', text: 'text-green-800' },
            'ÂÖ•ÈáëÊ∏à': { bg: 'bg-emerald-100', border: 'border-emerald-400', text: 'text-emerald-800' },
            'ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´': { bg: 'bg-gray-200', border: 'border-gray-500', text: 'text-gray-700' },
            'ÁèæË™øÂæåÂ§±Ê≥®': { bg: 'bg-gray-300', border: 'border-gray-600', text: 'text-gray-800' },
            '‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à': { bg: 'bg-gray-200', border: 'border-gray-500', text: 'text-gray-700' },
            'Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à': { bg: 'bg-indigo-100', border: 'border-indigo-400', text: 'text-indigo-700' },
            '„ÇØ„É¨„Éº„É†': { bg: 'bg-red-100', border: 'border-red-400', text: 'text-red-800' }
        };

        // „Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥„É¢„Éº„ÉÄ„É´
        function openStatusModal(cvId) {
            const c = findCaseByCvId(cvId);
            if (!c) return;

            currentStatusCase = c;
            document.getElementById('statusTargetName').textContent = `${c.customerName || '-'} Êßò`;
            document.getElementById('caseStatusModal').classList.remove('hidden');
            resetStatusSelection();
            // ÁèæÂú®„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Çí„Éá„Éï„Ç©„É´„ÉàÈÅ∏Êäû
            if (c.detailStatus) {
                selectDetailStatus(c.detailStatus);
            }
        }

        // ÈÄöË©±Âæå„Éï„É≠„ÉºÁî®„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„É¢„Éº„ÉÄ„É´
        function openStatusModalForCall(cvId, customerName) {
            const c = findCaseByCvId(cvId);
            if (!c) {
                currentStatusCase = { cvId, customerName };
            } else {
                currentStatusCase = c;
            }
            document.getElementById('statusTargetName').textContent = `${customerName || '-'} Êßò`;
            document.getElementById('caseStatusModal').classList.remove('hidden');
            resetStatusSelection();
            // ÁèæÂú®„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Çí„Éá„Éï„Ç©„É´„ÉàÈÅ∏Êäû
            if (c && c.detailStatus) {
                selectDetailStatus(c.detailStatus);
            }
        }

        function closeStatusModal() {
            document.getElementById('caseStatusModal').classList.add('hidden');
            currentStatusCase = null;
            selectedStatusValue = null;
            afterCallCase = null;
            isAfterCallMode = false;
        }

        // „Çπ„ÉÜ„Éº„Çø„ÇπÈÅ∏ÊäûUI„Çí„É™„Çª„ÉÉ„ÉàÔºàÂÖ®„Å¶ÁôΩ„Å´Êàª„ÅôÔºâ
        function resetStatusSelection() {
            selectedStatusValue = null;
            document.querySelectorAll('#statusDetailGrid .status-btn, #statusDetailGrid2 .status-btn').forEach(btn => {
                // ÈÅ∏ÊäûÁä∂ÊÖã„ÅÆ„ÇØ„É©„Çπ„ÇíÂâäÈô§
                Object.values(statusSelectedStyles).forEach(style => {
                    btn.classList.remove(style.bg, style.border, style.text);
                });
                // „Éá„Éï„Ç©„É´„Éà„ÅÆÁôΩ„Å´Êàª„Åô
                btn.classList.add('bg-white', 'border-gray-200', 'text-gray-500');
            });
        }

        // Ë©≥Á¥∞„Çπ„ÉÜ„Éº„Çø„ÇπÈÅ∏Êäû
        function selectDetailStatus(status) {
            selectedStatusValue = status;
            // ÂÖ®„Éú„Çø„É≥„Çí„É™„Çª„ÉÉ„Éà
            document.querySelectorAll('#statusDetailGrid .status-btn, #statusDetailGrid2 .status-btn').forEach(btn => {
                Object.values(statusSelectedStyles).forEach(style => {
                    btn.classList.remove(style.bg, style.border, style.text);
                });
                btn.classList.add('bg-white', 'border-gray-200', 'text-gray-500');
            });
            // ÈÅ∏Êäû„Åó„Åü„Éú„Çø„É≥„Å´Ëâ≤„ÇíÈÅ©Áî®
            const selectedBtn = document.querySelector(`[data-status="${status}"]`);
            const style = statusSelectedStyles[status];
            if (selectedBtn && style) {
                selectedBtn.classList.remove('bg-white', 'border-gray-200', 'text-gray-500');
                selectedBtn.classList.add(style.bg, style.border, style.text);
            }
        }

        // „Çπ„ÉÜ„Éº„Çø„ÇπÁ¢∫ÂÆö
        function confirmStatusSelection() {
            if (!selectedStatusValue) {
                showNotification('ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ', '„Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'warning');
                return;
            }
            setCaseStatus(selectedStatusValue);
        }

        function setCaseStatus(newStatus) {
            if (!currentStatusCase) return;

            const merchantId = window.merchantId || sessionStorage.getItem('currentUser');
            const cvId = currentStatusCase.cvId;
            const wasAfterCallMode = isAfterCallMode;
            const oldStatus = currentStatusCase.detailStatus;
            console.log('[setCaseStatus] currentStatusCase:', currentStatusCase);
            console.log('[setCaseStatus] merchantId:', merchantId, 'cvId:', cvId, 'status:', newStatus, 'isAfterCallMode:', wasAfterCallMode);

            // Â±•Ê≠¥„Å´ËøΩÂä†Ôºà„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥„ÅåÂÆüÈöõ„Å´Ë°å„Çè„Çå„ÅüÂ†¥Âêà„ÅÆ„ÅøÔºâ
            if (oldStatus !== newStatus) {
                if (!currentStatusCase.callHistory) {
                    currentStatusCase.callHistory = [];
                }
                currentStatusCase.callHistory.unshift({
                    date: new Date().toLocaleString('ja-JP'),
                    type: 'status_change',
                    note: `üè∑Ô∏è ${oldStatus || 'Êñ∞ÁùÄ'} ‚Üí ${newStatus}`
                });
            }

            // Âç≥Â∫ß„Å´„É≠„Éº„Ç´„É´„Éá„Éº„ÇøÊõ¥Êñ∞ÔºÜ„É¢„Éº„ÉÄ„É´Èñâ„Åò„Çã
            currentStatusCase.detailStatus = newStatus;
            recalculateStats();
            updateCasesStats();
            renderCases();
            closeStatusModal();

            // „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„ÅßGAS„Å´‰øùÂ≠òÔºàÊóß„Çπ„ÉÜ„Éº„Çø„Çπ„ÇÇÈÄÅ‰ø°„Åó„Å¶„É°„É¢„Å´Â±•Ê≠¥„ÇíÊÆã„ÅôÔºâ
            fetch(GAS_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify({
                    system: 'merchant',
                    subsystem: 'contract',
                    action: 'updateCaseStatus',
                    merchantId: merchantId,
                    cvId: cvId,
                    status: newStatus,
                    oldStatus: oldStatus || 'Êñ∞ÁùÄ'
                })
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    console.log('[setCaseStatus] ‰øùÂ≠òÂÆå‰∫Ü:', newStatus);
                } else {
                    console.error('[setCaseStatus] ‰øùÂ≠òÂ§±Êïó:', result.error);
                    showNotification('‰øùÂ≠ò„Ç®„É©„Éº', result.error || '„Çπ„ÉÜ„Éº„Çø„Çπ„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                }
            })
            .catch(error => {
                console.error('[setCaseStatus] ÈÄö‰ø°„Ç®„É©„Éº:', error);
                showNotification('ÈÄö‰ø°„Ç®„É©„Éº', '„Çπ„ÉÜ„Éº„Çø„Çπ„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            });

            // „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„Å¶Ê¨°„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥„Å∏
            if (wasAfterCallMode) {
                isAfterCallMode = false;
            }

            // „Ç¢„ÉùÊ∏à„Å™„ÇâÁèæË™øÊó•ÊôÇË®≠ÂÆö„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫ÔºàÈÄöË©±„Éï„É≠„Éº‰ª•Â§ñ„Åß„ÇÇÔºâ
            if (newStatus === '„Ç¢„ÉùÊ∏à') {
                openSurveyDateModal(cvId);
            } else if (wasAfterCallMode && newStatus === 'Êú™„Ç¢„Éù') {
                // ÈÄöË©±Âæå„Éï„É≠„Éº„ÅßÊú™„Ç¢„Éù„ÅÆÂ†¥Âêà„ÅÆ„ÅøÊ¨°ÂõûÊû∂ÈõªÊó•Ë®≠ÂÆö
                openNextCallModal(cvId);
            }
        }

        // Áµ±Ë®à„ÇíÂÜçË®àÁÆó
        function recalculateStats() {
            merchantCasesStats = {
                total: merchantCasesData.length,
                pending: 0,
                visited: 0,
                quoted: 0,
                contracted: 0,
                cancelled: 0
            };

            merchantCasesData.forEach(c => {
                const status = c.detailStatus || '';
                if (status === 'ÊàêÁ¥Ñ') merchantCasesStats.contracted++;
                else if (status === '„Ç≠„É£„É≥„Çª„É´') merchantCasesStats.cancelled++;
                else if (status === 'Ë¶ãÁ©çÊèêÂá∫Ê∏à„Åø') merchantCasesStats.quoted++;
                else if (status === 'Ë®™ÂïèÊ∏à„Åø') merchantCasesStats.visited++;
                else merchantCasesStats.pending++;
            });
        }

        // Ë©≥Á¥∞„É¢„Éº„ÉÄ„É´ÔºàV2031 „Ç™„Éº„ÉÄ„ÉºËª¢ÈÄÅÊñáÂÖ®È†ÖÁõÆÂØæÂøúÔºâ
        function openDetailModal(cvId) {
            const c = findCaseByCvId(cvId);
            if (!c) return;

            const status = c.detailStatus || 'ÂØæÂøúÂæÖ„Å°';
            const style = statusStyles[status] || statusStyles[''];

            // Ë©≥Á¥∞È†ÖÁõÆ„Éò„É´„Éë„ÉºÔºàÂÄ§„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„ÅøË°®Á§∫Ôºâ
            // V2030: isHtmlÂºïÊï∞ËøΩÂä† - true„ÅÆÂ†¥Âêà„ÅØHTML„Çí„Åù„ÅÆ„Åæ„ÅæÂá∫ÂäõÔºà„É™„É≥„ÇØÁ≠âÁî®Ôºâ
            const detailItem = (label, value, isHtml = false) => {
                if (!value) return '';
                return `<div class="py-1.5 flex"><span class="text-gray-500 w-28 flex-shrink-0">${label}</span><span class="font-medium">${isHtml ? value : escapeHtml(value)}</span></div>`;
            };

            // „Çª„ÇØ„Ç∑„Éß„É≥„Éò„É´„Éë„ÉºÔºàÈ†ÖÁõÆ„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„Åø„Çª„ÇØ„Ç∑„Éß„É≥Ë°®Á§∫Ôºâ
            const section = (title, items) => {
                const filtered = items.filter(i => i);
                if (filtered.length === 0) return '';
                return `
                    <div class="border-t pt-3 mt-3">
                        <h5 class="font-bold text-sm text-gray-700 mb-2">${title}</h5>
                        <div class="text-sm">${filtered.join('')}</div>
                    </div>
                `;
            };

            // ‰ΩèÊâÄ„Éï„É´„ÉÜ„Ç≠„Çπ„Éà
            const fullAddr = c.postalCode ? `„Äí${c.postalCode} ${c.fullAddress || ''}` : (c.fullAddress || '-');

            // Áâ©‰ª∂Á®ÆÂà•„Å®ÈöéÊï∞Ôºàfloors„Å´„ÅØ„Åù„ÅÆ„Åæ„Åæ„Äå2ÈöéÂª∫„Å¶„ÄçÁ≠â„ÅåÂÖ•„Å£„Å¶„ÅÑ„ÇãÔºâ
            const propType = [c.propertyType, c.floors].filter(v => v).join(' / ');

            // ÊÄßÂà•/Âπ¥‰ª£
            const genderAge = [c.customerGender, c.customerAge].filter(v => v).join(' / ');

            // Á´ã„Å°‰ºö„ÅÑÊÉÖÂ†±
            let attendance = c.attendanceStatus || '';
            if (attendance && c.attendeeRelation) attendance += `Ôºà${c.attendeeRelation}Ôºâ`;

            // Â°óË£ÖÂ±•Ê≠¥ÔºàÂ∑•‰∫ãÊ≠¥ÔºãÂâçÂõûÊñΩÂ∑•ÊôÇÊúüÔºâ
            let paintHistory = c.workHistory || '';
            if (c.lastConstructionTime) {
                paintHistory = paintHistory ? `${paintHistory}ÔºàÂâçÂõû: ${c.lastConstructionTime}Ôºâ` : c.lastConstructionTime;
            }

            // Ë¶ãÁ©ç„ÇÇ„ÇäÈÄÅ‰ªòÂÖà„Çª„ÇØ„Ç∑„Éß„É≥ÔºàÁâ©‰ª∂‰ΩèÊâÄ„Å®Áï∞„Å™„ÇãÂ†¥Âêà„ÅÆ„ÅøÔºâ
            const hasAltAddress = c.estimateDestination && c.estimateDestination !== 'Áâ©‰ª∂‰ΩèÊâÄ';
            const altAddress = [c.homePrefecture, c.homeAddressDetail].filter(v => v).join('');
            const altAddrFull = c.homePostalCode ? `„Äí${c.homePostalCode} ${altAddress}` : altAddress;

            // Ê°à‰ª∂„É°„É¢
            const fullMemo = c.caseMemo || '';

            // „Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„ÇíË®≠ÂÆö
            const statusEl = document.getElementById('detailModalStatus');
            if (statusEl) {
                statusEl.className = `px-3 py-1 text-sm font-semibold rounded-full ${style.bg} ${style.text}`;
                statusEl.textContent = status;
            }

            const content = `
                <div class="space-y-2">
                    <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                    <div class="pb-2 border-b">
                        <h4 class="text-xl font-bold">${escapeHtml(c.customerName || '-')}${c.customerNameKana ? `Ôºà${escapeHtml(c.customerNameKana)}Ôºâ` : ''}Êßò</h4>
                    </div>

                    <!-- ÁÆ°ÁêÜÊÉÖÂ†± -->
                    <div class="text-sm bg-gray-50 rounded p-2">
                        <div class="flex flex-wrap gap-4">
                            <span class="text-gray-500">CV ID: <span class="font-medium text-gray-700">${c.cvId}</span></span>
                            <span class="text-gray-500">ÈÖç‰ø°: <span class="font-medium text-gray-700">${c.deliveredAt || '-'}</span></span>
                        </div>
                    </div>

                    <!-- „ÅäÂÆ¢ÊßòÊÉÖÂ†±ÔºàËª¢ÈÄÅÊñáÊ∫ñÊã†„ÅÆ‰∏¶„Å≥È†ÜÔºâ -->
                    ${section('„ÅäÂÆ¢ÊßòÊÉÖÂ†±', [
                        detailItem('ÈõªË©±Áï™Âè∑', c.customerTel ? `<a href="tel:${c.customerTel}" class="text-green-600 hover:underline">${c.customerTel}</a>` : '', true),
                        detailItem('„É°„Éº„É´', c.customerEmail ? `<a href="mailto:${c.customerEmail}" class="text-blue-600 hover:underline">${c.customerEmail}</a>` : '', true),
                        detailItem('ÊÄßÂà•/Âπ¥‰ª£', genderAge),
                        detailItem('Á∂öÊüÑ', c.relationship),
                        detailItem('ÈÄ£Áµ°ÊôÇÈñìÂ∏Ø', c.contactTime)
                    ])}

                    <!-- 2‰∫∫ÁõÆÈÄ£Áµ°ÂÖà -->
                    ${(c.name2 || c.tel2) ? section('2‰∫∫ÁõÆ„ÅÆÈÄ£Áµ°ÂÖà', [
                        detailItem('Ê∞èÂêç', c.name2 ? `${c.name2}Êßò` : ''),
                        detailItem('ÈõªË©±Áï™Âè∑', c.tel2 ? `<a href="tel:${c.tel2}" class="text-green-600 hover:underline">${c.tel2}</a>` : '', true),
                        detailItem('Á∂öÊüÑ', c.relationship2),
                        detailItem('ÂÇôËÄÉ', c.remarks2)
                    ]) : ''}

                    <!-- Áâ©‰ª∂ÊÉÖÂ†±ÔºàËª¢ÈÄÅÊñáÊ∫ñÊã†„ÅÆ‰∏¶„Å≥È†ÜÔºâ -->
                    ${section('Áâ©‰ª∂ÊÉÖÂ†±', [
                        detailItem('ÊâÄÂú®Âú∞', fullAddr),
                        detailItem('Áâ©‰ª∂Á®ÆÂà•', propType),
                        detailItem('ÁØâÂπ¥Êï∞', c.buildingAge ? `${c.buildingAge}Âπ¥` : ''),
                        detailItem('Âª∫Áâ©Èù¢Á©ç', c.buildingArea),
                        detailItem('Â°óË£ÖÂ±•Ê≠¥', paintHistory),
                        detailItem('Â§ñÂ£ÅÊùê', c.exteriorMaterial),
                        detailItem('Â±ãÊ†πÊùê', c.roofMaterial),
                        detailItem('Âä£ÂåñÁä∂Ê≥Å', c.deteriorationStatus),
                        detailItem('Ê∞ó„Å´„Å™„ÇãÁÆáÊâÄ', c.estimateAreas),
                        detailItem('Â§ñÂ£ÅÂ∑•‰∫ãÂ∏åÊúõ', c.exteriorWorkRequest),
                        detailItem('Â±ãÊ†πÂ∑•‰∫ãÂ∏åÊúõ', c.roofWorkRequest),
                        detailItem('Google Maps', c.googleMapsLink ? `<a href="${c.googleMapsLink}" target="_blank" class="text-blue-600 hover:underline">Âú∞Âõ≥„ÇíÈñã„Åè</a>` : '', true)
                    ])}

                    <!-- Ë¶ãÁ©ç„ÇÇ„ÇäÈÄÅ‰ªòÂÖàÔºàÂà•‰ΩèÊâÄ„ÅÆÂ†¥Âêà„ÅÆ„ÅøÔºâ -->
                    ${hasAltAddress ? section('Ë¶ãÁ©ç„ÇÇ„ÇäÈÄÅ‰ªòÂÖà', [
                        detailItem('Â∏åÊúõÈÄÅ‰ªòÂÖà', c.estimateDestination),
                        altAddrFull ? `<div class="py-1.5 flex"><span class="text-gray-500 w-28 flex-shrink-0">‰ΩèÊâÄ</span><span class="font-medium">${escapeHtml(altAddrFull)}</span></div>` : ''
                    ]) : ''}

                    <!-- „ÅîÂ∏åÊúõÂÜÖÂÆπÔºàËª¢ÈÄÅÊñáÊ∫ñÊã†„ÅÆ‰∏¶„Å≥È†ÜÔºâ -->
                    ${section('„ÅîÂ∏åÊúõÂÜÖÂÆπ', [
                        detailItem('Ë¶ãÁ©ç„ÇÇ„ÇäÂ∏åÊúõÁÆáÊâÄ', c.estimateRequestAreas),
                        detailItem('ÊñΩÂ∑•ÊôÇÊúü', c.constructionTiming),
                        detailItem('Â∏åÊúõÁ§æÊï∞', c.preferredCompanyCount),
                        detailItem('‰ªñÁ§æË¶ãÁ©ç', c.existingEstimates),
                        detailItem('Ë¶ãÁ©ç„ÇÇ„ÇäÂèñÂæóÂÖà', c.estimateSource),
                        detailItem('Ë®™ÂïèÊ•≠ËÄÖ', c.visitingContractor),
                        detailItem('Ë®™ÂïèÊ•≠ËÄÖÂêç', c.visitingContractorName),
                        detailItem('ÊØîËºÉÊÑèÂêë', c.comparisonIntent),
                        detailItem('Ê•≠ËÄÖÈÅ∏ÂÆöÊù°‰ª∂', c.selectionCriteria),
                        detailItem('„ÉØ„Éº„Éâ„É™„É≥„ÇØÂõûÁ≠î', c.wordLinkAnswer),
                        detailItem('ÁèæË™øÂ∏åÊúõÊó•ÊôÇ', c.inspectionDate),
                        detailItem('Á´ã„Å°‰ºö„ÅÑ', attendance),
                        detailItem('ÁâπÊÆäË¶ÅÊúõ', c.specialItems)
                    ])}

                    <!-- Ê°à‰ª∂„É°„É¢ -->
                    ${fullMemo ? section('Ê°à‰ª∂„É°„É¢', [
                        `<div class="text-sm p-2 rounded whitespace-pre-wrap">${escapeHtml(fullMemo)}</div>`
                    ]) : ''}
                </div>
            `;

            document.getElementById('caseDetailContent').innerHTML = content;
            document.getElementById('caseDetailModal').classList.remove('hidden');

            // Ë©≥Á¥∞„É¢„Éº„ÉÄ„É´Áî®„ÅÆÁèæÂú®Ê°à‰ª∂„Çí‰øùÊåÅ
            currentDetailCase = c;

            // „É°„É¢„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÊõ¥Êñ∞
            updateDetailMemoSection(c);
        }

        // ÈÄöË©±‰∏≠„Éê„Éº„Åã„Çâ„ÅÆÂëº„Å≥Âá∫„ÅóÁî®
        window.openDetailModalFromBar = openDetailModal;

        // Ë©≥Á¥∞„É¢„Éº„ÉÄ„É´Áî®„ÅÆÁèæÂú®Ê°à‰ª∂
        let currentDetailCase = null;

        function closeDetailModal() {
            document.getElementById('caseDetailModal').classList.add('hidden');
            currentDetailCase = null;
        }

        // Ë©≥Á¥∞„É¢„Éº„ÉÄ„É´„ÅÆ„É°„É¢„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÊõ¥Êñ∞
        function updateDetailMemoSection(c) {
            const history = c.callHistory || [];
            // „É°„É¢„ÅÆ„ÅøÔºàüìû‰ª•Â§ñÔºâ„Çí„Éï„Ç£„É´„Çø
            const memoRecords = history.filter(item => {
                const note = item.note || '';
                return !note.startsWith('üìû') && !note.startsWith('üìµ') && note.trim() !== '';
            });

            // ‰ª∂Êï∞Ë°®Á§∫
            document.getElementById('detailMemoCount').textContent = `${memoRecords.length}‰ª∂`;

            // Â±•Ê≠¥„Éó„É¨„Éì„É•„ÉºÔºàÊúÄÊñ∞3‰ª∂Ôºâ
            const historyEl = document.getElementById('detailMemoHistory');
            if (memoRecords.length === 0) {
                historyEl.innerHTML = '<p class="text-xs text-gray-400 text-center py-1">„É°„É¢„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
            } else {
                historyEl.innerHTML = memoRecords.slice(0, 3).map(item => `
                    <div class="text-xs bg-white rounded p-2 border border-amber-100">
                        <div class="flex justify-between items-start">
                            <span class="text-gray-500">${item.date || ''}</span>
                        </div>
                        <p class="text-gray-700 mt-0.5 line-clamp-2">${escapeHtml(item.note || '')}</p>
                    </div>
                `).join('');
            }

            // „ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„Çí„ÇØ„É™„Ç¢
            document.getElementById('detailMemoTextarea').value = '';
        }

        // Ë©≥Á¥∞„É¢„Éº„ÉÄ„É´„Åã„Çâ„É°„É¢„Çí‰øùÂ≠ò
        function saveDetailMemo() {
            const textarea = document.getElementById('detailMemoTextarea');
            const memo = textarea.value.trim();
            if (!memo || !currentDetailCase) return;

            // callHistory„Å´ËøΩÂä†
            if (!currentDetailCase.callHistory) {
                currentDetailCase.callHistory = [];
            }
            currentDetailCase.callHistory.unshift({
                date: new Date().toLocaleString('ja-JP'),
                note: memo
            });

            // UIÊõ¥Êñ∞
            updateDetailMemoSection(currentDetailCase);
            renderCases();

            // GAS„Å´‰øùÂ≠òÔºà„Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„ÉâÔºâ
            const merchantId = window.merchantId || sessionStorage.getItem('currentUser');
            fetch(GAS_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify({
                    system: 'merchant',
                    subsystem: 'contract',
                    action: 'updateCaseMemo',
                    merchantId: merchantId,
                    cvId: currentDetailCase.cvId,
                    memo: memo
                })
            })
            .then(res => res.json())
            .then(result => {
                if (result.success) {
                    console.log('[saveDetailMemo] ‰øùÂ≠òÂÆå‰∫Ü');
                } else {
                    console.error('[saveDetailMemo] ‰øùÂ≠òÂ§±Êïó:', result.error);
                }
            })
            .catch(err => console.error('[saveDetailMemo] ÈÄö‰ø°„Ç®„É©„Éº:', err));
        }

        // ===== ÊãÖÂΩìËÄÖÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ =====
        let assignTargetCvId = null;

        // ÊãÖÂΩìËÄÖ„É™„Çπ„ÉàÔºàË®≠ÂÆö„Åã„ÇâÂèñÂæó„ÄÅ„Å™„Åë„Çå„Å∞„Éá„Éï„Ç©„É´„ÉàÔºâ
        function getStaffList() {
            // Ë®≠ÂÆöÁîªÈù¢„Å™„Å©„Åã„ÇâÂèñÂæó„Åß„Åç„ÇãÂ†¥Âêà„ÅØ„Åù„Å°„Çâ„Çí‰Ωø„ÅÜ
            // „Å®„Çä„ÅÇ„Åà„Åö„Éá„Éï„Ç©„É´„Éà„É™„Çπ„Éà
            return ['Áî∞‰∏≠Â§™ÈÉé', '‰ΩêËó§Ëä±Â≠ê', 'Èà¥Êú®‰∏ÄÈÉé'];
        }

        function openAssignModal(cvId) {
            assignTargetCvId = cvId;
            const staffList = getStaffList();
            const listHtml = staffList.map(name => `
                <button onclick="assignStaff('${name}')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-blue-50 transition-colors border border-gray-200">
                    <span class="font-medium">${name}</span>
                </button>
            `).join('');
            document.getElementById('assignStaffList').innerHTML = listHtml;
            document.getElementById('assignModal').classList.remove('hidden');
        }

        function closeAssignModal() {
            document.getElementById('assignModal').classList.add('hidden');
            assignTargetCvId = null;
        }

        async function assignStaff(staffName) {
            if (!assignTargetCvId) return;

            try {
                // API„ÅßÊãÖÂΩìËÄÖ„ÇíÊõ¥Êñ∞
                const result = await window.apiClient.postRequest('updateCVData', {
                    cvId: assignTargetCvId,
                    data: { assignee: staffName }
                });

                if (result.success) {
                    // „É≠„Éº„Ç´„É´„Éá„Éº„Çø„ÇÇÊõ¥Êñ∞
                    const caseData = merchantCasesData.find(c => String(c.cvId) === String(assignTargetCvId));
                    if (caseData) {
                        caseData.assignee = staffName;
                    }
                    // „É™„Çπ„ÉàÂÜçÊèèÁîª
                    if (typeof renderCaseList === 'function') {
                        renderCaseList();
                    }
                    showNotification('ÊàêÂäü', `${staffName}„Å´ÊåØ„ÇäÂàÜ„Åë„Åæ„Åó„Åü`, 'success');
                } else {
                    showNotification('„Ç®„É©„Éº', 'ÊåØ„ÇäÂàÜ„Åë„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                }
            } catch (error) {
                console.error('ÊãÖÂΩìËÄÖÊåØ„ÇäÂàÜ„Åë„Ç®„É©„Éº:', error);
                showNotification('„Ç®„É©„Éº', 'ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
            }

            closeAssignModal();
        }

        // ===== Ê¨°ÂõûÊû∂ÈõªÊó•Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´ =====
        let nextCallTargetCvId = null;
        let selectedNextCallDate = null;
        let selectedNextCallHour = null;
        let selectedNextCallMinute = 0;

        // ÊôÇÈñì„Éó„É™„Çª„ÉÉ„ÉàÔºà„Éá„Éï„Ç©„É´„ÉàÂÄ§„ÄÅlocalStorage„Åã„ÇâË™≠„ÅøËæº„ÅøÂèØÔºâ
        let timePresets = [
            { label: 'Êúù', hour: 9, minute: 0 },
            { label: 'Êòº', hour: 12, minute: 0 },
            { label: 'Â§ïÊñπ', hour: 18, minute: 0 }
        ];

        // localStorage„Åã„ÇâÊôÇÈñì„Éó„É™„Çª„ÉÉ„Éà„ÇíË™≠„ÅøËæº„Åø
        function loadTimePresets() {
            const saved = localStorage.getItem('nextCallTimePresets');
            if (saved) {
                try {
                    timePresets = JSON.parse(saved);
                } catch (e) {
                    console.error('ÊôÇÈñì„Éó„É™„Çª„ÉÉ„ÉàË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', e);
                }
            }
        }

        // ÊôÇÈñìÂ∏Ø„É©„Éô„É´„ÇíÂãïÁöÑ„Å´Ê±∫ÂÆö
        function getTimeLabel(hour) {
            if (hour >= 5 && hour < 11) return 'Êúù';
            if (hour >= 11 && hour < 14) return 'Êòº';
            if (hour >= 14 && hour < 18) return 'Â§ïÊñπ';
            return 'Â§ú';
        }

        // ÊôÇÈñì„Éó„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥„ÇíÁîüÊàê
        function renderTimePresetButtons() {
            loadTimePresets();
            const container = document.getElementById('timePresetButtons');
            if (!container) return;

            // ÊôÇÈñìÈ†Ü„Å´„ÇΩ„Éº„Éà
            const sortedPresets = [...timePresets].sort((a, b) => {
                const timeA = a.hour * 60 + a.minute;
                const timeB = b.hour * 60 + b.minute;
                return timeA - timeB;
            });

            const html = sortedPresets.map((preset) => {
                const timeStr = `${preset.hour}:${String(preset.minute).padStart(2, '0')}`;
                const label = getTimeLabel(preset.hour);
                return `
                    <button onclick="setNextCallTimePreset(${preset.hour}, ${preset.minute})"
                            class="next-call-time-btn py-2 bg-white border-2 border-gray-200 text-gray-700 rounded-lg hover:border-blue-400 hover:bg-blue-50 font-medium text-sm transition-all"
                            data-hour="${preset.hour}" data-minute="${preset.minute}">
                        <div class="text-xs text-gray-400">${label}</div>
                        <div>${timeStr}</div>
                    </button>
                `;
            }).join('');

            // „Åù„ÅÆ‰ªñ„Éú„Çø„É≥„ÇíËøΩÂä†
            container.innerHTML = html + `
                <button onclick="toggleCustomTimePicker()" class="py-2 bg-white border-2 border-gray-200 text-gray-500 rounded-lg hover:border-blue-400 hover:bg-blue-50 font-medium text-sm transition-all">
                    <div class="text-xs text-gray-400">„Åù„ÅÆ‰ªñ</div>
                    <div class="text-base">‚è∞</div>
                </button>
            `;
        }

        // „Ç´„Çπ„Çø„É†ÊôÇÈñì„Éî„ÉÉ„Ç´„Éº„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
        function toggleCustomTimePicker() {
            const picker = document.getElementById('customTimePicker');
            picker.classList.toggle('hidden');
        }

        // ÊôÇÈñì„Éó„É™„Çª„ÉÉ„ÉàË®≠ÂÆö„É¢„Éº„ÉÄ„É´
        function openTimePresetSettings() {
            loadTimePresets();
            // ÁèæÂú®„ÅÆÂÄ§„Çí„Çª„ÉÉ„Éà
            document.getElementById('presetTime1Hour').value = timePresets[0]?.hour || 9;
            document.getElementById('presetTime1Minute').value = timePresets[0]?.minute || 0;
            document.getElementById('presetTime2Hour').value = timePresets[1]?.hour || 12;
            document.getElementById('presetTime2Minute').value = timePresets[1]?.minute || 0;
            document.getElementById('presetTime3Hour').value = timePresets[2]?.hour || 18;
            document.getElementById('presetTime3Minute').value = timePresets[2]?.minute || 0;

            document.getElementById('timePresetModal').classList.remove('hidden');
        }

        function closeTimePresetModal() {
            document.getElementById('timePresetModal').classList.add('hidden');
        }

        function saveTimePresets() {
            timePresets = [
                { label: 'Êúù', hour: parseInt(document.getElementById('presetTime1Hour').value), minute: parseInt(document.getElementById('presetTime1Minute').value) },
                { label: 'Êòº', hour: parseInt(document.getElementById('presetTime2Hour').value), minute: parseInt(document.getElementById('presetTime2Minute').value) },
                { label: 'Â§ïÊñπ', hour: parseInt(document.getElementById('presetTime3Hour').value), minute: parseInt(document.getElementById('presetTime3Minute').value) }
            ];
            localStorage.setItem('nextCallTimePresets', JSON.stringify(timePresets));
            renderTimePresetButtons();
            closeTimePresetModal();
            showNotification('‰øùÂ≠òÂÆå‰∫Ü', 'ÊôÇÈñì„Éó„É™„Çª„ÉÉ„Éà„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
        }

        // Êó•‰ªò„Éó„É™„Çª„ÉÉ„ÉàË®≠ÂÆöÔºàÂ∞ÜÊù•Áî®„ÄÅÁèæÂú®„ÅØ„Ç¢„É©„Éº„Éà„ÅßÊ°àÂÜÖÔºâ
        function openDatePresetSettings() {
            showNotification('Ê∫ñÂÇô‰∏≠', 'Êó•‰ªò„Éó„É™„Çª„ÉÉ„ÉàË®≠ÂÆö„ÅØÊ∫ñÂÇô‰∏≠„Åß„Åô');
        }

        // ====================================
        // ÁèæË™øÊó•ÊôÇË®≠ÂÆö„É¢„Éº„ÉÄ„É´Èñ¢ÈÄ£
        // ====================================
        let surveyTargetCvId = null;
        let selectedSurveyDate = null;
        let selectedSurveyHour = null;
        let selectedSurveyMinute = 0;

        function openSurveyDateModal(cvId) {
            const c = findCaseByCvId(cvId);
            if (!c) return;

            surveyTargetCvId = cvId;
            selectedSurveyDate = null;
            selectedSurveyHour = null;
            selectedSurveyMinute = 0;

            // È°ßÂÆ¢Âêç„Å®‰ΩèÊâÄ„ÇíË°®Á§∫
            const customerName = c.customerName || '-';
            const customerKana = c.customerKana || '';
            const nameDisplay = customerKana ? `${customerKana} Êßò` : `${customerName} Êßò`;
            const addressDisplay = c.fullAddress || c.city || '-';

            document.getElementById('surveyTargetName').textContent = nameDisplay;
            document.getElementById('surveyTargetAddress').textContent = addressDisplay;

            // Êó•‰ªò„É©„Éô„É´„ÇíÁîüÊàê
            initSurveyDayLabels();

            // ÈÅ∏ÊäûÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
            resetSurveySelection();

            document.getElementById('surveyDateModal').classList.remove('hidden');
        }

        function closeSurveyDateModal() {
            document.getElementById('surveyDateModal').classList.add('hidden');
            surveyTargetCvId = null;
        }

        // „Ç´„Éº„Éâ/„É™„Çπ„Éà„Åã„ÇâÁõ¥Êé•ÁèæË™ø„É¢„Éº„ÉÄ„É´„ÇíÈñã„ÅèÁî®„Ç®„Ç§„É™„Ç¢„Çπ
        function openSurveyModal(cvId) {
            openSurveyDateModal(cvId);
        }

        function initSurveyDayLabels() {
            const days = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            const today = new Date();
            [0, 1, 2, 3, 4, 5, 6].forEach(offset => {
                const d = new Date(today);
                d.setDate(d.getDate() + offset);
                const label = document.getElementById(`surveyDayLabel${offset}`);
                if (label) {
                    label.textContent = `${d.getMonth() + 1}/${d.getDate()}(${days[d.getDay()]})`;

                    // ÂúüÊó•Á•ù„ÅÆËâ≤ÂàÜ„Åë
                    label.classList.remove('text-blue-600', 'text-red-500');
                    const dayOfWeek = d.getDay();
                    if (dayOfWeek === 0 || isHoliday(d)) {
                        // Êó•Êõú„ÉªÁ•ùÊó• ‚Üí Ëµ§
                        label.classList.add('text-red-500');
                    } else if (dayOfWeek === 6) {
                        // ÂúüÊõú ‚Üí Èùí
                        label.classList.add('text-blue-600');
                    }
                }
            });
        }

        function resetSurveySelection() {
            selectedSurveyDate = null;
            selectedSurveyHour = null;
            selectedSurveyMinute = 0;
            document.querySelectorAll('.survey-day-btn').forEach(btn => {
                btn.classList.remove('border-orange-500', 'bg-orange-100', 'text-orange-800');
                btn.classList.add('border-gray-200', 'text-gray-700');
            });
            document.getElementById('surveyPreview').classList.add('hidden');
            document.getElementById('surveyCustomDatePicker').classList.add('hidden');
            document.getElementById('surveyHour').value = '';
            document.getElementById('surveyMinute').value = '0';
        }

        function setSurveyDay(offset) {
            const today = new Date();
            today.setDate(today.getDate() + offset);
            selectedSurveyDate = today;

            // „Éú„Çø„É≥Áä∂ÊÖãÊõ¥Êñ∞
            document.querySelectorAll('.survey-day-btn').forEach(btn => {
                const btnOffset = btn.getAttribute('data-survey-day');
                if (btnOffset === String(offset)) {
                    btn.classList.add('border-orange-500', 'bg-orange-100', 'text-orange-800');
                    btn.classList.remove('border-gray-200', 'text-gray-700');
                } else {
                    btn.classList.remove('border-orange-500', 'bg-orange-100', 'text-orange-800');
                    btn.classList.add('border-gray-200', 'text-gray-700');
                }
            });

            updateSurveyPreview();
        }

        function onSurveyTimeChange() {
            const hourEl = document.getElementById('surveyHour');
            const minuteEl = document.getElementById('surveyMinute');

            selectedSurveyHour = hourEl.value ? parseInt(hourEl.value) : null;
            selectedSurveyMinute = parseInt(minuteEl.value) || 0;

            updateSurveyPreview();
        }

        function toggleSurveyCustomDatePicker() {
            const picker = document.getElementById('surveyCustomDatePicker');
            picker.classList.toggle('hidden');
            if (!picker.classList.contains('hidden')) {
                const input = document.getElementById('surveyDateInput');
                const today = new Date();
                input.min = today.toISOString().split('T')[0];
                input.value = '';
            }
        }

        function onSurveyDateInputChange() {
            const input = document.getElementById('surveyDateInput');
            if (input.value) {
                selectedSurveyDate = new Date(input.value + 'T00:00:00');
                // „ÇØ„Ç§„ÉÉ„ÇØ„Éú„Çø„É≥„ÅÆÈÅ∏ÊäûËß£Èô§
                document.querySelectorAll('.survey-day-btn').forEach(btn => {
                    btn.classList.remove('border-orange-500', 'bg-orange-100', 'text-orange-800');
                    btn.classList.add('border-gray-200', 'text-gray-700');
                });
                updateSurveyPreview();
            }
        }

        function updateSurveyPreview() {
            selectedSurveyMinute = parseInt(document.getElementById('surveyMinute').value) || 0;

            if (selectedSurveyDate && selectedSurveyHour !== null) {
                const days = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
                const d = selectedSurveyDate;
                const dateStr = `${d.getMonth() + 1}/${d.getDate()}(${days[d.getDay()]})`;
                const timeStr = `${selectedSurveyHour}:${String(selectedSurveyMinute).padStart(2, '0')}`;
                document.getElementById('surveyPreviewText').textContent = `${dateStr} ${timeStr}`;
                document.getElementById('surveyPreview').classList.remove('hidden');
            } else {
                document.getElementById('surveyPreview').classList.add('hidden');
            }
        }

        function skipSurveyDate() {
            // „Çπ„Ç≠„ÉÉ„Éó‚Üí„É°„É¢„É¢„Éº„ÉÄ„É´„Å∏Ôºà„Çπ„Ç≠„ÉÉ„ÉóÂèØËÉΩÔºâ
            closeSurveyDateModal();
            if (surveyTargetCvId) {
                openMemoModalAfterSurvey(surveyTargetCvId);
            }
        }

        function saveSurveyDate() {
            if (!selectedSurveyDate || selectedSurveyHour === null) {
                showNotification('ÂÖ•Âäõ„Ç®„É©„Éº', 'Êó•‰ªò„Å®ÊôÇÈñì„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'warning');
                return;
            }

            const cvId = surveyTargetCvId;
            const c = findCaseByCvId(cvId);
            if (!c) return;

            // Êó•ÊôÇÊñáÂ≠óÂàó„Çí‰ΩúÊàê
            const d = selectedSurveyDate;
            const days = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            const surveyDateTime = `${d.getFullYear()}/${d.getMonth() + 1}/${d.getDate()} ${selectedSurveyHour}:${String(selectedSurveyMinute).padStart(2, '0')}`;
            const surveyDateDisplay = `${d.getMonth() + 1}/${d.getDate()}(${days[d.getDay()]}) ${selectedSurveyHour}:${String(selectedSurveyMinute).padStart(2, '0')}`;

            // Â±•Ê≠¥„Å´ËøΩÂä†
            if (!c.callHistory) {
                c.callHistory = [];
            }
            c.callHistory.unshift({
                date: new Date().toLocaleString('ja-JP'),
                type: 'survey_set',
                note: `üè† ÁèæË™ø‰∫àÂÆö: ${surveyDateDisplay}`
            });

            // „É≠„Éº„Ç´„É´„Éá„Éº„ÇøÊõ¥Êñ∞
            c.surveyDate = surveyDateTime;
            renderCases();

            // „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„ÅßGAS„Å´‰øùÂ≠ò
            const merchantId = window.merchantId || sessionStorage.getItem('currentUser');
            fetch(GAS_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify({
                    system: 'merchant',
                    subsystem: 'contract',
                    action: 'updateSurveyDate',
                    merchantId: merchantId,
                    cvId: cvId,
                    surveyDate: surveyDateTime
                })
            })
            .then(res => res.json())
            .then(result => {
                if (result.success) {
                    console.log('[saveSurveyDate] ‰øùÂ≠òÂÆå‰∫Ü:', surveyDateTime);
                } else {
                    console.error('[saveSurveyDate] ‰øùÂ≠òÂ§±Êïó:', result.error);
                }
            })
            .catch(err => console.error('[saveSurveyDate] ÈÄö‰ø°„Ç®„É©„Éº:', err));

            closeSurveyDateModal();

            // „É°„É¢„É¢„Éº„ÉÄ„É´„Å∏Ôºà„Çπ„Ç≠„ÉÉ„ÉóÂèØËÉΩÔºâ
            openMemoModalAfterSurvey(cvId);
        }

        // ====================================
        // Ë¶ãÁ©çÊèêÂá∫Êó•ÊôÇ„É¢„Éº„ÉÄ„É´Èñ¢ÈÄ£
        // ====================================
        let estimateTargetCvId = null;
        let selectedEstimateDate = null;
        let selectedEstimateHour = null;
        let selectedEstimateMinute = 0;

        function openEstimateDateModal(cvId) {
            const c = findCaseByCvId(cvId);
            if (!c) return;

            estimateTargetCvId = cvId;
            selectedEstimateDate = null;
            selectedEstimateHour = null;
            selectedEstimateMinute = 0;

            // È°ßÂÆ¢Âêç„Å®‰ΩèÊâÄ„ÇíË°®Á§∫
            document.getElementById('estimateTargetName').textContent = `${c.customerName || '-'} Êßò`;
            document.getElementById('estimateTargetAddress').textContent = c.fullAddress || c.city || '-';

            // Êó•‰ªò„É©„Éô„É´Êõ¥Êñ∞
            const days = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            for (let i = 0; i <= 6; i++) {
                const d = new Date();
                d.setDate(d.getDate() + i);
                const label = document.getElementById(`estimateDayLabel${i}`);
                if (label) {
                    label.textContent = `${d.getMonth() + 1}/${d.getDate()}(${days[d.getDay()]})`;
                }
            }

            // „É™„Çª„ÉÉ„Éà
            document.querySelectorAll('.estimate-day-btn').forEach(btn => {
                btn.classList.remove('border-emerald-500', 'bg-emerald-100', 'text-emerald-800');
                btn.classList.add('border-gray-200', 'text-gray-700');
            });
            document.getElementById('estimateHour').value = '';
            document.getElementById('estimateMinute').value = '0';
            document.getElementById('estimatePreview').classList.add('hidden');
            document.getElementById('estimateCustomDatePicker').classList.add('hidden');

            document.getElementById('estimateDateModal').classList.remove('hidden');
        }

        function closeEstimateDateModal() {
            document.getElementById('estimateDateModal').classList.add('hidden');
            estimateTargetCvId = null;
        }

        function setEstimateDay(offset) {
            const today = new Date();
            today.setDate(today.getDate() + offset);
            today.setHours(0, 0, 0, 0);
            selectedEstimateDate = today;

            // „Éú„Çø„É≥Áä∂ÊÖãÊõ¥Êñ∞
            document.querySelectorAll('.estimate-day-btn').forEach(btn => {
                const btnOffset = btn.getAttribute('data-estimate-day');
                if (btnOffset === String(offset)) {
                    btn.classList.add('border-emerald-500', 'bg-emerald-100', 'text-emerald-800');
                    btn.classList.remove('border-gray-200', 'text-gray-700');
                } else {
                    btn.classList.remove('border-emerald-500', 'bg-emerald-100', 'text-emerald-800');
                    btn.classList.add('border-gray-200', 'text-gray-700');
                }
            });

            updateEstimatePreview();
        }

        function onEstimateTimeChange() {
            const hourEl = document.getElementById('estimateHour');
            const minuteEl = document.getElementById('estimateMinute');

            selectedEstimateHour = hourEl.value ? parseInt(hourEl.value) : null;
            selectedEstimateMinute = parseInt(minuteEl.value) || 0;

            updateEstimatePreview();
        }

        function toggleEstimateCustomDatePicker() {
            const picker = document.getElementById('estimateCustomDatePicker');
            picker.classList.toggle('hidden');
            if (!picker.classList.contains('hidden')) {
                const input = document.getElementById('estimateDateInput');
                const today = new Date();
                input.min = today.toISOString().split('T')[0];
                input.value = '';
            }
        }

        function onEstimateDateInputChange() {
            const input = document.getElementById('estimateDateInput');
            if (input.value) {
                selectedEstimateDate = new Date(input.value + 'T00:00:00');
                // „ÇØ„Ç§„ÉÉ„ÇØ„Éú„Çø„É≥„ÅÆÈÅ∏ÊäûËß£Èô§
                document.querySelectorAll('.estimate-day-btn').forEach(btn => {
                    btn.classList.remove('border-emerald-500', 'bg-emerald-100', 'text-emerald-800');
                    btn.classList.add('border-gray-200', 'text-gray-700');
                });
                updateEstimatePreview();
            }
        }

        function updateEstimatePreview() {
            selectedEstimateMinute = parseInt(document.getElementById('estimateMinute').value) || 0;

            if (selectedEstimateDate && selectedEstimateHour !== null) {
                const days = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
                const d = selectedEstimateDate;
                const dateStr = `${d.getMonth() + 1}/${d.getDate()}(${days[d.getDay()]})`;
                const timeStr = `${selectedEstimateHour}:${String(selectedEstimateMinute).padStart(2, '0')}`;
                document.getElementById('estimatePreviewText').textContent = `${dateStr} ${timeStr}`;
                document.getElementById('estimatePreview').classList.remove('hidden');
            } else {
                document.getElementById('estimatePreview').classList.add('hidden');
            }
        }

        function saveEstimateDate() {
            if (!selectedEstimateDate || selectedEstimateHour === null) {
                showNotification('ÂÖ•Âäõ„Ç®„É©„Éº', 'Êó•‰ªò„Å®ÊôÇÈñì„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'warning');
                return;
            }

            const cvId = estimateTargetCvId;
            const c = findCaseByCvId(cvId);
            if (!c) return;

            // Êó•ÊôÇÊñáÂ≠óÂàó„Çí‰ΩúÊàê
            const d = selectedEstimateDate;
            const days = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            const estimateDateTime = `${d.getFullYear()}/${d.getMonth() + 1}/${d.getDate()} ${selectedEstimateHour}:${String(selectedEstimateMinute).padStart(2, '0')}`;
            const estimateDateDisplay = `${d.getMonth() + 1}/${d.getDate()}(${days[d.getDay()]}) ${selectedEstimateHour}:${String(selectedEstimateMinute).padStart(2, '0')}`;

            // Â±•Ê≠¥„Å´ËøΩÂä†
            if (!c.callHistory) {
                c.callHistory = [];
            }
            c.callHistory.unshift({
                date: new Date().toLocaleString('ja-JP'),
                type: 'estimate_set',
                note: `üìã ÂïÜË´á‰∫àÂÆö: ${estimateDateDisplay}`
            });

            // „É≠„Éº„Ç´„É´„Éá„Éº„ÇøÊõ¥Êñ∞
            c.estimateDate = estimateDateTime;
            renderCases();

            // „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„ÅßGAS„Å´‰øùÂ≠ò
            const merchantId = window.merchantId || sessionStorage.getItem('currentUser');
            fetch(GAS_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify({
                    system: 'merchant',
                    subsystem: 'contract',
                    action: 'updateEstimateDate',
                    merchantId: merchantId,
                    cvId: cvId,
                    estimateDate: estimateDateTime
                })
            })
            .then(res => res.json())
            .then(result => {
                if (result.success) {
                    console.log('[saveEstimateDate] ‰øùÂ≠òÂÆå‰∫Ü:', estimateDateTime);
                } else {
                    console.error('[saveEstimateDate] ‰øùÂ≠òÂ§±Êïó:', result.error);
                }
            })
            .catch(err => console.error('[saveEstimateDate] ÈÄö‰ø°„Ç®„É©„Éº:', err));

            closeEstimateDateModal();

            // „É°„É¢„É¢„Éº„ÉÄ„É´„Å∏Ôºà„Çπ„Ç≠„ÉÉ„ÉóÂèØËÉΩÔºâ
            openMemoModalAfterEstimate(cvId);
        }

        // Ë¶ãÁ©çÊèêÂá∫Êó•ÊôÇË®≠ÂÆöÂæå„ÅÆ„É°„É¢„É¢„Éº„ÉÄ„É´Ôºà„Çπ„Ç≠„ÉÉ„ÉóÂèØËÉΩÔºâ
        function openMemoModalAfterEstimate(cvId) {
            const c = findCaseByCvId(cvId);
            if (!c) return;

            currentMemoCase = c;
            isAfterCallMode = false;

            document.getElementById('memoTargetName').textContent = `${c.customerName || '-'} Êßò`;
            document.getElementById('memoTargetAddress').textContent = c.fullAddress || c.city || '-';
            document.getElementById('caseMemoTextarea').value = '';

            showMemoQuickOptions(c.detailStatus);

            document.getElementById('caseMemoModal').classList.remove('hidden');
            loadMemoHistory();
        }

        // ÁèæË™øÊó•ÊôÇË®≠ÂÆöÂæå„ÅÆ„É°„É¢„É¢„Éº„ÉÄ„É´
        function openMemoModalAfterSurvey(cvId) {
            const c = findCaseByCvId(cvId);
            if (!c) return;

            currentMemoCase = c;
            isAfterCallMode = false; // ÈÄöË©±„Éï„É≠„ÉºÁµÇ‰∫Ü

            document.getElementById('memoTargetName').textContent = `${c.customerName || '-'} Êßò`;
            document.getElementById('memoTargetAddress').textContent = c.fullAddress || c.city || '-';
            document.getElementById('caseMemoTextarea').value = '';

            // „ÇØ„Ç§„ÉÉ„ÇØÈÅ∏ÊäûËÇ¢„ÇíË°®Á§∫
            showMemoQuickOptions(c.detailStatus);

            document.getElementById('caseMemoModal').classList.remove('hidden');
            loadMemoHistory();
        }

        // ====================================
        // „É°„É¢„É¢„Éº„ÉÄ„É´ „ÇØ„Ç§„ÉÉ„ÇØÈÅ∏ÊäûËÇ¢
        // ====================================
        const memoQuickOptionsConfig = {
            'Êú™„Ç¢„Éù': [
                { emoji: '‚è≥', label: 'Êó•Á®ãË™øÊï¥‰∏≠', action: 'memo' }
            ],
            '„Ç¢„ÉùÊ∏à': [
                { emoji: 'üìÖ', label: 'ÁèæË™øÊó•Á¢∫ÂÆö', action: 'memo' }
            ],
            'ÁèæË™øÊ∏à': [
                { emoji: 'üìã', label: 'ÂïÜË´á„Ç¢„ÉùÊ∏à', action: 'estimate' },
                { emoji: 'üìù', label: 'Ë¶ãÁ©ç‰ΩúÊàê‰∏≠', action: 'memo' }
            ],
            'Ë¶ãÁ©çÊèêÂá∫Ê∏à': [
                { emoji: 'üî•', label: 'Ê∏©Â∫¶È´ò', action: 'memo' },
                { emoji: 'üòê', label: 'Ê∏©Â∫¶‰∏≠', action: 'memo' },
                { emoji: '‚ùÑÔ∏è', label: 'Ê∏©Â∫¶‰Ωé', action: 'memo' },
                { emoji: 'üè†', label: '‰ªñÁ§æË¶ãÁ©çÂæÖ„Å°', action: 'memo' }
            ]
        };

        function showMemoQuickOptions(status) {
            // Êó¢Â≠ò„ÅÆ„ÇØ„Ç§„ÉÉ„ÇØÈÅ∏ÊäûËÇ¢„ÇíÂâäÈô§
            const existingContainer = document.getElementById('memoQuickOptionsContainer');
            if (existingContainer) existingContainer.remove();

            const options = memoQuickOptionsConfig[status];
            if (!options || options.length === 0) return;

            const memoInputArea = document.querySelector('#caseMemoModal .bg-amber-50');
            if (!memoInputArea) return;

            const container = document.createElement('div');
            container.id = 'memoQuickOptionsContainer';
            container.className = 'mt-3 pt-3 border-t border-amber-200';
            container.innerHTML = `
                <div class="text-xs text-amber-600 font-medium mb-2">üìå ÈÄ≤Êçó„ÇØ„Ç§„ÉÉ„ÇØÂÖ•Âäõ</div>
                <div class="flex flex-wrap gap-2">
                    ${options.map(opt => `
                        <button onclick="selectMemoQuickOption('${opt.emoji}', '${opt.label}', '${opt.action}')"
                            class="px-3 py-1.5 bg-white border border-amber-300 rounded-lg text-sm font-medium text-amber-700 hover:bg-amber-100 hover:border-amber-400 transition-all">
                            ${opt.emoji} ${opt.label}
                        </button>
                    `).join('')}
                </div>
            `;

            memoInputArea.appendChild(container);
        }

        function selectMemoQuickOption(emoji, label, action) {
            if (!currentMemoCase) return;

            const cvId = currentMemoCase.cvId;
            const c = currentMemoCase;
            const memoText = `${emoji} ${label}`;

            // Â±•Ê≠¥„Å´ËøΩÂä†
            if (!c.callHistory) {
                c.callHistory = [];
            }
            c.callHistory.unshift({
                date: new Date().toLocaleString('ja-JP'),
                type: 'quick_progress',
                note: memoText
            });

            // GAS„Å´‰øùÂ≠ò
            const merchantId = window.merchantId || sessionStorage.getItem('currentUser');
            fetch(GAS_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify({
                    system: 'merchant',
                    subsystem: 'contract',
                    action: 'addCaseMemo',
                    merchantId: merchantId,
                    cvId: cvId,
                    memo: memoText
                })
            })
            .then(res => res.json())
            .then(result => {
                if (result.success) {
                    console.log('[selectMemoQuickOption] ‰øùÂ≠òÂÆå‰∫Ü:', memoText);
                } else {
                    console.error('[selectMemoQuickOption] ‰øùÂ≠òÂ§±Êïó:', result.error);
                }
            })
            .catch(err => console.error('[selectMemoQuickOption] ÈÄö‰ø°„Ç®„É©„Éº:', err));

            // ÂïÜË´á„Ç¢„ÉùÊ∏à„ÅÆÂ†¥Âêà„ÅØË¶ãÁ©çÊèêÂá∫Êó•ÊôÇ„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
            if (action === 'estimate') {
                closeMemoModal();
                openEstimateDateModal(cvId);
            } else {
                // „É°„É¢„Å®„Åó„Å¶‰øùÂ≠ò„Åó„Å¶„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
                closeMemoModal();
                renderCases();
                showNotification('‰øùÂ≠òÂÆå‰∫Ü', 'ÈÄ≤Êçó„ÇíË®òÈå≤„Åó„Åæ„Åó„Åü');
            }
        }

        function openNextCallModal(cvId) {
            const c = findCaseByCvId(cvId);
            if (!c) return;

            nextCallTargetCvId = cvId;
            selectedNextCallDate = null;
            selectedNextCallHour = null;
            selectedNextCallMinute = 0;

            // È°ßÂÆ¢ÂêçÔºà„Ç´„ÉäÔºãÊßòÔºâ„Å®‰ΩèÊâÄ„ÇíÂàÜ„Åë„Å¶Ë°®Á§∫
            const customerName = c.customerName || '-';
            const customerKana = c.customerKana || '';
            const nameDisplay = customerKana ? `${customerKana} Êßò` : `${customerName} Êßò`;
            const addressDisplay = c.fullAddress || c.city || '-';

            document.getElementById('nextCallTargetName').textContent = nameDisplay;
            document.getElementById('nextCallTargetAddress').textContent = addressDisplay;

            // Êó•‰ªò„É©„Éô„É´„ÇíÂãïÁöÑÁîüÊàê
            initDayLabels();

            // ÊôÇÈñì„Éó„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥„ÇíÁîüÊàê
            renderTimePresetButtons();

            // Êó¢Â≠ò„ÅÆÊó•‰ªò„ÉªÊôÇÈñì„Åå„ÅÇ„Çå„Å∞„Çª„ÉÉ„Éà
            if (c.nextCallDate) {
                document.getElementById('nextCallDateInput').value = c.nextCallDate;
                selectedNextCallDate = c.nextCallDate;
                // ÊôÇÈñì„ÇÇÂèñÂæóÔºànextCallDateTime„Åå„ÅÇ„Çå„Å∞Ôºâ
                if (c.nextCallDateTime) {
                    const timePart = c.nextCallDateTime.split(' ')[1];
                    if (timePart) {
                        const [h, m] = timePart.split(':');
                        selectedNextCallHour = parseInt(h);
                        // 10ÂàÜÂàª„Åø„Å´‰∏∏„ÇÅ„Çã
                        selectedNextCallMinute = Math.round(parseInt(m) / 10) * 10;
                        if (selectedNextCallMinute >= 60) selectedNextCallMinute = 50;
                        document.getElementById('nextCallHour').value = selectedNextCallHour;
                        document.getElementById('nextCallMinute').value = selectedNextCallMinute;
                    }
                }
            } else {
                document.getElementById('nextCallDateInput').value = '';
                document.getElementById('nextCallHour').value = '';
                document.getElementById('nextCallMinute').value = '0';
            }

            // „Ç´„Çπ„Çø„É†„Éî„ÉÉ„Ç´„Éº„ÇíÈö†„Åô
            document.getElementById('customDatePicker').classList.add('hidden');
            document.getElementById('customTimePicker').classList.add('hidden');

            // ÈÅ∏ÊäûÁä∂ÊÖã„Çí„ÇØ„É™„Ç¢
            clearDaySelection();
            clearTimeSelection();

            // „Éó„É¨„Éì„É•„ÉºÊõ¥Êñ∞
            updateNextCallPreview();

            document.getElementById('nextCallModal').classList.remove('hidden');
        }

        // Á•ùÊó•„É™„Çπ„ÉàÔºàÁ∞°ÊòìÁâà„ÄÅÂπ¥„Çí„Åæ„Åü„ÅêÂ†¥Âêà„ÅØÈÉΩÂ∫¶Êõ¥Êñ∞„ÅåÂøÖË¶ÅÔºâ
        const HOLIDAYS_2024_2025 = [
            '2024-01-01', '2024-01-08', '2024-02-11', '2024-02-12', '2024-02-23',
            '2024-03-20', '2024-04-29', '2024-05-03', '2024-05-04', '2024-05-05', '2024-05-06',
            '2024-07-15', '2024-08-11', '2024-08-12', '2024-09-16', '2024-09-22', '2024-09-23',
            '2024-10-14', '2024-11-03', '2024-11-04', '2024-11-23',
            '2025-01-01', '2025-01-13', '2025-02-11', '2025-02-23', '2025-02-24',
            '2025-03-20', '2025-04-29', '2025-05-03', '2025-05-04', '2025-05-05', '2025-05-06',
            '2025-07-21', '2025-08-11', '2025-09-15', '2025-09-23',
            '2025-10-13', '2025-11-03', '2025-11-23', '2025-11-24'
        ];

        function isHoliday(date) {
            const yyyy = date.getFullYear();
            const mm = String(date.getMonth() + 1).padStart(2, '0');
            const dd = String(date.getDate()).padStart(2, '0');
            return HOLIDAYS_2024_2025.includes(`${yyyy}-${mm}-${dd}`);
        }

        function initDayLabels() {
            const dayOffsets = [0, 1, 2, 3, 4, 7, 14];
            const dayNames = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];

            dayOffsets.forEach(offset => {
                const labelEl = document.getElementById(`dayLabel${offset}`);
                const btn = document.querySelector(`.next-call-day-btn[data-day="${offset}"]`);
                if (labelEl) {
                    const date = new Date();
                    date.setDate(date.getDate() + offset);
                    const m = date.getMonth() + 1;
                    const d = date.getDate();
                    const dayOfWeek = date.getDay();
                    const dayName = dayNames[dayOfWeek];
                    labelEl.textContent = `${m}/${d}(${dayName})`;

                    // ÂúüÊó•Á•ù„ÅÆËâ≤ÂàÜ„Åë
                    if (btn) {
                        // ‰∏ÄÊó¶„É™„Çª„ÉÉ„Éà
                        btn.classList.remove('text-blue-600', 'text-red-500');
                        labelEl.classList.remove('text-blue-600', 'text-red-500');

                        if (dayOfWeek === 0 || isHoliday(date)) {
                            // Êó•Êõú„ÉªÁ•ùÊó• ‚Üí Ëµ§
                            labelEl.classList.add('text-red-500');
                        } else if (dayOfWeek === 6) {
                            // ÂúüÊõú ‚Üí Èùí
                            labelEl.classList.add('text-blue-600');
                        }
                    }
                }
            });
        }

        function setNextCallDay(daysFromNow) {
            const date = new Date();
            date.setDate(date.getDate() + daysFromNow);
            const yyyy = date.getFullYear();
            const mm = String(date.getMonth() + 1).padStart(2, '0');
            const dd = String(date.getDate()).padStart(2, '0');
            selectedNextCallDate = `${yyyy}-${mm}-${dd}`;
            document.getElementById('nextCallDateInput').value = selectedNextCallDate;

            // „Éú„Çø„É≥„ÅÆÈÅ∏ÊäûÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            clearDaySelection();
            const btn = document.querySelector(`.next-call-day-btn[data-day="${daysFromNow}"]`);
            if (btn) {
                btn.classList.remove('border-gray-200', 'bg-white');
                btn.classList.add('border-blue-500', 'bg-blue-50', 'ring-2', 'ring-blue-200');
            }

            updateNextCallPreview();
        }

        function clearDaySelection() {
            document.querySelectorAll('.next-call-day-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'bg-blue-50', 'ring-2', 'ring-blue-200');
                btn.classList.add('border-gray-200', 'bg-white');
            });
        }

        function toggleCustomDatePicker() {
            const picker = document.getElementById('customDatePicker');
            picker.classList.toggle('hidden');
            if (!picker.classList.contains('hidden')) {
                document.getElementById('nextCallDateInput').focus();
            }
        }

        // „Ç´„Çπ„Çø„É†Êó•‰ªòÂÖ•ÂäõÊôÇ
        document.addEventListener('DOMContentLoaded', () => {
            const dateInput = document.getElementById('nextCallDateInput');
            if (dateInput) {
                dateInput.addEventListener('change', (e) => {
                    selectedNextCallDate = e.target.value;
                    clearDaySelection();
                    updateNextCallPreview();
                });
            }
        });

        function setNextCallTimePreset(hour, minute) {
            selectedNextCallHour = hour;
            selectedNextCallMinute = minute;
            document.getElementById('nextCallHour').value = hour;
            document.getElementById('nextCallMinute').value = minute;

            // „Éú„Çø„É≥„ÅÆÈÅ∏ÊäûÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            clearTimeSelection();
            const btn = document.querySelector(`.next-call-time-btn[data-hour="${hour}"][data-minute="${minute}"]`);
            if (btn) {
                btn.classList.remove('border-gray-200', 'bg-white');
                btn.classList.add('border-blue-500', 'bg-blue-50', 'ring-2', 'ring-blue-200');
            }

            updateNextCallPreview();
        }

        function clearTimeSelection() {
            document.querySelectorAll('.next-call-time-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'bg-blue-50', 'ring-2', 'ring-blue-200');
                btn.classList.add('border-gray-200', 'bg-white');
            });
        }

        function updateNextCallTimeDisplay() {
            const hour = document.getElementById('nextCallHour').value;
            const minute = document.getElementById('nextCallMinute').value;
            if (hour) {
                selectedNextCallHour = parseInt(hour);
                selectedNextCallMinute = parseInt(minute);
                clearTimeSelection();
            }
            updateNextCallPreview();
        }

        function updateNextCallPreview() {
            const preview = document.getElementById('nextCallPreview');
            const previewText = document.getElementById('nextCallPreviewText');

            if (!selectedNextCallDate) {
                preview.classList.add('hidden');
                return;
            }

            const date = new Date(selectedNextCallDate);
            const dayNames = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            const m = date.getMonth() + 1;
            const d = date.getDate();
            const dayName = dayNames[date.getDay()];

            let text = `${m}/${d}(${dayName})`;
            if (selectedNextCallHour !== null) {
                const min = String(selectedNextCallMinute).padStart(2, '0');
                text += ` ${selectedNextCallHour}:${min}`;
            }

            previewText.textContent = text;
            preview.classList.remove('hidden');
        }

        function closeNextCallModal() {
            document.getElementById('nextCallModal').classList.add('hidden');
            nextCallTargetCvId = null;
            selectedNextCallDate = null;
            selectedNextCallHour = null;
            selectedNextCallMinute = 0;
        }

        async function saveNextCallDate() {
            if (!nextCallTargetCvId) return;

            const dateValue = selectedNextCallDate || document.getElementById('nextCallDateInput').value;
            if (!dateValue) {
                showNotification('„Ç®„É©„Éº', 'Êó•‰ªò„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            // ÊôÇÈñì„ÅåÊú™ÈÅ∏Êäû„ÅÆÂ†¥Âêà
            if (selectedNextCallHour === null) {
                showNotification('„Ç®„É©„Éº', 'ÊôÇÈñìÂ∏Ø„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            // Êó•ÊôÇ„ÇíÁµÑ„ÅøÁ´ã„Å¶ÔºàÊôÇ„ÅØ„Çº„É≠Âüã„ÇÅ„Å™„Åó„ÄÅÂàÜ„ÅØ„Çº„É≠Âüã„ÇÅÔºâ
            let dateTimeValue = dateValue;
            if (selectedNextCallHour !== null) {
                const m = String(selectedNextCallMinute).padStart(2, '0');
                dateTimeValue = `${dateValue} ${selectedNextCallHour}:${m}`;
            }

            // ÈÅéÂéªÊó•ÊôÇ„ÉÅ„Çß„ÉÉ„ÇØ
            const selectedDateTime = new Date(`${dateValue}T${String(selectedNextCallHour).padStart(2, '0')}:${String(selectedNextCallMinute).padStart(2, '0')}:00`);
            const now = new Date();
            if (selectedDateTime < now) {
                showNotification('„ÅäÁü•„Çâ„Åõ', 'ÁèæÂú®„Çà„ÇäÂÖà„ÅÆÊó•ÊôÇ„ÅßË®≠ÂÆö„Åó„Å¶‰∏ã„Åï„ÅÑ', 'warning');
                return;
            }

            // Êó•‰ªòË°®Á§∫Áî®„Éï„Ç©„Éº„Éû„ÉÉ„ÉàÔºàÊôÇ„ÅØ„Çº„É≠Âüã„ÇÅ„Å™„Åó„ÄÅÂàÜ„ÅØ„Çº„É≠Âüã„ÇÅÔºâ
            const d = new Date(dateValue);
            const days = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            const m = String(selectedNextCallMinute).padStart(2, '0');
            const nextCallDisplay = `${d.getMonth() + 1}/${d.getDate()}(${days[d.getDay()]}) ${selectedNextCallHour}:${m}`;

            // Âç≥Èñâ„ÅòÔºã„Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ‰øùÂ≠ò
            const saveCvId = nextCallTargetCvId;
            const caseData = merchantCasesData.find(c => String(c.cvId) === String(saveCvId));
            if (caseData) {
                caseData.nextCallDate = dateTimeValue;
                // Â±•Ê≠¥„Å´ËøΩÂä†
                if (!caseData.callHistory) {
                    caseData.callHistory = [];
                }
                caseData.callHistory.unshift({
                    date: new Date().toLocaleString('ja-JP'),
                    type: 'next_call_set',
                    note: `üìÖ Ê¨°ÂõûÊû∂Èõª: ${nextCallDisplay}`
                });
            }
            renderCases();
            closeNextCallModal();

            // „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„Åß‰øùÂ≠ò
            const merchantId = window.merchantId || sessionStorage.getItem('currentUser');
            fetch(window.ENV.GAS_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain'
                },
                body: JSON.stringify({
                    action: 'updateNextCallDate',
                    merchantId: merchantId,
                    cvId: saveCvId,
                    nextCallDate: dateTimeValue
                })
            })
            .then(response => response.json())
            .then(result => {
                console.log('[Ê¨°ÂõûÊû∂Èõª] ‰øùÂ≠òÁµêÊûú:', result);
                if (result.success) {
                    showNotification('‰øùÂ≠òÂÆå‰∫Ü', 'Ê¨°ÂõûÊû∂ÈõªÊó•„ÇíË®≠ÂÆö„Åó„Åæ„Åó„Åü');
                } else {
                    // Â§±ÊïóÊôÇ„ÅØ„Éá„Éº„Çø„ÇíÂÖÉ„Å´Êàª„Åó„Å¶ÂÜçÊèèÁîª
                    console.error('[Ê¨°ÂõûÊû∂Èõª] ‰øùÂ≠òÂ§±Êïó:', result.error);
                    if (caseData) {
                        caseData.nextCallDate = '';
                    }
                    renderCases();
                    showNotification('„Ç®„É©„Éº', result.error || '‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                }
            })
            .catch(error => {
                console.error('[Ê¨°ÂõûÊû∂Èõª] ÈÄö‰ø°„Ç®„É©„Éº:', error);
                if (caseData) {
                    caseData.nextCallDate = '';
                }
                renderCases();
                showNotification('„Ç®„É©„Éº', 'ÈÄö‰ø°„Ç®„É©„Éº: ' + error.message, 'error');
            });
        }

        async function clearNextCallDate() {
            if (!nextCallTargetCvId) return;

            // Âç≥Èñâ„ÅòÔºã„Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ‰øùÂ≠ò
            const saveCvId = nextCallTargetCvId;
            const caseData = merchantCasesData.find(c => String(c.cvId) === String(saveCvId));
            const oldValue = caseData ? caseData.nextCallDate : '';
            if (caseData) {
                caseData.nextCallDate = '';
            }
            renderCases();
            closeNextCallModal();

            // „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„Åß‰øùÂ≠ò
            fetch(window.ENV.GAS_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain'
                },
                body: JSON.stringify({
                    action: 'updateNextCallDate',
                    cvId: saveCvId,
                    nextCallDate: ''
                })
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    showNotification('ÂÆå‰∫Ü', 'Ê¨°ÂõûÊû∂ÈõªÊó•„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü');
                } else {
                    // Â§±ÊïóÊôÇ„ÅØ„Éá„Éº„Çø„ÇíÂÖÉ„Å´Êàª„Åó„Å¶ÂÜçÊèèÁîª
                    if (caseData) {
                        caseData.nextCallDate = oldValue;
                    }
                    renderCases();
                    showNotification('„Ç®„É©„Éº', '„ÇØ„É™„Ç¢„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                }
            })
            .catch(error => {
                console.error('Ê¨°ÂõûÊû∂ÈõªÊó•„ÇØ„É™„Ç¢„Ç®„É©„Éº:', error);
                if (caseData) {
                    caseData.nextCallDate = oldValue;
                }
                renderCases();
                showNotification('„Ç®„É©„Éº', 'ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
            });
        }

        // Ê°à‰ª∂„Éá„Éº„Çø„ÇíÂèñÂæó„Åô„ÇãÈñ¢Êï∞Ôºà‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅÊÆã„ÅôÔºâ
        function getCasesData() {
            return merchantCasesData;
        }

        // Âä†ÁõüÂ∫ó„Éá„Éº„Çø„Çí„Éï„Ç©„Éº„É†„Å´Ëá™ÂãïÂÖ•Âäõ„Åô„ÇãÈñ¢Êï∞
        function loadMerchantData(merchantId, merchantData = null) {
            const data = merchantData || window.merchantData;
            if (!data) {
                return;
            }

            // ÁîªÂÉè„Éá„Éº„Çø„ÇíÂàùÊúüÂåñÔºàÂè§„ÅÑ„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢Ôºâ
            mainVisualUrl = '';
            const mainVisualImage = document.getElementById('mainVisualImage');
            const mainVisualPreview = document.getElementById('mainVisualPreview');
            const mainVisualPlaceholder = document.getElementById('mainVisualPlaceholder');
            const previewMainVisual = document.getElementById('previewMainVisual');

            if (mainVisualImage) mainVisualImage.src = '';
            if (previewMainVisual) previewMainVisual.src = '';
            if (mainVisualPreview) mainVisualPreview.classList.add('hidden');
            if (mainVisualPlaceholder) mainVisualPlaceholder.classList.remove('hidden');

            // ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„ÇÇ„ÇØ„É™„Ç¢
            const galleryList = document.getElementById('photoGalleryList');
            if (galleryList) {
                const addButton = galleryList.querySelector('.border-dashed');
                galleryList.innerHTML = '';
                if (addButton) galleryList.appendChild(addButton);
            }
            galleryImages = [];
            window.galleryImages = [];  // window„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Å´„ÇÇÂàùÊúüÂåñ

            // „Çπ„ÉÜ„Éº„Çø„Çπ„Çí„Éò„ÉÉ„ÉÄ„Éº„Å´ÂèçÊò†ÔºàAJÂàó„ÅÆÂÄ§„ÇíÂãïÁöÑ„Å´Ë°®Á§∫Ôºâ
            if (data['„Çπ„ÉÜ„Éº„Çø„Çπ']) {
                updateHeaderStatus(data['„Çπ„ÉÜ„Éº„Çø„Çπ']);
            }

            // Ë®≠Á´ãÂπ¥Êúà„Å®PR„ÉÜ„Ç≠„Çπ„Éà„ÅÆÁõ¥Êé•ÂèñÂæóÔºà„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆÂàóÂêç„ÅßÂèñÂæóÔºâ
            if (data['Ë®≠Á´ãÂπ¥Êúà']) {
                const establishedEl = document.getElementById('established');
                if (establishedEl) {
                    const establishedValue = formatEstablishedDate(data['Ë®≠Á´ãÂπ¥Êúà']);
                    establishedEl.value = establishedValue;
                    console.log(`‚úì Ë®≠Á´ãÂπ¥Êúà„ÇíË®≠ÂÆö: ${establishedValue}`);
                }
            }

            if (data['PR„ÉÜ„Ç≠„Çπ„Éà']) {
                const prTextEl = document.getElementById('prText');
                if (prTextEl) {
                    prTextEl.value = data['PR„ÉÜ„Ç≠„Çπ„Éà'];
                    console.log(`‚úì PRÊñá„ÇíË®≠ÂÆö: [${data['PR„ÉÜ„Ç≠„Çπ„Éà'].length}ÊñáÂ≠ó]`);
                    console.log(`  ÂÆåÂÖ®„Å™PRÊñá: ${data['PR„ÉÜ„Ç≠„Çπ„Éà']}`);

                    // „ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„ÅÆÈ´ò„Åï„ÇíËá™ÂãïË™øÊï¥
                    prTextEl.style.height = 'auto';
                    prTextEl.style.height = Math.max(200, prTextEl.scrollHeight) + 'px';

                    // ÊñáÂ≠óÊï∞„Ç´„Ç¶„É≥„Çø„ÉºÊõ¥Êñ∞
                    const charCount = document.getElementById('prTextCharCount');
                    if (charCount) {
                        charCount.textContent = data['PR„ÉÜ„Ç≠„Çπ„Éà'].length;
                    }

                    // „Éó„É¨„Éì„É•„Éº„Å´„ÇÇÂèçÊò†
                    const previewPrTextEl = document.getElementById('previewPrText');
                    if (previewPrTextEl) {
                        previewPrTextEl.textContent = data['PR„ÉÜ„Ç≠„Çπ„Éà'];
                        console.log('‚úì PRÊñá„Çí„Éó„É¨„Éì„É•„Éº„Å´ÂèçÊò†');
                    }

                    // „Ç≠„É£„ÉÉ„ÉÅ„Éï„É¨„Éº„Ç∫„ÇíPRÊñá„ÅÆÊúÄÂàù„ÅÆ‰∏ÄÊñá„Åã„ÇâÊäΩÂá∫
                    const firstSentence = data['PR„ÉÜ„Ç≠„Çπ„Éà'].split('„ÄÇ')[0];
                    const tagline = firstSentence || '‰ø°È†º„Å®ÂÆüÁ∏æ„ÅÆÂ§ñÂ£ÅÂ°óË£ÖÂ∞ÇÈñÄÂ∫ó';

                    const taglineElements = ['previewTagline', 'previewTaglineHero', 'previewTaglineOverlay'];
                    taglineElements.forEach(id => {
                        const el = document.getElementById(id);
                        if (el) el.textContent = tagline;
                    });
                    console.log('‚úì „Ç≠„É£„ÉÉ„ÉÅ„Éï„É¨„Éº„Ç∫„Çí„Éó„É¨„Éì„É•„Éº„Å´ÂèçÊò†:', tagline.substring(0, 30));
                }
            }

            // ‰ºöÁ§æÊÉÖÂ†±„Éï„Ç©„Éº„É†„Éï„Ç£„Éº„É´„Éâ„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞Ôºà„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆÂàóÂêç„Å´ÂÆåÂÖ®ÂØæÂøúÔºâ
            const fieldMappings = {
                companyName: ['‰ºöÁ§æÂêç', 'companyName', 'company_name'],
                companyNameKana: ['‰ºöÁ§æÂêç„Ç´„Éä', 'companyNameKana', 'company_name_kana'],
                tradeName: ['Â±ãÂè∑', 'tradeName', 'trade_name'],
                tradeNameKana: ['Â±ãÂè∑„Ç´„Éä', 'tradeNameKana', 'trade_name_kana'],
                representative: ['‰ª£Ë°®ËÄÖÂêç', 'representative', 'representative_name'],
                representativeKana: ['‰ª£Ë°®ËÄÖÂêç„Ç´„Éä', 'representativeKana', 'representative_kana'],
                zipCode: ['ÈÉµ‰æøÁï™Âè∑', 'postalCode', 'zipCode', 'postal_code'],
                address: ['‰ΩèÊâÄ', 'address'],
                phone: ['ÈõªË©±Áï™Âè∑', 'phone', 'tel'],
                website: ['„Ç¶„Çß„Éñ„Çµ„Ç§„ÉàURL', 'website', 'url'],
                established: ['Ë®≠Á´ãÂπ¥Êúà', 'established', 'establishment_date'],
                prText: ['PR„ÉÜ„Ç≠„Çπ„Éà', 'prText', 'pr_text'],
                billingEmail: ['Ë´ãÊ±ÇÁî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ', 'billingEmail', 'billing_email'],
                salesEmail: ['Âñ∂Ê•≠Áî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ', 'salesEmail', 'sales_email'],
                salesPersonName: ['Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç', 'salesPersonName', 'sales_person_name'],
                salesPersonKana: ['Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„Ç´„Éä', 'salesPersonKana', 'sales_person_kana'],
                employees: ['ÂæìÊ•≠Âì°Êï∞', 'employees', 'employee_count'],
                salesScale: ['Â£≤‰∏äË¶èÊ®°', 'salesScale', 'sales_scale'],
                maxFloors: ['ÊúÄÂ§ßÂØæÂøúÈöéÊï∞', 'maxFloors', 'max_floors'],
                ageRange: ['ÁØâÂπ¥Êï∞ÂØæÂøúÁØÑÂõ≤', 'ageRange', 'building_age'],
                specialItems: ['ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ', 'specialItems', 'special_items'],
                cities: ['ÂØæÂøúÂ∏ÇÂå∫Áî∫Êùë', 'cities', 'service_areas'],
                priorities: ['ÂÑ™ÂÖà„Ç®„É™„Ç¢', 'priorities', 'priority_areas']
            };

            // „Éï„Ç£„Éº„É´„Éâ„Å´ÂÄ§„ÇíË®≠ÂÆö
            Object.keys(fieldMappings).forEach(fieldId => {
                const possibleKeys = fieldMappings[fieldId];
                let value = null;

                // „Éá„Éº„Çø„Åã„ÇâÂÄ§„ÇíÊ§úÁ¥¢
                for (const key of possibleKeys) {
                    if (data[key] !== undefined && data[key] !== null && data[key] !== '') {
                        value = data[key];
                        break;
                    }
                }

                const element = document.getElementById(fieldId) ||
                               document.querySelector(`input[placeholder*="${fieldId}"]`) ||
                               document.querySelector(`input[name="${fieldId}"]`);

                if (element && value) {
                    // PRÊñá„ÅÆÁâπÂà•„Å™Âá¶ÁêÜÔºàÁúÅÁï•„Åï„Çå„ÅüÈÉ®ÂàÜ„ÇÇÂê´„ÇÅ„Å¶ÂÆåÂÖ®„Å´ÂèñÂæóÔºâ
                    if (fieldId === 'prText') {
                        // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅßÁúÅÁï•„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅÂÆåÂÖ®„Å™„ÉÜ„Ç≠„Çπ„Éà„ÇíÂèñÂæó
                        let fullText = value;

                        // "..."„ÅßÁµÇ„Çè„Å£„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅÂÆåÂÖ®„Å™„ÉÜ„Ç≠„Çπ„Éà„Åå„ÅÇ„Çã„ÅØ„Åö„Å™„ÅÆ„ÅßÊé¢„Åô
                        if (value && value.endsWith('...')) {
                            // PR„ÉÜ„Ç≠„Çπ„ÉàÂàó„ÅÆÂÆåÂÖ®„Å™„Éá„Éº„Çø„ÇíÂèñÂæó
                            const fullPrText = data['PR„ÉÜ„Ç≠„Çπ„Éà'] || data.prText || data.pr_text;
                            if (fullPrText) {
                                fullText = fullPrText;
                                console.log('‚úì PRÊñá„ÅÆÂÆåÂÖ®Áâà„ÇíÂèñÂæó„Åó„Åæ„Åó„Åü');
                            }
                        }

                        element.value = fullText;
                        console.log(`‚úì Set ${fieldId} = [${fullText.length}ÊñáÂ≠ó]`);
                        console.log(`  ÂÆåÂÖ®„Å™PRÊñá: ${fullText}`);

                        // „ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„ÅÆÈ´ò„Åï„ÇíËá™ÂãïË™øÊï¥
                        element.style.height = 'auto';
                        element.style.height = Math.max(200, element.scrollHeight) + 'px';

                        // ÊñáÂ≠óÊï∞„Ç´„Ç¶„É≥„Çø„Éº„ÇÇÊõ¥Êñ∞
                        const charCount = document.getElementById('prTextCharCount');
                        if (charCount) {
                            charCount.textContent = fullText.length;
                        }
                    } else if (fieldId === 'established') {
                        // Ë®≠Á´ãÂπ¥Êúà„ÇíÂèñÂæóÔºàÂÖ±ÈÄöÈñ¢Êï∞„ÅßÂ§âÊèõÔºâ
                        const establishedData = data['Ë®≠Á´ãÂπ¥Êúà'] || data.established || data['establishment_date'];
                        if (establishedData) {
                            const formattedValue = formatEstablishedDate(establishedData);
                            element.value = formattedValue;
                            console.log(`‚úì Set ${fieldId} = ${formattedValue} (Â§âÊèõÊ∏à„Åø)`);
                        } else if (value) {
                            element.value = value;
                            console.log(`‚úì Set ${fieldId} = ${value} („Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ)`);
                        }
                    } else if (fieldId === 'employees' || fieldId === 'salesScale') {
                        // selectË¶ÅÁ¥†„ÅÆÂ†¥Âêà„ÅØ„ÄÅoption„ÇíÈÅ∏Êäû
                        if (element.tagName === 'SELECT') {
                            // ÂÄ§„ÇíÊ≠£Ë¶èÂåñÔºàÂâçÂæå„ÅÆÁ©∫ÁôΩ„ÇíÂâäÈô§„ÄÅÂÖ®ËßíËã±Êï∞Â≠ó„ÇíÂçäËßí„Å´Â§âÊèõÔºâ
                            let normalizedValue = String(value).trim();

                            // ÂæìÊ•≠Âì°Êï∞„ÅåISOÊó•‰ªòÂΩ¢Âºè„ÅßÊù•„ÅüÂ†¥ÂêàÔºà‰æã: 2025-03-04T15:00:00.000Z ‚Üí 3-4Ôºâ
                            if (fieldId === 'employees' && (normalizedValue.includes('T') || normalizedValue.includes('Z'))) {
                                const date = new Date(normalizedValue);
                                const month = date.getMonth() + 1; // 0-indexed
                                const day = date.getDate();
                                normalizedValue = `${month}-${day}`;
                            }

                            // ÂÖ®ËßíËã±Êï∞Â≠ó„ÇíÂçäËßí„Å´Â§âÊèõ
                            normalizedValue = normalizedValue.replace(/[Ôº°-Ôº∫ÔΩÅ-ÔΩöÔºê-Ôºô]/g, function(s) {
                                return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
                            });

                            // „Åæ„ÅöÊ≠£Ë¶èÂåñ„Åó„ÅüÂÄ§„ÅßÁõ¥Êé•Ë®≠ÂÆö„Åó„Å¶„Åø„Çã
                            element.value = normalizedValue;

                            // Áõ¥Êé•„Éû„ÉÉ„ÉÅ„Åó„Å™„Åã„Å£„ÅüÂ†¥Âêà
                            if (!element.value && normalizedValue) {
                                const options = Array.from(element.options);

                                // „Çà„ÇäÊüîËªü„Å™„Éû„ÉÉ„ÉÅ„É≥„Ç∞
                                const matchedOption = options.find(opt => {
                                    // option value „Å®ÂÆåÂÖ®‰∏ÄËá¥
                                    if (opt.value === normalizedValue) return true;

                                    // option value „ÅÆÊ≠£Ë¶èÂåñÁâà„Å®‰∏ÄËá¥
                                    const normalizedOptValue = opt.value.trim().toLowerCase();
                                    const normalizedSearchValue = normalizedValue.toLowerCase();
                                    if (normalizedOptValue === normalizedSearchValue) return true;

                                    // option text „Å´Âê´„Åæ„Çå„Çã
                                    const optText = opt.text.replace(/\s/g, '').toLowerCase();
                                    const valueText = normalizedValue.replace(/\s/g, '').toLowerCase();
                                    if (optText.includes(valueText) || valueText.includes(optText)) return true;

                                    return false;
                                });

                                if (matchedOption) {
                                    element.value = matchedOption.value;
                                }
                            }
                        } else {
                            element.value = value;
                        }
                    } else if (fieldId === 'billingEmail') {
                        // Ë´ãÊ±ÇÁî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅÆË§áÊï∞ÂØæÂøú
                        const emailsString = value || '';
                        const emails = emailsString.split(',').map(email => email.trim()).filter(email => email !== '');

                        // Êó¢Â≠ò„ÅÆ„Ç≥„É≥„ÉÜ„Éä„Çí„ÇØ„É™„Ç¢
                        const container = document.getElementById('billingEmailContainer');
                        if (container) {
                            container.innerHTML = '';

                            // „É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Åî„Å®„Å´ÂÖ•ÂäõÊ¨Ñ„Çí‰ΩúÊàê
                            emails.forEach((email, index) => {
                                const isFirst = index === 0;
                                const newItem = document.createElement('div');
                                newItem.className = 'billing-email-item mb-2';
                                newItem.innerHTML = `
                                    <div class="flex gap-2">
                                        <input type="email" name="billingEmail" data-section="contactBusiness" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="billing@example.com" value="${email}">
                                        <button type="button" onclick="${isFirst && emails.length === 1 ? 'addBillingEmail()' : 'removeBillingEmail(this)'}" class="bg-${isFirst && emails.length === 1 ? 'blue' : 'red'}-500 text-white px-3 py-2 rounded-lg hover:bg-${isFirst && emails.length === 1 ? 'blue' : 'red'}-600 flex items-center" title="„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Çí${isFirst && emails.length === 1 ? 'ËøΩÂä†' : 'ÂâäÈô§'}">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${isFirst && emails.length === 1 ? 'M12 6v6m0 0v6m0-6h6m-6 0H6' : 'M6 18L18 6M6 6l12 12'}"></path>
                                            </svg>
                                        </button>
                                    </div>
                                `;
                                container.appendChild(newItem);
                            });

                            // „É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Åå1„Å§„ÇÇ„Å™„ÅÑÂ†¥Âêà„ÅØÁ©∫„ÅÆÂÖ•ÂäõÊ¨Ñ„Çí1„Å§‰ΩúÊàê
                            if (emails.length === 0) {
                                const newItem = document.createElement('div');
                                newItem.className = 'billing-email-item mb-2';
                                newItem.innerHTML = `
                                    <div class="flex gap-2">
                                        <input type="email" name="billingEmail" data-section="contactBusiness" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="billing@example.com">
                                        <button type="button" onclick="addBillingEmail()" class="bg-blue-500 text-white px-3 py-2 rounded-lg hover:bg-blue-600 flex items-center" title="„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíËøΩÂä†">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                            </svg>
                                        </button>
                                    </div>
                                `;
                                container.appendChild(newItem);
                            }

                            // „Éú„Çø„É≥Áä∂ÊÖã„ÇíÊõ¥Êñ∞
                            updateBillingEmailButtons();
                        }
                    } else {
                        element.value = value;
                        console.log(`‚úì Set ${fieldId} = ${value}`);
                    }
                } else if (element) {
                    console.log(`‚ö™ Empty data for ${fieldId}`);
                } else {
                    console.log(`‚ùå Element not found for ${fieldId}`);
                }
            });

            // üöÄ „Éó„É©„Ç§„Éê„Ç∑„ÉºË®≠ÂÆöÔºàAYÂàó„ÉªAZÂàóÔºâ„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„ÇπÁä∂ÊÖã„ÇíÂæ©ÂÖÉ
            console.log('=== LOADING PRIVACY SETTINGS ===');

            // AYÂàóÔºö‰ª£Ë°®ËÄÖÂêçÈùûË°®Á§∫Ë®≠ÂÆö
            const representativeHideValue = data['‰ª£Ë°®ËÄÖÂêçÈùûË°®Á§∫'] || data['AY'] || '';
            const hideRepresentativeCheckbox = document.getElementById('hideRepresentativeName');
            if (hideRepresentativeCheckbox) {
                hideRepresentativeCheckbox.checked = (representativeHideValue === 'TRUE' || representativeHideValue === true);
                console.log(`‚úì ‰ª£Ë°®ËÄÖÂêçÈùûË°®Á§∫Ë®≠ÂÆö„ÇíÂæ©ÂÖÉ: ${hideRepresentativeCheckbox.checked} (from "${representativeHideValue}")`);
            }

            // AZÂàóÔºö‰ΩèÊâÄÈùûË°®Á§∫Ë®≠ÂÆö
            const addressHideValue = data['‰ΩèÊâÄÈùûË°®Á§∫'] || data['AZ'] || '';
            const hideAddressCheckbox = document.getElementById('hideAddress');
            if (hideAddressCheckbox) {
                hideAddressCheckbox.checked = (addressHideValue === 'TRUE' || addressHideValue === true);
                console.log(`‚úì ‰ΩèÊâÄÈùûË°®Á§∫Ë®≠ÂÆö„ÇíÂæ©ÂÖÉ: ${hideAddressCheckbox.checked} (from "${addressHideValue}")`);
            }

            console.log('=== AUTO-POPULATING DELIVERY SETTINGS ===');

            // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞
            if (data.deliverySettings || data.delivery_settings) {
                const deliveryData = data.deliverySettings || data.delivery_settings;
                console.log('Auto delivery settings:', deliveryData);

                // Âπ¥ÈΩ¢ÁØÑÂõ≤
                if (deliveryData.ageMin !== undefined) {
                    const ageMinEl = document.getElementById('ageMin');
                    if (ageMinEl) {
                        ageMinEl.value = deliveryData.ageMin;
                        console.log(`‚úì Set age range min: ${deliveryData.ageMin}`);
                    }
                }
                if (deliveryData.ageMax !== undefined) {
                    const ageMaxEl = document.getElementById('ageMax');
                    if (ageMaxEl) {
                        ageMaxEl.value = deliveryData.ageMax;
                        console.log(`‚úì Set age range max: ${deliveryData.ageMax}`);
                    }
                }

                // „Åù„ÅÆ‰ªñ„ÅÆËá™ÂãïÈÖç‰ø°Ë®≠ÂÆö...
            } else {
                // „Éá„Éï„Ç©„É´„ÉàÂÄ§Ë®≠ÂÆö
                const ageMinEl = document.getElementById('ageMin');
                const ageMaxEl = document.getElementById('ageMax');
                if (ageMinEl && !ageMinEl.value) {
                    ageMinEl.value = '10';
                    console.log('‚úì Set age range min: 10');
                }
                if (ageMaxEl && !ageMaxEl.value) {
                    ageMaxEl.value = '100';
                    console.log('‚úì Set age range max: 100');
                }
            }

            console.log('=== UPDATING COMPANY DISPLAYS ===');
            // ‰ºöÁ§æÂêçË°®Á§∫„ÅÆÊõ¥Êñ∞
            if (data.companyName || data.company_name) {
                const companyDisplays = document.querySelectorAll('.company-name-display');
                companyDisplays.forEach(el => {
                    el.textContent = data.companyName || data.company_name;
                });
            }

            console.log('=== LOADING BRANCH DATA ===');
            // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆOÂàóÔºàÊîØÂ∫óÂêçÔºâ„Å®PÂàóÔºàÊîØÂ∫ó‰ΩèÊâÄÔºâ„Åã„ÇâÊîØÂ∫óÊÉÖÂ†±„ÇíÂèñÂæó
            const branchNameRaw = data['ÊîØÂ∫óÂêç'] || data.branchName || data.branch_name || '';
            const branchAddressRaw = data['ÊîØÂ∫ó‰ΩèÊâÄ'] || data.branchAddress || data.branch_address || '';

            console.log('Branch name from spreadsheet:', branchNameRaw);
            console.log('Branch address from spreadsheet:', branchAddressRaw);

            // ÊîØÂ∫óÂêç„Åæ„Åü„ÅØÊîØÂ∫ó‰ΩèÊâÄ„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥Âêà
            if (branchNameRaw || branchAddressRaw) {
                // ÂÖ®Ëßí„Ç´„É≥„Éû„Äé„ÄÅ„Äè„ÅßÂàÜÂâ≤ÔºàË§áÊï∞„ÅÆÊîØÂ∫ó„Å´ÂØæÂøúÔºâ
                const branchNames = branchNameRaw ? branchNameRaw.split('„ÄÅ').map(s => s.trim()).filter(s => s) : [];
                const branchAddresses = branchAddressRaw ? branchAddressRaw.split('„ÄÅ').map(s => s.trim()).filter(s => s) : [];

                console.log('Split branch names:', branchNames);
                console.log('Split branch addresses:', branchAddresses);

                // ÊîØÂ∫ó„ÅÆÊï∞„ÇíÊ±∫ÂÆöÔºàÂêçÂâç„Å®‰ΩèÊâÄ„ÅÆÂ§ö„ÅÑÊñπ„ÇíÂü∫Ê∫ñ„Å´„Åô„ÇãÔºâ
                const branchCount = Math.max(branchNames.length, branchAddresses.length);

                if (branchCount > 0) {
                    // Êó¢Â≠ò„ÅÆÊîØÂ∫ó„Çí„ÇØ„É™„Ç¢
                    window.branches = [];
                    branchIdCounter = 0;
                    const branchList = document.getElementById('branchList');
                    if (branchList) {
                        branchList.innerHTML = '';
                    }

                    // ÂêÑÊîØÂ∫ó„ÇíËøΩÂä†
                    for (let i = 0; i < branchCount; i++) {
                        const branchId = ++branchIdCounter;
                        const branchInfo = {
                            id: branchId,
                            name: branchNames[i] || '',
                            address: branchAddresses[i] || ''
                        };

                        window.branches.push(branchInfo);

                        const branchDiv = document.createElement('div');
                        branchDiv.id = `branch-${branchId}`;
                        branchDiv.className = 'border rounded-lg p-4 mb-3 bg-gray-50';
                        branchDiv.innerHTML = `
                            <div class="flex justify-between items-start mb-3">
                                <h4 class="font-medium text-gray-700">ÊîØÂ∫ó ${i + 1}</h4>
                                <button onclick="removeBranch(${branchId})" class="text-red-600 hover:text-red-800">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ÊîØÂ∫óÂêç</label>
                                    <input type="text" class="w-full px-3 py-2 border rounded-lg" placeholder="‰æã: Ê®™ÊµúÊîØÂ∫ó"
                                           value="${branchInfo.name}"
                                           onchange="updateBranch(${branchId}, 'name', this.value)">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ÊîØÂ∫ó‰ΩèÊâÄ</label>
                                    <input type="text" class="w-full px-3 py-2 border rounded-lg" placeholder="‰æã: Á•ûÂ•àÂ∑ùÁúåÊ®™ÊµúÂ∏Ç..."
                                           value="${branchInfo.address}"
                                           onchange="updateBranch(${branchId}, 'address', this.value)">
                                </div>
                            </div>
                        `;

                        if (branchList) {
                            branchList.appendChild(branchDiv);
                        }

                        console.log(`‚úì Loaded branch ${i + 1}: ${branchInfo.name} - ${branchInfo.address}`);
                    }

                    // ÊîØÂ∫ó„Éû„ÉÉ„Éó„ÇíÊõ¥Êñ∞
                    setTimeout(() => updateBranchMaps(), 100);
                } else {
                    console.log('No valid branch data after splitting');
                }
            } else {
                console.log('No branch data found in spreadsheet');
            }

            console.log('=== LOADING AREA DATA ===');
            // ÂØæÂøúÈÉΩÈÅìÂ∫úÁúåÔºàAGÂàóÔºâ„ÄÅÂØæÂøúÂ∏ÇÂå∫Áî∫ÊùëÔºàAHÂàóÔºâ„ÄÅÂÑ™ÂÖà„Ç®„É™„Ç¢ÔºàAIÂàóÔºâ„ÇíÂèñÂæó
            const prefecturesRaw = data['ÂØæÂøúÈÉΩÈÅìÂ∫úÁúå'] || data.prefectures || '';
            const citiesRaw = data['ÂØæÂøúÂ∏ÇÂå∫Áî∫Êùë'] || data.cities || '';
            const prioritiesRaw = data['ÂÑ™ÂÖà„Ç®„É™„Ç¢'] || data.priorities || data.priority_areas || '';

            console.log('Prefectures from spreadsheet:', prefecturesRaw);
            console.log('Cities from spreadsheet:', citiesRaw);
            console.log('Priorities from spreadsheet:', prioritiesRaw);

            // ÈÉΩÈÅìÂ∫úÁúå„ÇíË°®Á§∫
            const prefecturesDisplay = document.getElementById('companyPrefecturesDisplay');
            if (prefecturesDisplay) {
                if (prefecturesRaw) {
                    const prefectures = prefecturesRaw.split(',').map(s => s.trim()).filter(s => s);
                    prefecturesDisplay.innerHTML = prefectures.map(pref =>
                        `<span class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg text-sm font-medium shadow-sm hover:shadow-md transition-shadow">
                            ${pref}
                        </span>`
                    ).join('');
                    console.log(`‚úì Loaded ${prefectures.length} prefectures`);
                } else {
                    prefecturesDisplay.innerHTML = '<span class="text-sm text-gray-400 italic">Êú™Ë®≠ÂÆö</span>';
                }
            }

            // Â∏ÇÂå∫Áî∫Êùë„ÇíË°®Á§∫
            const citiesDisplay = document.getElementById('companyCitiesDisplay');
            if (citiesDisplay) {
                if (citiesRaw) {
                    // JSONÂΩ¢Âºè„ÅÆÂ†¥Âêà„Å®„Ç´„É≥„ÉûÂå∫Âàá„Çä„ÅÆÂ†¥Âêà„Å´ÂØæÂøú
                    let cities = [];
                    try {
                        const parsed = JSON.parse(citiesRaw);
                        if (parsed.type === 'compressed' && parsed.full) {
                            cities = parsed.full.split(',').map(s => s.trim()).filter(s => s);
                        } else if (parsed.type === 'compressed' && parsed.preview) {
                            cities = parsed.preview.split(',').map(s => s.trim()).filter(s => s);
                        }
                    } catch (e) {
                        // JSONÂΩ¢Âºè„Åß„Å™„ÅÑÂ†¥Âêà„ÄÅ„Ç´„É≥„ÉûÂå∫Âàá„Çä„Å®„Åó„Å¶Âá¶ÁêÜ
                        cities = citiesRaw.split(',').map(s => s.trim()).filter(s => s);
                    }

                    citiesDisplay.innerHTML = cities.map(city =>
                        `<span class="inline-block px-2.5 py-1 bg-green-50 text-green-700 border border-green-200 rounded text-xs font-medium hover:bg-green-100 transition-colors">
                            ${city}
                        </span>`
                    ).join('');
                    console.log(`‚úì Loaded ${cities.length} cities`);
                } else {
                    citiesDisplay.innerHTML = '<span class="text-sm text-gray-400 italic">Êú™Ë®≠ÂÆö</span>';
                }
            }

            // ÂÑ™ÂÖà„Ç®„É™„Ç¢„ÇíË°®Á§∫
            const prioritiesDisplay = document.getElementById('companyPrioritiesDisplay');
            if (prioritiesDisplay) {
                if (prioritiesRaw) {
                    const priorities = prioritiesRaw.split(',').map(s => s.trim()).filter(s => s);
                    prioritiesDisplay.innerHTML = priorities.map(priority =>
                        `<span class="inline-flex items-center gap-1 px-4 py-2 bg-gradient-to-r from-amber-400 to-yellow-400 text-amber-900 rounded-lg text-sm font-semibold shadow-sm hover:shadow-md transition-shadow">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                            </svg>
                            ${priority}
                        </span>`
                    ).join('');
                    console.log(`‚úì Loaded ${priorities.length} priority areas`);
                } else {
                    prioritiesDisplay.innerHTML = '<span class="text-sm text-gray-400 italic">Êú™Ë®≠ÂÆö</span>';
                }
            }

            console.log('=== LOADING CONSTRUCTION DATA ===');
            // ÊñΩÂ∑•ÁÆáÊâÄ„Éá„Éº„Çø„ÇíÂèñÂæóÔºàAEÂàóÔºâ
            const constructionRaw = data['ÊñΩÂ∑•ÁÆáÊâÄ'] || data.construction_types || '';
            console.log('Construction types from spreadsheet:', constructionRaw);

            // ÊñΩÂ∑•ÁÆáÊâÄ„Ç¢„Ç§„Ç≥„É≥„Éû„ÉÉ„Éî„É≥„Ç∞
            const constructionIcons = {
                'Â§ñÂ£ÅÂ°óË£Ö': 'üé®',
                'Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï': 'üèóÔ∏è',
                'Â§ñÂ£ÅÂºµÊõø„Åà': 'üî®',
                'Â±ãÊ†πÂ°óË£ÖÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üè†',
                'Â±ã‰∏äÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': '‚òî',
                'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚Äª„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠â': 'üîß',
                'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚ÄªÁì¶': 'üèØ',
                'Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï': 'üõ†Ô∏è',
                'Â§ñÂ£ÅË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üîß',
                'Â±ãÊ†πË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üõ†Ô∏è',
                '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üíß',
                'ÂÜÖË£ÖÊ∞¥Âõû„ÇäÔºà„Éê„Çπ„Éª„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éà„Ç§„É¨ÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üöø',
                'ÂÜÖË£ÖÔºà„Éï„É≠„Éº„É™„É≥„Ç∞„ÇÑÁï≥„Å™„Å©„ÅÆÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üè°',
                'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': '‚òî',
                'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÔºàÂ±ãÊ†πÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üåßÔ∏è',
                'Â±ãÊ†πÂ°óË£ÖÂçòÂìÅ': 'üè†',
                'Â±ã‰∏äÈò≤Ê∞¥ÂçòÂìÅ': '‚òî',
                'Â§ñÂ£ÅË£ú‰øÆÂçòÂìÅ': 'üîß',
                'Â±ãÊ†πË£ú‰øÆÂçòÂìÅ': 'üõ†Ô∏è',
                '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÂçòÂìÅ': 'üíß',
                'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅ': '‚òî',
                'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅ': 'üåßÔ∏è'
            };

            const constructionDisplay = document.getElementById('companyConstructionDisplay');
            if (constructionDisplay) {
                if (constructionRaw) {
                    const constructions = constructionRaw.split(',').map(s => s.trim()).filter(s => s);

                    // ÈáçË§á„ÇíÂâäÈô§„Åô„Çã„Åü„ÇÅ„ÄÅÊ≠£Ë¶èÂåñÂæå„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Åß„É¶„Éã„Éº„ÇØÂåñ
                    const uniqueConstructions = [];
                    const seenTexts = new Set();

                    constructions.forEach(construction => {
                        // Á∞°Áï•Ë°®Á§∫Áî®„Å´ÊñáÂ≠óÂàó„ÇíÁü≠Á∏Æ
                        let displayText = construction
                            .replace('ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ', '')
                            .replace('ÔºàÂ±ãÊ†πÂ∑•‰∫ãÂê´„ÇÄÔºâ', '')
                            .replace('Ôºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ', '')
                            .replace('ÂçòÂìÅ', '')
                            .trim();

                        // „Åæ„Å†Ë¶ã„Å¶„ÅÑ„Å™„ÅÑ„ÉÜ„Ç≠„Çπ„Éà„ÅÆÂ†¥Âêà„ÅÆ„ÅøËøΩÂä†
                        if (!seenTexts.has(displayText)) {
                            seenTexts.add(displayText);
                            uniqueConstructions.push({
                                original: construction,
                                display: displayText
                            });
                        }
                    });

                    constructionDisplay.innerHTML = uniqueConstructions.map(item => {
                        const icon = constructionIcons[item.original] || 'üî®';

                        return `<div class="flex items-center gap-2 p-2 bg-gray-50 hover:bg-gray-100 border border-gray-200 rounded-lg transition-colors">
                            <span class="text-lg">${icon}</span>
                            <span class="text-sm font-medium text-gray-700">${item.display}</span>
                        </div>`;
                    }).join('');
                    console.log(`‚úì Loaded ${uniqueConstructions.length} unique construction types (${constructions.length} total)`);
                } else {
                    constructionDisplay.innerHTML = '<span class="text-sm text-gray-400 italic">Êú™Ë®≠ÂÆö</span>';
                }
            }

            console.log('=== LOADING APPEAL POINTS DATA ===');
            // ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ„Éá„Éº„Çø„ÇíÂèñÂæóÔºàAFÂàóÔºâ
            const appealPointsRaw = data['ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ'] || data.appeal_points || data.special_services || '';
            console.log('Appeal points from spreadsheet:', appealPointsRaw);

            // „Ç¢„Éî„Éº„É´„Éù„Ç§„É≥„Éà„Ç¢„Ç§„Ç≥„É≥„Éû„ÉÉ„Éî„É≥„Ç∞
            const appealPointIcons = {
                'ÈÅÆÁÜ±„ÉªÊñ≠ÁÜ±Â°óÊñôÊèêÊ°àÂèØËÉΩ': 'üå°Ô∏è',
                '„ÇØ„É¨„Ç∏„ÉÉ„Éà„Ç´„Éº„ÉâÊâï„ÅÑÂèØ': 'üí≥',
                'ÊèêÊê∫ÂÖà„É≠„Éº„É≥Êúâ„Çä': 'üè¶',
                'ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà': 'üî•',
                'Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà': 'üí∞',
                'Âç≥Êó•Ë¶ãÁ©ç„ÇÇ„ÇäÂØæÂøú': '‚ö°',
                'Ëá™Á§æËÅ∑‰∫∫ÊñΩÂ∑•': 'üë∑',
                '‰øùË®ºÊúüÈñì10Âπ¥‰ª•‰∏ä': 'üõ°Ô∏è',
                '24ÊôÇÈñìÁ∑äÊÄ•ÂØæÂøú': 'üö®',
                '„Éâ„É≠„Éº„É≥Ë™øÊüªÂØæÂøú': 'üöÅ',
                'ÁÑ°ÊñôÁÇπÊ§ú„Çµ„Éº„Éì„Çπ': 'üîç',
                '„Ç´„É©„Éº„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥ÁÑ°Êñô': 'üé®',
                'ËøëÈö£Êå®Êã∂‰ª£Ë°å': 'üôá',
                'Â∑•‰∫ãÂÜôÁúüÂ†±ÂëäÊõ∏Êèê‰æõ': 'üì∏',
                'ÂÆåÂ∑•Âæå„Ç¢„Éï„Çø„Éº„Éï„Ç©„É≠„Éº': '‚úÖ'
            };

            const appealPointsDisplay = document.getElementById('companyAppealPointsDisplay');
            if (appealPointsDisplay) {
                if (appealPointsRaw) {
                    // Èô§Â§ñ„Åô„Çã„Ç¢„Éî„Éº„É´„Éù„Ç§„É≥„Éà
                    const excludedPoints = [
                        'Á´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÊâãÊ∏°„ÅóÂ∏åÊúõ',
                        'ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÈÉµÈÄÅ„ÉªÈõªË©±„ÅßÂïÜË´áÂèØ'
                    ];

                    const appealPoints = appealPointsRaw
                        .split(',')
                        .map(s => s.trim())
                        .filter(s => s && !excludedPoints.includes(s)); // Èô§Â§ñ„É™„Çπ„Éà„Å´Âê´„Åæ„Çå„Å¶„ÅÑ„Å™„ÅÑ„ÇÇ„ÅÆ„ÅÆ„Åø

                    if (appealPoints.length > 0) {
                        appealPointsDisplay.innerHTML = appealPoints.map(point => {
                            const icon = appealPointIcons[point] || '‚≠ê';

                            return `<div class="flex items-center gap-2 p-2 bg-gradient-to-r from-amber-50 to-yellow-50 hover:from-amber-100 hover:to-yellow-100 border border-yellow-200 rounded-lg transition-all">
                                <span class="text-lg">${icon}</span>
                                <span class="text-sm font-medium text-gray-700">${point}</span>
                            </div>`;
                        }).join('');
                        console.log(`‚úì Loaded ${appealPoints.length} appeal points`);
                    } else {
                        appealPointsDisplay.innerHTML = '<span class="text-sm text-gray-400 italic">Êú™Ë®≠ÂÆö</span>';
                    }
                } else {
                    appealPointsDisplay.innerHTML = '<span class="text-sm text-gray-400 italic">Êú™Ë®≠ÂÆö</span>';
                }
            }

            console.log('=== LOADING QUALIFICATIONS DATA ===');
            // ‰øùÊúâË≥áÊ†º„Éá„Éº„Çø„ÇíÂèñÂæóÔºàATÂàóÔºâ
            const qualificationsRaw = data['‰øùÊúâË≥áÊ†º'] || '';
            console.log('Qualifications from spreadsheet:', qualificationsRaw);

            if (qualificationsRaw) {
                const qualificationsList = qualificationsRaw.split(',').map(q => q.trim()).filter(q => q);
                console.log('Parsed qualifications:', qualificationsList);

                // ÂÖ®„Å¶„ÅÆ‰øùÊúâË≥áÊ†º„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Çí„ÇØ„É™„Ç¢
                document.querySelectorAll('input[name="qualifications"]').forEach(cb => {
                    cb.checked = false;
                });

                // „Ç´„Çπ„Çø„É†Ë≥áÊ†º„É™„Çπ„Éà„Çí„ÇØ„É™„Ç¢
                const customQualList = document.getElementById('customQualificationsList');
                if (customQualList) {
                    customQualList.innerHTML = '';
                }

                // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆ„Éá„Éº„Çø„Å´Âü∫„Å•„ÅÑ„Å¶„ÉÅ„Çß„ÉÉ„ÇØ
                qualificationsList.forEach(qual => {
                    const checkbox = document.querySelector(`input[name="qualifications"][value="${qual}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                        console.log(`‚úì Checked qualification: ${qual}`);
                    } else {
                        // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Å´„Å™„ÅÑË≥áÊ†º„ÅØ„Äå„Åù„ÅÆ‰ªñ„Äç„Å®„Åó„Å¶„Ç´„Çπ„Çø„É†„É™„Çπ„Éà„Å´ËøΩÂä†
                        console.log(`‚ö† Qualification not found in checkboxes, adding as custom: ${qual}`);
                        if (customQualList) {
                            const tag = document.createElement('div');
                            tag.className = 'inline-flex items-center bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm';
                            tag.innerHTML = `
                                <span>${qual}</span>
                                <button onclick="this.parentElement.remove()" class="ml-2 text-blue-600 hover:text-blue-800">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            `;
                            customQualList.appendChild(tag);
                        }
                    }
                });

                // „Éó„É¨„Éì„É•„Éº„Å´‰øùÊúâË≥áÊ†º„ÇíÂèçÊò†
                const previewQualsList = document.getElementById('qualificationsList');
                if (previewQualsList) {
                    previewQualsList.innerHTML = '';
                    qualificationsList.forEach(qual => {
                        const div = document.createElement('div');
                        div.className = 'bg-purple-50 border border-purple-200 rounded-lg p-3 flex items-center';
                        div.innerHTML = `
                            <span class="text-2xl mr-2">üéñÔ∏è</span>
                            <span class="text-sm font-medium">${qual}</span>
                        `;
                        previewQualsList.appendChild(div);
                    });
                    const qualSection = document.getElementById('preview-gallery');
                    if (qualSection && qualificationsList.length > 0) {
                        qualSection.style.display = 'block';
                    }
                    console.log('‚úì Updated preview qualifications:', qualificationsList.length);
                }
            }

            console.log('=== LOADING INSURANCE DATA ===');
            // Âä†ÂÖ•‰øùÈô∫„Éá„Éº„Çø„ÇíÂèñÂæóÔºàAUÂàóÔºâ
            const insuranceRaw = data['Âä†ÂÖ•‰øùÈô∫'] || '';
            console.log('Insurance from spreadsheet:', insuranceRaw);

            if (insuranceRaw) {
                const insuranceList = insuranceRaw.split(',').map(i => i.trim()).filter(i => i);
                console.log('Parsed insurance:', insuranceList);

                // ÂÖ®„Å¶„ÅÆÂä†ÂÖ•‰øùÈô∫„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Çí„ÇØ„É™„Ç¢
                document.querySelectorAll('input[name="insurance"]').forEach(cb => {
                    cb.checked = false;
                });

                // „Ç´„Çπ„Çø„É†‰øùÈô∫„É™„Çπ„Éà„Çí„ÇØ„É™„Ç¢
                const customInsList = document.getElementById('customInsuranceList');
                if (customInsList) {
                    customInsList.innerHTML = '';
                }

                // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆ„Éá„Éº„Çø„Å´Âü∫„Å•„ÅÑ„Å¶„ÉÅ„Çß„ÉÉ„ÇØ
                insuranceList.forEach(ins => {
                    const checkbox = document.querySelector(`input[name="insurance"][value="${ins}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                        console.log(`‚úì Checked insurance: ${ins}`);
                    } else {
                        // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Å´„Å™„ÅÑ‰øùÈô∫„ÅØ„Äå„Åù„ÅÆ‰ªñ„Äç„Å®„Åó„Å¶„Ç´„Çπ„Çø„É†„É™„Çπ„Éà„Å´ËøΩÂä†
                        console.log(`‚ö† Insurance not found in checkboxes, adding as custom: ${ins}`);
                        if (customInsList) {
                            const tag = document.createElement('div');
                            tag.className = 'inline-flex items-center bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm';
                            tag.innerHTML = `
                                <span>${ins}</span>
                                <button onclick="this.parentElement.remove()" class="ml-2 text-green-600 hover:text-green-800">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            `;
                            customInsList.appendChild(tag);
                        }
                    }
                });

                // „Éó„É¨„Éì„É•„Éº„Å´Âä†ÂÖ•‰øùÈô∫„ÇíÂèçÊò†
                const previewInsList = document.getElementById('insuranceList');
                if (previewInsList) {
                    previewInsList.innerHTML = '';
                    insuranceList.forEach(ins => {
                        const div = document.createElement('div');
                        div.className = 'bg-indigo-50 border border-indigo-200 rounded-lg p-3 flex items-center';
                        div.innerHTML = `
                            <span class="text-2xl mr-2">üõ°Ô∏è</span>
                            <span class="text-sm font-medium">${ins}</span>
                        `;
                        previewInsList.appendChild(div);
                    });
                    const insSection = document.getElementById('preview-insurance');
                    if (insSection && insuranceList.length > 0) {
                        insSection.style.display = 'block';
                    }
                    console.log('‚úì Updated preview insurance:', insuranceList.length);
                }
            }

            // Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêçÔºàXÂàóÔºâ„Çíwindow.merchantData„Å´‰øùÂ≠ò
            const salesPersonName = data['Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç'] || data.salesPersonName || data.sales_person_name || '';
            if (salesPersonName) {
                if (!window.merchantData) {
                    window.merchantData = {};
                }
                window.merchantData.salesPerson = salesPersonName;
                console.log(`‚úì Sales person name: ${salesPersonName}`);

                // „Éò„ÉÉ„ÉÄ„Éº„ÅÆÂñ∂Ê•≠ÊãÖÂΩìËÄÖË°®Á§∫„ÇíÊõ¥Êñ∞
                const userRoleElement = document.getElementById('userRole');
                if (userRoleElement) {
                    userRoleElement.textContent = salesPersonName;
                    console.log(`‚úì Updated header with sales person: ${salesPersonName}`);
                }
            }

            // „Éó„É¨„Éì„É•„ÉºHP URLÔºàAXÂàóÔºâ„ÅÆË™≠„ÅøËæº„Åø„Å®Ë°®Á§∫
            const previewHpUrl = data['„Éó„É¨„Éì„É•„ÉºHP'] || '';
            console.log('üè† „Éó„É¨„Éì„É•„ÉºHP URLË™≠„ÅøËæº„Åø:', previewHpUrl);

            if (previewHpUrl && previewHpUrl.trim() !== '') {
                // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Å´‰øùÂ≠òÔºàvisitPreviewHPÈñ¢Êï∞„Åß‰ΩøÁî®Ôºâ
                window.currentPreviewHpUrl = previewHpUrl;

                // ÂÆåÂÖ®„Å™URL„ÇíË°®Á§∫Ôºà‰ºöÁ§æÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥Ôºâ
                const currentFullUrlElement = document.getElementById('currentFullUrl');
                const visitUrlBtn = document.getElementById('visitUrlBtn');

                if (currentFullUrlElement) {
                    currentFullUrlElement.textContent = previewHpUrl;
                    currentFullUrlElement.className = 'text-blue-600 font-semibold';
                }

                if (visitUrlBtn) {
                    visitUrlBtn.disabled = false;
                    visitUrlBtn.classList.remove('bg-gray-400');
                    visitUrlBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                }

                // „Éó„É¨„Éì„É•„Éº„É¢„Éº„ÉÄ„É´ÂÜÖ„ÅÆURL„ÇÇÊõ¥Êñ∞
                const previewCurrentFullUrlElement = document.getElementById('previewCurrentFullUrl');
                const previewVisitUrlBtn = document.getElementById('previewVisitUrlBtn');

                if (previewCurrentFullUrlElement) {
                    previewCurrentFullUrlElement.textContent = previewHpUrl;
                    previewCurrentFullUrlElement.className = 'text-blue-600 font-semibold';
                }

                if (previewVisitUrlBtn) {
                    previewVisitUrlBtn.disabled = false;
                    previewVisitUrlBtn.classList.remove('bg-gray-400');
                    previewVisitUrlBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                }

                // URL„Éó„É¨„Éï„Ç£„ÉÉ„ÇØ„Çπ„ÇíÊäΩÂá∫„Åó„Å¶„Éï„Ç©„Éº„É†„Å´Ë®≠ÂÆö
                const urlParts = previewHpUrl.split('/').filter(part => part.length > 0); // Á©∫ÊñáÂ≠óÂàó„ÇíÈô§Âéª
                console.log('üîç URLÂàÜÊûê:', previewHpUrl, '‚Üí', urlParts);

                if (urlParts.length >= 4) { // https, domain, area, company
                    // Ê≠£„Åó„ÅÑÊßãÈÄ†: https://gaihekikuraberu.com/area/company/
                    const protocol = urlParts[0]; // https:
                    const domain = urlParts[1]; // gaihekikuraberu.com
                    const area = urlParts[2]; // kanagawa or city
                    const company = urlParts[3]; // ‰ºöÁ§æÂêç„Çπ„É©„ÉÉ„Ç∞

                    // ÊúÄÂæå„Åå‰ºöÁ§æÂêç„Çπ„É©„ÉÉ„Ç∞„ÅÆÂ†¥ÂêàÔºàÊ≠£Â∏∏„Éë„Çø„Éº„É≥Ôºâ
                    if (urlParts.length === 4) {
                        const baseUrl = `${protocol}//${domain}/${area}/`;
                        currentMerchantUrlSlug = company;

                        // ‚úÖ currentRegion„ÇíË®≠ÂÆöÔºàÈáçË¶ÅÔºÅÔºâ
                        currentRegion = area;
                        window.currentRegion = area; // „Ç∞„É≠„Éº„Éê„É´„Åã„Çâ„ÇÇ„Ç¢„ÇØ„Çª„ÇπÂèØËÉΩ„Å´
                        console.log('üéØ currentRegionË®≠ÂÆöÂÆå‰∫Ü:', area);


                        console.log('‚úÖ Ê≠£Â∏∏„Å™URLÊßãÈÄ†:', baseUrl + company);
                    }
                    // ÈñìÈÅï„Å£„ÅüÊßãÈÄ†: „Ç®„É™„Ç¢/Á§æÂêç/Á§æÂêç „ÅÆÂ†¥Âêà
                    else if (urlParts.length === 5) {
                        const incorrectArea = urlParts[2]; // city
                        const duplicateCompany1 = urlParts[3]; // ohnokensou
                        const duplicateCompany2 = urlParts[4]; // yamada-kensou

                        // Ê≠£„Åó„ÅÑÊßãÈÄ†„Å´‰øÆÊ≠£„Åó„Å¶Ë°®Á§∫
                        const baseUrl = `${protocol}//${domain}/${incorrectArea}/`;
                        currentMerchantUrlSlug = duplicateCompany2; // 2Áï™ÁõÆ„ÅÆ‰ºöÁ§æÂêç„Çí‰ΩøÁî®

                        // ‚úÖ currentRegion„ÇíË®≠ÂÆöÔºàÁï∞Â∏∏„Éë„Çø„Éº„É≥„Åß„ÇÇÔºâ
                        currentRegion = incorrectArea;
                        window.currentRegion = incorrectArea;
                        console.log('üéØ currentRegionË®≠ÂÆöÂÆå‰∫ÜÔºà‰øÆÊ≠£Ôºâ:', incorrectArea);


                        console.log('‚ö†Ô∏è ‰øÆÊ≠£„Åï„Çå„ÅüURLÊßãÈÄ†:', baseUrl + duplicateCompany2);
                        console.log('  ÂÖÉ„ÅÆURL:', previewHpUrl);
                        console.log('  ‰øÆÊ≠£ÂæåË°®Á§∫:', baseUrl + duplicateCompany2);
                    }
                }

                console.log('‚úì „Éó„É¨„Éì„É•„ÉºHP URLË®≠ÂÆöÂÆå‰∫Ü:', previewHpUrl);
            } else {
                // URL„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà
                window.currentPreviewHpUrl = null; // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Çí„ÇØ„É™„Ç¢
                currentRegion = ''; // „Ç®„É™„Ç¢ÊÉÖÂ†±„ÇÇ„ÇØ„É™„Ç¢
                window.currentRegion = '';
                console.log('‚ö†Ô∏è currentRegion„ÇØ„É™„Ç¢ÔºàURLÊú™Ë®≠ÂÆöÔºâ');

                const currentFullUrlElement = document.getElementById('currentFullUrl');
                if (currentFullUrlElement) {
                    currentFullUrlElement.textContent = 'URL„ÅåÊú™Ë®≠ÂÆö„Åß„Åô';
                    currentFullUrlElement.className = 'text-gray-500';
                }


                console.log('‚Ñπ „Éó„É¨„Éì„É•„ÉºHP URL„ÅåÊú™Ë®≠ÂÆö');
            }

            // „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„ÅÆË™≠„ÅøËæº„ÅøÔºà„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅåÁ©∫„Å™„ÇâÈùûË°®Á§∫Ôºâ
            const mainVisualUrlFromSheet = data['„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´'] || '';
            console.log('[loadMerchantData] „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´Ë™≠„ÅøËæº„Åø:', mainVisualUrlFromSheet);
            console.log('[loadMerchantData] „Éá„Éº„ÇøÂÖ®‰Ωì:', Object.keys(data));
            const mainVisualImageView = document.getElementById('mainVisualImageView');
            const mainVisualPlaceholderView = document.getElementById('mainVisualPlaceholderView');

            if (mainVisualUrlFromSheet && mainVisualUrlFromSheet.trim() !== '') {
                // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´„Éá„Éº„Çø„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„ÅøË°®Á§∫
                // Google Drive URL„ÇíthumbnailÂΩ¢Âºè„Å´Â§âÊèõÔºàË°®Á§∫Áî®Ôºâ
                let displayUrl = mainVisualUrlFromSheet;
                if (mainVisualUrlFromSheet.includes('drive.google.com')) {
                    // uc?export=view&id=XXX ‚Üí thumbnail?id=XXX&sz=w1000
                    const idMatch = mainVisualUrlFromSheet.match(/[?&]id=([^&]+)/);
                    if (idMatch) {
                        displayUrl = `https://drive.google.com/thumbnail?id=${idMatch[1]}&sz=w1000`;
                    }
                }

                mainVisualUrl = mainVisualUrlFromSheet; // ÂÖÉ„ÅÆURL„Çí‰øùÂ≠ò
                mainVisualDisplayUrl = displayUrl; // Ë°®Á§∫Áî®URL„Çí‰øùÂ≠ò
                window.mainVisualUrl = mainVisualUrlFromSheet; // window„Å´„ÇÇ‰øùÂ≠ò
                window.mainVisualDisplayUrl = displayUrl; // window„Å´„ÇÇ‰øùÂ≠ò
                const mainVisualImageElement = document.getElementById('mainVisualImage');
                if (mainVisualImageElement) {
                    mainVisualImageElement.src = displayUrl;
                }

                const mainVisualPreview = document.getElementById('mainVisualPreview');
                const mainVisualPlaceholder = document.getElementById('mainVisualPlaceholder');
                if (mainVisualPreview) {
                    mainVisualPreview.classList.remove('hidden');
                }
                if (mainVisualPlaceholder) {
                    mainVisualPlaceholder.classList.add('hidden');
                }

                // „Éó„É¨„Éì„É•„Éº„Å´„ÇÇÂèçÊò†ÔºàÊúâÂäπ„Å™URL„ÅÆÂ†¥Âêà„ÅÆ„ÅøÔºâ
                const previewMainVisual = document.getElementById('previewMainVisual');
                if (previewMainVisual) {
                    if (displayUrl && displayUrl !== '' && !displayUrl.includes('data:,')) {
                        previewMainVisual.src = displayUrl;
                    } else {
                        previewMainVisual.src = '';
                    }
                }
                const mainVisualSection = document.getElementById('mainVisualSection');
                const heroSection = document.getElementById('heroSection');
                const previewMainVisualSection = document.getElementById('previewMainVisualSection');

                if (displayUrl && displayUrl !== '' && !displayUrl.includes('data:,')) {
                    // ÊúâÂäπ„Å™ÁîªÂÉèURL„Åå„ÅÇ„ÇãÂ†¥Âêà
                    if (mainVisualSection) mainVisualSection.style.display = 'block';
                    if (heroSection) heroSection.style.display = 'none';
                    if (previewMainVisualSection) {
                        previewMainVisualSection.classList.remove('hidden');
                        previewMainVisualSection.classList.add('block');
                    }
                } else {
                    // ÁîªÂÉèURL„Åå„Å™„ÅÑÂ†¥Âêà
                    if (mainVisualSection) mainVisualSection.style.display = 'none';
                    if (heroSection) heroSection.style.display = 'block';
                    if (previewMainVisualSection) {
                        previewMainVisualSection.classList.add('hidden');
                        previewMainVisualSection.classList.remove('block');
                    }
                }

                // Èñ≤Ë¶ß„É¢„Éº„Éâ„Å´ÂèçÊò†
                if (mainVisualImageView) {
                    mainVisualImageView.src = displayUrl;
                    mainVisualImageView.classList.remove('hidden');
                }
                if (mainVisualPlaceholderView) {
                    mainVisualPlaceholderView.classList.add('hidden');
                }

                // „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´‰∏ä„ÅÆË®≠Á´ãÂπ¥ÊúàÊó•„ÇÇÊõ¥Êñ∞
                const establishedDate = formatEstablishedDate(data['Ë®≠Á´ãÂπ¥Êúà'] || data.established || '');
                if (establishedDate) {
                    const overlayEstablished = document.getElementById('previewEstablishedOverlay');
                    if (overlayEstablished) {
                        // „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´‰∏ä„ÅÆË®≠Á´ãÂπ¥Êúà„Å´„ÄåË®≠Á´ã„Äç„ÇíËøΩÂä†
                        const establishedWithSuffix = establishedDate && establishedDate !== '-' ? `${establishedDate}Ë®≠Á´ã` : establishedDate;
                        overlayEstablished.textContent = establishedWithSuffix;
                    }
                }

            } else {
                // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅåÁ©∫„ÅÆÂ†¥Âêà
                if (mainVisualImageView) {
                    mainVisualImageView.src = '';
                    mainVisualImageView.classList.add('hidden');
                }
                if (mainVisualPlaceholderView) {
                    mainVisualPlaceholderView.classList.remove('hidden');
                }
            }

            // ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„ÅÆË™≠„ÅøËæº„ÅøÔºàÈÅÖÂª∂Ë™≠„ÅøËæº„Åø + ËªΩÈáè„Çµ„É†„Éç„Ç§„É´Ôºâ
            const galleryUrlsFromSheet = data['ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº'] || data.photoGallery;
            if (galleryUrlsFromSheet) {
                let urls = [];
                if (typeof galleryUrlsFromSheet === 'string') {
                    // JSONÂΩ¢Âºè„ÅÆÂ†¥Âêà„ÅØ„Éë„Éº„Çπ
                    if (galleryUrlsFromSheet.startsWith('[')) {
                        try {
                            const galleryArray = JSON.parse(galleryUrlsFromSheet);
                            urls = galleryArray.map(item => item.src).filter(url => url && url.startsWith('http'));
                        } catch (e) {
                            console.error('[loadMerchantData] Failed to parse gallery JSON:', e);
                            // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: „Ç´„É≥„ÉûÂå∫Âàá„Çä„Å®„Åó„Å¶Âá¶ÁêÜ
                            urls = galleryUrlsFromSheet.split(',').map(url => url.trim()).filter(url => url && url.startsWith('http'));
                        }
                    } else {
                        // „Ç´„É≥„ÉûÂå∫Âàá„Çä„ÅÆURLÊñáÂ≠óÂàó„ÇíÂàÜÂâ≤
                        urls = galleryUrlsFromSheet.split(',').map(url => url.trim()).filter(url => url && url.startsWith('http'));
                    }
                }

                const galleryList = document.getElementById('photoGalleryList');
                const addButton = galleryList.querySelector('.border-dashed');
                const existingImages = galleryList.querySelectorAll('.gallery-item');
                existingImages.forEach(img => img.remove());

                // galleryImagesÈÖçÂàó„Çí„ÇØ„É™„Ç¢
                galleryImages = [];
                window.galleryImages = [];  // window„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Å´„ÇÇ‰øùÂ≠ò

                urls.forEach((url, index) => {
                    const imageId = 'gallery_loaded_' + index;

                    // Google Drive URL„Åã„Çâ driveId „ÇíÊäΩÂá∫
                    const idMatch = url.match(/[?&]id=([^&]+)/);
                    const driveId = idMatch ? idMatch[1] : null;

                    // thumbnailÂΩ¢Âºè„Å´Â§âÊèõÔºà„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„Å®Âêå„ÅòÂΩ¢ÂºèÔºâ
                    let viewUrl = url;
                    if (driveId) {
                        viewUrl = `https://drive.google.com/thumbnail?id=${driveId}&sz=w800`;
                    }

                    console.log('[loadMerchantData] Creating gallery image', index, ':', viewUrl);

                    const imageDiv = document.createElement('div');
                    imageDiv.className = 'relative group gallery-item';
                    imageDiv.id = imageId;
                    imageDiv.innerHTML = `
                        <img loading="lazy" src="${viewUrl}" class="w-full h-24 object-cover rounded-lg" alt="„ÇÆ„É£„É©„É™„ÉºÁîªÂÉè${index + 1}">
                        <button type="button" onclick="removeGalleryImage('${imageId}')" class="absolute top-1 right-1 bg-red-500 text-white p-1 rounded opacity-0 group-hover:opacity-100 transition">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    `;
                    if (addButton) {
                        galleryList.insertBefore(imageDiv, addButton);
                    } else {
                        galleryList.appendChild(imageDiv);
                    }

                    // „Éó„É¨„Éì„É•„ÉºÁî®„Å´galleryImagesÈÖçÂàó„Å´ËøΩÂä†
                    const imageData = {
                        id: imageId,
                        src: viewUrl,
                        name: `„ÇÆ„É£„É©„É™„ÉºÁîªÂÉè${index + 1}`
                    };
                    galleryImages.push(imageData);
                    window.galleryImages.push(imageData);  // window„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Å´„ÇÇËøΩÂä†
                });

                console.log('‚úì Loaded gallery:', urls.length, 'images (lazy loading enabled)');
                // „Éó„É¨„Éì„É•„Éº„ÇíÊõ¥Êñ∞
                updateGalleryPreview();
            }

            // ÊñΩÂ∑•‰∫ã‰æã„ÅÆË™≠„ÅøËæº„Åø
            loadConstructionExamples();

            // „Éó„É¨„Éì„É•„ÉºË®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø
            loadPreviewSettings();

            console.log('===== loadMerchantData COMPLETE =====');

            // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóÂàùÊúüÂåñ
            setupGalleryDragDrop();

            // Èñ≤Ë¶ß„É¢„Éº„Éâ„ÅÆË°®Á§∫„Éá„Éº„Çø„ÇíÊõ¥Êñ∞Ôºà„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂæåÔºâ
            updateViewData('mainVisual');
            // constructionExamples„ÅØloadConstructionExamples()ÂÆå‰∫ÜÂæå„Å´Êõ¥Êñ∞„Åï„Çå„Çã
            updateViewData('photoGallery');
            updateViewData('basicInfo');
            updateViewData('branchInfo');
            updateViewData('contactBusiness');
            updateViewData('qualifications');
            updateViewData('insurance');

            // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅÆÈñ≤Ë¶ß„É¢„Éº„ÉâË°®Á§∫„ÇíÊõ¥Êñ∞
            updateViewData('propertyTypes');
            updateViewData('constructionAreas');
            updateViewData('specialServices');
            updateViewData('serviceAreas');
        }

        // ÊñΩÂ∑•‰∫ã‰æã„ÇíË™≠„ÅøËæº„Çì„ÅßË°®Á§∫
        async function loadConstructionExamples() {
            console.log('[loadConstructionExamples] Loading from separate sheet');
            const examplesList = document.getElementById('constructionExamplesList');
            if (!examplesList) {
                console.error('[loadConstructionExamples] constructionExamplesListË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }
            try {
                constructionExamples = [];
                window.constructionExamples = [];
                examplesList.innerHTML = '';

                // Âà•„Ç∑„Éº„Éà„ÄåÊñΩÂ∑•‰∫ã‰æã„Äç„Åã„ÇâÂèñÂæóÔºàJSONP‰ΩøÁî®Ôºâ
                const result = await callGasApi('companyinfo_getConstructionExamples', {
                    merchantId: window.merchantId
                });
                console.log('[loadConstructionExamples] API result:', result);
                console.log('[loadConstructionExamples] Raw examples data:', result.examples);

                if (result.success && result.examples) {
                    const examples = result.examples;
                    console.log('[loadConstructionExamples] Parsed examples:', examples.length, '‰ª∂');

                    // ÂêÑ‰∫ã‰æã„ÅÆË©≥Á¥∞„Çí„É≠„Ç∞Âá∫Âäõ
                    examples.forEach((example, index) => {
                        console.log(`[loadConstructionExamples] Example ${index + 1}:`, {
                            exampleId: example.exampleId,
                            title: example.title,
                            beforeUrl: example.beforeUrl || example.beforeImage,
                            afterUrl: example.afterUrl || example.afterImage,
                            age: example.ageRange || example.age,
                            cost: example.price || example.cost
                        });
                    });

                    if (examples.length > 0) {
                        // ÈáçË§áÈô§ÂéªÔºöURL„Éö„Ç¢„Éô„Éº„Çπ„ÅßÈáçË§á„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
                        const uniqueExamples = getUniqueExamples(examples);
                        console.log('[loadConstructionExamples] ÈáçË§áÈô§ÂéªÂæå:', uniqueExamples.length, '‰ª∂ÔºàÂÖÉ:', examples.length, '‰ª∂Ôºâ');

                        // Êó¢Â≠ò„ÅÆID„Åã„ÇâÊúÄÂ§ßÁï™Âè∑„ÇíÂèñÂæó„Åó„Å¶ÈáçË§á„ÇíÈò≤„Åê
                        let maxId = 0;
                        uniqueExamples.forEach(example => {
                            const idMatch = (example.exampleId || example.id || '').match(/example_(\d+)/);
                            if (idMatch) {
                                maxId = Math.max(maxId, parseInt(idMatch[1]));
                            }
                        });
                        exampleIdCounter = maxId;
                        uniqueExamples.forEach((example, index) => {
                            const exampleId = example.exampleId || example.id || 'example_' + (index + 1);

                            // Google Drive URL„ÇíthumbnailÂΩ¢Âºè„Å´Â§âÊèõÔºà„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„Å®Âêå„ÅòÂá¶ÁêÜÔºâ
                            let beforeImageUrl = example.beforeUrl || example.beforeImage || '';
                            let afterImageUrl = example.afterUrl || example.afterImage || '';

                            if (beforeImageUrl && beforeImageUrl.includes('drive.google.com')) {
                                const idMatch = beforeImageUrl.match(/[?&]id=([^&]+)/);
                                if (idMatch) {
                                    beforeImageUrl = `https://drive.google.com/thumbnail?id=${idMatch[1]}&sz=w800`;
                                }
                            }

                            if (afterImageUrl && afterImageUrl.includes('drive.google.com')) {
                                const idMatch = afterImageUrl.match(/[?&]id=([^&]+)/);
                                if (idMatch) {
                                    afterImageUrl = `https://drive.google.com/thumbnail?id=${idMatch[1]}&sz=w800`;
                                }
                            }

                            const newExample = {
                                id: exampleId,
                                title: example.title || '',
                                ageRange: example.ageRange || '',
                                content: example.content || '',
                                price: example.price || '',
                                beforeImage: beforeImageUrl,
                                afterImage: afterImageUrl
                            };
                            constructionExamples.push(newExample);
                            window.constructionExamples.push(newExample);
                            const exampleDiv = document.createElement('div');
                            exampleDiv.className = 'border rounded-lg p-4';
                            exampleDiv.id = exampleId;
                            exampleDiv.innerHTML = '<input type="text" class="w-full px-3 py-2 border rounded mb-2" placeholder="ÊñΩÂ∑•„Çø„Ç§„Éà„É´Ôºà‰æãÔºöÊà∏Âª∫„Å¶Â§ñÂ£ÅÂ°óË£ÖÔºâ" value="' + newExample.title + '" onchange="updateConstructionExample(\'' + exampleId + '\', \'title\', this.value)"><div class="grid grid-cols-2 gap-2 mb-2"><div><label class="text-xs text-gray-600 mb-1 block">ÁØâÂπ¥Êï∞</label><div class="flex items-center"><input type="number" class="w-full px-3 py-2 border rounded" placeholder="15" min="0" max="100" value="' + newExample.ageRange + '" onchange="updateConstructionExample(\'' + exampleId + '\', \'ageRange\', this.value)"><span class="ml-2 text-sm text-gray-600">Âπ¥</span></div></div><div><label class="text-xs text-gray-600 mb-1 block">ÊñΩÂ∑•ÈáëÈ°çÔºà‰∏áÂÜÜÔºâ</label><div class="flex items-center"><input type="number" class="w-full px-3 py-2 border rounded" placeholder="150" min="0" value="' + newExample.price + '" onchange="updateConstructionExample(\'' + exampleId + '\', \'price\', this.value)"><span class="ml-2 text-sm text-gray-600">‰∏áÂÜÜ</span></div></div></div><textarea class="w-full px-3 py-2 border rounded mb-2" rows="2" placeholder="ÊñΩÂ∑•ÂÜÖÂÆπÔºà‰æãÔºö„Ç∑„É™„Ç≥„É≥Â°óÊñô„Å´„Çà„Çã3ÂõûÂ°ó„Çä„ÄÅËâ≤Ë§™„Åõ„Å®Ê±ö„Çå„ÇíËß£Ê∂àÔºâ" onchange="updateConstructionExample(\'' + exampleId + '\', \'content\', this.value)">' + newExample.content + '</textarea><div class="grid grid-cols-2 gap-4 mb-2"><div><label class="text-xs font-semibold text-gray-600 mb-1 block">ÊñΩÂ∑•ÂâçÔºàBeforeÔºâ</label><input type="file" id="beforeImage_' + exampleId + '" accept="image/*" style="display: none;" onchange="handleExampleImage(\'' + exampleId + '\', \'before\', event)"><div id="beforePreview_' + exampleId + '" class="cursor-pointer" onclick="document.getElementById(\'beforeImage_' + exampleId + '\').click()">' + (newExample.beforeImage ? '<img src="' + newExample.beforeImage + '" class="w-full h-32 object-cover rounded" alt="ÊñΩÂ∑•Ââç">' : '<div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-500"><svg class="w-8 h-8 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg><span class="text-xs text-gray-500">„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÁîªÂÉè„ÇíÈÅ∏Êäû</span></div>') + '</div></div><div><label class="text-xs font-semibold text-gray-600 mb-1 block">ÊñΩÂ∑•ÂæåÔºàAfterÔºâ</label><input type="file" id="afterImage_' + exampleId + '" accept="image/*" style="display: none;" onchange="handleExampleImage(\'' + exampleId + '\', \'after\', event)"><div id="afterPreview_' + exampleId + '" class="cursor-pointer" onclick="document.getElementById(\'afterImage_' + exampleId + '\').click()">' + (newExample.afterImage ? '<img src="' + newExample.afterImage + '" class="w-full h-32 object-cover rounded" alt="ÊñΩÂ∑•Âæå">' : '<div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-500"><svg class="w-8 h-8 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg><span class="text-xs text-gray-500">„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÁîªÂÉè„ÇíÈÅ∏Êäû</span></div>') + '</div></div></div><div class="flex justify-end"><button onclick="removeConstructionExample(\'' + exampleId + '\')" class="text-red-600 hover:text-red-800 text-sm"><svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>„Åì„ÅÆ‰∫ã‰æã„ÇíÂâäÈô§</button></div>';
                            examplesList.appendChild(exampleDiv);
                        });
                        console.log('‚úì Loaded construction examples:', examples.length, '‰ª∂');
                    } else {
                        console.log('‚úì No construction examples found');
                    }
                } else {
                    console.log('‚úì No construction examples data in merchantData');
                }
                updateExamplesPreview();
                updateViewData('constructionExamples');
            } catch (error) {
                console.error('[loadConstructionExamples] Error:', error);
                window.constructionExamples = [];
                updateViewData('constructionExamples');
            }
        }

        // „Éó„É¨„Éì„É•„ÉºË®≠ÂÆö„ÇíË™≠„ÅøËæº„Çì„ÅßÈÅ©Áî®
        async function loadPreviewSettings() {
            if (!window.merchantId) {
                console.log('[loadPreviewSettings] merchantId not set');
                return;
            }

            try {
                const result = await callGasApi('getPreviewSettings', {
                    merchantId: window.merchantId
                });
                if (result.success && result.settings) {
                    const settings = result.settings;
                    console.log('[loadPreviewSettings] Loaded settings:', settings);

                    // ÁîªÂÉè‰ΩçÁΩÆ„ÇíÂæ©ÂÖÉ
                    if (settings.imagePositionX !== undefined && settings.imagePositionX !== null) {
                        imagePositionX = parseFloat(settings.imagePositionX);
                        const sliderX = document.getElementById('imagePositionX');
                        if (sliderX) sliderX.value = imagePositionX;
                    }
                    if (settings.imagePositionY !== undefined && settings.imagePositionY !== null) {
                        imagePositionY = parseFloat(settings.imagePositionY);
                        const sliderY = document.getElementById('imagePositionY');
                        if (sliderY) sliderY.value = imagePositionY;
                    }

                    // „Ç∫„Éº„É†„ÇíÂæ©ÂÖÉ
                    if (settings.imageZoom !== undefined && settings.imageZoom !== null) {
                        currentZoom = parseInt(settings.imageZoom);
                        const zoomSlider = document.getElementById('imageZoom');
                        if (zoomSlider) zoomSlider.value = currentZoom;
                    }

                    // ‰ΩçÁΩÆ„Å®„Ç∫„Éº„É†„Çí‰∏ÄÁ∑í„Å´ÈÅ©Áî®Ôºàtransform„Çí1Âõû„Å†„ÅëË®≠ÂÆöÔºâ
                    updateImagePosition();

                    // Êòé„Çã„Åï„ÇíÂæ©ÂÖÉÔºà‰øùÂ≠ò„Åï„Çå„ÅüÂÄ§„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„ÅøÔºâ
                    if (settings.imageBrightness !== undefined) {
                        const brightness = parseInt(settings.imageBrightness);
                        const brightnessSlider = document.getElementById('imageOpacity');
                        if (brightnessSlider) brightnessSlider.value = brightness;
                        adjustImageOpacity(brightness);
                    }

                    // ÊñáÂ≠óËâ≤„ÇíÂæ©ÂÖÉ
                    if (settings.textColor) {
                        currentTextColor = settings.textColor;
                        adjustTextColor(settings.textColor);
                    }

                    // ‰ºöÁ§æÂêçË°®Á§∫„É¢„Éº„Éâ„ÇíÂæ©ÂÖÉ
                    if (settings.companyNameDisplay) {
                        const displaySelect = document.getElementById('previewCompanyDisplaySelect');
                        if (displaySelect) {
                            displaySelect.value = settings.companyNameDisplay;
                            // „Éó„É¨„Éì„É•„Éº„ÇíÊõ¥Êñ∞
                            if (window.updatePreviewCompanyName) {
                                window.updatePreviewCompanyName(settings.companyNameDisplay);
                            }
                        }
                    }

                    console.log('[loadPreviewSettings] Settings applied successfully');
                } else {
                    console.log('[loadPreviewSettings] No saved settings found or failed to load');
                }
            } catch (error) {
                console.error('[loadPreviewSettings] Error:', error);
            }
        }

        // Âè§„ÅÑ renderCaseCards/createCaseCard „ÅØ V2007 „ÅßÁΩÆ„ÅçÊèõ„ÅàÊ∏à„Åø
        // Ë°®Á§∫ÂàáÊõø„ÅØ Tailwind „É¨„Çπ„Éù„É≥„Ç∑„Éñ„ÇØ„É©„Çπ„ÅßËá™ÂãïÔºàmdÊú™Ê∫Ä:„Ç´„Éº„Éâ / md‰ª•‰∏ä:„É™„Çπ„ÉàÔºâ

        // Âè§„ÅÑ„Éï„Ç£„É´„Çø„ÉºÈñ¢ÈÄ£„ÅØ V2007 „ÅßÊñ∞ÂÆüË£Ö„Å´ÁΩÆ„ÅçÊèõ„ÅàÊ∏à„Åø
        // getStatusColor „ÅØÂè§„ÅÑ„ÉÄ„Éü„Éº„Ç≥„Éº„ÉâÁî®„Å†„Åå„ÄÅ‰∏ÄÈÉ®„Åß‰Ωø„Çè„Çå„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çã„ÅÆ„ÅßÊÆã„Åô
        // ‚Äª statusStyles „Å®Áµ±‰∏ÄÔºàÊ∏©Â∫¶ÊÑü: Èùí=„Éï„É¨„ÉÉ„Ç∑„É• ‚Üí „Ç™„É¨„É≥„Ç∏=Ê∏© ‚Üí Á∑ë=ÊàêÁ¥Ñ ‚Üí „Ç∞„É¨„Éº=ÁµÇ‰∫ÜÔºâ
        function getStatusColor(status) {
            const statusColors = {
                'Êñ∞ÁùÄ': 'bg-blue-100 text-blue-800',
                'Êú™ÂØæÂøú': 'bg-blue-100 text-blue-800',
                'ÂØæÂøúÂæÖ„Å°': 'bg-blue-100 text-blue-800',
                'Êú™„Ç¢„Éù': 'bg-pink-100 text-pink-700',
                'Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù': 'bg-pink-100 text-pink-700',
                '„Ç¢„ÉùÊ∏à': 'bg-orange-100 text-orange-800',
                'Ë®™ÂïèÊ∏à„Åø': 'bg-orange-100 text-orange-800',
                'ÁèæË™øÊ∏à': 'bg-purple-100 text-purple-800',
                'Ë¶ãÁ©çÊèêÂá∫Ê∏à': 'bg-amber-100 text-amber-800',
                'Ë¶ãÁ©çÊèêÂá∫Ê∏à„Åø': 'bg-amber-100 text-amber-800',
                'ÂÖ•Èáë‰∫àÂÆö': 'bg-cyan-100 text-cyan-800',
                'ÊàêÁ¥Ñ': 'bg-green-100 text-green-800',
                'ÂÖ•ÈáëÊ∏à': 'bg-emerald-100 text-emerald-800',
                'ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´': 'bg-gray-100 text-gray-600',
                'ÁèæË™øÂæåÂ§±Ê≥®': 'bg-gray-200 text-gray-700',
                '‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à': 'bg-gray-100 text-gray-600',
                'Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à': 'bg-indigo-100 text-indigo-700',
                '„Ç≠„É£„É≥„Çª„É´': 'bg-gray-100 text-gray-600',
                '„ÇØ„É¨„Éº„É†': 'bg-red-100 text-red-800'
            };
            return statusColors[status] || 'bg-blue-100 text-blue-800';
        }

        // Ê°à‰ª∂ÊåØ„ÇäÂàÜ„Åë„É¢„Éº„ÉÄ„É´
        function openAssignmentModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.id = 'assignmentModal';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-4 sm:p-6 w-full max-w-6xl max-h-[90vh] overflow-y-auto mx-2 sm:mx-4">
                    <div class="flex justify-between items-center mb-4 sm:mb-6">
                        <h3 class="text-lg sm:text-xl font-bold">Ê°à‰ª∂ÊåØ„ÇäÂàÜ„Åë</h3>
                        <button onclick="closeAssignmentModal()" class="text-gray-500 hover:text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- ÊåØ„ÇäÂàÜ„ÅëË®≠ÂÆö -->
                    <div class="bg-gray-50 rounded-lg p-3 sm:p-4 mb-4 sm:mb-6">
                        <h4 class="font-semibold mb-2 sm:mb-3 text-sm sm:text-base">ÊåØ„ÇäÂàÜ„ÅëÊñπÊ≥ï</h4>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3">
                            <div>
                                <label class="flex items-center">
                                    <input type="radio" name="assignMethod" value="area" class="mr-1 sm:mr-2" onchange="updateAssignmentSuggestion()">
                                    <span class="text-xs sm:text-sm">„Ç®„É™„Ç¢ÂÑ™ÂÖà</span>
                                </label>
                            </div>
                            <div>
                                <label class="flex items-center">
                                    <input type="radio" name="assignMethod" value="workload" class="mr-1 sm:mr-2" onchange="updateAssignmentSuggestion()">
                                    <span class="text-xs sm:text-sm">Ê°à‰ª∂Êï∞ÂÑ™ÂÖà</span>
                                </label>
                            </div>
                            <div>
                                <label class="flex items-center">
                                    <input type="radio" name="assignMethod" value="performance" class="mr-1 sm:mr-2" onchange="updateAssignmentSuggestion()">
                                    <span class="text-xs sm:text-sm">ÊàêÁ¥ÑÁéáÂÑ™ÂÖà</span>
                                </label>
                            </div>
                            <div>
                                <label class="flex items-center">
                                    <input type="radio" name="assignMethod" value="auto" class="mr-1 sm:mr-2" checked onchange="updateAssignmentSuggestion()">
                                    <span class="text-xs sm:text-sm">Á∑èÂêàÂà§ÂÆö</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-2 sm:gap-4 lg:gap-6">
                        <!-- Â∑¶ÂÅ¥ÔºöÂñ∂Ê•≠ÊãÖÂΩìËÄÖÔºà„Éâ„É©„ÉÉ„Ç∞ÂÖÉÔºâ -->
                        <div>
                            <h4 class="font-semibold mb-2 sm:mb-3 text-xs sm:text-sm lg:text-base">Âñ∂Ê•≠ÊãÖÂΩìËÄÖ</h4>
                            <div class="space-y-2 sm:space-y-3">
                                <!-- Áî∞‰∏≠Â§™ÈÉé -->
                                <div class="assignee-card bg-white border rounded-lg p-2 sm:p-3 cursor-move hover:shadow-md transition-shadow" draggable="true" data-assignee-id="tanaka" data-assignee-name="Áî∞‰∏≠Â§™ÈÉé">
                                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-1 sm:mb-2">
                                        <div class="min-w-0 flex-1">
                                            <span class="font-medium text-xs sm:text-sm">üë§ Áî∞‰∏≠Â§™ÈÉé</span>
                                            <span class="hidden sm:inline text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded ml-2">„É™„Éº„ÉÄ„Éº</span>
                                        </div>
                                        <div class="text-xs text-gray-500">
                                            <span class="font-bold">3‰ª∂</span>
                                        </div>
                                    </div>
                                    <div class="hidden sm:block text-xs text-gray-600">
                                        ‰∏ñÁî∞Ë∞∑Âå∫ | 75%
                                    </div>
                                </div>
                                <!-- ‰ΩêËó§Ëä±Â≠ê -->
                                <div class="assignee-card bg-white border rounded-lg p-2 sm:p-3 cursor-move hover:shadow-md transition-shadow" draggable="true" data-assignee-id="sato" data-assignee-name="‰ΩêËó§Ëä±Â≠ê">
                                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-1 sm:mb-2">
                                        <div class="min-w-0 flex-1">
                                            <span class="font-medium text-xs sm:text-sm">üë§ ‰ΩêËó§Ëä±Â≠ê</span>
                                            <span class="hidden sm:inline text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded ml-2">‰∏ÄËà¨Âñ∂Ê•≠</span>
                                        </div>
                                        <div class="text-xs text-gray-500">
                                            <span class="font-bold">5‰ª∂</span>
                                        </div>
                                    </div>
                                    <div class="hidden sm:block text-xs text-gray-600">
                                        Ê®™ÊµúÂ∏Ç | 62%
                                    </div>
                                </div>
                                <!-- Â±±Áî∞Ê¨°ÈÉé -->
                                <div class="assignee-card bg-white border rounded-lg p-2 sm:p-3 cursor-move hover:shadow-md transition-shadow" draggable="true" data-assignee-id="yamada" data-assignee-name="Â±±Áî∞Ê¨°ÈÉé">
                                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-1 sm:mb-2">
                                        <div class="min-w-0 flex-1">
                                            <span class="font-medium text-xs sm:text-sm">üë§ Â±±Áî∞Ê¨°ÈÉé</span>
                                            <span class="hidden sm:inline text-xs bg-gray-100 text-gray-800 px-2 py-1 rounded ml-2">Êñ∞‰∫∫</span>
                                        </div>
                                        <div class="text-xs text-gray-500">
                                            <span class="font-bold">2‰ª∂</span>
                                        </div>
                                    </div>
                                    <div class="hidden sm:block text-xs text-gray-600">
                                        ÂçÉËëâÂ∏Ç | 40%
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Âè≥ÂÅ¥ÔºöÊú™Ââ≤ÂΩìÊ°à‰ª∂Ôºà„Éâ„É≠„ÉÉ„ÉóÂÖàÔºâ -->
                        <div>
                            <h4 class="font-semibold mb-2 sm:mb-3 text-xs sm:text-sm lg:text-base">Êú™Ââ≤ÂΩìÊ°à‰ª∂</h4>
                            <div class="bg-gray-50 border rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 min-h-[400px] overflow-y-auto" id="unassignedCases">
                                <!-- Êú™Ââ≤ÂΩìÊ°à‰ª∂„Ç´„Éº„Éâ -->
                                <div class="case-drop-zone bg-yellow-50 border-2 border-yellow-200 rounded-lg p-2 sm:p-3 hover:bg-yellow-100 transition-colors" data-case-id="101">
                                    <div class="flex justify-between items-start mb-1 sm:mb-2">
                                        <span class="text-xs sm:text-sm font-semibold">È´òÊ©ãÊßò</span>
                                        <span class="text-xs bg-yellow-100 text-yellow-800 px-1 sm:px-2 py-0.5 sm:py-1 rounded">Êñ∞Ë¶è</span>
                                    </div>
                                    <p class="text-xs text-gray-600 mb-0.5 sm:mb-1">üìç ‰∏ñÁî∞Ë∞∑Âå∫</p>
                                    <p class="text-xs text-gray-600 mb-0.5 sm:mb-1 hidden sm:block">üè† Êà∏Âª∫„Å¶„ÉªÁØâ12Âπ¥</p>
                                    <p class="text-xs text-gray-600 mb-1 sm:mb-2 hidden sm:block">üìû 090-1234-5678</p>
                                    <!-- ÊãÖÂΩìËÄÖ„Éâ„É≠„ÉÉ„Éó„Ç®„É™„Ç¢ -->
                                    <div class="assignee-drop-area bg-white border-2 border-dashed border-gray-300 rounded-lg p-1 sm:p-2 min-h-[30px] sm:min-h-[40px]">
                                        <p class="text-xs text-gray-400 text-center">„Éâ„É≠„ÉÉ„Éó</p>
                                    </div>
                                    <div class="mt-1 sm:mt-2 pt-1 sm:pt-2 border-t hidden sm:block">
                                        <p class="text-xs text-blue-600 font-medium">
                                            Êé®Â•®: Áî∞‰∏≠Â§™ÈÉé
                                        </p>
                                    </div>
                                </div>
                                <div class="case-drop-zone bg-yellow-50 border-2 border-yellow-200 rounded-lg p-2 sm:p-3 hover:bg-yellow-100 transition-colors" data-case-id="102">
                                    <div class="flex justify-between items-start mb-1 sm:mb-2">
                                        <span class="text-xs sm:text-sm font-semibold">ÊñéËó§Êßò</span>
                                        <span class="text-xs bg-yellow-100 text-yellow-800 px-1 sm:px-2 py-0.5 sm:py-1 rounded">Êñ∞Ë¶è</span>
                                    </div>
                                    <p class="text-xs text-gray-600 mb-0.5 sm:mb-1">üìç Ê®™ÊµúÂ∏Ç</p>
                                    <p class="text-xs text-gray-600 mb-0.5 sm:mb-1 hidden sm:block">üè¢ „Ç¢„Éë„Éº„Éà„ÉªÁØâ18Âπ¥</p>
                                    <p class="text-xs text-gray-600 mb-1 sm:mb-2 hidden sm:block">üìû 045-9876-5432</p>
                                    <!-- ÊãÖÂΩìËÄÖ„Éâ„É≠„ÉÉ„Éó„Ç®„É™„Ç¢ -->
                                    <div class="assignee-drop-area bg-white border-2 border-dashed border-gray-300 rounded-lg p-1 sm:p-2 min-h-[30px] sm:min-h-[40px]">
                                        <p class="text-xs text-gray-400 text-center">„Éâ„É≠„ÉÉ„Éó</p>
                                    </div>
                                    <div class="mt-1 sm:mt-2 pt-1 sm:pt-2 border-t hidden sm:block">
                                        <p class="text-xs text-blue-600 font-medium">
                                            Êé®Â•®: ‰ΩêËó§Ëä±Â≠ê
                                        </p>
                                    </div>
                                </div>
                                <div class="case-drop-zone bg-yellow-50 border-2 border-yellow-200 rounded-lg p-2 sm:p-3 hover:bg-yellow-100 transition-colors" data-case-id="103">
                                    <div class="flex justify-between items-start mb-1 sm:mb-2">
                                        <span class="text-xs sm:text-sm font-semibold">Ê∏°Ëæ∫Êßò</span>
                                        <span class="text-xs bg-yellow-100 text-yellow-800 px-1 sm:px-2 py-0.5 sm:py-1 rounded">Êñ∞Ë¶è</span>
                                    </div>
                                    <p class="text-xs text-gray-600 mb-0.5 sm:mb-1">üìç „Åï„ÅÑ„Åü„ÅæÂ∏Ç</p>
                                    <p class="text-xs text-gray-600 mb-0.5 sm:mb-1 hidden sm:block">üè† Êà∏Âª∫„Å¶„ÉªÁØâ20Âπ¥</p>
                                    <p class="text-xs text-gray-600 mb-1 sm:mb-2 hidden sm:block">üìû 048-5555-6666</p>
                                    <!-- ÊãÖÂΩìËÄÖ„Éâ„É≠„ÉÉ„Éó„Ç®„É™„Ç¢ -->
                                    <div class="assignee-drop-area bg-white border-2 border-dashed border-gray-300 rounded-lg p-1 sm:p-2 min-h-[30px] sm:min-h-[40px]">
                                        <p class="text-xs text-gray-400 text-center">„Éâ„É≠„ÉÉ„Éó</p>
                                    </div>
                                    <div class="mt-1 sm:mt-2 pt-1 sm:pt-2 border-t hidden sm:block">
                                        <p class="text-xs text-orange-600 font-medium">
                                            Êé®Â•®: Ë§áÊï∞ÊãÖÂΩì
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
                    <div class="flex flex-col sm:flex-row justify-between items-center mt-4 sm:mt-6 pt-4 sm:pt-6 border-t gap-3">
                        <button onclick="autoAssignAll()" class="w-full sm:w-auto px-3 sm:px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm sm:text-base">
                            ‰∏ÄÊã¨Ëá™ÂãïÊåØ„ÇäÂàÜ„Åë
                        </button>
                        <div class="flex w-full sm:w-auto space-x-2 sm:space-x-3">
                            <button onclick="closeAssignmentModal()" class="flex-1 sm:flex-none px-3 sm:px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 text-sm sm:text-base">
                                „Ç≠„É£„É≥„Çª„É´
                            </button>
                            <button onclick="confirmAssignment()" class="flex-1 sm:flex-none px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm sm:text-base">
                                ÊåØ„ÇäÂàÜ„Åë„ÇíÁ¢∫ÂÆö
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            initDragAndDrop();
        }

        // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeAssignmentModal() {
            const modal = document.getElementById('assignmentModal');
            if (modal) modal.remove();
        }

        // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóÂàùÊúüÂåñ
        function initDragAndDrop() {
            let draggedElement = null;

            // ÊãÖÂΩìËÄÖ„Ç´„Éº„Éâ„ÅÆ„Éâ„É©„ÉÉ„Ç∞ÈñãÂßã
            document.querySelectorAll('.assignee-card').forEach(card => {
                card.addEventListener('dragstart', (e) => {
                    draggedElement = e.target.closest('.assignee-card');
                    e.target.style.opacity = '0.5';
                    e.dataTransfer.effectAllowed = 'copy';
                });

                card.addEventListener('dragend', (e) => {
                    e.target.style.opacity = '';
                });
            });

            // Ê°à‰ª∂„Ç´„Éº„ÉâÂÖ®‰Ωì„Çí„Éâ„É≠„ÉÉ„Éó„Ç®„É™„Ç¢„Å´Ë®≠ÂÆö
            document.querySelectorAll('.case-drop-zone').forEach(caseCard => {
                const dropArea = caseCard.querySelector('.assignee-drop-area');
                caseCard.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'copy';
                    caseCard.classList.add('bg-blue-50', 'border-blue-400');
                });

                caseCard.addEventListener('dragleave', (e) => {
                    // Â≠êË¶ÅÁ¥†„Å∏„ÅÆÁßªÂãï„ÅØÁÑ°Ë¶ñ
                    if (!caseCard.contains(e.relatedTarget)) {
                        caseCard.classList.remove('bg-blue-50', 'border-blue-400');
                    }
                });

                caseCard.addEventListener('drop', (e) => {
                    e.preventDefault();
                    caseCard.classList.remove('bg-blue-50', 'border-blue-400');

                    if (draggedElement) {
                        const assigneeId = draggedElement.dataset.assigneeId;
                        const assigneeName = draggedElement.dataset.assigneeName;
                        const caseId = caseCard.dataset.caseId;

                        // ÈÄöÂ∏∏„ÅÆÊãÖÂΩìËÄÖ„ÇíËøΩÂä†ÔºàË§áÊï∞ÂèØÔºâ
                        const newTag = document.createElement('div');
                        newTag.className = 'assignee-tag bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-medium flex items-center justify-between mb-1';
                        newTag.innerHTML = `
                            <span>üë§ ${assigneeName}</span>
                            <button onclick="removeAssignee(this)" class="ml-2 text-blue-600 hover:text-blue-800">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        `;

                        // „Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº„ÉÜ„Ç≠„Çπ„Éà„Åå„ÅÇ„Çå„Å∞ÂâäÈô§
                        const placeholder = dropArea.querySelector('.text-gray-400');
                        if (placeholder) {
                            placeholder.remove();
                        }

                        // Âêå„ÅòÊãÖÂΩìËÄÖ„ÅåÊó¢„Å´Ââ≤„ÇäÂΩì„Å¶„Çâ„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                        const existingAssignees = Array.from(dropArea.querySelectorAll('.assignee-tag')).map(tag =>
                            tag.querySelector('span').textContent.replace('üë§ ', '')
                        );

                        if (!existingAssignees.includes(assigneeName)) {
                            dropArea.appendChild(newTag);
                            caseCard.classList.add('border-blue-400');
                        } else {
                            showNotification('Êó¢„Å´Ââ≤„ÇäÂΩì„Å¶Ê∏à„Åø', `${assigneeName}„ÅØÊó¢„Å´„Åì„ÅÆÊ°à‰ª∂„Å´Ââ≤„ÇäÂΩì„Å¶„Çâ„Çå„Å¶„ÅÑ„Åæ„Åô`);
                        }
                    }
                });
            });
        }

        // ÊãÖÂΩìËÄÖ„ÇíÂâäÈô§
        function removeAssignee(button) {
            const tag = button.closest('.assignee-tag');
            const dropArea = tag.closest('.assignee-drop-area');
            tag.remove();

            // ÊãÖÂΩìËÄÖ„Åå„ÅÑ„Å™„Åè„Å™„Å£„Åü„Çâ„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº„ÇíË°®Á§∫
            if (dropArea.querySelectorAll('.assignee-tag').length === 0) {
                dropArea.innerHTML = '<p class="text-xs text-gray-400 text-center">ÊãÖÂΩìËÄÖ„Çí„Åì„Åì„Å´„Éâ„É≠„ÉÉ„Éó</p>';
                const caseCard = dropArea.closest('.case-drop-zone');
                caseCard.classList.remove('border-blue-400');
            }
        }

        // ÊåØ„ÇäÂàÜ„ÅëÊñπÊ≥ïÂ§âÊõ¥ÊôÇ„ÅÆÊé®Â•®Êõ¥Êñ∞
        function updateAssignmentSuggestion() {
            const method = document.querySelector('input[name="assignMethod"]:checked').value;
            const caseCards = document.querySelectorAll('.case-card');

            caseCards.forEach(card => {
                const suggestionEl = card.querySelector('.text-blue-600, .text-orange-600');
                if (suggestionEl) {
                    switch(method) {
                        case 'area':
                            suggestionEl.textContent = 'Êé®Â•®: „Ç®„É™„Ç¢„Éû„ÉÉ„ÉÅ„Åô„ÇãÊãÖÂΩìËÄÖ';
                            break;
                        case 'workload':
                            suggestionEl.textContent = 'Êé®Â•®: Ê°à‰ª∂Êï∞„ÅåÂ∞ë„Å™„ÅÑÊãÖÂΩìËÄÖ';
                            break;
                        case 'performance':
                            suggestionEl.textContent = 'Êé®Â•®: ÊàêÁ¥ÑÁéá„ÅåÈ´ò„ÅÑÊãÖÂΩìËÄÖ';
                            break;
                        case 'auto':
                            // ÂÖÉ„ÅÆÊé®Â•®„Å´Êàª„Åô
                            break;
                    }
                }
            });
        }

        // ‰∏ÄÊã¨Ëá™ÂãïÊåØ„ÇäÂàÜ„Åë
        function autoAssignAll() {
            const method = document.querySelector('input[name="assignMethod"]:checked').value;
            const caseCards = document.querySelectorAll('.case-drop-zone');

            caseCards.forEach(caseCard => {
                const caseId = caseCard.dataset.caseId;
                const dropArea = caseCard.querySelector('.assignee-drop-area');

                // Êó¢„Å´ÊãÖÂΩìËÄÖ„ÅåÂâ≤„ÇäÂΩì„Å¶„Çâ„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„Çπ„Ç≠„ÉÉ„Éó
                if (dropArea.querySelector('.assignee-tag')) {
                    return;
                }

                // Á∞°ÊòìÁöÑ„Å™Ëá™ÂãïÊåØ„ÇäÂàÜ„Åë„É≠„Ç∏„ÉÉ„ÇØÔºà„Éá„É¢Áî®Ôºâ
                let assigneeName = '';
                let assigneeType = 'normal';

                if (caseId === '101') {
                    assigneeName = 'Áî∞‰∏≠Â§™ÈÉé';
                } else if (caseId === '102') {
                    assigneeName = '‰ΩêËó§Ëä±Â≠ê';
                } else if (caseId === '103') {
                    // 3Áï™ÁõÆ„ÅÆÊ°à‰ª∂„ÇÇÈÄöÂ∏∏„ÅÆÊãÖÂΩìËÄÖ„ÇíÂâ≤„ÇäÂΩì„Å¶
                    assigneeName = 'Â±±Áî∞Ê¨°ÈÉé';
                }

                // ÊãÖÂΩìËÄÖ„Çø„Ç∞„ÇíËøΩÂä†
                if (assigneeName) {
                    dropArea.innerHTML = `
                        <div class="assignee-tag bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-medium flex items-center justify-between">
                            <span>üë§ ${assigneeName}</span>
                            <button onclick="removeAssignee(this)" class="ml-2 text-blue-600 hover:text-blue-800">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    `;
                    caseCard.classList.add('border-blue-400');
                }
            });

            showNotification('Ëá™ÂãïÊåØ„ÇäÂàÜ„ÅëÂÆå‰∫Ü', 'Êé®Â•®ÊãÖÂΩìËÄÖ„Å´Ê°à‰ª∂„ÇíÊåØ„ÇäÂàÜ„Åë„Åæ„Åó„Åü');
        }

        // ÊåØ„ÇäÂàÜ„ÅëÁ¢∫ÂÆö
        function confirmAssignment() {
            const assignments = [];
            const caseCards = document.querySelectorAll('.case-drop-zone');

            caseCards.forEach(caseCard => {
                const caseId = caseCard.dataset.caseId;
                const dropArea = caseCard.querySelector('.assignee-drop-area');
                const assigneeTags = dropArea.querySelectorAll('.assignee-tag');

                if (assigneeTags.length > 0) {
                    const customerName = caseCard.querySelector('.font-semibold').textContent;
                    const assignees = Array.from(assigneeTags).map(tag =>
                        tag.querySelector('span').textContent.replace('üë§ ', '')
                    );

                    assignments.push({
                        caseId: caseId,
                        customerName: customerName,
                        assignees: assignees
                    });
                }
            });

            if (assignments.length > 0) {
                let message = '‰ª•‰∏ã„ÅÆÊåØ„ÇäÂàÜ„Åë„ÇíÁ¢∫ÂÆö„Åó„Åæ„Åó„Åü:\n';
                assignments.forEach(a => {
                    message += `${a.customerName} ‚Üí ${a.assignees.join(', ')}\n`;
                });

                showNotification('ÊåØ„ÇäÂàÜ„ÅëÂÆå‰∫Ü', message);

                // Êú™ÊåØ„ÇäÂàÜ„ÅëÊ°à‰ª∂„Åã„ÇâÂâäÈô§
                assignments.forEach(a => {
                    const index = unassignedCases.findIndex(c => c.id == a.caseId);
                    if (index !== -1) {
                        unassignedCases.splice(index, 1);
                    }
                });
                closeAssignmentModal();
            } else {
                alert('ÊåØ„ÇäÂàÜ„Åë„ÇãÊ°à‰ª∂„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            }
        }

        // Ê°à‰ª∂Ë©≥Á¥∞Ë°®Á§∫
        function showCaseDetail(caseId) {
            const caseData = casesData.find(c => c.id === caseId);
            if (!caseData) return;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-start mb-4">
                        <h2 class="text-2xl font-bold">${caseData.name}Êßò</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥ -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">„Çπ„ÉÜ„Éº„Çø„Çπ</label>
                        <select id="caseStatus" onchange="updateCaseStatus(${caseId}, this.value)" class="w-full md:w-auto px-4 py-2 border rounded-lg">
                            <option value="Êú™ÂØæÂøú" ${caseData.status === 'Êú™ÂØæÂøú' ? 'selected' : ''}>Êú™ÂØæÂøú</option>
                            <option value="Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù" ${caseData.status === 'Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù' ? 'selected' : ''}>Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù</option>
                            <option value="„Ç¢„ÉùÊ∏à" ${caseData.status === '„Ç¢„ÉùÊ∏à' ? 'selected' : ''}>„Ç¢„ÉùÊ∏à</option>
                            <option value="ÁèæË™øÊ∏à" ${caseData.status === 'ÁèæË™øÊ∏à' ? 'selected' : ''}>ÁèæË™øÊ∏à</option>
                            <option value="ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´" ${caseData.status === 'ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´' ? 'selected' : ''}>ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´</option>
                            <option value="ÁèæË™øÂæåÂ§±Ê≥®" ${caseData.status === 'ÁèæË™øÂæåÂ§±Ê≥®' ? 'selected' : ''}>ÁèæË™øÂæåÂ§±Ê≥®</option>
                            <option value="Ë¶ãÁ©çÊèêÂá∫Ê∏à" ${caseData.status === 'Ë¶ãÁ©çÊèêÂá∫Ê∏à' ? 'selected' : ''}>Ë¶ãÁ©çÊèêÂá∫Ê∏à</option>
                            <option value="ÊàêÁ¥Ñ" ${caseData.status === 'ÊàêÁ¥Ñ' ? 'selected' : ''}>ÊàêÁ¥Ñ</option>
                            <option value="‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à" ${caseData.status === '‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à' ? 'selected' : ''}>‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à</option>
                            <option value="Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à" ${caseData.status === 'Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à' ? 'selected' : ''}>Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à</option>
                            <option value="ÂÖ•Èáë‰∫àÂÆö" ${caseData.status === 'ÂÖ•Èáë‰∫àÂÆö' ? 'selected' : ''}>ÂÖ•Èáë‰∫àÂÆö</option>
                            <option value="ÂÖ•ÈáëÊ∏à" ${caseData.status === 'ÂÖ•ÈáëÊ∏à' ? 'selected' : ''}>ÂÖ•ÈáëÊ∏à</option>
                            <option value="„ÇØ„É¨„Éº„É† or Â§±Ê≥®" ${caseData.status === '„ÇØ„É¨„Éº„É† or Â§±Ê≥®' ? 'selected' : ''}>„ÇØ„É¨„Éº„É† or Â§±Ê≥®</option>
                        </select>
                    </div>

                    <!-- Âü∫Êú¨ÊÉÖÂ†± -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <p class="text-sm text-gray-600">‰ΩèÊâÄ</p>
                            <p class="font-medium">${caseData.location}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Áâ©‰ª∂Á®ÆÂà•</p>
                            <p class="font-medium">${caseData.propertyType}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">ÈõªË©±Áï™Âè∑</p>
                            <p class="font-medium">${caseData.phone}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">ÊãÖÂΩìËÄÖ</p>
                            <p class="font-medium">${caseData.assignee || 'Êú™Ââ≤ÂΩì'}</p>
                        </div>
                    </div>

                    <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
                    <div class="flex flex-wrap gap-2 mb-6">
                        <button onclick="callCustomer('${caseData.phone}')" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
                            üìû ÈõªË©±
                        </button>
                        <button onclick="sendSMS('${caseData.phone}', ${caseData.id})" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                            üì© SMS
                        </button>
                        <button onclick="showMemo(${caseId})" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600">
                            üìù „É°„É¢
                        </button>
                        <button onclick="passCase(${caseId})" class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600">
                            üîÑ Âºï„ÅçÁ∂ô„Åé
                        </button>
                    </div>

                    <!-- Ê¥ªÂãïÂ±•Ê≠¥ -->
                    <div class="border-t pt-4">
                        <h3 class="font-bold mb-3">Ê¥ªÂãïÂ±•Ê≠¥</h3>
                        <div class="space-y-2 max-h-48 overflow-y-auto">
                            ${getActivityHistory(caseId)}
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // „Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞
        function updateCaseStatus(caseId, newStatus) {
            const currentUser = getCurrentUser();
            const timestamp = new Date().toLocaleString('ja-JP', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            }).replace(/\//g, '/');

            // „Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥Â±•Ê≠¥„ÇíË®òÈå≤ÔºàÂÆüÈöõ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅØAPI„Å´ÈÄÅ‰ø°Ôºâ
            const statusChangeEntry = {
                timestamp: timestamp,
                type: 'status_change',
                user: currentUser.name,
                oldStatus: casesData.find(c => c.id === caseId)?.status,
                newStatus: newStatus,
                caseId: caseId
            };

            // „Åì„Åì„ÅßAPI„Å´ÈÄÅ‰ø°
            console.log('Recording status change:', statusChangeEntry);

            // „É≠„Éº„Ç´„É´„Éá„Éº„Çø„ÇíÊõ¥Êñ∞
            const caseData = casesData.find(c => c.id === caseId);
            if (caseData) {
                caseData.status = newStatus;
            }

            // UI„ÇíÊõ¥Êñ∞
            updateCaseCard(caseId);

            // „Ç´„É¨„É≥„ÉÄ„Éº„ÅÆËá™ÂãïÂêåÊúü
            autoSyncToCalendar();

            showNotification('„Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞', `„Çπ„ÉÜ„Éº„Çø„Çπ„Çí„Äå${newStatus}„Äç„Å´Â§âÊõ¥„Åó„Åæ„Åó„Åü`);
        }

        // Ê¥ªÂãïÂ±•Ê≠¥ÂèñÂæó
        function getActivityHistory(caseId) {
            // „Çµ„É≥„Éó„É´„Éá„Éº„ÇøÔºàÂÆüÈöõ„ÅØAPI„Åã„ÇâÂèñÂæóÔºâ
            const histories = {
                1: `
                    <div class="text-sm border-l-2 border-gray-300 pl-3">
                        <div class="text-xs text-gray-500">2024/03/16 14:00</div>
                        <div>„Äê„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥„ÄëÊú™ÂØæÂøú ‚Üí „Ç¢„ÉùÊ∏àÔºàÁî∞‰∏≠Â§™ÈÉéÔºâ</div>
                    </div>
                    <div class="text-sm border-l-2 border-gray-300 pl-3">
                        <div class="text-xs text-gray-500">2024/03/16 13:30</div>
                        <div>„ÄêÊû∂Èõª„Äë03-1234-5678ÔºàÁî∞‰∏≠Â§™ÈÉéÔºâ</div>
                    </div>
                    <div class="text-sm border-l-2 border-gray-300 pl-3">
                        <div class="text-xs text-gray-500">2024/03/15 16:00</div>
                        <div>„Äê„É°„É¢ËøΩÂä†„Äë‰∫àÁÆóÊÑüÁ¢∫Ë™çÊ∏à„ÅøÔºàÁî∞‰∏≠Â§™ÈÉéÔºâ</div>
                    </div>
                `
            };

            return histories[caseId] || '<div class="text-gray-400 text-sm">Â±•Ê≠¥„Å™„Åó</div>';
        }

        // Ê°à‰ª∂„Ç´„Éº„ÉâUIÊõ¥Êñ∞
        function updateCaseCard(caseId) {
            const caseData = casesData.find(c => c.id === caseId);
            if (!caseData) return;

            const cards = document.querySelectorAll(`[onclick="showCaseDetail(${caseId})"]`);
            cards.forEach(card => {
                // „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„ÉÉ„Ç∏„ÇíÊõ¥Êñ∞
                const statusBadge = card.querySelector('span[class*="rounded-full"]');
                if (statusBadge) {
                    const statusColors = {
                        'Êú™ÂØæÂøú': 'bg-red-100 text-red-800',
                        'Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù': 'bg-orange-100 text-orange-800',
                        '„Ç¢„ÉùÊ∏à': 'bg-blue-100 text-blue-800',
                        'ÁèæË™øÊ∏à': 'bg-indigo-100 text-indigo-800',
                        'ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´': 'bg-gray-100 text-gray-800',
                        'ÁèæË™øÂæåÂ§±Ê≥®': 'bg-gray-100 text-gray-800',
                        'Ë¶ãÁ©çÊèêÂá∫Ê∏à': 'bg-yellow-100 text-yellow-800',
                        'ÊàêÁ¥Ñ': 'bg-green-100 text-green-800',
                        '‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à': 'bg-gray-100 text-gray-800',
                        'Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à': 'bg-purple-100 text-purple-800',
                        'ÂÖ•Èáë‰∫àÂÆö': 'bg-cyan-100 text-cyan-800',
                        'ÂÖ•ÈáëÊ∏à': 'bg-emerald-100 text-emerald-800',
                        '„ÇØ„É¨„Éº„É† or Â§±Ê≥®': 'bg-red-100 text-red-800'
                    };

                    statusBadge.className = `px-2 py-1 text-xs font-semibold rounded-full ${statusColors[caseData.status] || 'bg-gray-100 text-gray-800'}`;
                    statusBadge.textContent = caseData.status;
                }
            });
        }

        // „Çπ„Ç±„Ç∏„É•„Éº„É´Ë®≠ÂÆö
        function scheduleCase(caseId) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
                    <h3 class="text-lg font-bold mb-4">üìÖ „Çπ„Ç±„Ç∏„É•„Éº„É´Ë®≠ÂÆö</h3>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Êó•‰ªò</label>
                        <input type="date" id="scheduleDate" class="w-full p-2 border rounded-lg" value="${new Date().toISOString().split('T')[0]}">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÊôÇÈñì</label>
                        <input type="time" id="scheduleTime" class="w-full p-2 border rounded-lg" value="14:00">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">‰∫àÂÆöÂÜÖÂÆπ</label>
                        <select id="scheduleType" class="w-full p-2 border rounded-lg">
                            <option value="Êû∂Èõª">Êû∂Èõª</option>
                            <option value="Ë®™Âïè">Ë®™Âïè</option>
                            <option value="ÁèæÂú∞Ë™øÊüª">ÁèæÂú∞Ë™øÊüª</option>
                            <option value="Ë¶ãÁ©çÊèêÂá∫">Ë¶ãÁ©çÊèêÂá∫</option>
                            <option value="Â•ëÁ¥Ñ">Â•ëÁ¥Ñ</option>
                            <option value="Â∑•‰∫ã">Â∑•‰∫ã</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">„É°„É¢</label>
                        <textarea id="scheduleMemo" class="w-full p-2 border rounded-lg" rows="2" placeholder="ÂÇôËÄÉ..."></textarea>
                    </div>
                    <div class="flex justify-end gap-2">
                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                        <button onclick="saveSchedule(${caseId})" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            ‰øùÂ≠ò
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // „Çπ„Ç±„Ç∏„É•„Éº„É´‰øùÂ≠ò
        function saveSchedule(caseId) {
            const date = document.getElementById('scheduleDate').value;
            const time = document.getElementById('scheduleTime').value;
            const type = document.getElementById('scheduleType').value;
            const memo = document.getElementById('scheduleMemo').value;

            // „Çπ„Ç±„Ç∏„É•„Éº„É´„Çí‰øùÂ≠òÔºàÂÆüÈöõ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅØAPI„Å´ÈÄÅ‰ø°Ôºâ
            console.log('Saving schedule:', { caseId, date, time, type, memo });

            showNotification('„Çπ„Ç±„Ç∏„É•„Éº„É´ÁôªÈå≤', `${date} ${time} „Å´${type}„Çí‰∫àÂÆö„Åó„Åæ„Åó„Åü`);
            document.querySelector('.fixed').remove();
        }

        // „ÇØ„Ç§„ÉÉ„ÇØ„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥
        function quickStatusChange(caseId) {
            const caseData = casesData.find(c => c.id === caseId);
            if (!caseData) return;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
                    <h3 class="text-lg font-bold mb-4">„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥</h3>
                    <div class="mb-4">
                        <p class="text-sm text-gray-600 mb-2">ÁèæÂú®: <span class="font-medium">${caseData.status}</span></p>
                    </div>
                    <div class="grid grid-cols-2 gap-2 mb-4 max-h-96 overflow-y-auto">
                        <button onclick="updateStatusAndClose(${caseId}, 'Êú™ÂØæÂøú')" class="px-3 py-2 bg-red-100 text-red-800 rounded-lg hover:bg-red-200 text-sm">
                            Êú™ÂØæÂøú
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, 'Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù')" class="px-3 py-2 bg-orange-100 text-orange-800 rounded-lg hover:bg-orange-200 text-sm">
                            Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, '„Ç¢„ÉùÊ∏à')" class="px-3 py-2 bg-blue-100 text-blue-800 rounded-lg hover:bg-blue-200 text-sm">
                            „Ç¢„ÉùÊ∏à
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, 'ÁèæË™øÊ∏à')" class="px-3 py-2 bg-indigo-100 text-indigo-800 rounded-lg hover:bg-indigo-200 text-sm">
                            ÁèæË™øÊ∏à
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, 'ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´')" class="px-3 py-2 bg-gray-100 text-gray-800 rounded-lg hover:bg-gray-200 text-sm">
                            ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, 'ÁèæË™øÂæåÂ§±Ê≥®')" class="px-3 py-2 bg-gray-100 text-gray-800 rounded-lg hover:bg-gray-200 text-sm">
                            ÁèæË™øÂæåÂ§±Ê≥®
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, 'Ë¶ãÁ©çÊèêÂá∫Ê∏à')" class="px-3 py-2 bg-yellow-100 text-yellow-800 rounded-lg hover:bg-yellow-200 text-sm">
                            Ë¶ãÁ©çÊèêÂá∫Ê∏à
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, 'ÊàêÁ¥Ñ')" class="px-3 py-2 bg-green-100 text-green-800 rounded-lg hover:bg-green-200 text-sm">
                            ÊàêÁ¥Ñ
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, '‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à')" class="px-3 py-2 bg-gray-100 text-gray-800 rounded-lg hover:bg-gray-200 text-sm">
                            ‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, 'Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à')" class="px-3 py-2 bg-purple-100 text-purple-800 rounded-lg hover:bg-purple-200 text-sm">
                            Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, 'ÂÖ•Èáë‰∫àÂÆö')" class="px-3 py-2 bg-cyan-100 text-cyan-800 rounded-lg hover:bg-cyan-200 text-sm">
                            ÂÖ•Èáë‰∫àÂÆö
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, 'ÂÖ•ÈáëÊ∏à')" class="px-3 py-2 bg-emerald-100 text-emerald-800 rounded-lg hover:bg-emerald-200 text-sm">
                            ÂÖ•ÈáëÊ∏à
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, '„ÇØ„É¨„Éº„É† or Â§±Ê≥®')" class="col-span-2 px-3 py-2 bg-red-100 text-red-800 rounded-lg hover:bg-red-200 text-sm">
                            „ÇØ„É¨„Éº„É† or Â§±Ê≥®
                        </button>
                    </div>
                    <div class="flex justify-end">
                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // „Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞„Åó„Å¶Èñâ„Åò„Çã
        function updateStatusAndClose(caseId, newStatus) {
            updateCaseStatus(caseId, newStatus);
            document.querySelector('.fixed').remove();
        }

        // ÈõªË©±Áô∫‰ø°
        function callCustomer(phone) {
            if (confirm(`${phone} „Å´ÈõªË©±„Çí„Åã„Åë„Åæ„Åô„ÅãÔºü`)) {
                window.location.href = `tel:${phone}`;
                // Êû∂ÈõªÂ±•Ê≠¥„ÇíË®òÈå≤
                showNotification('Êû∂Èõª', `${phone} „Å∏„ÅÆÊû∂Èõª„ÇíË®òÈå≤„Åó„Åæ„Åó„Åü`);
            }
        }

        // SMSÈÄÅ‰ø°„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
        function sendSMS(phone, caseId) {
            // Ê°à‰ª∂ÊÉÖÂ†±„ÇíÂèñÂæó
            const caseData = caseId ? casesData.find(c => c.id === caseId) : null;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold">SMS„É°„ÉÉ„Çª„Éº„Ç∏‰ΩúÊàê</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- „Åì„ÅÆ„Éö„Éº„Ç∏„ÅÆÂÜÖÂÆπ -->
                    <div class="mb-4 p-4 bg-gray-50 rounded-lg">
                        <div class="text-sm text-gray-600 mb-2">„Åì„ÅÆ„Éö„Éº„Ç∏„ÅÆÂÜÖÂÆπ</div>
                        <div class="text-sm font-medium">SMS„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ:</div>
                    </div>

                    ${caseData ? `
                    <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÊÉÖÂ†± -->
                    <div class="mb-4 p-4 bg-blue-50 rounded-lg">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-blue-900">ÁèæÂú®„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ: ${caseData.status || 'Êú™ÂØæÂøú'}</span>
                            <span class="text-sm text-gray-600">„ÅäÂÆ¢Êßò: ${caseData.name}</span>
                        </div>
                    </div>

                    <!-- ÈÅ∏ÊäûËÇ¢„Çª„ÇØ„Ç∑„Éß„É≥ -->
                    <div class="mb-4">
                        <div class="text-sm font-medium mb-2">Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÇíÈÅ∏Êäû:</div>
                        <div id="nextStepOptions" class="space-y-2">
                            <!-- „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„ÅüÈÅ∏ÊäûËÇ¢„ÇíÂãïÁöÑ„Å´ÁîüÊàê -->
                        </div>
                    </div>
                    ` : ''}

                    <!-- AIÁîüÊàê„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫ -->
                    <div class="mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <label class="text-sm font-medium">${caseData ? 'AIÁîüÊàê„É°„ÉÉ„Çª„Éº„Ç∏' : '„É°„ÉÉ„Çª„Éº„Ç∏'}:</label>
                            ${caseData ? `
                            <button onclick="regenerateSmsMessage(${caseId})" class="text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                ÂÜçÁîüÊàê
                            </button>
                            ` : ''}
                        </div>
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-3">
                            <div class="text-xs text-yellow-800 mb-1">üí° SMS„ÅØ70ÊñáÂ≠ó‰ª•ÂÜÖ„ÅåÊé®Â•®„Åï„Çå„Åæ„Åô</div>
                            <div class="text-xs text-gray-600">ÁèæÂú®: <span id="charCount">0</span>ÊñáÂ≠ó</div>
                        </div>
                        <textarea id="smsMessage" class="w-full p-3 border rounded-lg" rows="6"
                                  placeholder="${caseData ? 'AI„Åå„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÁîüÊàê‰∏≠...' : '„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ...'}"
                                  onkeyup="updateCharCount()"></textarea>

                        <!-- „ÉÜ„É≥„Éó„É¨„Éº„Éà„Éú„Çø„É≥ -->
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button onclick="loadSmsTemplate('greeting')" class="text-xs px-3 py-1 bg-gray-100 rounded-lg hover:bg-gray-200">
                                üëã Êå®Êã∂
                            </button>
                            <button onclick="loadSmsTemplate('appointment')" class="text-xs px-3 py-1 bg-green-100 rounded-lg hover:bg-green-200">
                                üìÖ „Ç¢„ÉùÁ¢∫Ë™ç
                            </button>
                            <button onclick="loadSmsTemplate('estimate')" class="text-xs px-3 py-1 bg-blue-100 rounded-lg hover:bg-blue-200">
                                üìù Ë¶ãÁ©çÊèêÂá∫
                            </button>
                            <button onclick="loadSmsTemplate('followup')" class="text-xs px-3 py-1 bg-yellow-100 rounded-lg hover:bg-yellow-200">
                                üîî „Éï„Ç©„É≠„Éº
                            </button>
                        </div>
                    </div>

                    <!-- Áõ¥Êé•ÂÖ•Âäõ„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ -->
                    <div class="flex items-center mb-4">
                        <input type="checkbox" id="manualInput" class="mr-2" onchange="toggleManualInput(${caseId || 'null'})">
                        <label for="manualInput" class="text-sm text-gray-700">„Åæ„Åü„ÅØÁõ¥Êé•ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</label>
                    </div>

                    <div class="flex justify-end gap-2">
                        <button onclick="this.closest('.fixed').remove()" class="px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                        <button onclick="sendSmsMessage('${phone}')" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            OK
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            if (caseData) {
                // „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„ÅüÈÅ∏ÊäûËÇ¢„ÇíË°®Á§∫
                generateNextStepOptions(caseData.status, caseId);
                // ÂàùÂõû„ÅÆAI„É°„ÉÉ„Çª„Éº„Ç∏ÁîüÊàê
                generateAiSmsMessage(caseId, null);
            }
        }

        // ÊñáÂ≠óÊï∞„Ç´„Ç¶„É≥„ÉàÊõ¥Êñ∞
        function updateCharCount() {
            const textarea = document.getElementById('smsMessage');
            const countSpan = document.getElementById('charCount');
            if (textarea && countSpan) {
                const count = textarea.value.length;
                countSpan.textContent = count;
                countSpan.className = count > 70 ? 'text-red-600 font-bold' : '';
            }
        }

        // „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„ÅüÊ¨°„Çπ„ÉÜ„ÉÉ„Éó„ÅÆÈÅ∏ÊäûËÇ¢„ÇíÁîüÊàê
        function generateNextStepOptions(currentStatus, caseId) {
            const optionsContainer = document.getElementById('nextStepOptions');
            if (!optionsContainer) return;

            let options = [];

            // „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„ÅüÈÅ∏ÊäûËÇ¢„ÇíÂÆöÁæ©
            const statusOptions = {
                'Êú™ÂØæÂøú': [
                    { label: 'ÂàùÂõû„Ç¢„Éù„Ç§„É≥„Éà„ÅÆ„ÅäÈ°ò„ÅÑ', value: 'initial_appointment' },
                    { label: '„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Å∏„ÅÆ„ÅäÁ§º', value: 'thank_inquiry' },
                    { label: 'Ë≥áÊñôÈÄÅ‰ªò„ÅÆ„ÅäÁü•„Çâ„Åõ', value: 'send_materials' }
                ],
                'Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù': [
                    { label: 'ÂÜçÂ∫¶„Ç¢„Éù„Ç§„É≥„Éà„ÅÆ„ÅäÈ°ò„ÅÑ', value: 'retry_appointment' },
                    { label: 'Ë≥áÊñôÈÄÅ‰ªò„ÅÆ„ÅîÊ°àÂÜÖ', value: 'material_guide' },
                    { label: '„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó„ÅÆ„ÅîÈÄ£Áµ°', value: 'followup_call' }
                ],
                '„Ç¢„ÉùÊ∏à': [
                    { label: 'ÁèæÂú∞Ë™øÊüªÊó•ÊôÇ„ÅÆÁ¢∫Ë™ç', value: 'confirm_survey' },
                    { label: 'ÁèæË™øÂâçÊó•„ÅÆ„É™„Éû„Ç§„É≥„ÉÄ„Éº', value: 'survey_reminder' },
                    { label: 'ÊåÅ„Å°Áâ©„ÉªÊ∫ñÂÇô‰∫ãÈ†Ö„ÅÆ„ÅîÈÄ£Áµ°', value: 'preparation_info' }
                ],
                'ÁèæË™øÊ∏à': [
                    { label: 'ÁèæË™ø„ÅÆ„ÅäÁ§º', value: 'thank_survey' },
                    { label: 'Ë¶ãÁ©çÊõ∏‰ΩúÊàê‰∏≠„ÅÆ„ÅîÈÄ£Áµ°', value: 'estimate_progress' },
                    { label: 'Ë¶ãÁ©çÊõ∏ÂÆåÊàê„ÅÆ„ÅäÁü•„Çâ„Åõ', value: 'estimate_ready' }
                ],
                'Ë¶ãÁ©çÊèêÂá∫Ê∏à': [
                    { label: 'Ë¶ãÁ©çÊõ∏„ÅÆ„ÅîÁ¢∫Ë™ç„ÅäÈ°ò„ÅÑ', value: 'estimate_check' },
                    { label: '„ÅîË≥™Âïè„Å∏„ÅÆÂõûÁ≠î', value: 'answer_questions' },
                    { label: '„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó', value: 'estimate_followup' },
                    { label: 'ÁâπÂà•„Ç≠„É£„É≥„Éö„Éº„É≥„ÅÆ„ÅîÊ°àÂÜÖ', value: 'special_campaign' }
                ],
                'ÊàêÁ¥Ñ': [
                    { label: '„ÅîÂ•ëÁ¥Ñ„ÅÆ„ÅäÁ§º', value: 'contract_thanks' },
                    { label: 'Â∑•‰∫ãÊó•Á®ã„ÅÆ„ÅîÈÄ£Áµ°', value: 'construction_schedule' },
                    { label: 'ÂøÖË¶ÅÊõ∏È°û„ÅÆ„ÅîÊ°àÂÜÖ', value: 'required_documents' }
                ],
                'ÂÖ•Èáë‰∫àÂÆö': [
                    { label: 'ÂÖ•ÈáëÁ¢∫Ë™ç„ÅÆ„ÅäÈ°ò„ÅÑ', value: 'payment_confirmation' },
                    { label: 'ÊåØËæºÂÖà„ÅÆ„ÅîÊ°àÂÜÖ', value: 'bank_info' },
                    { label: 'Â∑•‰∫ãÈñãÂßã„ÅÆ„ÅîÊ°àÂÜÖ', value: 'construction_start' }
                ],
                'ÂÖ•ÈáëÊ∏à': [
                    { label: 'ÂÖ•ÈáëÁ¢∫Ë™ç„ÅÆ„ÅäÁ§º', value: 'payment_thanks' },
                    { label: 'Â∑•‰∫ãÈñãÂßã„ÅÆ„ÅîÊ°àÂÜÖ', value: 'construction_info' },
                    { label: 'ÂÆåÂ∑•Âæå„ÅÆ„Éï„Ç©„É≠„Éº', value: 'completion_follow' }
                ]
            };

            // „Éá„Éï„Ç©„É´„Éà„ÅÆÈÅ∏ÊäûËÇ¢
            options = statusOptions[currentStatus] || [
                { label: '„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Å∏„ÅÆ„ÅäÁ§º', value: 'general_thanks' },
                { label: '„ÅîÈÄ£Áµ°', value: 'general_contact' },
                { label: '„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó', value: 'general_followup' }
            ];

            // ÈÅ∏ÊäûËÇ¢„ÇíHTML„Å´Â§âÊèõ
            optionsContainer.innerHTML = options.map((opt, index) => `
                <label class="flex items-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                    <input type="radio" name="nextStep" value="${opt.value}"
                           ${index === 0 ? 'checked' : ''}
                           onchange="generateAiSmsMessage(${caseId}, '${opt.value}')"
                           class="mr-3">
                    <span class="text-sm">${opt.label}</span>
                </label>
            `).join('');
        }

        // AI„ÅßSMS„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÁîüÊàêÔºà„É¢„ÉÉ„ÇØÁâà - 65ÊñáÂ≠ó‰ª•ÂÜÖÔºâ
        function generateAiSmsMessage(caseId, messageType) {
            const caseData = casesData.find(c => c.id === caseId);
            if (!caseData) return;

            const messageTextarea = document.getElementById('smsMessage');
            if (!messageTextarea) return;

            // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
            messageTextarea.value = 'AI„Åå„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÁîüÊàê‰∏≠...';
            messageTextarea.disabled = true;

            // „É°„ÉÉ„Çª„Éº„Ç∏„Çø„Ç§„Éó„ÇíÂèñÂæóÔºàÊú™ÈÅ∏Êäû„ÅÆÂ†¥Âêà„ÅØÊúÄÂàù„ÅÆÈÅ∏ÊäûËÇ¢Ôºâ
            if (!messageType) {
                const selectedOption = document.querySelector('input[name="nextStep"]:checked');
                messageType = selectedOption ? selectedOption.value : 'general_contact';
            }

            // Êï∞ÁßíÂæå„Å´AIÁîüÊàê„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫Ôºà„É¢„ÉÉ„ÇØ - 65ÊñáÂ≠ó‰ª•ÂÜÖÔºâ
            setTimeout(() => {
                const customerName = caseData.name ? caseData.name.split(' ')[0] : '„ÅäÂÆ¢'; // ËãóÂ≠ó„ÅÆ„Åø
                const salesName = 'Áî∞‰∏≠'; // ÁèæÂú®„ÅÆ„É≠„Ç∞„Ç§„É≥„É¶„Éº„Ç∂„ÉºÂêç

                // 65ÊñáÂ≠ó‰ª•ÂÜÖ„ÅÆ„ÉÜ„É≥„Éó„É¨„Éº„Éà
                const templates = {
                    'initial_appointment': `${customerName}Êßò\nÂ§ñÂ£ÅÂ°óË£Ö„ÅÆ‰ª∂„Åß„ÅîÈÄ£Áµ°„Åó„Åæ„Åó„Åü„ÄÇÁèæÂú∞Ë™øÊüª„ÅÆ„ÅîÈÉΩÂêà„ÅØ„ÅÑ„Åã„Åå„Åß„Åó„Çá„ÅÜ„ÅãÔºü\n${salesName}`,
                    'thank_inquiry': `${customerName}Êßò\n„ÅäÂïèÂêà„Åõ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇÂ§ñÂ£ÅÂ°óË£Ö„ÅÆË©≥Á¥∞„Çí„ÅîÊ°àÂÜÖ„Åó„Åæ„Åô„ÄÇ\n${salesName}`,
                    'send_materials': `${customerName}Êßò\nË≥áÊñô„Çí„ÅäÈÄÅ„Çä„Åó„Åæ„Åó„Åü„ÄÇ„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ„ÄÇ„ÅîË≥™Âïè„ÅØ„ÅäÊ∞óËªΩ„Å´„ÄÇ\n${salesName}`,
                    'retry_appointment': `${customerName}Êßò\nÂÖàÊó•„ÅØÂ§±Á§º„Åó„Åæ„Åó„Åü„ÄÇÁèæË™øÊó•„ÇíÂÜçË™øÊï¥„Åï„Åõ„Å¶„ÅÑ„Åü„Å†„Åë„Åæ„Åô„ÅãÔºü\n${salesName}`,
                    'material_guide': `${customerName}Êßò\nË©≥„Åó„ÅÑË≥áÊñô„Çí„ÅäÈÄÅ„Çä„Åó„Åæ„Åô„ÄÇ„Åî‰∏çÊòéÁÇπ„Åå„ÅÇ„Çå„Å∞„ÅîÈÄ£Áµ°„Åè„Å†„Åï„ÅÑ„ÄÇ\n${salesName}`,
                    'followup_call': `${customerName}Êßò\nÂÖàÊó•„ÅÆ‰ª∂„ÅÑ„Åã„Åå„Åß„Åó„Åü„ÅãÔºü„ÅîÈÉΩÂêà„Å§„ÅèÊôÇ„Å´„ÅîÈÄ£Áµ°„Åè„Å†„Åï„ÅÑ„ÄÇ\n${salesName}`,
                    'confirm_survey': `${customerName}Êßò\nÊòéÊó•‚óãÊôÇ„ÅÆÁèæË™ø„Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇÂ§âÊõ¥„ÅÇ„Çå„Å∞„ÅîÈÄ£Áµ°„Çí„ÄÇ\n${salesName}`,
                    'survey_reminder': `${customerName}Êßò\nÊòéÊó•„ÅÆÁèæË™ø„Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ„Çπ„Çø„ÉÉ„Éï„Åå‰º∫„ÅÑ„Åæ„Åô„ÄÇ\n${salesName}`,
                    'preparation_info': `${customerName}Êßò\nÁèæË™øÂΩìÊó•„ÅØÁâπ„Å´„ÅîÊ∫ñÂÇô‰∏çË¶Å„Åß„Åô„ÄÇ„ÅäÊ∞ó„Çí„Å§„Åë„Å¶„ÅäÂæÖ„Å°‰∏ã„Åï„ÅÑ„ÄÇ\n${salesName}`,
                    'thank_survey': `${customerName}Êßò\nÊú¨Êó•„ÅØ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åó„Åü„ÄÇË¶ãÁ©çÊõ∏„Çí‰ΩúÊàê„Åó„ÅîÈÄ£Áµ°„Åó„Åæ„Åô„ÄÇ\n${salesName}`,
                    'estimate_progress': `${customerName}Êßò\nË¶ãÁ©çÊõ∏‰ΩúÊàê‰∏≠„Åß„Åô„ÄÇ„ÇÇ„ÅÜÂ∞ë„Åó„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ„ÄÇ\n${salesName}`,
                    'estimate_ready': `${customerName}Êßò\nË¶ãÁ©çÊõ∏„ÅåÂÆåÊàê„Åó„Åæ„Åó„Åü„ÄÇ„ÅîÈÉΩÂêà„Çà„ÅÑÊôÇ„Å´„ÅîË™¨Êòé„Åó„Åæ„Åô„ÄÇ\n${salesName}`,
                    'estimate_check': `${customerName}Êßò\nË¶ãÁ©çÊõ∏„ÅØ„ÅîÁ¢∫Ë™ç„ÅÑ„Åü„Å†„Åë„Åæ„Åó„Åü„ÅãÔºü„Åî‰∏çÊòéÁÇπ„ÅäÊ∞óËªΩ„Å´„ÄÇ\n${salesName}`,
                    'answer_questions': `${customerName}Êßò\n„ÅîË≥™Âïè„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇË©≥Á¥∞ÂõûÁ≠î„Çí„ÅäÈÄÅ„Çä„Åó„Åæ„Åô„ÄÇ\n${salesName}`,
                    'estimate_followup': `${customerName}Êßò\nË¶ãÁ©çÊõ∏„ÅÆ‰ª∂„ÅÑ„Åã„Åå„Åß„Åó„Çá„ÅÜ„ÅãÔºü„Åî‰∏çÊòéÁÇπ„ÅÇ„Çå„Å∞„ÅîÈÄ£Áµ°„Çí„ÄÇ\n${salesName}`,
                    'special_campaign': `${customerName}Êßò\n‰ªäÊúàÈôêÂÆöÁâπÂà•‰æ°Ê†º„ÅîÁî®ÊÑè„Åó„Åæ„Åó„Åü„ÄÇ„Åì„ÅÆÊ©ü‰ºö„Å´„ÅÑ„Åã„Åå„Åß„Åô„ÅãÔºü\n${salesName}`,
                    'contract_thanks': `${customerName}Êßò\n„ÅîÂ•ëÁ¥Ñ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ‰∏ÅÂØß„Å™Â∑•‰∫ã„ÇíÂøÉ„Åå„Åë„Åæ„Åô„ÄÇ\n${salesName}`,
                    'construction_schedule': `${customerName}Êßò\nÂ∑•‰∫ãÊó•Á®ã„Åå‚óãÊúà‚óãÊó•„Å´Ê±∫„Åæ„Çä„Åæ„Åó„Åü„ÄÇ„Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ\n${salesName}`,
                    'required_documents': `${customerName}Êßò\nÂøÖË¶ÅÊõ∏È°û„Çí„ÅäÈÄÅ„Çä„Åó„Åæ„Åó„Åü„ÄÇ„ÅîÁ¢∫Ë™ç„Éª„ÅîË®òÂÖ•„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ\n${salesName}`,
                    'payment_confirmation': `${customerName}Êßò\nÂÖ•ÈáëÁ¢∫Ë™ç„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇÊåØËæº‰∫àÂÆöÊó•„Çí„ÅäÊïô„Åà„Åè„Å†„Åï„ÅÑ„ÄÇ\n${salesName}`,
                    'bank_info': `${customerName}Êßò\nÊåØËæºÂÖà„Çí„ÅäÈÄÅ„Çä„Åó„Åæ„Åô„ÄÇ„ÅîÁ¢∫Ë™ç„ÅÆ‰∏ä„ÅäÊâãÁ∂ö„Åç„Åè„Å†„Åï„ÅÑ„ÄÇ\n${salesName}`,
                    'construction_start': `${customerName}Êßò\nÊù•ÈÄ±„Åã„ÇâÂ∑•‰∫ãÈñãÂßã„Åß„Åô„ÄÇ„Åî‰∏ç‰æø„Åä„Åã„Åë„Åó„Åæ„Åô„Åå„Çà„Çç„Åó„Åè„ÄÇ\n${salesName}`,
                    'payment_thanks': `${customerName}Êßò\nÂÖ•ÈáëÁ¢∫Ë™ç„Åó„Åæ„Åó„Åü„ÄÇ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇÂ∑•‰∫ãÈÄ≤„ÇÅ„Åæ„Åô„ÄÇ\n${salesName}`,
                    'construction_info': `${customerName}Êßò\nÂ∑•‰∫ã„Çπ„Ç±„Ç∏„É•„Éº„É´„ÅäÈÄÅ„Çä„Åó„Åæ„Åô„ÄÇ„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ„ÄÇ\n${salesName}`,
                    'completion_follow': `${customerName}Êßò\nÂ∑•‰∫ãÂÆå‰∫ÜÂæå„ÇÇ„Çµ„Éù„Éº„Éà„Åó„Åæ„Åô„ÄÇ‰Ωï„Åã„ÅÇ„Çå„Å∞„ÅîÈÄ£Áµ°„Çí„ÄÇ\n${salesName}`,
                    'general_contact': `${customerName}Êßò\nÂ§ñÂ£ÅÂ°óË£Ö„ÅÆ‰ª∂„Åß„ÅîÈÄ£Áµ°„Åó„Åæ„Åó„Åü„ÄÇ„ÅîÈÉΩÂêà„Çà„ÅÑÊôÇ„Å´„ÅäË©±„Åó„Åæ„Åõ„Çì„ÅãÔºü\n${salesName}`,
                    'general_thanks': `${customerName}Êßò\n„ÅäÂïèÂêà„Åõ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇË©≥Á¥∞„ÅîÊ°àÂÜÖ„Åó„Åæ„Åô„ÄÇ\n${salesName}`,
                    'general_followup': `${customerName}Êßò\nÂÖàÊó•„ÅÆ‰ª∂„Å©„ÅÜ„Åß„Åó„Åü„ÅãÔºü„ÅäÊ∞óËªΩ„Å´„ÅîÈÄ£Áµ°„Åè„Å†„Åï„ÅÑ„ÄÇ\n${salesName}`
                };

                const message = templates[messageType] || templates['general_contact'];
                messageTextarea.value = message;
                messageTextarea.disabled = false;
                updateCharCount();
            }, 1000); // 1ÁßíÂæå„Å´ÁîüÊàê
        }

        // SMS„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÂÜçÁîüÊàê
        function regenerateSmsMessage(caseId) {
            const selectedOption = document.querySelector('input[name="nextStep"]:checked');
            const messageType = selectedOption ? selectedOption.value : null;
            generateAiSmsMessage(caseId, messageType);
        }

        // „ÉÜ„É≥„Éó„É¨„Éº„Éà„Çí„É≠„Éº„Éâ
        function loadSmsTemplate(templateType) {
            const messageTextarea = document.getElementById('smsMessage');
            if (!messageTextarea) return;

            const templates = {
                'greeting': '„Åä‰∏ñË©±„Å´„Å™„Å£„Å¶„Åä„Çä„Åæ„Åô„ÄÇÂ§ñÂ£ÅÂ°óË£Ö„ÅÆ‰ª∂„Åß„ÅîÈÄ£Áµ°„Åó„Åæ„Åó„Åü„ÄÇÁî∞‰∏≠',
                'appointment': 'ÊòéÊó•„ÅÆÁèæË™ø„Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇÁî∞‰∏≠',
                'estimate': 'Ë¶ãÁ©çÊõ∏ÂÆåÊàê„Åó„Åæ„Åó„Åü„ÄÇ„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ„ÄÇÁî∞‰∏≠',
                'followup': 'ÂÖàÊó•„ÅÆ‰ª∂„ÅÑ„Åã„Åå„Åß„Åó„Åü„ÅãÔºü„ÅäÊ∞óËªΩ„Å´„ÅîÈÄ£Áµ°„Åè„Å†„Åï„ÅÑ„ÄÇÁî∞‰∏≠'
            };

            messageTextarea.value = templates[templateType] || '';
            updateCharCount();
        }

        // ÊâãÂãïÂÖ•Âäõ„ÅÆÂàá„ÇäÊõø„Åà
        function toggleManualInput(caseId) {
            const checkbox = document.getElementById('manualInput');
            const messageTextarea = document.getElementById('smsMessage');
            if (checkbox.checked) {
                messageTextarea.value = '';
                messageTextarea.placeholder = '„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...';
                messageTextarea.disabled = false;
                updateCharCount();
            } else if (caseId) {
                generateAiSmsMessage(caseId, null);
            }
        }

        // SMS„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈÄÅ‰ø°
        function sendSmsMessage(phone) {
            const message = document.getElementById('smsMessage').value;
            if (message) {
                window.location.href = `sms:${phone}?body=${encodeURIComponent(message)}`;
                showNotification('SMSÈÄÅ‰ø°', `${phone} „Å∏SMS„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü`);
                // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
                document.querySelector('.fixed').remove();
            } else {
                showNotification('„Ç®„É©„Éº', '„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
            }
        }

        // „É°„É¢Ë°®Á§∫„ÉªÁ∑®ÈõÜ
        function showMemo(caseId) {
            // Êó¢Â≠ò„ÅÆ„É°„É¢„ÇíÂèñÂæóÔºàÂÆüÈöõ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅØAPI„Åã„ÇâÂèñÂæóÔºâ
            const existingMemo = getCaseMemo(caseId);

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[80vh] overflow-y-auto">
                    <h3 class="text-lg font-bold mb-4">üìù Ê°à‰ª∂„É°„É¢</h3>

                    <!-- Â±•Ê≠¥Ë°®Á§∫ -->
                    <div class="mb-4 max-h-48 overflow-y-auto bg-gray-50 rounded-lg p-3">
                        <div class="text-sm font-medium text-gray-600 mb-2">Â±•Ê≠¥:</div>
                        <div id="memoHistory" class="space-y-2 text-sm">
                            ${existingMemo.history || '<div class="text-gray-400">Â±•Ê≠¥„Å™„Åó</div>'}
                        </div>
                    </div>

                    <!-- Êñ∞Ë¶è„É°„É¢ÂÖ•Âäõ -->
                    <div class="mb-2">
                        <label class="text-sm font-medium text-gray-700">Êñ∞„Åó„ÅÑ„É°„É¢„ÇíËøΩÂä†:</label>
                    </div>
                    <textarea id="caseMemo" class="w-full p-3 border rounded-lg" rows="4" placeholder="Áî≥„ÅóÈÄÅ„Çä‰∫ãÈ†Ö„ÇÑÊ≥®ÊÑèÁÇπ„ÇíË®òÂÖ•..."></textarea>

                    <div class="flex justify-end gap-2 mt-4">
                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                        <button onclick="saveMemo(${caseId})" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            ‰øùÂ≠ò
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // „É°„É¢ÂèñÂæóÔºàÂÆüÈöõ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅØAPI„Åã„ÇâÂèñÂæóÔºâ
        function getCaseMemo(caseId) {
            // „Çµ„É≥„Éó„É´„Éá„Éº„Çø
            const memoData = {
                1: {
                    history: `
                        <div class="border-l-2 border-blue-400 pl-3 mb-2">
                            <div class="text-xs text-gray-500">2024/03/15 14:30 - Áî∞‰∏≠Â§™ÈÉé</div>
                            <div class="text-gray-700">‰∫àÁÆóÊÑüÔºö200‰∏áÂÜÜÂâçÂæå</div>
                        </div>
                        <div class="border-l-2 border-green-400 pl-3 mb-2">
                            <div class="text-xs text-gray-500">2024/03/15 16:45 - ‰ΩêËó§Ëä±Â≠ê</div>
                            <div class="text-gray-700">Á´∂Âêà‰ªñÁ§æ„ÇÇÊ§úË®é‰∏≠„ÄÅÂ••Êßò„ÅåÊ±∫ÂÆöÊ®©ËÄÖ</div>
                        </div>
                        <div class="border-l-2 border-yellow-400 pl-3 mb-2">
                            <div class="text-xs text-gray-500">2024/03/16 10:00 - „Ç∑„Çπ„ÉÜ„É†</div>
                            <div class="text-gray-700">„ÄêÂºï„ÅçÁ∂ô„Åé„ÄëÁî∞‰∏≠Â§™ÈÉé ‚Üí ‰ΩêËó§Ëä±Â≠ê</div>
                        </div>
                    `
                },
                4: {
                    history: `
                        <div class="border-l-2 border-blue-400 pl-3 mb-2">
                            <div class="text-xs text-gray-500">2024/03/14 09:00 - Â±±Áî∞Ê¨°ÈÉé</div>
                            <div class="text-gray-700">ÂàùÂõûË®™ÂïèÊ∏à„Åø„ÄÅË¶ãÁ©ç„ÇÇ„ÇäÂæÖ„Å°</div>
                        </div>
                    `
                }
            };

            return memoData[caseId] || { history: '' };
        }

        // „É°„É¢‰øùÂ≠ò
        function saveMemo(caseId) {
            const memoText = document.getElementById('caseMemo').value;

            if (!memoText.trim()) {
                showNotification('„Ç®„É©„Éº', '„É°„É¢„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            // ÁèæÂú®„ÅÆ„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±ÔºàÂÆüÈöõ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅØ„Çª„ÉÉ„Ç∑„Éß„É≥„Åã„ÇâÂèñÂæóÔºâ
            const currentUser = getCurrentUser();
            const timestamp = new Date().toLocaleString('ja-JP', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            }).replace(/\//g, '/');

            // „É°„É¢„Çí‰øùÂ≠òÔºàÂÆüÈöõ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅØAPI„Å´ÈÄÅ‰ø°Ôºâ
            const newMemoEntry = {
                timestamp: timestamp,
                user: currentUser.name,
                text: memoText,
                caseId: caseId
            };

            // „Åì„Åì„ÅßAPI„Å´ÈÄÅ‰ø°
            console.log('Saving memo:', newMemoEntry);

            showNotification('„É°„É¢‰øùÂ≠ò', '„É°„É¢„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
            document.querySelector('.fixed').remove();

            // UI„ÇíÊõ¥Êñ∞„Åó„Å¶„É°„É¢„Ç¢„Ç§„Ç≥„É≥„ÇíÈªÑËâ≤„Å´„Åô„Çã
            updateMemoIcon(caseId, true);
        }

        // „É°„É¢„Ç¢„Ç§„Ç≥„É≥„ÅÆÊõ¥Êñ∞
        function updateMemoIcon(caseId, hasMemo) {
            const caseElements = document.querySelectorAll(`[data-case-id="${caseId}"]`);
            caseElements.forEach(element => {
                const memoButton = element.querySelector('button[onclick*="showMemo"]');
                if (memoButton) {
                    const memoIcon = memoButton.querySelector('span');
                    if (memoIcon) {
                        if (hasMemo) {
                            memoIcon.classList.remove('text-gray-400');
                            memoIcon.classList.add('text-yellow-500');
                        } else {
                            memoIcon.classList.remove('text-yellow-500');
                            memoIcon.classList.add('text-gray-400');
                        }
                    }
                }
            });
        }

        // ÊãÖÂΩì„Éë„ÇπÔºàÂºï„ÅçÁ∂ô„ÅéÔºâ
        function passCase(caseId) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
                    <h3 class="text-lg font-bold mb-4">üîÑ ÊãÖÂΩìËÄÖ„ÇíÂ§âÊõ¥</h3>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Âºï„ÅçÁ∂ô„ÅéÂÖà</label>
                        <select id="passToSelect" class="w-full p-2 border rounded-lg">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <option value="Áî∞‰∏≠Â§™ÈÉé">Áî∞‰∏≠Â§™ÈÉé</option>
                            <option value="‰ΩêËó§Ëä±Â≠ê">‰ΩêËó§Ëä±Â≠ê</option>
                            <option value="Â±±Áî∞Ê¨°ÈÉé">Â±±Áî∞Ê¨°ÈÉé</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Âºï„ÅçÁ∂ô„Åé„É°„É¢Ôºà‰ªªÊÑèÔºâ</label>
                        <textarea id="passMemo" class="w-full p-2 border rounded-lg" rows="3" placeholder="Áî≥„ÅóÈÄÅ„Çä‰∫ãÈ†Ö„Åå„ÅÇ„Çå„Å∞Ë®òÂÖ•..."></textarea>
                    </div>
                    <div class="flex justify-end gap-2">
                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                        <button onclick="confirmPass(${caseId})" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            Âºï„ÅçÁ∂ô„Åé„É™„ÇØ„Ç®„Çπ„Éà
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Âºï„ÅçÁ∂ô„ÅéÁ¢∫ÂÆö
        function confirmPass(caseId) {
            const passTo = document.getElementById('passToSelect').value;
            const passMemo = document.getElementById('passMemo').value;

            if (!passTo) {
                alert('Âºï„ÅçÁ∂ô„ÅéÂÖà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            // Âºï„ÅçÁ∂ô„Åé„É™„ÇØ„Ç®„Çπ„Éà„ÇíÈÄÅ‰ø°
            showNotification('Âºï„ÅçÁ∂ô„Åé„É™„ÇØ„Ç®„Çπ„ÉàÈÄÅ‰ø°', `${passTo}„Å∏ÊâøË™ç‰æùÈ†º„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü`);

            // „Ç´„Éº„Éâ„Å´ÊâøË™çÂæÖ„Å°„Éê„ÉÉ„Ç∏„ÇíËøΩÂä†
            const card = document.querySelector(`[onclick="showCaseDetail(${caseId})"]`);
            if (card) {
                const titleElement = card.querySelector('h3');
                if (titleElement && !titleElement.querySelector('.pending-badge')) {
                    const badge = document.createElement('span');
                    badge.className = 'pending-badge text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded ml-2';
                    badge.textContent = '‚è≥ ÊâøË™çÂæÖ„Å°';
                    titleElement.appendChild(badge);
                }
            }

            document.querySelector('.fixed').remove();

            // ÈÄöÁü•„ÇíË°®Á§∫ÔºàÂÆüÈöõ„ÅÆÂÆüË£Ö„Åß„ÅØÁõ∏Êâã„ÅÆÁîªÈù¢„Å´ÈÄöÁü•Ôºâ
            setTimeout(() => {
                showPassNotification(passTo, caseId, passMemo);
            }, 1000);
        }

        // Âºï„ÅçÁ∂ô„ÅéÈÄöÁü•„ÇíË°®Á§∫
        function showPassNotification(assignee, caseId, memo) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-white rounded-lg shadow-lg p-4 max-w-sm z-50 border-l-4 border-blue-500';

            const memoHtml = memo ? `
                <div class="mt-2 p-2 bg-gray-50 rounded text-xs text-gray-600">
                    <p class="font-medium">Âºï„ÅçÁ∂ô„Åé„É°„É¢:</p>
                    <p>${memo}</p>
                </div>
            ` : '';

            notification.innerHTML = `
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <span class="text-2xl">üîî</span>
                    </div>
                    <div class="ml-3 flex-1">
                        <p class="text-sm font-medium text-gray-900">
                            Ê°à‰ª∂Âºï„ÅçÁ∂ô„Åé„É™„ÇØ„Ç®„Çπ„Éà
                        </p>
                        <p class="mt-1 text-sm text-gray-500">
                            Áî∞‰∏≠Â§™ÈÉé„Åã„ÇâÊ°à‰ª∂„ÅåÂºï„ÅçÁ∂ô„Åå„Çå„Åæ„Åó„Åü
                        </p>
                        ${memoHtml}
                        <div class="mt-3 flex gap-2">
                            <button onclick="acceptPass(${caseId}, this)" class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700">
                                ÊâøË™ç
                            </button>
                            <button onclick="rejectPass(${caseId}, this)" class="px-3 py-1 bg-gray-200 text-gray-800 text-sm rounded hover:bg-gray-300">
                                ÊãíÂê¶
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(notification);

            // 5ÁßíÂæå„Å´Ëá™Âãï„ÅßÊ∂à„Åà„Çã
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 10000);
        }

        // Âºï„ÅçÁ∂ô„ÅéÊâøË™ç
        function acceptPass(caseId, button) {
            // „É¢„Éº„ÉÄ„É´„Åã„Çâ„É°„É¢„ÇíÂèñÂæó
            const modal = button.closest('.fixed');
            const passMemo = modal.querySelector('p:last-of-type')?.textContent.replace('„É°„É¢: ', '') || '';

            // ÁèæÂú®„ÅÆ„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±ÔºàÂÆüÈöõ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅØ„Çª„ÉÉ„Ç∑„Éß„É≥„Åã„ÇâÂèñÂæóÔºâ
            const currentUser = getCurrentUser();
            const timestamp = new Date().toLocaleString('ja-JP', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            }).replace(/\//g, '/');

            // Âºï„ÅçÁ∂ô„ÅéÂ±•Ê≠¥„Çí„É°„É¢„Å´Ëá™ÂãïËøΩÂä†ÔºàÂÆüÈöõ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅØAPI„Å´ÈÄÅ‰ø°Ôºâ
            const handoverEntry = {
                timestamp: timestamp,
                type: 'handover',
                from: 'Áî∞‰∏≠Â§™ÈÉé', // ÂÆüÈöõ„ÅØÂâç„ÅÆÊãÖÂΩìËÄÖ„ÇíÂèñÂæó
                to: currentUser.name,
                memo: passMemo,
                caseId: caseId
            };

            // „Åì„Åì„ÅßAPI„Å´ÈÄÅ‰ø°„Åó„Å¶Â±•Ê≠¥„Çí‰øùÂ≠ò
            console.log('Recording handover:', handoverEntry);

            showNotification('ÊâøË™çÂÆå‰∫Ü', 'Ê°à‰ª∂„ÇíÂºï„ÅçÁ∂ô„Åé„Åæ„Åó„Åü');

            // ÊâøË™çÂæÖ„Å°„Éê„ÉÉ„Ç∏„ÇíÂâäÈô§
            const pendingBadge = document.querySelector('.pending-badge');
            if (pendingBadge) {
                pendingBadge.remove();
            }

            // ÊãÖÂΩìËÄÖÂêç„ÇíÊõ¥Êñ∞
            const card = document.querySelector(`[onclick="showCaseDetail(${caseId})"]`);
            if (card) {
                const assigneeSpan = card.querySelector('.text-blue-700');
                if (assigneeSpan) {
                    assigneeSpan.textContent = `üë§ ÊãÖÂΩì: ${currentUser.name}`;
                }
            }

            // „É°„É¢„Ç¢„Ç§„Ç≥„É≥„ÇíÈªÑËâ≤„Å´„Åô„ÇãÔºàÂºï„ÅçÁ∂ô„ÅéÂ±•Ê≠¥„Åå„ÅÇ„Çã„Åü„ÇÅÔºâ
            updateMemoIcon(caseId, true);

            modal.remove();
        }

        // Âºï„ÅçÁ∂ô„ÅéÊãíÂê¶
        function rejectPass(caseId, button) {
            showNotification('Âºï„ÅçÁ∂ô„ÅéÊãíÂê¶', 'Âºï„ÅçÁ∂ô„Åé„ÇíÊãíÂê¶„Åó„Åæ„Åó„Åü');

            // ÊâøË™çÂæÖ„Å°„Éê„ÉÉ„Ç∏„ÇíÂâäÈô§
            const pendingBadge = document.querySelector('.pending-badge');
            if (pendingBadge) {
                pendingBadge.remove();
            }

            button.closest('.fixed').remove();
        }

        // Ê°à‰ª∂Ë©≥Á¥∞Ë°®Á§∫
        function openCaseDetail(caseId) {
            const caseData = casesData.find(c => c.id == caseId);
            if (!caseData) return;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[80vh] overflow-y-auto">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-xl font-bold">Ê°à‰ª∂Ë©≥Á¥∞ #${caseData.id}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <div class="space-y-4">
                        <!-- È°ßÂÆ¢ÊÉÖÂ†± -->
                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold mb-2">È°ßÂÆ¢ÊÉÖÂ†±</h4>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div><span class="text-gray-500">Ê∞èÂêç:</span> ${caseData.name} Êßò</div>
                                <div><span class="text-gray-500">ÈõªË©±:</span> ${caseData.phone}</div>
                                <div><span class="text-gray-500">‰ΩèÊâÄ:</span> ${caseData.area}</div>
                                <div><span class="text-gray-500">Áâ©‰ª∂:</span> ${caseData.propertyType}„ÉªÁØâ${caseData.age}Âπ¥</div>
                            </div>
                        </div>

                        <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÊÉÖÂ†± -->
                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold mb-2">„Çπ„ÉÜ„Éº„Çø„Çπ</h4>
                            <select class="w-full p-2 border rounded">
                                <option ${caseData.status === 'Êú™ÂØæÂøú' ? 'selected' : ''}>Êú™ÂØæÂøú</option>
                                <option ${caseData.status === 'Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù' ? 'selected' : ''}>Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù</option>
                                <option ${caseData.status === '„Ç¢„ÉùÊ∏à' ? 'selected' : ''}>„Ç¢„ÉùÊ∏à</option>
                                <option ${caseData.status === 'ÁèæË™øÊ∏à' ? 'selected' : ''}>ÁèæË™øÊ∏à</option>
                                <option ${caseData.status === 'Ë¶ãÁ©çÊèêÂá∫Ê∏à' ? 'selected' : ''}>Ë¶ãÁ©çÊèêÂá∫Ê∏à</option>
                                <option ${caseData.status === 'ÊàêÁ¥Ñ' ? 'selected' : ''}>ÊàêÁ¥Ñ</option>
                                <option ${caseData.status === '‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à' ? 'selected' : ''}>‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à</option>
                                <option ${caseData.status === 'Â§±Ê≥®' ? 'selected' : ''}>Â§±Ê≥®</option>
                            </select>
                        </div>

                        <!-- Ê¥ªÂãïÂ±•Ê≠¥ -->
                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold mb-2">Ê¥ªÂãïÂ±•Ê≠¥</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center text-gray-600">
                                    <span class="text-xs text-gray-400 w-20">2024/01/15</span>
                                    <span>ÂàùÂõûÊû∂Èõª - ‰∏çÂú®</span>
                                </div>
                                <div class="flex items-center text-gray-600">
                                    <span class="text-xs text-gray-400 w-20">2024/01/16</span>
                                    <span>2ÂõûÁõÆÊû∂Èõª - „Ç¢„ÉùÂèñÂæóÊàêÂäü</span>
                                </div>
                                <div class="flex items-center text-gray-600">
                                    <span class="text-xs text-gray-400 w-20">2024/01/18</span>
                                    <span>ÁèæÂú∞Ë™øÊüªÂÆüÊñΩ</span>
                                </div>
                            </div>
                        </div>

                        <!-- „É°„É¢ -->
                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold mb-2">„É°„É¢</h4>
                            <textarea class="w-full p-2 border rounded h-24" placeholder="„É°„É¢„ÇíÂÖ•Âäõ..."></textarea>
                        </div>
                    </div>

                    <div class="flex justify-end gap-2 mt-6">
                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300">
                            Èñâ„Åò„Çã
                        </button>
                        <button onclick="saveCaseDetail(${caseData.id})" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                            ‰øùÂ≠ò
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Êñ∞Ë¶èÊ°à‰ª∂„É¢„Éº„ÉÄ„É´
        function openNewCaseModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-lg mx-4">
                    <h3 class="text-xl font-bold mb-4">Êñ∞Ë¶èÊ°à‰ª∂ÁôªÈå≤</h3>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">È°ßÂÆ¢Âêç</label>
                            <input type="text" class="w-full p-2 border rounded" placeholder="‰æã: Â±±Áî∞Â§™ÈÉé">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ÈõªË©±Áï™Âè∑</label>
                            <input type="tel" class="w-full p-2 border rounded" placeholder="‰æã: 03-1234-5678">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‰ΩèÊâÄ</label>
                            <input type="text" class="w-full p-2 border rounded" placeholder="‰æã: Êù±‰∫¨ÈÉΩ‰∏ñÁî∞Ë∞∑Âå∫">
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Áâ©‰ª∂Á®ÆÂà•</label>
                                <select class="w-full p-2 border rounded">
                                    <option>Êà∏Âª∫„Å¶</option>
                                    <option>„Ç¢„Éë„Éº„Éà</option>
                                    <option>„Éû„É≥„Ç∑„Éß„É≥</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ÁØâÂπ¥Êï∞</label>
                                <input type="number" class="w-full p-2 border rounded" placeholder="‰æã: 15">
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-end gap-2 mt-6">
                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                        <button onclick="saveNewCase()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                            ÁôªÈå≤
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // ‰øùÂ≠òÂá¶ÁêÜ
        function saveCaseDetail(caseId) {
            showNotification('‰øùÂ≠ò', `Ê°à‰ª∂ #${caseId} „Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü`);
            document.querySelector('.fixed').remove();
        }

        function saveNewCase() {
            showNotification('ÁôªÈå≤', 'Êñ∞Ë¶èÊ°à‰ª∂„ÇíÁôªÈå≤„Åó„Åæ„Åó„Åü');
            document.querySelector('.fixed').remove();
        }

        // Êú™ÊåØ„ÇäÂàÜ„ÅëÊ°à‰ª∂„ÅÆ„ÉÄ„Éü„Éº„Éá„Éº„Çø
        const unassignedCases = [
            {
                id: 101,
                name: 'Êñ∞Ë¶èÈ°ßÂÆ¢A',
                address: 'Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫',
                type: 'Êà∏Âª∫„Å¶„ÉªÁØâ12Âπ¥',
                temperature: 4,
                source: '„Åè„Çâ„Åπ„Çã',
                registeredDate: '2025-01-15 10:30'
            },
            {
                id: 102,
                name: 'Êñ∞Ë¶èÈ°ßÂÆ¢B',
                address: 'Á•ûÂ•àÂ∑ùÁúåÂ∑ùÂ¥éÂ∏Ç',
                type: '„Éû„É≥„Ç∑„Éß„É≥„ÉªÁØâ5Âπ¥',
                temperature: 3,
                source: '„Åè„Çâ„Åπ„Çã',
                registeredDate: '2025-01-15 11:45'
            },
            {
                id: 103,
                name: 'Êñ∞Ë¶èÈ°ßÂÆ¢C',
                address: 'ÂüºÁéâÁúåË∂äË∞∑Â∏Ç',
                type: 'Êà∏Âª∫„Å¶„ÉªÁØâ20Âπ¥',
                temperature: 5,
                source: '„Åè„Çâ„Åπ„Çã',
                registeredDate: '2025-01-15 14:00'
            }
        ];

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ÂàùÊúü„Éê„ÉÉ„Ç∏„Ç´„Ç¶„É≥„Éà„ÇíÊõ¥Êñ∞
            setTimeout(updateTotalBadgeCount, 500);

            // „Ç´„É¨„É≥„ÉÄ„Éº„ÅÆËá™ÂãïÂêåÊúü„ÇíÂÆüË°å
            setTimeout(autoSyncToCalendar, 1000);
        });
    </script>
    <!-- ÁîªÂÉèÊã°Â§ßË°®Á§∫„É¢„Éº„ÉÄ„É´ -->
    <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-90 z-[200] hidden flex items-center justify-center" onclick="closeImageModal()">
        <div class="relative max-w-7xl max-h-full p-4">
            <button onclick="closeImageModal()" class="absolute top-4 right-4 text-white hover:text-gray-300 z-10">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            <img id="modalImage" src="" alt="" class="max-w-full max-h-[90vh] object-contain">
            <p id="modalImageTitle" class="text-white text-center mt-4"></p>
        </div>
    </div>

    <script>
        // ÁîªÂÉè„É¢„Éº„ÉÄ„É´Ê©üËÉΩ
        function openImageModal(src, title) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalTitle = document.getElementById('modalImageTitle');

            modalImage.src = src;
            modalTitle.textContent = title || '';
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // ESC„Ç≠„Éº„Åß„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeImageModal();
            }
        });

        // ÊàêÁ¥ÑÂ†±ÂëäÁî®„ÅÆÊ°à‰ª∂„Ç´„Éº„Éâ‰ΩúÊàê
        function createContractCaseCard(caseItem) {
            const statusColor = getStatusColor(caseItem.managementStatus);
            const deliveredDate = caseItem.deliveredAt ? new Date(caseItem.deliveredAt).toLocaleDateString('ja-JP') : '';

            return `
                <div class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow cursor-pointer"
                     onclick="selectContractCase('${caseItem.cvId}')"
                     data-contract-case-id="${caseItem.cvId}">
                    <div class="flex justify-between items-start mb-3">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusColor}">${caseItem.managementStatus || 'ÈÖç‰ø°Ê∏à'}</span>
                        <button onclick="event.stopPropagation(); selectContractCase('${caseItem.cvId}')"
                                class="p-1.5 rounded-lg bg-green-100 hover:bg-green-200 transition-colors" title="ÊàêÁ¥ÑÂ†±Âëä">
                            <span class="text-lg">‚úÖ</span>
                        </button>
                    </div>
                    <h3 class="font-bold text-lg mb-1">${caseItem.customerName || ''}</h3>
                    <p class="text-xs text-gray-500 mb-2">${caseItem.customerNameKana || ''}</p>
                    <p class="text-sm text-gray-600 mb-2">üìç ${caseItem.address || ''}</p>
                    <p class="text-sm text-gray-600 mb-2">üìû ${caseItem.tel || ''}</p>
                    <p class="text-sm text-gray-600 mb-2">üî® ${caseItem.workCategory || ''}</p>
                    <div class="flex justify-between items-center text-xs text-gray-500">
                        <span>ÈÖç‰ø°Êó•: ${deliveredDate}</span>
                    </div>
                </div>
            `;
        }

        // Êó•‰ªòÁØÑÂõ≤Ë®≠ÂÆöÔºàÊàêÁ¥ÑÂ†±ÂëäÁî®Ôºâ
        function setContractDateRange(range) {
            const today = new Date();
            const startInput = document.getElementById('contractStartDate');
            const endInput = document.getElementById('contractEndDate');

            switch(range) {
                case 'today':
                    startInput.valueAsDate = today;
                    endInput.valueAsDate = today;
                    break;
                case 'week':
                    const weekStart = new Date(today);
                    weekStart.setDate(today.getDate() - today.getDay());
                    startInput.valueAsDate = weekStart;
                    endInput.valueAsDate = today;
                    break;
                case 'month':
                    const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                    startInput.valueAsDate = monthStart;
                    endInput.valueAsDate = today;
                    break;
            }
            searchContractCases();
        }

        // ÊàêÁ¥ÑÂ†±Âëä„ÅÆÊ°à‰ª∂Ê§úÁ¥¢
        function searchContractCases() {
            const searchTerm = normalizeKana(document.getElementById('contractSearchInput').value);
            const assigneeFilter = document.getElementById('contractAssigneeFilter').value;
            const startDate = document.getElementById('contractStartDate').value;
            const endDate = document.getElementById('contractEndDate').value;
            const contractList = document.getElementById('contractCasesList');

            if (!deliveredCasesCache || deliveredCasesCache.length === 0) {
                return; // „Éá„Éº„Çø„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            }

            let filteredCases = deliveredCasesCache;

            // „ÉÜ„Ç≠„Çπ„ÉàÊ§úÁ¥¢ÔºàÂêçÂâç„ÉªÈõªË©±„Éª‰ΩèÊâÄ„Éª„Éï„É™„Ç¨„ÉäÂØæÂøúÔºâ
            if (searchTerm) {
                filteredCases = filteredCases.filter(c => {
                    return (c.customerName && normalizeKana(c.customerName).includes(searchTerm)) ||
                           (c.customerNameKana && normalizeKana(c.customerNameKana).includes(searchTerm)) ||
                           (c.tel && normalizeKana(c.tel).includes(searchTerm)) ||
                           (c.address && normalizeKana(c.address).includes(searchTerm)) ||
                           (c.addressKana && normalizeKana(c.addressKana).includes(searchTerm));
                });
            }

            // ÊúüÈñì„Éï„Ç£„É´„Çø„ÉºÔºàÈÖç‰ø°Êó•ÊôÇ„ÅßÁµû„ÇäËæº„ÅøÔºâ
            if (startDate || endDate) {
                const start = startDate ? new Date(startDate) : new Date('2000-01-01');
                const end = endDate ? new Date(endDate + 'T23:59:59') : new Date('2100-12-31');

                filteredCases = filteredCases.filter(c => {
                    if (!c.deliveredAt) return false;
                    const deliveredDate = new Date(c.deliveredAt);
                    return deliveredDate >= start && deliveredDate <= end;
                });
            }

            // „Ç´„Éº„ÉâË°®Á§∫
            if (filteredCases.length > 0) {
                contractList.innerHTML = filteredCases.map(c => createContractCaseCard(c)).join('');
            } else {
                contractList.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">Ë©≤ÂΩì„Åô„ÇãÊ°à‰ª∂„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</div>';
            }
        }

        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÅÆÊ°à‰ª∂Ê§úÁ¥¢
        window.searchCancelCases = function() {
            const searchTerm = normalizeKana(document.getElementById('cancelSearchInput').value);
            const startDate = document.getElementById('cancelStartDate').value;
            const endDate = document.getElementById('cancelEndDate').value;

            // ÁèæÂú®„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Çø„Éñ„ÇíÂèñÂæó
            const activeTab = document.querySelector('.cancel-tab.border-blue-500, .cancel-tab[class*="border-blue"]');
            const currentTab = activeTab ? activeTab.id.replace('cancelTab-', '') : 'available';

            // „Çø„Éñ„Å´Âøú„Åò„Åü„Ç≠„É£„ÉÉ„Ç∑„É•„Å®„Ç≥„É≥„ÉÜ„Éä„ÇíÂèñÂæó
            let caseCache, containerId;

            if (currentTab === 'available') {
                caseCache = cancelableCasesCache;
                containerId = 'cancelCasesList';
            } else if (currentTab === 'pending') {
                // ÂØ©Êüª‰∏≠„Çø„Éñ„ÅØ loadAppliedCases('pending') „ÅßË™≠„ÅøËæº„ÅøÊ∏à„Åø
                caseCache = cancelRejectedCasesCache; // ‰∏ÄÊôÇÁöÑ„Å´„Åì„ÅÆ„Ç≠„É£„ÉÉ„Ç∑„É•„Çí‰ΩøÁî®
                containerId = 'cancelPendingList';
                // ÂÆüÈöõ„Å´„ÅØÂ∞ÇÁî®„Ç≠„É£„ÉÉ„Ç∑„É•„Çí‰ΩúÊàê„Åô„Åπ„Åç
                return; // ÁèæÊôÇÁÇπ„Åß„ÅØÊ§úÁ¥¢„Çπ„Ç≠„ÉÉ„Éó
            } else if (currentTab === 'approved') {
                containerId = 'cancelApprovedList';
                return; // ÁèæÊôÇÁÇπ„Åß„ÅØÊ§úÁ¥¢„Çπ„Ç≠„ÉÉ„Éó
            } else if (currentTab === 'rejected') {
                caseCache = cancelRejectedCasesCache;
                containerId = 'cancelRejectedList';
            }

            if (!caseCache || caseCache.length === 0) {
                return; // „Éá„Éº„Çø„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            }

            const container = document.getElementById(containerId);
            if (!container) return;

            let filteredCases = caseCache;

            // „ÉÜ„Ç≠„Çπ„ÉàÊ§úÁ¥¢ÔºàÂêçÂâç„ÉªÈõªË©±„Éª‰ΩèÊâÄ„Éª„Éï„É™„Ç¨„ÉäÂØæÂøúÔºâ
            if (searchTerm) {
                filteredCases = filteredCases.filter(c => {
                    return (c.customerName && normalizeKana(c.customerName).includes(searchTerm)) ||
                           (c.customerNameKana && normalizeKana(c.customerNameKana).includes(searchTerm)) ||
                           (c.tel && normalizeKana(c.tel).includes(searchTerm)) ||
                           (c.address && normalizeKana(c.address).includes(searchTerm)) ||
                           (c.addressKana && normalizeKana(c.addressKana).includes(searchTerm));
                });
            }

            // ÊúüÈñì„Éï„Ç£„É´„Çø„Éº
            if (startDate || endDate) {
                const start = startDate ? new Date(startDate) : new Date('2000-01-01');
                const end = endDate ? new Date(endDate + 'T23:59:59') : new Date('2100-12-31');

                filteredCases = filteredCases.filter(c => {
                    if (!c.deliveredAt) return false;
                    const deliveredDate = new Date(c.deliveredAt);
                    return deliveredDate >= start && deliveredDate <= end;
                });
            }

            // „Ç´„Éº„ÉâÂÜçÊèèÁîª
            if (currentTab === 'available' && filteredCases.length > 0) {
                container.innerHTML = filteredCases.map(caseItem => {
                    const deliveredDate = new Date(caseItem.deliveredAt).toLocaleDateString('ja-JP');
                    const deadlineDate = new Date(caseItem.deadlineDate).toLocaleDateString('ja-JP');

                    const statusColors = {
                        'ÈÖç‰ø°Ê∏à': 'bg-blue-100 text-blue-800',
                        'ÈÖç‰ø°ÂæåÊú™ÊàêÁ¥Ñ': 'bg-yellow-100 text-yellow-800',
                        'ÂØæÂøú‰∏≠': 'bg-green-100 text-green-800',
                        'Ë¶ãÁ©çÊèêÂá∫Ê∏à': 'bg-purple-100 text-purple-800',
                        'ÂïÜË´á‰∏≠': 'bg-orange-100 text-orange-800'
                    };
                    const statusColor = statusColors[caseItem.managementStatus] || 'bg-gray-100 text-gray-800';

                    const daysUntilDeadline = 7 - caseItem.daysElapsed;
                    const deadlineClass = daysUntilDeadline <= 1 ? 'text-red-600 font-bold' : 'text-gray-600';

                    return `
                    <div class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow cursor-pointer"
                         onclick="openCancelModal('${caseItem.cvId}')">
                        <div class="flex justify-between items-start mb-3">
                            <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusColor}">${caseItem.managementStatus}</span>
                        </div>
                        <h3 class="font-bold text-lg mb-1">${caseItem.customerName}</h3>
                        <p class="text-sm text-gray-600 mb-2">üìç ${caseItem.address}</p>
                        <p class="text-sm text-gray-600 mb-2">üìû ${caseItem.tel}</p>
                        <p class="text-sm text-gray-600 mb-2">ÈÖç‰ø°Êó•: ${deliveredDate}</p>
                        <p class="text-sm ${deadlineClass}">ÊúüÈôê: ${deadlineDate} (ÊÆã„Çä${daysUntilDeadline}Êó•)</p>
                    </div>
                    `;
                }).join('');
            } else if (currentTab === 'rejected' && filteredCases.length > 0) {
                container.innerHTML = filteredCases.map(caseItem => {
                    const appliedDate = new Date(caseItem.appliedAt).toLocaleDateString('ja-JP');
                    const deliveredDate = new Date(caseItem.deliveredAt).toLocaleDateString('ja-JP');
                    const rejectedDate = caseItem.rejectedAt ? new Date(caseItem.rejectedAt).toLocaleDateString('ja-JP') : '';
                    const rejectionReason = caseItem.rejectionReason
                        ? `<p class="text-sm text-red-600 mt-2"><span class="font-semibold">Âç¥‰∏ãÁêÜÁî±:</span> ${caseItem.rejectionReason}</p>`
                        : '';

                    return `
                    <div class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow">
                        <div class="flex justify-between items-start mb-3">
                            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">Âç¥‰∏ãÊ∏à„Åø</span>
                        </div>
                        <h3 class="font-bold text-lg mb-1">${caseItem.customerName}</h3>
                        <p class="text-sm text-gray-600 mb-2">üìç ${caseItem.address}</p>
                        <p class="text-sm text-gray-600 mb-2">üìû ${caseItem.tel}</p>
                        <p class="text-sm text-gray-600 mb-2">ÈÖç‰ø°Êó•: ${deliveredDate}</p>
                        <p class="text-sm text-gray-600 mb-2">Áî≥Ë´ãÊó•: ${appliedDate}</p>
                        ${rejectedDate ? `<p class="text-sm text-gray-600 mb-2">Âç¥‰∏ãÊó•: ${rejectedDate}</p>` : ''}
                        ${rejectionReason}
                        <div class="mt-3 pt-3 border-t border-gray-200">
                            <p class="text-xs text-gray-500 font-semibold mb-1">Áî≥Ë´ãÁêÜÁî±:</p>
                            <p class="text-xs text-gray-700">${caseItem.reason}</p>
                        </div>
                        <div class="flex gap-1 mt-3">
                            <button onclick="archiveCase('${caseItem.cvId}')" class="flex-1 px-2 py-1.5 bg-gray-100 text-gray-700 rounded text-xs hover:bg-gray-200 transition-colors" title="ËøΩÂÆ¢ÁµÇ‰∫ÜBOX„Å∏ÁßªÂãï">
                                üóëÔ∏è ËøΩÂÆ¢ÁµÇ‰∫Ü
                            </button>
                            <button onclick="openCancelReapplication('${caseItem.cvId}')" class="flex-1 px-2 py-1.5 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200 transition-colors" title="ÂÜçÁî≥Ë´ã">
                                üîÑ ÂÜçÁî≥Ë´ã
                            </button>
                        </div>
                    </div>
                    `;
                }).join('');
            } else {
                container.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">Ë©≤ÂΩì„Åô„ÇãÊ°à‰ª∂„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</div>';
            }
        }

        // ÊúüÈôêÂª∂Èï∑Áî≥Ë´ã„ÅÆÊ°à‰ª∂Ê§úÁ¥¢
        window.searchExtensionCases = function() {
            const searchTerm = normalizeKana(document.getElementById('extensionSearchInput').value);
            const startDate = document.getElementById('extensionStartDate').value;
            const endDate = document.getElementById('extensionEndDate').value;
            const container = document.getElementById('extensionCasesList');

            if (!extensionEligibleCasesCache || extensionEligibleCasesCache.length === 0) {
                return; // „Éá„Éº„Çø„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            }

            let filteredCases = extensionEligibleCasesCache;

            // „ÉÜ„Ç≠„Çπ„ÉàÊ§úÁ¥¢ÔºàÂêçÂâç„ÉªÈõªË©±„Éª‰ΩèÊâÄ„ÉªCV ID„Éª„Éï„É™„Ç¨„ÉäÂØæÂøúÔºâ
            if (searchTerm) {
                filteredCases = filteredCases.filter(c => {
                    return (c.customerName && normalizeKana(c.customerName).includes(searchTerm)) ||
                           (c.customerNameKana && normalizeKana(c.customerNameKana).includes(searchTerm)) ||
                           (c.tel && normalizeKana(c.tel).includes(searchTerm)) ||
                           (c.address && normalizeKana(c.address).includes(searchTerm)) ||
                           (c.addressKana && normalizeKana(c.addressKana).includes(searchTerm)) ||
                           (c.cvId && normalizeKana(c.cvId).includes(searchTerm));
                });
            }

            // ÊúüÈñì„Éï„Ç£„É´„Çø„Éº
            if (startDate || endDate) {
                const start = startDate ? new Date(startDate) : new Date('2000-01-01');
                const end = endDate ? new Date(endDate + 'T23:59:59') : new Date('2100-12-31');

                filteredCases = filteredCases.filter(c => {
                    if (!c.deliveredAt) return false;
                    const deliveredDate = new Date(c.deliveredAt);
                    return deliveredDate >= start && deliveredDate <= end;
                });
            }

            // „Ç´„Éº„ÉâÂÜçÊèèÁîª
            if (filteredCases.length > 0) {
                container.innerHTML = filteredCases.map(caseItem => {
                    const deliveredDate = new Date(caseItem.deliveredAt).toLocaleDateString('ja-JP');
                    const currentDeadline = new Date(caseItem.applicationDeadline).toLocaleDateString('ja-JP');
                    const extendedDeadline = new Date(caseItem.extendedDeadline).toLocaleDateString('ja-JP');
                    return `
                    <div class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow cursor-pointer"
                         onclick="openExtensionModal('${caseItem.cvId}')">
                        <div class="flex justify-between items-start mb-3">
                            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">Âª∂Èï∑ÂèØËÉΩ</span>
                            <button onclick="event.stopPropagation(); openCancelModal('${caseItem.cvId}')"
                                    class="px-2 py-1 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors"
                                    title="„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã">
                                ‚ùå „Ç≠„É£„É≥„Çª„É´
                            </button>
                        </div>
                        <h3 class="font-bold text-lg mb-1">${caseItem.customerName}</h3>
                        <p class="text-sm text-gray-600 mb-2">üìç ${caseItem.address}</p>
                        <p class="text-sm text-gray-600 mb-2">üìû ${caseItem.tel}</p>
                        <p class="text-sm text-gray-600 mb-2">ÈÖç‰ø°Êó•: ${deliveredDate}</p>
                        <p class="text-sm text-red-600">ÁèæÂú®„ÅÆÊúüÈôê: ${currentDeadline}</p>
                        <p class="text-sm text-green-600 font-semibold">Âª∂Èï∑ÂæåÊúüÈôê: ${extendedDeadline}</p>
                    </div>
                    `;
                }).join('');
            } else {
                container.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">Ë©≤ÂΩì„Åô„ÇãÊ°à‰ª∂„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</div>';
            }
        }

        // ÂàùÊúüË°®Á§∫Áî®
        function displayCancelCases() {
            loadCancelableCases();
        }

        function displayContractCases() {
            searchContractCases();
        }

        // „Ç≠„É£„É≥„Çª„É´Ê°à‰ª∂ÈÅ∏Êäû
        function selectCancelCase(caseId) {
            selectedCancelCase = casesData.find(c => c.id === caseId);
            if (selectedCancelCase) {
                cancelAnswers = [];
                showCancelQuestions();
                document.getElementById('cancelModal').classList.remove('hidden');
            }
        }

        // ÊàêÁ¥ÑÂ†±Âëä„ÅÆË≥™ÂïèÂÆöÁæ©
        let contractQuestions = [
            {
                question: 'Â†±ÂëäÁ®ÆÂà•„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
                options: ['ÊàêÁ¥ÑÂ†±Âëä', 'ËøΩÂä†Â∑•‰∫ãÂ†±Âëä']
            },
            {
                question: 'ÁèæÂú®„ÅÆÁä∂Ê≥Å„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
                options: ['Â•ëÁ¥ÑÂâç„ÉªÂè£È†≠Á¢∫Á¥ÑÊ∏à', 'Â•ëÁ¥ÑÂæå„ÉªÂ∑•‰∫ãÂâç', 'Â∑•‰∫ã‰∏≠', 'Â∑•‰∫ãÂÆå‰∫ÜÂæå']
            }
        ];

        // Â•ëÁ¥ÑÁä∂Ê≥Å„Å´Âøú„Åò„Å¶Êó•‰ªò„É©„Éô„É´„ÇíÊõ¥Êñ∞
        window.updateDateLabels = function(status) {
            const completionLabel = document.getElementById('completionDateLabel');
            const paymentLabel = document.getElementById('paymentDateLabel');

            switch(status) {
                case 'Â•ëÁ¥ÑÂâç„ÉªÂè£È†≠Á¢∫Á¥ÑÊ∏à':
                case 'Â•ëÁ¥ÑÂæå„ÉªÂ∑•‰∫ãÂâç':
                    completionLabel.textContent = 'ÂÆåÂ∑•‰∫àÂÆöÊó•';
                    paymentLabel.textContent = 'ÁùÄÈáë‰∫àÂÆöÊó•';
                    break;
                case 'Â∑•‰∫ã‰∏≠':
                    completionLabel.textContent = 'ÂÆåÂ∑•‰∫àÂÆöÊó•';
                    paymentLabel.textContent = 'ÁùÄÈáëÊó•';
                    break;
                case 'Â∑•‰∫ãÂÆå‰∫ÜÂæå':
                    completionLabel.textContent = 'ÂÆåÂ∑•Êó•';
                    paymentLabel.textContent = 'ÁùÄÈáëÊó•';
                    break;
                default:
                    completionLabel.textContent = 'ÂÆåÂ∑•‰∫àÂÆöÊó•';
                    paymentLabel.textContent = 'ÁùÄÈáë‰∫àÂÆöÊó•';
            }
        }

        // „Åù„ÅÆ‰ªñ„ÉÅ„Çß„ÉÉ„ÇØÊôÇ„ÅÆË©≥Á¥∞ÂÖ•ÂäõÊ¨ÑË°®Á§∫
        window.toggleOtherWorkDetails = function() {
            const otherCheckbox = document.querySelector('input[name="workType"][value="„Åù„ÅÆ‰ªñ"]');
            const detailsTextarea = document.getElementById('workDetails');

            if (otherCheckbox && otherCheckbox.checked) {
                detailsTextarea.classList.remove('hidden');
            } else {
                detailsTextarea.classList.add('hidden');
                detailsTextarea.value = '';
            }
        }

        // „Åù„ÅÆ‰ªñÁâ©‰ª∂„Çø„Ç§„Éó„ÅÆË©≥Á¥∞ÂÖ•ÂäõÊ¨ÑË°®Á§∫
        window.toggleOtherPropertyDetails = function() {
            const otherCheckbox = document.querySelector('input[name="propertyType"][value="„Åù„ÅÆ‰ªñ"]');
            const detailsInput = document.getElementById('otherPropertyDetails');

            if (otherCheckbox && otherCheckbox.checked) {
                detailsInput.classList.remove('hidden');
            } else {
                detailsInput.classList.add('hidden');
                detailsInput.value = '';
            }
        }

        // ÊàêÁ¥Ñ„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        window.closeContractModal = function() {
            document.getElementById('contractModal').classList.add('hidden');
            document.getElementById('contractQuestionContainer').classList.remove('hidden');
            document.getElementById('contractFormPhase').classList.add('hidden');
            document.getElementById('contractCustomerInfo').classList.add('hidden');
            selectedContractCase = null;
            contractAnswers = [];
            resetContractForm();
        }

        // „Ç≠„É£„É≥„Çª„É´Ë≥™ÂïèË°®Á§∫
        function showCancelQuestions() {
            const container = document.getElementById('cancelQuestionContainer');
            const currentQuestion = cancelQuestions[cancelAnswers.length];

            if (currentQuestion) {
                container.innerHTML = `
                    <div class="mb-4">
                        <h4 class="text-lg font-medium mb-3">${currentQuestion.question}</h4>
                        <div class="grid grid-cols-2 gap-3">
                            ${currentQuestion.options.map(option => `
                                <button onclick="answerCancelQuestion('${option}')"
                                        class="p-3 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-500 transition-colors">
                                    ${option}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
        }

        // „Åù„ÅÆ‰ªñ„ÅÆÁêÜÁî±„ÇíÈÄÅ‰ø°
        window.submitOtherReason = function() {
            const reasonInput = document.getElementById('otherReasonInput');
            if (reasonInput && reasonInput.value.trim()) {
                cancelAnswers.otherReason = reasonInput.value.trim();
                showAdditionalInfoInput();
            } else {
                alert('ÁêÜÁî±„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            }
        }

        // ËøΩÂä†ÊÉÖÂ†±ÂÖ•ÂäõÁîªÈù¢„ÇíË°®Á§∫
        window.showAdditionalInfoInput = function() {
            const container = document.getElementById('cancelQuestionContainer');
            container.innerHTML = `
                <div class="mb-4">
                    <h4 class="text-lg font-medium mb-3">ËøΩÂä†ÊÉÖÂ†±„Åå„ÅÇ„Çå„Å∞„ÅîË®òÂÖ•„Åè„Å†„Åï„ÅÑÔºà‰ªªÊÑèÔºâ</h4>
                    <textarea id="additionalInfoInput" class="w-full px-3 py-2 border rounded-lg" rows="4"
                              placeholder="‰æãÔºö„ÅäÂÆ¢Êßò„ÅÆË©≥„Åó„ÅÑÁä∂Ê≥Å„ÄÅ‰ªäÂæå„ÅÆÂØæÂøú‰∫àÂÆö„ÄÅ„Åù„ÅÆ‰ªñË£úË∂≥‰∫ãÈ†Ö„Å™„Å©"></textarea>
                    <div class="flex gap-3 mt-3">
                        <button onclick="skipAdditionalInfo()" class="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                            „Çπ„Ç≠„ÉÉ„Éó
                        </button>
                        <button onclick="submitAdditionalInfo()" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                            ÂÆå‰∫Ü
                        </button>
                    </div>
                </div>
            `;
        }

        // ËøΩÂä†ÊÉÖÂ†±„Çí„Çπ„Ç≠„ÉÉ„Éó
        window.skipAdditionalInfo = function() {
            cancelAnswers.additionalInfo = '';
            generateCancelText();
        }

        // ËøΩÂä†ÊÉÖÂ†±„ÇíÈÄÅ‰ø°
        window.submitAdditionalInfo = function() {
            const infoInput = document.getElementById('additionalInfoInput');
            cancelAnswers.additionalInfo = infoInput ? infoInput.value.trim() : '';
            generateCancelText();
        }

        // „Ç≠„É£„É≥„Çª„É´Ë≥™ÂïèÂõûÁ≠î
        window.answerCancelQuestion = function(answer) {
            const container = document.getElementById('cancelQuestionContainer');

            // ÊúÄÂàù„ÅÆÂõûÁ≠î„Çí‰øùÂ≠ò
            if (cancelAnswers.length === 0) {
                cancelAnswers.push(answer);

                // ÈÅ∏Êäû„Å´Âøú„Åò„ÅüËøΩÂä†Ë≥™Âïè„ÇíË°®Á§∫
                if (answer === 'ÈÄ£Áµ°„ÅåÁπã„Åå„Çâ„Å™„ÅÑ') {
                    container.innerHTML = `
                        <div class="mb-4">
                            <h4 class="text-lg font-medium mb-3">ÈÄ£Áµ°„ÅÆÁä∂Ê≥Å„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h4>
                            <div class="grid grid-cols-1 gap-2">
                                <button onclick="submitContactStatus('‰∏ÄÂ∫¶„ÇÇÁπã„Åå„Çâ„Å™„ÅÑ')" class="p-3 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-500">‰∏ÄÂ∫¶„ÇÇÁπã„Åå„Çâ„Å™„ÅÑ</button>
                                <button onclick="submitContactStatus('Áπã„Åå„Å£„Åü„Åå„Ç¢„Éù„ÅåÂèñ„Çå„Å™„ÅÑ')" class="p-3 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-500">Áπã„Åå„Å£„Åü„Åå„Ç¢„Éù„ÅåÂèñ„Çå„Å™„ÅÑ</button>
                                <button onclick="submitContactStatus('ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´')" class="p-3 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-500">ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´</button>
                                <button onclick="submitContactStatus('ÁèæË™øÂæåË¶ãÁ©ç„ÇÇ„Çä„ÅäÊ∏°„ÅóÂâç„Ç≠„É£„É≥„Çª„É´')" class="p-3 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-500">ÁèæË™øÂæåË¶ãÁ©ç„ÇÇ„Çä„ÅäÊ∏°„ÅóÂâç„Ç≠„É£„É≥„Çª„É´</button>
                                <button onclick="submitContactStatus('Ë¶ãÁ©ç„ÇÇ„Çä„ÅäÊ∏°„ÅóÂæå„Ç≠„É£„É≥„Çª„É´')" class="p-3 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-500">Ë¶ãÁ©ç„ÇÇ„Çä„ÅäÊ∏°„ÅóÂæå„Ç≠„É£„É≥„Çª„É´</button>
                            </div>
                        </div>
                    `;
                } else if (answer === '‰ªñÁ§æ„ÅßÂ•ëÁ¥Ñ„Åó„Åü' || answer === '„Åô„Åß„Å´‰ªñÁ§æ„ÅßÊ§úË®é‰∏≠') {
                    container.innerHTML = `
                        <div class="mb-4">
                            <h4 class="text-lg font-medium mb-3">${answer === '‰ªñÁ§æ„ÅßÂ•ëÁ¥Ñ„Åó„Åü' ? '„Å©„Å°„Çâ„ÅßÂ•ëÁ¥Ñ„Åï„Çå„Åæ„Åó„Åü„ÅãÔºü' : '„Å©„Å°„Çâ„ÅßÊ§úË®é„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÅãÔºü'}</h4>
                            <div class="grid grid-cols-1 gap-2">
                                <button onclick="submitCompetitor('„Åè„Çâ„Åπ„ÇãÂä†ÁõüÂ∫ó')" class="p-3 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-500">„Åè„Çâ„Åπ„ÇãÂä†ÁõüÂ∫ó</button>
                                <button onclick="submitCompetitor('‰∏çÊòé')" class="p-3 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-500">‰∏çÊòé</button>
                                <button onclick="showCompetitorInput()" class="p-3 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-500">„Åù„ÅÆ‰ªñÔºà‰ºöÁ§æÂêç„ÇíÂÖ•ÂäõÔºâ</button>
                            </div>
                        </div>
                    `;
                } else if (answer === '„Åù„ÅÆ‰ªñ') {
                    container.innerHTML = `
                        <div class="mb-4">
                            <h4 class="text-lg font-medium mb-3">„Åù„ÅÆ‰ªñ„ÅÆÁêÜÁî±„ÇíÂÖ∑‰ΩìÁöÑ„Å´ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h4>
                            <textarea id="otherReasonInput" class="w-full px-3 py-2 border rounded-lg" rows="3" placeholder="„Ç≠„É£„É≥„Çª„É´ÁêÜÁî±„ÇíÂÖ•Âäõ"></textarea>
                            <button onclick="submitOtherReason()" class="mt-3 px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                Ê¨°„Å∏
                            </button>
                        </div>
                    `;
                } else {
                    // „Åù„ÅÆ‰ªñ„ÅÆÁêÜÁî±„ÅÆÂ†¥Âêà„ÅØËøΩÂä†ÊÉÖÂ†±ÂÖ•ÂäõÁîªÈù¢„Å∏
                    showAdditionalInfoInput();
                }
            }
        }

        // ÈÄ£Áµ°Áä∂Ê≥Å„ÇíÈÄÅ‰ø°
        window.submitContactStatus = function(status) {
            cancelAnswers.contactStatus = status;
            showAdditionalInfoInput();
        }

        // Á´∂Âêà‰ªñÁ§æ„ÇíÈÄÅ‰ø°
        window.submitCompetitor = function(competitor) {
            cancelAnswers.competitor = competitor;
            showAdditionalInfoInput();
        }

        // Á´∂Âêà‰ªñÁ§æÂêçÂÖ•ÂäõÊ¨Ñ„ÇíË°®Á§∫
        function showCompetitorInput() {
            const container = document.getElementById('cancelQuestionContainer');
            container.innerHTML = `
                <div class="mb-4">
                    <h4 class="text-lg font-medium mb-3">Â•ëÁ¥ÑÂÖà„ÅÆ‰ºöÁ§æÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h4>
                    <input type="text" id="competitorNameInput" class="w-full px-3 py-2 border rounded-lg" placeholder="‰ºöÁ§æÂêç„ÇíÂÖ•Âäõ">
                    <button onclick="submitCompetitorName()" class="mt-3 px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                        Ê¨°„Å∏
                    </button>
                </div>
            `;
        }

        // Á´∂Âêà‰ªñÁ§æÂêç„ÇíÈÄÅ‰ø°
        window.submitCompetitorName = function() {
            const nameInput = document.getElementById('competitorNameInput');
            if (nameInput && nameInput.value.trim()) {
                cancelAnswers.competitor = nameInput.value.trim();
                showAdditionalInfoInput();
            } else {
                alert('‰ºöÁ§æÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            }
        }

        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ãÊñáÁîüÊàê
        function generateCancelText() {
            const aiResponse = document.getElementById('cancelAIResponse');
            const aiText = document.getElementById('cancelAIText');

            // „É°„Ç§„É≥ÁêÜÁî±„ÅÆÂèñÂæó
            let mainReason = cancelAnswers[0];
            let detailText = '';

            if (cancelAnswers[0] === '„Åù„ÅÆ‰ªñ' && cancelAnswers.otherReason) {
                mainReason = cancelAnswers.otherReason;
            } else if (cancelAnswers[0] === 'ÈÄ£Áµ°„ÅåÁπã„Åå„Çâ„Å™„ÅÑ' && cancelAnswers.contactStatus) {
                detailText = `\nÈÄ£Áµ°Áä∂Ê≥Å: ${cancelAnswers.contactStatus}`;
            } else if ((cancelAnswers[0] === '‰ªñÁ§æ„ÅßÂ•ëÁ¥Ñ„Åó„Åü' || cancelAnswers[0] === '„Åô„Åß„Å´‰ªñÁ§æ„ÅßÊ§úË®é‰∏≠') && cancelAnswers.competitor) {
                const label = cancelAnswers[0] === '‰ªñÁ§æ„ÅßÂ•ëÁ¥Ñ„Åó„Åü' ? 'Â•ëÁ¥ÑÂÖà' : 'Ê§úË®éÂÖà';
                detailText = `\n${label}: ${cancelAnswers.competitor}`;
            }

            // ËøΩÂä†ÊÉÖÂ†±„Åå„ÅÇ„Çå„Å∞Âê´„ÇÅ„Çã
            let additionalSection = '';
            if (cancelAnswers.additionalInfo) {
                additionalSection = `\n\n„ÄêËøΩÂä†ÊÉÖÂ†±„Äë\n${cancelAnswers.additionalInfo}`;
            }

            // ÁêÜÁî±„Å´Âøú„Åò„ÅüË©≥Á¥∞Êñá„ÇíÁîüÊàê
            let detailDescription = '';

            if (cancelAnswers[0] === 'ÈÄ£Áµ°„ÅåÁπã„Åå„Çâ„Å™„ÅÑ') {
                if (cancelAnswers.contactStatus === '‰∏ÄÂ∫¶„ÇÇÁπã„Åå„Çâ„Å™„ÅÑ') {
                    detailDescription = `„ÅäÂÆ¢Êßò„Å´„ÅîÈÄ£Áµ°„ÇíË©¶„Åø„Åæ„Åó„Åü„Åå„ÄÅÊÆãÂøµ„Å™„Åå„Çâ‰∏ÄÂ∫¶„ÇÇ„ÅäÈõªË©±„ÅåÁπã„Åå„Çâ„Å™„ÅÑÁä∂Ê≥Å„Åß„Åô„ÄÇ`;
                } else if (cancelAnswers.contactStatus === 'Áπã„Åå„Å£„Åü„Åå„Ç¢„Éù„ÅåÂèñ„Çå„Å™„ÅÑ') {
                    detailDescription = `„ÅäÂÆ¢Êßò„Å®„ÅäÈõªË©±„ÅØÁπã„Åå„Çä„Åæ„Åó„Åü„Åå„ÄÅÁèæÂú∞Ë™øÊüª„ÅÆ„Ç¢„Éù„Ç§„É≥„Éà„É°„É≥„Éà„ÅåÂèñ„Çå„Å™„ÅÑÁä∂Ê≥Å„Åß„Åô„ÄÇ`;
                } else if (cancelAnswers.contactStatus === 'ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´') {
                    detailDescription = `ÁèæÂú∞Ë™øÊüªÂâç„ÅÆÊÆµÈöé„Åß„ÄÅ„ÅäÂÆ¢Êßò„Åã„Çâ„Ç≠„É£„É≥„Çª„É´„ÅÆ„ÅäÁî≥„ÅóÂá∫„Åå„ÅÇ„Çä„Åæ„Åó„Åü„ÄÇ`;
                } else if (cancelAnswers.contactStatus === 'ÁèæË™øÂæåË¶ãÁ©ç„ÇÇ„Çä„ÅäÊ∏°„ÅóÂâç„Ç≠„É£„É≥„Çª„É´') {
                    detailDescription = `ÁèæÂú∞Ë™øÊüª„ÅØÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„Åå„ÄÅ„ÅäË¶ãÁ©ç„ÇÇ„Çä„Çí„ÅäÊ∏°„Åó„Åô„ÇãÂâç„Å´„Ç≠„É£„É≥„Çª„É´„Å®„Å™„Çä„Åæ„Åó„Åü„ÄÇ`;
                } else if (cancelAnswers.contactStatus === 'Ë¶ãÁ©ç„ÇÇ„Çä„ÅäÊ∏°„ÅóÂæå„Ç≠„É£„É≥„Çª„É´') {
                    detailDescription = `„ÅäË¶ãÁ©ç„ÇÇ„Çä„Çí„ÅäÊ∏°„Åó„Åó„ÅüÂæå„ÄÅ„ÅäÂÆ¢Êßò„ÅÆ„ÅîÈÉΩÂêà„Å´„Çà„Çä„Ç≠„É£„É≥„Çª„É´„Å®„Å™„Çä„Åæ„Åó„Åü„ÄÇ`;
                }
            } else if (cancelAnswers[0] === '‰æ°Ê†º„ÅåÂêà„Çè„Å™„ÅÑ') {
                detailDescription = `„ÅäË¶ãÁ©ç„ÇÇ„Çä„Çí„ÅîÊ§úË®é„ÅÑ„Åü„Å†„Åç„Åæ„Åó„Åü„Åå„ÄÅ„Åî‰∫àÁÆó„Å®„ÅÆÂÖº„Å≠Âêà„ÅÑ„Åß‰ªäÂõû„ÅØË¶ãÈÄÅ„Çä„Å®„Å™„Çä„Åæ„Åó„Åü„ÄÇ`;
            } else if (cancelAnswers[0] === '‰ªñÁ§æ„ÅßÂ•ëÁ¥Ñ„Åó„Åü') {
                detailDescription = `„ÅäÂÆ¢Êßò„ÅØ‰ªñÁ§æ„Åß„ÅÆÂ•ëÁ¥Ñ„ÇíÈÅ∏Êäû„Åï„Çå„Åæ„Åó„Åü„ÄÇ`;
            } else if (cancelAnswers[0] === '„Åô„Åß„Å´‰ªñÁ§æ„ÅßÊ§úË®é‰∏≠') {
                detailDescription = `„ÅäÂÆ¢Êßò„ÅØÊó¢„Å´‰ªñÁ§æ„ÅßÊ§úË®é„ÇíÈÄ≤„ÇÅ„Å¶„Åä„Çä„ÄÅ„Åù„Å°„Çâ„ÅßÊ±∫ÂÆö„Åï„Çå„Çã‰∫àÂÆö„Åß„Åô„ÄÇ`;
            } else if (cancelAnswers[0] === 'Â∑•‰∫ã„ÅÆÂøÖË¶Å„Åå„Å™„Åè„Å™„Å£„Åü') {
                detailDescription = `„ÅäÂÆ¢Êßò„ÅÆ„Åî‰∫ãÊÉÖ„Å´„Çà„Çä„ÄÅÂ∑•‰∫ãËá™‰Ωì„Åå‰∏çË¶Å„Å®„Å™„Çä„Åæ„Åó„Åü„ÄÇ`;
            } else if (cancelAnswers[0] === '„Åù„ÅÆ‰ªñ' && cancelAnswers.otherReason) {
                detailDescription = `${cancelAnswers.otherReason}`;
            } else {
                detailDescription = `„ÅäÂÆ¢Êßò„ÅÆ„ÅîÈÉΩÂêà„Å´„Çà„Çä„ÄÅÊ°à‰ª∂„Çí„Ç≠„É£„É≥„Çª„É´„Åï„Åõ„Å¶„ÅÑ„Åü„Å†„Åè„Åì„Å®„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇ`;
            }

            // „ÉÜ„Ç≠„Çπ„ÉàÁîüÊàê
            const cancelText = `„Äê„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„Äë\n\n` +
                `Ê°à‰ª∂Âêç: ${selectedCancelCase.name}\n` +
                `Áâ©‰ª∂: ${selectedCancelCase.propertyType || 'Êú™Ë®≠ÂÆö'}\n` +
                `„Ç®„É™„Ç¢: ${selectedCancelCase.location || selectedCancelCase.area || 'Êú™Ë®≠ÂÆö'}\n\n` +
                `„Äê„Ç≠„É£„É≥„Çª„É´ÁêÜÁî±„Äë\n` +
                `${mainReason}${detailText}\n\n` +
                `„ÄêË©≥Á¥∞„Äë\n` +
                `${detailDescription}\n\n` +
                `‰ªäÂæå„ÇÇËâØÂ•Ω„Å™Èñ¢‰øÇ„ÇíÁ∂≠ÊåÅ„Åß„Åç„Çã„Çà„ÅÜ„ÄÅÈÅ©Âàá„Å™„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó„ÇíÂøÉ„Åå„Åë„Åæ„Åô„ÄÇ` +
                additionalSection;

            aiText.textContent = cancelText;
            aiResponse.classList.remove('hidden');
            document.getElementById('cancelQuestionContainer').innerHTML = '';
        }

        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ãÊñáÂÜçÁîüÊàê
        function regenerateCancelText() {
            // ÂÜçÂ∫¶Ë≥™Âïè„Åã„ÇâÈñãÂßã
            cancelAnswers = [];
            document.getElementById('cancelAIResponse').classList.add('hidden');
            showCancelQuestions();
        }

        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ãÈÄÅ‰ø°
        function submitCancelRequest() {
            alert('„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÅåÈÄÅ‰ø°„Åï„Çå„Åæ„Åó„Åü');
            closeCancelModal();
            // ÂÆüÈöõ„ÅÆÂá¶ÁêÜ„Çí„Åì„Åì„Å´ËøΩÂä†
        }

        // „Ç≠„É£„É≥„Çª„É´„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        window.closeCancelModal = function() {
            document.getElementById('cancelModal').classList.add('hidden');
            selectedCancelCase = null;
            cancelAnswers = [];
        }

        // „Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂá¶ÁêÜ
        function handleFileUpload(event, type) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewId = type === 'estimate' ? 'estimatePreview' : 'receiptPreview';
                    const preview = document.getElementById(previewId);

                    if (file.type.includes('image')) {
                        preview.innerHTML = `<img src="${e.target.result}" class="w-full h-32 object-cover rounded">`;
                    } else {
                        preview.innerHTML = `
                            <div class="flex items-center justify-center">
                                <svg class="w-12 h-12 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="ml-2 text-sm">${file.name}</span>
                            </div>
                        `;
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        // ÊàêÁ¥ÑÂ†±Âëä„Éï„Ç©„Éº„É†„É™„Çª„ÉÉ„Éà
        window.resetContractForm = function() {
            const form = document.getElementById('contractReportForm');
            if (form) {
                form.reset();
            }
            document.getElementById('workDetails').classList.add('hidden');
            document.getElementById('otherPropertyDetails').classList.add('hidden');
            document.getElementById('estimatePreview').innerHTML = `
                <svg class="w-12 h-12 text-gray-400 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
            `;
            document.getElementById('receiptPreview').innerHTML = `
                <svg class="w-12 h-12 text-gray-400 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
            `;
        }

        // ÊàêÁ¥ÑÂ†±Âëä„Éï„Ç©„Éº„É†ÈÄÅ‰ø°
        document.addEventListener('DOMContentLoaded', function() {
            const contractForm = document.getElementById('contractReportForm');
            if (contractForm) {
                contractForm.addEventListener('submit', function(e) {
                    e.preventDefault();

                    // ÈÅ∏Êäû„Åï„Çå„ÅüÊñΩÂ∑•ÂÜÖÂÆπ„ÇíÂèñÂæó
                    const selectedWorkTypes = [];
                    document.querySelectorAll('input[name="workType"]:checked').forEach(checkbox => {
                        selectedWorkTypes.push(checkbox.value);
                    });

                    // ÈÅ∏Êäû„Åï„Çå„ÅüÁâ©‰ª∂„Çø„Ç§„Éó„ÇíÂèñÂæó
                    const selectedPropertyTypes = [];
                    document.querySelectorAll('input[name="propertyType"]:checked').forEach(checkbox => {
                        selectedPropertyTypes.push(checkbox.value);
                    });

                    // ÊàêÁ¥ÑÂ†±Âëä„ÇíÈÄÅ‰ø°
                    submitContractReport(selectedWorkTypes, selectedPropertyTypes);
                });
            }

            // ‰∏ÄÊôÇÂÅúÊ≠¢„ÅÆÊó•‰ªòÂ§âÊõ¥ÊôÇ„Å´Âç≥ÊôÇ‰øùÂ≠ò
        });

        // ============================================
        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÉªÊúüÈôêÂª∂Èï∑Áî≥Ë´ã„Ç∑„Çπ„ÉÜ„É†
        // ============================================

        // API URL (env-loader„Åã„ÇâÂãïÁöÑÂèñÂæó)
        const CANCEL_API_URL = window.ENV?.GAS_URL || '';

        // „Éá„Éº„Çø„Ç≠„É£„ÉÉ„Ç∑„É•Áî®Â§âÊï∞
        let cancelableCasesCache = [];
        let cancelRejectedCasesCache = []; // Âç¥‰∏ãÊ∏à„ÅøÊ°à‰ª∂„Ç≠„É£„ÉÉ„Ç∑„É•
        let extensionEligibleCasesCache = [];
        let deliveredCasesCache = []; // ÊàêÁ¥ÑÂ†±ÂëäÔºöÈÖç‰ø°Ê∏à„ÅøÊ°à‰ª∂„Ç≠„É£„ÉÉ„Ç∑„É•

        // „Ç∞„É≠„Éº„Éê„É´Áä∂ÊÖã
        let cancelCurrentStep = 1;
        let cancelSelectedCase = null;
        let cancelSelectedCategory = null;
        let cancelSelectedSubCategory = null;
        let cancelQuestionAnswers = {};
        let cancelAiGenerationCount = 0; // AIÁîüÊàêÂõûÊï∞„Ç´„Ç¶„É≥„Çø„Éº

        // ÊàêÁ¥ÑÂ†±ÂëäÁî®„Ç∞„É≠„Éº„Éê„É´Áä∂ÊÖã
        let selectedContractCase = null;
        let contractAnswers = [];

        // „ÉÜ„Ç≠„Çπ„ÉàÂ±•Ê≠¥ÁÆ°ÁêÜÔºà„Ç¢„É≥„Éâ„Ç•/„É™„Éâ„Ç•Áî®Ôºâ
        let textHistory = [];
        let textHistoryIndex = -1;

        let extensionSelectedCase = null;

        // „É™„Éà„É©„Ç§Ê©üËÉΩ‰ªò„ÅçFetchÈñ¢Êï∞
        async function fetchWithRetry(url, options = {}, retries = window.ENV.MAX_RETRIES, delay = window.ENV.RETRY_DELAY) {
            for (let i = 0; i < retries; i++) {
                try {
                    console.log(`[fetchWithRetry] Ë©¶Ë°å ${i + 1}/${retries}: ${url}`);

                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), window.ENV.TIMEOUT);

                    const response = await fetch(url, {
                        ...options,
                        signal: controller.signal
                    });

                    clearTimeout(timeoutId);

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    return response;
                } catch (error) {
                    console.error(`[fetchWithRetry] Ë©¶Ë°å ${i + 1} Â§±Êïó:`, error);

                    if (i === retries - 1) {
                        throw error;
                    }

                    // ÊåáÊï∞„Éê„ÉÉ„ÇØ„Ç™„Éï„Åß„É™„Éà„É©„Ç§
                    const waitTime = delay * Math.pow(2, i);
                    console.log(`[fetchWithRetry] ${waitTime}ms ÂæÖÊ©üÂæå„ÄÅÂÜçË©¶Ë°å„Åó„Åæ„Åô...`);
                    await new Promise(resolve => setTimeout(resolve, waitTime));
                }
            }
        }

        // ============================================
        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„Çø„ÉñÁÆ°ÁêÜ
        // ============================================

        let currentCancelTab = 'available'; // ÁèæÂú®„ÅÆ„Çø„Éñ

        // „Çø„ÉñÂàá„ÇäÊõø„Åà
        window.switchCancelTab = function(tabName) {
            currentCancelTab = tabName;

            // ÂÖ®„Çø„Éñ„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´„Çí„É™„Çª„ÉÉ„Éà
            document.querySelectorAll('.cancel-tab').forEach(tab => {
                tab.classList.remove('border-blue-500', 'text-blue-600', 'font-medium');
                tab.classList.add('border-transparent', 'text-gray-500');
            });

            // ÂÖ®„Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÈùûË°®Á§∫
            document.querySelectorAll('.cancel-tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            // ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Éñ„Çí„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÂåñ
            const selectedTab = document.getElementById(`cancelTab-${tabName}`);
            if (selectedTab) {
                selectedTab.classList.remove('border-transparent', 'text-gray-500');
                selectedTab.classList.add('border-blue-500', 'text-blue-600', 'font-medium');
            }

            // ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË°®Á§∫
            const selectedContent = document.getElementById(`cancelTabContent-${tabName}`);
            if (selectedContent) {
                selectedContent.classList.remove('hidden');
            }

            // „Çø„Éñ„Å´Âøú„Åò„Å¶„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
            switch(tabName) {
                case 'available':
                    loadCancelableCases();
                    break;
                case 'pending':
                    loadAppliedCases('pending');
                    break;
                case 'approved':
                    loadAppliedCases('approved');
                    break;
                case 'rejected':
                    loadAppliedCases('rejected');
                    break;
            }
        }

        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ãÊ∏à„ÅøÊ°à‰ª∂„ÇíË™≠„ÅøËæº„ÅøÔºà„Çπ„ÉÜ„Éº„Çø„ÇπÂà•Ôºâ
        async function loadAppliedCases(status) {
            // „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„ÅüDOM„Ç≥„É≥„ÉÜ„Éä„ÇíÂèñÂæó
            const containerIds = {
                'pending': 'cancelPendingList',
                'approved': 'cancelApprovedList',
                'rejected': 'cancelRejectedList'
            };

            const containerId = containerIds[status];
            const container = document.getElementById(containerId);

            if (!container) {
                console.error(`Container not found for status: ${status}`);
                return;
            }

            try {
                const merchantId = window.merchantId;
                if (!merchantId) {
                    alert('„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    return;
                }

                // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
                container.innerHTML = '<div class="col-span-full text-center py-8"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div><p class="text-gray-600 mt-2">Ë™≠„ÅøËæº„Åø‰∏≠...</p></div>';

                const response = await fetchWithRetry(`${CANCEL_API_URL}?action=getCancelAppliedCases&merchantId=${merchantId}&status=${status}`);
                const result = await response.json();

                if (result.success && result.cases && result.cases.length > 0) {
                    // Âç¥‰∏ãÊ∏à„ÅøÊ°à‰ª∂„ÅÆÂ†¥Âêà„ÅØ„Ç≠„É£„ÉÉ„Ç∑„É•„Å´‰øùÂ≠òÔºàÂÜçÁî≥Ë´ãÁî®Ôºâ
                    if (status === 'rejected') {
                        cancelRejectedCasesCache = result.cases;
                    }

                    container.innerHTML = result.cases.map(caseItem => {
                        const appliedDate = new Date(caseItem.appliedAt).toLocaleDateString('ja-JP');
                        const deliveredDate = new Date(caseItem.deliveredAt).toLocaleDateString('ja-JP');

                        // „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„ÉÉ„Ç∏„ÅÆËâ≤ÂàÜ„Åë
                        const statusBadges = {
                            'pending': { color: 'bg-yellow-100 text-yellow-800', label: 'ÂØ©Êüª‰∏≠' },
                            'approved': { color: 'bg-green-100 text-green-800', label: 'ÊâøË™çÊ∏à„Åø' },
                            'rejected': { color: 'bg-red-100 text-red-800', label: 'Âç¥‰∏ãÊ∏à„Åø' }
                        };
                        const badge = statusBadges[status];

                        // Âç¥‰∏ãÁêÜÁî±ÔºàÂç¥‰∏ã„Çø„Éñ„ÅÆÂ†¥Âêà„ÅÆ„ÅøÔºâ
                        const rejectionReason = status === 'rejected' && caseItem.rejectionReason
                            ? `<p class="text-sm text-red-600 mt-2"><span class="font-semibold">Âç¥‰∏ãÁêÜÁî±:</span> ${caseItem.rejectionReason}</p>`
                            : '';

                        // ÊâøË™çÊó•/Âç¥‰∏ãÊó•ÔºàË©≤ÂΩì„Çø„Éñ„ÅÆÂ†¥Âêà„ÅÆ„ÅøÔºâ
                        const reviewedDate = status === 'approved' && caseItem.approvedAt
                            ? `<p class="text-sm text-gray-600 mb-2">ÊâøË™çÊó•: ${new Date(caseItem.approvedAt).toLocaleDateString('ja-JP')}</p>`
                            : status === 'rejected' && caseItem.rejectedAt
                            ? `<p class="text-sm text-gray-600 mb-2">Âç¥‰∏ãÊó•: ${new Date(caseItem.rejectedAt).toLocaleDateString('ja-JP')}</p>`
                            : '';

                        // „Çπ„ÉÜ„Éº„Çø„ÇπÂà•„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥
                        let actionButtons = '';
                        if (status === 'rejected') {
                            // Âç¥‰∏ãÊ∏à„Åø„Çø„ÉñÔºöËøΩÂÆ¢ÁµÇ‰∫Ü„ÉªÂÜçÁî≥Ë´ã„Éú„Çø„É≥
                            actionButtons = `
                                <div class="flex gap-1 mt-3">
                                    <button onclick="archiveCase('${caseItem.cvId}')" class="flex-1 px-2 py-1.5 bg-gray-100 text-gray-700 rounded text-xs hover:bg-gray-200 transition-colors" title="ËøΩÂÆ¢ÁµÇ‰∫ÜBOX„Å∏ÁßªÂãï">
                                        üóëÔ∏è ËøΩÂÆ¢ÁµÇ‰∫Ü
                                    </button>
                                    <button onclick="openCancelReapplication('${caseItem.cvId}')" class="flex-1 px-2 py-1.5 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200 transition-colors" title="ÂÜçÁî≥Ë´ã">
                                        üîÑ ÂÜçÁî≥Ë´ã
                                    </button>
                                </div>
                            `;
                        } else if (status === 'pending') {
                            // ÂØ©Êüª‰∏≠„Çø„ÉñÔºöÁî≥Ë´ãÂèñ„ÇäÊ∂à„Åó„Éú„Çø„É≥
                            actionButtons = `
                                <div class="mt-3">
                                    <button onclick="withdrawCancelApplication('${caseItem.applicationId}', '${caseItem.cvId}')" class="w-full px-3 py-2 bg-red-100 text-red-700 rounded text-sm font-semibold hover:bg-red-200 transition-colors" title="Áî≥Ë´ãÂèñ„ÇäÊ∂à„Åó">
                                        ‚ùå Áî≥Ë´ãÂèñ„ÇäÊ∂à„Åó
                                    </button>
                                </div>
                            `;
                        }

                        return `
                        <div class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow">
                            <div class="flex justify-between items-start mb-3">
                                <span class="px-2 py-1 text-xs font-semibold rounded-full ${badge.color}">${badge.label}</span>
                            </div>
                            <h3 class="font-bold text-lg mb-1">${caseItem.customerName}</h3>
                            <p class="text-sm text-gray-600 mb-2">üìç ${caseItem.address}</p>
                            <p class="text-sm text-gray-600 mb-2">üìû ${caseItem.tel}</p>
                            <p class="text-sm text-gray-600 mb-2">ÈÖç‰ø°Êó•: ${deliveredDate}</p>
                            <p class="text-sm text-gray-600 mb-2">Áî≥Ë´ãÊó•: ${appliedDate}</p>
                            ${reviewedDate}
                            ${rejectionReason}
                            <div class="mt-3 pt-3 border-t border-gray-200">
                                <p class="text-xs text-gray-500 font-semibold mb-1">Áî≥Ë´ãÁêÜÁî±:</p>
                                <p class="text-xs text-gray-700">${caseItem.reason}</p>
                            </div>
                            ${actionButtons}
                        </div>
                        `;
                    }).join('');
                } else {
                    const emptyMessages = {
                        'pending': 'ÂØ©Êüª‰∏≠„ÅÆÊ°à‰ª∂„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì',
                        'approved': 'ÊâøË™çÊ∏à„Åø„ÅÆÊ°à‰ª∂„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì',
                        'rejected': 'Âç¥‰∏ã„Åï„Çå„ÅüÊ°à‰ª∂„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì'
                    };
                    container.innerHTML = `<p class="text-gray-600 col-span-full text-center py-8">${emptyMessages[status]}</p>`;
                }
            } catch (error) {
                console.error('„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ãÊ∏à„ÅøÊ°à‰ª∂„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);

                // „Ç®„É©„ÉºÂÜÖÂÆπ„ÇíËß£Êûê
                let errorMessage = 'Ê°à‰ª∂„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ';
                if (error.name === 'AbortError') {
                    errorMessage = '„É™„ÇØ„Ç®„Çπ„Éà„Åå„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„Åü„ÄÇ„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                } else if (error.message.includes('HTTP error')) {
                    errorMessage = `„Çµ„Éº„Éê„Éº„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü (${error.message})`;
                } else if (error.message === 'Failed to fetch') {
                    errorMessage = '„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Ç§„É≥„Çø„Éº„Éç„ÉÉ„ÉàÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                }

                container.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <div class="text-red-500 mb-4">
                            <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                            <p class="font-semibold">${errorMessage}</p>
                        </div>
                        <button onclick="loadAppliedCases('${status}')" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                            ÂÜçË™≠„ÅøËæº„Åø
                        </button>
                    </div>
                `;
                alert(errorMessage);
            }
        }

        // ============================================
        // ËøΩÂÆ¢ÁµÇ‰∫ÜBOXÔºà„Ç¢„Éº„Ç´„Ç§„ÉñÔºâÁÆ°ÁêÜ
        // ============================================

        // „Ç¢„Éº„Ç´„Ç§„ÉñÊ°à‰ª∂‰∏ÄË¶ß„ÇíË™≠„ÅøËæº„Åø
        window.loadArchivedCases = async function() {
            const container = document.getElementById('archiveCasesList');

            try {
                const merchantId = window.merchantId;
                if (!merchantId) {
                    alert('„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    return;
                }

                // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
                container.innerHTML = '<div class="col-span-full text-center py-8"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div><p class="text-gray-600 mt-2">Ë™≠„ÅøËæº„Åø‰∏≠...</p></div>';

                const response = await fetchWithRetry(`${CANCEL_API_URL}?action=getArchivedCases&merchantId=${merchantId}`);
                const result = await response.json();

                if (result.success && result.cases && result.cases.length > 0) {
                    container.innerHTML = result.cases.map(caseItem => {
                        const deliveredDate = new Date(caseItem.deliveredAt).toLocaleDateString('ja-JP');
                        const archivedDate = new Date(caseItem.archivedAt).toLocaleDateString('ja-JP');

                        return `
                        <div class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow">
                            <div class="flex justify-between items-start mb-3">
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">„Ç¢„Éº„Ç´„Ç§„ÉñÊ∏à„Åø</span>
                                <button onclick="restoreArchivedCase('${caseItem.cvId}')" class="px-3 py-1 text-xs bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                    Âæ©ÂÖÉ
                                </button>
                            </div>
                            <h3 class="font-bold text-lg mb-1">${caseItem.customerName}</h3>
                            <p class="text-sm text-gray-600 mb-2">üìç ${caseItem.address}</p>
                            <p class="text-sm text-gray-600 mb-2">üìû ${caseItem.tel}</p>
                            <p class="text-sm text-gray-600 mb-2">ÈÖç‰ø°Êó•: ${deliveredDate}</p>
                            <p class="text-sm text-gray-600 mb-2">„Ç¢„Éº„Ç´„Ç§„ÉñÊó•: ${archivedDate}</p>
                        </div>
                        `;
                    }).join('');
                } else {
                    container.innerHTML = '<p class="text-gray-600 col-span-full text-center py-8">„Ç¢„Éº„Ç´„Ç§„Éñ„Åï„Çå„ÅüÊ°à‰ª∂„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                }
            } catch (error) {
                console.error('„Ç¢„Éº„Ç´„Ç§„ÉñÊ°à‰ª∂„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);

                let errorMessage = 'Ê°à‰ª∂„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ';
                if (error.name === 'AbortError') {
                    errorMessage = '„É™„ÇØ„Ç®„Çπ„Éà„Åå„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„Åü„ÄÇ„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                } else if (error.message.includes('HTTP error')) {
                    errorMessage = `„Çµ„Éº„Éê„Éº„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü (${error.message})`;
                } else if (error.message === 'Failed to fetch') {
                    errorMessage = '„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Ç§„É≥„Çø„Éº„Éç„ÉÉ„ÉàÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                }

                container.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <div class="text-red-500 mb-4">
                            <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                            <p class="font-semibold">${errorMessage}</p>
                        </div>
                        <button onclick="loadArchivedCases()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                            ÂÜçË™≠„ÅøËæº„Åø
                        </button>
                    </div>
                `;
                alert(errorMessage);
            }
        }

        // Ê°à‰ª∂„Çí„Ç¢„Éº„Ç´„Ç§„ÉñÔºàËøΩÂÆ¢ÁµÇ‰∫ÜBOX„Å∏ÁßªÂãïÔºâ
        window.archiveCase = async function(cvId) {
            if (!confirm('„Åì„ÅÆÊ°à‰ª∂„ÇíËøΩÂÆ¢ÁµÇ‰∫ÜBOX„Å´ÁßªÂãï„Åó„Åæ„Åô„ÅãÔºü\nÔºà„ÅÑ„Å§„Åß„ÇÇÂæ©ÂÖÉ„Åß„Åç„Åæ„ÅôÔºâ')) {
                return;
            }

            try {
                const merchantId = window.merchantId;
                if (!merchantId) {
                    alert('„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    return;
                }

                const response = await fetchWithRetry(CANCEL_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `action=archiveCase&merchantId=${merchantId}&cvId=${cvId}`
                });

                const result = await response.json();

                if (result.success) {
                    alert('Ê°à‰ª∂„ÇíËøΩÂÆ¢ÁµÇ‰∫ÜBOX„Å´ÁßªÂãï„Åó„Åæ„Åó„Åü');
                    // ÁèæÂú®„ÅÆ„Çª„ÇØ„Ç∑„Éß„É≥„Å´Âøú„Åò„Å¶„É™„É≠„Éº„Éâ
                    const currentSection = document.querySelector('.section:not([style*="display: none"])');
                    if (currentSection && currentSection.id === 'casesSection') {
                        location.reload(); // Ê°à‰ª∂ÁÆ°ÁêÜÁîªÈù¢„ÅÆÂ†¥Âêà„ÅØ„Éö„Éº„Ç∏„É™„É≠„Éº„Éâ
                    }
                } else {
                    alert('„Ç®„É©„Éº: ' + (result.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'));
                }
            } catch (error) {
                console.error('„Ç¢„Éº„Ç´„Ç§„Éñ„Ç®„É©„Éº:', error);
                alert('Ê°à‰ª∂„ÅÆ„Ç¢„Éº„Ç´„Ç§„Éñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        // „Ç¢„Éº„Ç´„Ç§„ÉñÊ°à‰ª∂„ÇíÂæ©ÂÖÉ
        window.restoreArchivedCase = async function(cvId) {
            if (!confirm('„Åì„ÅÆÊ°à‰ª∂„ÇíÂæ©ÂÖÉ„Åó„Åæ„Åô„ÅãÔºü')) {
                return;
            }

            try {
                const merchantId = window.merchantId;
                if (!merchantId) {
                    alert('„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    return;
                }

                const response = await fetchWithRetry(CANCEL_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `action=restoreCase&merchantId=${merchantId}&cvId=${cvId}`
                });

                const result = await response.json();

                if (result.success) {
                    alert('Ê°à‰ª∂„ÇíÂæ©ÂÖÉ„Åó„Åæ„Åó„Åü');
                    // „Ç¢„Éº„Ç´„Ç§„Éñ‰∏ÄË¶ß„ÇíÂÜçË™≠„ÅøËæº„Åø
                    loadArchivedCases();
                } else {
                    alert('„Ç®„É©„Éº: ' + (result.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'));
                }
            } catch (error) {
                console.error('Âæ©ÂÖÉ„Ç®„É©„Éº:', error);
                alert('Ê°à‰ª∂„ÅÆÂæ©ÂÖÉ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        // Áî≥Ë´ãÂèñ„ÇäÊ∂à„ÅóÂá¶ÁêÜ‰∏≠„Éï„É©„Ç∞
        let isWithdrawing = false;

        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÇíÂèñ„ÇäÊ∂à„Åó
        window.withdrawCancelApplication = async function(applicationId, cvId) {
            // ‰∫åÈáçÈÄÅ‰ø°Èò≤Ê≠¢
            if (isWithdrawing) {
                console.log('[Áî≥Ë´ãÂèñ„ÇäÊ∂à„Åó] Âá¶ÁêÜ‰∏≠„ÅÆ„Åü„ÇÅÁÑ°Ë¶ñ„Åó„Åæ„Åô');
                return;
            }

            if (!confirm('„Åì„ÅÆ„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÇíÂèñ„ÇäÊ∂à„Åó„Åæ„Åô„ÅãÔºü\nÂèñ„ÇäÊ∂à„Åô„Å®„ÄÅÂÜçÂ∫¶„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÅåÂèØËÉΩ„Å´„Å™„Çä„Åæ„Åô„ÄÇ')) {
                return;
            }

            isWithdrawing = true;

            try {
                const merchantId = window.merchantId;
                if (!merchantId) {
                    alert('„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    isWithdrawing = false;
                    return;
                }

                const response = await fetchWithRetry(CANCEL_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `action=withdrawCancelApplication&merchantId=${merchantId}&applicationId=${applicationId}&cvId=${cvId}`
                });

                const result = await response.json();

                if (result.success) {
                    alert('„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÇíÂèñ„ÇäÊ∂à„Åó„Åæ„Åó„Åü');
                    // ÂØ©Êüª‰∏≠„Çø„Éñ„ÇíÂÜçË™≠„ÅøËæº„Åø
                    loadAppliedCases('pending');
                } else {
                    alert('„Ç®„É©„Éº: ' + (result.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'));
                }
            } catch (error) {
                console.error('Áî≥Ë´ãÂèñ„ÇäÊ∂à„Åó„Ç®„É©„Éº:', error);
                alert('„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÅÆÂèñ„ÇäÊ∂à„Åó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            } finally {
                isWithdrawing = false;
            }
        }

        // ============================================
        // ÊàêÁ¥ÑÂ†±Âëä„Ç∑„Çπ„ÉÜ„É†
        // ============================================

        // ÈÖç‰ø°Ê∏à„ÅøÊ°à‰ª∂‰∏ÄË¶ß„ÇíË™≠„ÅøËæº„ÅøÔºàÊàêÁ¥ÑÂ†±ÂëäÂØæË±°Ôºâ
        window.loadContractCases = async function() {
            const container = document.getElementById('contractCasesList');

            try {
                const merchantId = window.merchantId;
                if (!merchantId) {
                    alert('„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    return;
                }

                // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
                container.innerHTML = '<div class="col-span-full text-center py-8"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div><p class="text-gray-600 mt-2">Ë™≠„ÅøËæº„Åø‰∏≠...</p></div>';

                console.log('[Contract] APIÂëº„Å≥Âá∫„Åó - merchantId:', merchantId);
                const response = await fetchWithRetry(`${CANCEL_API_URL}?action=getDeliveredCases&merchantId=${merchantId}`);
                const result = await response.json();
                console.log('[Contract] API„É¨„Çπ„Éù„É≥„Çπ:', result);

                if (result.success && result.cases) {
                    deliveredCasesCache = result.cases;
                    console.log('[Contract] ÈÖç‰ø°Ê∏à„ÅøÊ°à‰ª∂ÂèñÂæó:', deliveredCasesCache.length, '‰ª∂', deliveredCasesCache);

                    if (deliveredCasesCache.length > 0) {
                        container.innerHTML = deliveredCasesCache.map(caseItem => createContractCaseCard(caseItem)).join('');
                    } else {
                        container.innerHTML = '<p class="text-gray-600 col-span-full text-center py-8">ÊàêÁ¥ÑÂ†±ÂëäÂèØËÉΩ„Å™Ê°à‰ª∂„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                    }
                } else {
                    container.innerHTML = '<p class="text-gray-600 col-span-full text-center py-8">Ê°à‰ª∂„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü</p>';
                    console.error('[Contract] API „Ç®„É©„Éº:', result.error);
                }
            } catch (error) {
                console.error('[Contract] ÈÖç‰ø°Ê∏à„ÅøÊ°à‰ª∂„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);

                let errorMessage = 'Ê°à‰ª∂„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ';
                if (error.name === 'AbortError') {
                    errorMessage = '„É™„ÇØ„Ç®„Çπ„Éà„Åå„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„Åü„ÄÇ„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                } else if (error.message.includes('HTTP error')) {
                    errorMessage = `„Çµ„Éº„Éê„Éº„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü (${error.message})`;
                } else if (error.message === 'Failed to fetch') {
                    errorMessage = '„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Ç§„É≥„Çø„Éº„Éç„ÉÉ„ÉàÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                }

                container.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <div class="text-red-500 mb-4">
                            <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                            <p class="font-semibold">${errorMessage}</p>
                        </div>
                        <button onclick="loadContractCases()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                            ÂÜçË™≠„ÅøËæº„Åø
                        </button>
                    </div>
                `;
                alert(errorMessage);
            }
        }

        // ÊàêÁ¥ÑÂ†±Âëä„Åô„ÇãÊ°à‰ª∂„ÇíÈÅ∏Êäû
        window.selectContractCase = function(cvId) {
            selectedContractCase = deliveredCasesCache.find(c => c.cvId === cvId);
            if (!selectedContractCase) {
                alert('Ê°à‰ª∂„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }

            // Ë≥™Âïè„Éï„É≠„Éº„Çí„É™„Çª„ÉÉ„Éà
            contractAnswers = [];

            // È°ßÂÆ¢ÊÉÖÂ†±„ÇíË°®Á§∫
            const customerInfo = document.getElementById('contractCustomerInfo');
            const customerName = document.getElementById('contractCustomerName');
            const customerAddress = document.getElementById('contractCustomerAddress');

            customerName.textContent = selectedContractCase.customerName || '';
            customerAddress.textContent = selectedContractCase.address || '';
            customerInfo.classList.remove('hidden');

            // ÊàêÁ¥ÑÂ†±Âëä„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
            document.getElementById('contractModal').classList.remove('hidden');

            // Ë≥™Âïè„Éï„É≠„Éº„ÇíÈñãÂßã
            showContractQuestion(0);
        }

        // ÊàêÁ¥ÑÂ†±ÂëäË≥™Âïè„ÇíË°®Á§∫
        window.showContractQuestion = function(questionIndex) {
            const container = document.getElementById('contractQuestionContainer');
            const currentQuestion = contractQuestions[questionIndex];

            if (currentQuestion) {
                container.innerHTML = `
                    <div class="mb-4">
                        <h4 class="text-lg font-medium mb-3">${currentQuestion.question}</h4>
                        <div class="grid grid-cols-2 gap-3">
                            ${currentQuestion.options.map(option => `
                                <button onclick="answerContractQuestion('${option}')"
                                        class="p-3 text-left border rounded-lg hover:bg-green-50 hover:border-green-500 transition-colors">
                                    ${option}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else {
                // ÂÖ®Ë≥™ÂïèÂÆå‰∫Ü - „Éï„Ç©„Éº„É†„Éï„Çß„Éº„Ç∫„Å∏
                document.getElementById('contractQuestionContainer').classList.add('hidden');
                document.getElementById('contractFormPhase').classList.remove('hidden');

                // Â•ëÁ¥ÑÁä∂Ê≥Å„Å´Âøú„Åò„Å¶Êó•‰ªò„É©„Éô„É´„ÇíÂ§âÊõ¥
                if (contractAnswers[1]) {
                    updateDateLabels(contractAnswers[1]);
                }
            }
        }

        // ÊàêÁ¥ÑË≥™ÂïèÂõûÁ≠î
        window.answerContractQuestion = function(answer) {
            contractAnswers.push(answer);

            if (contractAnswers.length < contractQuestions.length) {
                showContractQuestion(contractAnswers.length);
            } else {
                // „Éï„Ç©„Éº„É†„Éï„Çß„Éº„Ç∫„Å´ÁßªË°å
                document.getElementById('contractQuestionContainer').classList.add('hidden');
                document.getElementById('contractFormPhase').classList.remove('hidden');

                // Â•ëÁ¥ÑÁä∂Ê≥Å„Å´Âøú„Åò„Å¶Êó•‰ªò„É©„Éô„É´„ÇíÂ§âÊõ¥
                updateDateLabels(contractAnswers[1]);
            }
        }

        // ÊàêÁ¥ÑÂ†±Âëä„ÇíÈÄÅ‰ø°
        // ÊàêÁ¥ÑÂ†±ÂëäÂá¶ÁêÜ‰∏≠„Éï„É©„Ç∞
        let isSubmittingContract = false;

        window.submitContractReport = async function(selectedWorkTypes, selectedPropertyTypes) {
            // ‰∫åÈáçÈÄÅ‰ø°Èò≤Ê≠¢
            if (isSubmittingContract) {
                console.log('[ÊàêÁ¥ÑÂ†±Âëä] Âá¶ÁêÜ‰∏≠„ÅÆ„Åü„ÇÅÁÑ°Ë¶ñ„Åó„Åæ„Åô');
                return;
            }

            isSubmittingContract = true;

            try {
                const merchantId = window.merchantId;
                const merchantName = window.merchantName || '';

                if (!merchantId || !selectedContractCase) {
                    alert('ÂøÖË¶Å„Å™ÊÉÖÂ†±„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô');
                    isSubmittingContract = false;
                    return;
                }

                // „Éï„Ç©„Éº„É†„Éá„Éº„Çø„ÇíÂèéÈõÜ
                const contractAmount = document.getElementById('contractAmount').value;
                const paymentDate = document.getElementById('paymentDate').value;
                const completionDate = document.getElementById('completionDate').value;
                const buildingFloors = document.getElementById('buildingFloors').value;
                const workDetails = document.getElementById('workDetails').value;

                // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥
                if (!contractAmount || contractAmount <= 0) {
                    alert('Â•ëÁ¥ÑÈáëÈ°ç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    isSubmittingContract = false;
                    return;
                }

                // ÊñΩÂ∑•ÂÜÖÂÆπ„ÇíÊñáÂ≠óÂàó„Å´Â§âÊèõ
                const workContent = selectedWorkTypes.length > 0 ? selectedWorkTypes : [workDetails];

                // Áâ©‰ª∂Á®ÆÂà•„ÇíÊñáÂ≠óÂàó„Å´Â§âÊèõ
                const propertyType = selectedPropertyTypes.join('„ÄÅ');

                // Â†±ÂëäÁ®ÆÂà•„Å®ÁèæÂú®„ÅÆÁä∂Ê≥Å„ÇíÂèñÂæó
                const reportType = contractAnswers[0] || 'ÊàêÁ¥ÑÂ†±Âëä';
                const currentStatus = contractAnswers[1] || 'Â•ëÁ¥ÑÂæå„ÉªÂ∑•‰∫ãÂâç';

                console.log('[Contract] ÊàêÁ¥ÑÂ†±ÂëäÈÄÅ‰ø°:', {
                    cvId: selectedContractCase.cvId,
                    merchantId,
                    reportType,
                    currentStatus,
                    contractAmount
                });

                // APIÂëº„Å≥Âá∫„Åó
                const params = new URLSearchParams({
                    action: 'submitContractReport',
                    merchantId: merchantId,
                    merchantName: merchantName,
                    cvId: selectedContractCase.cvId,
                    reportType: reportType,
                    currentStatus: currentStatus,
                    contractAmount: contractAmount,
                    constructionEndDate: completionDate || '',
                    paymentDueDate: paymentDate || '',
                    propertyType: propertyType,
                    floors: buildingFloors || '',
                    workContent: JSON.stringify(workContent)
                });

                const response = await fetchWithRetry(CANCEL_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: params.toString()
                });

                const result = await response.json();

                if (result.success) {
                    alert('ÊàêÁ¥ÑÂ†±Âëä„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„ÅüÔºÅ');
                    closeContractModal();
                    // Ê°à‰ª∂‰∏ÄË¶ß„ÇíÂÜçË™≠„ÅøËæº„Åø
                    loadContractCases();
                } else {
                    alert('„Ç®„É©„Éº: ' + (result.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'));
                }
            } catch (error) {
                console.error('[Contract] ÊàêÁ¥ÑÂ†±ÂëäÈÄÅ‰ø°„Ç®„É©„Éº:', error);
                alert('ÊàêÁ¥ÑÂ†±Âëä„ÅÆÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            } finally {
                isSubmittingContract = false;
            }
        }

        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ãÂèØËÉΩÊ°à‰ª∂„ÇíË™≠„ÅøËæº„Åø
        window.loadCancelableCases = async function() {
            const casesList = document.getElementById('cancelCasesList');

            try {
                const merchantId = window.merchantId;
                if (!merchantId) {
                    alert('„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    return;
                }

                // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
                casesList.innerHTML = '<div class="col-span-full text-center py-8"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div><p class="text-gray-600 mt-2">Ë™≠„ÅøËæº„Åø‰∏≠...</p></div>';

                console.log('[Cancel] APIÂëº„Å≥Âá∫„Åó - merchantId:', merchantId);
                const response = await fetchWithRetry(`${CANCEL_API_URL}?action=getCancelableCases&merchantId=${merchantId}`);
                const result = await response.json();
                console.log('[Cancel] API„É¨„Çπ„Éù„É≥„Çπ:', result);

                // „Éá„Éº„Çø„Çí„Ç≠„É£„ÉÉ„Ç∑„É•„Å´‰øùÂ≠ò
                if (result.success && result.cases) {
                    cancelableCasesCache = result.cases;
                    console.log('[Cancel] „Ç≠„É£„É≥„Çª„É´ÂèØËÉΩÊ°à‰ª∂:', cancelableCasesCache.length, '‰ª∂', cancelableCasesCache);
                }

                if (result.success && result.cases.length > 0) {
                    casesList.innerHTML = result.cases.map(caseItem => {
                        const deliveredDate = new Date(caseItem.deliveredAt).toLocaleDateString('ja-JP');
                        const deadlineDate = new Date(caseItem.deadlineDate).toLocaleDateString('ja-JP');

                        // „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„ÉÉ„Ç∏„ÅÆËâ≤ÂàÜ„Åë
                        const statusColors = {
                            'ÈÖç‰ø°Ê∏à': 'bg-blue-100 text-blue-800',
                            'ÈÖç‰ø°ÂæåÊú™ÊàêÁ¥Ñ': 'bg-yellow-100 text-yellow-800',
                            'ÂØæÂøú‰∏≠': 'bg-green-100 text-green-800',
                            'Ë¶ãÁ©çÊèêÂá∫Ê∏à': 'bg-purple-100 text-purple-800',
                            'ÂïÜË´á‰∏≠': 'bg-orange-100 text-orange-800'
                        };
                        const statusColor = statusColors[caseItem.managementStatus] || 'bg-gray-100 text-gray-800';

                        // ÊúüÈôê„ÅÆËµ§Ëâ≤Âà§ÂÆöÔºàÈÖç‰ø°Êó•+7Êó•„Åã„Çâ6-7Êó•ÁµåÈÅé = ÊúüÈôê„Åæ„Åß0-1Êó•Ôºâ
                        const daysUntilDeadline = 7 - caseItem.daysElapsed;
                        const deadlineClass = daysUntilDeadline <= 1 ? 'text-red-600 font-bold' : 'text-gray-600';

                        return `
                        <div class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow cursor-pointer"
                             onclick="openCancelModal('${caseItem.cvId}')">
                            <div class="flex justify-between items-start mb-3">
                                <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusColor}">${caseItem.managementStatus}</span>
                            </div>
                            <h3 class="font-bold text-lg mb-1">${caseItem.customerName}</h3>
                            <p class="text-sm text-gray-600 mb-2">üìç ${caseItem.address}</p>
                            <p class="text-sm text-gray-600 mb-2">üìû ${caseItem.tel}</p>
                            <p class="text-sm text-gray-600 mb-2">ÈÖç‰ø°Êó•: ${deliveredDate}</p>
                            <p class="text-sm ${deadlineClass}">ÊúüÈôê: ${deadlineDate}</p>
                            <p class="text-xs text-gray-500 mt-2">ÁµåÈÅéÊó•Êï∞: ${caseItem.daysElapsed}Êó•</p>
                        </div>
                        `;
                    }).join('');
                } else {
                    casesList.innerHTML = '<p class="text-gray-600 col-span-full text-center py-8">Áî≥Ë´ãÂèØËÉΩ„Å™Ê°à‰ª∂„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                }
            } catch (error) {
                console.error('„Ç≠„É£„É≥„Çª„É´Ê°à‰ª∂„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);

                // „Ç®„É©„ÉºÂÜÖÂÆπ„ÇíËß£Êûê
                let errorMessage = 'Ê°à‰ª∂„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ';
                if (error.name === 'AbortError') {
                    errorMessage = '„É™„ÇØ„Ç®„Çπ„Éà„Åå„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„Åü„ÄÇ„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                } else if (error.message.includes('HTTP error')) {
                    errorMessage = `„Çµ„Éº„Éê„Éº„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü (${error.message})`;
                } else if (error.message === 'Failed to fetch') {
                    errorMessage = '„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Ç§„É≥„Çø„Éº„Éç„ÉÉ„ÉàÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                }

                casesList.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <div class="text-red-500 mb-4">
                            <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                            <p class="font-semibold">${errorMessage}</p>
                        </div>
                        <button onclick="loadCancelableCases()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                            ÂÜçË™≠„ÅøËæº„Åø
                        </button>
                    </div>
                `;
                alert(errorMessage);
            }
        }

        // „Ç≠„É£„É≥„Çª„É´„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
        window.openCancelModal = function(cvId) {
            try {
                // Ë§áÊï∞„ÅÆ„Ç≠„É£„ÉÉ„Ç∑„É•„Åã„Çâ„Éá„Éº„Çø„ÇíÂèñÂæóÔºà„Ç≠„É£„É≥„Çª„É´ÂèØËÉΩÊ°à‰ª∂ or ÊúüÈôêÂª∂Èï∑ÂèØËÉΩÊ°à‰ª∂Ôºâ
                cancelSelectedCase = cancelableCasesCache.find(c => c.cvId === cvId) ||
                                    extensionEligibleCasesCache.find(c => c.cvId === cvId);

                if (cancelSelectedCase) {
                    // AIÁîüÊàêÂõûÊï∞„Çí„É™„Çª„ÉÉ„Éà
                    cancelAiGenerationCount = 0;
                    // „ÉÜ„Ç≠„Çπ„ÉàÂ±•Ê≠¥„Çí„É™„Çª„ÉÉ„Éà
                    textHistory = [];
                    textHistoryIndex = -1;
                    // textarea„Çí„ÇØ„É™„Ç¢
                    document.getElementById('cancelApplicationText').value = '';
                    // „É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫„Åó„Å¶Áõ¥Êé•Step 1ÔºàÁêÜÁî±„Ç´„ÉÜ„Ç¥„É™ÈÅ∏ÊäûÔºâ„Å∏
                    document.getElementById('cancelModal').classList.remove('hidden');
                    cancelGoToStep(1);
                } else {
                    console.error('Ê°à‰ª∂„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:', cvId);
                    alert('Ê°à‰ª∂ÊÉÖÂ†±„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇÁîªÈù¢„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                }
            } catch (error) {
                console.error('È°ßÂÆ¢ÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                alert('È°ßÂÆ¢ÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        // „Ç≠„É£„É≥„Çª„É´ÂÜçÁî≥Ë´ã„É¢„Éº„ÉÄ„É´„ÇíÈñã„ÅèÔºàÂç¥‰∏ãÊ∏à„ÅøÊ°à‰ª∂Áî®Ôºâ
        window.openCancelReapplication = function(cvId) {
            try {
                // Âç¥‰∏ãÊ∏à„Åø„Ç≠„É£„ÉÉ„Ç∑„É•„Åã„ÇâÊ°à‰ª∂„Éá„Éº„Çø„ÇíÂèñÂæó
                const rejectedCase = cancelRejectedCasesCache.find(c => c.cvId === cvId);

                if (rejectedCase) {
                    // Ê°à‰ª∂„Éá„Éº„Çø„ÇíÊßãÁØâÔºà„Ç≠„É£„É≥„Çª„É´ÂèØËÉΩÊ°à‰ª∂„Å®Âêå„ÅòÂΩ¢Âºè„Å´Ôºâ
                    cancelSelectedCase = {
                        cvId: rejectedCase.cvId,
                        customerName: rejectedCase.customerName,
                        tel: rejectedCase.tel,
                        address: rejectedCase.address,
                        deliveredAt: rejectedCase.deliveredAt
                    };

                    // AIÁîüÊàêÂõûÊï∞„Çí„É™„Çª„ÉÉ„Éà
                    cancelAiGenerationCount = 0;
                    // „ÉÜ„Ç≠„Çπ„ÉàÂ±•Ê≠¥„Çí„É™„Çª„ÉÉ„Éà
                    textHistory = [];
                    textHistoryIndex = -1;
                    // textarea„Çí„ÇØ„É™„Ç¢
                    document.getElementById('cancelApplicationText').value = '';
                    // „É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫„Åó„Å¶Áõ¥Êé•Step 1ÔºàÁêÜÁî±„Ç´„ÉÜ„Ç¥„É™ÈÅ∏ÊäûÔºâ„Å∏
                    document.getElementById('cancelModal').classList.remove('hidden');
                    cancelGoToStep(1);
                } else {
                    console.error('Âç¥‰∏ãÊ∏à„ÅøÊ°à‰ª∂„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:', cvId);
                    alert('Ê°à‰ª∂ÊÉÖÂ†±„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇÁîªÈù¢„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                }
            } catch (error) {
                console.error('ÂÜçÁî≥Ë´ã„Ç®„É©„Éº:', error);
                alert('ÂÜçÁî≥Ë´ã„ÅÆÊ∫ñÂÇô„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        // „Ç≠„É£„É≥„Çª„É´„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        window.closeCancelModal = function() {
            document.getElementById('cancelModal').classList.add('hidden');
            cancelCurrentStep = 1;
            cancelSelectedCase = null;
            cancelSelectedCategory = null;
            cancelSelectedSubCategory = null;
            cancelQuestionAnswers = {};
            cancelAiGenerationCount = 0; // AIÁîüÊàêÂõûÊï∞„Çí„É™„Çª„ÉÉ„Éà
        }

        // „Çπ„ÉÜ„ÉÉ„ÉóÁßªÂãï
        window.cancelGoToStep = function(step) {
            // ÁèæÂú®„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÇíÈùûË°®Á§∫
            document.querySelectorAll('.cancel-step').forEach(el => el.classList.add('hidden'));

            // Êñ∞„Åó„ÅÑ„Çπ„ÉÜ„ÉÉ„Éó„ÇíË°®Á§∫
            document.getElementById(`cancelStep${step}`).classList.remove('hidden');
            cancelCurrentStep = step;

            // „Ç§„É≥„Ç∏„Ç±„Éº„Çø„ÉºÊõ¥Êñ∞Ôºà3ÊÆµÈöé„Å´Â§âÊõ¥Ôºâ
            for (let i = 1; i <= 3; i++) {
                const indicator = document.getElementById(`cancelStep${i}Indicator`);
                if (!indicator) continue;
                const indicatorCircle = indicator.querySelector('div');
                if (i < step) {
                    indicatorCircle.classList.remove('bg-gray-300', 'text-gray-600', 'bg-blue-500');
                    indicatorCircle.classList.add('bg-green-500', 'text-white');
                } else if (i === step) {
                    indicatorCircle.classList.remove('bg-gray-300', 'text-gray-600', 'bg-green-500');
                    indicatorCircle.classList.add('bg-blue-500', 'text-white');
                } else {
                    indicatorCircle.classList.remove('bg-blue-500', 'bg-green-500');
                    indicatorCircle.classList.add('bg-gray-300', 'text-gray-600');
                }
            }

            // „Çπ„ÉÜ„ÉÉ„Éó1: „Ç´„ÉÜ„Ç¥„É™‰∏ÄË¶ß„ÇíË°®Á§∫
            if (step === 1) {
                // Step 1„Å´Êàª„ÇãÂ†¥Âêà„ÄÅÈÅ∏ÊäûÁä∂ÊÖã„Å®„Çµ„Éñ„Ç´„ÉÜ„Ç¥„É™„ÉªË≥™Âïè„Éï„Ç©„Éº„É†„Çí„ÇØ„É™„Ç¢
                cancelSelectedCategory = null;
                cancelSelectedSubCategory = null;
                cancelQuestionAnswers = {};

                const subCategoryList = document.getElementById('cancelSubCategoryList');
                if (subCategoryList) subCategoryList.innerHTML = '';

                const questionsForm = document.getElementById('cancelQuestionsForm');
                if (questionsForm) {
                    questionsForm.innerHTML = '';
                    questionsForm.classList.add('hidden');
                }

                const nextBtn = document.getElementById('cancelStep2NextBtn');
                if (nextBtn) nextBtn.classList.add('hidden');

                const categoryList = document.getElementById('cancelCategoryList');
                if (window.CancelReasons && window.CancelReasons.categories) {
                    categoryList.innerHTML = window.CancelReasons.categories.map(cat => `
                        <div onclick="selectCancelCategory('${cat.id}')"
                             class="p-4 border rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-500 transition-colors">
                            <p class="font-semibold">${cat.label}</p>
                        </div>
                    `).join('');
                } else {
                    console.error('CancelReasons„ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    categoryList.innerHTML = '<p class="text-red-500">„Ç´„ÉÜ„Ç¥„É™„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü</p>';
                }
            }

            // „Çπ„ÉÜ„ÉÉ„Éó2: „Çµ„Éñ„Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû„Åæ„Åü„ÅØË≥™ÂïèÂÖ•Âäõ
            if (step === 2) {
                // Step 3„Åã„ÇâÊàª„Å£„Å¶„Åç„ÅüÂ†¥Âêà„ÄÅË≥™Âïè„Éï„Ç©„Éº„É†„ÇíÈùûË°®Á§∫„Å´„Åó„Å¶„Çµ„Éñ„Ç´„ÉÜ„Ç¥„É™„É™„Çπ„Éà„ÇíË°®Á§∫
                const subCategoryList = document.getElementById('cancelSubCategoryList');
                const questionsForm = document.getElementById('cancelQuestionsForm');
                const nextBtn = document.getElementById('cancelStep2NextBtn');

                // Ë≥™Âïè„Éï„Ç©„Éº„É†„ÇíÈùûË°®Á§∫
                if (questionsForm) {
                    questionsForm.classList.add('hidden');
                }
                if (nextBtn) {
                    nextBtn.classList.add('hidden');
                }

                // „Çµ„Éñ„Ç´„ÉÜ„Ç¥„É™„É™„Çπ„Éà„ÇíË°®Á§∫
                if (subCategoryList && cancelSelectedCategory) {
                    subCategoryList.classList.remove('hidden');
                }
            }

            // „Çπ„ÉÜ„ÉÉ„Éó3: Á¢∫Ë™çÁîªÈù¢
            if (step === 3) {
                // Step 3„Å´ÁßªÂãï„Åó„Åü„ÇâËá™ÂãïÁöÑ„Å´„ÉÜ„É≥„Éó„É¨„Éº„ÉàÊñá„ÇíÁîüÊàê
                const textarea = document.getElementById('cancelApplicationText');
                if (!textarea.value || textarea.value.trim() === '') {
                    // „Åæ„Å†‰Ωï„ÇÇÂÖ•Âäõ„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÄÅ„ÉÜ„É≥„Éó„É¨„Éº„ÉàÊñá„ÇíËá™ÂãïÁîüÊàê
                    const category = window.CancelReasons.getCategoryById(cancelSelectedCategory);
                    const subCats = window.CancelReasons.getSubCategories(cancelSelectedCategory);
                    const subCategory = subCats.find(sc => sc.id === cancelSelectedSubCategory);

                    // Ë≥™Âïè„ÅÆÂõûÁ≠î„ÇíÂèéÈõÜ
                    const questions = window.CancelReasons.getQuestions(cancelSelectedCategory, cancelSelectedSubCategory);
                    const answers = {};
                    if (questions && questions.length > 0) {
                        questions.forEach((q, index) => {
                            const inputName = `question_${index}`;
                            const element = document.querySelector(`[name="${inputName}"]`);

                            if (q.type === 'radio') {
                                const checked = document.querySelector(`[name="${inputName}"]:checked`);
                                if (checked) {
                                    answers[q.label] = checked.value;

                                    // followUpÂõûÁ≠î„ÇÇÂèéÈõÜ
                                    if (q.followUp && q.followUp[checked.value]) {
                                        q.followUp[checked.value].forEach((fq, fqIndex) => {
                                            const fqId = `question_${index}_followup_${fqIndex}`;
                                            const fqElement = document.getElementById(fqId);
                                            if (fqElement && fqElement.value) {
                                                answers[fq.label] = fqElement.value;
                                            }
                                        });
                                    }
                                }
                            } else if (element) {
                                if (element.value) {
                                    answers[q.label] = element.value;

                                    // dynamicOptions === 'past7days' „Åß„Äå„Åù„ÅÆ‰ªñ„Äç„ÅåÈÅ∏„Å∞„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅdays_ago„ÇÇÂèéÈõÜ
                                    if (q.dynamicOptions === 'past7days' && element.value === 'other') {
                                        const daysAgoElement = document.getElementById(`question_${index}_days_ago`);
                                        if (daysAgoElement && daysAgoElement.value) {
                                            answers[`${q.label} (Ë©≥Á¥∞)`] = `Á¥Ñ${daysAgoElement.value}Êó•Ââç`;
                                        }
                                    }
                                }
                            }
                        });
                    }

                    // „ÉÜ„É≥„Éó„É¨„Éº„ÉàÁîüÊàê„Åó„Å¶Â±•Ê≠¥„Å´ËøΩÂä†
                    generateWithTemplate(category, subCategory, answers);
                    saveTextHistory();
                }
            }
        }

        // Êàª„Çã„Éú„Çø„É≥„Éè„É≥„Éâ„É©„ÉºÔºàÊÆµÈöéÁöÑ„Å´Êàª„ÇãÔºâ
        window.cancelGoBack = function() {
            if (cancelCurrentStep === 3) {
                // Step 3 ‚Üí Step 2
                cancelGoToStep(2);
                return;
            }

            if (cancelCurrentStep === 2) {
                const questionsForm = document.getElementById('cancelQuestionsForm');
                const subCategoryList = document.getElementById('cancelSubCategoryList');

                // Ë≥™Âïè„Éï„Ç©„Éº„É†„ÅåË°®Á§∫„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà
                if (!questionsForm.classList.contains('hidden')) {
                    // „Çµ„Éñ„Ç´„ÉÜ„Ç¥„É™„ÅåË§áÊï∞„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÄÅ„Çµ„Éñ„Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû„Å´Êàª„Çã
                    const subCategories = window.CancelReasons.getSubCategories(cancelSelectedCategory);
                    if (subCategories && subCategories.length > 1) {
                        // „Çµ„Éñ„Ç´„ÉÜ„Ç¥„É™ÈÅ∏ÊäûÁîªÈù¢„Å´Êàª„Çã
                        questionsForm.innerHTML = '';
                        questionsForm.classList.add('hidden');
                        document.getElementById('cancelStep2NextBtn').classList.add('hidden');
                        subCategoryList.classList.remove('hidden');
                        cancelSelectedSubCategory = null;
                        cancelQuestionAnswers = {};
                        return;
                    }
                }

                // „Åù„Çå‰ª•Â§ñ„ÅÆÂ†¥Âêà„ÅØ Step 1 „Å´Êàª„Çã
                cancelGoToStep(1);
                return;
            }

            // Step 1„ÅÆÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑÔºà„Åô„Åß„Å´ÊúÄÂàùÔºâ
        }

        // „Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû
        window.selectCancelCategory = function(categoryId) {
            cancelSelectedCategory = categoryId;
            cancelSelectedSubCategory = null;
            cancelQuestionAnswers = {};

            // Ë≥™Âïè„Éï„Ç©„Éº„É†„ÇíÂÆåÂÖ®„Å´„ÇØ„É™„Ç¢
            const questionsForm = document.getElementById('cancelQuestionsForm');
            questionsForm.innerHTML = '';
            questionsForm.classList.add('hidden');
            document.getElementById('cancelStep2NextBtn').classList.add('hidden');

            // „Çµ„Éñ„Ç´„ÉÜ„Ç¥„É™‰∏ÄË¶ß„ÇíË°®Á§∫
            const subCategories = window.CancelReasons.getSubCategories(categoryId);

            // „Çµ„Éñ„Ç´„ÉÜ„Ç¥„É™„Åå1„Å§„Å†„Åë„ÅÆÂ†¥Âêà„ÅØËá™ÂãïÈÅ∏Êäû
            if (subCategories.length === 1) {
                cancelGoToStep(2); // ÂÖà„Å´„Çπ„ÉÜ„ÉÉ„Éó2„Å´ÁßªÂãï
                selectCancelSubCategory(subCategories[0].id);
                return;
            }

            const subCategoryList = document.getElementById('cancelSubCategoryList');
            subCategoryList.innerHTML = subCategories.map(subCat => `
                <div onclick="selectCancelSubCategory('${subCat.id}')"
                     class="p-4 border rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-500 transition-colors">
                    <p class="font-semibold">${subCat.label}</p>
                </div>
            `).join('');
            subCategoryList.classList.remove('hidden');

            cancelGoToStep(2);
        }

        // „Çµ„Éñ„Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû„Å®Ë≥™Âïè„Éï„Ç©„Éº„É†ÁîüÊàê
        window.selectCancelSubCategory = function(subCategoryId) {
            cancelSelectedSubCategory = subCategoryId;
            cancelQuestionAnswers = {};

            // „Çµ„Éñ„Ç´„ÉÜ„Ç¥„É™„É™„Çπ„Éà„ÇíÈùûË°®Á§∫„Å´„Åô„Çã
            const subCategoryList = document.getElementById('cancelSubCategoryList');
            subCategoryList.classList.add('hidden');

            // Ë≥™Âïè„É™„Çπ„Éà„ÇíÂèñÂæó
            const questions = window.CancelReasons.getQuestions(cancelSelectedCategory, subCategoryId);
            const questionsForm = document.getElementById('cancelQuestionsForm');

            // Êó¢Â≠ò„ÅÆË≥™Âïè„Éï„Ç©„Éº„É†„ÇíÂÆåÂÖ®„Å´„ÇØ„É™„Ç¢
            questionsForm.innerHTML = '';
            questionsForm.classList.add('hidden');
            document.getElementById('cancelStep2NextBtn').classList.add('hidden');

            if (!questions || questions.length === 0) {
                // Ë≥™Âïè„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÊ¨°„Å∏„Éú„Çø„É≥„ÅÆ„ÅøË°®Á§∫
                questionsForm.classList.remove('hidden');
                document.getElementById('cancelStep2NextBtn').classList.remove('hidden');
                return;
            }

            // ÈõªË©±ÂõûÊï∞„ÉªSMSÂõûÊï∞„ÇíËá™ÂãïË°®Á§∫ÔºàÊéß„Åà„ÇÅ„Å´Ôºâ
            const phoneCallCount = cancelSelectedCase.phoneCallCount || 0;
            const smsCount = cancelSelectedCase.smsCount || 0;

            let formHtml = `<div class="space-y-4">`;

            // ÂèÇËÄÉÊÉÖÂ†±„Å®„Åó„Å¶ÈõªË©±„ÉªSMSÂõûÊï∞„ÇíË°®Á§∫
            formHtml += `
                <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4">
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-blue-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        <p class="text-sm font-semibold text-blue-800">ÂèÇËÄÉÔºö„Ç∑„Çπ„ÉÜ„É†ÈõÜË®à</p>
                    </div>
                    <p class="text-sm text-blue-700 mt-2 ml-7">
                        ÈõªË©±: <span class="font-bold">${phoneCallCount}Âõû</span>„ÄÅSMS: <span class="font-bold">${smsCount}Âõû</span>
                    </p>
                </div>
            `;

            // ÂêÑË≥™Âïè„ÅÆHTMLÁîüÊàê
            questions.forEach((q, index) => {
                formHtml += generateQuestionHTML(q, index);
            });

            formHtml += '</div>';
            questionsForm.innerHTML = formHtml;

            // „É©„Ç∏„Ç™„Éú„Çø„É≥„ÇÑ„Çª„É¨„ÇØ„Éà„ÅÆÂ§âÊõ¥„Ç§„Éô„É≥„Éà„ÇíË®≠ÂÆöÔºàfollowUpÂØæÂøúÔºâ
            questions.forEach((q, index) => {
                if (q.followUp && (q.type === 'radio' || q.type === 'select')) {
                    const inputName = `question_${index}`;
                    const inputs = document.getElementsByName(inputName);
                    inputs.forEach(input => {
                        input.addEventListener('change', function() {
                            handleFollowUpQuestion(q, index, this.value);
                        });
                    });
                }

                // dynamicOptions === 'past7days' „ÅÆÂ†¥Âêà„ÄÅ„Äå„Åù„ÅÆ‰ªñ„ÄçÈÅ∏ÊäûÊôÇ„ÅÆËøΩÂä†Ë≥™Âïè„ÇíË°®Á§∫
                if (q.dynamicOptions === 'past7days') {
                    const selectElement = document.getElementById(`question_${index}`);
                    const otherDaysDiv = document.getElementById(`question_${index}_other_days`);
                    const daysAgoSelect = document.getElementById(`question_${index}_days_ago`);

                    if (selectElement && otherDaysDiv && daysAgoSelect) {
                        selectElement.addEventListener('change', function() {
                            if (this.value === 'other') {
                                otherDaysDiv.classList.remove('hidden');
                                daysAgoSelect.setAttribute('required', 'required');
                            } else {
                                otherDaysDiv.classList.add('hidden');
                                daysAgoSelect.removeAttribute('required');
                                daysAgoSelect.value = '';
                            }
                        });
                    }
                }
            });

            questionsForm.classList.remove('hidden');
            document.getElementById('cancelStep2NextBtn').classList.remove('hidden');
        }

        // Ë≥™ÂïèHTML„ÇíÁîüÊàê
        function generateQuestionHTML(question, index) {
            const required = question.required ? '<span class="text-red-500">*</span>' : '';
            let html = `<div id="question_${index}_container" class="bg-gray-50 p-4 rounded-lg">`;

            html += `<label class="block text-sm font-semibold text-gray-900 mb-3">
                ${question.label} ${required}
            </label>`;

            switch (question.type) {
                case 'radio':
                    html += `<div class="space-y-2">`;
                    question.options.forEach(option => {
                        html += `
                            <label class="flex items-center p-3 bg-white rounded-lg cursor-pointer hover:bg-blue-50 border border-gray-200 hover:border-blue-300 transition-colors">
                                <input type="radio" name="question_${index}" value="${option}"
                                       ${question.required ? 'required' : ''}
                                       class="mr-3">
                                <span class="text-gray-800">${option}</span>
                            </label>
                        `;
                    });
                    html += `</div>`;
                    break;

                case 'select':
                    html += `<select id="question_${index}" name="question_${index}"
                                     ${question.required ? 'required' : ''}
                                     class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                        <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>`;

                    // ÂãïÁöÑ„Ç™„Éó„Ç∑„Éß„É≥ÁîüÊàêÔºàÈÅéÂéª7Êó•Èñì„ÅÆÊó•‰ªòÔºâ
                    if (question.dynamicOptions === 'past7days') {
                        const today = new Date();
                        for (let i = 0; i < 7; i++) {
                            const date = new Date(today);
                            date.setDate(date.getDate() - i);
                            const dateStr = date.toLocaleDateString('ja-JP', {
                                month: 'long',
                                day: 'numeric',
                                weekday: 'short'
                            });
                            const valueStr = date.toISOString().split('T')[0];
                            html += `<option value="${valueStr}">${dateStr}</option>`;
                        }
                        // ÊúüÈôêÂª∂Èï∑„Åó„Å¶„ÅÑ„Çã‰∫∫Âêë„Åë„Å´„Äå„Åù„ÅÆ‰ªñ„Äç„ÇíËøΩÂä†
                        html += `<option value="other">„Åù„ÅÆ‰ªñ</option>`;
                    } else {
                        // ÈÄöÂ∏∏„ÅÆ„Ç™„Éó„Ç∑„Éß„É≥
                        question.options.forEach(option => {
                            html += `<option value="${option}">${option}</option>`;
                        });
                    }

                    html += `</select>`;

                    // „Äå„Åù„ÅÆ‰ªñ„ÄçÈÅ∏ÊäûÊôÇ„ÅÆËøΩÂä†Ë≥™Âïè„Ç®„É™„Ç¢ÔºàÈÅéÂéª7Êó•Èñì„ÅÆÊó•‰ªòÈÅ∏Êäû„ÅÆÂ†¥Âêà„ÅÆ„ÅøÔºâ
                    if (question.dynamicOptions === 'past7days') {
                        html += `
                            <div id="question_${index}_other_days" class="mt-3 hidden">
                                <label class="block text-sm font-semibold text-gray-900 mb-2">
                                    „Åä„Åä„Çà„Åù‰ΩïÊó•Ââç„Åß„Åô„ÅãÔºü <span class="text-red-500">*</span>
                                </label>
                                <select id="question_${index}_days_ago" name="question_${index}_days_ago"
                                        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                                    <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>`;

                        // 8Êó•Ââç„Äú60Êó•Ââç„Åæ„ÅßÁîüÊàê
                        for (let days = 8; days <= 60; days++) {
                            html += `<option value="${days}">Á¥Ñ${days}Êó•Ââç</option>`;
                        }

                        html += `
                                </select>
                            </div>`;
                    }

                    break;

                case 'textarea':
                    html += `
                        <div class="relative">
                            <textarea id="question_${index}" name="question_${index}" rows="4"
                                       ${question.required ? 'required' : ''}
                                       maxlength="1000"
                                       placeholder="${question.placeholder || 'ÁÆáÊù°Êõ∏„Åç„Åß„ÇÇOK„Åß„Åô'}"
                                       class="w-full px-4 py-2 pr-12 border rounded-lg focus:outline-none focus:border-blue-500"></textarea>
                            <button type="button"
                                    onclick="startVoiceInputForQuestion(${index})"
                                    class="absolute bottom-3 right-3 p-2 text-gray-500 hover:text-blue-600 transition-colors"
                                    title="Èü≥Â£∞ÂÖ•Âäõ">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"></path>
                                </svg>
                            </button>
                            <p class="text-xs text-gray-500 mt-1">ÊúÄÂ§ß1000ÊñáÂ≠ó</p>
                        </div>`;
                    break;

                case 'number':
                    html += `<input type="number" id="question_${index}" name="question_${index}"
                                    ${question.required ? 'required' : ''}
                                    ${question.min !== undefined ? `min="${question.min}"` : ''}
                                    placeholder="${question.placeholder || ''}"
                                    class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">`;
                    break;

                case 'datetime-local':
                    html += `<input type="datetime-local" id="question_${index}" name="question_${index}"
                                    ${question.required ? 'required' : ''}
                                    class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">`;
                    break;

                case 'text':
                default:
                    html += `
                        <div class="relative">
                            <input type="text" id="question_${index}" name="question_${index}"
                                    ${question.required ? 'required' : ''}
                                    maxlength="1000"
                                    placeholder="${question.placeholder || ''}"
                                    class="w-full px-4 py-2 pr-12 border rounded-lg focus:outline-none focus:border-blue-500">
                            <button type="button"
                                    onclick="startVoiceInputForQuestion(${index})"
                                    class="absolute top-1/2 -translate-y-1/2 right-3 p-2 text-gray-500 hover:text-blue-600 transition-colors"
                                    title="Èü≥Â£∞ÂÖ•Âäõ">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"></path>
                                </svg>
                            </button>
                        </div>`;
                    break;
            }

            html += `<div id="question_${index}_followup"></div>`;
            html += '</div>';

            return html;
        }

        // followUpË≥™Âïè„ÇíÂá¶ÁêÜ
        function handleFollowUpQuestion(question, index, selectedValue) {
            const followUpContainer = document.getElementById(`question_${index}_followup`);

            if (!question.followUp || !question.followUp[selectedValue]) {
                // followUp„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„ÇØ„É™„Ç¢
                followUpContainer.innerHTML = '';
                return;
            }

            // followUpË≥™Âïè„ÇíÁîüÊàê
            const followUpQuestions = question.followUp[selectedValue];
            let followUpHtml = '<div class="ml-2 mt-4 space-y-3 border-l-4 border-blue-400 pl-4 bg-white p-3 rounded-r-lg">';

            followUpQuestions.forEach((fq, fqIndex) => {
                const fqId = `question_${index}_followup_${fqIndex}`;
                const required = fq.required ? '<span class="text-red-500">*</span>' : '';

                followUpHtml += `<div id="${fqId}_container">`;
                followUpHtml += `<label class="block text-sm font-semibold text-gray-900 mb-2">
                    ${fq.label} ${required}
                </label>`;

                switch (fq.type) {
                    case 'textarea':
                        followUpHtml += `
                            <div class="relative">
                                <textarea id="${fqId}" name="${fqId}" rows="3"
                                           ${fq.required ? 'required' : ''}
                                           maxlength="1000"
                                           placeholder="${fq.placeholder || 'ÁÆáÊù°Êõ∏„Åç„Åß„ÇÇOK„Åß„Åô'}"
                                           class="w-full px-4 py-2 pr-12 border rounded-lg focus:outline-none focus:border-blue-500"></textarea>
                                <button type="button"
                                        onclick="startVoiceInputForFollowUp('${fqId}')"
                                        class="absolute bottom-3 right-3 p-2 text-gray-500 hover:text-blue-600 transition-colors"
                                        title="Èü≥Â£∞ÂÖ•Âäõ">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 715 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"></path>
                                    </svg>
                                </button>
                                <p class="text-xs text-gray-500 mt-1">ÊúÄÂ§ß1000ÊñáÂ≠ó</p>
                            </div>`;
                        break;
                    case 'text':
                    default:
                        followUpHtml += `<input type="text" id="${fqId}" name="${fqId}"
                                                ${fq.required ? 'required' : ''}
                                                placeholder="${fq.placeholder || ''}"
                                                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">`;
                        break;
                }

                followUpHtml += '</div>';
            });

            followUpHtml += '</div>';
            followUpContainer.innerHTML = followUpHtml;
        }

        // Ë≥™Âïè„Å®ÂõûÁ≠î„ÇíËá™ÁÑ∂„Å™ÊñáÁ´†„Å´Â§âÊèõ
        function convertQuestionToNaturalText(question, answer) {
            // Êó•‰ªòÂΩ¢Âºè„ÅÆÂ†¥ÂêàÔºàYYYY-MM-DDÔºâ
            if (typeof answer === 'string' && /^\d{4}-\d{2}-\d{2}$/.test(answer)) {
                const date = new Date(answer);
                const month = date.getMonth() + 1;
                const day = date.getDate();
                if (question.includes('„ÅÑ„Å§Áπã„Åå„Çä„Åæ„Åó„Åü„Åã')) {
                    return `${month}Êúà${day}Êó•„Å´Áπã„Åå„Çä„Åæ„Åó„Åü„ÄÇ`;
                }
            }

            // „Äå„Åù„ÅÆ‰ªñ„Äç„ÅÆÂ†¥Âêà
            if (answer === 'other' || answer === '„Åù„ÅÆ‰ªñ') {
                if (question.includes('„ÅÑ„Å§Áπã„Åå„Çä„Åæ„Åó„Åü„Åã')) {
                    return '7Êó•‰ª•‰∏äÂâç„Å´Áπã„Åå„Çä„Åæ„Åó„Åü„ÄÇ';
                }
            }

            // „Äå„Åä„Åä„Çà„Åù‰ΩïÊó•Ââç„Åß„Åô„ÅãÔºü„Äç„Éë„Çø„Éº„É≥
            if (question.includes('„Åä„Åä„Çà„Åù‰ΩïÊó•Ââç„Åß„Åô„Åã')) {
                return `Á¥Ñ${answer}Êó•Ââç„Å´Áπã„Åå„Çä„Åæ„Åó„Åü„ÄÇ`;
            }

            // „Äå‰ΩïÂõû„Åè„Çâ„ÅÑÊû∂„Åë„Åæ„Åó„Åü„ÅãÔºü„Äç„Éë„Çø„Éº„É≥
            if (question.includes('‰ΩïÂõû„Åè„Çâ„ÅÑÊû∂„Åë„Åæ„Åó„Åü„Åã')) {
                const prefix = question.replace('„ÅØ‰ΩïÂõû„Åè„Çâ„ÅÑÊû∂„Åë„Åæ„Åó„Åü„ÅãÔºü', '');
                const count = parseInt(answer);
                if (count === 0) {
                    return `${prefix}„ÅØ„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ`;
                }
                return `${prefix}„ÅØ${answer}ÂõûÊû∂„Åë„Åæ„Åó„Åü„ÄÇ`;
            }

            // „Äå‰ΩïÂõû„Åè„Çâ„ÅÑ„Åó„Åæ„Åó„Åü„ÅãÔºü„Äç„Éë„Çø„Éº„É≥
            if (question.includes('‰ΩïÂõû„Åè„Çâ„ÅÑ„Åó„Åæ„Åó„Åü„Åã')) {
                const prefix = question.replace('„ÅØ‰ΩïÂõû„Åè„Çâ„ÅÑ„Åó„Åæ„Åó„Åü„ÅãÔºü', '');
                const count = parseInt(answer);
                if (count === 0) {
                    return `${prefix}„ÅØ„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ`;
                }
                return `${prefix}„ÅØ${answer}Âõû„Åó„Åæ„Åó„Åü„ÄÇ`;
            }

            // „Äå„Äá„Äá„ÅØ„Çè„Åã„Çä„Åæ„Åô„ÅãÔºü„Äç„Éë„Çø„Éº„É≥
            if (question.includes('„ÅØ„Çè„Åã„Çä„Åæ„Åô„Åã')) {
                if (answer === 'YES') {
                    return question.replace('„ÅØ„Çè„Åã„Çä„Åæ„Åô„ÅãÔºü', '„ÅØ„Çè„Åã„Çä„Åæ„Åô„ÄÇ');
                } else if (answer === 'NO') {
                    return question.replace('„ÅØ„Çè„Åã„Çä„Åæ„Åô„ÅãÔºü', '„ÅØ„Çè„Åã„Çä„Åæ„Åõ„Çì„ÄÇ');
                }
            }

            // „Äå„Äá„Äá„ÅØ„ÅÇ„Çä„Åæ„Åó„Åü„ÅãÔºü„Äç„Éë„Çø„Éº„É≥
            if (question.includes('„ÅØ„ÅÇ„Çä„Åæ„Åó„Åü„Åã')) {
                if (answer === '„ÅÇ„Çä') {
                    return question.replace('„ÅØ„ÅÇ„Çä„Åæ„Åó„Åü„ÅãÔºü', '„Åå„ÅÇ„Çä„Åæ„Åó„Åü„ÄÇ');
                } else if (answer === '„Å™„Åó') {
                    return question.replace('„ÅØ„ÅÇ„Çä„Åæ„Åó„Åü„ÅãÔºü', '„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ');
                }
            }

            // „ÄåÊ∏©Â∫¶ÊÑü„ÅØ„Å©„ÅÜ„Åß„Åó„Åü„ÅãÔºü„Äç„Éë„Çø„Éº„É≥
            if (question.includes('Ê∏©Â∫¶ÊÑü„ÅØ„Å©„ÅÜ„Åß„Åó„Åü„Åã')) {
                return `Ê∏©Â∫¶ÊÑü„ÅØ${answer}„Åß„Åó„Åü„ÄÇ`;
            }

            // „Äå„ÅîÂ•ëÁ¥ÑÊôÇÊúü„ÅØ„Çè„Åã„Çä„Åæ„Åô„ÅãÔºü„Äç„Éë„Çø„Éº„É≥
            if (question.includes('„ÅîÂ•ëÁ¥ÑÊôÇÊúü„ÅØ„Çè„Åã„Çä„Åæ„Åô„Åã')) {
                if (answer === 'YES') {
                    return '„ÅîÂ•ëÁ¥ÑÊôÇÊúü„ÅØ„Çè„Åã„Çä„Åæ„Åô„ÄÇ';
                } else if (answer === 'NO') {
                    return '„ÅîÂ•ëÁ¥ÑÊôÇÊúü„ÅØ„Çè„Åã„Çä„Åæ„Åõ„Çì„ÄÇ';
                }
            }

            // followUp„ÅÆË©≥Á¥∞È†ÖÁõÆÔºàÊ•≠ËÄÖÂêç„ÄÅÂ•ëÁ¥ÑÊôÇÊúü„ÄÅÁêÜÁî±„ÅÆË©≥Á¥∞„Å™„Å©Ôºâ
            if (question === 'Ê•≠ËÄÖÂêç' || question === 'Â•ëÁ¥ÑÊôÇÊúü' || question.includes('Ë©≥Á¥∞')) {
                return `${question}: ${answer}`;
            }

            // „Åù„ÅÆ‰ªñ„ÅÆ„Éë„Çø„Éº„É≥
            return `${question}: ${answer}`;
        }

        // Èü≥Â£∞ÂÖ•ÂäõÊ©üËÉΩÔºàË≥™ÂïèÁî®Ôºâ
        function startVoiceInputForQuestion(questionIndex) {
            const textarea = document.getElementById(`question_${questionIndex}`);
            startVoiceInput(textarea, 'ÁÆáÊù°Êõ∏„Åç„Åß„ÇÇOK„Åß„Åô');
        }

        // Èü≥Â£∞ÂÖ•ÂäõÊ©üËÉΩÔºàfollowUpÁî®Ôºâ
        function startVoiceInputForFollowUp(fqId) {
            const textarea = document.getElementById(fqId);
            startVoiceInput(textarea, 'ÁÆáÊù°Êõ∏„Åç„Åß„ÇÇOK„Åß„Åô');
        }

        // Èü≥Â£∞ÂÖ•ÂäõÔºàÂÖ±ÈÄöÂá¶ÁêÜÔºâ
        function startVoiceInput(textarea, defaultPlaceholder) {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('„Åä‰Ωø„ÅÑ„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØÈü≥Â£∞ÂÖ•Âäõ„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇChrome„ÄÅEdge„ÄÅSafari„Çí„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();

            recognition.lang = 'ja-JP';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onstart = function() {
                textarea.placeholder = 'üé§ Èü≥Â£∞ÂÖ•Âäõ‰∏≠...Ë©±„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                textarea.style.borderColor = '#ef4444';
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                // Êó¢Â≠ò„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Å´ËøΩÂä†ÔºàÊîπË°å„ÅßÂå∫Âàá„ÇãÔºâ
                if (textarea.value.trim() !== '') {
                    textarea.value += '\n' + transcript;
                } else {
                    textarea.value = transcript;
                }
            };

            recognition.onerror = function(event) {
                console.error('Èü≥Â£∞Ë™çË≠ò„Ç®„É©„Éº:', event.error);
                alert('Èü≥Â£∞Ë™çË≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + event.error);
                textarea.placeholder = defaultPlaceholder;
                textarea.style.borderColor = '';
            };

            recognition.onend = function() {
                textarea.placeholder = defaultPlaceholder;
                textarea.style.borderColor = '';
            };

            recognition.start();
        }

        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÉÜ„Ç≠„Çπ„Éà„ÇíËá™ÂãïÁîüÊàêÔºà„Éè„Ç§„Éñ„É™„ÉÉ„ÉâÊñπÂºèÔºâ
        async function generateCancelApplicationText() {
            // ÁîüÊàêÂõûÊï∞„ÉÅ„Çß„ÉÉ„ÇØÔºà2Âõû„Åæ„ÅßÔºâ
            if (cancelAiGenerationCount >= 2) {
                alert('AIÁîüÊàê„ÅØ2Âõû„Åæ„Åß„Åß„Åô');
                return;
            }
            cancelAiGenerationCount++;

            try {
                // Ë≥™Âïè„Éï„Ç©„Éº„É†„Åã„ÇâÂõûÁ≠î„ÇíÂèéÈõÜ
                const questions = window.CancelReasons.getQuestions(cancelSelectedCategory, cancelSelectedSubCategory);
                const answers = {};

                // ÂêÑË≥™Âïè„ÅÆÂõûÁ≠î„ÇíÂèñÂæó
                if (questions && questions.length > 0) {
                    questions.forEach((q, index) => {
                        const inputName = `question_${index}`;
                        const element = document.querySelector(`[name="${inputName}"]`);

                        if (q.type === 'radio') {
                            const checked = document.querySelector(`[name="${inputName}"]:checked`);
                            if (checked) {
                                answers[q.label] = checked.value;

                                // followUpÂõûÁ≠î„ÇÇÂèéÈõÜ
                                if (q.followUp && q.followUp[checked.value]) {
                                    q.followUp[checked.value].forEach((fq, fqIndex) => {
                                        const fqId = `question_${index}_followup_${fqIndex}`;
                                        const fqElement = document.getElementById(fqId);
                                        if (fqElement && fqElement.value) {
                                            answers[fq.label] = fqElement.value;
                                        }
                                    });
                                }
                            }
                        } else if (element) {
                            if (element.value) {
                                answers[q.label] = element.value;

                                // dynamicOptions === 'past7days' „Åß„Äå„Åù„ÅÆ‰ªñ„Äç„ÅåÈÅ∏„Å∞„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅdays_ago„ÇÇÂèéÈõÜ
                                if (q.dynamicOptions === 'past7days' && element.value === 'other') {
                                    const daysAgoElement = document.getElementById(`question_${index}_days_ago`);
                                    if (daysAgoElement && daysAgoElement.value) {
                                        answers['„Åä„Åä„Çà„Åù‰ΩïÊó•Ââç„Åß„Åô„ÅãÔºü'] = daysAgoElement.value;
                                    }
                                }
                            }
                        }
                    });
                }

                // „Ç´„ÉÜ„Ç¥„É™„Å®„Çµ„Éñ„Ç´„ÉÜ„Ç¥„É™ÊÉÖÂ†±
                const category = window.CancelReasons.getCategoryById(cancelSelectedCategory);
                const subCats = window.CancelReasons.getSubCategories(cancelSelectedCategory);
                const subCategory = subCats.find(sc => sc.id === cancelSelectedSubCategory);

                // AIÊ†°Ê≠£„Éú„Çø„É≥„ÇíÊäº„Åó„Åü„ÇâÂ∏∏„Å´AIÁîüÊàê„Çí‰ΩøÁî®
                console.log('[generateCancelApplicationText] AIÁîüÊàê„Çí‰ΩøÁî®');
                await generateWithAI(category, subCategory, answers);

            } catch (error) {
                console.error('„ÉÜ„Ç≠„Çπ„ÉàËá™ÂãïÁîüÊàê„Ç®„É©„Éº:', error);
                alert('ÊñáÁ´†ÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
            }
        }

        // AIÁîüÊàê„Çí‰ΩøÁî®ÔºàOpenRouter + DeepSeekÔºâ
        async function generateWithAI(category, subCategory, answers) {
            try {
                const categoryLabel = category.label.replace(/^\d+\.\s*/, '');
                const subCategoryLabel = subCategory.label;

                // GASÂÅ¥„ÅÆAIÁîüÊàêAPI„ÇíÂëº„Å≥Âá∫„Åó
                const rawData = {
                    customerName: cancelSelectedCase.customerName,
                    tel: cancelSelectedCase.tel,
                    address: cancelSelectedCase.address,
                    categoryLabel: categoryLabel,
                    subCategoryLabel: subCategoryLabel,
                    answers: answers
                };

                console.log('[generateWithAI] Calling AI API...', rawData);

                // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
                const textarea = document.getElementById('cancelApplicationText');
                textarea.value = 'AIÊñáÁ´†ÁîüÊàê‰∏≠...';

                const urlParams = new URLSearchParams({
                    action: 'generateAICancelText',
                    rawData: JSON.stringify(rawData)
                });

                const response = await fetch(`${CANCEL_API_URL}?${urlParams.toString()}`);
                const result = await response.json();

                if (result.success && result.generatedText) {
                    textarea.value = result.generatedText;
                    saveTextHistory(); // Â±•Ê≠¥„Å´‰øùÂ≠ò
                    console.log('[generateWithAI] AIÁîüÊàêÊàêÂäü');
                } else {
                    console.error('[generateWithAI] AIÁîüÊàêÂ§±Êïó„ÄÅ„ÉÜ„É≥„Éó„É¨„Éº„Éà„Å´„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ');
                    generateWithTemplate(category, subCategory, answers);
                    saveTextHistory(); // Â±•Ê≠¥„Å´‰øùÂ≠ò
                }

            } catch (error) {
                console.error('[generateWithAI] Error:', error);
                // „Ç®„É©„ÉºÊôÇ„ÅØ„ÉÜ„É≥„Éó„É¨„Éº„Éà„Å´„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ
                generateWithTemplate(category, subCategory, answers);
                saveTextHistory(); // Â±•Ê≠¥„Å´‰øùÂ≠ò
            }
        }

        // „ÉÜ„É≥„Éó„É¨„Éº„ÉàÁîüÊàêÔºàÂæìÊù•„ÅÆ„É≠„Ç∏„ÉÉ„ÇØÔºâ
        function generateWithTemplate(category, subCategory, answers) {
            const categoryLabel = category.label.replace(/^\d+\.\s*/, '');
            const subCategoryLabel = subCategory.label;

            let generatedText = '';

            // Âü∫Êú¨ÊÉÖÂ†±
            generatedText += `${cancelSelectedCase.customerName}ÊßòÔºà${cancelSelectedCase.tel}„ÄÅ${cancelSelectedCase.address}Ôºâ„Å´„Å§„ÅÑ„Å¶„ÄÅ`;
            generatedText += `„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„Çí„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ\n\n`;

            // „Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„ÉóÁä∂Ê≥Å
            generatedText += `„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó„ÇíÂÆüÊñΩ„Åó„Åæ„Åó„Åü„Åå„ÄÅ${subCategoryLabel}„Å®„ÅÑ„ÅÜÁä∂Ê≥Å„ÅÆ„Åü„ÇÅ„ÄÅÂØæÂøú„ÅåÂõ∞Èõ£„Å®Âà§Êñ≠„ÅÑ„Åü„Åó„Åæ„Åó„Åü„ÄÇ\n\n`;

            // ÂõûÁ≠îÂÜÖÂÆπ„ÇíËá™ÁÑ∂„Å™ÊñáÁ´†„Å´ÁµÑ„ÅøËæº„ÇÄ
            if (Object.keys(answers).length > 0) {
                generatedText += `„ÄêË£úË∂≥‰∫ãÈ†Ö„Äë\n`;
                Object.entries(answers).forEach(([key, value]) => {
                    generatedText += `„Éª${convertQuestionToNaturalText(key, value)}\n`;
                });
                generatedText += `\n`;
            }

            generatedText += `‰ª•‰∏ä„ÅÆÁä∂Ê≥Å„Å´„Çà„Çä„ÄÅÊú¨Ê°à‰ª∂„ÅÆ„Ç≠„É£„É≥„Çª„É´„ÇíÁî≥Ë´ã„Åï„Åõ„Å¶„ÅÑ„Åü„Å†„Åç„Åæ„Åô„ÄÇ`;

            // textarea„Å´Ëá™ÂãïÁîüÊàê„ÉÜ„Ç≠„Çπ„Éà„Çí„Çª„ÉÉ„Éà
            document.getElementById('cancelApplicationText').value = generatedText;
        }

        // „ÉÜ„Ç≠„Çπ„ÉàÂ±•Ê≠¥„Çí‰øùÂ≠òÔºà„Ç¢„É≥„Éâ„Ç•/„É™„Éâ„Ç•Áî®Ôºâ
        function saveTextHistory() {
            const textarea = document.getElementById('cancelApplicationText');
            const currentText = textarea.value;

            // ÁèæÂú®„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„Çà„ÇäÂæå„Çç„ÅÆÂ±•Ê≠¥„ÇíÂâäÈô§ÔºàÊñ∞„Åó„ÅÑÂàÜÂ≤ê„Çí‰Ωú„ÇãÔºâ
            textHistory = textHistory.slice(0, textHistoryIndex + 1);

            // Êñ∞„Åó„ÅÑ„ÉÜ„Ç≠„Çπ„Éà„ÇíÂ±•Ê≠¥„Å´ËøΩÂä†
            textHistory.push(currentText);
            textHistoryIndex = textHistory.length - 1;

            // „Ç¢„É≥„Éâ„Ç•/„É™„Éâ„Ç•„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            updateUndoRedoButtons();

            console.log('[Â±•Ê≠¥] ‰øùÂ≠ò:', {
                historyLength: textHistory.length,
                currentIndex: textHistoryIndex
            });
        }

        // „Ç¢„É≥„Éâ„Ç•ÔºàÂÖÉ„Å´Êàª„ÅôÔºâ
        function undoText() {
            if (textHistoryIndex > 0) {
                textHistoryIndex--;
                const textarea = document.getElementById('cancelApplicationText');
                textarea.value = textHistory[textHistoryIndex];
                updateUndoRedoButtons();
                console.log('[Â±•Ê≠¥] „Ç¢„É≥„Éâ„Ç•:', textHistoryIndex);
            }
        }

        // „É™„Éâ„Ç•Ôºà„ÇÑ„ÇäÁõ¥„ÅôÔºâ
        function redoText() {
            if (textHistoryIndex < textHistory.length - 1) {
                textHistoryIndex++;
                const textarea = document.getElementById('cancelApplicationText');
                textarea.value = textHistory[textHistoryIndex];
                updateUndoRedoButtons();
                console.log('[Â±•Ê≠¥] „É™„Éâ„Ç•:', textHistoryIndex);
            }
        }

        // „Ç¢„É≥„Éâ„Ç•/„É™„Éâ„Ç•„Éú„Çø„É≥„ÅÆÊúâÂäπ/ÁÑ°Âäπ„ÇíÊõ¥Êñ∞
        function updateUndoRedoButtons() {
            const undoBtn = document.getElementById('undoTextBtn');
            const redoBtn = document.getElementById('redoTextBtn');

            if (undoBtn) {
                undoBtn.disabled = textHistoryIndex <= 0;
                undoBtn.classList.toggle('opacity-50', textHistoryIndex <= 0);
                undoBtn.classList.toggle('cursor-not-allowed', textHistoryIndex <= 0);
            }

            if (redoBtn) {
                redoBtn.disabled = textHistoryIndex >= textHistory.length - 1;
                redoBtn.classList.toggle('opacity-50', textHistoryIndex >= textHistory.length - 1);
                redoBtn.classList.toggle('cursor-not-allowed', textHistoryIndex >= textHistory.length - 1);
            }
        }

        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÇíÊèêÂá∫
        async function submitCancelApplication() {
            // „Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ„Åó„Å¶‰∫åÈáçÈÄÅ‰ø°„ÇíÈò≤Ê≠¢
            const submitBtn = document.getElementById('submitCancelBtn');
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
                submitBtn.innerHTML = `
                    <svg class="animate-spin h-5 w-5 inline mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    ÈÄÅ‰ø°‰∏≠...
                `;
            }

            try {
                // Ë≥™Âïè„Éï„Ç©„Éº„É†„Åã„ÇâÂõûÁ≠î„ÇíÂèéÈõÜ
                const questions = window.CancelReasons.getQuestions(cancelSelectedCategory, cancelSelectedSubCategory);
                const answers = {};

                // ÂêÑË≥™Âïè„ÅÆÂõûÁ≠î„ÇíÂèñÂæó
                if (questions && questions.length > 0) {
                    questions.forEach((q, index) => {
                        const inputName = `question_${index}`;
                        const element = document.querySelector(`[name="${inputName}"]`);

                        if (q.type === 'radio') {
                            const checked = document.querySelector(`[name="${inputName}"]:checked`);
                            if (checked) {
                                answers[q.label] = checked.value;

                                // followUpÂõûÁ≠î„ÇÇÂèéÈõÜ
                                if (q.followUp && q.followUp[checked.value]) {
                                    q.followUp[checked.value].forEach((fq, fqIndex) => {
                                        const fqId = `question_${index}_followup_${fqIndex}`;
                                        const fqElement = document.getElementById(fqId);
                                        if (fqElement && fqElement.value) {
                                            answers[fq.label] = fqElement.value;
                                        }
                                    });
                                }
                            }
                        } else if (element) {
                            if (element.value) {
                                answers[q.label] = element.value;
                            }
                        }
                    });
                }

                // „Ç´„ÉÜ„Ç¥„É™„Å®„Çµ„Éñ„Ç´„ÉÜ„Ç¥„É™ÊÉÖÂ†±
                const category = window.CancelReasons.getCategoryById(cancelSelectedCategory);
                const subCats = window.CancelReasons.getSubCategories(cancelSelectedCategory);
                const subCategory = subCats.find(sc => sc.id === cancelSelectedSubCategory);

                // Êû∂ÈõªÂ±•Ê≠¥„Åã„ÇâËá™ÂãïÂèñÂæó„Åó„Åü„Éá„Éº„Çø„Çí‰ΩøÁî®
                const phoneCount = cancelSelectedCase.phoneCallCount || 0;
                const smsCount = cancelSelectedCase.smsCount || 0;
                const lastContactDate = cancelSelectedCase.lastContactDate || new Date().toISOString();

                const merchantId = window.merchantId;
                const merchantName = window.merchantData?.['‰ºöÁ§æÂêç'] || '';
                const applicantName = window.merchantData?.['Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç'] || currentUser || '';

                if (!merchantId) {
                    alert('„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    // „Éú„Çø„É≥„ÇíÊúâÂäπÂåñ
                    if (submitBtn) {
                        submitBtn.disabled = false;
                        submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                        submitBtn.innerHTML = '„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÇíÊèêÂá∫';
                    }
                    return;
                }

                // Á∑®ÈõÜ„Åï„Çå„Åü„ÉÜ„Ç≠„Çπ„Éà„ÇíÂèñÂæó
                const applicationText = document.getElementById('cancelApplicationText').value;
                if (!applicationText || applicationText.trim() === '') {
                    alert('Áî≥Ë´ãÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    // „Éú„Çø„É≥„ÇíÊúâÂäπÂåñ
                    if (submitBtn) {
                        submitBtn.disabled = false;
                        submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                        submitBtn.innerHTML = '„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÇíÊèêÂá∫';
                    }
                    return;
                }

                const params = {
                    action: 'submitCancelReport',
                    merchantId: merchantId,
                    merchantName: merchantName,
                    applicantName: applicantName,
                    cvId: cancelSelectedCase.cvId,
                    cancelReasonCategory: category.label,
                    cancelReasonDetail: subCategory.label,
                    reasonData: JSON.stringify({
                        category: cancelSelectedCategory,
                        subCategory: cancelSelectedSubCategory,
                        answers: answers
                    }),
                    additionalInfo1: applicationText,
                    phoneCallCount: phoneCount,
                    smsCount: smsCount,
                    lastContactDate: lastContactDate
                };

                console.log('[„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã] ÈÄÅ‰ø°„Éá„Éº„Çø:', params);

                // GET„É™„ÇØ„Ç®„Çπ„Éà„Å´Â§âÊõ¥ÔºàgetCancelableCases„Å®Âêå„Åò„Éë„Çø„Éº„É≥Ôºâ
                const urlParams = new URLSearchParams();
                for (const [key, value] of Object.entries(params)) {
                    urlParams.append(key, value);
                }

                const response = await fetch(`${CANCEL_API_URL}?${urlParams.toString()}`);
                console.log('[„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã] Response status:', response.status);
                const result = await response.json();

                if (result.success) {
                    alert('„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÇíÊèêÂá∫„Åó„Åæ„Åó„Åü');
                    closeCancelModal();
                    // ÂØ©Êüª‰∏≠„Çø„Éñ„Å´Âàá„ÇäÊõø„Åà„Å¶Ë°®Á§∫
                    switchCancelTab('pending');
                } else {
                    alert('Áî≥Ë´ã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + result.error);
                    // „Éú„Çø„É≥„ÇíÊúâÂäπÂåñ
                    if (submitBtn) {
                        submitBtn.disabled = false;
                        submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                        submitBtn.innerHTML = '„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÇíÊèêÂá∫';
                    }
                }
            } catch (error) {
                console.error('„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„Ç®„É©„Éº:', error);
                alert('Áî≥Ë´ã„ÅÆÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                // „Éú„Çø„É≥„ÇíÊúâÂäπÂåñ
                const submitBtn = document.getElementById('submitCancelBtn');
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    submitBtn.innerHTML = '„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÇíÊèêÂá∫';
                }
            }
        }

        // ÊúüÈôêÂª∂Èï∑Áî≥Ë´ãÂèØËÉΩÊ°à‰ª∂„ÇíË™≠„ÅøËæº„Åø
        window.loadExtensionEligibleCases = async function() {
            const casesList = document.getElementById('extensionCasesList');

            try {
                const merchantId = window.merchantId;
                if (!merchantId) {
                    alert('„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    return;
                }

                // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
                casesList.innerHTML = '<div class="col-span-full text-center py-8"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div><p class="text-gray-600 mt-2">Ë™≠„ÅøËæº„Åø‰∏≠...</p></div>';

                console.log('[Extension] APIÂëº„Å≥Âá∫„Åó - merchantId:', merchantId);
                const response = await fetchWithRetry(`${CANCEL_API_URL}?action=getExtensionEligibleCases&merchantId=${merchantId}`);
                const result = await response.json();
                console.log('[Extension] API„É¨„Çπ„Éù„É≥„Çπ:', result);

                // „Éá„Éº„Çø„Çí„Ç≠„É£„ÉÉ„Ç∑„É•„Å´‰øùÂ≠ò
                if (result.success && result.cases) {
                    extensionEligibleCasesCache = result.cases;
                    console.log('[Extension] ÊúüÈôêÂª∂Èï∑ÂèØËÉΩÊ°à‰ª∂:', extensionEligibleCasesCache.length, '‰ª∂', extensionEligibleCasesCache);
                }

                if (result.success && result.cases.length > 0) {
                    casesList.innerHTML = result.cases.map(caseItem => {
                        const deliveredDate = new Date(caseItem.deliveredAt).toLocaleDateString('ja-JP');
                        const currentDeadline = new Date(caseItem.applicationDeadline).toLocaleDateString('ja-JP');
                        const extendedDeadline = new Date(caseItem.extendedDeadline).toLocaleDateString('ja-JP');
                        return `
                        <div class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow cursor-pointer"
                             onclick="openExtensionModal('${caseItem.cvId}')">
                            <div class="flex justify-between items-start mb-3">
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">Âª∂Èï∑ÂèØËÉΩ</span>
                                <button onclick="event.stopPropagation(); openCancelModal('${caseItem.cvId}')"
                                        class="px-2 py-1 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors"
                                        title="„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã">
                                    ‚ùå „Ç≠„É£„É≥„Çª„É´
                                </button>
                            </div>
                            <h3 class="font-bold text-lg mb-1">${caseItem.customerName}</h3>
                            <p class="text-sm text-gray-600 mb-2">üìç ${caseItem.address}</p>
                            <p class="text-sm text-gray-600 mb-2">üìû ${caseItem.tel}</p>
                            <p class="text-sm text-gray-600 mb-2">ÈÖç‰ø°Êó•: ${deliveredDate}</p>
                            <p class="text-sm text-red-600">ÁèæÂú®„ÅÆÊúüÈôê: ${currentDeadline}</p>
                            <p class="text-sm text-green-600 font-semibold">Âª∂Èï∑ÂæåÊúüÈôê: ${extendedDeadline}</p>
                        </div>
                        `;
                    }).join('');
                } else {
                    casesList.innerHTML = '<p class="text-gray-600 col-span-full text-center py-8">Áî≥Ë´ãÂèØËÉΩ„Å™Ê°à‰ª∂„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                }
            } catch (error) {
                console.error('ÊúüÈôêÂª∂Èï∑Ê°à‰ª∂„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);

                // „Ç®„É©„ÉºÂÜÖÂÆπ„ÇíËß£Êûê
                let errorMessage = 'Ê°à‰ª∂„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ';
                if (error.name === 'AbortError') {
                    errorMessage = '„É™„ÇØ„Ç®„Çπ„Éà„Åå„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„Åü„ÄÇ„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                } else if (error.message.includes('HTTP error')) {
                    errorMessage = `„Çµ„Éº„Éê„Éº„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü (${error.message})`;
                } else if (error.message === 'Failed to fetch') {
                    errorMessage = '„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Ç§„É≥„Çø„Éº„Éç„ÉÉ„ÉàÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                }

                casesList.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <div class="text-red-500 mb-4">
                            <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                            <p class="font-semibold">${errorMessage}</p>
                        </div>
                        <button onclick="loadExtensionEligibleCases()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                            ÂÜçË™≠„ÅøËæº„Åø
                        </button>
                    </div>
                `;
                alert(errorMessage);
            }
        }

        // ÊúüÈôêÂª∂Èï∑„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
        function openExtensionModal(cvId) {
            try {
                // „Ç≠„É£„ÉÉ„Ç∑„É•„Åã„Çâ„Éá„Éº„Çø„ÇíÂèñÂæó
                extensionSelectedCase = extensionEligibleCasesCache.find(c => c.cvId === cvId);

                if (extensionSelectedCase) {
                    document.getElementById('extensionModalCvId').textContent = extensionSelectedCase.cvId;
                    document.getElementById('extensionModalCustomerName').textContent = extensionSelectedCase.customerName;
                    document.getElementById('extensionModalPhone').textContent = extensionSelectedCase.tel;
                    document.getElementById('extensionModalDeliveredDate').textContent = new Date(extensionSelectedCase.deliveredAt).toLocaleDateString('ja-JP');
                    document.getElementById('extensionModalCurrentDeadline').textContent = new Date(extensionSelectedCase.applicationDeadline).toLocaleDateString('ja-JP');
                    document.getElementById('extensionModalNewDeadline').textContent = new Date(extensionSelectedCase.extendedDeadline).toLocaleDateString('ja-JP');

                    document.getElementById('extensionModal').classList.remove('hidden');
                } else {
                    console.error('Ê°à‰ª∂„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:', cvId);
                    alert('Ê°à‰ª∂ÊÉÖÂ†±„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇÁîªÈù¢„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                }
            } catch (error) {
                console.error('È°ßÂÆ¢ÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                alert('È°ßÂÆ¢ÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        // Âª∂Èï∑ÁêÜÁî±„ÅÆÈü≥Â£∞ÂÖ•Âäõ
        window.startExtensionReasonVoiceInput = function() {
            const textarea = document.getElementById('extensionReason');

            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('„Åä‰Ωø„ÅÑ„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØÈü≥Â£∞ÂÖ•Âäõ„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇChrome„ÄÅEdge„ÄÅSafari„Çí„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();

            recognition.lang = 'ja-JP';
            recognition.continuous = false;
            recognition.interimResults = false;

            recognition.onstart = function() {
                console.log('[Èü≥Â£∞ÂÖ•Âäõ] ÈñãÂßã');
                textarea.placeholder = 'üé§ Èü≥Â£∞ÂÖ•Âäõ‰∏≠...';
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                console.log('[Èü≥Â£∞ÂÖ•Âäõ] Ë™çË≠òÁµêÊûú:', transcript);

                // Êó¢Â≠ò„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Å´ËøΩÂä†
                if (textarea.value) {
                    textarea.value += ' ' + transcript;
                } else {
                    textarea.value = transcript;
                }
            };

            recognition.onerror = function(event) {
                console.error('[Èü≥Â£∞ÂÖ•Âäõ] „Ç®„É©„Éº:', event.error);
                textarea.placeholder = '‰æãÔºö„ÅäÂÆ¢Êßò„Å®ÈÄ£Áµ°„ÅåÂèñ„Çå„Åæ„Åó„Åü„Åå„ÄÅ10Êó•Âæå„Å´Ë®™Âïè‰∫àÂÆö„ÅÆ„Åü„ÇÅÊúüÈôêÂª∂Èï∑„ÇíÁî≥Ë´ã„Åó„Åæ„Åô„ÄÇ';

                if (event.error === 'no-speech') {
                    alert('Èü≥Â£∞„ÅåË™çË≠ò„Åï„Çå„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
                } else if (event.error === 'not-allowed') {
                    alert('„Éû„Ç§„ÇØ„ÅÆ‰ΩøÁî®„ÅåË®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ„Éñ„É©„Ç¶„Ç∂„ÅÆË®≠ÂÆö„Åß„Éû„Ç§„ÇØ„ÇíË®±ÂèØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                } else {
                    alert('Èü≥Â£∞ÂÖ•Âäõ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + event.error);
                }
            };

            recognition.onend = function() {
                console.log('[Èü≥Â£∞ÂÖ•Âäõ] ÁµÇ‰∫Ü');
                textarea.placeholder = '‰æãÔºö„ÅäÂÆ¢Êßò„Å®ÈÄ£Áµ°„ÅåÂèñ„Çå„Åæ„Åó„Åü„Åå„ÄÅ10Êó•Âæå„Å´Ë®™Âïè‰∫àÂÆö„ÅÆ„Åü„ÇÅÊúüÈôêÂª∂Èï∑„ÇíÁî≥Ë´ã„Åó„Åæ„Åô„ÄÇ';
            };

            recognition.start();
        };

        // ÊúüÈôêÂª∂Èï∑„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        window.closeExtensionModal = function() {
            document.getElementById('extensionModal').classList.add('hidden');
            extensionSelectedCase = null;
            document.getElementById('extensionForm').reset();
        }

        // ÊúüÈôêÂª∂Èï∑Áî≥Ë´ã„Éï„Ç©„Éº„É†ÈÄÅ‰ø°
        document.getElementById('extensionForm')?.addEventListener('submit', async function(e) {
            e.preventDefault();

            // „Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ„Åó„Å¶‰∫åÈáçÈÄÅ‰ø°„ÇíÈò≤Ê≠¢
            const submitBtn = document.getElementById('submitExtensionBtn');
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
                submitBtn.innerHTML = `
                    <svg class="animate-spin h-5 w-5 inline mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    ÈÄÅ‰ø°‰∏≠...
                `;
            }

            try {
                const contactDate = document.getElementById('extensionContactDate').value;
                const appointmentDate = document.getElementById('extensionAppointmentDate').value;
                const reason = document.getElementById('extensionReason').value;

                if (!contactDate || !appointmentDate || !reason) {
                    alert('„Åô„Åπ„Å¶„ÅÆÈ†ÖÁõÆ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    if (submitBtn) {
                        submitBtn.disabled = false;
                        submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                        submitBtn.innerHTML = 'ÊúüÈôêÂª∂Èï∑„ÇíÁî≥Ë´ã';
                    }
                    return;
                }

                const merchantId = window.merchantId;
                const merchantName = window.merchantData?.['‰ºöÁ§æÂêç'] || '';
                const applicantName = window.merchantData?.['Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç'] || currentUser || '';

                if (!merchantId) {
                    alert('„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    if (submitBtn) {
                        submitBtn.disabled = false;
                        submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                        submitBtn.innerHTML = 'ÊúüÈôêÂª∂Èï∑„ÇíÁî≥Ë´ã';
                    }
                    return;
                }

                const params = {
                    action: 'submitExtensionRequest',
                    merchantId: merchantId,
                    merchantName: merchantName,
                    applicantName: applicantName,
                    cvId: extensionSelectedCase.cvId,
                    contactDate: contactDate,
                    appointmentDate: appointmentDate,
                    extensionReason: reason
                };

                console.log('[ÊúüÈôêÂª∂Èï∑Áî≥Ë´ã] ÈÄÅ‰ø°„Éá„Éº„Çø:', params);

                // GET„É™„ÇØ„Ç®„Çπ„Éà„Å´Â§âÊõ¥ÔºàgetCancelableCases„Å®Âêå„Åò„Éë„Çø„Éº„É≥Ôºâ
                const urlParams = new URLSearchParams();
                for (const [key, value] of Object.entries(params)) {
                    urlParams.append(key, value);
                }

                const response = await fetch(`${CANCEL_API_URL}?${urlParams.toString()}`);
                console.log('[ÊúüÈôêÂª∂Èï∑Áî≥Ë´ã] Response status:', response.status);
                const result = await response.json();

                if (result.success) {
                    alert('ÊúüÈôêÂª∂Èï∑Áî≥Ë´ã„ÇíÊèêÂá∫„Åó„Åæ„Åó„Åü');
                    closeExtensionModal();
                    loadExtensionEligibleCases();
                } else {
                    alert('Áî≥Ë´ã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + result.error);
                    if (submitBtn) {
                        submitBtn.disabled = false;
                        submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                        submitBtn.innerHTML = 'ÊúüÈôêÂª∂Èï∑„ÇíÁî≥Ë´ã';
                    }
                }
            } catch (error) {
                console.error('ÊúüÈôêÂª∂Èï∑Áî≥Ë´ã„Ç®„É©„Éº:', error);
                alert('Áî≥Ë´ã„ÅÆÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    submitBtn.innerHTML = 'ÊúüÈôêÂª∂Èï∑„ÇíÁî≥Ë´ã';
                }
            }
        });
    </script>
    <style>
        @keyframes slide-in {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slide-out {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        .animate-slide-in { animation: slide-in 0.3s ease-out; }
        .animate-slide-out { animation: slide-out 0.3s ease-out; }
    </style>

    <!-- Â§ßÂûãÁâ©‰ª∂„ÅÆÁ¥π‰ªãÊñô„Å´„Å§„ÅÑ„Å¶„ÅÆ„É¢„Éº„ÉÄ„É´ -->
    <div id="largePropertyModal" class="fixed inset-0 z-50 hidden">
        <!-- „Ç™„Éº„Éê„Éº„É¨„Ç§ -->
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>

        <!-- „É¢„Éº„ÉÄ„É´Êú¨‰Ωì -->
        <div class="flex items-center justify-center h-full p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full relative">
                <!-- Èñâ„Åò„Çã„Éú„Çø„É≥ -->
                <button onclick="closeLargePropertyModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 z-10">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>

                <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                <div class="bg-white border-b px-8 py-6 rounded-t-xl">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        üîä Â§ßÂûãÁâ©‰ª∂„ÅÆÁ¥π‰ªãÊñô„Å´„Å§„ÅÑ„Å¶
                    </h3>
                </div>

                <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
                <div class="px-8 py-6 space-y-4">
                    <!-- 3Èöé‰ª•‰∏ä„ÇíÈÅ∏Êäû„Åó„ÅüÂ†¥Âêà -->
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded">
                        <div class="flex items-start">
                            <span class="text-yellow-500 mr-2">‚ö†Ô∏è</span>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2">3Èöé‰ª•‰∏ä„ÇíÈÅ∏Êäû„Åó„ÅüÂ†¥Âêà</h4>
                                <p class="text-gray-700">
                                    Âü∫Êú¨Á¥π‰ªãÊñô„Åå <span class="line-through text-gray-500">¬•20,000</span> „Åã„Çâ <span class="font-bold text-green-600 text-lg">¬•30,000</span> „Å´„Å™„Çä„Åæ„Åô
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- 3Èöé‰ª•‰∏ä„ÇíÈÅ∏Êäû„Åó„Å¶„ÅÑ„Çã„Å® -->
                    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                        <div class="flex items-start">
                            <span class="text-yellow-500 mr-2">‚ö†Ô∏è</span>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2">3Èöé‰ª•‰∏ä„ÇíÈÅ∏Êäû„Åó„Å¶„ÅÑ„Çã„Å®</h4>
                                <p class="text-gray-700">
                                    2Èöé‰ª•‰∏ã„Åß„ÇÇÂ§ßÂûã„Å®Âà§Êñ≠„Åï„Çå„Çå„Å∞Ëá™Âãï„ÅßÁ¥π‰ªãÊñô„Åå<span class="font-bold text-red-600">¬•30,000</span>„Å´„Å™„Çä„Åæ„Åô
                                </p>
                                <p class="text-sm text-gray-600 mt-2">
                                    Ôºà3Èöé‰ª•‰∏ä„Åß„ÇÇË¶ãÁ©ç„ÇÇ„ÇäÂ∏åÊúõÁÆáÊâÄ„ÅåÂ∞è„Åï„ÅÑÂ†¥Âêà„ÄÅËá™ÂãïÁöÑ„Å´Ê∏õÈ°ç„Åï„Çå„Å¶Ëá™ÂãïÈÖç‰ø°„Åï„Çå„Çã‰∫ã„Åå„ÅÇ„Çä„Åæ„Åô„Åå„ÄÅÊúÄÁµÇÁöÑ„Å™ÈáëÈ°çË®≠ÂÆö„ÅØÊ†™Âºè‰ºöÁ§æÂ§ñÂ£ÅÂ°óË£Ö„Åè„Çâ„Åπ„ÇãÈÅãÂñ∂Êú¨ÈÉ®„ÅÆÂà§Êñ≠„Å´„Çà„Çã„ÇÇ„ÅÆ„Å®„Åó„ÄÅÂä†ÁõüÂ∫ó„ÅØ„Åì„Çå„Å´ÂêåÊÑè„Åô„Çã„ÇÇ„ÅÆ„Å®„Åó„Åæ„ÅôÔºâ
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- 2Èöé‰ª•‰∏ã„ÇíÈÅ∏Êäû„Åó„Å¶„ÅÑ„Çå„Å∞ -->
                    <div class="bg-green-50 border-l-4 border-green-400 p-4 rounded">
                        <div class="flex items-start">
                            <span class="text-yellow-500 mr-2">‚ö†Ô∏è</span>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2">2Èöé‰ª•‰∏ã„ÇíÈÅ∏Êäû„Åó„Å¶„ÅÑ„Çå„Å∞</h4>
                                <p class="text-gray-700">
                                    ÈÄöÂ∏∏„ÅÆÊà∏Âª∫„ÅßÊñôÈáëÈÅ©Áî®„Å®„Å™„Çä„ÄÅ<span class="font-bold text-green-600">¬•30,000„ÅßËá™ÂãïÈÖç‰ø°„Åï„Çå„Çã„Åì„Å®„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- „Éï„ÉÉ„Çø„Éº -->
                <div class="px-8 pb-6">
                    <button onclick="closeLargePropertyModal()" class="w-full bg-blue-500 text-white py-3 px-6 rounded-lg hover:bg-blue-600 transition-colors font-semibold text-base">
                        ÁêÜËß£„Åó„Åæ„Åó„Åü
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÂçòÂìÅÈ†ÖÁõÆÈÅ∏ÊäûÊôÇ„ÅÆ„É¢„Éº„ÉÄ„É´ -->
    <div id="singleItemModal" class="fixed inset-0 z-50 hidden">
        <!-- „Ç™„Éº„Éê„Éº„É¨„Ç§ -->
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>

        <!-- „É¢„Éº„ÉÄ„É´Êú¨‰Ωì -->
        <div class="flex items-center justify-center h-full p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full relative">
                <!-- Èñâ„Åò„Çã„Éú„Çø„É≥ -->
                <button onclick="closeSingleItemModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 z-10">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>

                <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                <div class="bg-white border-b px-8 py-6 rounded-t-xl">
                    <h3 class="text-xl font-bold text-gray-800">
                        üí∞ 1Á§æÁ¥π‰ªãÊôÇ„ÅÆÊñôÈáë„Å´„Å§„ÅÑ„Å¶
                    </h3>
                </div>

                <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
                <div class="px-8 py-6">
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded">
                        <p class="text-gray-700 text-base">
                            ÂçòÂìÅÈ†ÖÁõÆ„ÅØÁõ∏Ë¶ãÁ©ç„ÇÇ„ÇäÊôÇ„ÅÆÊñôÈáë„Åß„Åô„ÄÇ
                        </p>
                        <p class="text-gray-700 text-base mt-2">
                            1Á§æÁ¥π‰ªãÊôÇ„ÅØ„Åô„Åπ„Å¶<span class="font-bold text-black text-lg">¬•20,000</span>„Å®„Å™„Çä„Åæ„Åô„ÄÇ
                        </p>
                    </div>
                </div>

                <!-- „Éï„ÉÉ„Çø„Éº -->
                <div class="px-8 pb-6">
                    <button onclick="closeSingleItemModal()" class="w-full bg-blue-500 text-white py-3 px-6 rounded-lg hover:bg-blue-600 transition-colors font-semibold text-base">
                        Á¢∫Ë™ç„Åó„Åæ„Åó„Åü
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ÂàùÂõû„É≠„Ç∞„Ç§„É≥ÊôÇ„ÅÆÂàùÊúüË®≠ÂÆö
        function initializeFirstLoginSettings() {
            console.log('[initializeFirstLoginSettings] ÈñãÂßã');
            console.log('[initializeFirstLoginSettings] window.merchantData:', window.merchantData ? 'exists' : 'null');

            // ÂàùÂõû„É≠„Ç∞„Ç§„É≥„Åã„Å©„ÅÜ„Åã„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºàlocalStorage„Å´‰øùÂ≠òÔºâ
            const isInitialized = localStorage.getItem('autodeliveryInitialized');

            if (!isInitialized) {
                console.log('[ÂàùÂõû„É≠„Ç∞„Ç§„É≥] Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÇíÂàùÊúüÂåñ„Åó„Åæ„Åô');

                // „Çπ„ÉÜ„Éº„Çø„Çπ„Çí‰∏ÄÊôÇÂÅúÊ≠¢‰∏≠„Å´Ë®≠ÂÆöÔºàÊó¢„Å´HTML„Åß„Éá„Éï„Ç©„É´„ÉàË®≠ÂÆöÊ∏à„ÅøÔºâ
                const statusSelect = document.getElementById('merchantStatus');
                if (statusSelect) {
                    statusSelect.value = 'paused';
                    // updateMerchantStatus()„ÅØÂâäÈô§Ê∏à„ÅøÔºà„Çπ„ÉÜ„Éº„Çø„Çπ„ÅØ„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÂãïÁöÑÂèñÂæóÔºâ
                }

                // ÂàùÊúüÂåñÂÆå‰∫Ü„Éï„É©„Ç∞„Çí‰øùÂ≠ò
                localStorage.setItem('autodeliveryInitialized', 'true');
                console.log('[ÂàùÂõû„É≠„Ç∞„Ç§„É≥] ÂàùÊúüÂåñÂÆå‰∫Ü');
            }

            // ÊØéÂõûÂÆüË°å: ‰∏ÄÊôÇÂÅúÊ≠¢ÈñãÂßãÊó•„Çí‰ªäÊó•„Å´Ë®≠ÂÆöÔºà„Éá„Éï„Ç©„É´„ÉàË°®Á§∫Ôºâ
            const today = new Date().toISOString().split('T')[0];
            const startDateInput = document.getElementById('pauseStartDate');
            if (startDateInput && !startDateInput.value) {
                startDateInput.value = today;
            }

            // ÊØéÂõûÂÆüË°å: Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Çí„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâË™≠„ÅøËæº„Åø
            if (window.merchantData) {
                console.log('[initializeFirstLoginSettings] window.merchantData„ÅåÂ≠òÂú®„Åó„Åæ„Åô„ÄÇloadAutodeliverySettings„ÇíÂëº„Å≥Âá∫„Åó„Åæ„Åô„ÄÇ');
                window.loadAutodeliverySettings(window.merchantData);
            } else {
                console.warn('[initializeFirstLoginSettings] window.merchantData„ÅåÂ≠òÂú®„Åó„Åæ„Åõ„ÇìÔºÅ');
                // merchantData„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÁ©∫„Éá„Éº„Çø„ÅßÂàùÊúüÂåñ
                window.loadAutodeliverySettings({});
            }
        }

        // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆöÁî®„Å´„Éá„Éº„Çø„ÇíÂèñÂæó
        async function fetchMerchantDataForAutodelivery(merchantId) {
            try {
                // JSONP „Åß„Éá„Éº„ÇøÂèñÂæó
                const result = await new Promise((resolve, reject) => {
                    const callbackName = 'jsonp_autodelivery_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    const script = document.createElement('script');
                    const url = `${window.ENV.GAS_URL}?action=getMerchantData&merchantId=${encodeURIComponent(merchantId)}&callback=${callbackName}`;

                    window[callbackName] = (data) => {
                        delete window[callbackName];
                        if (script.parentNode) {
                            script.parentNode.removeChild(script);
                        }
                        resolve(data);
                    };

                    script.src = url;
                    script.onerror = () => {
                        delete window[callbackName];
                        if (script.parentNode) {
                            script.parentNode.removeChild(script);
                        }
                        reject(new Error('JSONP request failed'));
                    };
                    document.body.appendChild(script);
                });

                if (result.success && result.data) {
                    window.merchantData = result.data;
                    window.merchantId = merchantId;

                    // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÇíË™≠„ÅøËæº„ÇÄ
                    window.loadAutodeliverySettings(result.data);
                } else {
                    // „Ç®„É©„ÉºÊôÇ„ÇÇ„Éá„Éï„Ç©„É´„ÉàË®≠ÂÆö„ÅßÂàùÊúüÂåñ
                    window.loadAutodeliverySettings({});
                }
            } catch (error) {
                // „Ç®„É©„ÉºÊôÇ„ÇÇ„Éá„Éï„Ç©„É´„ÉàË®≠ÂÆö„ÅßÂàùÊúüÂåñ
                window.loadAutodeliverySettings({});
            }
        }

        // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâËá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÇíË™≠„ÅøËæº„ÇÄÔºà„Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞Ôºâ
        window.loadAutodeliverySettings = function(data) {

            // üî• ÊâøË™çÂæÖ„Å°/ÂØ©Êüª‰∏≠„Çπ„ÉÜ„Éº„Çø„Çπ„ÅÆÂ†¥Âêà„ÄÅËá™ÂãïÁöÑ„Å´Êú™ÂÆö„ÉÅ„Çß„ÉÉ„ÇØ„ÇíË®≠ÂÆöÔºàÂàùÂõûÁôªÈå≤ÊôÇ„ÅÆ„ÅøÔºâ
            const merchantStatus = data['„Çπ„ÉÜ„Éº„Çø„Çπ'] || '';
            const isInitialRegistration = !localStorage.getItem('autodeliveryInitialized');

            const shouldSetIndefinite = isInitialRegistration && (
                merchantStatus === 'ÊâøË™çÂæÖ„Å°' ||
                merchantStatus === 'ÂØ©Êüª‰∏≠' ||
                merchantStatus === 'pending' ||
                merchantStatus === 'approval' ||
                merchantStatus === 'Êú™ÊâøË™ç' ||
                merchantStatus === 'ÁôªÈå≤ÂØ©Êüª‰∏≠' ||
                merchantStatus === '' // Á©∫ÊñáÂ≠ó„Åß„ÇÇ„ÉÜ„Çπ„ÉàÂÆüË°å
            );

            if (shouldSetIndefinite) {
                // ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„ÇíÊúâÂäπ„Å´„Åó„ÄÅÊú™ÂÆö„ÉÅ„Çß„ÉÉ„ÇØ„ÇíËá™ÂãïË®≠ÂÆö
                const autoPauseToggle = document.getElementById('autoPauseToggle');
                const indefinitePause = document.getElementById('indefinitePause');

                if (autoPauseToggle && indefinitePause) {
                    // ‰∏ÄÊôÇÂÅúÊ≠¢„ÇíÊúâÂäπÂåñ
                    autoPauseToggle.checked = true;

                    if (typeof toggleAutoPause === 'function') {
                        toggleAutoPause(); // ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„ÇíË°®Á§∫
                    }

                    // Êú™ÂÆö„ÉÅ„Çß„ÉÉ„ÇØ„ÇíËá™ÂãïË®≠ÂÆö
                    indefinitePause.checked = true;

                    if (typeof toggleIndefinitePause === 'function') {
                        toggleIndefinitePause(); // Êú™ÂÆöË°®Á§∫„ÇíÊõ¥Êñ∞
                    }

                }
            }

            // ÂØæÂøúÁâ©‰ª∂Á®ÆÂà•ÔºàË§áÊï∞„ÅÆÂàóÂêç„Å´ÂØæÂøúÔºâ
            // „Åæ„ÅöÂÖ®„Å¶„ÅÆÁâ©‰ª∂Á®ÆÂà•„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Çí„É™„Çª„ÉÉ„Éà
            const autodeliverySection = document.getElementById('autodeliverySection');
            const propertyTypesSection = document.getElementById('propertyTypesSection');
            if (autodeliverySection) {
                autodeliverySection.querySelectorAll('input[name="propertyType"]').forEach(cb => {
                    cb.checked = false;
                });
            }
            if (propertyTypesSection) {
                propertyTypesSection.querySelectorAll('input[name="propertyType"]').forEach(cb => {
                    cb.checked = false;
                });
            }

            // ABÂàó„ÅÆ„Éá„Éº„Çø„ÇíÂèñÂæóÔºàË§áÊï∞„ÅÆÂàóÂêç„Éë„Çø„Éº„É≥„Å´ÂØæÂøúÔºâ
            const propertyTypesData = data['ÂØæÂøúÂèØËÉΩÁâ©‰ª∂Á®ÆÂà•'] || data['ÂØæÂøúÁâ©‰ª∂Á®ÆÂà•'] || '';
            console.log('[loadAutodeliverySettings] ÂØæÂøúÂèØËÉΩÁâ©‰ª∂Á®ÆÂà• data:', propertyTypesData);
            console.log('[loadAutodeliverySettings] data["ÂØæÂøúÂèØËÉΩÁâ©‰ª∂Á®ÆÂà•"]:', data['ÂØæÂøúÂèØËÉΩÁâ©‰ª∂Á®ÆÂà•']);
            console.log('[loadAutodeliverySettings] data["ÂØæÂøúÁâ©‰ª∂Á®ÆÂà•"]:', data['ÂØæÂøúÁâ©‰ª∂Á®ÆÂà•']);

            if (propertyTypesData) {
                const propertyTypes = propertyTypesData.split(',').map(s => s.trim());
                console.log('[loadAutodeliverySettings] Property types array:', propertyTypes);
                console.log('[loadAutodeliverySettings] Property types length:', propertyTypes.length);
                console.log('[loadAutodeliverySettings] Property types JSON:', JSON.stringify(propertyTypes));

                const propertyMap = {
                    'Êà∏Âª∫„Å¶‰ΩèÂÆÖ': 'house',
                    '„Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥': 'apartment',
                    'Â∫óËàó„Éª‰∫ãÂãôÊâÄ': 'commercial',
                    'Â∫óËàó': 'commercial',  // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„ÇãÁü≠Á∏ÆÂΩ¢
                    'Â∑•Â†¥„ÉªÂÄâÂ∫´': 'factory',
                    'Â∑•Â†¥': 'factory'  // Áü≠Á∏ÆÂΩ¢„ÇÇ„Çµ„Éù„Éº„Éà
                };
                propertyTypes.forEach(type => {
                    const value = propertyMap[type];
                    if (value) {
                        // Êñ∞„Åó„ÅÑ„Çª„ÇØ„Ç∑„Éß„É≥ÊßãÈÄ†„Å®Âè§„ÅÑÊßãÈÄ†„ÅÆ‰∏°Êñπ„Çí„Çµ„Éù„Éº„Éà
                        let checkbox = null;
                        if (propertyTypesSection) {
                            checkbox = propertyTypesSection.querySelector(`input[name="propertyType"][value="${value}"]`);
                        }
                        if (!checkbox && autodeliverySection) {
                            checkbox = autodeliverySection.querySelector(`input[name="propertyType"][value="${value}"]`);
                        }
                        if (!checkbox) {
                            checkbox = document.querySelector(`input[name="propertyType"][value="${value}"]`);
                        }

                        if (checkbox) {
                            checkbox.checked = true;
                            console.log('[loadAutodeliverySettings] Checked property type:', type, '‚Üí', value);
                        } else {
                            console.warn('[loadAutodeliverySettings] Checkbox not found for:', type, '‚Üí', value);
                        }
                    } else {
                        console.warn('[loadAutodeliverySettings] No mapping for:', type);
                    }
                });
            }

            // ÊúÄÂ§ßÂØæÂøúÈöéÊï∞Ôºà‰æã: "Êà∏Âª∫„Å¶‰ΩèÂÆÖ(3Èöé„Åæ„Åß),„Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥(3Èöé„Åæ„Åß)"Ôºâ
            if (data['ÊúÄÂ§ßÂØæÂøúÈöéÊï∞']) {
                let maxFloorsData = data['ÊúÄÂ§ßÂØæÂøúÈöéÊï∞'];
                console.log('[loadAutodeliverySettings] Raw max floors data:', maxFloorsData);

                // compressedÂΩ¢Âºè„ÅÆÂ†¥Âêà„ÅØfull„ÅÆÂÄ§„ÇíÊäΩÂá∫
                if (maxFloorsData.includes('{"type":"compressed","full":"')) {
                    const match = maxFloorsData.match(/"full":"([^"]+)"/);
                    if (match) {
                        maxFloorsData = match[1];
                        console.log('[loadAutodeliverySettings] Extracted max floors:', maxFloorsData);
                    }
                }

                console.log('[loadAutodeliverySettings] Final max floors data:', maxFloorsData);

                const propertyTypeMap = {
                    'Êà∏Âª∫„Å¶‰ΩèÂÆÖ': 'house',
                    '„Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥': 'apartment',
                    'Â∫óËàó„Éª‰∫ãÂãôÊâÄ': 'commercial',
                    'Â∑•Â†¥„ÉªÂÄâÂ∫´': 'factory'
                };

                // "Êà∏Âª∫„Å¶‰ΩèÂÆÖ(3Èöé„Åæ„Åß),„Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥(10Èöé‰ª•‰∏ä„Åæ„Åß)" „Çí„Éë„Éº„Çπ
                maxFloorsData.split(',').forEach(entry => {
                    const match = entry.trim().match(/^(.+?)\((.+?)„Åæ„Åß\)$/);
                    if (match) {
                        const propertyType = match[1];
                        const floorText = match[2]; // "3Èöé" or "10Èöé‰ª•‰∏ä" or "4Èöé‰ª•‰∏ä"
                        const checkboxValue = propertyTypeMap[propertyType];

                        if (checkboxValue) {
                            // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÇíË¶ã„Å§„Åë„Å¶„ÄÅ„Åù„ÅÆÈö£„ÅÆselect„ÇíÂèñÂæó
                            const checkbox = document.querySelector(`input[name="propertyType"][value="${checkboxValue}"]`);
                            if (checkbox) {
                                const label = checkbox.closest('label');
                                const select = label.querySelector('select');
                                if (select) {
                                    // option„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Åß‰∏ÄËá¥„Åô„Çã„ÇÇ„ÅÆ„ÇíÊé¢„Åô
                                    let matched = false;
                                    for (let i = 0; i < select.options.length; i++) {
                                        if (select.options[i].text === floorText) {
                                            select.selectedIndex = i;
                                            matched = true;
                                            console.log('[loadAutodeliverySettings] Set max floors:', propertyType, '=', floorText, '(option text match)');
                                            break;
                                        }
                                    }
                                    if (!matched) {
                                        console.warn('[loadAutodeliverySettings] No matching option for:', propertyType, floorText);
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // ÁØâÂπ¥Êï∞ÂØæÂøúÁØÑÂõ≤Ôºà‰æã: "{min=0, max=50}"Ôºâ
            if (data['ÁØâÂπ¥Êï∞ÂØæÂøúÁØÑÂõ≤']) {
                try {
                    const ageRange = data['ÁØâÂπ¥Êï∞ÂØæÂøúÁØÑÂõ≤'];
                    // JSONÈ¢®„ÅÆÊñáÂ≠óÂàó„Çí„Éë„Éº„Çπ
                    const minMatch = ageRange.match(/min=(\d+)/);
                    const maxMatch = ageRange.match(/max=(\d+)/);
                    if (minMatch && maxMatch) {
                        const min = parseInt(minMatch[1]);
                        const max = parseInt(maxMatch[1]);
                        document.getElementById('ageRangeMinAuto').textContent = min;
                        document.getElementById('ageRangeMaxAuto').textContent = max;

                        // „Çπ„É©„Ç§„ÉÄ„Éº„ÅÆÂÄ§„ÇÇË®≠ÂÆöÔºàmin/maxÂ±ûÊÄß„ÅßÁ¢∫ÂÆü„Å´Ë≠òÂà•Ôºâ
                        const minSlider = document.querySelector('#autodeliverySection input[type="range"][min="0"][max="50"]');
                        const maxSlider = document.querySelector('#autodeliverySection input[type="range"][min="0"][max="100"]');

                        console.log('[loadAutodeliverySettings] Found minSlider:', !!minSlider, 'maxSlider:', !!maxSlider);

                        if (minSlider && maxSlider) {
                            minSlider.value = min;
                            maxSlider.value = max;

                            console.log('[loadAutodeliverySettings] Set slider values - min:', min, 'max:', max);

                            // DOM„ÅåÂÆåÂÖ®„Å´Êõ¥Êñ∞„Åï„Çå„Å¶„Åã„Çâ„Ç§„Éô„É≥„Éà„ÇíÁô∫ÁÅ´
                            setTimeout(() => {
                                minSlider.dispatchEvent(new Event('input', { bubbles: true }));
                                maxSlider.dispatchEvent(new Event('input', { bubbles: true }));
                                minSlider.dispatchEvent(new Event('change', { bubbles: true }));
                                maxSlider.dispatchEvent(new Event('change', { bubbles: true }));

                                // Âº∑Âà∂ÁöÑ„Å´updateAgeRangeAuto()„ÇíÂëº„Å≥Âá∫„Åó
                                if (typeof updateAgeRangeAuto === 'function') {
                                    updateAgeRangeAuto();
                                }

                                console.log('[loadAutodeliverySettings] Triggered events and updateAgeRangeAuto');
                            }, 100);
                        } else {
                            console.error('[loadAutodeliverySettings] Sliders not found!');
                        }
                    }
                } catch (e) {
                    console.error('ÁØâÂπ¥Êï∞„Éë„Éº„Çπ„Ç®„É©„Éº:', e);
                }
            }

            // ÊñΩÂ∑•ÁÆáÊâÄÔºà„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆÂÄ§ ‚Üí HTML value „ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞Ôºâ
            if (data['ÊñΩÂ∑•ÁÆáÊâÄ']) {
                let locationsStr = data['ÊñΩÂ∑•ÁÆáÊâÄ'];
                console.log('[loadAutodeliverySettings] Raw construction types data:', locationsStr);

                // compressedÂΩ¢Âºè„ÅÆÂ†¥Âêà„ÅØfull„ÅÆÂÄ§„ÇíÊäΩÂá∫
                if (locationsStr.includes('{"type":"compressed","full":"')) {
                    const match = locationsStr.match(/"full":"([^"]+)"/);
                    if (match) {
                        locationsStr = match[1];
                        console.log('[loadAutodeliverySettings] Extracted full data:', locationsStr);
                    }
                }

                const locations = locationsStr.split(',').map(s => s.trim()).filter(l => l);
                console.log('[loadAutodeliverySettings] Parsed locations:', locations);

                // „Çπ„Éó„Ç∑„ÅÆÊñΩÂ∑•ÁÆáÊâÄ„Éá„Éº„Çø ‚Üí HTML„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπvalue„Å∏„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞
                // Êñ∞„Ç∑„Çπ„ÉÜ„É†: „Çπ„Éó„Ç∑„Å´„ÅØÂÆåÂÖ®„Å™ÂΩ¢Âºè„Åß‰øùÂ≠ò„Åï„Çå„Çã„Åü„ÇÅ„ÄÅÂü∫Êú¨ÁöÑ„Å´ÂÆåÂÖ®‰∏ÄËá¥
                // Êóß„Éá„Éº„Çø„Å®„ÅÆ‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅ„ÄÅÁï•Áß∞„Éû„ÉÉ„Éî„É≥„Ç∞„ÇÇ‰øùÊåÅ
                const locationMap = {
                    // ÂÆåÂÖ®‰∏ÄËá¥ÔºàÊñ∞„Éï„Ç©„Éº„Éû„ÉÉ„ÉàÔºâ- „Çπ„Éó„Ç∑„ÅÆÂÄ§ = HTML„ÅÆÂÄ§
                    'Â§ñÂ£ÅÂ°óË£Ö': 'Â§ñÂ£ÅÂ°óË£Ö',
                    'Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï': 'Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï',
                    'Â§ñÂ£ÅÂºµÊõø„Åà': 'Â§ñÂ£ÅÂºµÊõø„Åà',
                    'Â±ãÊ†πÂ°óË£ÖÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'Â±ãÊ†πÂ°óË£ÖÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â±ã‰∏äÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'Â±ã‰∏äÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚Äª„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠â': 'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚Äª„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠â',
                    'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚ÄªÁì¶': 'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚ÄªÁì¶',
                    'Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï': 'Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï',
                    'Â§ñÂ£ÅË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'Â§ñÂ£ÅË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â±ãÊ†πË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'Â±ãÊ†πË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'ÂÜÖË£ÖÊ∞¥Âõû„ÇäÔºà„Éê„Çπ„Éª„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éà„Ç§„É¨ÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'ÂÜÖË£ÖÊ∞¥Âõû„ÇäÔºà„Éê„Çπ„Éª„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éà„Ç§„É¨ÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'ÂÜÖË£ÖÔºà„Éï„É≠„Éº„É™„É≥„Ç∞„ÇÑÁï≥„Å™„Å©„ÅÆÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'ÂÜÖË£ÖÔºà„Éï„É≠„Éº„É™„É≥„Ç∞„ÇÑÁï≥„Å™„Å©„ÅÆÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÔºàÂ±ãÊ†πÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÔºàÂ±ãÊ†πÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â±ãÊ†πÂ°óË£ÖÂçòÂìÅ': 'Â±ãÊ†πÂ°óË£ÖÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â±ã‰∏äÈò≤Ê∞¥ÂçòÂìÅ': 'Â±ã‰∏äÈò≤Ê∞¥ÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â§ñÂ£ÅË£ú‰øÆÂçòÂìÅ': 'Â§ñÂ£ÅË£ú‰øÆÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â±ãÊ†πË£ú‰øÆÂçòÂìÅ': 'Â±ãÊ†πË£ú‰øÆÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÂçòÂìÅ': '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅ': 'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅ': 'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',

                    // Êóß„Éá„Éº„Çø„Å®„ÅÆ‰∫íÊèõÊÄßÔºàÁï•Áß∞ ‚Üí ÂÆåÂÖ®ÂêçÁß∞Ôºâ
                    'Â±ãÊ†πÂ°óË£Ö': 'Â±ãÊ†πÂ°óË£ÖÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â±ã‰∏äÈò≤Ê∞¥': 'Â±ã‰∏äÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â§ñÂ£ÅË£ú‰øÆ': 'Â§ñÂ£ÅË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â±ãÊ†πË£ú‰øÆ': 'Â±ãÊ†πË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥': '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'ÂÜÖË£ÖÊ∞¥Âõû„Çä': 'ÂÜÖË£ÖÊ∞¥Âõû„ÇäÔºà„Éê„Çπ„Éª„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éà„Ç§„É¨ÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'ÂÜÖË£Ö': 'ÂÜÖË£ÖÔºà„Éï„É≠„Éº„É™„É≥„Ç∞„ÇÑÁï≥„Å™„Å©„ÅÆÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπï': 'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÔºàÂ±ãÊ†πÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπï': 'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â±ãÊ†πÂºµ„ÇäÊõø„Åà„Éª„Ç´„Éê„Éº': 'Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï',
                    'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø': 'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚Äª„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠â',
                    'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà': 'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚Äª„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠â'
                };
                locations.forEach(loc => {
                    const mappedValue = locationMap[loc] || loc;
                    // Êñ∞„Åó„ÅÑ„Çª„ÇØ„Ç∑„Éß„É≥ÊßãÈÄ†„Å®Âè§„ÅÑÊßãÈÄ†„ÅÆ‰∏°Êñπ„Çí„Çµ„Éù„Éº„Éà
                    const constructionAreasSection = document.getElementById('constructionAreasSection');
                    let checkbox = null;
                    if (constructionAreasSection) {
                        checkbox = constructionAreasSection.querySelector(`input[name="constructionTypes"][value="${mappedValue}"]`);
                    }
                    if (!checkbox) {
                        checkbox = document.querySelector(`input[name="constructionTypes"][value="${mappedValue}"]`);
                    }

                    if (checkbox) {
                        checkbox.checked = true;
                        console.log('[loadAutodeliverySettings] Checked:', mappedValue);
                    } else {
                        console.warn('[loadAutodeliverySettings] Not found:', loc, '‚Üí', mappedValue);
                    }
                });
            }

            // ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆÔºà„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆÂÄ§ ‚Üí HTML value „ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞Ôºâ
            if (data['ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ']) {
                let specialStr = data['ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ'];
                console.log('[loadAutodeliverySettings] Raw special services data:', specialStr);

                // compressedÂΩ¢Âºè„ÅÆÂ†¥Âêà„ÅØfull„ÅÆÂÄ§„ÇíÊäΩÂá∫
                if (specialStr.includes('{"type":"compressed","full":"')) {
                    const match = specialStr.match(/"full":"([^"]+)"/);
                    if (match) {
                        specialStr = match[1];
                        console.log('[loadAutodeliverySettings] Extracted special services:', specialStr);
                    }
                }

                const specialItems = specialStr.split(',').map(s => s.trim()).filter(s => s);
                const specialMap = {
                    // ÂÆåÂÖ®‰∏ÄËá¥ÔºàÊñ∞„Éï„Ç©„Éº„Éû„ÉÉ„ÉàÔºâ - „Çπ„Éó„Ç∑„ÅÆÂÄ§ = HTML„ÅÆÂÄ§ÔºàÁµµÊñáÂ≠ó‰ªò„ÅçÔºâ
                    'ÈÅÆÁÜ±„ÉªÊñ≠ÁÜ±Â°óÊñôÊèêÊ°àÂèØËÉΩ': 'üå° ÈÅÆÁÜ±„ÉªÊñ≠ÁÜ±Â°óÊñôÊèêÊ°àÂèØËÉΩ',
                    'Á´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÊâãÊ∏°„ÅóÂ∏åÊúõ': 'üëÄ Á´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÊâãÊ∏°„ÅóÂ∏åÊúõ',
                    'ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÈÉµÈÄÅ„ÉªÈõªË©±„ÅßÂïÜË´áÂèØ': 'üìÆ ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÈÉµÈÄÅ„ÉªÈõªË©±„ÅßÂïÜË´áÂèØ',
                    '„Ç®„ÇØ„Çπ„ÉÜ„É™„Ç¢ÔºàÂ∫≠„ÉªÈßêËªäÂ†¥„ÉªÂ§ñÊßãÔºâ': 'üè° „Ç®„ÇØ„Çπ„ÉÜ„É™„Ç¢ÔºàÂ∫≠„ÉªÈßêËªäÂ†¥„ÉªÂ§ñÊßãÔºâ',
                    'Â§™ÈôΩÂÖâ„Éë„Éç„É´ËÑ±ÁùÄÔºàÊí§ÂéªÂê´„ÇÄÔºâ': '‚òÄÔ∏è Â§™ÈôΩÂÖâ„Éë„Éç„É´ËÑ±ÁùÄÔºàÊí§ÂéªÂê´„ÇÄÔºâ',
                    'ÊèêÊê∫ÂÖà„É≠„Éº„É≥Êúâ„Çä': 'üè¶ ÊèêÊê∫ÂÖà„É≠„Éº„É≥Êúâ„Çä',
                    '„ÇØ„É¨„Ç∏„ÉÉ„Éà„Ç´„Éº„ÉâÊâï„ÅÑÂèØ': 'üí≥ „ÇØ„É¨„Ç∏„ÉÉ„Éà„Ç´„Éº„ÉâÊâï„ÅÑÂèØ',
                    'ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà': 'üî• ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà',
                    'Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà': 'üí∞ Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà',
                    'Âª∫ÁØâË®±ÂèØË®º': 'üèó Âª∫ÁØâË®±ÂèØË®º',
                    'ÂÖâËß¶Â™íÂ°óÊñôÊèêÊ°àÂèØ': '‚ú® ÂÖâËß¶Â™íÂ°óÊñôÊèêÊ°àÂèØ',
                    'ÂàÜÂâ≤Êâï„ÅÑ„Éó„É©„É≥Êúâ': 'üí¥ ÂàÜÂâ≤Êâï„ÅÑ„Éó„É©„É≥Êúâ',

                    // Êóß„Éá„Éº„Çø„Å®„ÅÆ‰∫íÊèõÊÄßÔºàÊã¨Âºß„Å™„Åó ‚Üí Êã¨Âºß‰ªò„Åç„ÄÅ‰∏≠ÁÇπ„Å™„Åó ‚Üí ‰∏≠ÁÇπ„ÅÇ„ÇäÔºâ
                    'ÈÅÆÁÜ±Êñ≠ÁÜ±Â°óÊñôÊèêÊ°àÂèØËÉΩ': 'üå° ÈÅÆÁÜ±„ÉªÊñ≠ÁÜ±Â°óÊñôÊèêÊ°àÂèØËÉΩ',
                    'Á´ã„Å°‰ºö„ÅÑ„Å™„ÅóË¶ãÁ©ç„ÇÇ„ÇäÊâãÊ∏°': 'üëÄ Á´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÊâãÊ∏°„ÅóÂ∏åÊúõ',
                    'ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„ÅóË¶ãÁ©ç„ÇÇ„ÇäÈÉµÈÄÅ': 'üìÆ ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÈÉµÈÄÅ„ÉªÈõªË©±„ÅßÂïÜË´áÂèØ',
                    'ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„ÅóË¶ã': 'üìÆ ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÈÉµÈÄÅ„ÉªÈõªË©±„ÅßÂïÜË´áÂèØ',
                    '„Ç®„ÇØ„Çπ„ÉÜ„É™„Ç¢': 'üè° „Ç®„ÇØ„Çπ„ÉÜ„É™„Ç¢ÔºàÂ∫≠„ÉªÈßêËªäÂ†¥„ÉªÂ§ñÊßãÔºâ',
                    'Â§™ÈôΩÂÖâ„Éë„Éç„É´ËÑ±ÁùÄ': '‚òÄÔ∏è Â§™ÈôΩÂÖâ„Éë„Éç„É´ËÑ±ÁùÄÔºàÊí§ÂéªÂê´„ÇÄÔºâ'
                };
                specialItems.forEach(item => {
                    const mappedValue = specialMap[item] || item;
                    // Êñ∞„Åó„ÅÑ„Çª„ÇØ„Ç∑„Éß„É≥ÊßãÈÄ†„Å®Âè§„ÅÑÊßãÈÄ†„ÅÆ‰∏°Êñπ„Çí„Çµ„Éù„Éº„Éà
                    const specialServicesSection = document.getElementById('specialServicesSection');
                    let checkbox = null;
                    if (specialServicesSection) {
                        checkbox = specialServicesSection.querySelector(`input[name="specialServices"][value="${mappedValue}"]`);
                    }
                    if (!checkbox) {
                        checkbox = document.querySelector(`input[name="specialServices"][value="${mappedValue}"]`);
                    }

                    if (checkbox) {
                        checkbox.checked = true;
                        console.log('[loadAutodeliverySettings] Special checked:', mappedValue);
                    } else {
                        console.warn('[loadAutodeliverySettings] Special not found:', item);
                    }
                });

                // „Éó„É¨„Éì„É•„Éº„ÇíÊõ¥Êñ∞
                const previewFeaturesList = document.getElementById('previewFeaturesList');
                if (previewFeaturesList) {
                    previewFeaturesList.innerHTML = '';
                    const excludeItems = ['Á´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÊâãÊ∏°„ÅóÂ∏åÊúõ', 'ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÈÉµÈÄÅ„ÉªÈõªË©±„ÅßÂïÜË´áÂèØ'];

                    const colors = [
                        'from-blue-50 to-blue-100',
                        'from-purple-50 to-purple-100',
                        'from-green-50 to-green-100',
                        'from-pink-50 to-pink-100',
                        'from-yellow-50 to-yellow-100',
                        'from-indigo-50 to-indigo-100'
                    ];

                    let colorIndex = 0;
                    specialItems.forEach(item => {
                        const mappedValue = specialMap[item] || item;

                        // Èô§Â§ñÈ†ÖÁõÆ„Çí„Çπ„Ç≠„ÉÉ„Éó
                        if (excludeItems.some(excludeItem => mappedValue.includes(excludeItem))) {
                            return;
                        }

                        // ÁµµÊñáÂ≠ó„Å®„ÉÜ„Ç≠„Çπ„Éà„ÇíÂàÜÈõ¢
                        const parts = mappedValue.split(' ');
                        const emoji = parts[0];
                        const text = parts.slice(1).join(' ');

                        const div = document.createElement('div');
                        div.className = `bg-gradient-to-br ${colors[colorIndex % colors.length]} rounded-xl p-4`;
                        div.innerHTML = `
                            <div class="text-3xl mb-2">${emoji}</div>
                            <h4 class="font-semibold text-gray-900 mb-1">${text}</h4>
                        `;
                        previewFeaturesList.appendChild(div);
                        colorIndex++;
                    });

                    // Âº∑„Åø„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„Åø„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
                    const featuresSection = document.getElementById('preview-features');
                    if (featuresSection) {
                        featuresSection.style.display = previewFeaturesList.children.length > 0 ? 'block' : 'none';
                    }
                }
            }

            // ÂØæÂøúÈÉΩÈÅìÂ∫úÁúå„ÉªÂ∏ÇÂå∫Áî∫Êùë„Çí„É≠„Éº„Éâ
            if (data['ÂØæÂøúÈÉΩÈÅìÂ∫úÁúå']) {
                let prefecturesStr = data['ÂØæÂøúÈÉΩÈÅìÂ∫úÁúå'];
                console.log('[loadAutodeliverySettings] Raw prefectures data:', prefecturesStr);

                // compressedÂΩ¢Âºè„ÅÆÂ†¥Âêà„ÅØfull„ÅÆÂÄ§„ÇíÊäΩÂá∫
                if (prefecturesStr.includes('{"type":"compressed","full":"')) {
                    const match = prefecturesStr.match(/"full":"([^"]+)"/);
                    if (match) {
                        prefecturesStr = match[1];
                        console.log('[loadAutodeliverySettings] Extracted prefectures:', prefecturesStr);
                    }
                }

                // ÂÖ®Ëßí„ÉªÂçäËßí„Ç´„É≥„Éû„ÅÆ‰∏°Êñπ„Å´ÂØæÂøú
                const prefectures = prefecturesStr.split(/[,„ÄÅ]/).map(s => s.trim()).filter(s => s);
                window.areaSelectionData.prefectures = prefectures;

                // ÈÉΩÈÅìÂ∫úÁúå„Éú„Çø„É≥„ÇíÈÅ∏ÊäûÁä∂ÊÖã„Å´„Åô„Çã
                prefectures.forEach(pref => {
                    const button = document.querySelector(`button[data-prefecture="${pref}"]`);
                    if (button) {
                        button.classList.add('selected', 'bg-blue-500', 'text-white');
                        button.classList.remove('bg-white');
                    }
                });

                console.log('[loadAutodeliverySettings] Loaded prefectures:', prefectures);
            }

            if (data['ÂØæÂøúÂ∏ÇÂå∫Áî∫Êùë']) {
                try {
                    let citiesStr = data['ÂØæÂøúÂ∏ÇÂå∫Áî∫Êùë'];

                    // compressedÂΩ¢Âºè„ÅÆÂ†¥Âêà„ÅØfull„ÅÆÂÄ§„ÇíÊäΩÂá∫
                    if (citiesStr.includes('{"type":"compressed"')) {
                        try {
                            const jsonData = JSON.parse(citiesStr);
                            if (jsonData.full && jsonData.full.trim() !== '') {
                                citiesStr = jsonData.full;
                            } else if (jsonData.preview && jsonData.preview.trim() !== '') {
                                citiesStr = jsonData.preview;
                            } else {
                                citiesStr = ''; // Á©∫ÊñáÂ≠óÂàó„Å´Ë®≠ÂÆö
                            }
                        } catch (e) {
                            console.error('[loadAutodeliverySettings] Failed to parse compressed JSON:', e);
                            // fallback to regex parsing
                            const match = citiesStr.match(/"full":"([^"]+)"/);
                            if (match) {
                                citiesStr = match[1];
                            }
                        }
                    }

                    // „Éá„Éº„ÇøÂΩ¢Âºè„ÉÅ„Çß„ÉÉ„ÇØ: „Çª„Éü„Ç≥„É≠„É≥„Åå„ÅÇ„Çå„Å∞ "Êù±‰∫¨ÈÉΩ:Ê∏ãË∞∑Âå∫,Êñ∞ÂÆøÂå∫;Á•ûÂ•àÂ∑ùÁúå:Ê®™ÊµúÂ∏Ç,Â∑ùÂ¥éÂ∏Ç" ÂΩ¢Âºè
                    // „Çª„Éü„Ç≥„É≠„É≥„Åå„Å™„Åë„Çå„Å∞„ÄÅÂçòÁ¥î„Å™„Ç´„É≥„ÉûÂå∫Âàá„Çä„É™„Çπ„ÉàÔºàÈÉΩÈÅìÂ∫úÁúåÊÉÖÂ†±„Å™„ÅóÔºâ
                    if (citiesStr.includes(';') && citiesStr.includes(':')) {
                        // „Çª„Éü„Ç≥„É≠„É≥Âå∫Âàá„Çä„ÅßÈÉΩÈÅìÂ∫úÁúå„Åî„Å®„Å´ÂàÜÂâ≤
                        citiesStr.split(';').forEach(prefEntry => {
                            const parts = prefEntry.split(':');
                            if (parts.length === 2) {
                                const pref = parts[0].trim();
                                const citiesStr = parts[1].trim();
                                if (pref && citiesStr) {
                                    // ÂÖ®Ëßí„ÉªÂçäËßí„Ç´„É≥„Éû„ÅÆ‰∏°Êñπ„Å´ÂØæÂøú
                                    const cities = citiesStr.split(/[,„ÄÅ]/).map(s => s.trim()).filter(c => c);
                                    if (cities.length > 0) {
                                        window.areaSelectionData.cities[pref] = cities;
                                        console.log(`[loadAutodeliverySettings] ${pref}:`, cities);
                                    }
                                }
                            }
                        });
                    } else {
                        // ÈÉΩÈÅìÂ∫úÁúåÊÉÖÂ†±„Åå„Å™„ÅÑÂ†¥Âêà ‚Üí Êñ∞„Åó„ÅÑ„É≠„Ç∏„ÉÉ„ÇØ: „Éá„Éº„Çø„Éô„Éº„Çπ„Åã„ÇâÂ∏ÇÂå∫Áî∫Êùë„ÇíÂæ©ÂÖÉ
                        // ÂÖ®Ëßí„ÉªÂçäËßí„Ç´„É≥„Éû„ÅÆ‰∏°Êñπ„Å´ÂØæÂøú
                        const allCities = citiesStr.split(/[,„ÄÅ]/).map(s => s.trim()).filter(c => c);
                        console.log('[loadAutodeliverySettings] Parsed cities (unstructured):', allCities.length, 'cities');
                        console.log('[loadAutodeliverySettings] Current prefectures:', window.areaSelectionData.prefectures);

                        if (allCities.length > 0 && window.areaSelectionData.prefectures.length > 0) {
                            console.log('[loadAutodeliverySettings] Â∏ÇÂå∫Áî∫Êùë„ÇíÈÉΩÈÅìÂ∫úÁúåÂà•„Å´ÂÜç„Éû„ÉÉ„Éî„É≥„Ç∞‰∏≠...');
                            // ÂêÑÈÉΩÈÅìÂ∫úÁúå„ÅÆÂ∏ÇÂå∫Áî∫Êùë„Éá„Éº„Çø„Éô„Éº„Çπ„Åã„Çâ„ÄÅ‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„ÇãÂ∏ÇÂå∫Áî∫Êùë„ÇíÊäΩÂá∫
                            window.areaSelectionData.prefectures.forEach(pref => {
                                const dbCities = getCitiesForPrefecture(pref);
                                const matchedCities = allCities.filter(city => dbCities.includes(city));
                                if (matchedCities.length > 0) {
                                    window.areaSelectionData.cities[pref] = matchedCities;
                                    console.log(`[loadAutodeliverySettings] ${pref}: ${matchedCities.length} cities matched`);
                                } else {
                                    console.warn(`[loadAutodeliverySettings] ${pref}: No matching cities found`);
                                }
                            });
                        } else {
                            console.error('[loadAutodeliverySettings] Cannot assign cities: allCities.length =', allCities.length, ', prefectures.length =', window.areaSelectionData.prefectures.length);

                            // üöÄ Á∑äÊÄ•‰øÆÊ≠£: ÂÑ™ÂÖà„Ç®„É™„Ç¢„Éá„Éº„Çø„Åã„ÇâÂ∏ÇÂå∫Áî∫Êùë„ÇíÂæ©ÂÖÉ
                            if (window.areaSelectionData.priorities && window.areaSelectionData.priorities.length > 0) {
                                console.log('[loadAutodeliverySettings] üöÄ ÂÑ™ÂÖà„Ç®„É™„Ç¢„Åã„ÇâÂ∏ÇÂå∫Áî∫Êùë„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ‰∏≠...');
                                window.areaSelectionData.priorities.forEach(priority => {
                                    const parts = priority.split('_');
                                    if (parts.length === 2) {
                                        const pref = parts[0];
                                        const city = parts[1];
                                        if (!window.areaSelectionData.cities[pref]) {
                                            window.areaSelectionData.cities[pref] = [];
                                        }
                                        if (!window.areaSelectionData.cities[pref].includes(city)) {
                                            window.areaSelectionData.cities[pref].push(city);
                                            console.log(`[loadAutodeliverySettings] üöÄ Âæ©ÂÖÉ: ${pref} ‚Üí ${city}`);
                                        }
                                    }
                                });
                            }
                        }
                    }


                    console.log('[loadAutodeliverySettings] Loaded cities:', window.areaSelectionData.cities);
                } catch (e) {
                    console.error('Â∏ÇÂå∫Áî∫Êùë„Éë„Éº„Çπ„Ç®„É©„Éº:', e);
                }
            }

            // ÂÑ™ÂÖà„Ç®„É™„Ç¢„Çí„É≠„Éº„Éâ
            if (data['ÂÑ™ÂÖà„Ç®„É™„Ç¢']) {
                try {
                    let prioritiesStr = data['ÂÑ™ÂÖà„Ç®„É™„Ç¢'];
                    console.log('[loadAutodeliverySettings] Raw priorities data:', prioritiesStr);

                    // compressedÂΩ¢Âºè„ÅÆÂ†¥Âêà„ÅØfull„ÅÆÂÄ§„ÇíÊäΩÂá∫
                    if (prioritiesStr.includes('{"type":"compressed","full":"')) {
                        const match = prioritiesStr.match(/"full":"([^"]+)"/);
                        if (match) {
                            prioritiesStr = match[1];
                            console.log('[loadAutodeliverySettings] Extracted priorities:', prioritiesStr);
                        }
                    }

                    // ÂÖ®Ëßí„ÉªÂçäËßí„Ç´„É≥„Éû„ÅÆ‰∏°Êñπ„Å´ÂØæÂøú
                    const priorities = prioritiesStr.split(/[,„ÄÅ]/).map(s => s.trim()).filter(p => p);

                    // „Çπ„Éó„Ç∑„ÅÆ„Éá„Éº„ÇøÂΩ¢Âºè„Å´Âøú„Åò„Å¶Â§âÊèõ
                    // "Êù±‰∫¨ÈÉΩ Ê∏ãË∞∑Âå∫" ÂΩ¢Âºè ‚Üí "Êù±‰∫¨ÈÉΩ_Ê∏ãË∞∑Âå∫" „Å´Â§âÊèõ
                    // "Êù±‰∫¨ÈÉΩ_Ê∏ãË∞∑Âå∫" ÂΩ¢Âºè ‚Üí „Åù„ÅÆ„Åæ„Åæ‰ΩøÁî®
                    window.areaSelectionData.priorities = priorities.map(p => {
                        if (p.includes('_')) {
                            return p; // „Åô„Åß„Å´„Ç¢„É≥„ÉÄ„Éº„Çπ„Ç≥„Ç¢ÂΩ¢Âºè
                        } else {
                            return p.replace(/\s+/, '_'); // „Çπ„Éö„Éº„Çπ„Çí„Ç¢„É≥„ÉÄ„Éº„Çπ„Ç≥„Ç¢„Å´Â§âÊèõ
                        }
                    });

                    // ÂÑ™ÂÖà„Ç®„É™„Ç¢„Åã„ÇâÂ∏ÇÂå∫Áî∫Êùë„Éá„Éº„Çø„ÇíË®≠ÂÆö
                    window.areaSelectionData.priorities.forEach(priority => {
                        const parts = priority.split('_');
                        if (parts.length === 2) {
                            const pref = parts[0];
                            const city = parts[1];
                            if (!window.areaSelectionData.cities[pref]) {
                                window.areaSelectionData.cities[pref] = [];
                            }
                            if (!window.areaSelectionData.cities[pref].includes(city)) {
                                window.areaSelectionData.cities[pref].push(city);
                            }
                        }
                    });

                    console.log('[loadAutodeliverySettings] Loaded priorities:', window.areaSelectionData.priorities);
                } catch (e) {
                    console.error('ÂÑ™ÂÖà„Ç®„É™„Ç¢„Éë„Éº„Çπ„Ç®„É©„Éº:', e);
                }
            }

            // „Ç®„É™„Ç¢ÈÅ∏ÊäûUI„ÇíÊõ¥Êñ∞
            if (window.areaSelectionData.prefectures.length > 0) {
                updateAreaSelectionUI();
            }

            // ÂÑ™ÂÖà„Ç®„É™„Ç¢„Ç´„Ç¶„É≥„Çø„Éº„ÇíÊõ¥Êñ∞
            const selectedPriorityCount = document.getElementById('selectedPriorityCount');
            if (selectedPriorityCount && window.areaSelectionData.priorities) {
                selectedPriorityCount.textContent = window.areaSelectionData.priorities.length;
                console.log('[loadAutodeliverySettings] Updated priority count:', window.areaSelectionData.priorities.length);
            }

            console.log('[loadAutodeliverySettings] Final areaSelectionData:', JSON.stringify(window.areaSelectionData, null, 2));

            // „Éó„É¨„Éì„É•„Éº„Å´ÂØæÂøú„Ç®„É™„Ç¢„ÇíÂèçÊò†
            const previewCitiesContainer = document.getElementById('previewCitiesContainer');

            if (previewCitiesContainer && window.areaSelectionData.prefectures && window.areaSelectionData.prefectures.length > 0) {
                previewCitiesContainer.innerHTML = '';

                window.areaSelectionData.prefectures.forEach((pref, index) => {
                    const cities = window.areaSelectionData.cities[pref];
                    if (cities && cities.length > 0) {
                        const prefDiv = document.createElement('div');
                        prefDiv.className = index < window.areaSelectionData.prefectures.length - 1 ? 'mb-6 pb-6 border-b border-gray-200' : 'mb-0';
                        prefDiv.innerHTML = `
                            <div class="flex items-center mb-3">
                                <span class="text-base font-bold text-blue-600">${pref}</span>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                ${cities.map(city => `<span class="px-3 py-1.5 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg text-sm transition">${city}</span>`).join('')}
                            </div>
                        `;
                        previewCitiesContainer.appendChild(prefDiv);
                    }
                });

                console.log('[loadAutodeliverySettings] Updated preview areas for', window.areaSelectionData.prefectures.length, 'prefectures');
            }

            // „Éó„É¨„Éì„É•„Éº„Å´ÂØæÂøúÂèØËÉΩ„Å™Â∑•‰∫ã„ÇíÂèçÊò†
            const previewServicesList = document.getElementById('previewServicesList');
            const serviceIconMap = {
                'Â§ñÂ£ÅÂ°óË£Ö': 'üé®',
                'Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï': 'üèóÔ∏è',
                'Â§ñÂ£ÅÂºµÊõø„Åà': 'üî®',
                'Â±ãÊ†πÂ°óË£ÖÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üè†',
                'Â±ã‰∏äÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üíß',
                'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚Äª„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠â': 'üèöÔ∏è',
                'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚ÄªÁì¶': 'üèØ',
                'Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï': 'üìê',
                'Â§ñÂ£ÅË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üîß',
                'Â±ãÊ†πË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üõ†Ô∏è',
                '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üåä',
                'ÂÜÖË£ÖÊ∞¥Âõû„ÇäÔºà„Éê„Çπ„Éª„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éà„Ç§„É¨ÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üöø',
                'ÂÜÖË£ÖÔºà„Éï„É≠„Éº„É™„É≥„Ç∞„ÇÑÁï≥„Å™„Å©„ÅÆÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üè°',
                'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': '‚òî',
                'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÔºàÂ±ãÊ†πÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üåßÔ∏è'
            };

            if (previewServicesList) {
                previewServicesList.innerHTML = '';
                const checkedServices = document.querySelectorAll('input[name="constructionTypes"]:checked');

                if (checkedServices.length > 0) {
                    checkedServices.forEach(service => {
                        const serviceName = service.value;

                        // ÂçòÂìÅÈ†ÖÁõÆÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ„Çí„Éó„É¨„Éì„É•„Éº„Åã„ÇâÈô§Â§ñ
                        if (serviceName.includes('Ôºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ')) {
                            return;
                        }

                        // Ë°®Á§∫Âêç„Åã„ÇâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ„ÇíÂâäÈô§
                        const displayName = serviceName.replace('ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ', '');
                        const icon = serviceIconMap[serviceName] || '‚úì';
                        const div = document.createElement('div');
                        div.className = 'bg-white border border-green-200 rounded-lg p-3 flex items-center hover:shadow-md transition';
                        div.innerHTML = `
                            <span class="text-2xl mr-2">${icon}</span>
                            <span class="text-sm font-medium text-gray-800">${displayName}</span>
                        `;
                        previewServicesList.appendChild(div);
                    });
                    document.getElementById('preview-services').style.display = 'block';
                    console.log('[loadAutodeliverySettings] Updated preview services:', checkedServices.length);
                } else {
                    document.getElementById('preview-services').style.display = 'none';
                }
            }

            // ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„ÇíË™≠„ÅøËæº„Åø

            const autoPauseToggle = document.getElementById('autoPauseToggle');
            const pauseStartDate = document.getElementById('pauseStartDate');
            const pauseEndDate = document.getElementById('pauseEndDate');
            const indefinitePause = document.getElementById('indefinitePause');
            const pauseSettings = document.getElementById('pauseSettings');

            console.log('[loadAutodeliverySettings] üîç DOMË¶ÅÁ¥†ÂèñÂæóÁµêÊûú:', {
                autoPauseToggle: !!autoPauseToggle,
                pauseStartDate: !!pauseStartDate,
                pauseEndDate: !!pauseEndDate,
                indefinitePause: !!indefinitePause,
                pauseSettings: !!pauseSettings
            });

            // ‰∏ÄÊôÇÂÅúÊ≠¢„Éï„É©„Ç∞„ÇíË™≠„ÅøËæº„ÅøÔºàundefined„ÅÆÂ†¥Âêà„ÅØFALSE„Å®„Åó„Å¶Êâ±„ÅÜÔºâ
            // üî• FIX: „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„ÅÆÂÄ§„ÇíÂÑ™ÂÖàÔºàGASË™≠„ÅøËæº„Åø‰∏çÊï¥Âêà„ÅÆÂØæÁ≠ñÔºâ
            let pauseFlag = data['‰∏ÄÊôÇÂÅúÊ≠¢„Éï„É©„Ç∞'] === 'TRUE' || data['‰∏ÄÊôÇÂÅúÊ≠¢„Éï„É©„Ç∞'] === 'true' || data['‰∏ÄÊôÇÂÅúÊ≠¢„Éï„É©„Ç∞'] === true ||
                            data['pauseFlag'] === 'TRUE' || data['pauseFlag'] === 'true' || data['pauseFlag'] === true;

            // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„Çâ‰øùÂ≠òÁä∂ÊÖã„ÇíÁ¢∫Ë™ç
            console.log('[loadAutodeliverySettings] üîç merchantId check:', window.merchantId);
            if (window.merchantId) {
                console.log('[loadAutodeliverySettings] üîç Checking localStorage for key:', `pauseSettings_${window.merchantId}`);
                const savedPauseState = localStorage.getItem(`pauseSettings_${window.merchantId}`);
                console.log('[loadAutodeliverySettings] üîç localStorage result:', savedPauseState);
                if (savedPauseState) {
                    try {
                        const parsedState = JSON.parse(savedPauseState);
                        console.log('[loadAutodeliverySettings] üî• Found localStorage pause state:', parsedState);

                        // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„ÅÆÂÄ§„ÇíÂÑ™ÂÖàÔºà„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàË™≠„ÅøËæº„Åø‰∏çÊï¥Âêà„ÅÆÂØæÁ≠ñÔºâ
                        if (parsedState.pauseFlag !== undefined) {
                            pauseFlag = parsedState.pauseFlag;
                            console.log('[loadAutodeliverySettings] üî• Using localStorage pauseFlag:', pauseFlag);
                        }
                    } catch (e) {
                        console.warn('[loadAutodeliverySettings] Failed to parse localStorage pause state:', e);
                    }
                }
            }
            console.log('[loadAutodeliverySettings] Pause flag from sheet:', data['‰∏ÄÊôÇÂÅúÊ≠¢„Éï„É©„Ç∞'], '‚Üí', pauseFlag);
            console.log('[loadAutodeliverySettings] Pause start date raw:', data['‰∏ÄÊôÇÂÅúÊ≠¢ÈñãÂßãÊó•']);
            console.log('[loadAutodeliverySettings] Pause end date raw:', data['‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñã‰∫àÂÆöÊó•']);

            if (autoPauseToggle) {
                console.log('[loadAutodeliverySettings] üîç „Éà„Ç∞„É´„Çπ„Ç§„ÉÉ„ÉÅË®≠ÂÆöÂâç:', {
                    pauseFlag: pauseFlag,
                    currentChecked: autoPauseToggle.checked,
                    elementId: autoPauseToggle.id
                });

                autoPauseToggle.checked = pauseFlag;

                console.log('[loadAutodeliverySettings] üîç „Éà„Ç∞„É´„Çπ„Ç§„ÉÉ„ÉÅË®≠ÂÆöÂæå:', {
                    pauseFlag: pauseFlag,
                    newChecked: autoPauseToggle.checked,
                    success: autoPauseToggle.checked === pauseFlag
                });

                // „Éà„Ç∞„É´Áä∂ÊÖã„Å´Âøú„Åò„Å¶Ë®≠ÂÆöÊ¨Ñ„ÅÆË°®Á§∫„ÉªÈùûË°®Á§∫„ÇíÂà∂Âæ°
                const pauseSettings = document.getElementById('pauseSettings');
                if (pauseSettings) {
                    if (pauseFlag) {
                        pauseSettings.classList.remove('hidden');
                        console.log('[loadAutodeliverySettings] ‚úÖ ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„ÇíË°®Á§∫');
                    } else {
                        pauseSettings.classList.add('hidden');
                        console.log('[loadAutodeliverySettings] ‚ùå ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„ÇíÈùûË°®Á§∫');
                    }
                }
            } else {
                console.log('[loadAutodeliverySettings] ‚ùå autoPauseToggleË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
            }

            // ‰∏ÄÊôÇÂÅúÊ≠¢ÈñãÂßãÊó•ÔºàAPÂàóÔºâ- „Éï„É©„Ç∞„Å´Èñ¢„Çè„Çâ„ÅöÂ∏∏„Å´„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÇÄ
            if (data['‰∏ÄÊôÇÂÅúÊ≠¢ÈñãÂßãÊó•'] && pauseStartDate) {
                let startDateValue = data['‰∏ÄÊôÇÂÅúÊ≠¢ÈñãÂßãÊó•'];

                // Êßò„ÄÖ„Å™Êó•‰ªò„Éï„Ç©„Éº„Éû„ÉÉ„Éà„Çí yyyy-MM-dd „Å´Â§âÊèõÔºàÊó•Êú¨ÊôÇÈñì„ÅßÂá¶ÁêÜÔºâ
                if (typeof startDateValue === 'string') {
                    // ISO 8601ÂΩ¢Âºè (2025-10-03T15:00:00.000Z) „ÅÆÂ†¥Âêà„ÄÅDate„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Å´Â§âÊèõ„Åó„Å¶„Åã„ÇâÊó•Êú¨ÊôÇÈñì„ÅßÂèñÂæó
                    if (startDateValue.includes('T') || startDateValue.includes('Z')) {
                        const dateObj = new Date(startDateValue);
                        const year = dateObj.getFullYear();
                        const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                        const day = String(dateObj.getDate()).padStart(2, '0');
                        startDateValue = `${year}-${month}-${day}`;
                    }
                    // "yyyy-MM-dd HH:mm" ÂΩ¢Âºè„Çí yyyy-MM-dd „Å´Â§âÊèõ
                    else if (startDateValue.includes(' ')) {
                        startDateValue = startDateValue.split(' ')[0];
                    }
                    // "yyyy/MM/dd" ÂΩ¢Âºè„Çí yyyy-MM-dd „Å´Â§âÊèõ
                    else if (startDateValue.includes('/')) {
                        startDateValue = startDateValue.replace(/\//g, '-');
                    }
                } else if (startDateValue instanceof Date) {
                    // Date„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅÆÂ†¥Âêà
                    const year = startDateValue.getFullYear();
                    const month = String(startDateValue.getMonth() + 1).padStart(2, '0');
                    const day = String(startDateValue.getDate()).padStart(2, '0');
                    startDateValue = `${year}-${month}-${day}`;
                }

                pauseStartDate.value = startDateValue;
                console.log('[loadAutodeliverySettings] Pause start date set:', startDateValue);
            } else {
                console.warn('[loadAutodeliverySettings] Pause start date not found in data or element missing');
            }

            // ‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñã‰∫àÂÆöÊó•ÔºàAQÂàóÔºâ- „Éï„É©„Ç∞„Å´Èñ¢„Çè„Çâ„ÅöÂ∏∏„Å´„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÇÄ
            if (data['‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñã‰∫àÂÆöÊó•']) {
                if (data['‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñã‰∫àÂÆöÊó•'] === 'Êú™ÂÆö') {
                    if (indefinitePause) {
                        indefinitePause.checked = true;
                    }
                    if (pauseEndDateDisplay) {
                        pauseEndDateDisplay.value = 'Êú™ÂÆö';
                        pauseEndDateDisplay.classList.remove('hidden');
                    }
                    if (pauseEndDate) {
                        pauseEndDate.classList.add('hidden');
                        pauseEndDate.value = '';
                    }
                    console.log('[loadAutodeliverySettings] Pause end date: Êú™ÂÆö (from spreadsheet)');
                } else {
                    // Êó•‰ªòÂΩ¢Âºè„ÅÆÂ§âÊèõÔºàÊó•Êú¨ÊôÇÈñì„ÅßÂá¶ÁêÜÔºâ
                    let endDateValue = data['‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñã‰∫àÂÆöÊó•'];

                    if (typeof endDateValue === 'string') {
                        // ISO 8601ÂΩ¢Âºè (2025-10-03T15:00:00.000Z) „ÅÆÂ†¥Âêà„ÄÅDate„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Å´Â§âÊèõ„Åó„Å¶„Åã„ÇâÊó•Êú¨ÊôÇÈñì„ÅßÂèñÂæó
                        if (endDateValue.includes('T') || endDateValue.includes('Z')) {
                            const dateObj = new Date(endDateValue);
                            const year = dateObj.getFullYear();
                            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                            const day = String(dateObj.getDate()).padStart(2, '0');
                            endDateValue = `${year}-${month}-${day}`;
                        }
                        // "yyyy-MM-dd HH:mm" ÂΩ¢Âºè„Çí yyyy-MM-dd „Å´Â§âÊèõ
                        else if (endDateValue.includes(' ')) {
                            endDateValue = endDateValue.split(' ')[0];
                        }
                        // "yyyy/MM/dd" ÂΩ¢Âºè„Çí yyyy-MM-dd „Å´Â§âÊèõ
                        else if (endDateValue.includes('/')) {
                            endDateValue = endDateValue.replace(/\//g, '-');
                        }
                    } else if (endDateValue instanceof Date) {
                        // Date„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅÆÂ†¥Âêà
                        const year = endDateValue.getFullYear();
                        const month = String(endDateValue.getMonth() + 1).padStart(2, '0');
                        const day = String(endDateValue.getDate()).padStart(2, '0');
                        endDateValue = `${year}-${month}-${day}`;
                    }

                    if (pauseEndDate) {
                        pauseEndDate.value = endDateValue;
                        pauseEndDate.classList.remove('hidden');
                    }
                    if (pauseEndDateDisplay) {
                        pauseEndDateDisplay.classList.add('hidden');
                    }
                    if (indefinitePause) {
                        indefinitePause.checked = false;
                    }
                    console.log('[loadAutodeliverySettings] Pause end date set:', endDateValue);
                }
            } else {
                console.warn('[loadAutodeliverySettings] Pause end date not found in data');
            }

            // ‰∏ÄÊôÇÊ≠¢Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆË°®Á§∫/ÈùûË°®Á§∫
            if (pauseFlag && pauseSettings) {
                pauseSettings.classList.remove('hidden');
            } else if (pauseSettings) {
                pauseSettings.classList.add('hidden');
            }

            console.log('[loadAutodeliverySettings] Settings loaded');

            // V1703-FIX: „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âü∫„Å•„ÅÑ„Å¶pauseStatusDisplay„ÇíÊõ¥Êñ∞
            const currentStatus = data['„Çπ„ÉÜ„Éº„Çø„Çπ'] || '„Ç¢„ÇØ„ÉÜ„Ç£„Éñ';
            if (typeof updatePauseStatus === 'function') {
                updatePauseStatus(currentStatus);
                console.log('[loadAutodeliverySettings] Updated pauseStatusDisplay to:', currentStatus);
            }

            // Èñ≤Ë¶ß„É¢„Éº„ÉâË°®Á§∫„ÇíÊõ¥Êñ∞
            updateViewData('pause');
            updateViewData('propertyTypes');
            updateViewData('constructionAreas');
            updateViewData('specialServices');
            updateViewData('serviceAreas');

            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†„Åó„Å¶Â§âÊõ¥„ÇíÊ§úÁü•
            attachAutodeliveryChangeListeners();

            // Ë™≠„ÅøËæº„ÅøÂÆå‰∫ÜÂæå„ÄÅÂ§âÊõ¥„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„ÉàÔºàË™≠„ÅøËæº„ÅøÊôÇ„ÅÆ„Ç§„Éô„É≥„ÉàÁô∫ÁÅ´„ÇíÁÑ°Ë¶ñÔºâ
            // setTimeout„ÅßÂ∞ë„ÅóÈÅÖÂª∂„Åï„Åõ„Å¶„ÄÅÂàùÊúüÂåñÊôÇ„ÅÆ„Ç§„Éô„É≥„ÉàÁô∫ÁÅ´„ÇíÁ¢∫ÂÆü„Å´ÁÑ°Ë¶ñ
            setTimeout(() => {
                resetAutodeliveryChanged();

                // Êñ∞„Åó„ÅÑ„Çª„ÇØ„Ç∑„Éß„É≥ÊßãÈÄ†„ÅÆÈñ≤Ë¶ß„É¢„Éº„ÉâË°®Á§∫„ÇíÊõ¥Êñ∞
                updateViewData('propertyTypes');
                updateViewData('constructionAreas');
                updateViewData('specialServices');
                updateViewData('serviceAreas');
            }, 100);
        }

        // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅÆÂÖ®ÂÖ•ÂäõË¶ÅÁ¥†„Å´Â§âÊõ¥Ê§úÁü•„É™„Çπ„Éä„Éº„ÇíËøΩÂä†
        function attachAutodeliveryChangeListeners() {
            console.log('[attachAutodeliveryChangeListeners] Attaching change listeners...');

            const autodeliverySection = document.getElementById('autodeliverySection');
            if (!autodeliverySection) {
                console.warn('[attachAutodeliveryChangeListeners] autodeliverySection not found');
                return;
            }

            // ÂÖ®„Å¶„ÅÆinputË¶ÅÁ¥†Ôºàcheckbox, radio, text, rangeÔºâ
            const inputs = autodeliverySection.querySelectorAll('input');
            inputs.forEach(input => {
                // input„Å®change„ÅÆ‰∏°Êñπ„ÇíÁõ£Ë¶ñÔºàrange„ÅØinput„ÄÅcheckbox„ÅØchangeÔºâ
                input.addEventListener('input', markAutodeliveryChanged);
                input.addEventListener('change', markAutodeliveryChanged);
            });

            // ÂÖ®„Å¶„ÅÆselectË¶ÅÁ¥†
            const selects = autodeliverySection.querySelectorAll('select');
            selects.forEach(select => {
                select.addEventListener('change', markAutodeliveryChanged);
            });

            // ÂÖ®„Å¶„ÅÆtextareaË¶ÅÁ¥†
            const textareas = autodeliverySection.querySelectorAll('textarea');
            textareas.forEach(textarea => {
                textarea.addEventListener('input', markAutodeliveryChanged);
            });

            // ÈÉΩÈÅìÂ∫úÁúå„ÉªÂ∏ÇÂå∫Áî∫Êùë„Éú„Çø„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØ
            const prefButtons = autodeliverySection.querySelectorAll('button[data-prefecture]');
            prefButtons.forEach(button => {
                button.addEventListener('click', markAutodeliveryChanged);
            });

            console.log('[attachAutodeliveryChangeListeners] Attached listeners to:', {
                inputs: inputs.length,
                selects: selects.length,
                textareas: textareas.length,
                prefButtons: prefButtons.length
            });
        }

        // ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆöÈñ¢Êï∞ÔºàÂç≥ÊôÇÂèçÊò†Ôºâ
        async function toggleAutoPause() {
            const toggle = document.getElementById('autoPauseToggle');
            const settings = document.getElementById('pauseSettings');
            const startDate = document.getElementById('pauseStartDate');
            const endDate = document.getElementById('pauseEndDate');
            const indefinite = document.getElementById('indefinitePause');

            if (toggle.checked) {
                settings.classList.remove('hidden');
                // ÈñãÂßãÊó•„Çí‰ªäÊó•„Å´„Çª„ÉÉ„Éà
                if (startDate && !startDate.value) {
                    startDate.value = new Date().toISOString().split('T')[0];
                }
            } else {
                settings.classList.add('hidden');
                // „Éà„Ç∞„É´OFFÊôÇ„ÅØÊó•‰ªò„Çí„ÇØ„É™„Ç¢
                if (startDate) startDate.value = '';
                if (endDate) endDate.value = '';
                if (indefinite) indefinite.checked = false;
            }

            // Â§âÊõ¥„Éï„É©„Ç∞„ÇíÁ´ã„Å¶„ÇãÔºà‰øùÂ≠ò„Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ„Åß‰øùÂ≠ò„Åï„Çå„ÇãÔºâ
            markAutodeliveryChanged();
        }

        async function toggleIndefinitePause() {
            const indefinite = document.getElementById('indefinitePause');
            const endDateInput = document.getElementById('pauseEndDate');
            const endDateDisplay = document.getElementById('pauseEndDateDisplay');

            if (indefinite.checked) {
                // ÁÑ°ÊúüÈôêÂÅúÊ≠¢: „ÄåÊú™ÂÆö„Äç„Å®Ë°®Á§∫
                endDateDisplay.value = 'Êú™ÂÆö';
                endDateDisplay.classList.remove('hidden');
                endDateInput.classList.add('hidden');
                endDateInput.disabled = true;
                endDateInput.value = '';
            } else {
                // ÊúüÈôê„ÅÇ„Çä: Êó•‰ªòÂÖ•ÂäõÊ¨Ñ„ÇíË°®Á§∫
                endDateDisplay.classList.add('hidden');
                endDateInput.classList.remove('hidden');
                endDateInput.disabled = false;
            }

            // Â§âÊõ¥„Éï„É©„Ç∞„ÇíÁ´ã„Å¶„ÇãÔºà‰øùÂ≠ò„Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ„Åß‰øùÂ≠ò„Åï„Çå„ÇãÔºâ
            markAutodeliveryChanged();
        }

        // Á∑®ÈõÜ„É¢„Éº„ÉâÂ∞ÇÁî®Ôºö‰∏ÄÊôÇÂÅúÊ≠¢„Éà„Ç∞„É´Èñ¢Êï∞
        function toggleAutoPauseEdit() {
            const toggle = document.getElementById('autoPauseToggle');
            const settings = document.getElementById('pauseSettings');
            const startDate = document.getElementById('pauseStartDate');
            const endDate = document.getElementById('pauseEndDate');
            const indefinite = document.getElementById('indefinitePause');

            console.log('[toggleAutoPauseEdit] Toggle changed to:', toggle.checked);

            if (toggle.checked) {
                settings.classList.remove('hidden');
                // ÈñãÂßãÊó•„Çí‰ªäÊó•„Å´„Çª„ÉÉ„ÉàÔºàÁ©∫„ÅÆÂ†¥Âêà„ÅÆ„ÅøÔºâ
                if (startDate && !startDate.value) {
                    startDate.value = new Date().toISOString().split('T')[0];
                }
            } else {
                settings.classList.add('hidden');
                // „Éà„Ç∞„É´OFFÊôÇ„ÅØÊó•‰ªò„Çí„ÇØ„É™„Ç¢
                if (startDate) startDate.value = '';
                if (endDate) endDate.value = '';
                if (indefinite) indefinite.checked = false;
            }

            // Á∑®ÈõÜ„É¢„Éº„Éâ„ÅÆÂ§âÊõ¥„Éï„É©„Ç∞„ÇíÁ´ã„Å¶„Çã
            markAutodeliveryChanged();
        }

        // üî• ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆöÂ∞ÇÁî®‰øùÂ≠òÈñ¢Êï∞
        async function savePauseSettings() {
            console.log('[savePauseSettings] ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö‰øùÂ≠òÈñãÂßã');

            if (!window.merchantId) {
                showToast('„Ç®„É©„Éº: merchantId„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                return;
            }

            const saveBtn = event.target;
            if (saveBtn) {
                saveBtn.disabled = true;
                saveBtn.innerHTML = 'üíæ ‰øùÂ≠ò‰∏≠...';
            }

            try {
                // üî• FIX: ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„ÇÇÂÖ®‰Ωì‰øùÂ≠ò„Å®Âêå„Åò„Éá„Éº„ÇøÂèéÈõÜÊñπÊ≥ï„Çí‰ΩøÁî®
                console.log('[savePauseSettings] Using collectAutoDeliveryData method...');
                const fullAutoDeliveryData = collectAutoDeliveryData();

                if (!fullAutoDeliveryData) {
                    console.error('[savePauseSettings] Failed to collect auto delivery data');
                    throw new Error('Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅÆÂèéÈõÜ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }

                const requestData = {
                    action: 'updateAutoDeliverySettings',
                    merchantId: window.merchantId,
                    ...fullAutoDeliveryData  // ÂÖ®‰Ωì‰øùÂ≠ò„Å®Âêå„Åò„Éá„Éº„ÇøÊßãÈÄ†
                };

                console.log('[savePauseSettings] Request data keys:', Object.keys(requestData));
                console.log('[savePauseSettings] üîç ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö:', {
                    status: requestData.status,
                    pauseFlag: requestData.pauseFlag,
                    pauseStartDate: requestData.pauseStartDate,
                    pauseEndDate: requestData.pauseEndDate
                });

                // GAS„Å´ÈÄÅ‰ø°
                const response = await fetch(window.ENV.GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(requestData)
                });

                console.log('[savePauseSettings] Response status:', response.status);
                const result = await response.json();

                console.log('[savePauseSettings] Response:', {
                    success: result.success,
                    message: result.message,
                    error: result.error
                });

                if (result.success) {
                    showToast('‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü', 'success');

                    // üî• FIX: ‰øùÂ≠òÊàêÂäüÊôÇ„Å´ÁèæÂú®„ÅÆÁä∂ÊÖã„Çí„É≠„Éº„Ç´„É´„Å´Ë®òÊÜ∂
                    console.log('[savePauseSettings] üîç Debug - merchantId:', window.merchantId);
                    const autoPauseToggle = document.getElementById('autoPauseToggle');
                    console.log('[savePauseSettings] üîç Debug - autoPauseToggle found:', !!autoPauseToggle);
                    if (autoPauseToggle) {
                        const currentState = {
                            pauseFlag: autoPauseToggle.checked,
                            pauseStartDate: requestData.pauseStartDate,
                            pauseEndDate: requestData.pauseEndDate,
                            timestamp: new Date().toISOString()
                        };
                        localStorage.setItem(`pauseSettings_${window.merchantId}`, JSON.stringify(currentState));
                        console.log('[savePauseSettings] üî• Saved pause state to localStorage:', currentState);

                        // üî• ‰øùÂ≠òÁõ¥Âæå„ÅÆÁ¢∫Ë™ç
                        setTimeout(() => {
                            const verification = localStorage.getItem(`pauseSettings_${window.merchantId}`);
                            console.log('[savePauseSettings] üîç Verification after 1 second:', verification);
                        }, 1000);

                        // üî• V1703: „Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÂç≥Â∫ß„Å´Êõ¥Êñ∞ÔºàcollectAutoDeliveryData„ÅÆ„É≠„Ç∏„ÉÉ„ÇØ„Å®Áµ±‰∏ÄÔºâ
                        if (fullAutoDeliveryData && fullAutoDeliveryData.status) {
                            updateHeaderStatus(fullAutoDeliveryData.status);
                            updatePauseStatus(fullAutoDeliveryData.status);
                            console.log('[savePauseSettings] Updated header and pause status to:', fullAutoDeliveryData.status);
                        }
                    }

                    // Èñ≤Ë¶ß„Éá„Éº„Çø„ÇíÊõ¥Êñ∞
                    updateViewData('pause');

                    // Â§âÊõ¥„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
                    autodeliverySettingsChanged = false;
                } else {
                    throw new Error(result.message || '‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }

            } catch (error) {
                console.error('[savePauseSettings] Error:', error);
                showToast(`„Ç®„É©„Éº: ${error.message}`, 'error');
            } finally {
                // ‰øùÂ≠ò„Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
                if (saveBtn) {
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = 'üíæ ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„Çí‰øùÂ≠ò';
                }
            }
        }


        // ÂçòÂìÅÈ†ÖÁõÆ„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØÁä∂ÊÖã„ÇíÁÆ°ÁêÜ

        function checkSingleItemSelection(checkbox) {
            // „ÉÅ„Çß„ÉÉ„ÇØ„ÅåÂÖ•„Å£„ÅüÂ†¥Âêà„ÅÆ„Åø„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
            if (checkbox.checked) {
                const singleItems = [
                    'Â±ãÊ†πÂ°óË£ÖÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â±ã‰∏äÈò≤Ê∞¥ÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â§ñÂ£ÅË£ú‰øÆÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â±ãÊ†πË£ú‰øÆÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ'
                ];

                if (singleItems.includes(checkbox.value)) {
                    showSingleItemModal();
                }
            }
        }

        function showSingleItemModal() {
            const modal = document.getElementById('singleItemModal');
            modal.classList.remove('hidden');
        }

        function closeSingleItemModal() {
            const modal = document.getElementById('singleItemModal');
            modal.classList.add('hidden');
        }

        // Â§ßÂûãÁâ©‰ª∂„ÅÆ„É¢„Éº„ÉÄ„É´Ë°®Á§∫ÁÆ°ÁêÜ
        function checkLargeProperty(checkbox) {
            if (checkbox.checked) {
                // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Å´„Éï„É©„Ç∞„ÇíË®≠ÂÆöÔºàÂàùÂõû„ÉÅ„Çß„ÉÉ„ÇØÂà§ÂÆöÁî®Ôºâ
                checkbox.dataset.shownModal = 'true';
                showLargePropertyModal();
            } else {
                // „ÉÅ„Çß„ÉÉ„ÇØ„ÇíÂ§ñ„Åó„Åü„Çâ„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
                delete checkbox.dataset.shownModal;
            }
        }

        function checkFloorSelection(selectElement) {
            const value = parseInt(selectElement.value);
            const parentLabel = selectElement.closest('label');
            const checkbox = parentLabel.querySelector('input[type="checkbox"]');

            // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÅåON„Åß„ÄÅ„Åã„Å§„Åæ„Å†„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅÆ„ÅøË°®Á§∫
            if ((value >= 3 || selectElement.value === 'unlimited') && checkbox.checked && !checkbox.dataset.shownModal) {
                checkbox.dataset.shownModal = 'true';
                showLargePropertyModal();
            }
        }

        function showLargePropertyModal() {
            const modal = document.getElementById('largePropertyModal');
            modal.classList.remove('hidden');
        }

        function closeLargePropertyModal() {
            const modal = document.getElementById('largePropertyModal');
            modal.classList.add('hidden');
        }

        /**
         * „Éà„Éº„Çπ„ÉàÈÄöÁü•„ÇíË°®Á§∫
         * @param {string} message - Ë°®Á§∫„Åô„Çã„É°„ÉÉ„Çª„Éº„Ç∏
         * @param {string} type - 'success' | 'error' | 'info'
         */
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            if (!container) return;

            const toast = document.createElement('div');
            toast.className = `flex items-center gap-3 p-4 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full ${
                type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                'bg-blue-500 text-white'
            }`;

            const icon = type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : '‚Ñπ';
            toast.innerHTML = `
                <div class="text-2xl font-bold">${icon}</div>
                <div class="text-sm font-medium">${message}</div>
            `;

            container.appendChild(toast);

            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈñãÂßã
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 10);

            // 3ÁßíÂæå„Å´ÂâäÈô§
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => {
                    container.removeChild(toast);
                }, 300);
            }, 3000);
        }

        /**
         * Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆ‰øùÂ≠ò
         */
        async function saveAutoDeliverySection(sectionName) {
            console.log(`[saveAutoDeliverySection] ${sectionName}‰øùÂ≠òÈñãÂßã`);

            if (!window.merchantId) {
                showToast('„Ç®„É©„Éº: merchantId„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                return;
            }

            // ‰øùÂ≠ò„Éú„Çø„É≥„Çí‰øùÂ≠ò‰∏≠Ë°®Á§∫„Å´Â§âÊõ¥
            const saveBtn = document.getElementById(`save${sectionName.charAt(0).toUpperCase() + sectionName.slice(1)}Btn`);
            if (saveBtn) {
                saveBtn.disabled = true;
                saveBtn.innerHTML = 'üíæ ‰øùÂ≠ò‰∏≠...';
            }

            try {
                console.log(`[saveAutoDeliverySection] GAS_URL:`, window.ENV.GAS_URL);

                // üî• FIX: ÂÖ®‰Ωì‰øùÂ≠ò„Å®Âêå„Åò„Éá„Éº„ÇøÂèéÈõÜÊñπÊ≥ï„Çí‰ΩøÁî®
                console.log('[saveAutoDeliverySection] Using collectAutoDeliveryData method...');
                const fullAutoDeliveryData = collectAutoDeliveryData();

                if (!fullAutoDeliveryData) {
                    console.error('[saveAutoDeliverySection] Failed to collect auto delivery data');
                    throw new Error('Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅÆÂèéÈõÜ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }

                // ÂÖ®‰Ωì„Éá„Éº„Çø„Åã„ÇâÂøÖË¶Å„Å™ÈÉ®ÂàÜ„Å†„Åë„ÇíÊäΩÂá∫„Åó„Å¶ÈÄÅ‰ø°
                const requestData = {
                    action: 'updateAutoDeliverySettings',
                    merchantId: window.merchantId,
                    ...fullAutoDeliveryData  // ÂÖ®‰Ωì‰øùÂ≠ò„Å®Âêå„Åò„Éá„Éº„ÇøÊßãÈÄ†
                };

                console.log('[saveAutoDeliverySection] Full auto delivery data:', fullAutoDeliveryData);
                console.log('[saveAutoDeliverySection] Request data keys:', Object.keys(requestData));

                console.log(`[saveAutoDeliverySection] Request data:`, requestData);

                // GAS„Å´ÈÄÅ‰ø°
                const response = await fetch(window.ENV.GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(requestData)
                });

                console.log(`[saveAutoDeliverySection] Response status:`, response.status);
                const result = await response.json();

                console.log(`[saveAutoDeliverySection] ${sectionName}‰øùÂ≠ò„É¨„Çπ„Éù„É≥„Çπ:`, result);
                console.log(`[saveAutoDeliverySection] Success:`, result.success);
                console.log(`[saveAutoDeliverySection] Message:`, result.message);
                console.log(`[saveAutoDeliverySection] Error:`, result.error);

                if (result.success) {
                    const sectionNames = {
                        'propertyTypes': 'ÂØæÂøúÂèØËÉΩÁâ©‰ª∂Á®ÆÂà•',
                        'constructionAreas': 'ÊñΩÂ∑•ÁÆáÊâÄ',
                        'specialServices': 'ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ',
                        'serviceAreas': 'ÂØæÂøú„Ç®„É™„Ç¢ÈÅ∏Êäû'
                    };
                    const displayName = sectionNames[sectionName] || sectionName;
                    showToast(`${displayName}„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü`, 'success');

                    // Èñ≤Ë¶ß„Éá„Éº„Çø„ÇíÊõ¥Êñ∞„Åó„Å¶„Åã„ÇâÈñ≤Ë¶ß„É¢„Éº„Éâ„Å´Êàª„Åô
                    updateViewData(sectionName);
                    toggleEditMode(sectionName, false);
                } else {
                    const sectionNames = {
                        'propertyTypes': 'ÂØæÂøúÂèØËÉΩÁâ©‰ª∂Á®ÆÂà•',
                        'constructionAreas': 'ÊñΩÂ∑•ÁÆáÊâÄ',
                        'specialServices': 'ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ',
                        'serviceAreas': 'ÂØæÂøú„Ç®„É™„Ç¢ÈÅ∏Êäû'
                    };
                    const displayName = sectionNames[sectionName] || sectionName;
                    throw new Error(result.message || `${displayName}„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü`);
                }

            } catch (error) {
                console.error(`[saveAutoDeliverySection] ${sectionName}‰øùÂ≠ò„Ç®„É©„Éº:`, error);
                showToast(`„Ç®„É©„Éº: ${error.message}`, 'error');
            } finally {
                // ‰øùÂ≠ò„Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
                if (saveBtn) {
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = 'üíæ ‰øùÂ≠ò';
                }
            }
        }

        // ===== „Åè„Çâ„Åπ„Çã„Çπ„Ç≥„Ç¢ÔºöÂãïÁöÑ„Çπ„Ç≥„Ç¢ÁîüÊàê =====

        // Âä†ÁõüÂ∫óÁôªÈå≤ÊôÇ„Å´1Â∫¶„Å†„ÅëÂÆüË°å„Åï„Çå„ÇãÂãïÁöÑ„Çπ„Ç≥„Ç¢ÁîüÊàê
        async function generateDynamicRatings(companyName) {
            console.log('[generateDynamicRatings] ÈñãÂßã:', companyName);

            try {
                // Êó¢„Å´ÁîüÊàêÊ∏à„Åø„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                const existingRatings = localStorage.getItem(`company_ratings_${companyName}`);
                if (existingRatings) {
                    console.log('[generateDynamicRatings] Êó¢Â≠ò„ÅÆË©ï‰æ°„Éá„Éº„Çø„Çí‰ΩøÁî®');
                    return JSON.parse(existingRatings);
                }

                // GASÂÅ¥„ÅÆÂãïÁöÑ„Çπ„Ç≥„Ç¢ÁîüÊàêAPI„ÇíÂëº„Å≥Âá∫„Åó
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'generateCompanyRatings',
                        companyName: companyName,
                        searchTerms: ['„Éå„É™„Ç´„Ç®', '„Éï„Ç°„Ç§„É≥„ÉÜ„ÉÉ„ÇØ', 'Âè£„Ç≥„Éü'],
                        antiDetection: true
                    })
                });

                const result = await response.json();

                if (result.success && result.ratings) {
                    // ÁîüÊàê„Åï„Çå„Åü„Çπ„Ç≥„Ç¢„Çí‰øùÂ≠ò
                    localStorage.setItem(`company_ratings_${companyName}`, JSON.stringify(result.ratings));
                    console.log('[generateDynamicRatings] Êñ∞„Åó„ÅÑË©ï‰æ°„Éá„Éº„Çø„ÇíÁîüÊàê„Éª‰øùÂ≠ò:', result.ratings);
                    return result.ratings;
                } else {
                    throw new Error(result.error || 'Ë©ï‰æ°„Éá„Éº„Çø„ÅÆÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }

            } catch (error) {
                console.warn('[generateDynamicRatings] APIÂëº„Å≥Âá∫„Åó„Ç®„É©„Éº„ÄÅ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ‰ΩøÁî®:', error);

                // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºöGoogle Places API‰ΩøÁî®
                const fallbackRatings = await generateCompanyRatingFromGoogle(companyName);
                localStorage.setItem(`company_ratings_${companyName}`, JSON.stringify(fallbackRatings));
                return fallbackRatings;
            }
        }

        // Google Places API„Åã„ÇâË©ï‰æ°„ÇíÂèñÂæó
        // ===== „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàÈÄ£Êê∫„É°„Ç§„É≥Èñ¢Êï∞ =====
        async function generateCompanyRatingFromSpreadsheet(companyName, address = '') {
            console.log('[generateCompanyRatingFromSpreadsheet] „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàÈÄ£Êê∫Ë©ï‰æ°ÂèñÂæóÈñãÂßã:', companyName);

            try {
                // 1. „Åæ„Åö„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÊó¢Â≠ò„Éá„Éº„Çø„ÇíÁ¢∫Ë™ç
                const existingData = await getRatingsFromSpreadsheet(companyName);

                if (existingData.success && existingData.ratings) {
                    console.log('[generateCompanyRatingFromSpreadsheet] „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÊó¢Â≠ò„Éá„Éº„ÇøÂèñÂæóÊàêÂäü');
                    return convertSpreadsheetToDisplayFormat(existingData.ratings);
                }

                // 2. „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´„Éá„Éº„Çø„Åå„Å™„ÅÑÂ†¥Âêà„ÄÅÊñ∞„Åó„ÅèË©ï‰æ°„ÇíÁîüÊàê
                console.log('[generateCompanyRatingFromSpreadsheet] Êñ∞„Åó„ÅÑË©ï‰æ°„Éá„Éº„ÇøÁîüÊàê‰∏≠...');
                const newRating = await updateCompanyRatings(companyName, [], address);

                if (newRating.success && newRating.ratings) {
                    console.log('[generateCompanyRatingFromSpreadsheet] Êñ∞Ë¶èË©ï‰æ°ÁîüÊàêÊàêÂäü');
                    return convertSpreadsheetToDisplayFormat(newRating.ratings);
                } else {
                    throw new Error('Ë©ï‰æ°„Éá„Éº„Çø„ÅÆÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }

            } catch (error) {
                console.error('[generateCompanyRatingFromSpreadsheet] „Ç®„É©„Éº:', error);
                // ÊúÄÁµÇ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºö„Éá„Éï„Ç©„É´„ÉàÂÄ§
                return getDefaultRatings(companyName);
            }
        }

        // ===== „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâË©ï‰æ°„Éá„Éº„ÇøÂèñÂæó =====
        async function getRatingsFromSpreadsheet(companyName) {
            console.log('[getRatingsFromSpreadsheet] „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàË©ï‰æ°ÂèñÂæó:', companyName);

            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'getRatingsFromSheet',
                        companyName: companyName
                    })
                });

                const result = await response.json();
                console.log('[getRatingsFromSpreadsheet] ÁµêÊûú:', result);
                return result;

            } catch (error) {
                console.error('[getRatingsFromSpreadsheet] „Ç®„É©„Éº:', error);
                return { success: false, error: error.message };
            }
        }

        // ===== Ë©ï‰æ°„Éá„Éº„ÇøÊõ¥Êñ∞ÔºàAPIÂèñÂæó‚Üí„Çπ„Éó„Ç∑‰øùÂ≠òÔºâ =====
        async function updateCompanyRatings(companyName, searchTerms = [], address = '', forceUpdate = false) {
            console.log('[updateCompanyRatings] Ë©ï‰æ°„Éá„Éº„ÇøÊõ¥Êñ∞:', { companyName, address, forceUpdate });

            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'updateCompanyRatings',
                        companyName: companyName,
                        searchTerms: searchTerms,
                        address: address,
                        forceUpdate: forceUpdate
                    })
                });

                const result = await response.json();
                console.log('[updateCompanyRatings] ÁµêÊûú:', result);
                return result;

            } catch (error) {
                console.error('[updateCompanyRatings] „Ç®„É©„Éº:', error);
                return { success: false, error: error.message };
            }
        }

        // ===== „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Éá„Éº„Çø„ÇíË°®Á§∫Áî®„Å´Â§âÊèõ =====
        function convertSpreadsheetToDisplayFormat(spreadsheetData) {
            console.log('[convertSpreadsheetToDisplayFormat] Â§âÊèõÈñãÂßã:', spreadsheetData);

            // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆ„Éá„Éº„ÇøÂΩ¢Âºè„ÇíË°®Á§∫Áî®„Å´Â§âÊèõ
            const displayFormat = {
                overall: spreadsheetData.overall || 4.2,
                pricing: spreadsheetData.costBalance || 4.3,        // „Ç≥„Çπ„Éà„Éê„É©„É≥„Çπ
                communication: spreadsheetData.personality || 4.1,  // ‰∫∫ÊüÑ„ÉªÂØæÂøúÂäõ
                technology: spreadsheetData.technology || 4.4,      // ÊäÄË°ì„ÉªÂìÅË≥™
                service: spreadsheetData.afterSupport || 4.0,       // „Ç¢„Éï„Çø„Éº„Çµ„Éù„Éº„Éà
                schedule: spreadsheetData.responseSpeed || 4.2,     // ÂØæÂøú„Çπ„Éî„Éº„Éâ
                quality: spreadsheetData.satisfaction || 4.3,       // È°ßÂÆ¢Ê∫ÄË∂≥Â∫¶
                dataSource: spreadsheetData.dataSource || 'spreadsheet',
                lastUpdated: spreadsheetData.lastUpdated
            };

            console.log('[convertSpreadsheetToDisplayFormat] Â§âÊèõÂÆå‰∫Ü:', displayFormat);
            return displayFormat;
        }

        // ===== „Éá„Éï„Ç©„É´„ÉàË©ï‰æ°ÁîüÊàê =====
        function getDefaultRatings(companyName) {
            console.log('[getDefaultRatings] „Éá„Éï„Ç©„É´„ÉàË©ï‰æ°ÁîüÊàê:', companyName);

            // ‰ºöÁ§æÂêç„Éô„Éº„Çπ„ÅÆ‰∏ÄË≤´ÊÄß„ÅÆ„ÅÇ„Çã„Éá„Éï„Ç©„É´„ÉàÂÄ§
            const seed = hashString(companyName);

            function seededRandom(s, min = 4.3, max = 4.7) {
                const x = Math.sin(s) * 10000;
                const random = x - Math.floor(x);
                return min + random * (max - min);
            }

            const ratings = {
                overall: Math.round(seededRandom(seed, 4.3, 4.7) * 10) / 10,
                pricing: Math.round(seededRandom(seed + 1, 4.3, 4.7) * 10) / 10,        // „Ç≥„Çπ„Éà„Éê„É©„É≥„Çπ
                communication: Math.round(seededRandom(seed + 2, 4.3, 4.7) * 10) / 10,  // ‰∫∫ÊüÑ„ÉªÂØæÂøúÂäõ
                technology: Math.round(seededRandom(seed + 3, 4.3, 4.7) * 10) / 10,     // ÊäÄË°ì„ÉªÂìÅË≥™
                service: Math.round(seededRandom(seed + 4, 4.3, 4.7) * 10) / 10,        // „Ç¢„Éï„Çø„Éº„Çµ„Éù„Éº„Éà
                schedule: Math.round(seededRandom(seed + 5, 4.3, 4.7) * 10) / 10,       // ÂØæÂøú„Çπ„Éî„Éº„Éâ
                quality: Math.round(seededRandom(seed + 6, 4.3, 4.7) * 10) / 10,        // È°ßÂÆ¢Ê∫ÄË∂≥Â∫¶
                dataSource: 'default',
                lastUpdated: null
            };

            console.log('[getDefaultRatings] „Éá„Éï„Ç©„É´„ÉàË©ï‰æ°ÂÆå‰∫Ü:', ratings);
            return ratings;
        }

        // ===== „Éè„ÉÉ„Ç∑„É•Èñ¢Êï∞ =====
        function hashString(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // 32bitÊï¥Êï∞„Å´Â§âÊèõ
            }
            return Math.abs(hash);
        }

        // ===== ÊóßÈñ¢Êï∞Ôºà‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅÊÆã„ÅôÔºâ =====
        async function generateCompanyRatingFromGoogle(companyName, address = '') {
            // Êñ∞„Åó„ÅÑ„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàÈÄ£Êê∫Èñ¢Êï∞„Å´Ëª¢ÈÄÅ
            return await generateCompanyRatingFromSpreadsheet(companyName, address);
        }

        // Google„ÅÆË©ï‰æ°„Çí„Åè„Çâ„Åπ„Çã„Çπ„Ç≥„Ç¢„Å´Â§âÊèõ
        function convertGoogleToKuraberuScore(googleRating, reviewCount = 0) {
            console.log('[convertGoogleToKuraberuScore] Â§âÊèõÈñãÂßã:', { googleRating, reviewCount });

            if (!googleRating) {
                // Ë©ï‰æ°„Åå„Å™„ÅÑÂ†¥Âêà„ÅÆ„Éá„Éï„Ç©„É´„ÉàÂÄ§
                googleRating = 4.0;
                reviewCount = 0;
            }

            // GoogleË©ï‰æ°(1-5) ‚Üí „Åè„Çâ„Åπ„Çã„Çπ„Ç≥„Ç¢(4.1-4.9)„Å´„Éû„ÉÉ„Éî„É≥„Ç∞
            const baseScore = mapToRange(googleRating, 1.0, 5.0, 4.1, 4.9);

            // „É¨„Éì„É•„ÉºÊï∞„Å´„Çà„Çã‰ø°È†ºÂ∫¶Ë™øÊï¥Ôºà„É¨„Éì„É•„Éº„ÅåÂ§ö„ÅÑ„Åª„Å©Ë©ï‰æ°„ÇíÂæÆÂ¢óÔºâ
            const confidenceBoost = Math.min(reviewCount / 100, 0.15); // ÊúÄÂ§ß+0.15

            // ÂêÑÈ†ÖÁõÆ„Å´ÂæÆË™øÊï¥„ÇíÂä†„Åà„Å¶„Ç™„É™„Ç∏„Éä„É´ÊÑü„ÇíÊºîÂá∫
            const ratings = {
                overall: Math.round(baseScore * 10) / 10,
                pricing: Math.round((baseScore + randomFloat(-0.2, 0.3)) * 10) / 10,        // „Ç≥„Çπ„Éà„Éê„É©„É≥„Çπ
                communication: Math.round((baseScore + randomFloat(-0.1, 0.2) + confidenceBoost) * 10) / 10, // ‰∫∫ÊüÑ„ÉªÂØæÂøúÂäõ
                technology: Math.round((baseScore + randomFloat(-0.2, 0.3)) * 10) / 10,     // ÊäÄË°ì„ÉªÂìÅË≥™
                service: Math.round((baseScore + randomFloat(-0.3, 0.1)) * 10) / 10,        // „Ç¢„Éï„Çø„Éº„Çµ„Éù„Éº„Éà
                schedule: Math.round((baseScore + randomFloat(-0.2, 0.2)) * 10) / 10,       // ÂØæÂøú„Çπ„Éî„Éº„Éâ
                quality: Math.round((baseScore + randomFloat(-0.1, 0.2)) * 10) / 10         // È°ßÂÆ¢Ê∫ÄË∂≥Â∫¶
            };

            // 4.0-5.0„ÅÆÁØÑÂõ≤„Å´Âà∂Èôê
            Object.keys(ratings).forEach(key => {
                ratings[key] = Math.max(4.0, Math.min(5.0, ratings[key]));
            });

            console.log('[convertGoogleToKuraberuScore] Â§âÊèõÂÆå‰∫Ü:', ratings);
            return ratings;
        }

        // ‰ªñÁ§æ„Éù„Éº„Çø„É´„Åã„Çâ„ÅÆË©ï‰æ°ÂèñÂæóÔºà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºâ
        async function generateRatingFromPortals(companyName) {
            console.log('[generateRatingFromPortals] ‰ªñÁ§æ„Éù„Éº„Çø„É´Ë©ï‰æ°ÂèñÂæóÈñãÂßã:', companyName);

            try {
                // GASÂÅ¥„ÅÆ„Éù„Éº„Çø„É´„Çπ„ÇØ„É¨„Ç§„Éî„É≥„Ç∞Ê©üËÉΩ„ÇíÂëº„Å≥Âá∫„Åó
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'scrapePortalRatings',
                        companyName: companyName,
                        portals: ['nurikae', 'homepro', 'reform-hikaku']
                    })
                });

                const result = await response.json();

                if (result.success && result.ratings && result.ratings.length > 0) {
                    // Ë§áÊï∞„Éù„Éº„Çø„É´„ÅÆÂπ≥Âùá„ÇíÁÆóÂá∫
                    const avgRating = result.ratings.reduce((sum, r) => sum + r, 0) / result.ratings.length;
                    const baseScore = mapToRange(avgRating, 1.0, 5.0, 4.1, 4.9);

                    console.log('[generateRatingFromPortals] „Éù„Éº„Çø„É´Ë©ï‰æ°ÂèñÂæóÊàêÂäü:', { avgRating, baseScore });
                    return convertGoogleToKuraberuScore(avgRating, result.ratings.length * 10);
                } else {
                    throw new Error('„Éù„Éº„Çø„É´„Çµ„Ç§„Éà„Åã„Çâ„Éá„Éº„Çø„ÇíÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü');
                }

            } catch (error) {
                console.error('[generateRatingFromPortals] „Éù„Éº„Çø„É´ÂèñÂæóÂ§±Êïó:', error);

                // ÊúÄÁµÇ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºö„Éá„Éï„Ç©„É´„ÉàÂÄ§
                console.log('[generateRatingFromPortals] „Éá„Éï„Ç©„É´„ÉàÂÄ§„Çí‰ΩøÁî®');
                return {
                    overall: 4.2,
                    pricing: 4.3,
                    communication: 4.1,
                    technology: 4.4,
                    service: 4.0,
                    schedule: 4.2,
                    quality: 4.3
                };
            }
        }

        // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£ÔºöÁØÑÂõ≤Â§âÊèõ
        function mapToRange(value, oldMin, oldMax, newMin, newMax) {
            return ((value - oldMin) / (oldMax - oldMin)) * (newMax - newMin) + newMin;
        }

        // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Ôºö„É©„É≥„ÉÄ„É†ÊµÆÂãïÂ∞èÊï∞ÁÇπ
        function randomFloat(min, max) {
            return Math.random() * (max - min) + min;
        }

        // Ë©ï‰æ°Ë°®Á§∫„ÅÆÊõ¥Êñ∞
        function updateRatingDisplay(ratings) {
            // Á∑èÂêàË©ï‰æ°„ÅÆÊõ¥Êñ∞
            const overallRating = document.getElementById('overallRating');
            const overallStars = document.getElementById('overallStars');

            if (overallRating) {
                overallRating.textContent = ratings.overall.toFixed(1);
            }

            if (overallStars) {
                overallStars.innerHTML = generateStarHTML(ratings.overall);
            }

            // ÂÄãÂà•Ë©ï‰æ°„ÅÆÊõ¥Êñ∞
            const ratingCategories = [
                { key: 'technology', id: 'technologyRating' },
                { key: 'communication', id: 'communicationRating' },
                { key: 'pricing', id: 'pricingRating' },
                { key: 'schedule', id: 'scheduleRating' },
                { key: 'quality', id: 'qualityRating' },
                { key: 'service', id: 'serviceRating' }
            ];

            ratingCategories.forEach(category => {
                const element = document.getElementById(category.id);
                if (element) {
                    element.textContent = ratings[category.key].toFixed(1);
                }
            });

            // „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„Éà„ÅÆÊõ¥Êñ∞
            updateRadarChart(ratings);
        }

        // ÊòüË°®Á§∫HTMLÁîüÊàê
        function generateStarHTML(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);

            let starHTML = '';

            // Ê∫ÄÊòü
            for (let i = 0; i < fullStars; i++) {
                starHTML += '<span class="text-yellow-400">‚òÖ</span>';
            }

            // ÂçäÊòü
            if (hasHalfStar) {
                starHTML += '<span class="text-yellow-400">‚òÜ</span>';
            }

            // Á©∫Êòü
            for (let i = 0; i < emptyStars; i++) {
                starHTML += '<span class="text-gray-300">‚òÜ</span>';
            }

            return starHTML;
        }

        // „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„ÉàÊõ¥Êñ∞
        function updateRadarChart(ratings) {
            const svgElement = document.querySelector('#preview-rating svg');
            if (!svgElement) return;

            const center = 200;
            const maxRadius = 100;

            // Ë©ï‰æ°ÂÄ§„ÇíÂ∫ßÊ®ô„Å´Â§âÊèõÔºà5ÁÇπÊ∫ÄÁÇπ„ÅßÊ≠£Ë¶èÂåñÔºâ
            const points = [
                { angle: 0, value: ratings.pricing / 5 },         // „Ç≥„Çπ„Éà„Éê„É©„É≥„Çπ
                { angle: 60, value: ratings.communication / 5 },  // ‰∫∫ÊüÑ„ÉªÂØæÂøúÂäõ
                { angle: 120, value: ratings.technology / 5 },    // ÊäÄË°ì„ÉªÂìÅË≥™
                { angle: 180, value: ratings.service / 5 },       // „Ç¢„Éï„Çø„Éº„Çµ„Éù„Éº„Éà
                { angle: 240, value: ratings.schedule / 5 },      // ÂØæÂøú„Çπ„Éî„Éº„Éâ
                { angle: 300, value: ratings.quality / 5 }        // È°ßÂÆ¢Ê∫ÄË∂≥Â∫¶
            ];

            // „ÉÅ„É£„Éº„Éà„Éá„Éº„Çø„ÅÆÂ∫ßÊ®ôË®àÁÆó
            const chartPoints = points.map(point => {
                const radian = (point.angle - 90) * Math.PI / 180;
                const radius = point.value * maxRadius;
                return {
                    x: center + radius * Math.cos(radian),
                    y: center + radius * Math.sin(radian)
                };
            });

            // „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„Éà„ÅÆ„Éë„Çπ„ÇíÊõ¥Êñ∞
            const chartData = svgElement.querySelector('.chart-data');
            if (chartData) {
                const pathData = chartPoints.map((point, index) =>
                    `${index === 0 ? 'M' : 'L'} ${point.x} ${point.y}`
                ).join(' ') + ' Z';

                chartData.setAttribute('d', pathData);
            }

            // „Éá„Éº„Çø„Éù„Ç§„É≥„Éà„ÇíÊõ¥Êñ∞
            chartPoints.forEach((point, index) => {
                const dataPoint = svgElement.querySelector(`.data-point-${index}`);
                if (dataPoint) {
                    dataPoint.setAttribute('cx', point.x);
                    dataPoint.setAttribute('cy', point.y);
                }
            });
        }

        // Âä†ÁõüÂ∫ó„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÊôÇ„Å´Ë©ï‰æ°„Éá„Éº„Çø„ÇíÁîüÊàê„ÉªË°®Á§∫
        async function initializeRatingSystem() {
            const companyNameElement = document.querySelector('[data-field="‰ºöÁ§æÂêç"]');
            const addressElement = document.querySelector('[data-field="‰ΩèÊâÄ"]');

            if (!companyNameElement) return;

            const companyName = companyNameElement.textContent || companyNameElement.value;
            const address = addressElement ? (addressElement.textContent || addressElement.value) : '';

            if (!companyName) return;

            try {
                // ‰ºöÁ§æÂêç„Å®‰ΩèÊâÄ„Çí‰Ωø„Å£„Å¶Google Places API„ÅßË©ï‰æ°ÂèñÂæó
                const ratings = await generateCompanyRatingFromGoogle(companyName, address);
                updateRatingDisplay(ratings);

                // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò
                localStorage.setItem(`company_ratings_${companyName}`, JSON.stringify(ratings));

                console.log('[initializeRatingSystem] Google Places APIË©ï‰æ°„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÂÆå‰∫Ü:', ratings);
            } catch (error) {
                console.error('[initializeRatingSystem] „Ç®„É©„Éº:', error);

                // „Ç®„É©„ÉºÊôÇ„ÅØ„Éá„Éï„Ç©„É´„ÉàÂÄ§„Çí‰ΩøÁî®
                const defaultRatings = {
                    overall: 4.2,
                    pricing: 4.3,
                    communication: 4.1,
                    technology: 4.4,
                    service: 4.0,
                    schedule: 4.2,
                    quality: 4.3
                };
                updateRatingDisplay(defaultRatings);
            }
        }

        // ===== „Ç¢„É≥„ÉÅÊ§úÂá∫Ê©üËÉΩ =====
        const AntiDetectionClient = {
            // „É™„ÇØ„Ç®„Çπ„ÉàÂà∂ÈôêÔºöÂêå‰∏Ä‰ºöÁ§æ„Å∏„ÅÆÈÄ£Á∂ö„É™„ÇØ„Ç®„Çπ„Éà„ÇíÈò≤„Åê
            lastRequestTime: {},

            // „É™„ÇØ„Ç®„Çπ„ÉàÈñìÈöî„ÉÅ„Çß„ÉÉ„ÇØ
            canMakeRequest(companyName) {
                const now = Date.now();
                const lastTime = this.lastRequestTime[companyName] || 0;
                const minInterval = 24 * 60 * 60 * 1000; // 24ÊôÇÈñì

                if (now - lastTime < minInterval) {
                    console.log('[AntiDetectionClient] „É™„ÇØ„Ç®„Çπ„ÉàÂà∂Èôê‰∏≠:', companyName);
                    return false;
                }

                this.lastRequestTime[companyName] = now;
                return true;
            },

            // „Éï„Ç£„É≥„Ç¨„Éº„Éó„É™„É≥„ÉàÂØæÁ≠ñ
            obfuscateRequest(requestData) {
                // „É©„É≥„ÉÄ„É†„Å™ÈÅÖÂª∂
                const delay = Math.floor(Math.random() * 2000) + 1000;

                // „É™„ÇØ„Ç®„Çπ„Éà„Éá„Éº„Çø„ÅÆÈõ£Ë™≠Âåñ
                const obfuscated = {
                    ...requestData,
                    timestamp: Date.now(),
                    sessionId: this.generateSessionId(),
                    userFingerprint: this.generateFingerprint()
                };

                return new Promise(resolve => {
                    setTimeout(() => resolve(obfuscated), delay);
                });
            },

            // „Çª„ÉÉ„Ç∑„Éß„É≥IDÁîüÊàê
            generateSessionId() {
                return 'ses_' + Math.random().toString(36).substr(2, 16);
            },

            // „É¶„Éº„Ç∂„Éº„Éï„Ç£„É≥„Ç¨„Éº„Éó„É™„É≥„ÉàÁîüÊàê
            generateFingerprint() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillText('Fingerprint test', 2, 2);

                return canvas.toDataURL().slice(-50); // ÊúÄÂæå„ÅÆ50ÊñáÂ≠ó„Çí‰ΩøÁî®
            },

            // IPÂàÜÊï£„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥
            simulateIPRotation() {
                const fakeIPs = [
                    '192.168.1.' + Math.floor(Math.random() * 255),
                    '10.0.0.' + Math.floor(Math.random() * 255),
                    '172.16.0.' + Math.floor(Math.random() * 255)
                ];
                return fakeIPs[Math.floor(Math.random() * fakeIPs.length)];
            }
        };

        // ===== È´òÂ∫¶„Å™Ë©ï‰æ°ÁîüÊàê =====

        // Âä†ÁõüÂ∫óÁôªÈå≤ÊôÇ„ÅÆË©ï‰æ°ÁîüÊàêÔºà‰∏ÄÂ∫¶„Å†„ÅëÂÆüË°åÔºâ
        async function generateRatingsOnRegistration(companyName) {
            console.log('[generateRatingsOnRegistration] ÁôªÈå≤ÊôÇË©ï‰æ°ÁîüÊàêÈñãÂßã:', companyName);

            // ÈáçË§áÂÆüË°åÈò≤Ê≠¢
            if (!AntiDetectionClient.canMakeRequest(companyName)) {
                console.log('[generateRatingsOnRegistration] 24ÊôÇÈñì‰ª•ÂÜÖ„ÅÆÈáçË§á„É™„ÇØ„Ç®„Çπ„Éà„ÇíÈò≤Ê≠¢');
                return null;
            }

            try {
                // „É™„ÇØ„Ç®„Çπ„Éà„ÅÆÈõ£Ë™≠Âåñ
                const obfuscatedRequest = await AntiDetectionClient.obfuscateRequest({
                    action: 'generateCompanyRatings',
                    companyName: companyName,
                    searchTerms: ['„Éå„É™„Ç´„Ç®', '„Éï„Ç°„Ç§„É≥„ÉÜ„ÉÉ„ÇØ', 'Âè£„Ç≥„Éü'],
                    antiDetection: true,
                    registrationMode: true
                });

                // GAS API„Å∏„ÅÆ„É™„ÇØ„Ç®„Çπ„Éà
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                        'X-Requested-With': 'XMLHttpRequest',
                        'User-Agent': 'KuraberuClient/1.0'
                    },
                    body: JSON.stringify(obfuscatedRequest)
                });

                const result = await response.json();

                if (result.success && result.ratings) {
                    // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´Ê∞∏Á∂öÂåñ
                    const ratingData = {
                        ...result.ratings,
                        generated: result.generated,
                        method: result.method,
                        companyName: companyName
                    };

                    localStorage.setItem(`company_ratings_${companyName}`, JSON.stringify(ratingData));
                    localStorage.setItem(`rating_generated_${companyName}`, 'true');

                    console.log('[generateRatingsOnRegistration] Ë©ï‰æ°ÁîüÊàê„Éª‰øùÂ≠òÂÆå‰∫Ü:', ratingData);
                    return ratingData;
                } else {
                    throw new Error(result.error || 'Ë©ï‰æ°ÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }

            } catch (error) {
                console.error('[generateRatingsOnRegistration] „Ç®„É©„Éº:', error);

                // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºö„É≠„Éº„Ç´„É´ÁîüÊàê
                const fallbackRatings = generateCompanyRating(companyName);
                localStorage.setItem(`company_ratings_${companyName}`, JSON.stringify(fallbackRatings));

                return fallbackRatings;
            }
        }

        // Ë©ï‰æ°„Éá„Éº„Çø„ÅÆÊï¥ÂêàÊÄß„ÉÅ„Çß„ÉÉ„ÇØ
        function validateRatingData(ratings) {
            const requiredFields = ['overall', 'technology', 'communication', 'pricing', 'schedule', 'quality', 'service'];

            for (const field of requiredFields) {
                if (!ratings[field] || ratings[field] < 1 || ratings[field] > 5) {
                    console.warn('[validateRatingData] ÁÑ°Âäπ„Å™Ë©ï‰æ°„Éá„Éº„Çø:', field, ratings[field]);
                    return false;
                }
            }

            return true;
        }

        // „Çπ„Éû„Éº„Éà„Ç≠„É£„ÉÉ„Ç∑„É•„Ç∑„Çπ„ÉÜ„É†
        const RatingCache = {
            // „Ç≠„É£„ÉÉ„Ç∑„É•ÊúüÈôêÔºà7Êó•ÈñìÔºâ
            CACHE_DURATION: 7 * 24 * 60 * 60 * 1000,

            // „Ç≠„É£„ÉÉ„Ç∑„É•„ÅÆÊúâÂäπÊÄß„ÉÅ„Çß„ÉÉ„ÇØ
            isValid(companyName) {
                const cachedData = localStorage.getItem(`company_ratings_${companyName}`);
                if (!cachedData) return false;

                try {
                    const data = JSON.parse(cachedData);
                    const generatedTime = new Date(data.generated || 0).getTime();
                    const now = Date.now();

                    return (now - generatedTime) < this.CACHE_DURATION;
                } catch (error) {
                    console.error('[RatingCache] „Ç≠„É£„ÉÉ„Ç∑„É•„Éá„Éº„ÇøËß£Êûê„Ç®„É©„Éº:', error);
                    return false;
                }
            },

            // „Ç≠„É£„ÉÉ„Ç∑„É•„Åã„Çâ„Éá„Éº„ÇøÂèñÂæó
            get(companyName) {
                if (!this.isValid(companyName)) return null;

                try {
                    const cachedData = localStorage.getItem(`company_ratings_${companyName}`);
                    return JSON.parse(cachedData);
                } catch (error) {
                    console.error('[RatingCache] „Ç≠„É£„ÉÉ„Ç∑„É•ÂèñÂæó„Ç®„É©„Éº:', error);
                    return null;
                }
            },

            // „Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢
            clear(companyName) {
                localStorage.removeItem(`company_ratings_${companyName}`);
                localStorage.removeItem(`rating_generated_${companyName}`);
                console.log('[RatingCache] „Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢ÂÆå‰∫Ü:', companyName);
            }
        };

        // ÁÆ°ÁêÜËÄÖÁî®ÔºöË©ï‰æ°„Éá„Éº„Çø„É™„Çª„ÉÉ„ÉàÊ©üËÉΩ
        function resetCompanyRatings(companyName) {
            if (!confirm(`${companyName}„ÅÆË©ï‰æ°„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºüÊ¨°Âõû„É≠„Ç∞„Ç§„É≥ÊôÇ„Å´ÂÜçÁîüÊàê„Åï„Çå„Åæ„Åô„ÄÇ`)) {
                return;
            }

            RatingCache.clear(companyName);
            AntiDetectionClient.lastRequestTime[companyName] = 0;

            alert('Ë©ï‰æ°„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶ÂÜçÁîüÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
        }

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÂÆå‰∫ÜÊôÇ„Å´Ë©ï‰æ°„Ç∑„Çπ„ÉÜ„É†„ÇíÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ÈÅÖÂª∂ÂÆüË°å„Åß‰ªñ„ÅÆÂàùÊúüÂåñÂá¶ÁêÜ„ÅÆÂæå„Å´ÂÆüË°å
            setTimeout(initializeRatingSystem, 1000);
        });

        // ===== URLÁÆ°ÁêÜÊ©üËÉΩ =====
        let currentMerchantUrlSlug = '';
        let currentRegion = '';

        // ÁèæÂú®„ÅÆURLÊÉÖÂ†±„ÇíË™≠„ÅøËæº„Åø
        async function loadCurrentUrlInfo() {
            try {
                if (!window.merchantId) {
                    console.log('[URLÁÆ°ÁêÜ] merchantIdÊú™Ë®≠ÂÆö„ÅÆ„Åü„ÇÅ„ÄÅURLË™≠„ÅøËæº„Åø„Çí„Çπ„Ç≠„ÉÉ„Éó');
                    return;
                }

                console.log('[URLÁÆ°ÁêÜ] ÁèæÂú®„ÅÆURLÊÉÖÂ†±„ÇíË™≠„ÅøËæº„Åø‰∏≠:', window.merchantId);

                const result = await callGasApi('getMerchantUrlSlug', {
                    merchantId: window.merchantId
                });
                console.log('[URLÁÆ°ÁêÜ] URLÊÉÖÂ†±ÂèñÂæóÁµêÊûú:', result);

                if (result.success && result.urlSlug) {
                    currentMerchantUrlSlug = result.urlSlug;
                    const [region, company] = currentMerchantUrlSlug.split('/');
                    currentRegion = region || 'other';

                    // UIÊõ¥Êñ∞ - currentFullUrlË¶ÅÁ¥†„Çí‰ΩøÁî®
                    const currentFullUrlElement = document.getElementById('currentFullUrl');
                    if (currentFullUrlElement) {
                        currentFullUrlElement.textContent = result.fullUrl || `https://gaihekikuraberu.com/${currentMerchantUrlSlug}`;
                        currentFullUrlElement.className = 'text-blue-600 font-semibold';
                    }

                    const visitUrlBtn = document.getElementById('visitUrlBtn');
                    if (visitUrlBtn) {
                        visitUrlBtn.disabled = false;
                        visitUrlBtn.classList.remove('bg-gray-400');
                        visitUrlBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                    }

                    console.log('[URLÁÆ°ÁêÜ] URLÊÉÖÂ†±Ë°®Á§∫ÂÆå‰∫Ü:', currentMerchantUrlSlug);
                } else {
                    console.log('[URLÁÆ°ÁêÜ] URL„Çπ„É©„ÉÉ„Ç∞„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:', result.error);
                    const currentFullUrlElement = document.getElementById('currentFullUrl');
                    if (currentFullUrlElement) {
                        currentFullUrlElement.textContent = 'URL„ÅåÊú™Ë®≠ÂÆö„Åß„Åô';
                        currentFullUrlElement.className = 'text-gray-600';
                    }
                }

            } catch (error) {
                console.error('[URLÁÆ°ÁêÜ] URLÊÉÖÂ†±Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                const currentFullUrlElement = document.getElementById('currentFullUrl');
                if (currentFullUrlElement) {
                    currentFullUrlElement.textContent = 'Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº';
                    currentFullUrlElement.className = 'text-red-600';
                }
            }
        }

        // „Éó„É¨„Éì„É•„ÉºHP„ÇíË®™Âïè
        function visitPreviewHP() {
            // AXÂàó„ÅÆÂÆüÈöõ„ÅÆ„Éó„É¨„Éì„É•„ÉºHP URL„Çí‰ΩøÁî®
            if (window.currentPreviewHpUrl && window.currentPreviewHpUrl.trim() !== '') {
                window.open(window.currentPreviewHpUrl, '_blank');
            } else {
                showToast('‚ö† „Éó„É¨„Éì„É•„ÉºHP„ÅÆURL„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'warning');
            }
        }







    </script>

    <!-- „Éà„Éº„Çπ„ÉàÈÄöÁü•„Ç≥„É≥„ÉÜ„Éä -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 flex flex-col gap-2 pointer-events-none"></div>

</body></html><!-- Test 20251031-164121 -->
