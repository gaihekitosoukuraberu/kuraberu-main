/**
 * =====================================
 * ğŸ”¥ ã¾ã£ã•ã‚‰æ–°è¦ä½œæˆç‰ˆ - é™çš„HTMLç”Ÿæˆæ©Ÿèƒ½ ğŸ”¥
 * =====================================
 *
 * ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼HTMLæ§‹é€ ã‚’ä¸€å­—ä¸€å¥å®Œå…¨ã‚³ãƒ”ãƒ¼
 * ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿å‹•çš„ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°å¯¾å¿œ
 */

/**
 * ğŸ”¥ Geminiåºƒå‘Šãƒ†ã‚­ã‚¹ãƒˆå®Œå…¨é™¤å»æ©Ÿèƒ½
 */
function removeGeminiText(text) {
  if (!text) return text;

  const geminiPatterns = [
    /ãŠæ°—ã«å…¥ã‚Šã®ã‚¢ãƒ—ãƒªã®ä¸­ã‹ã‚‰\s*AI\s*ã‚’ç›´æ¥ãŠè©¦ã—ãã ã•ã„ã€‚[^ã€‚]*Gemini\s*ã‚’ä½¿ç”¨ã—ã¦[^ã€‚]*ã€‚*/gi,
    /\s*Gemini\s*ã‚’ä½¿ç”¨ã—ã¦[^ã€‚]*ã€‚*/gi,
    /AI\s*ã‚’ç›´æ¥ãŠè©¦ã—ãã ã•ã„[^ã€‚]*ã€‚*/gi,
    /ãŠæ°—ã«å…¥ã‚Šã®ã‚¢ãƒ—ãƒªã®ä¸­ã‹ã‚‰[^ã€‚]*ã€‚*/gi
  ];

  let cleanText = text;
  geminiPatterns.forEach(function(pattern) {
    cleanText = cleanText.replace(pattern, '');
  });

  return cleanText.replace(/\s+/g, ' ').trim();
}

/**
 * ğŸ”¥ ãƒ¡ã‚¤ãƒ³é–¢æ•°ï¼šé™çš„HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
 */
function generateStaticHTML(data) {
  console.log('[generateStaticHTML] ğŸ”¥ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆã§HTMLç”Ÿæˆé–‹å§‹');
  console.log('[generateStaticHTML] ãƒ‡ãƒ¼ã‚¿:', JSON.stringify(data, null, 2));

  try {
    // ãƒ‡ãƒ¼ã‚¿ã®å®‰å…¨ãªå–å¾—ã¨Geminiãƒ†ã‚­ã‚¹ãƒˆé™¤å»
    const companyName = removeGeminiText(data['ä¼šç¤¾å'] || 'æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«');
    const prText = removeGeminiText(data['PRæ–‡'] || '');
    const establishedYear = data['è¨­ç«‹å¹´æœˆ'] || '';
    const representativeName = data['ä»£è¡¨è€…å'] || '';
    const phone = data['é›»è©±ç•ªå·'] || '';
    const email = data['ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹'] || '';
    const address = data['ä½æ‰€'] || '';
    const businessHours = data['å–¶æ¥­æ™‚é–“'] || '';
    const kuraberuScore = parseFloat(data['ãã‚‰ã¹ã‚‹ã‚¹ã‚³ã‚¢'] || '4.2');

    // æ–½å·¥äº‹ä¾‹ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†
    let examplesHtml = '';
    const examplesData = data['æ–½å·¥äº‹ä¾‹'] || '';
    if (examplesData && examplesData !== '') {
      try {
        const examples = JSON.parse(examplesData);
        if (examples && examples.length > 0) {
          examplesHtml = generateConstructionExamplesHtml(examples);
        }
      } catch (e) {
        console.log('[generateStaticHTML] æ–½å·¥äº‹ä¾‹ã®ãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—:', e);
      }
    }

    // å¯¾å¿œå¯èƒ½ãªå·¥äº‹ã®å‡¦ç†
    const constructionTypes = data['å¯¾å¿œå¯èƒ½ãªå·¥äº‹'] || '';
    const servicesHtml = generateServicesHtml(constructionTypes);

    // ğŸ”¥ heroSectionï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
    const heroSectionHtml = generateHeroSectionHtml(companyName, prText, establishedYear);

    // ğŸ”¥ ãã‚‰ã¹ã‚‹ã‚¹ã‚³ã‚¢ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
    const scoreHtml = generateKuraberuScoreHtml(kuraberuScore);

    // ğŸ”¥ 9ã¤ã®ç„¡æ–™ç‰¹å…¸ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
    const nineBenefitsHtml = generateNineBenefitsHtml();

    // å®Œå…¨ãªHTMLã®çµ„ã¿ç«‹ã¦
    const html = '<!DOCTYPE html>' +
'<html lang="ja">' +
'<head>' +
'    <meta charset="UTF-8">' +
'    <meta name="viewport" content="width=device-width, initial-scale=1.0">' +
'    <title>' + companyName + ' | å¤–å£å¡—è£…ãƒ»ãƒªãƒ•ã‚©ãƒ¼ãƒ å°‚é–€åº—</title>' +
'    <meta name="description" content="' + companyName + 'ã¯å¤–å£å¡—è£…ãƒ»ãƒªãƒ•ã‚©ãƒ¼ãƒ ã®å°‚é–€åº—ã§ã™ã€‚' + prText.substring(0, 100) + '">' +
'    <script src="https://cdn.tailwindcss.com"></script>' +
'    <style>' +
'        body { font-family: "Hiragino Sans", "ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ã‚·ãƒƒã‚¯", "Yu Gothic", "æ¸¸ã‚´ã‚·ãƒƒã‚¯", "Meiryo", "ãƒ¡ã‚¤ãƒªã‚ª", sans-serif; }' +
'        .fade-in { opacity: 0; animation: fadeIn 0.6s ease-in forwards; }' +
'        @keyframes fadeIn { to { opacity: 1; } }' +
'        .hover-scale { transition: transform 0.2s ease; }' +
'        .hover-scale:hover { transform: scale(1.05); }' +
'        .gradient-text { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }' +
'        .shadow-custom { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }' +
'    </style>' +
'</head>' +
'<body class="bg-gray-50">' +
'    <div class="min-h-screen py-12 px-4">' +
'        <div class="bg-white rounded-2xl max-w-6xl mx-auto shadow-2xl">' +
'            <div class="p-8">' +

              // ğŸ”¥ heroSectionï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ï¼‰
              heroSectionHtml +

              // ğŸ”¥ ãã‚‰ã¹ã‚‹ã‚¹ã‚³ã‚¢ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ï¼‰
              scoreHtml +

              // ğŸ”¥ 9ã¤ã®ç„¡æ–™ç‰¹å…¸ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ï¼‰
              nineBenefitsHtml +

              // ğŸ”¥ å¯¾å¿œå¯èƒ½ãªå·¥äº‹ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ï¼‰
              servicesHtml +

              // æ–½å·¥äº‹ä¾‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³
              examplesHtml +

              // ä¼šç¤¾æ¦‚è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³
'                <div class="mb-12">' +
'                    <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">' +
'                        <span class="w-1 h-6 bg-blue-600 mr-3 rounded"></span>' +
'                        ä¼šç¤¾æ¦‚è¦' +
'                    </h3>' +
'                    <div class="bg-white border border-gray-200 rounded-xl overflow-hidden">' +
'                        <div class="divide-y divide-gray-200">' +
'                            <div class="flex">' +
'                                <div class="w-32 bg-gray-50 px-4 py-3 text-sm font-medium text-gray-700">ä¼šç¤¾å</div>' +
'                                <div class="flex-1 px-4 py-3 text-sm text-gray-900">' + companyName + '</div>' +
'                            </div>' +
                            (representativeName ? (
'                            <div class="flex">' +
'                                <div class="w-32 bg-gray-50 px-4 py-3 text-sm font-medium text-gray-700">ä»£è¡¨è€…</div>' +
'                                <div class="flex-1 px-4 py-3 text-sm text-gray-900">' + representativeName + '</div>' +
'                            </div>'
                            ) : '') +
                            (establishedYear ? (
'                            <div class="flex">' +
'                                <div class="w-32 bg-gray-50 px-4 py-3 text-sm font-medium text-gray-700">è¨­ç«‹</div>' +
'                                <div class="flex-1 px-4 py-3 text-sm text-gray-900">' + establishedYear + '</div>' +
'                            </div>'
                            ) : '') +
                            (address ? (
'                            <div class="flex">' +
'                                <div class="w-32 bg-gray-50 px-4 py-3 text-sm font-medium text-gray-700">ä½æ‰€</div>' +
'                                <div class="flex-1 px-4 py-3 text-sm text-gray-900">' + address + '</div>' +
'                            </div>'
                            ) : '') +
'                            <div class="flex">' +
'                                <div class="w-32 bg-gray-50 px-4 py-3 text-sm font-medium text-gray-700">é›»è©±ç•ªå·</div>' +
'                                <div class="flex-1 px-4 py-3 text-sm text-gray-900">' +
'                                    <a href="tel:' + phone + '" class="text-blue-600 hover:text-blue-800">' + phone + '</a>' +
'                                </div>' +
'                            </div>' +
                            (email ? (
'                            <div class="flex">' +
'                                <div class="w-32 bg-gray-50 px-4 py-3 text-sm font-medium text-gray-700">ãƒ¡ãƒ¼ãƒ«</div>' +
'                                <div class="flex-1 px-4 py-3 text-sm text-gray-900">' +
'                                    <a href="mailto:' + email + '" class="text-blue-600 hover:text-blue-800">' + email + '</a>' +
'                                </div>' +
'                            </div>'
                            ) : '') +
                            (businessHours ? (
'                            <div class="flex">' +
'                                <div class="w-32 bg-gray-50 px-4 py-3 text-sm font-medium text-gray-700">å–¶æ¥­æ™‚é–“</div>' +
'                                <div class="flex-1 px-4 py-3 text-sm text-gray-900">' + businessHours + '</div>' +
'                            </div>'
                            ) : '') +
'                        </div>' +
'                    </div>' +
'                </div>' +

                // ãŠå•ã„åˆã‚ã›ã‚»ã‚¯ã‚·ãƒ§ãƒ³
'                <div class="mb-12">' +
'                    <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">' +
'                        <span class="w-1 h-6 bg-purple-600 mr-3 rounded"></span>' +
'                        ãŠå•ã„åˆã‚ã›' +
'                    </h3>' +
'                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">' +
'                        <div class="bg-white border rounded-xl p-4 hover:shadow-lg transition">' +
'                            <div class="flex items-center">' +
'                                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">' +
'                                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
'                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>' +
'                                    </svg>' +
'                                </div>' +
'                                <div>' +
'                                    <p class="text-sm text-gray-600">ãŠé›»è©±ã§ã®ãŠå•ã„åˆã‚ã›</p>' +
'                                    <a href="tel:' + phone + '" class="text-lg font-semibold text-blue-600 hover:text-blue-800 cursor-pointer transition-colors">' + phone + '</a>' +
'                                    <p class="text-xs text-gray-500">å—ä»˜æ™‚é–“: ' + businessHours + '</p>' +
'                                </div>' +
'                            </div>' +
'                        </div>' +
                        (email ? (
'                        <div class="bg-white border rounded-xl p-4 hover:shadow-lg transition">' +
'                            <div class="flex items-center">' +
'                                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4">' +
'                                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
'                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>' +
'                                    </svg>' +
'                                </div>' +
'                                <div class="overflow-hidden min-w-0">' +
'                                    <p class="text-sm text-gray-600">ãƒ¡ãƒ¼ãƒ«ã§ã®ãŠå•ã„åˆã‚ã›</p>' +
'                                    <a href="mailto:' + email + '" class="text-sm sm:text-base font-semibold text-blue-600 hover:text-blue-800 break-all cursor-pointer transition-colors">' + email + '</a>' +
'                                    <p class="text-xs text-gray-500">24æ™‚é–“å—ä»˜ä¸­</p>' +
'                                </div>' +
'                            </div>' +
'                        </div>'
                        ) : '') +
'                    </div>' +
'                </div>' +
'            </div>' +
'        </div>' +
'    </div>' +
'</body>' +
'</html>';

    console.log('[generateStaticHTML] âœ… ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆHTMLç”Ÿæˆå®Œäº†');
    return html;

  } catch (error) {
    console.error('[generateStaticHTML] âŒ ã‚¨ãƒ©ãƒ¼:', error);
    return generateErrorHTML(error.toString());
  }
}

/**
 * ğŸ”¥ heroSection HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
 */
function generateHeroSectionHtml(companyName, prText, establishedYear) {
  const establishedDisplay = establishedYear ? (establishedYear + 'è¨­ç«‹') : '';

  return '<div id="heroSection" class="relative bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-12 mb-12 text-white overflow-hidden">' +
'    <div class="absolute inset-0 bg-black opacity-10"></div>' +
'    <div class="relative z-10">' +
'        <h1 class="text-2xl sm:text-4xl font-bold mb-2 text-center sm:text-left">' + companyName + '</h1>' +
'        <p class="text-base sm:text-lg opacity-90 text-center sm:text-left">' + prText + '</p>' +
'        <div class="flex flex-wrap gap-4 mt-6">' +
            (establishedDisplay ? (
'            <div class="flex items-center">' +
'                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">' +
'                    <path d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm3 1h6v4H7V5zm6 6H7v2h6v-2z"></path>' +
'                </svg>' +
'                <span>' + establishedDisplay + '</span>' +
'            </div>'
            ) : '') +
'        </div>' +
'    </div>' +
'</div>';
}

/**
 * ğŸ”¥ ãã‚‰ã¹ã‚‹ã‚¹ã‚³ã‚¢HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
 */
function generateKuraberuScoreHtml(score) {
  const scoreValue = parseFloat(score) || 4.2;

  return '<div id="preview-rating" class="mb-8 sm:mb-12 bg-gradient-to-br from-amber-50 via-orange-50 to-red-50 rounded-2xl p-4 sm:p-6 lg:p-8">' +
'    <div class="mb-4 sm:mb-6">' +
'        <h3 class="text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 mb-2 inline-flex items-center">' +
'            <span class="w-1 h-5 sm:h-6 bg-gradient-to-b from-amber-500 to-orange-600 mr-2 sm:mr-3 rounded"></span>' +
'            ãã‚‰ã¹ã‚‹ã‚¹ã‚³ã‚¢' +
'        </h3>' +
'        <p class="text-sm sm:text-base text-gray-600">å½“ç¤¾ç‹¬è‡ªã®ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢</p>' +
'    </div>' +
'    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 lg:gap-8">' +
        // ç·åˆè©•ä¾¡
'        <div class="bg-white rounded-xl shadow-lg border-2 border-amber-100 p-4 sm:p-5 lg:p-6">' +
'            <div class="text-center mb-4 sm:mb-5">' +
'                <h4 class="text-base sm:text-lg lg:text-xl font-bold text-gray-800 mb-2 sm:mb-3">ç·åˆè©•ä¾¡</h4>' +
'                <div class="flex items-center justify-center mb-2 sm:mb-3">' +
'                    <span class="text-3xl sm:text-4xl lg:text-5xl font-bold text-amber-600">' + scoreValue.toFixed(1) + '</span>' +
'                    <span class="text-base sm:text-lg lg:text-xl text-gray-500 ml-1">/5.0</span>' +
'                </div>' +
'                <div class="flex justify-center mb-2 sm:mb-3 gap-1">' +
                    generateStarsHtml(scoreValue) +
'                </div>' +
'                <p class="text-xs sm:text-sm text-gray-600">é«˜ã„å“è³ªã§ãŠå®¢æ§˜ã«ãŠå¿œãˆã—ã¾ã™</p>' +
'            </div>' +
'        </div>' +

        // è©³ç´°è©•ä¾¡ï¼ˆãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆé¢¨ï¼‰
'        <div class="bg-white rounded-xl shadow-lg border-2 border-amber-100 p-4 sm:p-5 lg:p-6">' +
'            <h4 class="text-base sm:text-lg lg:text-xl font-bold text-gray-800 mb-3 sm:mb-4 text-center">è©³ç´°è©•ä¾¡</h4>' +
'            <div class="space-y-3">' +
'                <div class="flex justify-between items-center">' +
'                    <span class="text-sm text-gray-600">æŠ€è¡“åŠ›</span>' +
'                    <div class="flex items-center">' +
'                        <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">' +
'                            <div class="bg-amber-500 h-2 rounded-full" style="width: ' + Math.min((scoreValue / 5) * 100 + 10, 100) + '%"></div>' +
'                        </div>' +
'                        <span class="text-sm font-medium text-gray-800">' + Math.min(scoreValue + 0.2, 5.0).toFixed(1) + '</span>' +
'                    </div>' +
'                </div>' +
'                <div class="flex justify-between items-center">' +
'                    <span class="text-sm text-gray-600">å¯¾å¿œåŠ›</span>' +
'                    <div class="flex items-center">' +
'                        <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">' +
'                            <div class="bg-amber-500 h-2 rounded-full" style="width: ' + Math.min((scoreValue / 5) * 100 + 5, 100) + '%"></div>' +
'                        </div>' +
'                        <span class="text-sm font-medium text-gray-800">' + Math.min(scoreValue + 0.1, 5.0).toFixed(1) + '</span>' +
'                    </div>' +
'                </div>' +
'                <div class="flex justify-between items-center">' +
'                    <span class="text-sm text-gray-600">ä¾¡æ ¼æº€è¶³åº¦</span>' +
'                    <div class="flex items-center">' +
'                        <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">' +
'                            <div class="bg-amber-500 h-2 rounded-full" style="width: ' + (scoreValue / 5) * 100 + '%"></div>' +
'                        </div>' +
'                        <span class="text-sm font-medium text-gray-800">' + scoreValue.toFixed(1) + '</span>' +
'                    </div>' +
'                </div>' +
'                <div class="flex justify-between items-center">' +
'                    <span class="text-sm text-gray-600">ã‚¢ãƒ•ã‚¿ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹</span>' +
'                    <div class="flex items-center">' +
'                        <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">' +
'                            <div class="bg-amber-500 h-2 rounded-full" style="width: ' + Math.max((scoreValue / 5) * 100 - 5, 80) + '%"></div>' +
'                        </div>' +
'                        <span class="text-sm font-medium text-gray-800">' + Math.max(scoreValue - 0.1, 4.0).toFixed(1) + '</span>' +
'                    </div>' +
'                </div>' +
'            </div>' +
'        </div>' +
'    </div>' +
'</div>';
}

/**
 * ğŸ”¥ æ˜Ÿè©•ä¾¡HTMLç”Ÿæˆ
 */
function generateStarsHtml(score) {
  let html = '';
  for (let i = 1; i <= 5; i++) {
    if (i <= Math.floor(score)) {
      html += '<svg class="w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 text-amber-400 fill-current" viewBox="0 0 20 20">' +
              '<path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>' +
              '</svg>';
    } else {
      html += '<svg class="w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 text-gray-300 fill-current" viewBox="0 0 20 20">' +
              '<path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>' +
              '</svg>';
    }
  }
  return html;
}

/**
 * ğŸ”¥ 9ã¤ã®ç„¡æ–™ç‰¹å…¸HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
 */
function generateNineBenefitsHtml() {
  return '<div class="mb-8 sm:mb-12 bg-gradient-to-br from-orange-50 via-orange-100 to-red-50 rounded-2xl p-4 sm:p-6 lg:p-10">' +
'    <div class="text-center mb-4 sm:mb-6">' +
'        <h3 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900 mb-2">ğŸ ä»Šã ã‘ï¼9ã¤ã®ç„¡æ–™ç‰¹å…¸</h3>' +
'        <p class="text-sm sm:text-base text-gray-600">æœŸé–“é™å®šã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³å®Ÿæ–½ä¸­ï¼</p>' +
'    </div>' +
'    <div class="max-w-4xl mx-auto mb-4 sm:mb-6 px-2 sm:px-4">' +
'        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">' +
            // ç‰¹å…¸1: ç„¡æ–™ç‚¹æ¤œ
'            <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">' +
'                <div class="flex items-start">' +
'                    <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ğŸ”</span>' +
'                    <div class="min-w-0 flex-1">' +
'                        <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ç„¡æ–™ç‚¹æ¤œ</h4>' +
'                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">ãƒ—ãƒ­ã®ç›®ã§å¤–å£ãƒ»å±‹æ ¹ã‚’å¾¹åº•ãƒã‚§ãƒƒã‚¯ï¼ãŠå®¶ã®çŠ¶æ…‹ã‚’è©³ç´°ã«å ±å‘Š</p>' +
'                    </div>' +
'                </div>' +
'            </div>' +
            // ç‰¹å…¸2: ã‚¨ãƒªã‚¢æœ€ä½ä¾¡æ ¼ä¿è¨¼
'            <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">' +
'                <div class="flex items-start">' +
'                    <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ğŸ’°</span>' +
'                    <div class="min-w-0 flex-1">' +
'                        <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ã‚¨ãƒªã‚¢æœ€ä½ä¾¡æ ¼ä¿è¨¼</h4>' +
'                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">åœ°åŸŸæœ€å®‰å€¤ã‚’ãŠç´„æŸï¼ä»–ç¤¾ã‚ˆã‚Šé«˜ã‘ã‚Œã°å€¤å¼•ãå¯¾å¿œ</p>' +
'                    </div>' +
'                </div>' +
'            </div>' +
            // ç‰¹å…¸3: ãŠå€¤å¼•ãäº¤æ¸‰ä»£è¡Œ
'            <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">' +
'                <div class="flex items-start">' +
'                    <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ğŸ¤</span>' +
'                    <div class="min-w-0 flex-1">' +
'                        <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ãŠå€¤å¼•ãäº¤æ¸‰ä»£è¡Œ</h4>' +
'                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">ä»–ç¤¾è¦‹ç©ã‚‚ã‚Šã‚’ãŠæŒã¡ãªã‚‰ã€ä»£ã‚ã‚Šã«äº¤æ¸‰ã—ã¦æœ€å®‰å€¤ã‚’å®Ÿç¾</p>' +
'                    </div>' +
'                </div>' +
'            </div>' +
            // ç‰¹å…¸4: åŠ©æˆé‡‘ç”³è«‹ã‚µãƒãƒ¼ãƒˆ
'            <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">' +
'                <div class="flex items-start">' +
'                    <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ğŸ“</span>' +
'                    <div class="min-w-0 flex-1">' +
'                        <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">åŠ©æˆé‡‘ç”³è«‹ã‚µãƒãƒ¼ãƒˆ</h4>' +
'                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">æœ€å¤§10ï½70ä¸‡å††ï¼å„ç¨®åŠ©æˆé‡‘ã®ç”³è«‹æ‰‹ç¶šãã‚’å®Œå…¨ã‚µãƒãƒ¼ãƒˆ</p>' +
'                    </div>' +
'                </div>' +
'            </div>' +
            // ç‰¹å…¸5: ç«ç½ä¿é™ºç”³è«‹ã‚µãƒãƒ¼ãƒˆ
'            <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">' +
'                <div class="flex items-start">' +
'                    <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ğŸ›ï¸</span>' +
'                    <div class="min-w-0 flex-1">' +
'                        <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ç«ç½ä¿é™ºç”³è«‹ã‚µãƒãƒ¼ãƒˆ</h4>' +
'                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">å°é¢¨ãƒ»é›ªå®³ç­‰ã®æå®³ã«ç«ç½ä¿é™ºé©ç”¨å¯èƒ½ï¼ç„¡æ–™ã§èª¿æŸ»</p>' +
'                    </div>' +
'                </div>' +
'            </div>' +
            // ç‰¹å…¸6: ãŠæ–­ã‚Šä»£è¡Œã‚µãƒ¼ãƒ“ã‚¹
'            <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">' +
'                <div class="flex items-start">' +
'                    <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ğŸš«</span>' +
'                    <div class="min-w-0 flex-1">' +
'                        <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ãŠæ–­ã‚Šä»£è¡Œã‚µãƒ¼ãƒ“ã‚¹</h4>' +
'                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">æˆç´„æ™‚ã®ä»–ç¤¾ã¸ã®ãŠæ–­ã‚Šã‚‚ä»£è¡Œå¯èƒ½ï¼é¢å€’ãªã‚„ã‚Šå–ã‚Šä¸è¦</p>' +
'                    </div>' +
'                </div>' +
'            </div>' +
            // ç‰¹å…¸7: ç„¡æ–™ãŠé›»è©±ã‚µãƒãƒ¼ãƒˆ
'            <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">' +
'                <div class="flex items-start">' +
'                    <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ğŸ“</span>' +
'                    <div class="min-w-0 flex-1">' +
'                        <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ç„¡æ–™ãŠé›»è©±ã‚µãƒãƒ¼ãƒˆ</h4>' +
'                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">å·¥äº‹å®Œäº†å¾Œã‚‚å®‰å¿ƒï¼365æ—¥é›»è©±ã‚µãƒãƒ¼ãƒˆã§ãŠæ‚©ã¿è§£æ±º</p>' +
'                    </div>' +
'                </div>' +
'            </div>' +
            // ç‰¹å…¸8: è¨ªå•æ¥­è€…ãƒãƒ‹ãƒ¥ã‚¢ãƒ«é€²å‘ˆ
'            <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">' +
'                <div class="flex items-start">' +
'                    <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ğŸ“–</span>' +
'                    <div class="min-w-0 flex-1">' +
'                        <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">è¨ªå•æ¥­è€…ãƒãƒ‹ãƒ¥ã‚¢ãƒ«é€²å‘ˆ</h4>' +
'                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">æ‚ªå¾³æ¥­è€…ã®æ‰‹å£ã‚„å¯¾å‡¦æ³•ã‚’å®Œå…¨è§£èª¬ï¼å®‰å¿ƒã‚¬ã‚¤ãƒ‰</p>' +
'                    </div>' +
'                </div>' +
'            </div>' +
            // ç‰¹å…¸9: ãŠå‹é”ç´¹ä»‹ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³
'            <div class="bg-white rounded-lg p-3 sm:p-4 lg:p-5 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">' +
'                <div class="flex items-start">' +
'                    <span class="text-2xl sm:text-3xl mr-2 sm:mr-3 flex-shrink-0">ğŸ‘¥</span>' +
'                    <div class="min-w-0 flex-1">' +
'                        <h4 class="font-bold text-orange-600 mb-1 sm:mb-2 text-sm sm:text-base lg:text-lg">ãŠå‹é”ç´¹ä»‹ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³</h4>' +
'                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">ç´¹ä»‹ã§åŒæ–¹ã«ç‰¹å…¸ï¼æœ€å¤§30,000å††åˆ†ã®ã‚®ãƒ•ãƒˆã‚«ãƒ¼ãƒ‰</p>' +
'                    </div>' +
'                </div>' +
'            </div>' +
'        </div>' +
'    </div>' +
'    <div class="text-center mt-4 sm:mt-6">' +
'        <button class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 sm:px-8 lg:px-10 py-3 sm:py-4 rounded-lg hover:shadow-xl transition font-bold text-base sm:text-lg transform hover:scale-105 w-full sm:w-auto max-w-sm sm:max-w-none">' +
'            <span class="sm:hidden">ä»Šã™ãç„¡æ–™è¦‹ç©ã‚‚ã‚Šã‚’ä¾é ¼</span>' +
'            <span class="hidden sm:inline">ä»Šã™ãç„¡æ–™è¦‹ç©ã‚‚ã‚Šã‚’ä¾é ¼ã™ã‚‹</span>' +
'        </button>' +
'        <p class="text-xs sm:text-sm text-gray-500 mt-2">â€»24æ™‚é–“ä»¥å†…ã«ã”é€£çµ¡ã„ãŸã—ã¾ã™</p>' +
'    </div>' +
'</div>';
}

/**
 * ğŸ”¥ å¯¾å¿œå¯èƒ½ãªå·¥äº‹HTMLç”Ÿæˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œå…¨ä¸€è‡´ç‰ˆï¼‰
 */
function generateServicesHtml(constructionTypes) {
  if (!constructionTypes || constructionTypes === '') {
    return '';
  }

  let services = [];
  try {
    if (typeof constructionTypes === 'string') {
      services = constructionTypes.split(',').map(function(s) { return s.trim(); }).filter(function(s) { return s !== ''; });
    } else if (Array.isArray(constructionTypes)) {
      services = constructionTypes;
    }
  } catch (e) {
    console.log('[generateServicesHtml] ãƒ‘ãƒ¼ã‚¹å¤±æ•—:', e);
  }

  if (services.length === 0) {
    return '';
  }

  const serviceIconMap = {
    'å¤–å£å¡—è£…': 'ğŸ¨',
    'å¤–å£ã‚«ãƒãƒ¼å·¥æ³•': 'ğŸ—ï¸',
    'å¤–å£å¼µæ›¿ãˆ': 'ğŸ”¨',
    'å±‹æ ¹å¡—è£…ï¼ˆå¤–å£å·¥äº‹å«ã‚€ï¼‰': 'ğŸ ',
    'å±‹æ ¹å¡—è£…': 'ğŸ ',
    'å±‹ä¸Šé˜²æ°´ï¼ˆå¤–å£å·¥äº‹å«ã‚€ï¼‰': 'ğŸ’§',
    'å±‹æ ¹è‘ºãæ›¿ãˆãƒ»å¼µã‚Šæ›¿ãˆâ€»ã‚¹ãƒ¬ãƒ¼ãƒˆãƒ»ã‚¬ãƒ«ãƒãƒªã‚¦ãƒ ç­‰': 'ğŸšï¸',
    'å±‹æ ¹è‘ºãæ›¿ãˆãƒ»å¼µã‚Šæ›¿ãˆâ€»ç“¦': 'ğŸ¯',
    'å±‹æ ¹ã‚«ãƒãƒ¼å·¥æ³•': 'ğŸ“',
    'å¤–å£è£œä¿®ï¼ˆå¤–å£å·¥äº‹å«ã‚€ï¼‰': 'ğŸ”§',
    'å±‹æ ¹è£œä¿®ï¼ˆå¤–å£å·¥äº‹å«ã‚€ï¼‰': 'ğŸ› ï¸',
    'ãƒ™ãƒ©ãƒ³ãƒ€é˜²æ°´ï¼ˆå¤–å£å·¥äº‹å«ã‚€ï¼‰': 'ğŸŒŠ',
    'å†…è£…æ°´å›ã‚Šï¼ˆãƒã‚¹ãƒ»ã‚­ãƒƒãƒãƒ³ãƒ»ãƒˆã‚¤ãƒ¬ï¼‰ï¼ˆå¤–å£å·¥äº‹å«ã‚€ï¼‰': 'ğŸš¿',
    'å†…è£…ï¼ˆãƒ•ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚„ç•³ãªã©ã®åºŠãƒ»ã‚¯ãƒ­ã‚¹ç­‰ï¼‰ï¼ˆå¤–å£å·¥äº‹å«ã‚€ï¼‰': 'ğŸ¡',
    'é›¨æ¨‹äº¤æ›ãƒ»ä¿®ç†': 'ğŸŒ§ï¸',
    'ã‚·ãƒ¼ãƒªãƒ³ã‚°å·¥äº‹': 'ğŸ”§',
    'ãƒ™ãƒ©ãƒ³ãƒ€é˜²æ°´': 'ğŸŠ',
    'è¶³å ´è¨­ç½®': 'âš™ï¸',
    'å†…è£…ãƒªãƒ•ã‚©ãƒ¼ãƒ ': 'ğŸª„',
    'ãã®ä»–': 'â­'
  };

  let html = '<div id="preview-services" class="mb-12">' +
'    <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">' +
'        <span class="w-1 h-6 bg-green-600 mr-3 rounded"></span>' +
'        å¯¾å¿œå¯èƒ½ãªå·¥äº‹' +
'    </h3>' +
'    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">';

  services.forEach(function(service) {
    const icon = serviceIconMap[service] || 'ğŸ”§';
    html += '        <div class="bg-white border border-green-200 rounded-lg p-3 flex items-center hover:shadow-md transition">' +
'            <span class="text-2xl mr-2">' + icon + '</span>' +
'            <span class="text-sm font-medium text-gray-800">' + service + '</span>' +
'        </div>';
  });

  html += '    </div>' +
'</div>';

  return html;
}

/**
 * ğŸ”¥ æ–½å·¥äº‹ä¾‹HTMLç”Ÿæˆ
 */
function generateConstructionExamplesHtml(examples) {
  if (!examples || examples.length === 0) {
    return '';
  }

  let html = '<div class="mb-12">' +
'    <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">' +
'        <span class="w-1 h-6 bg-pink-600 mr-3 rounded"></span>' +
'        æ–½å·¥äº‹ä¾‹' +
'    </h3>' +
'    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">';

  examples.forEach(function(example, index) {
    html += '        <div class="bg-white rounded-xl overflow-hidden shadow-md hover:shadow-lg transition">' +
'            <img src="' + (example.thumbnail || example.image || '') + '" alt="' + (example.title || 'æ–½å·¥äº‹ä¾‹' + (index + 1)) + '" class="w-full h-48 object-cover">' +
'            <div class="p-4">' +
'                <h4 class="font-semibold text-gray-900 mb-2">' + (example.title || 'æ–½å·¥äº‹ä¾‹' + (index + 1)) + '</h4>' +
'                <p class="text-sm text-gray-600 mb-3">' + (example.description || '') + '</p>' +
'                <div class="flex justify-between items-center text-xs text-gray-500">' +
'                    <span>å·¥æœŸ: ' + (example.duration || '-') + '</span>' +
'                    <span>è²»ç”¨: ' + (example.cost || '-') + '</span>' +
'                </div>' +
'            </div>' +
'        </div>';
  });

  html += '    </div>' +
'</div>';

  return html;
}

/**
 * ğŸ”¥ ã‚¨ãƒ©ãƒ¼HTMLç”Ÿæˆ
 */
function generateErrorHTML(errorMessage) {
  return '<!DOCTYPE html>' +
'<html lang="ja">' +
'<head>' +
'    <meta charset="UTF-8">' +
'    <meta name="viewport" content="width=device-width, initial-scale=1.0">' +
'    <title>ã‚¨ãƒ©ãƒ¼ - ãƒšãƒ¼ã‚¸ç”Ÿæˆå¤±æ•—</title>' +
'    <script src="https://cdn.tailwindcss.com"></script>' +
'</head>' +
'<body class="bg-gray-100 flex items-center justify-center min-h-screen">' +
'    <div class="bg-white p-8 rounded-lg shadow-md max-w-md w-full">' +
'        <div class="text-center">' +
'            <h1 class="text-2xl font-bold text-red-600 mb-4">ğŸš¨ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h1>' +
'            <p class="text-gray-600 mb-4">ãƒšãƒ¼ã‚¸ã®ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</p>' +
'            <div class="bg-red-50 border border-red-200 rounded p-4 mb-4">' +
'                <p class="text-sm text-red-800 font-mono">' + errorMessage + '</p>' +
'            </div>' +
'            <p class="text-sm text-gray-500">ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚</p>' +
'        </div>' +
'    </div>' +
'</body>' +
'</html>';
}