# 現在の作業TODO - スケジューリング & SMS機能

**作業開始**: 2025-12-07
**目標**: 今日中に全部完成

---

## 全体構成
```
Phase 1: SMS送信機能（テンプレート）
Phase 2: データ構造 & GASバックエンド
Phase 3: 業者側 - 空き枠管理UI
Phase 4: ユーザー側 - 予約ページ
Phase 5: 統合
```

---

## Phase 1: SMS送信機能 ⏳進行中
- [ ] 1-1. SMSモーダルHTML作成
- [ ] 1-2. テンプレート定義（ステータス別）
- [ ] 1-3. 変数置換ロジック（顧客名、日付等）
- [ ] 1-4. コピー/SMS/LINE/メール送信ボタン
- [ ] 1-5. 送信履歴記録（callHistory）
- [ ] 1-6. 架電後フローに組み込み

## Phase 2: データ構造 & GASバックエンド
- [ ] 2-1. スプシ設計（空き枠シート、予約シート）
- [ ] 2-2. BookingSystem.js 作成
- [ ] 2-3. setContractorAvailability() - 空き枠登録
- [ ] 2-4. getContractorAvailability() - 業者の空き取得
- [ ] 2-5. getAvailableSlotsForCase() - 案件向け全業者の空き
- [ ] 2-6. createBooking() - 予約作成
- [ ] 2-7. getBookings() - 予約一覧取得

## Phase 3: 業者側 - 空き枠管理UI
- [ ] 3-1. 設定セクション追加（スロット時間: 30分/1時間選択）
- [ ] 3-2. 週間カレンダービュー
- [ ] 3-3. 時間帯バンド（タップ/ドラッグで範囲設定）
- [ ] 3-4. 空き枠の保存API連携
- [ ] 3-5. 既存予約の表示

## Phase 4: ユーザー向け予約ページ
- [ ] 4-1. /booking/index.html 新規作成
- [ ] 4-2. URLパラメータで案件特定（cvId + token）
- [ ] 4-3. 日付縦軸 × 時間横軸のタイムラインUI
- [ ] 4-4. 業者ごとの空き枠バンド表示（色分け）
- [ ] 4-5. 枠タップで予約確認モーダル
- [ ] 4-6. 予約完了画面 & 通知

## Phase 5: 統合
- [ ] 5-1. SMSテンプレートに予約リンク追加
- [ ] 5-2. 予約完了時の業者通知
- [ ] 5-3. 案件カードに予約状況表示

---

## スプシ設計（案）

### 空き枠シート
| 列 | 内容 |
|----|------|
| A | 加盟店ID |
| B | 日付 (YYYY-MM-DD) |
| C | 開始時間 (HH:MM) |
| D | 終了時間 (HH:MM) |
| E | スロット時間（分）30/60 |
| F | ステータス (available/booked) |
| G | 更新日時 |

### 予約シート
| 列 | 内容 |
|----|------|
| A | 予約ID |
| B | cvId（案件ID） |
| C | 加盟店ID |
| D | 日付 |
| E | 時間 |
| F | ユーザー名 |
| G | 電話番号 |
| H | ステータス (confirmed/cancelled) |
| I | 作成日時 |
| J | 更新日時 |

---

## ファイル構成
```
/franchise-dashboard/
  index.html          ← 業者側UI（空き枠管理追加）

/booking/
  index.html          ← ユーザー向け予約ページ（新規）

/gas/
  systems/
    booking/
      BookingSystem.js  ← 予約関連API（新規）
  main.js              ← ルーティング追加
```

---

## 進捗メモ
-

## コミット履歴
-
