<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âä†ÁõüÂ∫óÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É† - Â§ñÂ£ÅÂ°óË£Ö„Åè„Çâ„Åπ„ÇãAI</title>
    <script src="merchant-portal/env-loader.js?v=1134"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gray: {
                            50: '#f9fafb',
                            100: '#f3f4f6',
                            200: '#e5e7eb',
                            300: '#d1d5db',
                            400: '#9ca3af',
                            500: '#6b7280',
                            600: '#4b5563',
                            700: '#374151',
                            800: '#1f2937',
                            900: '#111827',
                        }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; }
        .glass { backdrop-filter: blur(12px); }
        .section {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
            min-height: 200px;
        }
        .permission-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        /* „Éà„Ç∞„É´„Çπ„Ç§„ÉÉ„ÉÅ„ÅÆ„Çπ„Çø„Ç§„É´ */
        .toggle-switch {
            position: relative;
            appearance: none;
            width: 44px;
            height: 24px;
            background: #cbd5e0;
            border-radius: 9999px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .toggle-switch:checked {
            background: #3b82f6;
        }
        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s;
        }
        .toggle-switch:checked::after {
            transform: translateX(20px);
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900">
    <!-- „É°„Ç§„É≥„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ -->
    <div id="mainApp">
        <!-- „Éà„ÉÉ„Éó„Éê„Éº -->
        <div class="fixed top-0 left-0 right-0 z-50 h-16 bg-gray-900/95 glass border-b border-gray-200">
            <div class="flex items-center justify-between h-full px-3 sm:px-6">
                <!-- Â∑¶ÂÅ¥Ôºö„É°„Éã„É•„ÉºÔºã„É≠„Ç¥ -->
                <div class="flex items-center space-x-2 sm:space-x-3">
                    <button onclick="toggleMenu()" class="p-2 rounded-lg hover:bg-gray-800 transition-colors flex-shrink-0">
                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                    <div class="flex items-center space-x-2">
                        <div id="companyLogo" class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0">
                            <span class="text-gray-100 font-bold">Âä†</span>
                        </div>
                        <span id="systemTitle" class="hidden lg:inline text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent whitespace-nowrap">
                            Âä†ÁõüÂ∫óÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†
                        </span>
                    </div>
                </div>

                <!-- ‰∏≠Â§ÆÔºö„Çπ„ÉÜ„Éº„Çø„Çπ -->
                <div class="flex-shrink-0">
                    <div class="relative">
                        <label class="hidden sm:block text-xs text-gray-400 mb-1 text-center">„Çπ„ÉÜ„Éº„Çø„Çπ</label>
                        <span id="merchantStatus" class="px-3 py-1 text-xs font-semibold rounded-full border-2 bg-gray-100 text-gray-800 border-gray-300">
                            Ë™≠„ÅøËæº„Åø‰∏≠...
                        </span>
                    </div>
                </div>

                <!-- Âè≥ÂÅ¥ÔºöÈÄöÁü•Ôºã„É¶„Éº„Ç∂„ÉºÊÉÖÂ†± -->
                <div class="flex items-center space-x-2 sm:space-x-3">
                    <!-- Êú¨ÈÉ®„Åã„Çâ„ÅÆÈÄöÁü•„Éú„Çø„É≥ -->
                    <button onclick="toggleNotificationPanel()" class="relative p-2 rounded-lg hover:bg-gray-800 transition-colors group flex-shrink-0">
                        <svg class="w-6 h-6 text-gray-400 group-hover:text-yellow-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                        </svg>
                        <span id="notificationCount" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                    </button>
                    <!-- „Ç¢„É©„Éº„Éà„Éª„É™„Éû„Ç§„É≥„ÉÄ„Éº„Éú„Çø„É≥ -->
                    <button onclick="toggleAlertPanel()" class="relative p-2 rounded-lg hover:bg-gray-800 transition-colors group flex-shrink-0">
                        <svg class="w-6 h-6 text-gray-400 group-hover:text-blue-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        <span id="alertCount" class="absolute -top-1 -right-1 bg-blue-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                    </button>
                    <div class="text-center min-w-0">
                        <div id="userName" class="hidden sm:block text-sm text-gray-300 truncate max-w-[100px] md:max-w-none">„É¶„Éº„Ç∂„ÉºÂêç</div>
                        <div id="userRole" class="text-xs text-gray-400 cursor-pointer hover:text-gray-200 truncate max-w-[80px] sm:max-w-[100px] md:max-w-[140px]" onclick="editSalesPerson()" title="„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Á∑®ÈõÜ"></div>
                        <input id="userRoleInput" class="hidden text-xs text-gray-900 bg-white border border-gray-300 rounded px-2 py-1 w-[120px]" onblur="saveSalesPerson()" onkeydown="if(event.key==='Enter') saveSalesPerson()">
                    </div>
                </div>
            </div>
        </div>

        <!-- „Çµ„Ç§„Éâ„É°„Éã„É•„Éº -->
        <div id="sideMenu" class="fixed left-0 top-16 bottom-0 w-64 bg-gray-900/95 glass border-r border-gray-200 transform -translate-x-full transition-transform z-40">
            <nav class="p-4 space-y-2">
                <a href="#dashboard" onclick="showSection('dashboard'); return false;" class="flex items-center px-4 py-3 rounded-lg bg-gradient-to-r from-blue-600 to-blue-500 text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                    „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ
                </a>
                <a href="#cases" onclick="showSection('cases'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100 relative">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                    </svg>
                    Ê°à‰ª∂ÁÆ°ÁêÜ
                    <span id="unassignedBadge" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-red-500 text-white text-xs font-bold rounded-full px-2 py-0.5 min-w-[20px] text-center hidden">0</span>
                </a>
                <a href="#sales" onclick="showSection('sales'); return false;" class="admin-only flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    Âñ∂Ê•≠ÁÆ°ÁêÜ
                </a>
                <a href="#calendar" onclick="showSection('calendar'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    „Ç´„É¨„É≥„ÉÄ„Éº
                </a>
                <a href="#billing" onclick="showSection('billing'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Ë≤°ÂãôÁÆ°ÁêÜ
                </a>
                <a href="#deposit" onclick="showSection('deposit'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                    </svg>
                    „Éá„Éù„Ç∏„ÉÉ„Éà
                </a>
                <a href="#reports" onclick="showSection('reports'); return false;" class="admin-only flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    „É¨„Éù„Éº„Éà
                </a>
                <a href="#autodelivery" onclick="showSection('autodelivery'); return false;" class="admin-only flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                    </svg>
                    Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö
                </a>
                <a href="#company" onclick="showSection('company'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                    </svg>
                    ‰ºöÁ§æÊÉÖÂ†±
                </a>
                <a href="#cancel" onclick="showSection('cancel'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
                    </svg>
                    „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã
                </a>
                <a href="#contract" onclick="showSection('contract'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    ÊàêÁ¥ÑÂ†±Âëä
                </a>
                <a href="#settings" onclick="showSection('settings'); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-gray-100">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    Ë®≠ÂÆö
                </a>
                <a href="#" onclick="logout(); return false;" class="flex items-center px-4 py-3 rounded-lg hover:bg-red-900/50 text-gray-400 hover:text-red-400 mt-4 border-t border-gray-700 pt-4">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    „É≠„Ç∞„Ç¢„Ç¶„Éà
                </a>
            </nav>
        </div>

        <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
        <main class="pt-20 px-6" style="background: #f3f4f6; min-height: 100vh;">
            <!-- „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ -->
            <div id="dashboardSection" class="section" style="display: none;">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</h2>
                
                <!-- Áµ±Ë®à„Ç´„Éº„Éâ„Å®„Éü„Éã„Ç´„É¨„É≥„ÉÄ„Éº -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Áµ±Ë®à„Ç´„Éº„Éâ -->
                    <div class="lg:col-span-2">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex items-center">
                            <div class="p-3 bg-blue-100 rounded-full">
                                <svg class="h-8 w-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500">Êñ∞Ë¶èÊ°à‰ª∂</p>
                                <p class="text-2xl font-semibold text-gray-900">24</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex items-center">
                            <div class="p-3 bg-green-100 rounded-full">
                                <svg class="h-8 w-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500">ÊàêÁ¥ÑÁéá</p>
                                <p class="text-2xl font-semibold text-gray-900">68%</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex items-center">
                            <div class="p-3 bg-yellow-100 rounded-full">
                                <svg class="h-8 w-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500">ÂØæÂøú‰∏≠</p>
                                <p class="text-2xl font-semibold text-gray-900">15</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex items-center">
                            <div class="p-3 bg-purple-100 rounded-full">
                                <svg class="h-8 w-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500">Âñ∂Ê•≠„É°„É≥„Éê„Éº</p>
                                <p class="text-2xl font-semibold text-gray-900">8</p>
                            </div>
                        </div>
                    </div>
                        </div>
                    </div>
                    
                    <!-- „Éü„Éã„Ç´„É¨„É≥„ÉÄ„Éº -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">‰ªäÊúà„ÅÆ‰∫àÂÆö</h3>
                            <button onclick="showSection('calendar')" class="text-sm text-blue-600 hover:text-blue-800">ÂÖ®„Å¶Ë°®Á§∫</button>
                        </div>
                        <div id="miniCalendar" class="text-sm">
                            <!-- „Éü„Éã„Ç´„É¨„É≥„ÉÄ„Éº„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
                        </div>
                        <div class="mt-4 space-y-2">
                            <div class="flex items-center p-2 bg-blue-50 rounded">
                                <div class="w-2 h-2 bg-blue-500 rounded-full mr-2"></div>
                                <div class="flex-1">
                                    <div class="text-sm font-medium">Áî∞‰∏≠Êßò ÁèæÂú∞Ë™øÊüª</div>
                                    <div class="text-xs text-gray-500">‰ªäÊó• 14:00-15:00</div>
                                </div>
                            </div>
                            <div class="flex items-center p-2 bg-green-50 rounded">
                                <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                <div class="flex-1">
                                    <div class="text-sm font-medium">‰ΩêËó§Êßò Â∑•‰∫ãÈñãÂßã</div>
                                    <div class="text-xs text-gray-500">ÊòéÊó• 9:00-</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÊúÄËøë„ÅÆÊ°à‰ª∂ -->
                <div class="bg-white shadow rounded-lg p-4 sm:p-6">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">ÊúÄËøë„ÅÆÊ°à‰ª∂</h3>
                    <!-- „Çπ„Éû„ÉõÔºöÊ®™„Çπ„ÇØ„É≠„Éº„É´ / „Çø„Éñ„É¨„ÉÉ„Éà‰ª•‰∏äÔºö„Ç∞„É™„ÉÉ„Éâ -->
                    <div class="sm:grid sm:grid-cols-2 lg:grid-cols-3 sm:gap-4 flex sm:flex-none overflow-x-auto gap-3 pb-2 -mx-4 px-4 sm:mx-0 sm:px-0">
                        <!-- Ê°à‰ª∂„Ç´„Éº„Éâ1 -->
                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow min-w-[280px] sm:min-w-0">
                            <div class="flex justify-between items-start mb-3">
                                <div class="font-semibold text-gray-900">#2024-001</div>
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">ÊàêÁ¥Ñ</span>
                            </div>
                            <div class="space-y-2">
                                <div class="flex items-center text-sm">
                                    <span class="text-gray-500 w-16">È°ßÂÆ¢:</span>
                                    <span class="text-gray-900 font-medium">Â±±Áî∞Â§™ÈÉé</span>
                                </div>
                                <div class="flex items-center text-sm">
                                    <span class="text-gray-500 w-16">ÊãÖÂΩì:</span>
                                    <span class="text-gray-700">Áî∞‰∏≠Âñ∂Ê•≠</span>
                                </div>
                                <div class="flex items-center text-sm">
                                    <span class="text-gray-500 w-16">Êõ¥Êñ∞Êó•:</span>
                                    <span class="text-gray-700">2024/01/15</span>
                                </div>
                            </div>
                        </div>

                        <!-- Ê°à‰ª∂„Ç´„Éº„Éâ2 -->
                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow min-w-[280px] sm:min-w-0">
                            <div class="flex justify-between items-start mb-3">
                                <div class="font-semibold text-gray-900">#2024-002</div>
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">„Éí„Ç¢„É™„É≥„Ç∞‰∏≠</span>
                            </div>
                            <div class="space-y-2">
                                <div class="flex items-center text-sm">
                                    <span class="text-gray-500 w-16">È°ßÂÆ¢:</span>
                                    <span class="text-gray-900 font-medium">Èà¥Êú®Ëä±Â≠ê</span>
                                </div>
                                <div class="flex items-center text-sm">
                                    <span class="text-gray-500 w-16">ÊãÖÂΩì:</span>
                                    <span class="text-gray-700">‰ΩêËó§Âñ∂Ê•≠</span>
                                </div>
                                <div class="flex items-center text-sm">
                                    <span class="text-gray-500 w-16">Êõ¥Êñ∞Êó•:</span>
                                    <span class="text-gray-700">2024/01/14</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- dashboardSection„ÅÆÁµÇ‰∫Ü -->

            <!-- Âñ∂Ê•≠ÁÆ°ÁêÜ„Çª„ÇØ„Ç∑„Éß„É≥ÔºàÁÆ°ÁêÜËÄÖ„ÅÆ„ÅøÔºâ -->
            <div id="salesSection" class="section" style="display: none;">
                <div class="mb-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">Âñ∂Ê•≠ÁÆ°ÁêÜ</h2>
                    <button onclick="openPermissionModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        Êñ∞Ë¶èÂñ∂Ê•≠ËøΩÂä†
                    </button>
                </div>

                <!-- Âñ∂Ê•≠„É°„É≥„Éê„Éº„É™„Çπ„Éà -->
                <div class="bg-white shadow rounded-lg">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÂêçÂâç</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ê®©Èôê„É¨„Éô„É´</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÊàêÁ¥ÑÊï∞</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÊàêÁ¥ÑÁéá</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">„Ç¢„ÇØ„Ç∑„Éß„É≥</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Áî∞‰∏≠Â§™ÈÉé</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800">„É™„Éº„ÉÄ„Éº</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">45</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">75%</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">
                                    <button onclick="editPermissions('Áî∞‰∏≠Â§™ÈÉé')" class="text-blue-600 hover:text-blue-900 mr-3">Ê®©ÈôêÁ∑®ÈõÜ</button>
                                    <button onclick="confirmDeleteSales('Áî∞‰∏≠Â§™ÈÉé')" class="text-red-600 hover:text-red-900">ÂâäÈô§</button>
                                </td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">‰ΩêËó§Ëä±Â≠ê</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">‰∏ÄËà¨Âñ∂Ê•≠</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">28</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">62%</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">
                                    <button onclick="editPermissions('‰ΩêËó§Ëä±Â≠ê')" class="text-blue-600 hover:text-blue-900 mr-3">Ê®©ÈôêÁ∑®ÈõÜ</button>
                                    <button onclick="confirmDeleteSales('‰ΩêËó§Ëä±Â≠ê')" class="text-red-600 hover:text-red-900">ÂâäÈô§</button>
                                </td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Èà¥Êú®Ê¨°ÈÉé</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">‰∏ÄËà¨‰∫ãÂãô</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">
                                    <button onclick="editPermissions('Èà¥Êú®Ê¨°ÈÉé')" class="text-blue-600 hover:text-blue-900 mr-3">Ê®©ÈôêÁ∑®ÈõÜ</button>
                                    <button onclick="confirmDeleteSales('Èà¥Êú®Ê¨°ÈÉé')" class="text-red-600 hover:text-red-900">ÂâäÈô§</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div><!-- salesSection„ÅÆÁµÇ‰∫Ü -->

            <!-- Ê°à‰ª∂ÁÆ°ÁêÜ„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="casesSection" class="section" style="display: none;">
                <!-- Êú™ÊåØ„ÇäÂàÜ„ÅëÊ°à‰ª∂„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div id="unassignedCasesSection" class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6 hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                            Êú™ÊåØ„ÇäÂàÜ„ÅëÊ°à‰ª∂
                        </h3>
                        <button onclick="openAssignmentModal()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center text-sm">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                            Ê°à‰ª∂„ÇíÊåØ„ÇäÂàÜ„Åë„Çã
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3" id="unassignedCasesList">
                        <!-- Êú™ÊåØ„ÇäÂàÜ„ÅëÊ°à‰ª∂„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                    </div>
                </div>

                <div class="mb-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">Ê°à‰ª∂ÁÆ°ÁêÜ</h2>
                    <div class="flex items-center space-x-2">
                        <button onclick="toggleCaseView()" class="p-2 text-gray-500 hover:text-gray-700 bg-white rounded-lg shadow">
                            <svg id="viewIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- „Éï„Ç£„É´„Çø„Éº„ÉªÁµ±Ë®à„Éê„Éº -->
                <div class="bg-white rounded-lg p-4 mb-4 shadow">
                    <div class="flex flex-wrap items-center gap-3">
                        <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÂà•Áµ±Ë®à -->
                        <button onclick="filterCases('all')" class="filter-stat-btn flex items-center space-x-2 px-3 py-2 bg-gray-100 rounded-lg hover:bg-gray-200 transition">
                            <span class="text-lg font-bold" id="count-all">0</span>
                            <span class="text-xs">ÂÖ®‰ª∂</span>
                        </button>
                        <button onclick="filterCases('Êú™ÂØæÂøú')" class="filter-stat-btn flex items-center space-x-2 px-3 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition">
                            <span class="text-lg font-bold" id="count-Êú™ÂØæÂøú">0</span>
                            <span class="text-xs">Êú™ÂØæÂøú</span>
                        </button>
                        <button onclick="filterCases('„Ç¢„ÉùÊ∏à')" class="filter-stat-btn flex items-center space-x-2 px-3 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition">
                            <span class="text-lg font-bold" id="count-„Ç¢„ÉùÊ∏à">0</span>
                            <span class="text-xs">„Ç¢„ÉùÊ∏à</span>
                        </button>
                        <button onclick="filterCases('Ë¶ãÁ©çÊèêÂá∫Ê∏à')" class="filter-stat-btn flex items-center space-x-2 px-3 py-2 bg-yellow-100 text-yellow-700 rounded-lg hover:bg-yellow-200 transition">
                            <span class="text-lg font-bold" id="count-Ë¶ãÁ©çÊèêÂá∫Ê∏à">0</span>
                            <span class="text-xs">Ë¶ãÁ©çÊèêÂá∫Ê∏à</span>
                        </button>
                        <button onclick="filterCases('ÊàêÁ¥Ñ')" class="filter-stat-btn flex items-center space-x-2 px-3 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition">
                            <span class="text-lg font-bold" id="count-ÊàêÁ¥Ñ">0</span>
                            <span class="text-xs">ÊàêÁ¥Ñ</span>
                        </button>

                        <div class="flex-1"></div>

                        <!-- Ê§úÁ¥¢„Éª„ÇΩ„Éº„Éà -->
                        <input type="text" id="caseSearchInput" placeholder="È°ßÂÆ¢Âêç„Éª‰ΩèÊâÄ„ÅßÊ§úÁ¥¢..."
                               class="px-3 py-2 border rounded-lg text-sm w-48" onkeyup="searchCases()">
                        <select id="caseSortSelect" onchange="sortCases()" class="px-3 py-2 border rounded-lg text-sm">
                            <option value="date_desc">ÁôªÈå≤Êó•È†ÜÔºàÊñ∞„Åó„ÅÑÈ†ÜÔºâ</option>
                            <option value="date_asc">ÁôªÈå≤Êó•È†ÜÔºàÂè§„ÅÑÈ†ÜÔºâ</option>
                            <option value="status">„Çπ„ÉÜ„Éº„Çø„ÇπÈ†Ü</option>
                        </select>
                    </div>
                </div>

                <!-- „Ç´„Éº„Éâ„Éì„É•„Éº -->
                <div id="caseCardView" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Ê°à‰ª∂„Ç´„Éº„Éâ„ÅØÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Åæ„Åô -->
                </div>

                <!-- „É™„Çπ„Éà„Éì„É•„ÉºÔºàÂàùÊúüÈùûË°®Á§∫Ôºâ -->
                <div id="caseListView" class="bg-white rounded-lg shadow overflow-hidden" style="display: none;">
                    <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                                <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">È°ßÂÆ¢Âêç</th>
                                <th class="hidden md:table-cell px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">‰ΩèÊâÄ</th>
                                <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">ÈõªË©±Áï™Âè∑</th>
                                <th class="hidden lg:table-cell px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">ÊúÄÁµÇÈÄ£Áµ°</th>
                                <th class="hidden md:table-cell px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">Ê¨°Âõû„Ç¢„ÇØ„Ç∑„Éß„É≥</th>
                                <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">„Ç¢„ÇØ„Ç∑„Éß„É≥</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td class="px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap">
                                    <span class="px-1 sm:px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Êú™ÂØæÂøú</span>
                                </td>
                                <td class="px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-sm">Â±±Áî∞Â§™ÈÉé</td>
                                <td class="hidden md:table-cell px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-sm text-gray-500">Êù±‰∫¨ÈÉΩ‰∏ñÁî∞Ë∞∑Âå∫</td>
                                <td class="px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500">03-1234-5678</td>
                                <td class="hidden lg:table-cell px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-sm text-gray-500">1/15 ÂïèÂêà„Åõ</td>
                                <td class="hidden md:table-cell px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-sm text-gray-500">1/18 14:00 ÈõªË©±</td>
                                <td class="px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-sm font-medium">
                                    <button onclick="callCustomer('03-1234-5678')" class="text-green-600 hover:text-green-900 mr-2">üìû</button>
                                    <button onclick="showCaseDetail(1)" class="text-blue-600 hover:text-blue-900">Ë©≥Á¥∞</button>
                                </td>
                            </tr>
                            <tr>
                                <td class="px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap">
                                    <span class="px-1 sm:px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">„Ç¢„ÉùÊ∏à</span>
                                </td>
                                <td class="px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-sm">Èà¥Êú®Ëä±Â≠ê</td>
                                <td class="hidden md:table-cell px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-sm text-gray-500">Á•ûÂ•àÂ∑ùÁúåÊ®™ÊµúÂ∏Ç</td>
                                <td class="px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500">045-9876-5432</td>
                                <td class="hidden lg:table-cell px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-sm text-gray-500">1/16 „Ç¢„ÉùÂèñÂæó</td>
                                <td class="hidden md:table-cell px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-sm text-gray-500">1/20 14:00 ÁèæË™ø</td>
                                <td class="px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-sm font-medium">
                                    <button onclick="callCustomer('045-9876-5432')" class="text-green-600 hover:text-green-900 mr-2">üìû</button>
                                    <button onclick="showCaseDetail(2)" class="text-blue-600 hover:text-blue-900">Ë©≥Á¥∞</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    </div>
                </div>
            </div><!-- casesSection„ÅÆÁµÇ‰∫Ü -->

            <!-- Ë≤°ÂãôÁÆ°ÁêÜ„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="billingSection" class="section" style="display: none;">
                <div class="mb-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">Ë≤°ÂãôÁÆ°ÁêÜ</h2>
                    <div class="flex space-x-2">
                        <button onclick="exportFinancialReport()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
                            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            CSVÂá∫Âäõ
                        </button>
                    </div>
                </div>

                <!-- „Çµ„Éû„É™„Éº„Ç´„Éº„Éâ -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500" id="referralFeeMonth">1ÊúàÁ¥π‰ªãÊñô</p>
                                <p class="text-2xl font-bold text-gray-900" id="referralFeeAmount">¬•132,000</p>
                                <p class="text-xs text-gray-500" id="referralFeeCases">Ê°à‰ª∂6‰ª∂ÂàÜ</p>
                            </div>
                            <div class="p-3 bg-blue-100 rounded-full">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500" id="commissionMonth">1ÊúàÊàêÁ¥ÑÊâãÊï∞Êñô</p>
                                <p class="text-2xl font-bold text-green-600" id="commissionAmount">¬•180,000</p>
                                <p class="text-xs text-gray-500" id="commissionCases">ÊàêÁ¥Ñ2‰ª∂ÂàÜ</p>
                            </div>
                            <div class="p-3 bg-green-100 rounded-full">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500" id="profitLabel">Á¥ØË®àÂà©Áõä</p>
                                <p class="text-2xl font-bold text-yellow-600" id="profitAmount">¬•650,000</p>
                                <p class="text-xs text-gray-500" id="profitPeriod">2025Âπ¥Â∫¶</p>
                            </div>
                            <div class="p-3 bg-yellow-100 rounded-full">
                                <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500" id="roiLabel">1ÊúàROI</p>
                                <p class="text-2xl font-bold text-blue-600" id="roiValue">3265%</p>
                                <p class="text-xs text-gray-500" id="roiPrevious">ÂâçÊúà: 2850%</p>
                            </div>
                            <div class="p-3 bg-red-100 rounded-full">
                                <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
                <div class="bg-white rounded-lg shadow mb-6">
                    <div class="border-b border-gray-200">
                        <nav class="flex -mb-px">
                            <button onclick="showBillingTab('purchase')" class="billing-tab billing-tab-active px-6 py-3 border-b-2 font-medium text-sm" data-tab="purchase">
                                Á¥π‰ªãÊñôÂ±•Ê≠¥
                            </button>
                            <button onclick="showBillingTab('commission')" class="billing-tab px-6 py-3 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700" data-tab="commission">
                                ÊàêÁ¥ÑÊâãÊï∞Êñô
                            </button>
                            <button onclick="showBillingTab('payment')" class="billing-tab px-6 py-3 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700" data-tab="payment">
                                ÊîØÊâïÂ±•Ê≠¥
                            </button>
                            <button onclick="showBillingTab('analysis')" class="billing-tab px-6 py-3 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700" data-tab="analysis">
                                ÂèéÊîØÂàÜÊûê
                            </button>
                        </nav>
                    </div>

                    <!-- Á¥π‰ªãÊñôÂ±•Ê≠¥„Çø„Éñ -->
                    <div id="purchaseTab" class="billing-tab-content p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">Á¥π‰ªãÊñôÊîØÊâïÂ±•Ê≠¥</h3>
                            <div class="flex items-center space-x-4">
                                <div class="text-sm bg-blue-50 px-3 py-1 rounded">
                                    <span class="text-gray-600">„Éá„Éù„Ç∏„ÉÉ„ÉàÊÆãÈ´ò:</span>
                                    <span class="font-bold text-blue-600">¬•440,000</span>
                                    <span class="text-gray-500">(20‰ª∂ÂàÜ)</span>
                                </div>
                                <input type="month" value="2025-01" onchange="updateFinancialData(this.value)" class="border rounded px-3 py-1 text-sm">
                            </div>
                        </div>

                        <!-- ÊîØÊâï„ÅÑ„Çπ„Ç±„Ç∏„É•„Éº„É´ÊÉÖÂ†± -->
                        <div class="bg-blue-50 p-3 rounded-lg mb-4 text-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <span class="font-medium text-blue-800">ÊîØÊâïÊù°‰ª∂:</span>
                                    <span class="text-blue-700 ml-2">ÊúàÊú´Á∑†„ÇÅ</span>
                                </div>
                                <div class="text-right">
                                    <span class="text-blue-700">ÊåØËæº: ÁøåÊúà15Êó• / Âè£Â∫ßÂºïËêΩ: ÁøåÊúà27Êó•</span>
                                    <span class="text-gray-600 text-xs ml-2">(ÂúüÊó•Á•ù„ÅØÁøåÂñ∂Ê•≠Êó•)</span>
                                </div>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Á¥π‰ªãÊó•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ê°à‰ª∂ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">È°ßÂÆ¢Âêç</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Áâ©‰ª∂Á®ÆÂà•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Â∑•‰∫ãÂÜÖÂÆπ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Á¥π‰ªãÊñô</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊîØÊâï‰∫àÂÆöÊó•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊîØÊâïÁä∂Ê≥Å</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊàêÁ¥ÑÈ°ç/ROI</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">Ë©≥Á¥∞</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/15</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#C2025-001</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Áî∞‰∏≠Êßò</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Êà∏Âª∫„Å¶</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Â§ñÂ£ÅÂ°óË£Ö„ÉªÂ±ãÊ†πÂ°óË£Ö</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•22,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2/15(Âúü)‚Üí17(Êúà)</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Ë´ãÊ±ÇÂæÖ„Å°</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">‰∫§Ê∏â‰∏≠</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                                            <button onclick="showCaseDetail(1)" class="text-blue-600 hover:text-blue-900">Ë©≥Á¥∞</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50 bg-green-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/10</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#C2025-002</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">‰ΩêËó§Êßò</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">‰∏ÄÊà∏Âª∫„Å¶</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Â§ñÂ£ÅÂ°óË£Ö</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•22,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2/15(Âúü)‚Üí17(Êúà)</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÊîØÊâïÊ∏à</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            <div class="text-xs">¬•1.2M</div>
                                            <div class="text-green-600 font-bold text-xs">3636%</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                                            <button onclick="showCaseDetail(2)" class="text-blue-600 hover:text-blue-900">Ë©≥Á¥∞</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50 bg-green-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/08</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#C2025-003</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Èà¥Êú®Êßò</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Êà∏Âª∫„Å¶</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Â±ãÊ†πËë∫„ÅçÊõø„ÅàÔºàÁì¶Ôºâ</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•22,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2/27(Êú®)</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÊîØÊâïÊ∏à</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            <div class="text-xs">¬•800K</div>
                                            <div class="text-green-600 font-bold text-xs">3636%</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                                            <button onclick="showCaseDetail(3)" class="text-blue-600 hover:text-blue-900">Ë©≥Á¥∞</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- ÊàêÁ¥ÑÊâãÊï∞Êñô„Çø„Éñ -->
                    <div id="commissionTab" class="billing-tab-content p-6" style="display: none;">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">ÊàêÁ¥ÑÊâãÊï∞ÊñôÊîØÊâïÂ±•Ê≠¥</h3>
                            <div class="flex space-x-2">
                                <select class="border rounded px-3 py-1 text-sm">
                                    <option>ÂÖ®„Å¶</option>
                                    <option>ÊîØÊâïÊ∏à</option>
                                    <option>Êú™Êâï„ÅÑ</option>
                                </select>
                                <input type="month" value="2025-01" class="border rounded px-3 py-1 text-sm">
                            </div>
                        </div>

                        <!-- ÊîØÊâï„ÅÑ„Çπ„Ç±„Ç∏„É•„Éº„É´ÊÉÖÂ†± -->
                        <div class="bg-yellow-50 p-3 rounded-lg mb-4 text-sm">
                            <span class="font-medium text-yellow-800">ÊîØÊâïÊù°‰ª∂:</span>
                            <span class="text-yellow-700">Ë´ãÊ±ÇÊõ∏Áô∫Ë°å„Åã„Çâ3Âñ∂Ê•≠Êó•‰ª•ÂÜÖ</span>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊàêÁ¥ÑÊó•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ê°à‰ª∂ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">È°ßÂÆ¢Âêç</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊàêÁ¥ÑÈáëÈ°ç</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊâãÊï∞ÊñôÁéá</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊâãÊï∞ÊñôÈ°ç(Á®éËæº)</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊîØÊâïÊúüÊó•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊîØÊâïÁä∂Ê≥Å</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ë´ãÊ±ÇÊõ∏</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr class="hover:bg-gray-50 bg-green-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/10</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#C2025-002</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">‰ΩêËó§Êßò</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•1,200,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">10%</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•132,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/31</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÊîØÊâïÊ∏à</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button onclick="downloadInvoicePDF('INV-2025-0102')" class="text-blue-600 hover:text-blue-900">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50 bg-green-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/08</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#C2025-003</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Èà¥Êú®Êßò</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•800,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">10%</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•88,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/31</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÊîØÊâïÊ∏à</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button onclick="downloadInvoicePDF('INV-2025-0103')" class="text-blue-600 hover:text-blue-900">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/05</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#C2024-845</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">È´òÊ©ãÊßò</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•550,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">10%</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-red-600">¬•60,500</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/25</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Ë´ãÊ±ÇÂæÖ„Å°</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button onclick="viewInvoice('INV-2025-0104')" class="text-blue-600 hover:text-blue-900">Á¢∫Ë™ç</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2024/12/28</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#C2024-810</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Â±±Áî∞Êßò</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•950,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">10%</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•104,500</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/15</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÊîØÊâïÊ∏à</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button onclick="downloadInvoicePDF('INV-2024-1228')" class="text-blue-600 hover:text-blue-900">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- ÊîØÊâïÂ±•Ê≠¥„Çø„Éñ -->
                    <div id="paymentTab" class="billing-tab-content p-6" style="display: none;">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">ÊîØÊâïÂ±•Ê≠¥</h3>
                            <div class="flex space-x-2">
                                <select class="border rounded px-3 py-1 text-sm">
                                    <option>ÂÖ®„Å¶</option>
                                    <option>Á¥π‰ªãÊñô</option>
                                    <option>ÊàêÁ¥ÑÊâãÊï∞Êñô</option>
                                    <option>„Åù„ÅÆ‰ªñ</option>
                                </select>
                                <input type="month" value="2025-01" class="border rounded px-3 py-1 text-sm">
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊîØÊâïÊó•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ë´ãÊ±ÇÊõ∏Áï™Âè∑</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Á®ÆÂà•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÂÜÖÂÆπ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊîØÊâïÈ°ç(Á®éËæº)</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊîØÊâïÊñπÊ≥ï</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">È†òÂèéÊõ∏</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/15</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">INV-2025-0156</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Á¥π‰ªãÊñô</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Ê°à‰ª∂#C2025-001 Áî∞‰∏≠ÊßòÔºàÂ§ñÂ£ÅÂ°óË£ÖÔºâ</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•22,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ÈäÄË°åÊåØËæº</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÆå‰∫Ü</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button onclick="downloadReceipt('RCP-2025-0156')" class="text-blue-600 hover:text-blue-900">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/10</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">INV-2025-0145</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Á¥π‰ªãÊñô</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Ê°à‰ª∂#C2025-002 ‰ΩêËó§ÊßòÔºàÂ§ñÂ£ÅÂ°óË£ÖÔºâ</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•22,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ÈäÄË°åÊåØËæº</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÆå‰∫Ü</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button onclick="downloadReceipt('RCP-2025-0145')" class="text-blue-600 hover:text-blue-900">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/10</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">INV-2025-0102</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ÊàêÁ¥ÑÊâãÊï∞Êñô</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">‰ΩêËó§ÊßòÊ°à‰ª∂ ÊàêÁ¥ÑÊâãÊï∞Êñô</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•132,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ÈäÄË°åÊåØËæº</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÆå‰∫Ü</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button onclick="downloadReceipt('RCP-2025-0102')" class="text-blue-600 hover:text-blue-900">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/08</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">INV-2025-0103</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ÊàêÁ¥ÑÊâãÊï∞Êñô</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Èà¥Êú®ÊßòÊ°à‰ª∂ ÊàêÁ¥ÑÊâãÊï∞Êñô</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•88,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ÈäÄË°åÊåØËæº</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÆå‰∫Ü</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button onclick="downloadReceipt('RCP-2025-0103')" class="text-blue-600 hover:text-blue-900">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/05</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">INV-2025-0133</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Á¥π‰ªãÊñô</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Ê°à‰ª∂#C2024-098 ÊùëÁî∞ÊßòÔºà„É¢„É´„Çø„É´Â§ñÂ£ÅÔºâ</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">¬•22,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ÈäÄË°åÊåØËæº</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÆå‰∫Ü</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button onclick="downloadReceipt('RCP-2025-0133')" class="text-blue-600 hover:text-blue-900">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- ÂèéÊîØÂàÜÊûê„Çø„Éñ -->
                    <div id="analysisTab" class="billing-tab-content p-6" style="display: none;">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold">ÂèéÊîØÂàÜÊûê</h3>
                            <select class="border rounded px-3 py-1 text-sm">
                                <option>2025Âπ¥1Êúà</option>
                                <option>2024Âπ¥12Êúà</option>
                                <option>2024Âπ¥11Êúà</option>
                            </select>
                        </div>

                        <!-- ÊúàÈñì„Çµ„Éû„É™„Éº -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div class="bg-white border rounded-lg p-4">
                                <div class="text-sm text-gray-500 mb-1">Â£≤‰∏äÈ´ò</div>
                                <div class="text-2xl font-bold text-gray-900">¬•3,550,000</div>
                                <div class="text-xs text-green-600 mt-1">+12% ÂâçÊúàÊØî</div>
                            </div>
                            <div class="bg-white border rounded-lg p-4">
                                <div class="text-sm text-gray-500 mb-1">ÊîØÂá∫ÂêàË®à</div>
                                <div class="text-2xl font-bold text-gray-900">¬•625,000</div>
                                <div class="text-xs text-red-600 mt-1">+8% ÂâçÊúàÊØî</div>
                            </div>
                            <div class="bg-white border rounded-lg p-4">
                                <div class="text-sm text-gray-500 mb-1">Á≤óÂà©Áõä</div>
                                <div class="text-2xl font-bold text-green-600">¬•2,925,000</div>
                                <div class="text-xs text-green-600 mt-1">+14% ÂâçÊúàÊØî</div>
                            </div>
                            <div class="bg-white border rounded-lg p-4">
                                <div class="text-sm text-gray-500 mb-1">ROI</div>
                                <div class="text-2xl font-bold text-blue-600">468%</div>
                                <div class="text-xs text-green-600 mt-1">ÂÑ™ËâØ</div>
                            </div>
                        </div>

                        <!-- ÂèéÊîØÂÜÖË®≥ -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <!-- ÂèéÂÖ•ÂÜÖË®≥ -->
                            <div class="bg-white border rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-3">ÂèéÂÖ•ÂÜÖË®≥</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center">
                                            <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                            <span class="text-sm text-gray-700">Â∑•‰∫ãÂ£≤‰∏ä</span>
                                        </div>
                                        <span class="text-sm font-semibold">¬•3,350,000</span>
                                    </div>
                                    <div class="pt-3 mt-3 border-t flex justify-between">
                                        <span class="text-sm font-semibold text-gray-700">ÂêàË®à</span>
                                        <span class="text-sm font-bold text-green-600">¬•3,350,000</span>
                                    </div>
                                </div>
                            </div>

                            <!-- ÊîØÂá∫ÂÜÖË®≥ -->
                            <div class="bg-white border rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-3">ÊîØÂá∫ÂÜÖË®≥</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center">
                                            <div class="w-2 h-2 bg-red-500 rounded-full mr-2"></div>
                                            <span class="text-sm text-gray-700">Á¥π‰ªãÊñô</span>
                                        </div>
                                        <span class="text-sm font-semibold">¬•176,000</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center">
                                            <div class="w-2 h-2 bg-orange-500 rounded-full mr-2"></div>
                                            <span class="text-sm text-gray-700">ÊàêÁ¥ÑÊâãÊï∞Êñô</span>
                                        </div>
                                        <span class="text-sm font-semibold">¬•325,000</span>
                                    </div>
                                    <div class="pt-3 mt-3 border-t flex justify-between">
                                        <span class="text-sm font-semibold text-gray-700">ÂêàË®à</span>
                                        <span class="text-sm font-bold text-red-600">¬•501,000</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Ê°à‰ª∂Âà•ÂèéÊîØ -->
                        <div class="bg-white border rounded-lg p-4">
                            <h4 class="font-semibold text-gray-900 mb-3">Ê°à‰ª∂Âà•ÂèéÊîØTOP5</h4>
                            <div class="overflow-x-auto">
                                <table class="min-w-full">
                                    <thead class="border-b">
                                        <tr>
                                            <th class="text-left text-xs font-medium text-gray-500 uppercase pb-2">Ê°à‰ª∂</th>
                                            <th class="text-right text-xs font-medium text-gray-500 uppercase pb-2">Á¥π‰ªãÊñô</th>
                                            <th class="text-right text-xs font-medium text-gray-500 uppercase pb-2">Â£≤‰∏ä</th>
                                            <th class="text-right text-xs font-medium text-gray-500 uppercase pb-2">ÊâãÊï∞Êñô</th>
                                            <th class="text-right text-xs font-medium text-gray-500 uppercase pb-2">Âà©Áõä</th>
                                            <th class="text-right text-xs font-medium text-gray-500 uppercase pb-2">ROI</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        <tr>
                                            <td class="py-2 text-sm text-gray-900">‰ΩêËó§ÊßòÊ°à‰ª∂</td>
                                            <td class="py-2 text-sm text-right">¬•22,000</td>
                                            <td class="py-2 text-sm text-right">¬•1,200,000</td>
                                            <td class="py-2 text-sm text-right">¬•132,000</td>
                                            <td class="py-2 text-sm text-right font-semibold text-green-600">¬•1,046,000</td>
                                            <td class="py-2 text-sm text-right font-bold text-blue-600">4755%</td>
                                        </tr>
                                        <tr>
                                            <td class="py-2 text-sm text-gray-900">Èà¥Êú®ÊßòÊ°à‰ª∂</td>
                                            <td class="py-2 text-sm text-right">¬•22,000</td>
                                            <td class="py-2 text-sm text-right">¬•800,000</td>
                                            <td class="py-2 text-sm text-right">¬•88,000</td>
                                            <td class="py-2 text-sm text-right font-semibold text-green-600">¬•690,000</td>
                                            <td class="py-2 text-sm text-right font-bold text-blue-600">800%</td>
                                        </tr>
                                        <tr>
                                            <td class="py-2 text-sm text-gray-900">Â±±Áî∞ÊßòÊ°à‰ª∂</td>
                                            <td class="py-2 text-sm text-right">¬•85,000</td>
                                            <td class="py-2 text-sm text-right">¬•950,000</td>
                                            <td class="py-2 text-sm text-right">¬•95,000</td>
                                            <td class="py-2 text-sm text-right font-semibold text-green-600">¬•770,000</td>
                                            <td class="py-2 text-sm text-right font-bold text-blue-600">906%</td>
                                        </tr>
                                        <tr>
                                            <td class="py-2 text-sm text-gray-900">È´òÊ©ãÊßòÊ°à‰ª∂</td>
                                            <td class="py-2 text-sm text-right">¬•75,000</td>
                                            <td class="py-2 text-sm text-right">¬•600,000</td>
                                            <td class="py-2 text-sm text-right">¬•60,000</td>
                                            <td class="py-2 text-sm text-right font-semibold text-green-600">¬•465,000</td>
                                            <td class="py-2 text-sm text-right font-bold text-blue-600">620%</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                </div>
            </div><!-- billingSection„ÅÆÁµÇ‰∫Ü -->

            <!-- „Éá„Éù„Ç∏„ÉÉ„Éà„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="depositSection" class="section" style="display: none;">
                <div class="mb-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">„Éá„Éù„Ç∏„ÉÉ„ÉàÁÆ°ÁêÜ</h2>
                    <div class="flex space-x-2">
                        <button onclick="showDepositModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">
                            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            „Éá„Éù„Ç∏„ÉÉ„ÉàËøΩÂä†
                        </button>
                    </div>
                </div>

                <!-- „Éá„Éù„Ç∏„ÉÉ„ÉàÁä∂Ê≥Å„Çµ„Éû„É™„Éº -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white border-2 border-blue-200 rounded-lg shadow p-4">
                        <div class="text-sm text-gray-600 mb-1">„Éá„Éù„Ç∏„ÉÉ„ÉàÊÆãÈ´ò</div>
                        <div class="text-3xl font-bold text-blue-600">20/25‰ª∂</div>
                        <div class="text-sm text-gray-500 mt-1">¬•440,000 ÊÆãÈ´ò</div>
                    </div>
                    <div class="bg-white border rounded-lg shadow p-4">
                        <div class="text-sm text-gray-600 mb-1">ÊúâÂäπÊúüÈôê</div>
                        <div class="text-2xl font-bold text-gray-900">2025/03/31</div>
                        <div class="text-sm text-orange-600 mt-1">ÊÆã„Çä45Êó•</div>
                    </div>
                    <div class="bg-white border rounded-lg shadow p-4">
                        <div class="text-sm text-gray-600 mb-1">ÁèæÂú®„ÅÆË®≠ÂÆö</div>
                        <div class="text-2xl font-bold text-green-600">Áπ∞Ë∂ä</div>
                        <div class="text-sm text-gray-500 mt-1">ÊúÄÁµÇÊõ¥Êñ∞: 2025/01/17</div>
                    </div>
                    <div class="bg-white border rounded-lg shadow p-4">
                        <div class="text-sm text-gray-600 mb-1">Ë°®Á§∫„É©„É≥„ÇØ</div>
                        <div class="text-2xl font-bold text-purple-600">ÂÑ™ÂÖà+1</div>
                        <div class="text-sm text-gray-500 mt-1">„Éá„Éù„Ç∏„ÉÉ„ÉàÁâπÂÖ∏ÈÅ©Áî®‰∏≠</div>
                    </div>
                </div>

                <!-- „É©„É≥„Ç≠„É≥„Ç∞ÁâπÂÖ∏Ë™¨Êòé -->
                <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg shadow mb-6 p-6">
                    <div class="flex items-start">
                        <svg class="w-8 h-8 text-purple-600 mr-3 mt-1" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">„Éá„Éù„Ç∏„ÉÉ„ÉàË≥ºÂÖ•ÁâπÂÖ∏</h3>
                            <p class="text-sm text-gray-700 mb-3">
                                „Éá„Éù„Ç∏„ÉÉ„Éà„ÇíË≥ºÂÖ•„Åô„Çã„Å®„ÄÅ„É¶„Éº„Ç∂„Éº„Å∏Ë°®Á§∫„Åï„Çå„Çã„É©„É≥„Ç≠„É≥„Ç∞„Åå<span class="font-bold text-purple-600">ÂÖ®„Å¶UP</span>„Åï„Çå„ÄÅ
                                „Çà„ÇäËâØ„ÅÑÊù°‰ª∂„ÅßÊ°à‰ª∂„Åå‰æõÁµ¶„Åï„Çå„ÇÑ„Åô„Åè„Å™„Çä„Åæ„Åô„ÄÇ
                            </p>
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-3">
                                <div class="flex items-start">
                                    <svg class="w-5 h-5 text-yellow-600 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                    </svg>
                                    <div class="text-sm text-yellow-800">
                                        <p class="font-medium">„Éá„Éù„Ç∏„ÉÉ„ÉàÈÅ©Áî®ÂØæË±°</p>
                                        <p class="text-xs mt-1">„Éá„Éù„Ç∏„ÉÉ„Éà„ÅØÂü∫Êú¨Á¥π‰ªãÊñô¬•22,000„ÅÆÊ°à‰ª∂„ÅÆ„Åø„Å´ÈÅ©Áî®„Åï„Çå„Åæ„Åô„ÄÇ„Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥Ôºà¬•33,000Ôºâ„ÇÑÈÉ®ÂàÜÊñΩÂ∑•Ôºà¬•11,000‰ª•‰∏ãÔºâ„Å´„ÅØÈÅ©Áî®„Åï„Çå„Åæ„Åõ„Çì„ÄÇ</p>
                                    </div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <div class="bg-white rounded-lg p-3 border border-purple-200">
                                    <div class="flex items-center mb-1">
                                        <svg class="w-4 h-4 text-purple-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                        </svg>
                                        <span class="text-xs font-medium text-gray-700">ÂÑ™ÂÖàË°®Á§∫</span>
                                    </div>
                                    <p class="text-xs text-gray-600">Ê§úÁ¥¢ÁµêÊûú„ÅÆ‰∏ä‰Ωç„Å´Ë°®Á§∫</p>
                                </div>
                                <div class="bg-white rounded-lg p-3 border border-purple-200">
                                    <div class="flex items-center mb-1">
                                        <svg class="w-4 h-4 text-purple-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                        </svg>
                                        <span class="text-xs font-medium text-gray-700">‰ø°È†ºÂ∫¶UP</span>
                                    </div>
                                    <p class="text-xs text-gray-600">ÂâçÊâï„ÅÑ„Åß‰ø°È†ºÊÑüÂêë‰∏ä</p>
                                </div>
                                <div class="bg-white rounded-lg p-3 border border-purple-200">
                                    <div class="flex items-center mb-1">
                                        <svg class="w-4 h-4 text-purple-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                        </svg>
                                        <span class="text-xs font-medium text-gray-700">Ê°à‰ª∂Áç≤ÂæóÁéáUP</span>
                                    </div>
                                    <p class="text-xs text-gray-600">Á´∂Âêà‰ªñÁ§æ„Çà„ÇäÂÑ™‰Ωç</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Áπ∞Ë∂ä/ËøîÈáëË®≠ÂÆö -->
                <div class="bg-white rounded-lg shadow mb-6 p-6">
                    <h3 class="text-lg font-semibold mb-4">Áπ∞Ë∂ä„ÉªËøîÈáëË®≠ÂÆö</h3>
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                        <div class="flex items-start">
                            <svg class="w-5 h-5 text-yellow-600 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                            </svg>
                            <div class="text-sm text-yellow-800">
                                <p class="font-medium mb-1">ÈáçË¶Å„Å™„ÅäÁü•„Çâ„Åõ</p>
                                <ul class="list-disc list-inside space-y-1 text-xs">
                                    <li>„Éá„Éù„Ç∏„ÉÉ„Éà„ÅÆÊúâÂäπÊúüÈôê„ÅØÂÖ•Èáë„ÅÆÁøå„ÄÖÊúàÊú´„Åæ„Åß„Åß„Åô</li>
                                    <li>ËøîÈáëÊôÇ„ÅÆÊåØËæºÊâãÊï∞Êñô„ÅØ„ÅäÂÆ¢ÊßòË≤†ÊãÖ„Å®„Å™„Çä„Åæ„Åô</li>
                                    <li>Áπ∞Ë∂ä„ÇíÈÅ∏Êäû„Åô„Çã„Å®ÁÑ°ÊúüÈôê„Å´Á∂ôÁ∂öÂà©Áî®ÂèØËÉΩ„Åß„Åô</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-700 mb-2">ÊúüÈôêÂàá„ÇåÊôÇ„ÅÆÂá¶ÁêÜÊñπÊ≥ï</p>
                            <div class="flex space-x-4">
                                <label class="flex items-center">
                                    <input type="radio" name="depositHandling" value="rollover" checked class="mr-2">
                                    <span class="text-sm">Áπ∞Ë∂äÔºàÊé®Â•®Ôºâ</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="depositHandling" value="refund" class="mr-2">
                                    <span class="text-sm">ËøîÈáë</span>
                                </label>
                            </div>
                        </div>
                        <button onclick="updateDepositSetting()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                            Ë®≠ÂÆö„Çí‰øùÂ≠ò
                        </button>
                    </div>
                </div>

                <!-- „Éá„Éù„Ç∏„ÉÉ„ÉàÂèñÂºïÂ±•Ê≠¥ -->
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">„Éá„Éù„Ç∏„ÉÉ„ÉàÂèñÂºïÂ±•Ê≠¥</h3>
                        <div class="flex space-x-2">
                            <select id="depositTypeFilter" onchange="filterDepositHistory()" class="border rounded px-3 py-1 text-sm">
                                <option value="all">ÂÖ®„Å¶</option>
                                <option value="Áî≥Ë´ã">Áî≥Ë´ã‰∏≠</option>
                                <option value="ÂèçÊò†">ÂèçÊò†</option>
                                <option value="Âà©Áî®">Âà©Áî®</option>
                                <option value="ËøîÈáë">ËøîÈáë</option>
                            </select>
                            <input type="month" id="depositMonthFilter" value="2025-01" onchange="filterDepositHistory()" class="border rounded px-3 py-1 text-sm">
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Êó•‰ªò</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Á®ÆÂà•</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Áä∂ÊÖã</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‰ª∂Êï∞</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÈáëÈ°ç</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ë™¨Êòé</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊÆã‰ª∂Êï∞</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊúâÂäπÊúüÈôê</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="depositHistoryBody" class="bg-white divide-y divide-gray-200">
                                <tr class="hover:bg-gray-50 deposit-row" data-type="Áî≥Ë´ã" data-date="2025-01">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/17</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">Áî≥Ë´ã</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">ÂÖ•ÈáëÂæÖ„Å°</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">10</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">¬•220,000</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">INV-20250117 (ÊîØÊâïÊúüÈôê:1/24)</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">-</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">-</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button onclick="downloadInvoice('INV-20250117')" class="text-blue-600 hover:text-blue-800">Ë´ãÊ±ÇÊõ∏DL</button>
                                    </td>
                                </tr>
                                <tr class="hover:bg-gray-50 bg-gray-50 deposit-row" data-type="Âà©Áî®" data-date="2025-01">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/15</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Âà©Áî®</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÆå‰∫Ü</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">-1</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-red-600">-¬•22,000</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600">
                                        <a href="#" onclick="showCaseDetail('C2025-001'); return false;" class="hover:underline">#C2025-001 Áî∞‰∏≠Êßò</a>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">20</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/03/31</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">-</td>
                                </tr>
                                <tr class="hover:bg-gray-50 deposit-row" data-type="Âà©Áî®" data-date="2025-01">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/10</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Âà©Áî®</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÆå‰∫Ü</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">-1</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-red-600">-¬•22,000</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600">
                                        <a href="#" onclick="showCaseDetail('C2025-002'); return false;" class="hover:underline">#C2025-002 ‰ΩêËó§Êßò</a>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">21</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/03/31</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">-</td>
                                </tr>
                                <tr class="hover:bg-gray-50 bg-gray-50 deposit-row" data-type="ÂèçÊò†" data-date="2025-01">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/05</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂèçÊò†</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÆå‰∫Ü</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">+25</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600">+¬•550,000</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">INV-20250101 ÂÖ•ÈáëÁ¢∫Ë™ç</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">25</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/03/31</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button onclick="downloadInvoice('INV-20250101')" class="text-blue-600 hover:text-blue-800">Ë´ãÊ±ÇÊõ∏DL</button>
                                    </td>
                                </tr>
                                <tr class="hover:bg-gray-50 deposit-row" data-type="Áî≥Ë´ã" data-date="2025-01">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025/01/01</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">Áî≥Ë´ã</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÖ•ÈáëÊ∏à</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">25</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">¬•550,000</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">INV-20250101 (ÂÖ•Èáë:1/5)</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">-</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">-</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button onclick="downloadInvoice('INV-20250101')" class="text-blue-600 hover:text-blue-800">Ë´ãÊ±ÇÊõ∏DL</button>
                                    </td>
                                </tr>
                                <tr class="hover:bg-gray-50 bg-gray-50 deposit-row" data-type="ËøîÈáë" data-date="2024-12">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2024/12/15</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">ËøîÈáë</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ÂÆå‰∫Ü</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">-3</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600">¬•65,450</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ÊúüÈôêÂàá„ÇåËøîÈáë(ÊâãÊï∞Êñô¬•550Â∑ÆÂºï)</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">0</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2024/11/30</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div><!-- depositSection„ÅÆÁµÇ‰∫Ü -->

            <!-- „É¨„Éù„Éº„Éà„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="reportsSection" class="section" style="display: none;">
                <div class="mb-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">„É¨„Éù„Éº„Éà</h2>
                    <div class="flex space-x-2">
                        <select id="reportPeriod" onchange="updateReports()" class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            <option value="month">‰ªäÊúà</option>
                            <option value="quarter">‰ªäÂõõÂçäÊúü</option>
                            <option value="year">‰ªäÂπ¥Â∫¶</option>
                            <option value="custom">ÊúüÈñìÊåáÂÆö</option>
                        </select>
                        <button onclick="exportReport()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">
                            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            „É¨„Éù„Éº„ÉàÂá∫Âäõ
                        </button>
                    </div>
                </div>

                <!-- KPI„Çµ„Éû„É™„Éº -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Á∑èÂ£≤‰∏ä</p>
                                <p class="text-2xl font-bold text-gray-900">¬•8,450,000</p>
                                <p class="text-xs text-green-600 flex items-center mt-1">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    12% ÂâçÊúàÊØî
                                </p>
                            </div>
                            <div class="p-3 bg-blue-100 rounded-full">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">ÊàêÁ¥ÑÁéá</p>
                                <p class="text-2xl font-bold text-gray-900">68.5%</p>
                                <p class="text-xs text-green-600 flex items-center mt-1">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    5.2% ÊîπÂñÑ
                                </p>
                            </div>
                            <div class="p-3 bg-green-100 rounded-full">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Âπ≥ÂùáÂçò‰æ°</p>
                                <p class="text-2xl font-bold text-gray-900">¬•952,000</p>
                                <p class="text-xs text-red-600 flex items-center mt-1">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M14.707 12.293a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l2.293-2.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    3% ÂâçÊúàÊØî
                                </p>
                            </div>
                            <div class="p-3 bg-yellow-100 rounded-full">
                                <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Êñ∞Ë¶èÊ°à‰ª∂</p>
                                <p class="text-2xl font-bold text-gray-900">42‰ª∂</p>
                                <p class="text-xs text-green-600 flex items-center mt-1">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    8‰ª∂ Â¢óÂä†
                                </p>
                            </div>
                            <div class="p-3 bg-purple-100 rounded-full">
                                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- „Ç∞„É©„Éï„Ç®„É™„Ç¢ -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Â£≤‰∏äÊé®Áßª„Ç∞„É©„Éï -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Â£≤‰∏äÊé®Áßª</h3>
                            <select class="text-sm border rounded px-2 py-1">
                                <option>ÊúàÂà•</option>
                                <option>ÈÄ±Âà•</option>
                                <option>Êó•Âà•</option>
                            </select>
                        </div>
                        <div style="height: 200px;">
                            <canvas id="salesChart"></canvas>
                        </div>
                    </div>

                    <!-- ÊàêÁ¥ÑÁéáÊé®Áßª„Ç∞„É©„Éï -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">ÊàêÁ¥ÑÁéáÊé®Áßª</h3>
                            <select class="text-sm border rounded px-2 py-1">
                                <option>ÊúàÂà•</option>
                                <option>ÈÄ±Âà•</option>
                            </select>
                        </div>
                        <div style="height: 200px;">
                            <canvas id="conversionChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Ë©≥Á¥∞„ÉÜ„Éº„Éñ„É´ -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Âñ∂Ê•≠Âà•ÊàêÁ∏æ -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="px-6 py-4 border-b">
                            <h3 class="text-lg font-semibold text-gray-900">Âñ∂Ê•≠Âà•ÊàêÁ∏æ</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Âñ∂Ê•≠Âêç</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊàêÁ¥ÑÊï∞</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊàêÁ¥ÑÁéá</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Â£≤‰∏ä</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Áî∞‰∏≠Â§™ÈÉé</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">12</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <span class="text-sm text-gray-900">75%</span>
                                                <div class="ml-2 w-16 bg-gray-200 rounded-full h-2">
                                                    <div class="bg-green-500 h-2 rounded-full" style="width: 75%"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•3,200,000</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">‰ΩêËó§Ëä±Â≠ê</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">8</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <span class="text-sm text-gray-900">62%</span>
                                                <div class="ml-2 w-16 bg-gray-200 rounded-full h-2">
                                                    <div class="bg-yellow-500 h-2 rounded-full" style="width: 62%"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•2,100,000</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Èà¥Êú®Ê¨°ÈÉé</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">5</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <span class="text-sm text-gray-900">45%</span>
                                                <div class="ml-2 w-16 bg-gray-200 rounded-full h-2">
                                                    <div class="bg-red-500 h-2 rounded-full" style="width: 45%"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•1,450,000</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- „Ç®„É™„Ç¢Âà•ÊàêÁ∏æ -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="px-6 py-4 border-b">
                            <h3 class="text-lg font-semibold text-gray-900">„Ç®„É™„Ç¢Âà•ÊàêÁ∏æ</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">„Ç®„É™„Ç¢</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ê°à‰ª∂Êï∞</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊàêÁ¥ÑÁéá</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Â£≤‰∏ä</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Êù±‰∫¨ÈÉΩ</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">18</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">72%</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•4,200,000</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Á•ûÂ•àÂ∑ùÁúå</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">12</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">65%</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•2,800,000</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">ÂüºÁéâÁúå</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">8</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">58%</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">¬•1,450,000</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- „É™„Éº„Éâ„Çø„Ç§„É†ÂàÜÊûê„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div class="mt-8">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-gray-900">„É™„Éº„Éâ„Çø„Ç§„É†ÂàÜÊûê</h3>
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-gray-500">Âπ≥ÂùáÂÄ§Ë°®Á§∫</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="showMedian" class="sr-only peer" onchange="updateLeadTimeDisplay()">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                                <span class="text-sm text-gray-500">‰∏≠Â§ÆÂÄ§Ë°®Á§∫</span>
                            </div>
                        </div>

                        <!-- KPI„Ç´„Éº„Éâ -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-blue-600 font-medium">ÂïèÂêà„Åõ ‚Üí ÁèæÂú∞Ë™øÊüª</p>
                                        <p class="text-2xl font-bold text-blue-900" id="leadTime1">3.2Êó•</p>
                                        <p class="text-xs text-blue-600 flex items-center mt-1">
                                            <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                            </svg>
                                            0.5Êó• Áü≠Á∏Æ
                                        </p>
                                    </div>
                                    <div class="p-3 bg-blue-200 rounded-full">
                                        <svg class="w-6 h-6 text-blue-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-green-50 to-green-100 p-4 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-green-600 font-medium">ÁèæÂú∞Ë™øÊüª ‚Üí Ë¶ãÁ©çÊèêÂá∫</p>
                                        <p class="text-2xl font-bold text-green-900" id="leadTime2">2.8Êó•</p>
                                        <p class="text-xs text-green-600 flex items-center mt-1">
                                            <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                            </svg>
                                            0.2Êó• Áü≠Á∏Æ
                                        </p>
                                    </div>
                                    <div class="p-3 bg-green-200 rounded-full">
                                        <svg class="w-6 h-6 text-green-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-purple-50 to-purple-100 p-4 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-purple-600 font-medium">Ë¶ãÁ©çÊèêÂá∫ ‚Üí ÊàêÁ¥Ñ</p>
                                        <p class="text-2xl font-bold text-purple-900" id="leadTime3">5.5Êó•</p>
                                        <p class="text-xs text-red-600 flex items-center mt-1">
                                            <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M14.707 12.293a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l2.293-2.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                            </svg>
                                            1.2Êó• Âª∂Èï∑
                                        </p>
                                    </div>
                                    <div class="p-3 bg-purple-200 rounded-full">
                                        <svg class="w-6 h-6 text-purple-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- „É™„Éº„Éâ„Çø„Ç§„É†„ÉÅ„É£„Éº„Éà -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <!-- ÊúàÂà•Êé®Áßª„Ç∞„É©„Éï -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-sm font-semibold text-gray-700 mb-3">ÊúàÂà•„É™„Éº„Éâ„Çø„Ç§„É†Êé®Áßª</h4>
                                <div style="height: 250px;">
                                    <canvas id="leadTimeChart"></canvas>
                                </div>
                            </div>

                            <!-- „Éï„Ç°„Éç„É´ÂàÜÊûê -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-sm font-semibold text-gray-700 mb-3">Âñ∂Ê•≠„Éï„Ç°„Éç„É´ÂàÜÊûê</h4>
                                <div class="space-y-3">
                                    <div class="relative">
                                        <div class="flex items-center justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700">ÂïèÂêà„Åõ</span>
                                            <span class="text-sm text-gray-500">142‰ª∂</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-8">
                                            <div class="bg-blue-500 h-8 rounded-full flex items-center justify-center text-white text-xs" style="width: 100%">
                                                100%
                                            </div>
                                        </div>
                                    </div>

                                    <div class="relative">
                                        <div class="flex items-center justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700">ÁèæÂú∞Ë™øÊüª</span>
                                            <span class="text-sm text-gray-500">98‰ª∂</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-8">
                                            <div class="bg-green-500 h-8 rounded-full flex items-center justify-center text-white text-xs" style="width: 69%">
                                                69% (Âπ≥Âùá3.2Êó•)
                                            </div>
                                        </div>
                                    </div>

                                    <div class="relative">
                                        <div class="flex items-center justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700">Ë¶ãÁ©çÊèêÂá∫</span>
                                            <span class="text-sm text-gray-500">85‰ª∂</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-8">
                                            <div class="bg-yellow-500 h-8 rounded-full flex items-center justify-center text-white text-xs" style="width: 60%">
                                                60% (Âπ≥Âùá2.8Êó•)
                                            </div>
                                        </div>
                                    </div>

                                    <div class="relative">
                                        <div class="flex items-center justify-between mb-1">
                                            <span class="text-sm font-medium text-gray-700">ÊàêÁ¥Ñ</span>
                                            <span class="text-sm text-gray-500">42‰ª∂</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-8">
                                            <div class="bg-purple-500 h-8 rounded-full flex items-center justify-center text-white text-xs" style="width: 30%">
                                                30% (Âπ≥Âùá5.5Êó•)
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-4 pt-4 border-t border-gray-200">
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">„Éà„Éº„Çø„É´Âπ≥ÂùáÊó•Êï∞:</span>
                                        <span class="font-bold text-gray-900">11.5Êó•</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Âñ∂Ê•≠Âà•„É™„Éº„Éâ„Çø„Ç§„É†ÊØîËºÉ -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="text-sm font-semibold text-gray-700 mb-4">Âñ∂Ê•≠Âà•„É™„Éº„Éâ„Çø„Ç§„É†ÊØîËºÉ</h4>
                            <div class="overflow-x-auto">
                                <table class="min-w-full">
                                    <thead>
                                        <tr class="text-xs text-gray-500 uppercase">
                                            <th class="text-left py-2">Âñ∂Ê•≠ÊãÖÂΩì</th>
                                            <th class="text-center py-2">ÂïèÂêà„Åõ‚ÜíË™øÊüª</th>
                                            <th class="text-center py-2">Ë™øÊüª‚ÜíË¶ãÁ©ç</th>
                                            <th class="text-center py-2">Ë¶ãÁ©ç‚ÜíÊàêÁ¥Ñ</th>
                                            <th class="text-center py-2">ÂêàË®àÊó•Êï∞</th>
                                            <th class="text-center py-2">ÊàêÁ¥ÑÁéá</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-sm">
                                        <tr class="border-t border-gray-200">
                                            <td class="py-3 font-medium text-gray-900">Áî∞‰∏≠Â§™ÈÉé</td>
                                            <td class="text-center text-green-600 font-medium">2.5Êó•</td>
                                            <td class="text-center text-green-600 font-medium">2.0Êó•</td>
                                            <td class="text-center text-green-600 font-medium">4.5Êó•</td>
                                            <td class="text-center font-bold text-gray-900">9.0Êó•</td>
                                            <td class="text-center">
                                                <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">75%</span>
                                            </td>
                                        </tr>
                                        <tr class="border-t border-gray-200">
                                            <td class="py-3 font-medium text-gray-900">‰ΩêËó§Ëä±Â≠ê</td>
                                            <td class="text-center text-yellow-600 font-medium">3.0Êó•</td>
                                            <td class="text-center text-yellow-600 font-medium">3.2Êó•</td>
                                            <td class="text-center text-yellow-600 font-medium">5.8Êó•</td>
                                            <td class="text-center font-bold text-gray-900">12.0Êó•</td>
                                            <td class="text-center">
                                                <span class="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">62%</span>
                                            </td>
                                        </tr>
                                        <tr class="border-t border-gray-200">
                                            <td class="py-3 font-medium text-gray-900">Èà¥Êú®Ê¨°ÈÉé</td>
                                            <td class="text-center text-red-600 font-medium">4.5Êó•</td>
                                            <td class="text-center text-red-600 font-medium">3.8Êó•</td>
                                            <td class="text-center text-red-600 font-medium">7.2Êó•</td>
                                            <td class="text-center font-bold text-gray-900">15.5Êó•</td>
                                            <td class="text-center">
                                                <span class="px-2 py-1 text-xs rounded-full bg-red-100 text-red-800">45%</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                                <p class="text-xs text-blue-800">
                                    <strong>üí° ÊîπÂñÑ„Éù„Ç§„É≥„Éà:</strong> Ë¶ãÁ©çÊèêÂá∫„Åã„ÇâÊàêÁ¥Ñ„Åæ„Åß„ÅÆÊúüÈñì„ÅåÈï∑„ÅÑÂÇæÂêë„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó„ÅÆÈ†ªÂ∫¶„Çí‰∏ä„Åí„Çã„Åì„Å®„ÅßÊàêÁ¥ÑÁéáÂêë‰∏ä„ÅåÊúüÂæÖ„Åß„Åç„Åæ„Åô„ÄÇ
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- reportsSection„ÅÆÁµÇ‰∫Ü -->

            <!-- „Ç´„É¨„É≥„ÉÄ„Éº„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="calendarSection" class="section" style="display: none;">
                <div class="mb-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">„Ç´„É¨„É≥„ÉÄ„Éº</h2>
                    <div class="flex items-center space-x-2">
                        <button onclick="changeCalendarView('month')" class="calendar-view-btn px-3 py-1 text-sm font-medium text-blue-600 bg-blue-50 rounded">Êúà</button>
                        <button onclick="changeCalendarView('week')" class="calendar-view-btn px-3 py-1 text-sm font-medium text-gray-600 hover:bg-gray-50 rounded">ÈÄ±</button>
                        <button onclick="changeCalendarView('day')" class="calendar-view-btn px-3 py-1 text-sm font-medium text-gray-600 hover:bg-gray-50 rounded">Êó•</button>
                        <button onclick="addNewEvent()" class="ml-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">
                            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                            </svg>
                            ‰∫àÂÆö„ÇíËøΩÂä†
                        </button>
                    </div>
                </div>
                
                <!-- „Ç´„É¨„É≥„ÉÄ„Éº„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
                <div class="bg-white rounded-lg shadow mb-4">
                    <div class="p-4 flex justify-between items-center border-b">
                        <button onclick="previousMonth()" class="p-2 hover:bg-gray-100 rounded">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                            </svg>
                        </button>
                        <h3 id="currentMonth" class="text-lg font-semibold text-gray-900">2024Âπ¥1Êúà</h3>
                        <button onclick="nextMonth()" class="p-2 hover:bg-gray-100 rounded">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </button>
                    </div>
                    
                    <!-- ÊúàË°®Á§∫„Ç´„É¨„É≥„ÉÄ„Éº -->
                    <div id="calendarMonthView" class="p-4">
                        <div class="grid grid-cols-7 mb-2">
                            <div class="text-center text-sm font-medium text-gray-700 py-2 border-b">Êó•</div>
                            <div class="text-center text-sm font-medium text-gray-700 py-2 border-b">Êúà</div>
                            <div class="text-center text-sm font-medium text-gray-700 py-2 border-b">ÁÅ´</div>
                            <div class="text-center text-sm font-medium text-gray-700 py-2 border-b">Ê∞¥</div>
                            <div class="text-center text-sm font-medium text-gray-700 py-2 border-b">Êú®</div>
                            <div class="text-center text-sm font-medium text-gray-700 py-2 border-b">Èáë</div>
                            <div class="text-center text-sm font-medium text-gray-700 py-2 border-b">Âúü</div>
                        </div>
                        <div id="calendarGrid" style="display: grid; grid-template-columns: repeat(7, 1fr);">
                            <!-- „Ç´„É¨„É≥„ÉÄ„Éº„ÅÆÊó•‰ªò„ÅåÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Åæ„Åô -->
                        </div>
                    </div>
                    
                    <!-- ÈÄ±Ë°®Á§∫ÔºàÂàùÊúü„ÅØÈùûË°®Á§∫Ôºâ -->
                    <div id="calendarWeekView" class="p-4 hidden">
                        <div id="weekGrid" class="grid grid-cols-8 gap-0 border">
                            <!-- Week view content will be rendered here -->
                        </div>
                    </div>
                    
                    <!-- Êó•Ë°®Á§∫ÔºàÂàùÊúü„ÅØÈùûË°®Á§∫Ôºâ -->
                    <div id="calendarDayView" class="p-4 hidden">
                        <div class="bg-white rounded-lg shadow">
                            <div class="p-4 border-b">
                                <h3 id="dayViewDate" class="text-lg font-semibold">2024Âπ¥1Êúà15Êó•ÔºàÊúàÔºâ</h3>
                            </div>
                            <div id="dayTimeSlots" class="p-4">
                                <!-- Day view time slots will be rendered here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Âá°‰æã -->
                <div class="bg-white rounded-lg shadow p-4">
                    <h4 class="text-sm font-medium text-gray-700 mb-3">Âá°‰æã</h4>
                    <div class="flex flex-wrap gap-4 text-sm">
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-blue-500 rounded mr-2"></div>
                            <span>„Éí„Ç¢„É™„É≥„Ç∞„ÉªÁèæÂú∞Ë™øÊüª</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-green-500 rounded mr-2"></div>
                            <span>Â∑•‰∫ã</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-yellow-500 rounded mr-2"></div>
                            <span>Ë¶ãÁ©ç„ÇÇ„ÇäÊèêÂá∫</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-purple-500 rounded mr-2"></div>
                            <span>„Ç¢„Éï„Çø„Éº„Éï„Ç©„É≠„Éº</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-red-500 rounded mr-2"></div>
                            <span>ÈáçË¶Å</span>
                        </div>
                    </div>
                </div>
            </div><!-- calendarSection„ÅÆÁµÇ‰∫Ü -->
            
            <!-- Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="autodeliverySection" class="section" style="display: none;">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö</h2>

                <div class="bg-white rounded-lg shadow p-6">
                    <!-- ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö -->
                    <div class="mb-8 p-6 bg-gradient-to-r from-orange-50 to-red-50 border border-orange-200 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö</h3>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="autoPauseToggle" onchange="toggleAutoPause()" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"></div>
                            </label>
                        </div>
                        <div id="pauseSettings" class="space-y-3">
                            <!-- ‰∏ÄÊôÇÂÅúÊ≠¢ÈñãÂßãÊó• -->
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">‰∏ÄÊôÇÂÅúÊ≠¢ÈñãÂßãÊó•</label>
                                <input type="date" id="pauseStartDate" class="w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-orange-500">
                            </div>

                            <!-- ‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñãÊó• -->
                            <div>
                                <div class="flex items-center justify-between mb-1.5">
                                    <label class="block text-sm font-medium text-gray-700">‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñãÊó•</label>
                                    <label class="flex items-center gap-1.5 cursor-pointer">
                                        <input type="checkbox" id="indefinitePause" onchange="toggleIndefinitePause()" class="rounded text-orange-600 focus:ring-orange-500" checked>
                                        <span class="text-xs text-gray-600 whitespace-nowrap">Êú™ÂÆö</span>
                                    </label>
                                </div>
                                <input type="text" id="pauseEndDateDisplay" class="w-full px-2.5 py-1.5 text-sm border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed text-gray-500" value="Êú™ÂÆö" readonly>
                                <input type="date" id="pauseEndDate" class="hidden w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-orange-500">
                            </div>
                        </div>
                    </div>

                    <!-- ÂØæÂøúÂèØËÉΩÁâ©‰ª∂Á®ÆÂà• -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">ÂØæÂøúÂèØËÉΩÁâ©‰ª∂Á®ÆÂà•</h3>
                        <div class="space-y-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-3">
                                ÂØæÂøúÂèØËÉΩÁâ©‰ª∂<span class="text-red-500">*</span>ÔºàÊúÄÂ§ßÂØæÂøúÈöéÊï∞Ôºâ
                            </label>
                            <div class="space-y-3">
                                <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-gray-300">
                                    <input type="checkbox" class="mr-3" value="house" name="propertyType">
                                    <div class="flex-1 flex items-center">
                                        <span class="font-medium">üè† Êà∏Âª∫„Å¶‰ΩèÂÆÖ</span>
                                        <select class="ml-auto text-sm border rounded px-2 py-1">
                                            <option value="1">1Èöé</option>
                                            <option value="2">2Èöé</option>
                                            <option value="3" selected>3Èöé</option>
                                            <option value="4">4Èöé‰ª•‰∏ä</option>
                                        </select>
                                        <span class="ml-1 text-sm text-gray-600">„Åæ„Åß</span>
                                    </div>
                                </label>
                                <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-gray-300">
                                    <input type="checkbox" class="mr-3" value="apartment" name="propertyType" onchange="checkLargeProperty(this)">
                                    <div class="flex-1 flex items-center">
                                        <span class="font-medium">üè¢ „Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥</span>
                                        <select class="ml-auto text-sm border rounded px-2 py-1" onchange="checkFloorSelection(this)">
                                            <option value="1">1Èöé</option>
                                            <option value="2">2Èöé</option>
                                            <option value="3" selected>3Èöé</option>
                                            <option value="4">4Èöé</option>
                                            <option value="5">5Èöé</option>
                                            <option value="6">6Èöé</option>
                                            <option value="7">7Èöé</option>
                                            <option value="8">8Èöé</option>
                                            <option value="9">9Èöé</option>
                                            <option value="unlimited">10Èöé‰ª•‰∏ä</option>
                                        </select>
                                        <span class="ml-1 text-sm text-gray-600">„Åæ„Åß</span>
                                    </div>
                                </label>
                                <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-gray-300">
                                    <input type="checkbox" class="mr-3" value="commercial" name="propertyType" onchange="checkLargeProperty(this)">
                                    <div class="flex-1 flex items-center">
                                        <span class="font-medium">üè™ Â∫óËàó„Éª‰∫ãÂãôÊâÄ</span>
                                        <select class="ml-auto text-sm border rounded px-2 py-1" onchange="checkFloorSelection(this)">
                                            <option value="1">1Èöé</option>
                                            <option value="2">2Èöé</option>
                                            <option value="3" selected>3Èöé</option>
                                            <option value="4">4Èöé‰ª•‰∏ä</option>
                                        </select>
                                        <span class="ml-1 text-sm text-gray-600">„Åæ„Åß</span>
                                    </div>
                                </label>
                                <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-gray-300">
                                    <input type="checkbox" class="mr-3" value="factory" name="propertyType" onchange="checkLargeProperty(this)">
                                    <div class="flex-1 flex items-center">
                                        <span class="font-medium">üè≠ Â∑•Â†¥„ÉªÂÄâÂ∫´</span>
                                        <select class="ml-auto text-sm border rounded px-2 py-1" onchange="checkFloorSelection(this)">
                                            <option value="1">1Èöé</option>
                                            <option value="2">2Èöé</option>
                                            <option value="3" selected>3Èöé</option>
                                            <option value="4">4Èöé‰ª•‰∏ä</option>
                                        </select>
                                        <span class="ml-1 text-sm text-gray-600">„Åæ„Åß</span>
                                    </div>
                                </label>
                            </div>

                            <!-- ÁØâÂπ¥Êï∞ÂØæÂøúÁØÑÂõ≤ -->
                            <div class="mt-6">
                                <label class="block mb-2 text-sm font-semibold text-gray-700">ÁØâÂπ¥Êï∞ÂØæÂøúÁØÑÂõ≤ <span class="text-red-500">*</span></label>
                                <div class="bg-white border rounded-lg p-4">
                                    <div class="mb-2">
                                        <p class="text-center text-lg font-medium text-gray-800">
                                            ÁØâ<span id="ageRangeMinAuto">0</span>Âπ¥„Äú<span id="ageRangeMaxAuto">50</span>Âπ¥„Åæ„ÅßÂØæÂøú
                                        </p>
                                    </div>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="text-sm text-gray-600">ÁØâÂπ¥Êï∞‰∏ãÈôê</label>
                                            <input type="range" min="0" max="50" value="0" class="w-full" oninput="updateAgeRangeAuto()">
                                            <div class="flex justify-between text-xs text-gray-400 mt-1">
                                                <span>0Âπ¥</span>
                                                <span>10Âπ¥</span>
                                                <span>20Âπ¥</span>
                                                <span>30Âπ¥</span>
                                                <span>40Âπ¥</span>
                                                <span>50Âπ¥</span>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="text-sm text-gray-600">ÁØâÂπ¥Êï∞‰∏äÈôê</label>
                                            <input type="range" min="0" max="100" value="50" class="w-full" oninput="updateAgeRangeAuto()">
                                            <div class="flex justify-between text-xs text-gray-400 mt-1">
                                                <span>0Âπ¥</span>
                                                <span>20Âπ¥</span>
                                                <span>40Âπ¥</span>
                                                <span>60Âπ¥</span>
                                                <span>80Âπ¥</span>
                                                <span>100Âπ¥</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ÂØæÂøúÂ∑•‰∫ãÁ®ÆÂà• -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-2">ÊñΩÂ∑•ÁÆáÊâÄ <span class="text-red-500">*</span></h3>
                        <p class="text-sm text-gray-600 mb-2">ÂØæÂøúÂèØËÉΩ„Å™Â∑•‰∫ãÂÜÖÂÆπÂÖ®„Å¶„Å´„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÂÖ•„Çå„Å¶„Åè„Å†„Åï„ÅÑ</p>
                        <p class="text-sm text-gray-600 mb-4">ÈÅ∏Êäû„Åó„ÅüÈ†ÖÁõÆ„ÅåËá™ÂãïÈÖç‰ø°„ÅÆÊù°‰ª∂„Å´ÂΩì„Å¶„ÅØ„Åæ„Å£„ÅüÂ†¥Âêà„ÄÅË®òËºâ„ÅÆÊñôÈáëÔºà‚ÄªÁ®éÊäúÔºâ„ÅåÈÅ©Áî®„Åï„Çå„Åæ„Åô„ÄÇ</p>

                        <!-- ¬•20,000È†ÖÁõÆ -->
                        <div class="mb-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â§ñÂ£ÅÂ°óË£Ö" class="mr-3">
                                    <span class="flex-1">Â§ñÂ£ÅÂ°óË£Ö</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï" class="mr-3">
                                    <span class="flex-1">Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â§ñÂ£ÅÂºµÊõø„Åà" class="mr-3">
                                    <span class="flex-1">Â§ñÂ£ÅÂºµÊõø„Åà</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ãÊ†πÂ°óË£ÖÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ" class="mr-3">
                                    <span class="flex-1">Â±ãÊ†πÂ°óË£ÖÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ã‰∏äÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ" class="mr-3">
                                    <span class="flex-1">Â±ã‰∏äÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚Äª„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠â" class="mr-3">
                                    <span class="flex-1 text-sm">Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚Äª„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠â</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚ÄªÁì¶" class="mr-3">
                                    <span class="flex-1">Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚ÄªÁì¶</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï" class="mr-3">
                                    <span class="flex-1">Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â§ñÂ£ÅË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ" class="mr-3">
                                    <span class="flex-1">Â§ñÂ£ÅË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ãÊ†πË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ" class="mr-3">
                                    <span class="flex-1">Â±ãÊ†πË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ" class="mr-3">
                                    <span class="flex-1">„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ" class="mr-3">
                                    <span class="flex-1">Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="ÂÜÖË£ÖÊ∞¥Âõû„ÇäÔºà„Éê„Çπ„Éª„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éà„Ç§„É¨ÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ" class="mr-3">
                                    <span class="flex-1 text-sm">ÂÜÖË£ÖÊ∞¥Âõû„ÇäÔºà„Éê„Çπ„Éª„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éà„Ç§„É¨ÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="ÂÜÖË£ÖÔºà„Éï„É≠„Éº„É™„É≥„Ç∞„ÇÑÁï≥„Å™„Å©„ÅÆÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ" class="mr-3">
                                    <span class="flex-1 text-sm">ÂÜÖË£ÖÔºà„Éï„É≠„Éº„É™„É≥„Ç∞„ÇÑÁï≥„Å™„Å©„ÅÆÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÔºàÂ±ãÊ†πÂ∑•‰∫ãÂê´„ÇÄÔºâ" class="mr-3">
                                    <span class="flex-1">Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÔºàÂ±ãÊ†πÂ∑•‰∫ãÂê´„ÇÄÔºâ</span>
                                    <span class="text-sm font-semibold text-blue-600">¬•20,000</span>
                                </label>
                            </div>
                        </div>

                        <!-- ¬•10,000È†ÖÁõÆ -->
                        <div class="mb-6">
                            <p class="text-sm text-gray-600 mb-2">‰ª•‰∏ã„ÅÆÂçòÂìÅ‰æùÈ†º„ÅØÁõ∏Ë¶ãÁ©ç„ÇÇ„ÇäÊôÇ„ÅÆÊñôÈáë„ÇíÁ®éÊäú„ÅçË°®Á§∫„Åó„Å¶„Åä„Çä„Åæ„Åô„ÄÇ</p>
                            <p class="text-sm text-gray-600 mb-3">‚Äª1Á§æÁ¥π‰ªãÊôÇ„ÅØ„Åô„Åπ„Å¶¬•20,000„Å®„Å™„Çä„Åæ„Åô</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ãÊ†πÂ°óË£ÖÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ" class="mr-3" onchange="checkSingleItemSelection(this)">
                                    <span class="flex-1">Â±ãÊ†πÂ°óË£ÖÂçòÂìÅ</span>
                                    <span class="text-sm font-semibold text-green-600">¬•10,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ã‰∏äÈò≤Ê∞¥ÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ" class="mr-3" onchange="checkSingleItemSelection(this)">
                                    <span class="flex-1">Â±ã‰∏äÈò≤Ê∞¥ÂçòÂìÅ</span>
                                    <span class="text-sm font-semibold text-green-600">¬•10,000</span>
                                </label>
                            </div>
                        </div>

                        <!-- ¬•5,000È†ÖÁõÆ -->
                        <div class="mb-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â§ñÂ£ÅË£ú‰øÆÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ" class="mr-3" onchange="checkSingleItemSelection(this)">
                                    <span class="flex-1">Â§ñÂ£ÅË£ú‰øÆÂçòÂìÅ</span>
                                    <span class="text-sm font-semibold text-red-600">¬•5,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ãÊ†πË£ú‰øÆÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ" class="mr-3" onchange="checkSingleItemSelection(this)">
                                    <span class="flex-1">Â±ãÊ†πË£ú‰øÆÂçòÂìÅ</span>
                                    <span class="text-sm font-semibold text-red-600">¬•5,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ" class="mr-3" onchange="checkSingleItemSelection(this)">
                                    <span class="flex-1">„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÂçòÂìÅ</span>
                                    <span class="text-sm font-semibold text-red-600">¬•5,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ" class="mr-3" onchange="checkSingleItemSelection(this)">
                                    <span class="flex-1">Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅ</span>
                                    <span class="text-sm font-semibold text-red-600">¬•5,000</span>
                                </label>
                                <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="constructionTypes" value="Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ" class="mr-3" onchange="checkSingleItemSelection(this)">
                                    <span class="flex-1">Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅ</span>
                                    <span class="text-sm font-semibold text-red-600">¬•5,000</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆÔºà‰ªªÊÑèÔºâ -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆÔºà‰ªªÊÑèÔºâ</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üå° ÈÅÆÁÜ±„ÉªÊñ≠ÁÜ±Â°óÊñôÊèêÊ°àÂèØËÉΩ">
                                <span class="text-sm">üå° ÈÅÆÁÜ±„ÉªÊñ≠ÁÜ±Â°óÊñôÊèêÊ°àÂèØËÉΩ</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üëÄ Á´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÊâãÊ∏°„ÅóÂ∏åÊúõ">
                                <span class="text-sm">üëÄ Á´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÊâãÊ∏°„ÅóÂ∏åÊúõ</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üìÆ ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÈÉµÈÄÅ„ÉªÈõªË©±„ÅßÂïÜË´áÂèØ">
                                <span class="text-sm">üìÆ ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÈÉµÈÄÅ„ÉªÈõªË©±„ÅßÂïÜË´áÂèØ</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üè° „Ç®„ÇØ„Çπ„ÉÜ„É™„Ç¢ÔºàÂ∫≠„ÉªÈßêËªäÂ†¥„ÉªÂ§ñÊßãÔºâ">
                                <span class="text-sm">üè° „Ç®„ÇØ„Çπ„ÉÜ„É™„Ç¢ÔºàÂ∫≠„ÉªÈßêËªäÂ†¥„ÉªÂ§ñÊßãÔºâ</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="‚òÄÔ∏è Â§™ÈôΩÂÖâ„Éë„Éç„É´ËÑ±ÁùÄÔºàÊí§ÂéªÂê´„ÇÄÔºâ">
                                <span class="text-sm">‚òÄÔ∏è Â§™ÈôΩÂÖâ„Éë„Éç„É´ËÑ±ÁùÄÔºàÊí§ÂéªÂê´„ÇÄÔºâ</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üè¶ ÊèêÊê∫ÂÖà„É≠„Éº„É≥Êúâ„Çä">
                                <span class="text-sm">üè¶ ÊèêÊê∫ÂÖà„É≠„Éº„É≥Êúâ„Çä</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üí≥ „ÇØ„É¨„Ç∏„ÉÉ„Éà„Ç´„Éº„ÉâÊâï„ÅÑÂèØ">
                                <span class="text-sm">üí≥ „ÇØ„É¨„Ç∏„ÉÉ„Éà„Ç´„Éº„ÉâÊâï„ÅÑÂèØ</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üî• ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà">
                                <span class="text-sm">üî• ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üí∞ Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà">
                                <span class="text-sm">üí∞ Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üèó Âª∫ÁØâË®±ÂèØË®º">
                                <span class="text-sm">üèó Âª∫ÁØâË®±ÂèØË®º</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="‚ú® ÂÖâËß¶Â™íÂ°óÊñôÊèêÊ°àÂèØ">
                                <span class="text-sm">‚ú® ÂÖâËß¶Â™íÂ°óÊñôÊèêÊ°àÂèØ</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-white border rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                <input type="checkbox" name="specialServices" value="üí¥ ÂàÜÂâ≤Êâï„ÅÑ„Éó„É©„É≥Êúâ">
                                <span class="text-sm">üí¥ ÂàÜÂâ≤Êâï„ÅÑ„Éó„É©„É≥Êúâ</span>
                            </label>
                        </div>
                    </div>

                    <!-- ÂØæÂøú„Ç®„É™„Ç¢ÈÅ∏Êäû -->
                    <div class="mb-8">
                        <div class="bg-blue-600 text-white px-4 py-2 rounded-t-lg">
                            <h3 class="text-lg font-semibold">ÂØæÂøú„Ç®„É™„Ç¢ÈÅ∏Êäû</h3>
                        </div>
                        <div class="border border-t-0 rounded-b-lg p-4">
                            <p class="text-sm text-gray-600 mb-4">„Çµ„Éº„Éì„ÇπÊèê‰æõÂèØËÉΩ„Å™„Ç®„É™„Ç¢„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºàÊúÄÂ§ß5„Å§„Åæ„ÅßÔºâ</p>

                            <!-- ÈÅ∏ÊäûÁä∂Ê≥Å„Çµ„Éû„É™„Éº -->
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <span class="text-sm text-gray-600">ÈÅ∏ÊäûÊ∏à„ÅøÈÉΩÈÅìÂ∫úÁúåÔºö</span>
                                        <span id="selectedPrefCount" class="font-bold text-lg ml-2">0</span>
                                        <span class="text-sm text-gray-600">/ 5</span>
                                    </div>
                                    <div>
                                        <span class="text-sm text-gray-600">ÈÅ∏ÊäûÊ∏à„ÅøÂ∏ÇÂå∫Áî∫ÊùëÔºö</span>
                                        <span id="selectedCityCount" class="font-bold text-lg ml-2">0</span>
                                    </div>
                                </div>
                            </div>

                            <!-- ÈÉΩÈÅìÂ∫úÁúåÈÅ∏Êäû -->
                            <div class="mb-6">
                                <h4 class="text-md font-medium mb-3">ÈÉΩÈÅìÂ∫úÁúåÈÅ∏ÊäûÔºàÊúÄÂ§ß5„Å§„Åæ„ÅßÔºâ</h4>
                                <div id="prefectureGrid" class="grid grid-cols-2 md:grid-cols-4 gap-2">
                                    <!-- JavaScript VideÂãïÁöÑÁîüÊàê„Åï„Çå„Çã -->
                                </div>
                            </div>

                            <!-- STEP 1: ÈÉΩÈÅìÂ∫úÁúå„ÇíÈÅ∏Êäû -->
                            <div id="step1Area" class="mb-6">
                                <h4 class="text-md font-medium mb-3">STEP 1: ÈÉΩÈÅìÂ∫úÁúå„ÇíÈÅ∏ÊäûÔºàÊúÄÂ§ß5ÈÉΩÈÅìÂ∫úÁúåÔºâ</h4>
                                <div id="allPrefecturesGrid" class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2">
                                    <!-- ÈÉΩÈÅìÂ∫úÁúå„Éú„Çø„É≥„ÅåJS„ÅßÂãïÁöÑÁîüÊàê„Åï„Çå„Çã -->
                                </div>
                            </div>

                            <!-- STEP 2: Â∏ÇÂå∫Áî∫Êùë„ÇíÈÅ∏Êäû -->
                            <div id="citySelectionArea" class="hidden mb-6">
                                <h4 class="text-md font-medium mb-3">STEP 2: Â∏ÇÂå∫Áî∫Êùë„ÇíÈÅ∏Êäû</h4>
                                <div id="cityListContainer" class="space-y-4">
                                    <!-- ÂêÑÈÉΩÈÅìÂ∫úÁúå„ÅÆÂ∏ÇÂå∫Áî∫Êùë„É™„Çπ„Éà„ÅåÁ∏¶„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                                </div>
                            </div>

                            <!-- STEP 3: ÂÑ™ÂÖà„Ç®„É™„Ç¢„ÇíË®≠ÂÆö -->
                            <div id="priorityArea" class="hidden mb-6">
                                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 sm:p-6">
                                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-3 gap-2">
                                        <h4 class="font-semibold text-sm sm:text-lg leading-tight">
                                            STEP 3: ÂÑ™ÂÖà„Ç®„É™„Ç¢„ÇíË®≠ÂÆö
                                            <span class="block sm:inline sm:ml-1 text-xs sm:text-base font-normal text-gray-600">
                                                ÔºàÊúÄÂ§ß3„Ç®„É™„Ç¢Ôºâ
                                            </span>
                                        </h4>
                                        <span class="text-orange-500 font-semibold text-base sm:text-lg">
                                            <span id="selectedPriorityCount">0</span> / 3 ÈÅ∏Êäû‰∏≠
                                        </span>
                                    </div>
                                    <p class="text-xs sm:text-sm text-gray-600 mb-3 sm:mb-4">Áâπ„Å´Ê≥®Âäõ„Åó„Åü„ÅÑ„Ç®„É™„Ç¢„ÇíÊúÄÂ§ß3„Å§„Åæ„ÅßÈÅ∏Êäû„Åß„Åç„Åæ„Åô</p>
                                    <div id="prioritySelectionList" class="space-y-3 sm:space-y-4">
                                        <!-- ÂÑ™ÂÖà„Ç®„É™„Ç¢ÈÅ∏Êäû„É™„Çπ„Éà„Åå„Åì„Åì„Å´ÁîüÊàê„Åï„Çå„ÇãÔºàÁúå„Åî„Å®„Å´„Ç´„Éº„ÉâÂΩ¢ÂºèÔºâ -->
                                    </div>
                                </div>
                            </div>

                            <!-- „Ç®„É™„Ç¢ÈÅ∏ÊäûÂÆå‰∫Ü„Éú„Çø„É≥„Çª„ÇØ„Ç∑„Éß„É≥ÂâäÈô§ -->
                        </div>
                    </div>

                    <div class="flex justify-end pb-20 relative z-10">
                        <button type="button" id="saveAutodeliveryBtn" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 min-h-[48px] cursor-pointer relative z-20 active:bg-blue-800">
                            Ë®≠ÂÆö„Çí‰øùÂ≠ò
                        </button>
                    </div>
                </div>
            </div>

            <!-- ‰ºöÁ§æÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="companySection" class="section" style="display: none;">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">‰ºöÁ§æÊÉÖÂ†±</h2>
                        <p class="text-sm text-gray-600 mt-1">ÂÆüÈöõ„Å´„ÅäÂÆ¢Êßò„Å´Ë°®Á§∫„Åï„Çå„ÇãË©≥Á¥∞ÊÉÖÂ†±„Å´„Å™„Çä„Åæ„Åô</p>
                    </div>
                    <button onclick="previewCompanyInfo()" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                        „Éó„É¨„Éì„É•„Éº
                    </button>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <!-- „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´Ë®≠ÂÆö -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´</h3>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center relative" id="mainVisualUploadArea">
                            <input type="file" id="mainVisualInput" class="hidden" accept="image/*" onchange="handleMainVisualUpload(event)">
                            <div id="mainVisualPreview" class="hidden">
                                <img id="mainVisualImage" src="" alt="„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´" class="max-w-full h-48 mx-auto object-cover rounded">
                                <button onclick="removeMainVisual()" class="mt-2 px-4 py-2 text-red-600 hover:text-red-800 border border-red-300 rounded">ÂâäÈô§</button>
                            </div>
                            <div id="mainVisualPlaceholder">
                                <svg class="mx-auto h-12 w-12 text-gray-400 mb-3" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <p class="text-sm text-gray-600 mb-2">„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´ÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ</p>
                                <button onclick="document.getElementById('mainVisualInput').click()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                                    ÁîªÂÉè„ÇíÈÅ∏Êäû
                                </button>
                                <p class="text-xs text-gray-500 mt-2">Êé®Â•®: 1920x600px ‰ª•‰∏ä</p>
                            </div>
                        </div>
                    </div>

                    <!-- ÊñΩÂ∑•‰∫ã‰æã -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">ÊñΩÂ∑•‰∫ã‰æã</h3>
                        <button onclick="addConstructionExample()" class="mb-4 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">
                            ÊñΩÂ∑•‰∫ã‰æã„ÇíËøΩÂä†
                        </button>
                        <div id="constructionExamplesList" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- ÊñΩÂ∑•‰∫ã‰æã„ÅåÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Çã -->
                        </div>
                    </div>

                    <!-- ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº</h3>
                        <div id="photoGalleryList" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer hover:border-blue-500" onclick="document.getElementById('galleryUpload').click()">
                                <svg class="w-8 h-8 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                </svg>
                                <span class="text-sm text-gray-500">ÁîªÂÉè„ÇíËøΩÂä†</span>
                            </div>
                            <!-- „ÇÆ„É£„É©„É™„ÉºÁîªÂÉè„ÅåÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Çã -->
                        </div>
                        <input type="file" id="galleryUpload" accept="image/*" multiple style="display: none;" onchange="handleGalleryUpload(event)">
                    </div>

                    <!-- ‰ºöÁ§æÂü∫Êú¨ÊÉÖÂ†± -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">Âü∫Êú¨ÊÉÖÂ†±</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">‰ºöÁ§æÂêç <span class="text-red-500">*</span></label>
                                <input type="text" id="companyName" class="w-full px-3 py-2 border rounded-lg" placeholder="‰æã: Ê†™Âºè‰ºöÁ§æ„Åè„Çâ„Åπ„ÇãÂ°óË£Ö" value="">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">‰ºöÁ§æÂêç„Ç´„Éä <span class="text-red-500">*</span></label>
                                <input type="text" id="companyNameKana" class="w-full px-3 py-2 border rounded-lg" placeholder="„Ç´„Çø„Ç´„Éä„ÅßÂÖ•Âäõ" value="">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Â±ãÂè∑</label>
                                <input type="text" id="tradeName" class="w-full px-3 py-2 border rounded-lg" placeholder="‰æã: „Åè„Çâ„Åπ„Çã„Éö„Ç§„É≥„Éà" value="" onchange="updateTradeNameDisplay()">

                                <!-- Â±ãÂè∑Ë°®Á§∫„Ç™„Éó„Ç∑„Éß„É≥ -->
                                <div class="mt-3 p-3 bg-gray-50 rounded-lg" id="tradeNameDisplayOptions" style="display: none;">
                                    <label class="block text-xs font-medium text-gray-700 mb-2">‰ºöÁ§æÂêç„ÅÆË°®Á§∫ÊñπÊ≥ï</label>
                                    <div class="space-y-2">
                                        <!-- „Éë„Çø„Éº„É≥1ÔºöÁ§æÂêçË°®Á§∫ -->
                                        <label class="flex items-center p-2 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                            <input type="radio" name="tradeNameDisplay" value="company" class="mr-2" checked onchange="updateCompanyNameDisplay()">
                                            <div>
                                                <span class="text-xs font-medium">„Éë„Çø„Éº„É≥1ÔºöÁ§æÂêçË°®Á§∫</span>
                                                <div class="text-xs text-gray-600 mt-0.5">‰æã: Ê†™Âºè‰ºöÁ§æ„Åè„Çâ„Åπ„ÇãÂ°óË£Ö</div>
                                            </div>
                                        </label>

                                        <!-- „Éë„Çø„Éº„É≥2ÔºöÂ±ãÂè∑Ë°®Á§∫ -->
                                        <label class="flex items-center p-2 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                            <input type="radio" name="tradeNameDisplay" value="trade" class="mr-2" onchange="updateCompanyNameDisplay()">
                                            <div>
                                                <span class="text-xs font-medium">„Éë„Çø„Éº„É≥2ÔºöÂ±ãÂè∑Ë°®Á§∫</span>
                                                <div class="text-xs text-gray-600 mt-0.5">‰æã: „Åè„Çâ„Åπ„Çã„Éö„Ç§„É≥„Éà</div>
                                            </div>
                                        </label>

                                        <!-- „Éë„Çø„Éº„É≥3Ôºö‰∏°ÊñπË°®Á§∫ -->
                                        <label class="flex items-center p-2 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                            <input type="radio" name="tradeNameDisplay" value="both" class="mr-2" onchange="updateCompanyNameDisplay()">
                                            <div>
                                                <span class="text-xs font-medium">„Éë„Çø„Éº„É≥3Ôºö‰∏°ÊñπË°®Á§∫</span>
                                                <div class="text-xs text-gray-600 mt-0.5">‰æã: Ê†™Âºè‰ºöÁ§æ„Åè„Çâ„Åπ„ÇãÂ°óË£ÖÔΩú„Åè„Çâ„Åπ„Çã„Éö„Ç§„É≥„Éà</div>
                                            </div>
                                        </label>

                                        <!-- „Éë„Çø„Éº„É≥3„ÅÆ„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„Ç™„Éó„Ç∑„Éß„É≥ -->
                                        <div id="bothDisplayOptions" class="ml-6 p-2 bg-blue-50 rounded-lg" style="display: none;">
                                            <h4 class="text-xs font-semibold text-gray-700 mb-2">„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„Ç™„Éó„Ç∑„Éß„É≥</h4>

                                            <!-- Ë°®Á§∫È†ÜÂ∫è -->
                                            <div class="mb-2">
                                                <label class="flex items-center">
                                                    <input type="checkbox" id="reverseOrder" class="mr-2" onchange="updateCompanyNameDisplay()">
                                                    <span class="text-xs">È†ÜÁï™„ÇíÂÖ•„ÇåÊõø„Åà„Çã</span>
                                                </label>
                                                <div class="text-xs text-gray-500 ml-6">‚Üí „Åè„Çâ„Åπ„Çã„Éö„Ç§„É≥„ÉàÔΩúÊ†™Âºè‰ºöÁ§æ„Åè„Çâ„Åπ„ÇãÂ°óË£Ö</div>
                                            </div>

                                            <!-- ÊñáÂ≠ó„Çµ„Ç§„Ç∫ -->
                                            <div>
                                                <label class="flex items-center">
                                                    <input type="checkbox" id="smallerSecond" class="mr-2" onchange="updateCompanyNameDisplay()">
                                                    <span class="text-xs">Âæå„Çç„ÅÆÊñáÂ≠ó„ÇíÂ∞è„Åï„Åè„Åô„ÇãÔºà85%„Çµ„Ç§„Ç∫Ôºâ</span>
                                                </label>
                                                <div class="text-xs text-gray-500 ml-6">‚Üí Â§ß„Åç„ÅÑÊñáÂ≠óÔΩú<span style="font-size:85%">Â∞è„Åï„ÅÑÊñáÂ≠ó</span></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Â±ãÂè∑„Ç´„Éä</label>
                                <input type="text" id="tradeNameKana" class="w-full px-3 py-2 border rounded-lg" placeholder="„Ç´„Çø„Ç´„Éä„ÅßÂÖ•Âäõ" value="">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">‰ª£Ë°®ËÄÖÂêç <span class="text-red-500">*</span></label>
                                <input type="text" id="representative" class="w-full px-3 py-2 border rounded-lg" placeholder="‰ª£Ë°®ËÄÖÂêç„ÇíÂÖ•Âäõ" value="">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">‰ª£Ë°®ËÄÖÂêç„Ç´„Éä <span class="text-red-500">*</span></label>
                                <input type="text" id="representativeKana" class="w-full px-3 py-2 border rounded-lg" placeholder="„Ç´„Çø„Ç´„Éä„ÅßÂÖ•Âäõ" value="">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ÈÉµ‰æøÁï™Âè∑ <span class="text-red-500">*</span></label>
                                <input type="text" id="zipCode" class="w-full px-3 py-2 border rounded-lg" placeholder="123-4567" value="">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">‰ΩèÊâÄ <span class="text-red-500">*</span></label>
                                <input type="text" id="address" class="w-full px-3 py-2 border rounded-lg" placeholder="Êù±‰∫¨ÈÉΩÊ∏ØÂå∫ÈùíÂ±±1-1-1" value="">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ÈõªË©±Áï™Âè∑ <span class="text-red-500">*</span></label>
                                <input type="text" id="phone" class="w-full px-3 py-2 border rounded-lg" placeholder="03-1234-5678" value="">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">„Ç¶„Çß„Éñ„Çµ„Ç§„ÉàURL</label>
                                <input type="text" id="website" class="w-full px-3 py-2 border rounded-lg" placeholder="https://example.com" value="">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Ë®≠Á´ãÂπ¥Êúà</label>
                                <input type="text" id="established" class="w-full px-3 py-2 border rounded-lg" placeholder="‰æã: 2010Âπ¥4Êúà" value="">
                            </div>
                        </div>
                        <div class="grid grid-cols-1 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">PRÊñá <span class="text-red-500">*</span></label>
                                <textarea id="prText"
                                    class="w-full px-3 py-2 border rounded-lg resize-y"
                                    rows="10"
                                    placeholder="‰ºöÁ§æ„ÅÆÁâπÂæ¥„ÇÑPRÊñá„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"
                                    style="min-height: 200px;"></textarea>
                                <p class="text-xs text-gray-500 mt-1 text-right">
                                    <span id="prTextCharCount">0</span>ÊñáÂ≠ó
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- ÊîØÂ∫óÊÉÖÂ†± -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">ÊîØÂ∫óÊÉÖÂ†±</h3>
                        <div id="branchList">
                            <!-- ÊîØÂ∫ó„ÅåÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Çã -->
                        </div>
                        <button onclick="addBranch()" class="mt-3 text-blue-600 hover:text-blue-800 text-sm font-medium">+ ÊîØÂ∫ó„ÇíËøΩÂä†</button>
                    </div>

                    <!-- ÈÄ£Áµ°ÂÖàÊÉÖÂ†± -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">ÈÄ£Áµ°ÂÖàÊÉÖÂ†±</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Ë´ãÊ±ÇÁî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ <span class="text-red-500">*</span></label>
                                <input type="email" id="billingEmail" class="w-full px-3 py-2 border rounded-lg" placeholder="billing@example.com" value="">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Âñ∂Ê•≠Áî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ <span class="text-red-500">*</span></label>
                                <input type="email" id="salesEmail" class="w-full px-3 py-2 border rounded-lg" placeholder="sales@company.co.jp" value="">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç <span class="text-red-500">*</span></label>
                                <input type="text" id="salesPersonName" class="w-full px-3 py-2 border rounded-lg" placeholder="Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„ÅÆÊ∞èÂêç„ÇíÂÖ•Âäõ" value="">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„Ç´„Éä <span class="text-red-500">*</span></label>
                                <input type="text" id="salesPersonKana" class="w-full px-3 py-2 border rounded-lg" placeholder="„É§„Éû„ÉÄ „Çø„É≠„Ç¶" value="">
                            </div>
                        </div>
                    </div>

                    <!-- ‰∫ãÊ•≠Ë©≥Á¥∞ -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">‰∫ãÊ•≠Ë©≥Á¥∞</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ÂæìÊ•≠Âì°Êï∞ <span class="text-red-500">*</span></label>
                                <select id="employees" class="w-full px-3 py-2 border rounded-lg">
                                    <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                    <option value="1-2">1„Äú2Âêç</option>
                                    <option value="3-5">3„Äú5Âêç</option>
                                    <option value="6-10">6„Äú10Âêç</option>
                                    <option value="11+">11Âêç‰ª•‰∏ä</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Â£≤‰∏äË¶èÊ®° <span class="text-red-500">*</span></label>
                                <select id="salesScale" class="w-full px-3 py-2 border rounded-lg">
                                    <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                    <option value="under-10m">1,000‰∏áÂÜÜÊú™Ê∫Ä</option>
                                    <option value="10m-30m">1,000‰∏áÂÜÜ„Äú3,000‰∏áÂÜÜ</option>
                                    <option value="30m-50m">3,000‰∏áÂÜÜ„Äú5,000‰∏áÂÜÜ</option>
                                    <option value="50m-100m">5,000‰∏áÂÜÜ„Äú1ÂÑÑÂÜÜ</option>
                                    <option value="100m-300m">1ÂÑÑÂÜÜ„Äú3ÂÑÑÂÜÜ</option>
                                    <option value="over-300m">3ÂÑÑÂÜÜ‰ª•‰∏ä</option>
                                </select>
                            </div>
                        </div>
                    </div>


                    <!-- ÂØæÂøú„Ç®„É™„Ç¢ -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">ÂØæÂøú„Ç®„É™„Ç¢</h3>
                        <p class="text-sm text-gray-600 mb-3">‚Äª Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Åã„ÇâËá™ÂãïÁöÑ„Å´ÂèçÊò†„Åï„Çå„Åæ„Åô</p>

                        <!-- Ëá™ÂãïÂèçÊò†Ë°®Á§∫ -->
                        <div id="companyAreaAuto" class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                            <div id="companyAreaDisplay">
                                <!-- ÈÉΩÈÅìÂ∫úÁúå -->
                                <div class="p-4 border-b border-gray-100">
                                    <div class="flex items-center mb-3">
                                        <span class="text-lg mr-2">üìç</span>
                                        <h4 class="text-sm font-semibold text-gray-800">ÂØæÂøúÈÉΩÈÅìÂ∫úÁúå</h4>
                                    </div>
                                    <div id="companyPrefecturesDisplay" class="flex flex-wrap gap-2">
                                        <!-- Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Åã„ÇâÂèçÊò† -->
                                    </div>
                                </div>

                                <!-- Â∏ÇÂå∫Áî∫Êùë -->
                                <div class="p-4 border-b border-gray-100 bg-gray-50">
                                    <div class="flex items-center mb-3">
                                        <span class="text-lg mr-2">üèòÔ∏è</span>
                                        <h4 class="text-sm font-semibold text-gray-800">ÂØæÂøúÂ∏ÇÂå∫Áî∫Êùë</h4>
                                    </div>
                                    <div id="companyCitiesDisplay" class="flex flex-wrap gap-1.5 max-h-64 overflow-y-auto p-2 bg-white rounded border border-gray-200">
                                        <!-- Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Åã„ÇâÂèçÊò† -->
                                    </div>
                                </div>

                                <!-- ÂÑ™ÂÖà„Ç®„É™„Ç¢ -->
                                <div class="p-4">
                                    <div class="flex items-center mb-3">
                                        <span class="text-lg mr-2">‚≠ê</span>
                                        <h4 class="text-sm font-semibold text-gray-800">ÂÑ™ÂÖà„Ç®„É™„Ç¢</h4>
                                    </div>
                                    <div id="companyPrioritiesDisplay" class="flex flex-wrap gap-2">
                                        <!-- Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Åã„ÇâÂèçÊò† -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ÂØæÂøúÂ∑•‰∫ãÂÜÖÂÆπ -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">ÂØæÂøúÂ∑•‰∫ãÂÜÖÂÆπ</h3>
                        <p class="text-sm text-gray-600 mb-3">‚Äª Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Åã„ÇâËá™ÂãïÁöÑ„Å´ÂèçÊò†„Åï„Çå„Åæ„Åô</p>

                        <!-- Ëá™ÂãïÂèçÊò†Ë°®Á§∫ -->
                        <div id="companyConstructionAuto" class="bg-white border border-gray-200 rounded-lg p-4">
                            <div id="companyConstructionDisplay" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                                <!-- Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅßÈÅ∏Êäû„Åï„Çå„ÅüÈ†ÖÁõÆ„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                            </div>
                        </div>
                    </div>

                    <!-- „Ç¢„Éî„Éº„É´„Éù„Ç§„É≥„ÉàÔºàËá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Åã„ÇâËá™ÂãïÂèçÊò†Ôºâ -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">„Ç¢„Éî„Éº„É´„Éù„Ç§„É≥„Éà</h3>
                        <p class="text-sm text-gray-600 mb-3">‚Äª Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Åã„ÇâËá™ÂãïÁöÑ„Å´ÂèçÊò†„Åï„Çå„Åæ„Åô</p>

                        <!-- Ëá™ÂãïÂèçÊò†Ë°®Á§∫ -->
                        <div id="companyAppealPointsAuto" class="bg-white border border-gray-200 rounded-lg p-4">
                            <div id="companyAppealPointsDisplay" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                                <!-- Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅßÈÅ∏Êäû„Åï„Çå„ÅüÈ†ÖÁõÆ„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                            </div>
                        </div>
                    </div>

                    <!-- ‰øùÊúâË≥áÊ†º -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">‰øùÊúâË≥áÊ†º</h3>
                        <p class="text-sm text-gray-600 mb-4">Ë©≤ÂΩì„Åô„ÇãË≥áÊ†º„Çí„Åô„Åπ„Å¶ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºàË§áÊï∞ÈÅ∏ÊäûÂèØÔºâ</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-4">
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="‰∏ÄÁ¥öÂ°óË£ÖÊäÄËÉΩÂ£´" class="mr-3">
                                <span class="text-sm">‰∏ÄÁ¥öÂ°óË£ÖÊäÄËÉΩÂ£´</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="‰∫åÁ¥öÂ°óË£ÖÊäÄËÉΩÂ£´" class="mr-3">
                                <span class="text-sm">‰∫åÁ¥öÂ°óË£ÖÊäÄËÉΩÂ£´</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="Ë∂≥Â†¥ÁµÑÁ´ã‰ΩúÊ•≠‰∏ª‰ªªËÄÖ" class="mr-3">
                                <span class="text-sm">Ë∂≥Â†¥ÁµÑÁ´ã‰ΩúÊ•≠‰∏ª‰ªªËÄÖ</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="Áü≥Á∂ø‰ΩúÊ•≠‰∏ª‰ªªËÄÖ" class="mr-3">
                                <span class="text-sm">Áü≥Á∂øÔºà„Ç¢„Çπ„Éô„Çπ„ÉàÔºâ‰ΩúÊ•≠‰∏ª‰ªªËÄÖ</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="Â§ñÂ£ÅË®∫Êñ≠Â£´" class="mr-3">
                                <span class="text-sm">Â§ñÂ£ÅË®∫Êñ≠Â£´</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="Â§ñÂ£ÅÂä£ÂåñË®∫Êñ≠Â£´" class="mr-3">
                                <span class="text-sm">Â§ñÂ£ÅÂä£ÂåñË®∫Êñ≠Â£´</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="Â§ñÂ£Å„Ç¢„Éâ„Éê„Ç§„Ç∂„Éº" class="mr-3">
                                <span class="text-sm">Â§ñÂ£Å„Ç¢„Éâ„Éê„Ç§„Ç∂„Éº</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="Â±ãÊ†πË®∫Êñ≠Â£´" class="mr-3">
                                <span class="text-sm">Â±ãÊ†πË®∫Êñ≠Â£´</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="Èõ®Êºè„ÇäË®∫Êñ≠Â£´" class="mr-3">
                                <span class="text-sm">Èõ®Êºè„ÇäË®∫Êñ≠Â£´</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="Â¢óÊîπÁØâÁõ∏Ë´áÂì°" class="mr-3">
                                <span class="text-sm">Â¢óÊîπÁØâÁõ∏Ë´áÂì°</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="Á¨¨‰∫åÁ®ÆÈõªÊ∞óÂ∑•‰∫ãÂ£´" class="mr-3">
                                <span class="text-sm">Á¨¨‰∫åÁ®ÆÈõªÊ∞óÂ∑•‰∫ãÂ£´</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="ÊúâÊ©üÊ∫∂Ââ§‰ΩúÊ•≠‰∏ª‰ªªËÄÖ" class="mr-3">
                                <span class="text-sm">ÊúâÊ©üÊ∫∂Ââ§‰ΩúÊ•≠‰∏ª‰ªªËÄÖ</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="qualifications" value="‰∏ÄÁ¥öÈò≤Ê∞¥ÊñΩÂ∑•ÊäÄËÉΩÂ£´" class="mr-3">
                                <span class="text-sm">‰∏ÄÁ¥öÈò≤Ê∞¥ÊñΩÂ∑•ÊäÄËÉΩÂ£´</span>
                            </label>
                        </div>
                        <!-- „Åù„ÅÆ‰ªñ„ÅÆË≥áÊ†º„ÇíËøΩÂä† -->
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">„Åù„ÅÆ‰ªñ„ÅÆË≥áÊ†º</label>
                            <div class="flex gap-2" id="customQualifications">
                                <input type="text" id="customQualificationInput" class="flex-1 px-3 py-2 border rounded-lg" placeholder="„Åù„ÅÆ‰ªñ„ÅÆË≥áÊ†º„ÇíÂÖ•Âäõ">
                                <button onclick="addCustomQualification()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                                    ËøΩÂä†
                                </button>
                            </div>
                            <div id="customQualificationsList" class="mt-3 flex flex-wrap gap-2">
                                <!-- „Ç´„Çπ„Çø„É†Ë≥áÊ†º„ÅåÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Çã -->
                            </div>
                        </div>
                    </div>

                    <!-- Âä†ÂÖ•‰øùÈô∫ -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">Âä†ÂÖ•‰øùÈô∫</h3>
                        <p class="text-sm text-gray-600 mb-4">Âä†ÂÖ•„Åó„Å¶„ÅÑ„Çã‰øùÈô∫„Çí„Åô„Åπ„Å¶ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºàË§áÊï∞ÈÅ∏ÊäûÂèØÔºâ</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-4">
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="insurance" value="Â∑•‰∫ã‰øùÈô∫" class="mr-3">
                                <span class="text-sm">Â∑•‰∫ã‰øùÈô∫</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="insurance" value="Ë≥†ÂÑüË≤¨‰ªª‰øùÈô∫" class="mr-3">
                                <span class="text-sm">Ë≥†ÂÑüË≤¨‰ªª‰øùÈô∫</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="insurance" value="„É™„Éï„Ç©„Éº„É†ÁëïÁñµ‰øùÈô∫" class="mr-3">
                                <span class="text-sm">„É™„Éï„Ç©„Éº„É†ÁëïÁñµ‰øùÈô∫</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="insurance" value="Âª∫Ë®≠Â∑•‰∫ã‰øùÈô∫" class="mr-3">
                                <span class="text-sm">Âª∫Ë®≠Â∑•‰∫ã‰øùÈô∫</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="insurance" value="Ë´ãË≤†Ê•≠ËÄÖË≥†ÂÑüË≤¨‰ªª‰øùÈô∫" class="mr-3">
                                <span class="text-sm">Ë´ãË≤†Ê•≠ËÄÖË≥†ÂÑüË≤¨‰ªª‰øùÈô∫</span>
                            </label>
                            <label class="flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer">
                                <input type="checkbox" name="insurance" value="ÁîüÁî£Áâ©Ë≥†ÂÑüË≤¨‰ªª‰øùÈô∫" class="mr-3">
                                <span class="text-sm">ÁîüÁî£Áâ©Ë≥†ÂÑüË≤¨‰ªª‰øùÈô∫ÔºàPL‰øùÈô∫Ôºâ</span>
                            </label>
                        </div>
                        <!-- „Åù„ÅÆ‰ªñ„ÅÆ‰øùÈô∫„ÇíËøΩÂä† -->
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">„Åù„ÅÆ‰ªñ„ÅÆ‰øùÈô∫</label>
                            <div class="flex gap-2" id="customInsurance">
                                <input type="text" id="customInsuranceInput" class="flex-1 px-3 py-2 border rounded-lg" placeholder="„Åù„ÅÆ‰ªñ„ÅÆ‰øùÈô∫„ÇíÂÖ•Âäõ">
                                <button onclick="addCustomInsurance()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                                    ËøΩÂä†
                                </button>
                            </div>
                            <div id="customInsuranceList" class="mt-3 flex flex-wrap gap-2">
                                <!-- „Ç´„Çπ„Çø„É†‰øùÈô∫„ÅåÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Çã -->
                            </div>
                        </div>
                    </div>

                    <!-- ‰øùÂ≠ò„Éú„Çø„É≥ -->
                    <div class="flex justify-end mt-8 gap-3">
                        <button onclick="resetCompanyInfo()" class="px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium">
                            „É™„Çª„ÉÉ„Éà
                        </button>
                        <button onclick="saveCompanyInfo()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                            </svg>
                            Â§âÊõ¥„Çí‰øùÂ≠ò
                        </button>
                    </div>
                </div>
            </div>

            <!-- „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="cancelSection" class="section" style="display: none;">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã</h2>
                        <p class="text-sm text-gray-600 mt-1">Ê°à‰ª∂„ÅÆ„Ç≠„É£„É≥„Çª„É´ÁêÜÁî±„ÇíÈÅ∏Êäû„Åó„Å¶Áî≥Ë´ã„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                    </div>
                </div>

                <!-- Ê§úÁ¥¢„Éê„Éº -->
                <div class="bg-white rounded-lg shadow p-4 mb-6">
                    <!-- Âü∫Êú¨Ê§úÁ¥¢ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                        <div class="lg:col-span-2">
                            <input type="text" id="cancelSearchInput" placeholder="È°ßÂÆ¢Âêç„ÉªÈõªË©±Áï™Âè∑„Éª‰ΩèÊâÄ„ÅßÊ§úÁ¥¢ÔºàÈÉ®ÂàÜ‰∏ÄËá¥Ôºâ"
                                   class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                   onkeyup="searchCancelCases()">
                        </div>
                        <div>
                            <select id="cancelAssigneeFilter" class="w-full px-4 py-2 border rounded-lg" onchange="searchCancelCases()">
                                <option value="">ÊãÖÂΩìËÄÖ„ÅßÊ§úÁ¥¢</option>
                                <option value="self">Ëá™ÂàÜ„ÅÆÊ°à‰ª∂</option>
                                <option value="Áî∞‰∏≠Â§™ÈÉé">Áî∞‰∏≠Â§™ÈÉé</option>
                                <option value="‰ΩêËó§Ëä±Â≠ê">‰ΩêËó§Ëä±Â≠ê</option>
                                <option value="Èà¥Êú®‰∏ÄÈÉé">Èà¥Êú®‰∏ÄÈÉé</option>
                                <option value="È´òÊ©ã„Åø„ÇÜ„Åç">È´òÊ©ã„Åø„ÇÜ„Åç</option>
                                <option value="‰ºäËó§ÂÅ•">‰ºäËó§ÂÅ•</option>
                                <option value="Êú™Ââ≤ÂΩì">Êú™Ââ≤ÂΩì</option>
                            </select>
                        </div>
                    </div>

                    <!-- ÊúüÈñìÊ§úÁ¥¢ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex items-center gap-2">
                            <label class="text-xs text-gray-600">ÊµÅÂÖ•ÊúüÈñì</label>
                            <input type="date" id="cancelStartDate" class="px-3 py-2 border rounded-lg" onchange="searchCancelCases()">
                            <span class="text-xs text-gray-600">„Äú</span>
                            <input type="date" id="cancelEndDate" class="px-3 py-2 border rounded-lg" onchange="searchCancelCases()">
                        </div>
                        <div class="flex items-center justify-end">
                            <button onclick="searchCancelCases()" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                Ê§úÁ¥¢
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Ê°à‰ª∂‰∏ÄË¶ß -->
                <div id="cancelCasesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6">
                    <!-- Ê°à‰ª∂„Ç´„Éº„Éâ„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                </div>

                <!-- „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„Éï„Ç©„Éº„É†Ôºà„É¢„Éº„ÉÄ„É´Ôºâ -->
                <div id="cancelModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-4">„Ç≠„É£„É≥„Çª„É´ÁêÜÁî±„ÅÆÈÅ∏Êäû</h3>
                            <div id="cancelQuestionContainer">
                                <!-- Ë≥™Âïè„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                            </div>
                            <div id="cancelAIResponse" class="hidden mt-6 p-4 bg-blue-50 rounded-lg">
                                <h4 class="font-semibold text-gray-800 mb-2">AIÁîüÊàê„ÅÆÁî≥Ë´ãÊñá</h4>
                                <div id="cancelAIText" class="text-gray-700 whitespace-pre-wrap"></div>
                                <div class="mt-4 flex gap-3">
                                    <button onclick="submitCancelRequest()" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                        „Åì„ÅÆÂÜÖÂÆπ„ÅßÁî≥Ë´ã
                                    </button>
                                    <button onclick="regenerateCancelText()" class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                                        ÂÜçÁîüÊàê
                                    </button>
                                </div>
                            </div>
                            <button onclick="closeCancelModal()" class="mt-4 text-gray-500 hover:text-gray-700">
                                „Ç≠„É£„É≥„Çª„É´
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÊàêÁ¥ÑÂ†±Âëä„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="contractSection" class="section" style="display: none;">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">ÊàêÁ¥ÑÂ†±Âëä</h2>
                        <p class="text-sm text-gray-600 mt-1">ÊàêÁ¥Ñ„Åó„ÅüÊ°à‰ª∂„ÅÆË©≥Á¥∞„ÇíÂ†±Âëä„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                    </div>
                </div>

                <!-- Ê§úÁ¥¢„Éê„Éº -->
                <div class="bg-white rounded-lg shadow p-4 mb-6">
                    <!-- Âü∫Êú¨Ê§úÁ¥¢ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                        <div class="lg:col-span-2">
                            <input type="text" id="contractSearchInput" placeholder="È°ßÂÆ¢Âêç„ÉªÈõªË©±Áï™Âè∑„Éª‰ΩèÊâÄ„ÅßÊ§úÁ¥¢ÔºàÈÉ®ÂàÜ‰∏ÄËá¥Ôºâ"
                                   class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                   onkeyup="searchContractCases()">
                        </div>
                        <div>
                            <select id="contractAssigneeFilter" class="w-full px-4 py-2 border rounded-lg" onchange="searchContractCases()">
                                <option value="">ÊãÖÂΩìËÄÖ„ÅßÊ§úÁ¥¢</option>
                                <option value="self">Ëá™ÂàÜ„ÅÆÊ°à‰ª∂</option>
                                <option value="Áî∞‰∏≠Â§™ÈÉé">Áî∞‰∏≠Â§™ÈÉé</option>
                                <option value="‰ΩêËó§Ëä±Â≠ê">‰ΩêËó§Ëä±Â≠ê</option>
                                <option value="Èà¥Êú®‰∏ÄÈÉé">Èà¥Êú®‰∏ÄÈÉé</option>
                                <option value="È´òÊ©ã„Åø„ÇÜ„Åç">È´òÊ©ã„Åø„ÇÜ„Åç</option>
                                <option value="‰ºäËó§ÂÅ•">‰ºäËó§ÂÅ•</option>
                                <option value="Êú™Ââ≤ÂΩì">Êú™Ââ≤ÂΩì</option>
                            </select>
                        </div>
                    </div>

                    <!-- ÊúüÈñìÊ§úÁ¥¢ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex items-center gap-2">
                            <label class="text-xs text-gray-600">ÊµÅÂÖ•ÊúüÈñì</label>
                            <input type="date" id="contractStartDate" class="px-3 py-2 border rounded-lg" onchange="searchContractCases()">
                            <span class="text-xs text-gray-600">„Äú</span>
                            <input type="date" id="contractEndDate" class="px-3 py-2 border rounded-lg" onchange="searchContractCases()">
                        </div>
                        <div class="flex items-center justify-end">
                            <button onclick="searchContractCases()" class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
                                Ê§úÁ¥¢
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Ê°à‰ª∂‰∏ÄË¶ß -->
                <div id="contractCasesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6">
                    <!-- Ê°à‰ª∂„Ç´„Éº„Éâ„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                </div>

                <!-- ÊàêÁ¥ÑÂ†±Âëä„É¢„Éº„ÉÄ„É´ -->
                <div id="contractModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto relative">
                        <!-- Èñâ„Åò„Çã„Éú„Çø„É≥ÔºàÂè≥‰∏äÔºâ -->
                        <button onclick="closeContractModal()" class="absolute top-4 right-4 p-2 rounded-lg hover:bg-gray-100 transition-colors z-10">
                            <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>

                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-4">ÊàêÁ¥ÑÂ†±Âëä</h3>

                            <!-- È°ßÂÆ¢ÊÉÖÂ†±Ë°®Á§∫ -->
                            <div id="contractCustomerInfo" class="hidden mb-4 p-4 bg-blue-50 rounded-lg">
                                <div class="text-lg font-semibold" id="contractCustomerName"></div>
                                <div class="text-gray-600" id="contractCustomerAddress"></div>
                            </div>

                            <!-- Ë≥™Âïè„Éï„Çß„Éº„Ç∫ -->
                            <div id="contractQuestionContainer">
                                <!-- Ë≥™Âïè„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                            </div>

                            <!-- „Éï„Ç©„Éº„É†„Éï„Çß„Éº„Ç∫ -->
                            <div id="contractFormPhase" class="hidden">
                                <form id="contractReportForm">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <!-- Â•ëÁ¥ÑÈáëÈ°ç -->
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Â•ëÁ¥ÑÈáëÈ°çÔºàÁ®éËæºÔºâ</label>
                                            <div class="flex items-center">
                                                <span class="mr-2">¬•</span>
                                                <input type="number" id="contractAmount" class="flex-1 px-3 py-2 border rounded-lg"
                                                       placeholder="1234567" min="0" step="1" required>
                                                <span class="ml-2">ÂÜÜ</span>
                                            </div>
                                        </div>

                                        <!-- ÂÆåÂ∑•Êó• -->
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2" id="completionDateLabel">ÂÆåÂ∑•‰∫àÂÆöÊó•</label>
                                            <input type="date" id="completionDate" class="w-full px-3 py-2 border rounded-lg" required>
                                        </div>

                                        <!-- ÁùÄÈáëÊó• -->
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2" id="paymentDateLabel">ÁùÄÈáë‰∫àÂÆöÊó•</label>
                                            <input type="date" id="paymentDate" class="w-full px-3 py-2 border rounded-lg" required>
                                        </div>

                                        <!-- ÂØæË±°Áâ©‰ª∂Á®ÆÂà• -->
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">ÂØæË±°Áâ©‰ª∂Á®ÆÂà•</label>

                                            <!-- Áâ©‰ª∂„Çø„Ç§„ÉóÔºàË§áÊï∞ÈÅ∏ÊäûÂèØÔºâ -->
                                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3">
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="propertyType" value="Êà∏Âª∫„Å¶" class="mr-2">
                                                    <span>Êà∏Âª∫„Å¶</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="propertyType" value="„Ç¢„Éë„Éº„Éà" class="mr-2">
                                                    <span>„Ç¢„Éë„Éº„Éà</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="propertyType" value="„Éû„É≥„Ç∑„Éß„É≥" class="mr-2">
                                                    <span>„Éû„É≥„Ç∑„Éß„É≥</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="propertyType" value="Â∫óËàó" class="mr-2">
                                                    <span>Â∫óËàó</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="propertyType" value="‰∫ãÂãôÊâÄ" class="mr-2">
                                                    <span>‰∫ãÂãôÊâÄ</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="propertyType" value="Â∑•Â†¥" class="mr-2">
                                                    <span>Â∑•Â†¥</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="propertyType" value="ÂÄâÂ∫´" class="mr-2">
                                                    <span>ÂÄâÂ∫´</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="propertyType" value="„Åù„ÅÆ‰ªñ" class="mr-2" onchange="toggleOtherPropertyDetails()">
                                                    <span>„Åù„ÅÆ‰ªñ</span>
                                                </label>
                                            </div>
                                            <input type="text" id="otherPropertyDetails" class="w-full px-3 py-2 border rounded-lg hidden"
                                                   placeholder="„Åù„ÅÆ‰ªñ„ÅÆÁâ©‰ª∂Á®ÆÂà•„ÇíÂÖ•Âäõ">

                                            <!-- ÈöéÊï∞ÈÅ∏Êäû -->
                                            <div class="mt-3">
                                                <label class="block text-xs text-gray-600 mb-1">ÈöéÊï∞</label>
                                                <select id="buildingFloors" class="w-full px-3 py-2 border rounded-lg">
                                                    <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                                    <option value="1F">1F</option>
                                                    <option value="2F">2F</option>
                                                    <option value="3F">3F</option>
                                                    <option value="4F">4F</option>
                                                    <option value="5F">5F</option>
                                                    <option value="6F">6F</option>
                                                    <option value="7F">7F</option>
                                                    <option value="8F">8F</option>
                                                    <option value="9F">9F</option>
                                                    <option value="10F‰ª•‰∏ä">10F‰ª•‰∏ä</option>
                                                </select>
                                            </div>
                                        </div>

                                        <!-- ÊñΩÂ∑•ÂÜÖÂÆπ -->
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">ÊñΩÂ∑•ÂÜÖÂÆπÔºàË§áÊï∞ÈÅ∏ÊäûÂèØÔºâ</label>
                                            <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-3">
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â§ñÂ£ÅÂ°óË£Ö" class="mr-2">
                                                    <span>Â§ñÂ£ÅÂ°óË£Ö</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï" class="mr-2">
                                                    <span>Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â§ñÂ£ÅÂºµÊõø„Åà" class="mr-2">
                                                    <span>Â§ñÂ£ÅÂºµÊõø„Åà</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â±ãÊ†πÂ°óË£Ö" class="mr-2">
                                                    <span>Â±ãÊ†πÂ°óË£Ö</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â±ã‰∏äÈò≤Ê∞¥" class="mr-2">
                                                    <span>Â±ã‰∏äÈò≤Ê∞¥</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â±ãÊ†πËë∫„ÅçÊõø„ÅàÔºà„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„ÉêÔºâ" class="mr-2">
                                                    <span>Â±ãÊ†πËë∫„ÅçÊõø„ÅàÔºà„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„ÉêÔºâ</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â±ãÊ†πËë∫„ÅçÊõø„ÅàÔºàÁì¶Ôºâ" class="mr-2">
                                                    <span>Â±ãÊ†πËë∫„ÅçÊõø„ÅàÔºàÁì¶Ôºâ</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï" class="mr-2">
                                                    <span>Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â§ñÂ£ÅË£ú‰øÆ" class="mr-2">
                                                    <span>Â§ñÂ£ÅË£ú‰øÆ</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Â±ãÊ†πË£ú‰øÆ" class="mr-2">
                                                    <span>Â±ãÊ†πË£ú‰øÆ</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="„Éô„É©„É≥„ÉÄÈò≤Ê∞¥" class="mr-2">
                                                    <span>„Éô„É©„É≥„ÉÄÈò≤Ê∞¥</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="Èõ®Êºè„Çä‰øÆÁπï" class="mr-2">
                                                    <span>Èõ®Êºè„Çä‰øÆÁπï</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="ÂÜÖË£ÖÊ∞¥Âõû„ÇäÔºà„Éê„Çπ„Éª„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éà„Ç§„É¨Ôºâ" class="mr-2">
                                                    <span>ÂÜÖË£ÖÊ∞¥Âõû„Çä</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="ÂÜÖË£ÖÔºàÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâ" class="mr-2">
                                                    <span>ÂÜÖË£ÖÔºàÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâ</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" name="workType" value="„Åù„ÅÆ‰ªñ" class="mr-2" onchange="toggleOtherWorkDetails()">
                                                    <span>„Åù„ÅÆ‰ªñ</span>
                                                </label>
                                            </div>
                                            <textarea id="workDetails" class="w-full px-3 py-2 border rounded-lg hidden"
                                                      rows="3" placeholder="„Åù„ÅÆ‰ªñ„ÅÆÊñΩÂ∑•ÂÜÖÂÆπ„ÇíÂÖ•Âäõ"></textarea>
                                        </div>

                                        <!-- Ë¶ãÁ©çÊõ∏„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ -->
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Ë¶ãÁ©çÊõ∏</label>
                                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                                                <input type="file" id="estimateFile" accept="image/*,application/pdf" class="hidden"
                                                       onchange="handleFileUpload(event, 'estimate')">
                                                <div id="estimatePreview" class="mb-2">
                                                    <svg class="w-12 h-12 text-gray-400 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                              d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                                    </svg>
                                                </div>
                                                <button type="button" onclick="document.getElementById('estimateFile').click()"
                                                        class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                                    „Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû
                                                </button>
                                                <p class="text-xs text-gray-500 mt-2">ÁîªÂÉè„Åæ„Åü„ÅØPDF</p>
                                            </div>
                                        </div>

                                        <!-- È†òÂèéÊõ∏„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ -->
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">È†òÂèéÊõ∏</label>
                                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                                                <input type="file" id="receiptFile" accept="image/*,application/pdf" class="hidden"
                                                       onchange="handleFileUpload(event, 'receipt')">
                                                <div id="receiptPreview" class="mb-2">
                                                    <svg class="w-12 h-12 text-gray-400 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                              d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                                    </svg>
                                                </div>
                                                <button type="button" onclick="document.getElementById('receiptFile').click()"
                                                        class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                                    „Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû
                                                </button>
                                                <p class="text-xs text-gray-500 mt-2">ÁîªÂÉè„Åæ„Åü„ÅØPDF</p>
                                            </div>
                                        </div>

                                        <!-- ÂÇôËÄÉ -->
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">ÂÇôËÄÉ</label>
                                            <textarea id="contractNotes" class="w-full px-3 py-2 border rounded-lg"
                                                      rows="3" placeholder="ÁâπË®ò‰∫ãÈ†Ö„Åå„ÅÇ„Çå„Å∞ÂÖ•Âäõ"></textarea>
                                        </div>
                                    </div>

                                    <div class="mt-6 flex justify-center">
                                        <button type="submit" class="px-8 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 font-medium">
                                            ÊàêÁ¥ÑÂ†±Âëä„ÇíÈÄÅ‰ø°
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div id="settingsSection" class="section" style="display: none;">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Ë®≠ÂÆö</h2>
                
                <!-- „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
                <!-- „Çø„Éñ„ÇíÂâäÈô§„Åó„Å¶1„Éö„Éº„Ç∏Áµ±Âêà -->
                
                <!-- „Éó„É≠„Éï„Ç£„Éº„É´ÊÉÖÂ†± -->
                <div id="profileSection">
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">„Éó„É≠„Éï„Ç£„Éº„É´ÊÉÖÂ†±</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Ê∞èÂêç</label>
                                <input type="text" id="profileName" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="Áî∞‰∏≠Â§™ÈÉé">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ÈõªË©±Áï™Âè∑</label>
                                <input type="tel" id="profilePhone" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="090-1234-5678">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                                <input type="email" id="profileEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="tanaka@example.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">LINE ID</label>
                                <input type="text" id="profileLineId" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="@tanaka_taro">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÈÄöÁü•„Éª„Ç¢„É©„Éº„ÉàË®≠ÂÆö -->
                <div id="notificationSection" class="mt-6">
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">ÈÄöÁü•„Éª„Ç¢„É©„Éº„ÉàË®≠ÂÆö</h3>
                        
                        <!-- ÈÄöÁü•ÊñπÊ≥ï -->
                        <div class="mb-6">
                            <h4 class="text-sm font-medium text-gray-700 mb-3">ÈÄöÁü•ÊñπÊ≥ï</h4>
                            <div class="space-y-3">
                                <label class="flex items-center justify-between">
                                    <span class="text-sm text-gray-700">„É°„Éº„É´ÈÄöÁü•</span>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="notifyEmail" class="toggle-switch" checked>
                                        <button onclick="testNotification('email')" class="ml-3 text-xs text-blue-600 hover:text-blue-800">„ÉÜ„Çπ„ÉàÈÄÅ‰ø°</button>
                                    </div>
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-sm text-gray-700">SMSÈÄöÁü•</span>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="notifySms" class="toggle-switch">
                                        <button onclick="testNotification('sms')" class="ml-3 text-xs text-blue-600 hover:text-blue-800">„ÉÜ„Çπ„ÉàÈÄÅ‰ø°</button>
                                    </div>
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-sm text-gray-700">LINEÈÄöÁü•</span>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="notifyLine" class="toggle-switch">
                                        <button onclick="testNotification('line')" class="ml-3 text-xs text-blue-600 hover:text-blue-800">„ÉÜ„Çπ„ÉàÈÄÅ‰ø°</button>
                                    </div>
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-sm text-gray-700">„Éñ„É©„Ç¶„Ç∂ÈÄöÁü•</span>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="notifyBrowser" class="toggle-switch" checked>
                                        <button onclick="testNotification('browser')" class="ml-3 text-xs text-blue-600 hover:text-blue-800">„ÉÜ„Çπ„ÉàÈÄÅ‰ø°</button>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <!-- ÈÄöÁü•Á®ÆÂà• -->
                        <div class="mb-6">
                            <h4 class="text-sm font-medium text-gray-700 mb-3">ÈÄöÁü•Á®ÆÂà•</h4>
                            <div class="space-y-3">
                                <!-- „Ç¢„Éù„Ç§„É≥„Éà„É™„Éû„Ç§„É≥„ÉÄ„Éº -->
                                <div class="border rounded-lg p-3 bg-gray-50 group relative">
                                    <label class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <span class="text-lg mr-2">üìã</span>
                                            <span class="text-sm font-medium text-gray-700">ÁèæË™øÂâçÊó•„É™„Éû„Ç§„É≥„ÉÄ„Éº</span>
                                            <span class="ml-1 text-gray-400 cursor-help">‚ìò</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="time" id="appointmentAlertTime" value="18:00" class="px-2 py-1 border rounded text-sm">
                                            <input type="checkbox" id="appointmentReminder" class="toggle-switch" checked onchange="updateAlertSetting('appointment_reminder', this.checked)">
                                        </div>
                                    </label>
                                    <div class="absolute left-0 top-full mt-1 hidden group-hover:block bg-gray-800 text-white text-xs rounded px-2 py-1 z-10 whitespace-nowrap">
                                        ÁèæÂú∞Ë™øÊüª„ÅÆÂâçÊó•„Å´ÈÄöÁü•„Åó„Åæ„Åô
                                    </div>
                                </div>

                                <!-- Êû∂Èõª„É™„Éû„Ç§„É≥„ÉÄ„Éº -->
                                <div class="border rounded-lg p-3 bg-gray-50 group relative">
                                    <label class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <span class="text-lg mr-2">üìû</span>
                                            <span class="text-sm font-medium text-gray-700">Êû∂Èõª„É™„Éû„Ç§„É≥„ÉÄ„Éº</span>
                                            <span class="ml-1 text-gray-400 cursor-help">‚ìò</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="time" id="callAlertTime" value="10:00" class="px-2 py-1 border rounded text-sm">
                                            <input type="checkbox" id="callReminder" class="toggle-switch" checked onchange="updateAlertSetting('call_reminder', this.checked)">
                                        </div>
                                    </label>
                                    <div class="absolute left-0 top-full mt-1 hidden group-hover:block bg-gray-800 text-white text-xs rounded px-2 py-1 z-10 whitespace-nowrap">
                                        Êú™ÂØæÂøúÊ°à‰ª∂„ÅÆÁøåÊó•„Å´ÈÄöÁü•„Åó„Åæ„Åô
                                    </div>
                                </div>

                                <!-- Ë¶ãÁ©ç„Éï„Ç©„É≠„Éº -->
                                <div class="border rounded-lg p-3 bg-gray-50 group relative">
                                    <label class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <span class="text-lg mr-2">üìù</span>
                                            <span class="text-sm font-medium text-gray-700">Ë¶ãÁ©ç„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó</span>
                                            <span class="ml-1 text-gray-400 cursor-help">‚ìò</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="number" id="followupDays" value="7" min="1" max="30" class="w-16 px-2 py-1 border rounded text-sm">
                                            <span class="text-sm text-gray-600">Êó•Âæå</span>
                                            <input type="checkbox" id="estimateFollowup" class="toggle-switch" checked onchange="updateAlertSetting('estimate_followup', this.checked)">
                                        </div>
                                    </label>
                                    <div class="absolute left-0 top-full mt-1 hidden group-hover:block bg-gray-800 text-white text-xs rounded px-2 py-1 z-10 whitespace-nowrap">
                                        Ë¶ãÁ©çÊèêÂá∫Âæå„Å´Ëá™Âãï„Åß„Éï„Ç©„É≠„ÉºÈÄöÁü•„Åó„Åæ„Åô
                                    </div>
                                </div>

                                <!-- ÂÖ•ÈáëÁ¢∫Ë™ç -->
                                <div class="border rounded-lg p-3 bg-gray-50 group relative">
                                    <label class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <span class="text-lg mr-2">üí∞</span>
                                            <span class="text-sm font-medium text-gray-700">ÂÖ•ÈáëÁ¢∫Ë™ç„Ç¢„É©„Éº„Éà</span>
                                            <span class="ml-1 text-gray-400 cursor-help">‚ìò</span>
                                        </div>
                                        <input type="checkbox" id="paymentAlert" class="toggle-switch" checked onchange="updateAlertSetting('payment_alert', this.checked)">
                                    </label>
                                    <div class="absolute left-0 top-full mt-1 hidden group-hover:block bg-gray-800 text-white text-xs rounded px-2 py-1 z-10 whitespace-nowrap">
                                        ÂÖ•Èáë‰∫àÂÆöÊó•„Å´Ëá™Âãï„ÅßÈÄöÁü•„Åó„Åæ„Åô
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ÈÄöÁü•ÊôÇÈñì„Éª‰ºëÊó•Ë®≠ÂÆö -->
                        <div class="mb-6">
                            <h4 class="text-sm font-medium text-gray-700 mb-3">ÈÄöÁü•ÊôÇÈñì„Éª‰ºëÊó•Ë®≠ÂÆö</h4>
                            <div class="space-y-4">
                                <!-- ‰ºëÊó•Ë®≠ÂÆö -->
                                <div class="border rounded-lg p-4 bg-gray-50">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="enableHolidays" onchange="toggleHolidaySettings()" checked>
                                        <span class="ml-2 text-sm font-medium text-gray-700">üìÖ ‰ºëÊó•Ë®≠ÂÆöÔºà„ÉÅ„Çß„ÉÉ„ÇØ„Åó„ÅüÊõúÊó•„ÅØÈÄöÁü•„Åï„Çå„Åæ„Åõ„ÇìÔºâ</span>
                                    </label>
                                    <div id="holidaySettings" class="mt-3 flex flex-wrap gap-3">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="holidayMon" class="mr-2">
                                            <span class="text-sm">Êúà</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="holidayTue" class="mr-2">
                                            <span class="text-sm">ÁÅ´</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="holidayWed" class="mr-2">
                                            <span class="text-sm">Ê∞¥</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="holidayThu" class="mr-2">
                                            <span class="text-sm">Êú®</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="holidayFri" class="mr-2">
                                            <span class="text-sm">Èáë</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="holidaySat" class="mr-2" checked>
                                            <span class="text-sm font-medium text-blue-600">Âúü</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="holidaySun" class="mr-2" checked>
                                            <span class="text-sm font-medium text-red-600">Êó•</span>
                                        </label>
                                    </div>
                                </div>

                                <!-- ÈÄöÁü•Âà∂ÈôêÊôÇÈñì -->
                                <div class="border rounded-lg p-4 bg-gray-50">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="enableQuietHours" onchange="toggleQuietHours()" checked>
                                        <span class="ml-2 text-sm font-medium text-gray-700">üîï ÈÄöÁü•„ÇíÂà∂Èôê„Åô„ÇãÊôÇÈñìÂ∏Ø</span>
                                    </label>
                                    <div id="quietHoursSettings" class="mt-3 space-y-2">
                                        <div class="flex items-center space-x-2">
                                            <input type="time" id="quietStart" value="22:00" class="px-3 py-2 border border-gray-300 rounded-lg">
                                            <span class="text-sm text-gray-500">„Åã„Çâ</span>
                                            <input type="time" id="quietEnd" value="08:00" class="px-3 py-2 border border-gray-300 rounded-lg">
                                            <span class="text-sm text-gray-500">„Åæ„Åß</span>
                                        </div>
                                        <p class="text-xs text-gray-500">„Åì„ÅÆÊôÇÈñìÂ∏Ø„ÅØÈÄöÁü•„ÇíÈÄÅ‰ø°„Åó„Åæ„Åõ„Çì</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Áµ±Âêà‰øùÂ≠ò„Éú„Çø„É≥ -->
                    <div class="mt-6 flex justify-end">
                        <button onclick="saveAllSettings()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
                            Ë®≠ÂÆö„Çí‰øùÂ≠ò
                        </button>
                    </div>
                </div>
            </div>
        </div><!-- settingsSection„ÅÆÁµÇ‰∫Ü -->
    </main>

    <!-- Ê®©ÈôêË®≠ÂÆö„É¢„Éº„ÉÄ„É´ -->
    <div id="permissionModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white">
            <div class="mb-4">
                <h3 class="text-lg font-bold text-gray-900" id="modalTitle">Âñ∂Ê•≠Ê®©ÈôêË®≠ÂÆö</h3>
                <p class="text-sm text-gray-500 mt-1">Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„ÅÆÊ®©Èôê„ÇíË©≥Á¥∞„Å´Ë®≠ÂÆö„Åß„Åç„Åæ„Åô</p>
            </div>
            <!-- Êñ∞Ë¶èËøΩÂä†ÊôÇ„ÅÆÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ -->
            <div id="newSalesFields" class="mb-6 hidden">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Ê∞èÂêç <span class="text-red-500">*</span></label>
                        <input type="text" id="newSalesName" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‰æãÔºöÂ±±Áî∞Â§™ÈÉé">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ <span class="text-red-500">*</span></label>
                        <input type="email" id="newSalesEmail" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="example@company.com">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÈõªË©±Áï™Âè∑</label>
                        <input type="tel" id="newSalesPhone" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="090-1234-5678">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÂΩπËÅ∑</label>
                        <select id="newSalesRole" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="‰∏ÄËà¨Âñ∂Ê•≠">‰∏ÄËà¨Âñ∂Ê•≠</option>
                            <option value="„É™„Éº„ÉÄ„Éº">„É™„Éº„ÉÄ„Éº</option>
                            <option value="‰∏ÄËà¨‰∫ãÂãô">‰∏ÄËà¨‰∫ãÂãô</option>
                            <option value="ÁèæÂ†¥Áõ£Áù£">ÁèæÂ†¥Áõ£Áù£</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Ê®©Èôê„Éó„É™„Çª„ÉÉ„Éà</label>
                <div class="grid grid-cols-4 gap-2">
                    <button onclick="setPreset('office')" class="preset-btn px-4 py-2 border rounded-lg hover:bg-gray-50">‰∏ÄËà¨‰∫ãÂãô</button>
                    <button onclick="setPreset('standard')" class="preset-btn px-4 py-2 border rounded-lg hover:bg-gray-50">‰∏ÄËà¨Âñ∂Ê•≠</button>
                    <button onclick="setPreset('leader')" class="preset-btn px-4 py-2 border rounded-lg hover:bg-gray-50">„É™„Éº„ÉÄ„Éº</button>
                    <button onclick="setPreset('admin')" class="preset-btn px-4 py-2 border rounded-lg hover:bg-gray-50">ÂâØÁÆ°ÁêÜËÄÖ</button>
                </div>
            </div>

            <h3 class="text-sm font-medium text-gray-700 mb-3">„Ç´„Çπ„Çø„É†Ë®≠ÂÆö</h3>
            <div class="permission-grid mb-6">
                <!-- Ê°à‰ª∂Èñ¢ÈÄ£ -->
                <div class="border rounded-lg p-4">
                    <h4 class="font-medium text-gray-900 mb-3">Ê°à‰ª∂Èñ¢ÈÄ£</h4>
                    <div class="space-y-2">
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="case.view.all">
                            <span class="ml-2">‰ªñÊãÖÂΩìËÄÖ„ÅÆÊ°à‰ª∂Èñ≤Ë¶ß</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                ‰ªñ„ÅÆÊãÖÂΩìËÄÖ„ÅÆÊ°à‰ª∂„ÇÇÈñ≤Ë¶ß„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="case.edit">
                            <span class="ml-2">‰ªñÊãÖÂΩìËÄÖ„ÅÆÊ°à‰ª∂Á∑®ÈõÜ</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                ‰ªñ„ÅÆÊãÖÂΩìËÄÖ„ÅÆÊ°à‰ª∂„ÇÇÁ∑®ÈõÜ„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="case.hide">
                            <span class="ml-2">Ê°à‰ª∂ÈùûË°®Á§∫Âåñ</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                ‰ªªÊÑè„ÅÆÊ°à‰ª∂„Çí‰∏ÄÊôÇÁöÑ„Å´ÈùûË°®Á§∫„Å´„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="case.delete">
                            <span class="ml-2">Ê°à‰ª∂ÂâäÈô§Ôºà24ÊôÇÈñì‰ª•ÂÜÖÔºâ</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                Ë™§ÂÖ•Âäõ„Åó„ÅüÊ°à‰ª∂„Çí24ÊôÇÈñì‰ª•ÂÜÖ„Å´Èôê„ÇäÂâäÈô§„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="case.cancel">
                            <span class="ml-2">„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                Ëá™ÂàÜ„ÅåÊãÖÂΩì„Åô„ÇãÊ°à‰ª∂„ÅÆ„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÇíË°å„Åà„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="case.contract">
                            <span class="ml-2">ÊàêÁ¥ÑÂ†±Âëä</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                Ëá™ÂàÜ„ÅåÊãÖÂΩì„Åô„ÇãÊ°à‰ª∂„ÅÆÊàêÁ¥ÑÂ†±Âëä„ÇíÁôªÈå≤„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö -->
                <div class="border rounded-lg p-4">
                    <h4 class="font-medium text-gray-900 mb-3">Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö</h4>
                    <div class="space-y-2">
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="automail.view">
                            <span class="ml-2">ÈÖç‰ø°Êù°‰ª∂Èñ≤Ë¶ß</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                Ëá™ÂãïÈÖç‰ø°„ÅÆË®≠ÂÆö„ÇíÈñ≤Ë¶ß„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="automail.edit">
                            <span class="ml-2">ÈÖç‰ø°Êù°‰ª∂Á∑®ÈõÜ</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                Ëá™ÂãïÈÖç‰ø°„ÅÆÊù°‰ª∂„ÇíÁ∑®ÈõÜ„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Ë≤°ÂãôÊÉÖÂ†± -->
                <div class="border rounded-lg p-4">
                    <h4 class="font-medium text-gray-900 mb-3">Ë≤°ÂãôÊÉÖÂ†±</h4>
                    <div class="space-y-2">
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="finance.view">
                            <span class="ml-2">Â£≤‰∏äÈñ≤Ë¶ß</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                Â£≤‰∏ä„ÉªË≤°ÂãôÊÉÖÂ†±„ÇíÈñ≤Ë¶ß„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="finance.export">
                            <span class="ml-2">„Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                Ë≤°Âãô„Éá„Éº„Çø„ÇíCSVÂá∫Âäõ„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                    </div>
                </div>

                <!-- „É¨„Éù„Éº„Éà„ÉªÂñ∂Ê•≠ÁÆ°ÁêÜ -->
                <div class="border rounded-lg p-4">
                    <h4 class="font-medium text-gray-900 mb-3">„É¨„Éù„Éº„Éà„ÉªÂñ∂Ê•≠ÁÆ°ÁêÜ</h4>
                    <div class="space-y-2">
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="report.self">
                            <span class="ml-2">„É¨„Éù„Éº„ÉàÈñ≤Ë¶ßÔºàËá™ÂàÜ„ÅÆÊàêÁ∏æ„ÅÆ„ÅøÔºâ</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                Ëá™ÂàÜ„ÅÆÊàêÁ∏æ„É¨„Éù„Éº„Éà„ÇíÈñ≤Ë¶ß„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="report.all">
                            <span class="ml-2">ÂÖ®‰Ωì„É¨„Éù„Éº„ÉàÈñ≤Ë¶ß</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                ÂÖ®Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„ÅÆÊàêÁ∏æ„ÇíÈñ≤Ë¶ß„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="report.export">
                            <span class="ml-2">„É¨„Éù„Éº„ÉàCSVÂá∫Âäõ</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                „É¨„Éù„Éº„Éà„Éá„Éº„Çø„ÇíCSVÂá∫Âäõ„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="sales.manage">
                            <span class="ml-2">Âñ∂Ê•≠ÊãÖÂΩìËÄÖÁÆ°ÁêÜ</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„ÇíËøΩÂä†„ÉªÂâäÈô§„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                    </div>
                </div>

                <!-- ‰ºöÁ§æÊÉÖÂ†± -->
                <div class="border rounded-lg p-4">
                    <h4 class="font-medium text-gray-900 mb-3">‰ºöÁ§æÊÉÖÂ†±</h4>
                    <div class="space-y-2">
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="company.view">
                            <span class="ml-2">‰ºöÁ§æÊÉÖÂ†±Èñ≤Ë¶ß</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                ‰ºöÁ§æÊÉÖÂ†±„ÇíÈñ≤Ë¶ß„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                        <label class="flex items-center text-sm group relative">
                            <input type="checkbox" class="permission-checkbox rounded" data-permission="company.edit">
                            <span class="ml-2">‰ºöÁ§æÊÉÖÂ†±‰øÆÊ≠£</span>
                            <span class="invisible group-hover:visible absolute left-0 -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10">
                                ‰ºöÁ§æÊÉÖÂ†±„ÇíÁ∑®ÈõÜ„Åß„Åç„ÇãÊ®©Èôê
                            </span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="flex justify-end space-x-3">
                <button onclick="closePermissionModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">
                    „Ç≠„É£„É≥„Çª„É´
                </button>
                <button onclick="savePermissions()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    ‰øùÂ≠ò
                </button>
            </div>
        </div>
    </div>
    </div><!-- mainApp end -->

    <!-- „Ç¢„É©„Éº„ÉàÈÄöÁü•„Éë„Éç„É´ -->
    <!-- Êú¨ÈÉ®„Åã„Çâ„ÅÆÈÄöÁü•„Éë„Éç„É´ -->
    <div id="notificationPanel" class="fixed top-20 right-4 w-96 max-h-[600px] bg-white rounded-lg shadow-2xl hidden z-50 overflow-hidden">
        <div class="bg-gradient-to-r from-yellow-500 to-orange-600 text-white p-4">
            <div class="flex items-center justify-between">
                <h3 class="font-bold text-lg flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                    </svg>
                    Êú¨ÈÉ®„Åã„Çâ„ÅÆÈÄöÁü•
                </h3>
                <button onclick="toggleNotificationPanel()" class="hover:bg-white hover:bg-opacity-20 rounded-lg p-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>

        <div class="overflow-y-auto max-h-[500px]">
            <div id="notificationList" class="p-4">
                <p class="text-gray-500 text-center py-8">Êñ∞„Åó„ÅÑÈÄöÁü•„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>
            </div>
        </div>
    </div>

    <!-- „Ç¢„É©„Éº„Éà„Éª„É™„Éû„Ç§„É≥„ÉÄ„Éº„Éë„Éç„É´ -->
    <div id="alertPanel" class="fixed top-20 right-4 w-96 max-h-[600px] bg-white rounded-lg shadow-2xl hidden z-50 overflow-hidden">
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4">
            <div class="flex items-center justify-between">
                <h3 class="font-bold text-lg flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                    </svg>
                    „Ç¢„É©„Éº„Éà„Éª„É™„Éû„Ç§„É≥„ÉÄ„Éº
                </h3>
                <button onclick="toggleAlertPanel()" class="hover:bg-white hover:bg-opacity-20 rounded-lg p-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>

        <div class="overflow-y-auto max-h-[500px]">
            <!-- ‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ -->
            <div class="border-b">
                <div class="p-4">
                    <h4 class="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                        <span class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
                        ‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ
                    </h4>
                    <div id="todayTasks" class="space-y-2">
                        <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                    </div>
                </div>
            </div>

            <!-- ÊòéÊó•„ÅÆ‰∫àÂÆö -->
            <div class="border-b">
                <div class="p-4">
                    <h4 class="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                        <span class="w-2 h-2 bg-yellow-500 rounded-full"></span>
                        ÊòéÊó•„ÅÆ‰∫àÂÆö
                    </h4>
                    <div id="tomorrowTasks" class="space-y-2">
                        <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                    </div>
                </div>
            </div>

            <!-- Ëá™Âãï„Ç¢„É©„Éº„Éà -->
            <div class="border-b">
                <div class="p-4">
                    <h4 class="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                        <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                        Ëá™Âãï„É™„Éû„Ç§„É≥„ÉÄ„Éº
                    </h4>
                    <div id="autoAlerts" class="space-y-2">
                        <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                    </div>
                </div>
            </div>

            <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
            <div class="p-4 bg-gray-50">
                <button onclick="showSection('settings'); setTimeout(() => { document.getElementById('notificationSection').scrollIntoView({ behavior: 'smooth' }); }, 100)" class="w-full px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                    „Ç¢„É©„Éº„ÉàË®≠ÂÆö„ÇíÈñã„Åè
                </button>
            </div>
        </div>
    </div>


    <!-- ‰ºöÁ§æÊÉÖÂ†±„Éó„É¨„Éì„É•„Éº„É¢„Éº„ÉÄ„É´ -->
    <div id="companyPreviewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 overflow-y-auto">
        <div class="relative min-h-screen py-12 px-4">
            <div class="relative bg-white rounded-2xl max-w-6xl mx-auto shadow-2xl">
                <!-- „É¢„Éº„ÉÄ„É´„Éò„ÉÉ„ÉÄ„Éº -->
                <div class="sticky top-0 bg-white rounded-t-2xl border-b z-10">
                    <div class="flex justify-between items-center p-6">
                        <h2 class="text-2xl font-bold text-gray-900">‰ºöÁ§æÊÉÖÂ†±„Éó„É¨„Éì„É•„Éº</h2>
                        <div class="flex items-center gap-4">
                            <button onclick="togglePreviewSettings()" class="p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                            </button>
                            <button onclick="closePreviewModal()" class="p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Ë°®Á§∫Ë®≠ÂÆö„Éë„Éç„É´ -->
                    <div id="previewSettings" class="hidden border-t bg-gray-50 p-4">
                        <h3 class="text-sm font-semibold text-gray-700 mb-3">Ë°®Á§∫È†ÖÁõÆ„ÅÆË®≠ÂÆö</h3>

                        <!-- „É°„Ç§„É≥„Çª„ÇØ„Ç∑„Éß„É≥ÔºàÂÆüÈöõ„ÅÆË°®Á§∫È†ÜÔºâ -->
                        <div class="mb-3">
                            <h4 class="text-xs font-semibold text-gray-600 mb-2">Ë°®Á§∫„Çª„ÇØ„Ç∑„Éß„É≥</h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" class="mr-2" checked onchange="togglePreviewSection('prText')">
                                    <span>‰ºöÁ§æ„ÅÆÁâπÂæ¥</span>
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" class="mr-2" checked onchange="togglePreviewSection('examples')">
                                    <span>ÊñΩÂ∑•‰∫ã‰æã</span>
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" class="mr-2" checked onchange="togglePreviewSection('contact')">
                                    <span>„ÅäÂïè„ÅÑÂêà„Çè„Åõ</span>
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" class="mr-2" checked onchange="togglePreviewSection('areas')">
                                    <span>ÂØæÂøú„Ç®„É™„Ç¢</span>
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" class="mr-2" checked onchange="togglePreviewSection('services')">
                                    <span>ÂØæÂøúÂ∑•‰∫ã</span>
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" class="mr-2" checked onchange="togglePreviewSection('gallery')">
                                    <span>ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº</span>
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" class="mr-2" checked onchange="togglePreviewSection('insurance')">
                                    <span>Âä†ÂÖ•‰øùÈô∫</span>
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" class="mr-2" checked onchange="togglePreviewSection('features')">
                                    <span>ÂΩìÁ§æ„ÅÆÂº∑„Åø</span>
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" class="mr-2" checked onchange="togglePreviewSection('qualifications')">
                                    <span>‰øùÊúâË≥áÊ†º</span>
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" class="mr-2" checked onchange="togglePreviewSection('reviews')">
                                    <span>„ÅäÂÆ¢Êßò„ÅÆÂ£∞</span>
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" class="mr-2" checked onchange="togglePreviewSection('basicInfo')">
                                    <span>‰ºöÁ§æÊ¶ÇË¶Å</span>
                                </label>
                            </div>
                        </div>

                        <!-- ‰ºöÁ§æÊ¶ÇË¶Å„ÅÆË©≥Á¥∞È†ÖÁõÆ -->
                        <div>
                            <h4 class="text-xs font-semibold text-gray-600 mb-2">‰ºöÁ§æÊ¶ÇË¶Å„ÅÆË°®Á§∫È†ÖÁõÆ</h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" class="mr-2" id="showCompanyName" checked onchange="toggleBasicInfoField('companyName')">
                                    <span>‰ºöÁ§æÂêç</span>
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" class="mr-2" id="showRepresentative" checked onchange="toggleBasicInfoField('representative')">
                                    <span>‰ª£Ë°®ËÄÖ</span>
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" class="mr-2" id="showAddress" checked onchange="toggleBasicInfoField('address')">
                                    <span>‰ΩèÊâÄ„ÉªÂú∞Âõ≥</span>
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" class="mr-2" id="showEstablished" checked onchange="toggleBasicInfoField('established')">
                                    <span>Ë®≠Á´ãÂπ¥</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- „Éó„É¨„Éì„É•„Éº„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
                <div>
                    <!-- „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„Çª„ÇØ„Ç∑„Éß„É≥ -->
                    <div id="mainVisualSection" class="relative mb-8 overflow-hidden" style="display: none;">
                        <div class="relative" style="height: 500px; overflow: hidden; cursor: move;" id="mainVisualContainer">
                            <img id="previewMainVisual" src="" alt="" class="w-full h-full object-cover" style="object-position: center;" draggable="false">
                            <div class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-black/30" style="pointer-events: none;"></div>

                            <!-- ‰ºöÁ§æÂêç„Å®ÊÉÖÂ†±„Çí„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
                            <div class="absolute bottom-0 left-0 right-0 p-4 sm:p-8 text-white">
                                <h1 id="previewCompanyNameOverlay" class="text-2xl sm:text-5xl font-bold mb-2 drop-shadow-lg text-center sm:text-left">Ê†™Âºè‰ºöÁ§æ„Åè„Çâ„Åπ„ÇãÂ°óË£Ö</h1>
                                <p id="previewTaglineOverlay" class="text-base sm:text-xl mb-4 drop-shadow-md text-center sm:text-left">‰ø°È†º„Å®ÂÆüÁ∏æ„ÅÆÂ§ñÂ£ÅÂ°óË£ÖÂ∞ÇÈñÄÂ∫ó</p>
                                <div class="flex flex-wrap gap-4">
                                    <div class="flex items-center bg-white/20 backdrop-blur px-4 py-2 rounded-full">
                                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm3 1h6v4H7V5zm6 6H7v2h6v-2z"></path>
                                        </svg>
                                        <span id="previewEstablishedOverlay">ÂâµÊ•≠15Âπ¥</span>
                                    </div>
                                    <div class="flex items-center bg-white/20 backdrop-blur px-4 py-2 rounded-full">
                                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                        </svg>
                                        <span>ÂÆüÁ∏æ1000‰ª∂‰ª•‰∏ä</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Ë™øÊï¥„Ç≥„É≥„Éà„É≠„Éº„É´„Éà„Ç∞„É´„Éú„Çø„É≥ -->
                        <button onclick="toggleImageControls()" class="absolute top-4 right-4 bg-white rounded-lg shadow-lg p-2 hover:bg-gray-50 transition" title="ÁîªÂÉèË™øÊï¥">
                            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path>
                            </svg>
                        </button>

                        <!-- Ë™øÊï¥„Ç≥„É≥„Éà„É≠„Éº„É´„Éë„Éç„É´ -->
                        <div id="visualControls" class="absolute top-14 right-4 bg-white rounded-lg shadow-lg p-3 hidden">
                            <div class="text-sm font-medium text-gray-700 mb-2">ÁîªÂÉèË™øÊï¥</div>
                            <div class="space-y-2">
                                <div>
                                    <label class="text-xs text-gray-600">‰ΩçÁΩÆË™øÊï¥</label>
                                    <div class="text-xs text-gray-500 mb-1">„Éâ„É©„ÉÉ„Ç∞„ÅßÁßªÂãï</div>
                                    <div class="flex gap-1">
                                        <button onclick="adjustImagePosition('top')" class="p-1 hover:bg-gray-100 rounded" title="‰∏äÂØÑ„Åõ">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>
                                        </button>
                                        <button onclick="adjustImagePosition('center')" class="p-1 hover:bg-gray-100 rounded" title="‰∏≠Â§Æ„Å´„É™„Çª„ÉÉ„Éà">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3" stroke-width="2"></circle></svg>
                                        </button>
                                        <button onclick="adjustImagePosition('bottom')" class="p-1 hover:bg-gray-100 rounded" title="‰∏ãÂØÑ„Åõ">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-600">„Ç∫„Éº„É†</label>
                                    <input type="range" id="imageZoom" min="100" max="150" value="100" class="w-full" onchange="adjustImageZoom(this.value)">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-600">Êòé„Çã„Åï</label>
                                    <input type="range" id="imageOpacity" min="20" max="100" value="70" class="w-full" onchange="adjustImageOpacity(this.value)">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- „Éí„Éº„É≠„Éº„Çª„ÇØ„Ç∑„Éß„É≥Ôºà„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„Åå„Å™„ÅÑÂ†¥ÂêàÔºâ -->
                    <div id="heroSection" class="relative bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-8 mb-8 text-white overflow-hidden">
                        <div class="absolute inset-0 bg-black opacity-10"></div>
                        <div class="relative z-10">
                            <h1 id="previewCompanyNameHero" class="text-2xl sm:text-4xl font-bold mb-2 text-center sm:text-left">Ê†™Âºè‰ºöÁ§æ„Åè„Çâ„Åπ„ÇãÂ°óË£Ö</h1>
                            <p id="previewTaglineHero" class="text-base sm:text-lg opacity-90 text-center sm:text-left">‰ø°È†º„Å®ÂÆüÁ∏æ„ÅÆÂ§ñÂ£ÅÂ°óË£ÖÂ∞ÇÈñÄÂ∫ó</p>
                            <div class="flex flex-wrap gap-4 mt-6">
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm3 1h6v4H7V5zm6 6H7v2h6v-2z"></path>
                                    </svg>
                                    <span id="previewEstablishedHero">ÂâµÊ•≠15Âπ¥</span>
                                </div>
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>ÂÆüÁ∏æ1000‰ª∂‰ª•‰∏ä</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="p-8">
                    <!-- ‰ºöÁ§æ„ÅÆÁâπÂæ¥„ÉªÂº∑„ÅøÔºàÈÅ∏„Å∞„Çå„ÇãÁêÜÁî±Ôºâ -->
                    <div id="preview-prText" class="mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                            <span class="w-1 h-6 bg-yellow-500 mr-3 rounded"></span>
                            ‰ºöÁ§æ„ÅÆÁâπÂæ¥„ÉªÂº∑„Åø
                        </h3>
                        <div class="bg-gradient-to-br from-yellow-50 to-orange-50 rounded-xl p-6 border border-yellow-200">
                            <p id="previewPrText" class="text-gray-700 leading-relaxed">Âú∞ÂüüÂØÜÁùÄ„Åß15Âπ¥‰ª•‰∏ä„ÄÅÁ¢∫„Åã„Å™ÊäÄË°ì„Å®‰∏ÅÂØß„Å™‰ªï‰∫ã„ÅßÁöÜÊßò„ÅÆÂ§ßÂàá„Å™‰Ωè„Åæ„ÅÑ„ÇíÂÆà„Çä„Åæ„Åô„ÄÇË¶ãÁ©ç„ÇÇ„Çä„Åã„ÇâÊñΩÂ∑•„Åæ„ÅßËá™Á§æ‰∏ÄË≤´‰ΩìÂà∂„Åß„ÄÅ‰∏≠Èñì„Éû„Éº„Ç∏„É≥„Å™„Åó„ÅÆÈÅ©Ê≠£‰æ°Ê†º„Çí„ÅîÊèê‰æõ„ÄÇ„Ç¢„Éï„Çø„Éº„Éï„Ç©„É≠„Éº„ÇÇ‰∏áÂÖ®„Åß„Åô„ÄÇ</p>
                        </div>
                    </div>

                    <!-- 1. ÊñΩÂ∑•‰∫ã‰æã„Çª„ÇØ„Ç∑„Éß„É≥ÔºàÊúÄÂàù„Å´ÂÆüÁ∏æ„ÇíË¶ã„Åõ„ÇãÔºâ -->
                    <div id="preview-examples" class="mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                            <span class="w-1 h-6 bg-pink-600 mr-3 rounded"></span>
                            ÊñΩÂ∑•‰∫ã‰æã
                        </h3>
                        <!-- „Ç´„É´„Éº„Çª„É´„Ç≥„É≥„ÉÜ„Éä -->
                        <div class="relative">
                            <!-- Â∑¶Áü¢Âç∞ -->
                            <button onclick="scrollExamples('left')" class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 z-10 bg-white shadow-lg rounded-full p-2 hover:bg-gray-50 transition">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </button>
                            <!-- ÊñΩÂ∑•‰∫ã‰æã„Ç´„É´„Éº„Çª„É´ -->
                            <div id="examplesCarousel" class="overflow-hidden">
                                <div id="previewExamplesList" class="flex gap-4 transition-transform duration-300">
                                    <!-- ÊñΩÂ∑•‰∫ã‰æã„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                                </div>
                            </div>
                            <!-- Âè≥Áü¢Âç∞ -->
                            <button onclick="scrollExamples('right')" class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 z-10 bg-white shadow-lg rounded-full p-2 hover:bg-gray-50 transition">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                        </div>
                        <!-- „Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº -->
                        <div id="examplesIndicators" class="flex justify-center gap-1 mt-4">
                            <!-- „Éâ„ÉÉ„Éà„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                        </div>
                    </div>

                    <!-- 10. „ÅäÂïè„ÅÑÂêà„Çè„Åõ„Çª„ÇØ„Ç∑„Éß„É≥ÔºàÊúÄÁµÇCTAÔºâ -->
                    <div id="preview-contact" class="mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                            <span class="w-1 h-6 bg-purple-600 mr-3 rounded"></span>
                            „ÅäÂïè„ÅÑÂêà„Çè„Åõ
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-white border rounded-xl p-4 hover:shadow-lg transition">
                                <div class="flex items-center mb-2">
                                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">„ÅäÈõªË©±„Åß„ÅÆ„ÅäÂïè„ÅÑÂêà„Çè„Åõ</p>
                                        <p class="text-lg font-semibold text-gray-900">0120-XXX-XXX</p>
                                        <p class="text-xs text-gray-500">Âèó‰ªòÊôÇÈñì: 9:00-18:00ÔºàÂπ¥‰∏≠ÁÑ°‰ºëÔºâ</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white border rounded-xl p-4 hover:shadow-lg transition">
                                <div class="flex items-center mb-2">
                                    <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">„É°„Éº„É´„Åß„ÅÆ„ÅäÂïè„ÅÑÂêà„Çè„Åõ</p>
                                        <p class="text-lg font-semibold text-gray-900">info@kuraberu-ai.jp</p>
                                        <p class="text-xs text-gray-500">24ÊôÇÈñìÂèó‰ªò‰∏≠</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 9„Å§„ÅÆÁâπÂÖ∏Ë©≥Á¥∞„Çª„ÇØ„Ç∑„Éß„É≥ -->
                    <div class="mb-8 bg-gradient-to-br from-orange-50 via-orange-100 to-red-50 rounded-2xl p-8">
                        <div class="text-center mb-6">
                            <h3 class="text-2xl font-bold text-gray-900 mb-2">üéÅ ‰ªä„Å†„ÅëÔºÅ9„Å§„ÅÆÁÑ°ÊñôÁâπÂÖ∏</h3>
                            <p class="text-sm text-gray-600">ÊúüÈñìÈôêÂÆö„Ç≠„É£„É≥„Éö„Éº„É≥ÂÆüÊñΩ‰∏≠ÔºÅ</p>
                        </div>

                        <div class="max-w-4xl mx-auto mb-6 px-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <!-- ÁâπÂÖ∏1: ÁÑ°ÊñôÁÇπÊ§ú -->
                                <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">üîç</span>
                                        <div>
                                            <h4 class="font-bold text-orange-600 mb-1">ÁÑ°ÊñôÁÇπÊ§ú</h4>
                                            <p class="text-xs text-gray-600">„Éó„É≠„ÅÆÁõÆ„ÅßÂ§ñÂ£Å„ÉªÂ±ãÊ†π„ÇíÂæπÂ∫ï„ÉÅ„Çß„ÉÉ„ÇØÔºÅ„ÅäÂÆ∂„ÅÆÁä∂ÊÖã„ÇíË©≥Á¥∞„Å´Â†±Âëä</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏2: „Ç®„É™„Ç¢ÊúÄ‰Ωé‰æ°Ê†º‰øùË®º -->
                                <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">üí∞</span>
                                        <div>
                                            <h4 class="font-bold text-orange-600 mb-1">„Ç®„É™„Ç¢ÊúÄ‰Ωé‰æ°Ê†º‰øùË®º</h4>
                                            <p class="text-xs text-gray-600">Âú∞ÂüüÊúÄÂÆâÂÄ§„Çí„ÅäÁ¥ÑÊùüÔºÅ‰ªñÁ§æ„Çà„ÇäÈ´ò„Åë„Çå„Å∞ÂÄ§Âºï„ÅçÂØæÂøú</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏3: „ÅäÂÄ§Âºï„Åç‰∫§Ê∏â‰ª£Ë°å -->
                                <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">ü§ù</span>
                                        <div>
                                            <h4 class="font-bold text-orange-600 mb-1">„ÅäÂÄ§Âºï„Åç‰∫§Ê∏â‰ª£Ë°å</h4>
                                            <p class="text-xs text-gray-600">‰ªñÁ§æË¶ãÁ©ç„ÇÇ„Çä„Çí„ÅäÊåÅ„Å°„Å™„Çâ„ÄÅ‰ª£„Çè„Çä„Å´‰∫§Ê∏â„Åó„Å¶ÊúÄÂÆâÂÄ§„ÇíÂÆüÁèæ</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏4: Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà -->
                                <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">üìù</span>
                                        <div>
                                            <h4 class="font-bold text-orange-600 mb-1">Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà</h4>
                                            <p class="text-xs text-gray-600">ÊúÄÂ§ß10ÔΩû70‰∏áÂÜÜÔºÅÂêÑÁ®ÆÂä©ÊàêÈáë„ÅÆÁî≥Ë´ãÊâãÁ∂ö„Åç„ÇíÂÆåÂÖ®„Çµ„Éù„Éº„Éà</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏5: ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà -->
                                <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">üèõÔ∏è</span>
                                        <div>
                                            <h4 class="font-bold text-orange-600 mb-1">ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà</h4>
                                            <p class="text-xs text-gray-600">Âè∞È¢®„ÉªÈõ™ÂÆ≥Á≠â„ÅÆÊêçÂÆ≥„Å´ÁÅ´ÁÅΩ‰øùÈô∫ÈÅ©Áî®ÂèØËÉΩÔºÅÁÑ°Êñô„ÅßË™øÊüª</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏6: „ÅäÊñ≠„Çä‰ª£Ë°å„Çµ„Éº„Éì„Çπ -->
                                <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">üö´</span>
                                        <div>
                                            <h4 class="font-bold text-orange-600 mb-1">„ÅäÊñ≠„Çä‰ª£Ë°å„Çµ„Éº„Éì„Çπ</h4>
                                            <p class="text-xs text-gray-600">ÊàêÁ¥ÑÊôÇ„ÅÆ‰ªñÁ§æ„Å∏„ÅÆ„ÅäÊñ≠„Çä„ÇÇ‰ª£Ë°åÂèØËÉΩÔºÅÈù¢ÂÄí„Å™„ÇÑ„ÇäÂèñ„Çä‰∏çË¶Å</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏7: ÁÑ°Êñô„ÅäÈõªË©±„Çµ„Éù„Éº„Éà -->
                                <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">üìû</span>
                                        <div>
                                            <h4 class="font-bold text-orange-600 mb-1">ÁÑ°Êñô„ÅäÈõªË©±„Çµ„Éù„Éº„Éà</h4>
                                            <p class="text-xs text-gray-600">Â∑•‰∫ãÂÆå‰∫ÜÂæå„ÇÇÂÆâÂøÉÔºÅ365Êó•ÈõªË©±„Çµ„Éù„Éº„Éà„Åß„ÅäÊÇ©„ÅøËß£Ê±∫</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏8: Ë®™ÂïèÊ•≠ËÄÖ„Éû„Éã„É•„Ç¢„É´ÈÄ≤Âëà -->
                                <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">üìñ</span>
                                        <div>
                                            <h4 class="font-bold text-orange-600 mb-1">Ë®™ÂïèÊ•≠ËÄÖ„Éû„Éã„É•„Ç¢„É´ÈÄ≤Âëà</h4>
                                            <p class="text-xs text-gray-600">ÊÇ™Âæ≥Ê•≠ËÄÖ„ÅÆÊâãÂè£„ÇÑÂØæÂá¶Ê≥ï„ÇíÂÆåÂÖ®Ëß£Ë™¨ÔºÅÂÆâÂøÉ„Ç¨„Ç§„Éâ</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏9: „ÅäÂèãÈÅîÁ¥π‰ªã„Ç≠„É£„É≥„Éö„Éº„É≥ -->
                                <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">üë•</span>
                                        <div>
                                            <h4 class="font-bold text-orange-600 mb-1">„ÅäÂèãÈÅîÁ¥π‰ªã„Ç≠„É£„É≥„Éö„Éº„É≥</h4>
                                            <p class="text-xs text-gray-600">Á¥π‰ªã„ÅßÂèåÊñπ„Å´ÁâπÂÖ∏ÔºÅÊúÄÂ§ß30,000ÂÜÜÂàÜ„ÅÆ„ÇÆ„Éï„Éà„Ç´„Éº„Éâ</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-6">
                            <button class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-10 py-4 rounded-lg hover:shadow-xl transition font-bold text-lg transform hover:scale-105">
                                ‰ªä„Åô„ÅêÁÑ°ÊñôË¶ãÁ©ç„ÇÇ„Çä„Çí‰æùÈ†º„Åô„Çã
                            </button>
                            <p class="text-xs text-gray-500 mt-2">‚Äª24ÊôÇÈñì‰ª•ÂÜÖ„Å´„ÅîÈÄ£Áµ°„ÅÑ„Åü„Åó„Åæ„Åô</p>
                        </div>
                    </div>



                    <!-- 8. ÂØæÂøú„Ç®„É™„Ç¢„Çª„ÇØ„Ç∑„Éß„É≥ -->
                    <div id="preview-areas" class="mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                            <span class="w-1 h-6 bg-orange-600 mr-3 rounded"></span>
                            ÂØæÂøú„Ç®„É™„Ç¢
                        </h3>
                        <div class="bg-gray-50 rounded-xl p-6">
                            <div>
                                <h4 class="text-sm font-semibold text-gray-700 mb-2">ÂØæÂøúÈÉΩÈÅìÂ∫úÁúå</h4>
                                <div id="previewPrefectures" class="flex flex-wrap gap-2">
                                    <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full">Êù±‰∫¨ÈÉΩ</span>
                                    <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full">Á•ûÂ•àÂ∑ùÁúå</span>
                                    <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full">ÂüºÁéâÁúå</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 4. ÂØæÂøúÂèØËÉΩ„Å™Â∑•‰∫ãÔºà„Çµ„Éº„Éì„ÇπÂÜÖÂÆπÔºâ -->
                    <div id="preview-services" class="mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                            <span class="w-1 h-6 bg-green-600 mr-3 rounded"></span>
                            ÂØæÂøúÂèØËÉΩ„Å™Â∑•‰∫ã
                        </h3>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                            <div class="bg-white border rounded-lg p-3 flex items-center">
                                <span class="text-2xl mr-2">üé®</span>
                                <span class="text-sm font-medium">Â§ñÂ£ÅÂ°óË£Ö</span>
                            </div>
                            <div class="bg-white border rounded-lg p-3 flex items-center">
                                <span class="text-2xl mr-2">üè†</span>
                                <span class="text-sm font-medium">Â±ãÊ†πÂ°óË£Ö</span>
                            </div>
                            <div class="bg-white border rounded-lg p-3 flex items-center">
                                <span class="text-2xl mr-2">üîß</span>
                                <span class="text-sm font-medium">Â§ñÂ£ÅË£ú‰øÆ</span>
                            </div>
                            <div class="bg-white border rounded-lg p-3 flex items-center">
                                <span class="text-2xl mr-2">üõ†Ô∏è</span>
                                <span class="text-sm font-medium">Â±ãÊ†πË£ú‰øÆ</span>
                            </div>
                            <div class="bg-white border rounded-lg p-3 flex items-center">
                                <span class="text-2xl mr-2">üíß</span>
                                <span class="text-sm font-medium">Èò≤Ê∞¥Â∑•‰∫ã</span>
                            </div>
                        </div>
                    </div>

                    <!-- CTA„Éú„Çø„É≥Ôºà1ÂõûÁõÆÔºâÂâäÈô§ -->
                    <div class="hidden">
                        <div class="text-center mb-6">
                            <h3 class="text-2xl font-bold text-gray-900 mb-2">üéÅ ‰ªä„Å†„ÅëÔºÅ9„Å§„ÅÆÁÑ°ÊñôÁâπÂÖ∏</h3>
                            <p class="text-sm text-gray-600">ÊúüÈñìÈôêÂÆö„Ç≠„É£„É≥„Éö„Éº„É≥ÂÆüÊñΩ‰∏≠ÔºÅ</p>
                        </div>

                        <div class="max-w-4xl mx-auto mb-6 px-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <!-- ÁâπÂÖ∏1: ÁÑ°ÊñôÁÇπÊ§ú -->
                                <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">üîç</span>
                                        <div>
                                            <h4 class="font-bold text-orange-600 mb-1">ÁÑ°ÊñôÁÇπÊ§ú</h4>
                                            <p class="text-xs text-gray-600">„Éó„É≠„ÅÆÁõÆ„ÅßÂ§ñÂ£Å„ÉªÂ±ãÊ†π„ÇíÂæπÂ∫ï„ÉÅ„Çß„ÉÉ„ÇØÔºÅ„ÅäÂÆ∂„ÅÆÁä∂ÊÖã„ÇíË©≥Á¥∞„Å´Â†±Âëä</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏2: „Ç®„É™„Ç¢ÊúÄ‰Ωé‰æ°Ê†º‰øùË®º -->
                                <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">üí∞</span>
                                        <div>
                                            <h4 class="font-bold text-orange-600 mb-1">„Ç®„É™„Ç¢ÊúÄ‰Ωé‰æ°Ê†º‰øùË®º</h4>
                                            <p class="text-xs text-gray-600">Âú∞ÂüüÊúÄÂÆâÂÄ§„Çí„ÅäÁ¥ÑÊùüÔºÅ‰ªñÁ§æ„Çà„ÇäÈ´ò„Åë„Çå„Å∞ÂÄ§Âºï„ÅçÂØæÂøú</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏3: „ÅäÂÄ§Âºï„Åç‰∫§Ê∏â‰ª£Ë°å -->
                                <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">ü§ù</span>
                                        <div>
                                            <h4 class="font-bold text-orange-600 mb-1">„ÅäÂÄ§Âºï„Åç‰∫§Ê∏â‰ª£Ë°å</h4>
                                            <p class="text-xs text-gray-600">‰ªñÁ§æË¶ãÁ©ç„ÇÇ„Çä„Çí„ÅäÊåÅ„Å°„Å™„Çâ„ÄÅ‰ª£„Çè„Çä„Å´‰∫§Ê∏â„Åó„Å¶ÊúÄÂÆâÂÄ§„ÇíÂÆüÁèæ</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏4: Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà -->
                                <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">üìù</span>
                                        <div>
                                            <h4 class="font-bold text-orange-600 mb-1">Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà</h4>
                                            <p class="text-xs text-gray-600">ÊúÄÂ§ß10ÔΩû70‰∏áÂÜÜÔºÅÂêÑÁ®ÆÂä©ÊàêÈáë„ÅÆÁî≥Ë´ãÊâãÁ∂ö„Åç„ÇíÂÆåÂÖ®„Çµ„Éù„Éº„Éà</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏5: ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà -->
                                <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">üèõÔ∏è</span>
                                        <div>
                                            <h4 class="font-bold text-orange-600 mb-1">ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà</h4>
                                            <p class="text-xs text-gray-600">Âè∞È¢®„ÉªÈõ™ÂÆ≥Á≠â„ÅÆÊêçÂÆ≥„Å´ÁÅ´ÁÅΩ‰øùÈô∫ÈÅ©Áî®ÂèØËÉΩÔºÅÁÑ°Êñô„ÅßË™øÊüª</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏6: „ÅäÊñ≠„Çä‰ª£Ë°å„Çµ„Éº„Éì„Çπ -->
                                <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">üö´</span>
                                        <div>
                                            <h4 class="font-bold text-orange-600 mb-1">„ÅäÊñ≠„Çä‰ª£Ë°å„Çµ„Éº„Éì„Çπ</h4>
                                            <p class="text-xs text-gray-600">ÊàêÁ¥ÑÊôÇ„ÅÆ‰ªñÁ§æ„Å∏„ÅÆ„ÅäÊñ≠„Çä„ÇÇ‰ª£Ë°åÂèØËÉΩÔºÅÈù¢ÂÄí„Å™„ÇÑ„ÇäÂèñ„Çä‰∏çË¶Å</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏8: Ë®™ÂïèÊ•≠ËÄÖ„Éû„Éã„É•„Ç¢„É´ -->
                                <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">üìñ</span>
                                        <div>
                                            <h4 class="font-bold text-orange-600 mb-1">Ë®™ÂïèÊ•≠ËÄÖ„Éû„Éã„É•„Ç¢„É´ÈÄ≤Âëà</h4>
                                            <p class="text-xs text-gray-600">ÊÇ™Âæ≥Ê•≠ËÄÖ„ÅÆÊâãÂè£„ÇÑÂØæÂá¶Ê≥ï„ÇíÂÆåÂÖ®Ëß£Ë™¨ÔºÅÂÆâÂøÉ„Ç¨„Ç§„Éâ</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏7: ÁÑ°Êñô„ÅäÈõªË©±„Çµ„Éù„Éº„Éà -->
                                <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">üìû</span>
                                        <div>
                                            <h4 class="font-bold text-orange-600 mb-1">ÁÑ°Êñô„ÅäÈõªË©±„Çµ„Éù„Éº„Éà</h4>
                                            <p class="text-xs text-gray-600">Â∑•‰∫ãÂÆå‰∫ÜÂæå„ÇÇÂÆâÂøÉÔºÅ365Êó•ÈõªË©±„Çµ„Éù„Éº„Éà„Åß„ÅäÊÇ©„ÅøËß£Ê±∫</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁâπÂÖ∏8: „ÅäÂèãÈÅîÁ¥π‰ªã„Ç≠„É£„É≥„Éö„Éº„É≥ -->
                                <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">üë•</span>
                                        <div>
                                            <h4 class="font-bold text-orange-600 mb-1">„ÅäÂèãÈÅîÁ¥π‰ªã„Ç≠„É£„É≥„Éö„Éº„É≥</h4>
                                            <p class="text-xs text-gray-600">Á¥π‰ªã„ÅßÂèåÊñπ„Å´ÁâπÂÖ∏ÔºÅÊúÄÂ§ß30,000ÂÜÜÂàÜ„ÅÆ„ÇÆ„Éï„Éà„Ç´„Éº„Éâ</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="text-center">
                            <button class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-10 py-4 rounded-lg hover:shadow-xl transition font-bold text-lg transform hover:scale-105">
                                ‰ªä„Åô„ÅêÁÑ°ÊñôË¶ãÁ©ç„ÇÇ„Çä„Çí‰æùÈ†º„Åô„Çã
                            </button>
                            <p class="text-xs text-gray-500 mt-2">‚Äª24ÊôÇÈñì‰ª•ÂÜÖ„Å´„ÅîÈÄ£Áµ°„ÅÑ„Åü„Åó„Åæ„Åô</p>
                        </div>
                    </div>

                    <!-- ÊúüÈñìÈôêÂÆö„Ç≠„É£„É≥„Éö„Éº„É≥CTAÔºàËµ§„ÅÑ„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥Ôºâ -->
                    <div class="bg-gradient-to-r from-orange-500 to-red-500 rounded-lg p-8 text-center text-white mb-8">
                        <h3 class="text-2xl font-bold mb-3">üéÜ ÊúüÈñìÈôêÂÆöÁâπÂà•„Ç≠„É£„É≥„Éö„Éº„É≥ÂÆüÊñΩ‰∏≠ÔºÅ</h3>
                        <p class="text-lg mb-5">‰ªä„Å™„ÇâÂÆåÂÖ®ÁÑ°Êñô + 9„Å§„ÅÆÁâπÂÖ∏‰ªò„Åç</p>
                        <button class="bg-white text-orange-600 px-10 py-4 rounded-lg hover:shadow-xl transition font-bold text-lg transform hover:scale-105">
                            ‰ªä„Åô„ÅêÁÑ°ÊñôË¶ãÁ©ç„ÇÇ„Çä„Çí‰æùÈ†º
                        </button>
                        <p class="text-sm mt-3 text-orange-100">‚Äª„É°„Éº„É´„Åß„ÇÇ„ÅäÊ∞óËªΩ„Å´„ÅîÁõ∏Ë´á„Åè„Å†„Åï„ÅÑ</p>
                    </div>

                    <!-- 5. ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„Çª„ÇØ„Ç∑„Éß„É≥Ôºà‰ªï‰∫ã„ÅÆÊßòÂ≠êÔºâ -->
                    <div id="preview-gallery" class="mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                            <span class="w-1 h-6 bg-purple-600 mr-3 rounded"></span>
                            ‰øùÊúâË≥áÊ†º
                        </h3>
                        <div id="qualificationsList" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                            <!-- Ë≥áÊ†º„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                        </div>
                    </div>

                    <div id="preview-insurance" class="mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                            <span class="w-1 h-6 bg-indigo-600 mr-3 rounded"></span>
                            Âä†ÂÖ•‰øùÈô∫
                        </h3>
                        <div id="insuranceList" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                            <!-- ‰øùÈô∫„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                        </div>
                    </div>

                    <!-- CTA„Éú„Çø„É≥Ôºà2ÂõûÁõÆÔºâ -->
                    <div class="text-center py-8 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg">
                        <h3 class="text-lg font-bold text-gray-900 mb-3">ÂÆâÂøÉ„ÅÆ‰øùË®º‰ΩìÂà∂„Åß„ÅäÂÆ¢Êßò„Çí„Çµ„Éù„Éº„Éà</h3>
                        <button class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-8 py-3 rounded-lg hover:shadow-lg transition font-semibold">
                            „Åæ„Åö„ÅØÁÑ°ÊñôÁõ∏Ë´á„Åã„Çâ
                        </button>
                    </div>

                    <!-- 7. ÂΩìÁ§æ„ÅÆÂº∑„ÅøÔºàÁâπÂà•„Å™„É°„É™„ÉÉ„ÉàÔºâ -->
                    <div id="preview-features" class="mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                            <span class="w-1 h-6 bg-orange-600 mr-3 rounded"></span>
                            ÂΩìÁ§æ„ÅÆÂº∑„Åø
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4">
                                <div class="text-3xl mb-2">üå°Ô∏è</div>
                                <h4 class="font-semibold text-gray-900 mb-1">ÈÅÆÁÜ±„ÉªÊñ≠ÁÜ±Â°óÊñô</h4>
                                <p class="text-sm text-gray-600">ÊúÄÊñ∞„ÅÆÈÅÆÁÜ±„ÉªÊñ≠ÁÜ±Â°óÊñô„ÅßÂø´ÈÅ©„Å™‰ΩèÁí∞Â¢É„ÇíÂÆüÁèæ</p>
                            </div>
                            <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4">
                                <div class="text-3xl mb-2">üí≥</div>
                                <h4 class="font-semibold text-gray-900 mb-1">„Ç´„Éº„ÉâÊ±∫Ê∏àÂØæÂøú</h4>
                                <p class="text-sm text-gray-600">ÂêÑÁ®Æ„ÇØ„É¨„Ç∏„ÉÉ„Éà„Ç´„Éº„Éâ„Åß„ÅÆ„ÅäÊîØÊâï„ÅÑ„ÅåÂèØËÉΩ</p>
                            </div>
                            <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4">
                                <div class="text-3xl mb-2">üè¶</div>
                                <h4 class="font-semibold text-gray-900 mb-1">ÊèêÊê∫„É≠„Éº„É≥</h4>
                                <p class="text-sm text-gray-600">ÁÑ°ÁêÜ„ÅÆ„Å™„ÅÑÊîØÊâï„ÅÑ„Éó„É©„É≥„Çí„ÅîÊèêÊ°à</p>
                            </div>
                        </div>
                    </div>

                    <!-- 6. ‰øùÊúâË≥áÊ†º„ÉªÂä†ÂÖ•‰øùÈô∫ÔºàÂÆâÂøÉÊÑüÔºâ -->
                    <div id="preview-qualifications" class="mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                            <span class="w-1 h-6 bg-indigo-600 mr-3 rounded"></span>
                            ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº
                        </h3>

                        <!-- „Ç´„É´„Éº„Çª„É´„Ç≥„É≥„ÉÜ„Éä -->
                        <div class="relative">
                            <!-- Â∑¶Áü¢Âç∞ -->
                            <button onclick="scrollGallery('left')" class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 z-10 bg-white shadow-lg rounded-full p-2 hover:bg-gray-50 transition">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </button>

                            <!-- „ÇÆ„É£„É©„É™„Éº„Ç´„É´„Éº„Çª„É´ -->
                            <div id="galleryCarousel" class="overflow-hidden">
                                <div id="previewGalleryList" class="flex gap-4 transition-transform duration-300">
                                    <!-- „ÇÆ„É£„É©„É™„ÉºÁîªÂÉè„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                                </div>
                            </div>

                            <!-- Âè≥Áü¢Âç∞ -->
                            <button onclick="scrollGallery('right')" class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 z-10 bg-white shadow-lg rounded-full p-2 hover:bg-gray-50 transition">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                        </div>

                        <!-- „Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº -->
                        <div id="galleryIndicators" class="flex justify-center gap-1 mt-4">
                            <!-- „Éâ„ÉÉ„Éà„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                        </div>
                    </div>

                    <!-- 2. „ÅäÂÆ¢Êßò„ÅÆÂ£∞Ôºà‰ø°È†ºÊÄß„ÇíÈ´ò„ÇÅ„ÇãÔºâ -->
                    <div id="preview-reviews" class="mb-12 bg-gradient-to-br from-purple-50 via-blue-50 to-purple-50 rounded-2xl p-6">
                        <div class="mb-4">
                            <h3 class="text-xl font-bold text-gray-900 mb-2 inline-flex items-center">
                                <span class="w-1 h-6 bg-gradient-to-b from-purple-600 to-blue-600 mr-3 rounded"></span>
                                „ÅäÂÆ¢Êßò„ÅÆÂ£∞
                                <!-- AIËá™ÂãïÂèéÈõÜ„Éê„ÉÉ„Ç∏ -->
                                <span class="ml-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white px-3 py-1 rounded-full text-xs font-bold flex items-center shadow-lg animate-pulse">
                                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                                    </svg>
                                    AIËá™ÂãïÂèéÈõÜ‰∏≠
                                </span>
                            </h3>
                            <p class="text-sm text-gray-600">Â§ßÊâã„Éù„Éº„Çø„É´„Çµ„Ç§„Éà„Åã„ÇâËá™ÂãïÂèéÈõÜ„Åï„Çå„Åü<span class="font-bold text-purple-600">„É™„Ç¢„É´„Å™Âè£„Ç≥„Éü</span></p>
                        </div>

                        <!-- ÂèéÈõÜÂÖÉ„Éê„ÉÉ„Ç∏ -->
                        <div class="flex flex-wrap gap-2 mb-4">
                            <span class="text-xs bg-gradient-to-r from-purple-50 to-blue-50 text-purple-700 px-2 py-1 rounded-full border border-purple-200">„Éõ„ÉÉ„Éà„Éö„ÉÉ„Éë„Éº</span>
                            <span class="text-xs bg-gradient-to-r from-purple-50 to-blue-50 text-purple-700 px-2 py-1 rounded-full border border-purple-200">„Éö„Ç§„É≥„Éà„Éä„Éì</span>
                            <span class="text-xs bg-gradient-to-r from-purple-50 to-blue-50 text-purple-700 px-2 py-1 rounded-full border border-purple-200">„Éå„É™„Ç´„Ç®</span>
                            <span class="text-xs bg-gradient-to-r from-purple-50 to-blue-50 text-purple-700 px-2 py-1 rounded-full border border-purple-200">+3„Çµ„Ç§„Éà</span>
                        </div>

                        <!-- „Ç´„É´„Éº„Çª„É´„Ç≥„É≥„ÉÜ„Éä -->
                        <div class="relative">
                            <!-- Â∑¶Áü¢Âç∞ -->
                            <button onclick="scrollReviews('left')" class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 z-10 bg-white shadow-lg rounded-full p-2 hover:bg-gray-50 transition">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </button>

                            <!-- „ÇØ„ÉÅ„Ç≥„Éü„Ç´„É´„Éº„Çª„É´ -->
                            <div id="reviewCarousel" class="overflow-hidden">
                                <div id="previewReviewsList" class="flex gap-4 transition-transform duration-300">
                                    <!-- „ÇØ„ÉÅ„Ç≥„Éü„Ç´„Éº„Éâ„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                                </div>
                            </div>

                            <!-- Âè≥Áü¢Âç∞ -->
                            <button onclick="scrollReviews('right')" class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 z-10 bg-white shadow-lg rounded-full p-2 hover:bg-gray-50 transition">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                        </div>

                        <!-- „Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº -->
                        <div id="reviewIndicators" class="flex justify-center gap-1 mt-4">
                            <!-- „Éâ„ÉÉ„Éà„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                        </div>
                        <div class="mt-4 text-xs text-gray-500 border-t pt-3">
                            ‚ÄªÊé≤Ëºâ„ÅÆ„ÇØ„ÉÅ„Ç≥„Éü„ÅØÂêÑ„Éù„Éº„Çø„É´„Çµ„Ç§„Éà„Çà„ÇäÂºïÁî®„Åó„Åü„ÇÇ„ÅÆ„ÇÇÂê´„ÇÅ„ÅüÁ∑èÂêà„ÇØ„ÉÅ„Ç≥„Éü„Åß„Åô
                        </div>
                    </div>

                    <!-- 9. ‰ºöÁ§æÊ¶ÇË¶ÅÔºà‰ø°È†ºÊÄß„ÅÆË£úÂº∑Ôºâ -->
                    <div id="preview-basicInfo" class="mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                            <span class="w-1 h-6 bg-blue-600 mr-3 rounded"></span>
                            ‰ºöÁ§æÊ¶ÇË¶Å
                        </h3>
                        <div class="bg-gray-50 rounded-xl p-6">
                            <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div id="basicInfo-companyName">
                                    <dt class="text-sm font-medium text-gray-600">‰ºöÁ§æÂêç</dt>
                                    <dd id="previewCompanyNameFull" class="mt-1 text-base sm:text-lg text-gray-900 break-words">Ê†™Âºè‰ºöÁ§æ„Åè„Çâ„Åπ„ÇãÂ°óË£Ö</dd>
                                </div>
                                <div id="basicInfo-representative">
                                    <dt class="text-sm font-medium text-gray-600">‰ª£Ë°®ËÄÖ</dt>
                                    <dd id="previewRepresentative" class="mt-1 text-lg text-gray-900">-</dd>
                                </div>
                                <div id="basicInfo-address">
                                    <dt class="text-sm font-medium text-gray-600">ÊâÄÂú®Âú∞</dt>
                                    <dd id="previewAddress" class="mt-1 text-lg text-gray-900">-</dd>
                                </div>
                                <div id="basicInfo-established">
                                    <dt class="text-sm font-medium text-gray-600">Ë®≠Á´ã</dt>
                                    <dd id="previewEstablishedDate" class="mt-1 text-lg text-gray-900">2010Âπ¥4Êúà</dd>
                                </div>
                            </dl>
                        </div>
                        <!-- Google„Éû„ÉÉ„ÉóÂüã„ÇÅËæº„Åø -->
                        <div class="mt-4" id="basicInfo-map">
                            <h4 class="text-sm font-medium text-gray-600 mb-2">„Ç¢„ÇØ„Çª„Çπ</h4>
                            <div id="googleMapContainer" class="w-full h-64 bg-gray-200 rounded-lg overflow-hidden">
                                <!-- „Éû„ÉÉ„Éó„Åå„É≠„Éº„Éâ„Åï„Çå„Çã„Åæ„Åß„ÅÆ„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº -->
                                <div class="w-full h-full flex items-center justify-center text-gray-500">
                                    <div class="text-center">
                                        <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        </svg>
                                        <p class="text-sm">„Éû„ÉÉ„Éó„ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- ÊîØÂ∫ó„Éû„ÉÉ„Éó„Ç≥„É≥„ÉÜ„Éä„Éº -->
                        <div id="branchMapsContainer" class="mt-6" style="display: none;">
                            <!-- ÊîØÂ∫ó„Éû„ÉÉ„Éó„ÅåÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Çã -->
                        </div>
                    </div>

                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-white border rounded-xl p-4 hover:shadow-lg transition">
                                <div class="flex items-center mb-2">
                                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">„ÅäÈõªË©±„Åß„ÅÆ„ÅäÂïè„ÅÑÂêà„Çè„Åõ</p>
                                        <p class="text-lg font-semibold text-gray-900">0120-XXX-XXX</p>
                                        <p class="text-xs text-gray-500">Âèó‰ªòÊôÇÈñì: 9:00-18:00ÔºàÂπ¥‰∏≠ÁÑ°‰ºëÔºâ</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white border rounded-xl p-4 hover:shadow-lg transition">
                                <div class="flex items-center mb-2">
                                    <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">„É°„Éº„É´„Åß„ÅÆ„ÅäÂïè„ÅÑÂêà„Çè„Åõ</p>
                                        <p class="text-lg font-semibold text-gray-900">info@kuraberu-ai.jp</p>
                                        <p class="text-xs text-gray-500">24ÊôÇÈñìÂèó‰ªò‰∏≠</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ÊúÄ‰∏ãÈÉ®CTA -->
                    <div class="text-center py-8 border-t">
                        <h3 class="text-2xl font-bold text-gray-900 mb-4">‰ªä„Åô„ÅêÁÑ°ÊñôË¶ãÁ©ç„ÇÇ„Çä„Çí‰æùÈ†º</h3>
                        <p class="text-gray-600 mb-6">„ÅäÊ∞óËªΩ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ</p>
                        <button class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-10 py-4 rounded-lg hover:shadow-xl transition text-lg font-semibold">
                            ÁÑ°ÊñôË¶ãÁ©ç„ÇÇ„Çä„Çí‰æùÈ†º„Åô„Çã
                        </button>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // „É°„Éã„É•„Éº„Éà„Ç∞„É´Ê©üËÉΩ
        function toggleMenu() {
            const sidebar = document.getElementById('sidebar');
            if (sidebar) {
                sidebar.classList.toggle('-translate-x-full');
            }
        }

        // „É¶„Éº„Ç∂„ÉºÁä∂ÊÖãÁÆ°ÁêÜ
        let currentUser = 'ÁÆ°ÁêÜËÄÖ';

        // ÊîØÂ∫óÊÉÖÂ†±ÁÆ°ÁêÜ
        window.branches = [];
        let branchIdCounter = 0;

        // ÊîØÂ∫óËøΩÂä†
        function addBranch() {
            const branchId = ++branchIdCounter;
            const branch = {
                id: branchId,
                name: '',
                address: ''
            };
            window.branches.push(branch);

            const branchList = document.getElementById('branchList');
            const branchDiv = document.createElement('div');
            branchDiv.id = `branch-${branchId}`;
            branchDiv.className = 'border rounded-lg p-4 mb-3 bg-gray-50';
            branchDiv.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h4 class="font-medium text-gray-700">ÊîØÂ∫ó ${branchId}</h4>
                    <button onclick="removeBranch(${branchId})" class="text-red-600 hover:text-red-800">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                    </button>
                </div>
                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÊîØÂ∫óÂêç</label>
                        <input type="text" class="w-full px-3 py-2 border rounded-lg" placeholder="‰æã: Ê®™ÊµúÊîØÂ∫ó"
                               onchange="updateBranch(${branchId}, 'name', this.value)">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‰ΩèÊâÄ</label>
                        <input type="text" class="w-full px-3 py-2 border rounded-lg" placeholder="‰æã: Á•ûÂ•àÂ∑ùÁúåÊ®™ÊµúÂ∏Ç..."
                               onchange="updateBranch(${branchId}, 'address', this.value)">
                    </div>
                </div>
            `;
            branchList.appendChild(branchDiv);
        }

        // ÊîØÂ∫óÊÉÖÂ†±Êõ¥Êñ∞
        function updateBranch(branchId, field, value) {
            const branch = window.branches.find(b => b.id === branchId);
            if (branch) {
                branch[field] = value;
                updateBranchMaps();
            }
        }

        // ÊîØÂ∫óÂâäÈô§
        function removeBranch(branchId) {
            window.branches = window.branches.filter(b => b.id !== branchId);
            const branchDiv = document.getElementById(`branch-${branchId}`);
            if (branchDiv) {
                branchDiv.remove();
            }
            updateBranchMaps();
        }

        // ÊîØÂ∫ó„Éû„ÉÉ„ÉóÊõ¥Êñ∞
        function updateBranchMaps() {
            // „Éó„É¨„Éì„É•„Éº„ÅÆÊîØÂ∫ó„Éû„ÉÉ„Éó„ÇíÊõ¥Êñ∞
            const branchMapsContainer = document.getElementById('branchMapsContainer');
            if (branchMapsContainer) {
                const validBranches = window.branches.filter(b => b.name && b.address);
                if (validBranches.length > 0) {
                    branchMapsContainer.innerHTML = `
                        <h4 class="text-sm font-medium text-gray-600 mb-3 mt-4">ÊîØÂ∫óÊÉÖÂ†±</h4>
                        <div class="space-y-4">
                    `;
                    validBranches.forEach((branch, index) => {
                        const mapDiv = document.createElement('div');
                        mapDiv.className = 'border rounded-lg p-4 bg-gray-50';
                        mapDiv.innerHTML = `
                            <h5 class="text-lg font-semibold text-gray-800 mb-2">${branch.name}</h5>
                            <p class="text-sm text-gray-600 mb-3">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                ${branch.address}
                            </p>
                            <div class="w-full h-64 bg-gray-200 rounded-lg overflow-hidden">
                                <iframe
                                    width="100%"
                                    height="100%"
                                    frameborder="0"
                                    style="border:0"
                                    src="https://www.google.com/maps/embed/v1/place?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&q=${encodeURIComponent(branch.address)}&zoom=16&language=ja"
                                    allowfullscreen>
                                </iframe>
                            </div>
                        `;
                        branchMapsContainer.appendChild(mapDiv);
                    });
                    const closeDiv = document.createElement('div');
                    closeDiv.innerHTML = '</div>';
                    branchMapsContainer.appendChild(closeDiv);
                    branchMapsContainer.style.display = 'block';
                } else {
                    branchMapsContainer.style.display = 'none';
                }
            }
        }
        let userRole = 'admin';

        // „É≠„Ç∞„Ç§„É≥Âá¶ÁêÜ
        // GAS API„ÅÆURLÔºàenv-loader.js„Åã„ÇâÂèñÂæóÔºâ
        const GAS_URL = ENV.GAS_URL;

        // „Çπ„ÉÜ„Éº„Çø„Çπ„Çí„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâË™≠„ÅøËæº„ÇÄÈñ¢Êï∞
        async function loadMerchantStatus(merchantId) {
            try {
                const result = await new Promise((resolve, reject) => {
                    const callbackName = 'jsonp_status_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    const script = document.createElement('script');

                    window[callbackName] = (data) => {
                        delete window[callbackName];
                        if (script.parentNode) {
                            script.parentNode.removeChild(script);
                        }
                        resolve(data);
                    };

                    script.src = `${GAS_URL}?action=getMerchantStatus&merchantId=${encodeURIComponent(merchantId)}&callback=${callbackName}`;
                    script.onerror = (error) => {
                        console.error('[loadMerchantStatus] Error:', error);
                        delete window[callbackName];
                        if (script.parentNode) {
                            script.parentNode.removeChild(script);
                        }
                        reject(new Error('JSONP request failed'));
                    };
                    document.body.appendChild(script);
                });

                if (result.success) {
                    const statusSpan = document.getElementById('merchantStatus');
                    if (statusSpan) {
                        // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Çí„Åù„ÅÆ„Åæ„ÅæË°®Á§∫Ôºà„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„ÄÅ‰∏ÄÊôÇÂÅúÊ≠¢„ÄÅ‰ºëÊ≠¢Ôºâ
                        let displayStatus = result.status || '‰ºëÊ≠¢';

                        // Ê≠£Ë¶èÂåñÔºàÂøµ„ÅÆ„Åü„ÇÅÔºâ
                        if (displayStatus === 'Á®ºÂÉç‰∏≠' || displayStatus === 'active') {
                            displayStatus = '„Ç¢„ÇØ„ÉÜ„Ç£„Éñ';
                        } else if (displayStatus === '‰∏ÄÊôÇÂÅúÊ≠¢‰∏≠' || displayStatus === 'paused') {
                            displayStatus = '‰∏ÄÊôÇÂÅúÊ≠¢';
                        }

                        statusSpan.textContent = displayStatus;

                        // „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„ÅüËâ≤„ÇíË®≠ÂÆö
                        statusSpan.classList.remove('bg-green-100', 'text-green-800', 'border-green-300');
                        statusSpan.classList.remove('bg-yellow-100', 'text-yellow-800', 'border-yellow-300');
                        statusSpan.classList.remove('bg-gray-100', 'text-gray-800', 'border-gray-300');
                        statusSpan.classList.remove('bg-red-100', 'text-red-800', 'border-red-300');

                        if (displayStatus === '„Ç¢„ÇØ„ÉÜ„Ç£„Éñ') {
                            statusSpan.classList.add('bg-green-100', 'text-green-800', 'border-green-300');
                        } else if (displayStatus === '‰∏ÄÊôÇÂÅúÊ≠¢') {
                            statusSpan.classList.add('bg-yellow-100', 'text-yellow-800', 'border-yellow-300');
                        } else if (displayStatus === '‰ºëÊ≠¢') {
                            statusSpan.classList.add('bg-red-100', 'text-red-800', 'border-red-300');
                        } else {
                            statusSpan.classList.add('bg-gray-100', 'text-gray-800', 'border-gray-300');
                        }
                    }
                }
            } catch (error) {
                console.error('[loadMerchantStatus] Error:', error);
            }
        }

        // „Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫„ÇíÊõ¥Êñ∞„Åô„ÇãÈñ¢Êï∞
        function updateHeaderStatus(status) {
            const statusSpan = document.getElementById('merchantStatus');
            if (!statusSpan) return;

            // Ê≠£Ë¶èÂåñ
            let displayStatus = status;
            if (displayStatus === 'Á®ºÂÉç‰∏≠' || displayStatus === 'active') {
                displayStatus = '„Ç¢„ÇØ„ÉÜ„Ç£„Éñ';
            } else if (displayStatus === '‰∏ÄÊôÇÂÅúÊ≠¢‰∏≠' || displayStatus === 'paused') {
                displayStatus = '‰∏ÄÊôÇÂÅúÊ≠¢';
            }

            statusSpan.textContent = displayStatus;

            // „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„ÅüËâ≤„ÇíË®≠ÂÆö
            statusSpan.classList.remove('bg-green-100', 'text-green-800', 'border-green-300');
            statusSpan.classList.remove('bg-yellow-100', 'text-yellow-800', 'border-yellow-300');
            statusSpan.classList.remove('bg-gray-100', 'text-gray-800', 'border-gray-300');
            statusSpan.classList.remove('bg-red-100', 'text-red-800', 'border-red-300');

            if (displayStatus === '„Ç¢„ÇØ„ÉÜ„Ç£„Éñ') {
                statusSpan.classList.add('bg-green-100', 'text-green-800', 'border-green-300');
            } else if (displayStatus === '‰∏ÄÊôÇÂÅúÊ≠¢') {
                statusSpan.classList.add('bg-yellow-100', 'text-yellow-800', 'border-yellow-300');
            } else if (displayStatus === '‰ºëÊ≠¢') {
                statusSpan.classList.add('bg-red-100', 'text-red-800', 'border-red-300');
            } else {
                statusSpan.classList.add('bg-gray-100', 'text-gray-800', 'border-gray-300');
            }

            console.log('[updateHeaderStatus] Updated status to:', displayStatus);
        }

        // Âä†ÁõüÂ∫ó„Éá„Éº„Çø„ÇíÂèñÂæó„Åô„ÇãÈñ¢Êï∞
        async function fetchMerchantData(merchantId) {
            console.log('[fetchMerchantData] Fetching data for:', merchantId);
            try {
                // JSONP „Åß„Éá„Éº„ÇøÂèñÂæó
                const result = await new Promise((resolve, reject) => {
                    const callbackName = 'jsonp_data_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    const script = document.createElement('script');

                    window[callbackName] = (data) => {
                        delete window[callbackName];
                        if (script.parentNode) {
                            script.parentNode.removeChild(script);
                        }
                        resolve(data);
                    };

                    script.src = `${GAS_URL}?action=getMerchantData&merchantId=${encodeURIComponent(merchantId)}&callback=${callbackName}`;
                    script.onerror = () => {
                        delete window[callbackName];
                        if (script.parentNode) {
                            script.parentNode.removeChild(script);
                        }
                        reject(new Error('JSONP request failed'));
                    };
                    document.body.appendChild(script);
                });

                console.log('[fetchMerchantData] Response:', result);
                console.log('[fetchMerchantData] result.success:', result.success);
                console.log('[fetchMerchantData] result.data:', result.data);
                console.log('[fetchMerchantData] result.error:', result.error);

                if (result.success && result.data) {
                    window.merchantData = result.data;
                    window.merchantId = merchantId; // merchantId„ÇÇ„Çª„ÉÉ„Éà

                    // Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç„ÇíÊòéÁ§∫ÁöÑ„Å´ÊäΩÂá∫ÔºàXÂàóÔºâ
                    const salesPersonName = result.data['Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç'] || result.data.salesPersonName || result.data.sales_person_name || '';
                    if (salesPersonName) {
                        window.merchantData.salesPerson = salesPersonName;
                        console.log('[fetchMerchantData] Sales person extracted:', salesPersonName);
                    }

                    console.log('[fetchMerchantData] Merchant data loaded:', window.merchantData);
                    console.log('[fetchMerchantData] merchantId set to:', window.merchantId);
                    console.log('[fetchMerchantData] salesPerson:', window.merchantData.salesPerson);
                } else {
                    console.warn('[fetchMerchantData] No data returned - success:', result.success, 'data:', result.data);
                    window.merchantData = {};
                }
            } catch (error) {
                console.error('[fetchMerchantData] Error:', error);
                window.merchantData = {};
            }
        }

        // Ê±éÁî®GAS APIÂëº„Å≥Âá∫„ÅóÔºàJSONPÔºâ
        async function callGasApi(action, params = {}) {
            console.log('[callGasApi] Calling action:', action, 'with params:', params);
            return new Promise((resolve, reject) => {
                const callbackName = 'jsonp_' + action + '_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                const script = document.createElement('script');

                window[callbackName] = (data) => {
                    delete window[callbackName];
                    if (script.parentNode) {
                        script.parentNode.removeChild(script);
                    }
                    resolve(data);
                };

                const queryParams = new URLSearchParams({
                    action: action,
                    callback: callbackName,
                    ...params
                });

                script.src = `${window.ENV.GAS_URL}?${queryParams.toString()}`;
                script.onerror = () => {
                    delete window[callbackName];
                    if (script.parentNode) {
                        script.parentNode.removeChild(script);
                    }
                    reject(new Error('Script load error'));
                };

                document.body.appendChild(script);
            });
        }

        // Âñ∂Ê•≠ÊãÖÂΩìËÄÖÂêçÁ∑®ÈõÜ
        function editSalesPerson() {
            const userRoleDiv = document.getElementById('userRole');
            const userRoleInput = document.getElementById('userRoleInput');

            userRoleInput.value = userRoleDiv.textContent;
            userRoleDiv.classList.add('hidden');
            userRoleInput.classList.remove('hidden');
            userRoleInput.focus();
            userRoleInput.select();
        }

        // Âñ∂Ê•≠ÊãÖÂΩìËÄÖÂêç‰øùÂ≠ò
        async function saveSalesPerson() {
            const userRoleDiv = document.getElementById('userRole');
            const userRoleInput = document.getElementById('userRoleInput');
            const newSalesPerson = userRoleInput.value.trim();

            if (!newSalesPerson) {
                alert('Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            try {
                // JSONP „Åß„Éá„Éº„Çø‰øùÂ≠ò
                const result = await new Promise((resolve, reject) => {
                    const callbackName = 'jsonp_sales_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    const script = document.createElement('script');

                    window[callbackName] = (data) => {
                        delete window[callbackName];
                        if (script.parentNode) {
                            script.parentNode.removeChild(script);
                        }
                        resolve(data);
                    };

                    script.src = `${GAS_URL}?action=updateSalesPerson&merchantId=${encodeURIComponent(currentUser)}&salesPerson=${encodeURIComponent(newSalesPerson)}&callback=${callbackName}`;
                    script.onerror = () => {
                        delete window[callbackName];
                        if (script.parentNode) {
                            script.parentNode.removeChild(script);
                        }
                        reject(new Error('JSONP request failed'));
                    };
                    document.body.appendChild(script);
                });

                if (result.success) {
                    // ÊàêÂäü - Ë°®Á§∫„ÇíÊõ¥Êñ∞
                    userRoleDiv.textContent = newSalesPerson;
                    if (window.merchantData) {
                        window.merchantData.salesPerson = newSalesPerson;
                    }
                } else {
                    // Â§±Êïó - ÂÖÉ„Å´Êàª„Åô
                    console.error('Save failed:', result.error);
                }
            } catch (error) {
                console.error('Save error:', error);
            }

            // ÂÖ•ÂäõÊ¨Ñ„ÇíÈùûË°®Á§∫„ÄÅ„ÉÜ„Ç≠„Çπ„Éà„ÇíË°®Á§∫
            userRoleInput.classList.add('hidden');
            userRoleDiv.classList.remove('hidden');
        }

        // „É≠„Éº„É´Ë°®Á§∫Êõ¥Êñ∞
        function updateRoleDisplay() {
            // „É¶„Éº„Ç∂„ÉºÂêç„Å®„É≠„Éº„É´„ÇíË°®Á§∫
            document.getElementById('userName').textContent = currentUser;

            // Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç„ÇíË°®Á§∫Ôºàwindow.merchantData„ÅÆXÂàó„Åã„ÇâÂèñÂæóÔºâ
            let salesPerson = 'Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊú™Ë®≠ÂÆö';
            if (window.merchantData && window.merchantData.salesPerson) {
                salesPerson = window.merchantData.salesPerson;
            }
            document.getElementById('userRole').textContent = salesPerson;
            
            // Ê®©Èôê„Å´Âøú„Åò„Å¶UI„ÇíÂ§âÊõ¥
            if (userRole === 'admin') {
                // ÁÆ°ÁêÜËÄÖ: „Åô„Åπ„Å¶Ë°®Á§∫„ÄÅÁ¥´Á≥ª„ÅÆÈÖçËâ≤
                document.getElementById('systemTitle').textContent = 'Âä†ÁõüÂ∫óÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†';
                document.getElementById('companyLogo').style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                document.getElementById('userRole').className = 'ml-2 text-xs px-2 py-1 rounded-full bg-purple-100 text-purple-800';
            } else {
                // Âñ∂Ê•≠: Âü∫Êú¨Ê©üËÉΩ„ÅÆ„Åø„ÄÅÈùíÁ≥ª„ÅÆÈÖçËâ≤
                document.getElementById('systemTitle').textContent = 'Âä†ÁõüÂ∫óÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†';
                document.getElementById('companyLogo').style.background = 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)';
                document.getElementById('userRole').className = 'ml-2 text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-800';
            }
            
            // ÁÆ°ÁêÜËÄÖÂ∞ÇÁî®„É°„Éã„É•„Éº„ÅÆË°®Á§∫Âà∂Âæ°
            const adminElements = document.querySelectorAll('.admin-only');
            adminElements.forEach(el => {
                el.style.display = userRole === 'admin' ? 'flex' : 'none';
            });
            
            // „É™„Éº„ÉÄ„ÉºÂ∞ÇÁî®Ë¶ÅÁ¥†„Åå„ÅÇ„Çå„Å∞ÁÆ°ÁêÜËÄÖ„ÅÆ„ÅøË°®Á§∫
            const leaderElements = document.querySelectorAll('.leader-only');
            leaderElements.forEach(el => {
                el.style.display = userRole === 'admin' ? 'flex' : 'none';
            });
        }

        // ÈÄöÁü•Ê®©Èôê„É™„ÇØ„Ç®„Çπ„Éà
        // ÈÄöÁü•Ë®±ÂèØ„É™„ÇØ„Ç®„Çπ„Éà„Çí„Ç¢„É©„Éº„Éà„Éë„Éç„É´ÂÜÖ„Å´Áµ±Âêà
        window.requestNotificationPermission = function() {
            if ('Notification' in window && Notification.permission !== 'granted') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        showNotification('ÈÄöÁü•Ë®≠ÂÆö', '„Éñ„É©„Ç¶„Ç∂ÈÄöÁü•„ÇíÊúâÂäπ„Å´„Åó„Åæ„Åó„Åü', 'success');
                    } else {
                        showInAppNotification('ÈÄöÁü•Ë®≠ÂÆö', '„Éñ„É©„Ç¶„Ç∂ÈÄöÁü•„ÅØÁÑ°Âäπ„Åß„Åô', 'warning');
                    }
                });
            }
        }

        // „Ç¢„É©„Éº„Éà„Éë„Éç„É´„ÇíÈñã„ÅèÊôÇ„Å´ÈÄöÁü•Ë®±ÂèØ„ÇíÁ¢∫Ë™ç
        function checkNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                const alertPanel = document.getElementById('alertPanel');
                if (alertPanel && !alertPanel.classList.contains('hidden')) {
                    // ÈÄöÁü•Ë®±ÂèØ„Éê„Éä„Éº„ÇíË°®Á§∫
                    const banner = document.createElement('div');
                    banner.className = 'bg-yellow-100 border-l-4 border-yellow-500 p-3 m-3';
                    banner.innerHTML = `
                        <div class="flex items-center justify-between">
                            <span class="text-sm">üîî „Éñ„É©„Ç¶„Ç∂ÈÄöÁü•„ÇíÊúâÂäπ„Å´„Åó„Åæ„Åô„ÅãÔºü</span>
                            <button onclick="requestNotificationPermission(); this.parentElement.parentElement.remove()"
                                    class="text-sm bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600">
                                ÊúâÂäπ„Å´„Åô„Çã
                            </button>
                        </div>
                    `;
                    alertPanel.insertBefore(banner, alertPanel.firstChild.nextSibling);
                }
            }
        }

        // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò
        async function saveAutoDeliverySettings() {
            console.log('[saveAutoDeliverySettings] Function called');
            const saveBtn = document.getElementById('saveAutodeliveryBtn');
            const originalText = saveBtn ? saveBtn.innerHTML : '';

            try {
                // „Éú„Çø„É≥„Çí„É≠„Éº„Éá„Ç£„É≥„Ç∞Áä∂ÊÖã„Å´
                if (saveBtn) {
                    saveBtn.disabled = true;
                    saveBtn.innerHTML = '<svg class="animate-spin inline-block w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>‰øùÂ≠ò‰∏≠...';
                }

                console.log('[saveAutoDeliverySettings] Collecting data...');
                const autoDeliveryData = collectAutoDeliveryData();
                console.log('[saveAutoDeliverySettings] Data collected:', autoDeliveryData);

                if (!autoDeliveryData) {
                    alert('„Ç®„É©„Éº: ÂøÖÈ†àÈ†ÖÁõÆ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                console.log('[saveAutoDeliverySettings] Sending data:', autoDeliveryData);

                // ‰ºöÁ§æÊÉÖÂ†±„Å®Âêå„ÅòÊñπÂºè„ÅßPOSTÈÄÅ‰ø°
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: JSON.stringify({
                        action: 'updateMerchantData',
                        merchantId: window.merchantId,
                        data: autoDeliveryData
                    })
                });

                console.log('[saveAutoDeliverySettings] Response status:', response.status);
                const result = await response.json();
                console.log('[saveAutoDeliverySettings] Result:', result);

                if (result.success) {
                    // ÊàêÂäüÊôÇ: „ÉÅ„Çß„ÉÉ„ÇØ„Éû„Éº„ÇØ„ÇíË°®Á§∫
                    if (saveBtn) {
                        saveBtn.innerHTML = '<svg class="inline-block w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>‰øùÂ≠òÂÆå‰∫Ü';
                    }

                    setTimeout(() => {
                        alert('‰øùÂ≠òÂÆå‰∫Ü: Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
                    }, 300);

                    resetAutodeliveryChanged();

                    // „Çπ„ÉÜ„Éº„Çø„Çπ„ÅåÂ§âÊõ¥„Åï„Çå„ÅüÂ†¥Âêà„ÄÅ„Éò„ÉÉ„ÉÄ„Éº„ÅÆË°®Á§∫„ÇíÂç≥Â∫ß„Å´Êõ¥Êñ∞
                    console.log('[saveAutoDeliverySettings] autoDeliveryData.status:', autoDeliveryData.status);
                    if (autoDeliveryData.status) {
                        console.log('[saveAutoDeliverySettings] Calling updateHeaderStatus with:', autoDeliveryData.status);
                        updateHeaderStatus(autoDeliveryData.status);
                    } else {
                        console.warn('[saveAutoDeliverySettings] No status in autoDeliveryData');
                    }

                    // 2ÁßíÂæå„Å´„Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
                    setTimeout(() => {
                        if (saveBtn) {
                            saveBtn.innerHTML = originalText;
                            saveBtn.disabled = false;
                        }
                    }, 2000);
                } else {
                    alert('„Ç®„É©„Éº: ' + (result.error || '‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'));
                }
            } catch (error) {
                console.error('[saveAutoDeliverySettings] Error:', error);
                alert('„Ç®„É©„Éº: ‰øùÂ≠ò‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
            } finally {
                // „Ç®„É©„ÉºÊôÇ„ÅØ„Åô„Åê„Å´ÂÖÉ„Å´Êàª„Åô
                if (saveBtn && saveBtn.disabled) {
                    setTimeout(() => {
                        saveBtn.innerHTML = originalText;
                        saveBtn.disabled = false;
                    }, 500);
                }
            }
        }

        // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Éá„Éº„Çø„ÇíÂèéÈõÜ
        function collectAutoDeliveryData() {
            // Áâ©‰ª∂Á®ÆÂà•ÔºàautodeliverySection„Å´ÈôêÂÆöÔºâ
            const propertyTypes = Array.from(document.querySelectorAll('#autodeliverySection input[name="propertyType"]:checked'))
                .map(cb => {
                    const typeMap = {
                        'house': 'Êà∏Âª∫„Å¶‰ΩèÂÆÖ',
                        'apartment': '„Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥',
                        'commercial': 'Â∫óËàó„Éª‰∫ãÂãôÊâÄ',
                        'factory': 'Â∑•Â†¥„ÉªÂÄâÂ∫´'
                    };
                    return typeMap[cb.value];
                });

            // Áâ©‰ª∂Á®ÆÂà•„Åå1„Å§„ÇÇÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØ„Ç®„É©„Éº
            if (propertyTypes.length === 0) {
                alert('„Ç®„É©„Éº: ÂØæÂøúÂèØËÉΩÁâ©‰ª∂Á®ÆÂà•„ÇíÊúÄ‰Ωé1„Å§ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return null;
            }

            // ÊúÄÂ§ßÂØæÂøúÈöéÊï∞
            const selects = document.querySelectorAll('#autodeliverySection select');
            const maxFloorsList = [];
            const typeNames = ['Êà∏Âª∫„Å¶‰ΩèÂÆÖ', '„Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥', 'Â∫óËàó„Éª‰∫ãÂãôÊâÄ', 'Â∑•Â†¥„ÉªÂÄâÂ∫´'];
            selects.forEach((select, idx) => {
                if (propertyTypes.includes(typeNames[idx])) {
                    // selectË¶ÅÁ¥†„ÅÆÈÅ∏Êäû„Åï„Çå„Åüoption„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÇíÂèñÂæó
                    const selectedOption = select.options[select.selectedIndex];
                    const optionText = selectedOption ? selectedOption.text : select.value;
                    maxFloorsList.push(`${typeNames[idx]}(${optionText}„Åæ„Åß)`);
                }
            });

            // ÁØâÂπ¥Êï∞ÁØÑÂõ≤
            const ageSliders = document.querySelectorAll('#autodeliverySection input[type="range"]');
            const ageMin = ageSliders[0] ? parseInt(ageSliders[0].value) : 0;
            const ageMax = ageSliders[1] ? parseInt(ageSliders[1].value) : 50;

            // ÊñΩÂ∑•ÁÆáÊâÄÔºàÂÆåÂÖ®‰∏ÄËá¥„Åß‰øùÂ≠òÔºâÔºàautodeliverySection„Å´ÈôêÂÆöÔºâ
            const constructionTypes = Array.from(document.querySelectorAll('#autodeliverySection input[name="constructionTypes"]:checked'))
                .map(cb => cb.value);

            // ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆÔºàÂÆåÂÖ®‰∏ÄËá¥„Åß‰øùÂ≠òÔºâÔºàautodeliverySection„Å´ÈôêÂÆöÔºâ
            const specialServices = Array.from(document.querySelectorAll('#autodeliverySection input[name="specialServices"]:checked'))
                .map(cb => cb.value);

            // ÂØæÂøúÈÉΩÈÅìÂ∫úÁúå„ÉªÂ∏ÇÂå∫Áî∫Êùë
            const prefectures = areaSelectionData.prefectures.join(',');

            // Â∏ÇÂå∫Áî∫Êùë„ÇíJSONÂúßÁ∏ÆÂΩ¢Âºè„Åß‰øùÂ≠òÔºà„Çπ„Éó„Ç∑„Å®Âêå„ÅòÂΩ¢ÂºèÔºâ
            const allCities = [];
            Object.entries(areaSelectionData.cities).forEach(([pref, cities]) => {
                allCities.push(...cities);
            });
            const citiesStr = JSON.stringify({
                type: "compressed",
                full: allCities.join(','),
                preview: allCities.slice(0, 100).join(',') + (allCities.length > 100 ? '...' : '')
            });

            // ÂÑ™ÂÖà„Ç®„É™„Ç¢: „Ç¢„É≥„ÉÄ„Éº„Çπ„Ç≥„Ç¢ÂΩ¢Âºè„ÅÆ„Åæ„Åæ‰øùÂ≠òÔºà„Çπ„Éó„Ç∑„ÅÆÂΩ¢Âºè„Å´Âêà„Çè„Åõ„ÇãÔºâ
            const priorities = areaSelectionData.priorities.join(',');

            // ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„Éá„Éº„Çø
            const autoPauseToggle = document.getElementById('autoPauseToggle');
            const pauseStartDate = document.getElementById('pauseStartDate');
            const pauseEndDate = document.getElementById('pauseEndDate');
            const indefinitePause = document.getElementById('indefinitePause');

            const pauseFlag = autoPauseToggle ? autoPauseToggle.checked : false;
            const pauseStart = pauseFlag && pauseStartDate ? pauseStartDate.value : '';
            const pauseEnd = pauseFlag && pauseEndDate && !indefinitePause.checked ? pauseEndDate.value : '';
            const isIndefinite = pauseFlag && indefinitePause && indefinitePause.checked;

            // ‰∏ÄÊôÇÂÅúÊ≠¢„Éê„É™„Éá„Éº„Ç∑„Éß„É≥
            if (pauseFlag) {
                // ‰∏ÄÊôÇÂÅúÊ≠¢ON„ÅÆÂ†¥Âêà„ÄÅÈñãÂßãÊó•„ÅØÂøÖÈ†à
                if (!pauseStart) {
                    showNotification('„Ç®„É©„Éº', '‰∏ÄÊôÇÂÅúÊ≠¢ÈñãÂßãÊó•„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                    return null;
                }
                // ÂÜçÈñã‰∫àÂÆöÊó•„ÇÇÂøÖÈ†àÔºàÊú™ÂÆö„ÉÅ„Çß„ÉÉ„ÇØ„ÅåOFF„ÅÆÂ†¥ÂêàÔºâ
                if (!isIndefinite && !pauseEnd) {
                    showNotification('„Ç®„É©„Éº', '‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñã‰∫àÂÆöÊó•„ÇíÂÖ•Âäõ„Åô„Çã„Åã„ÄÅ„ÄåÊú™ÂÆö„Äç„Å´„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÂÖ•„Çå„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                    return null;
                }
            }

            // „Çπ„ÉÜ„Éº„Çø„Çπ„ÅÆÊ±∫ÂÆö
            // - ‰∏ÄÊôÇÂÅúÊ≠¢OFF ‚Üí „Ç¢„ÇØ„ÉÜ„Ç£„Éñ
            // - ‰∏ÄÊôÇÂÅúÊ≠¢ON + ÈñãÂßãÊó•„ÅåÊú™Êù• ‚Üí „Ç¢„ÇØ„ÉÜ„Ç£„ÉñÔºà„Çπ„Ç±„Ç∏„É•„Éº„É´‰∫àÁ¥ÑÔºâ
            // - ‰∏ÄÊôÇÂÅúÊ≠¢ON + ÈñãÂßãÊó•„Åå‰ªäÊó•‰ª•Ââç + ÂÜçÈñãÊó•Êú™ÂÆö ‚Üí ‰ºëÊ≠¢
            // - ‰∏ÄÊôÇÂÅúÊ≠¢ON + ÈñãÂßãÊó•„Åå‰ªäÊó•‰ª•Ââç + ÂÜçÈñãÊó•„ÅÇ„Çä ‚Üí ‰∏ÄÊôÇÂÅúÊ≠¢
            let status = '„Ç¢„ÇØ„ÉÜ„Ç£„Éñ';
            if (pauseFlag && pauseStart) {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const startDate = new Date(pauseStart);
                startDate.setHours(0, 0, 0, 0);

                // ÈñãÂßãÊó•„Åå‰ªäÊó•„Åæ„Åü„ÅØÈÅéÂéª„ÅÆÂ†¥Âêà„ÅÆ„Åø„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥
                if (startDate <= today) {
                    status = isIndefinite ? '‰ºëÊ≠¢' : '‰∏ÄÊôÇÂÅúÊ≠¢';
                }
                // ÈñãÂßãÊó•„ÅåÊú™Êù•„ÅÆÂ†¥Âêà„ÅØ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„ÅÆ„Åæ„ÅæÔºà‰∫àÁ¥ÑÁä∂ÊÖãÔºâ
            }

            return {
                // GAS„ÅÆupdateMerchantData„ÅßÊúüÂæÖ„Åô„Çã„Éï„Ç£„Éº„É´„ÉâÂêç„Å´Âêà„Çè„Åõ„Çã
                propertyTypes: propertyTypes.join(','),               // ÂØæÂøúÁâ©‰ª∂Á®ÆÂà•
                maxFloors: maxFloorsList.join(','),                    // ÊúÄÂ§ßÂØæÂøúÈöéÊï∞
                buildingAge: `{min=${ageMin}, max=${ageMax}}`,        // ÁØâÂπ¥Êï∞ÂØæÂøúÁØÑÂõ≤
                constructionTypes: constructionTypes.join(','),        // ÂØæÂøúÂ∑•‰∫ãÁ®ÆÂà•ÔºàÊñΩÂ∑•ÁÆáÊâÄÂàó„Å´‰øùÂ≠òÔºâ
                specialServices: specialServices.join(','),           // ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ
                prefectures: prefectures,                             // ÂØæÂøúÈÉΩÈÅìÂ∫úÁúå
                cities: citiesStr,                                    // ÂØæÂøúÂ∏ÇÂå∫Áî∫Êùë
                priorityAreas: priorities,                            // ÂÑ™ÂÖà„Ç®„É™„Ç¢
                // ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö
                status: status,                                       // „Çπ„ÉÜ„Éº„Çø„Çπ (AJÂàó)
                pauseFlag: pauseFlag ? 'TRUE' : 'FALSE',             // ‰∏ÄÊôÇÂÅúÊ≠¢„Éï„É©„Ç∞ (AOÂàó)
                pauseStartDate: pauseStart || '',                     // ‰∏ÄÊôÇÂÅúÊ≠¢ÈñãÂßãÊó• (APÂàó)
                pauseEndDate: isIndefinite ? 'Êú™ÂÆö' : (pauseEnd || '') // ‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñã‰∫àÂÆöÊó• (AQÂàó)
            };
        }

        // Â±ãÂè∑Ë°®Á§∫„Ç™„Éó„Ç∑„Éß„É≥„ÅÆË°®Á§∫/ÈùûË°®Á§∫
        function updateTradeNameDisplay() {
            const tradeName = document.getElementById('tradeName').value;
            const tradeNameOptions = document.getElementById('tradeNameDisplayOptions');

            if (tradeName && tradeName.trim() !== '') {
                tradeNameOptions.style.display = 'block';
            } else {
                tradeNameOptions.style.display = 'none';
            }
        }

        // ÊóßÈñ¢Êï∞Âêç„ÅÆ‰∫íÊèõÊÄßÁ∂≠ÊåÅ
        function updateBranchDisplay() {
            updateTradeNameDisplay();
        }

        // ‰ºöÁ§æÂêçË°®Á§∫„ÇíÊõ¥Êñ∞
        function updateCompanyNameDisplay() {
            // ‰∏°ÊñπË°®Á§∫„Ç™„Éó„Ç∑„Éß„É≥„ÅÆË°®Á§∫/ÈùûË°®Á§∫
            const displayOption = document.querySelector('input[name="tradeNameDisplay"]:checked')?.value;
            const bothOptions = document.getElementById('bothDisplayOptions');

            if (displayOption === 'both' && bothOptions) {
                bothOptions.style.display = 'block';
            } else if (bothOptions) {
                bothOptions.style.display = 'none';
            }
        }

        // Ëá™Âãï‰øùÂ≠ò
        async function autoSave() {
            // ‰øùÂ≠ò„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº„ÇíË°®Á§∫
            const saveIndicator = document.querySelector('#companySection .text-green-500');
            if (saveIndicator) {
                saveIndicator.parentElement.parentElement.style.opacity = '0.5';
            }

            // ÁîªÂÉè„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂá¶ÁêÜÔºà„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´Ôºâ
            if (mainVisualData && mainVisualFileName) {
                try {
                    console.log('[autoSave] Uploading main visual...');
                    const response = await fetch(GAS_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/plain' },
                        body: JSON.stringify({
                            action: 'companyinfo_uploadImage',
                            merchantId: window.merchantId,
                            base64Data: mainVisualData,
                            fileName: mainVisualFileName,
                            imageType: 'main-visual'
                        })
                    });
                    const result = await response.json();
                    console.log('[autoSave] Main visual response:', result);
                    if (result.success) {
                        mainVisualUrl = result.url;
                        console.log('[autoSave] Main visual uploaded:', result.url);
                    } else {
                        console.error('[autoSave] Main visual upload failed:', result.error);
                    }
                } catch (error) {
                    console.error('[autoSave] Main visual upload error:', error);
                }
            }

            // ÁîªÂÉè„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂá¶ÁêÜÔºàÂÜôÁúü„ÇÆ„É£„É©„É™„ÉºÔºâ
            const uploadedGalleryUrls = [];
            if (galleryFilesToUpload.length > 0) {
                try {
                    console.log('[autoSave] Uploading gallery images:', galleryFilesToUpload.length);
                    for (const file of galleryFilesToUpload) {
                        const response = await fetch(GAS_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'text/plain' },
                            body: JSON.stringify({
                                action: 'companyinfo_uploadImage',
                                merchantId: window.merchantId,
                                base64Data: file.base64Data,
                                fileName: file.fileName,
                                imageType: 'gallery'
                            })
                        });
                        const result = await response.json();
                        if (result.success) {
                            console.log('[autoSave] Gallery image uploaded:', result.url);
                            uploadedGalleryUrls.push(result.url);
                        }
                    }
                    // „Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂÆå‰∫ÜÂæå„ÄÅÈÖçÂàó„Çí„ÇØ„É™„Ç¢
                    galleryFilesToUpload = [];
                } catch (error) {
                    console.error('[autoSave] Gallery upload error:', error);
                }
            }

            // „Éï„Ç©„Éº„É†„Åã„Çâ„Éá„Éº„Çø„ÇíÂèéÈõÜ
            // ‚Äª„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆÂàó„Å®„ÅÆÂØæÂøú:
            // CÂàó: ‰ºöÁ§æÂêç, DÂàó: ‰ºöÁ§æÂêç„Ç´„Éä, EÂàó: Â±ãÂè∑, FÂàó: Â±ãÂè∑„Ç´„Éä
            // GÂàó: ‰ª£Ë°®ËÄÖÂêç, HÂàó: ‰ª£Ë°®ËÄÖÂêç„Ç´„Éä, IÂàó: ÈÉµ‰æøÁï™Âè∑, JÂàó: ‰ΩèÊâÄ
            // KÂàó: ÈõªË©±Áï™Âè∑, LÂàó: „Ç¶„Çß„Éñ„Çµ„Ç§„ÉàURL, MÂàó: Ë®≠Á´ãÂπ¥Êúà, NÂàó: PR„ÉÜ„Ç≠„Çπ„Éà
            // OÂàó: ÊîØÂ∫óÂêç, PÂàó: ÊîØÂ∫ó‰ΩèÊâÄ
            // VÂàó: Ë´ãÊ±ÇÁî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ, WÂàó: Âñ∂Ê•≠Áî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ
            // XÂàó: Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç, YÂàó: Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„Ç´„Éä
            // ZÂàó: ÂæìÊ•≠Âì°Êï∞, AAÂàó: Â£≤‰∏äË¶èÊ®°
            // ARÂàó: „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´, ASÂàó: ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº
            // ATÂàó: ‰øùÊúâË≥áÊ†º, AUÂàó: Âä†ÂÖ•‰øùÈô∫

            const formData = {
                // Âü∫Êú¨ÊÉÖÂ†±
                companyName: document.getElementById('companyName')?.value || '', // CÂàó: ‰ºöÁ§æÂêç
                companyNameKana: document.getElementById('companyNameKana')?.value || '', // DÂàó: ‰ºöÁ§æÂêç„Ç´„Éä
                tradeName: document.getElementById('tradeName')?.value || '', // EÂàó: Â±ãÂè∑
                tradeNameKana: document.getElementById('tradeNameKana')?.value || '', // FÂàó: Â±ãÂè∑„Ç´„Éä
                representative: document.getElementById('representative')?.value || '', // GÂàó: ‰ª£Ë°®ËÄÖÂêç
                representativeKana: document.getElementById('representativeKana')?.value || '', // HÂàó: ‰ª£Ë°®ËÄÖÂêç„Ç´„Éä
                postalCode: document.getElementById('zipCode')?.value || '', // IÂàó: ÈÉµ‰æøÁï™Âè∑
                address: document.getElementById('address')?.value || '', // JÂàó: ‰ΩèÊâÄ
                phone: document.getElementById('phone')?.value || '', // KÂàó: ÈõªË©±Áï™Âè∑
                website: document.getElementById('website')?.value || '', // LÂàó: „Ç¶„Çß„Éñ„Çµ„Ç§„ÉàURL
                established: document.getElementById('established')?.value || '', // MÂàó: Ë®≠Á´ãÂπ¥Êúà
                prText: document.getElementById('prText')?.value || '', // NÂàó: PR„ÉÜ„Ç≠„Çπ„Éà

                // OÂàó: ÊîØÂ∫óÂêç, PÂàó: ÊîØÂ∫ó‰ΩèÊâÄ
                branchName: (window.branches || []).map(b => b.name).filter(v => v).join('„ÄÅ') || '',
                branchAddress: (window.branches || []).map(b => b.address).filter(v => v).join('„ÄÅ') || '',

                // VÂàó: Ë´ãÊ±ÇÁî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ, WÂàó: Âñ∂Ê•≠Áî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ
                // XÂàó: Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç, YÂàó: Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„Ç´„Éä
                billingEmail: document.getElementById('billingEmail')?.value || '',
                salesEmail: document.getElementById('salesEmail')?.value || '',
                salesPersonName: document.getElementById('salesPersonName')?.value || '',
                salesPersonKana: document.getElementById('salesPersonKana')?.value || '',

                // ZÂàó: ÂæìÊ•≠Âì°Êï∞, AAÂàó: Â£≤‰∏äË¶èÊ®°
                employees: document.getElementById('employees')?.value || '',
                salesScale: document.getElementById('salesScale')?.value || '',

                // ATÂàó: ‰øùÊúâË≥áÊ†º, AUÂàó: Âä†ÂÖ•‰øùÈô∫Ôºà„Ç´„Çπ„Çø„É†È†ÖÁõÆ„ÇÇÂê´„ÇÅ„ÇãÔºâ
                qualifications: (() => {
                    const checked = Array.from(document.querySelectorAll('input[name="qualifications"]:checked')).map(cb => cb.value);
                    const custom = Array.from(document.querySelectorAll('#customQualificationsList > div > span')).map(el => el.textContent.trim());
                    return [...checked, ...custom].filter(v => v).join(',') || '';
                })(),
                insurance: (() => {
                    const checked = Array.from(document.querySelectorAll('input[name="insurance"]:checked')).map(cb => cb.value);
                    const custom = Array.from(document.querySelectorAll('#customInsuranceList > div > span')).map(el => el.textContent.trim());
                    return [...checked, ...custom].filter(v => v).join(',') || '';
                })()
            };

            // ÁîªÂÉèURL„ÇíËøΩÂä†Ôºà„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊ∏à„Åø„ÅÆÂ†¥ÂêàÔºâ
            if (mainVisualUrl) {
                formData['„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´'] = mainVisualUrl; // ARÂàó: „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´
                console.log('[autoSave] Added main visual to formData:', mainVisualUrl);
            }

            // „ÇÆ„É£„É©„É™„ÉºURL„ÇíËøΩÂä†ÔºàÊó¢Â≠òURL„ÅØ‰øùÂ≠òÊôÇ„Å´ÊúÄÊñ∞„ÇíÂèñÂæóÔºâ
            if (uploadedGalleryUrls.length > 0) {
                try {
                    // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÊúÄÊñ∞„ÅÆÂÜôÁúü„ÇÆ„É£„É©„É™„ÉºURL„ÇíÂèñÂæó
                    const merchantDataResponse = await fetch(GAS_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/plain' },
                        body: JSON.stringify({
                            action: 'getMerchantData',
                            merchantId: window.merchantId
                        })
                    });
                    const merchantDataResult = await merchantDataResponse.json();
                    const existingGalleryUrls = merchantDataResult.data?.['ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº']
                        ? merchantDataResult.data['ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº'].split(',').map(url => url.trim()).filter(url => url)
                        : [];

                    const allGalleryUrls = [...existingGalleryUrls, ...uploadedGalleryUrls].slice(0, 20);
                    formData['ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº'] = allGalleryUrls.join(','); // ASÂàó: ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº
                    console.log('[autoSave] Added gallery to formData:', allGalleryUrls.length, 'images (', existingGalleryUrls.length, 'existing +', uploadedGalleryUrls.length, 'new)');
                } catch (error) {
                    console.error('[autoSave] Failed to get existing gallery:', error);
                    // „Ç®„É©„ÉºÊôÇ„ÅØÊñ∞„Åó„ÅÑURL„ÅÆ„Åø‰øùÂ≠ò
                    formData['ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº'] = uploadedGalleryUrls.join(',');
                }
            }

            try {
                console.log('[‰øùÂ≠ò] ÈÄÅ‰ø°„Éá„Éº„Çø:', formData);
                console.log('[‰øùÂ≠ò] merchantId:', window.merchantId);

                // GAS„Å´‰øùÂ≠ò„É™„ÇØ„Ç®„Çπ„Éà„ÇíÈÄÅ‰ø°
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: JSON.stringify({
                        action: 'updateMerchantData',
                        merchantId: window.merchantId,
                        data: formData
                    })
                });

                const result = await response.json();
                console.log('[‰øùÂ≠ò] GAS„É¨„Çπ„Éù„É≥„Çπ:', result);

                if (result.success) {
                    console.log('‚úÖ ‰øùÂ≠òÂÆå‰∫Ü');
                    console.log('‰øùÂ≠ò„Åó„ÅüÈ†ÖÁõÆÊï∞:', Object.keys(formData).length);

                    // ‰øùÂ≠ò„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº„ÇíÂÖÉ„Å´Êàª„Åô
                    if (saveIndicator) {
                        setTimeout(() => {
                            saveIndicator.parentElement.parentElement.style.opacity = '1';
                        }, 500);
                    }
                } else {
                    console.error('‚ùå ‰øùÂ≠ò„Ç®„É©„Éº:', result.error);
                    showNotification('„Ç®„É©„Éº', '‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                }
            } catch (error) {
                console.error('‚ùå ÈÄö‰ø°„Ç®„É©„Éº:', error);
                // „Ç®„É©„ÉºÊôÇ„ÇÇË¶ã„ÅüÁõÆ„ÇíÂÖÉ„Å´Êàª„Åô
                if (saveIndicator) {
                    saveIndicator.parentElement.parentElement.style.opacity = '1';
                }
            }
        }

        // ‰ºöÁ§æÊÉÖÂ†±„ÅÆ‰øùÂ≠ò
        async function saveCompanyInfo() {
            console.log('[saveCompanyInfo] ‰øùÂ≠òÈñãÂßã');
            console.log('[saveCompanyInfo] GAS_URL:', GAS_URL);
            console.log('[saveCompanyInfo] window.merchantId:', window.merchantId);

            if (!window.merchantId) {
                alert('„Ç®„É©„Éº: merchantId„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ„É≠„Ç∞„Ç§„É≥„ÅóÁõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                console.error('[saveCompanyInfo] merchantId„ÅåÊú™Ë®≠ÂÆö');
                return;
            }

            const saveButton = event.target.closest('button');
            if (!saveButton) {
                console.error('[saveCompanyInfo] ‰øùÂ≠ò„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }

            saveButton.disabled = true;
            const originalHTML = saveButton.innerHTML;
            saveButton.innerHTML = '<svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> ‰øùÂ≠ò‰∏≠...';

            try {
                const result = await autoSave();
                console.log('[saveCompanyInfo] ‰øùÂ≠òÁµêÊûú:', result);
                showNotification('‰øùÂ≠òÂÆå‰∫Ü', '‰ºöÁ§æÊÉÖÂ†±„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
            } catch (error) {
                console.error('[saveCompanyInfo] „Ç®„É©„Éº:', error);
                showNotification('„Ç®„É©„Éº', '‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
            } finally {
                saveButton.disabled = false;
                saveButton.innerHTML = originalHTML;
            }
        }

        // ‰ºöÁ§æÊÉÖÂ†±„ÅÆ„É™„Çª„ÉÉ„Éà
        function resetCompanyInfo() {
            if (confirm('ÂÖ•ÂäõÂÜÖÂÆπ„Çí„É™„Çª„ÉÉ„Éà„Åó„Å¶„ÄÅ„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÂÜçË™≠„ÅøËæº„Åø„Åó„Åæ„Åô„ÅãÔºü')) {
                if (window.merchantData) {
                    loadMerchantData(window.merchantId, window.merchantData);
                    showNotification('„É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü', 'ÊúÄÊñ∞„ÅÆ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü');
                }
            }
        }

        // „Ç´„Çπ„Çø„É†Ë≥áÊ†º„ÇíËøΩÂä†
        function addCustomQualification() {
            const input = document.getElementById('customQualificationInput');
            const value = input.value.trim();

            if (value) {
                const list = document.getElementById('customQualificationsList');
                const tag = document.createElement('div');
                tag.className = 'inline-flex items-center bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm';
                tag.innerHTML = `
                    <span>${value}</span>
                    <button onclick="this.parentElement.remove()" class="ml-2 text-blue-600 hover:text-blue-800">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                `;
                list.appendChild(tag);
                input.value = '';
            }
        }

        // „Ç´„Çπ„Çø„É†‰øùÈô∫„ÇíËøΩÂä†
        function addCustomInsurance() {
            const input = document.getElementById('customInsuranceInput');
            const value = input.value.trim();

            if (value) {
                const list = document.getElementById('customInsuranceList');
                const tag = document.createElement('div');
                tag.className = 'inline-flex items-center bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm';
                tag.innerHTML = `
                    <span>${value}</span>
                    <button onclick="this.parentElement.remove()" class="ml-2 text-green-600 hover:text-green-800">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                `;
                list.appendChild(tag);
                input.value = '';
            }
        }

        // ‰ºöÁ§æÊÉÖÂ†±„ÅÆ„Éó„É¨„Éì„É•„Éº
        function previewCompanyInfo() {
            // ÂÖ•ÂäõÂÄ§„ÇíÂèñÂæó
            const companySection = document.getElementById('companySection');
            const companyName = companySection.querySelector('input[placeholder*="Ê†™Âºè‰ºöÁ§æ"]').value || 'Ê†™Âºè‰ºöÁ§æ„Åè„Çâ„Åπ„ÇãÂ°óË£Ö';
            const tradeName = document.getElementById('tradeName').value;
            const displayOption = document.querySelector('input[name="tradeNameDisplay"]:checked')?.value || 'company';
            const representative = companySection.querySelector('input[placeholder="‰ª£Ë°®ËÄÖÂêç„ÇíÂÖ•Âäõ"]')?.value || '-';
            const zipCode = companySection.querySelector('input[placeholder="123-4567"]')?.value || '';
            const address = companySection.querySelector('input[placeholder="Êù±‰∫¨ÈÉΩÊ∏ØÂå∫ÈùíÂ±±1-1-1"]')?.value ||
                           companySection.querySelector('label:has-text("‰ΩèÊâÄ") + input')?.value ||
                           companySection.querySelector('label:has-text("ÊâÄÂú®Âú∞") + input')?.value || '-';
            const established = companySection.querySelector('input[placeholder="2010Âπ¥4Êúà"]')?.value || '2010Âπ¥4Êúà';
            const prText = companySection.querySelector('textarea[placeholder*="PRÊñá"]')?.value ||
                          companySection.querySelector('textarea[rows="4"]')?.value ||
                          'Âú∞ÂüüÂØÜÁùÄ„Åß15Âπ¥‰ª•‰∏ä„ÄÅÁ¢∫„Åã„Å™ÊäÄË°ì„Å®‰∏ÅÂØß„Å™‰ªï‰∫ã„ÅßÁöÜÊßò„ÅÆÂ§ßÂàá„Å™‰Ωè„Åæ„ÅÑ„ÇíÂÆà„Çä„Åæ„Åô„ÄÇË¶ãÁ©ç„ÇÇ„Çä„Åã„ÇâÊñΩÂ∑•„Åæ„ÅßËá™Á§æ‰∏ÄË≤´‰ΩìÂà∂„Åß„ÄÅ‰∏≠Èñì„Éû„Éº„Ç∏„É≥„Å™„Åó„ÅÆÈÅ©Ê≠£‰æ°Ê†º„Çí„ÅîÊèê‰æõ„ÄÇ„Ç¢„Éï„Çø„Éº„Éï„Ç©„É≠„Éº„ÇÇ‰∏áÂÖ®„Åß„Åô„ÄÇ';

            // ‰ºöÁ§æÂêç„ÅÆË°®Á§∫„ÇíÊ±∫ÂÆö
            let displayName = companyName;
            let displayHtml = companyName; // HTMLÁî®Ôºà„Çµ„Ç§„Ç∫Ë™øÊï¥Âê´„ÇÄÔºâ

            if (tradeName && tradeName.trim() !== '') {
                const reverseOrder = document.getElementById('reverseOrder')?.checked || false;
                const smallerSecond = document.getElementById('smallerSecond')?.checked || false;

                switch(displayOption) {
                    case 'trade':
                        displayName = tradeName;
                        displayHtml = tradeName;
                        break;
                    case 'both':
                        if (reverseOrder) {
                            displayName = `${tradeName}ÔΩú${companyName}`;
                            if (smallerSecond) {
                                displayHtml = `${tradeName}ÔΩú<span style="font-size:85%">${companyName}</span>`;
                            } else {
                                displayHtml = displayName;
                            }
                        } else {
                            displayName = `${companyName}ÔΩú${tradeName}`;
                            if (smallerSecond) {
                                displayHtml = `${companyName}ÔΩú<span style="font-size:85%">${tradeName}</span>`;
                            } else {
                                displayHtml = displayName;
                            }
                        }
                        break;
                    case 'company':
                    default:
                        displayName = companyName;
                        displayHtml = companyName;
                        break;
                }
            }

            // „Éó„É¨„Éì„É•„Éº„Å´ÂèçÊò†
            const setElementText = (id, text) => {
                const element = document.getElementById(id);
                if (element) element.textContent = text;
            };

            const setElementHtml = (id, html) => {
                const element = document.getElementById(id);
                if (element) element.innerHTML = html;
            };

            // ‰ºöÁ§æÂêç„ÅØHTML„Å®„Åó„Å¶Ë®≠ÂÆöÔºà„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫Â§âÊõ¥„ÇíÂèçÊò†„Åô„Çã„Åü„ÇÅÔºâ
            setElementHtml('previewCompanyName', displayHtml);
            setElementHtml('previewCompanyNameHero', displayHtml);
            setElementHtml('previewCompanyNameOverlay', displayHtml);
            setElementHtml('previewCompanyNameFull', displayHtml);
            setElementText('previewRepresentative', representative);

            // ÊâÄÂú®Âú∞„ÇíË°®Á§∫ÔºàÈÉµ‰æøÁï™Âè∑„ÇÇÂê´„ÇÅ„ÇãÔºâ
            const fullAddress = zipCode ? `„Äí${zipCode} ${address}` : address;
            setElementText('previewAddress', fullAddress);

            setElementText('previewEstablishedDate', established);

            // PRÊñá„ÇíË°®Á§∫
            setElementText('previewPRText', prText);

            // „Ç≠„É£„ÉÉ„ÉÅ„Éï„É¨„Éº„Ç∫„ÇíPRÊñá„ÅÆÊúÄÂàù„ÅÆ‰∏ÄÊñá„Åã„ÇâÊäΩÂá∫
            const firstSentence = prText.split('„ÄÇ')[0];
            const tagline = firstSentence.length > 40 ? firstSentence.substring(0, 40) + '...' : firstSentence;
            setElementText('previewTagline', tagline || '‰ø°È†º„Å®ÂÆüÁ∏æ„ÅÆÂ§ñÂ£ÅÂ°óË£ÖÂ∞ÇÈñÄÂ∫ó');
            setElementText('previewTaglineHero', tagline || '‰ø°È†º„Å®ÂÆüÁ∏æ„ÅÆÂ§ñÂ£ÅÂ°óË£ÖÂ∞ÇÈñÄÂ∫ó');
            setElementText('previewTaglineOverlay', tagline || '‰ø°È†º„Å®ÂÆüÁ∏æ„ÅÆÂ§ñÂ£ÅÂ°óË£ÖÂ∞ÇÈñÄÂ∫ó');

            setElementText('previewEstablishedHero', established);
            setElementText('previewEstablishedOverlay', established);

            // „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„Åå„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØË°®Á§∫
            if (mainVisualData) {
                document.getElementById('previewMainVisual').src = mainVisualData;
                document.getElementById('mainVisualSection').style.display = 'block';
                document.getElementById('heroSection').style.display = 'none';
            } else {
                document.getElementById('mainVisualSection').style.display = 'none';
                document.getElementById('heroSection').style.display = 'block';
            }

            // Ë≥áÊ†º„ÇíË°®Á§∫
            const qualificationsList = document.getElementById('qualificationsList');
            if (qualificationsList) {
                qualificationsList.innerHTML = '';
                // „ÉÅ„Çß„ÉÉ„ÇØ„Åï„Çå„ÅüË≥áÊ†º„ÇíÂèñÂæó
                const checkedQualifications = companySection.querySelectorAll('input[name="qualifications"]:checked');
                checkedQualifications.forEach(qual => {
                    const div = document.createElement('div');
                    div.className = 'bg-purple-50 border border-purple-200 rounded-lg p-3 flex items-center';
                    div.innerHTML = `
                        <span class="text-2xl mr-2">üéñÔ∏è</span>
                        <span class="text-sm font-medium">${qual.value}</span>
                    `;
                    qualificationsList.appendChild(div);
                });
                // „Ç´„Çπ„Çø„É†Ë≥áÊ†º„ÇíËøΩÂä†
                const customQuals = document.querySelectorAll('#customQualificationsList > div');
                customQuals.forEach(qual => {
                    const qualText = qual.querySelector('span').textContent;
                    const div = document.createElement('div');
                    div.className = 'bg-purple-50 border border-purple-200 rounded-lg p-3 flex items-center';
                    div.innerHTML = `
                        <span class="text-2xl mr-2">üéñÔ∏è</span>
                        <span class="text-sm font-medium">${qualText}</span>
                    `;
                    qualificationsList.appendChild(div);
                });
                // Ë≥áÊ†º„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„Åø„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
                const qualSection = document.getElementById('preview-qualifications');
                if (qualSection) {
                    qualSection.style.display = qualificationsList.children.length > 0 ? 'block' : 'none';
                }
            }

            // ‰øùÈô∫„ÇíË°®Á§∫
            const insuranceList = document.getElementById('insuranceList');
            if (insuranceList) {
                insuranceList.innerHTML = '';
                // „ÉÅ„Çß„ÉÉ„ÇØ„Åï„Çå„Åü‰øùÈô∫„ÇíÂèñÂæó
                const checkedInsurance = companySection.querySelectorAll('input[name="insurance"]:checked');
                checkedInsurance.forEach(ins => {
                    const div = document.createElement('div');
                    div.className = 'bg-indigo-50 border border-indigo-200 rounded-lg p-3 flex items-center';
                    div.innerHTML = `
                        <span class="text-2xl mr-2">üõ°Ô∏è</span>
                        <span class="text-sm font-medium">${ins.value}</span>
                    `;
                    insuranceList.appendChild(div);
                });
                // „Ç´„Çπ„Çø„É†‰øùÈô∫„ÇíËøΩÂä†
                const customInsurance = document.querySelectorAll('#customInsuranceList > div');
                customInsurance.forEach(ins => {
                    const insText = ins.querySelector('span').textContent;
                    const div = document.createElement('div');
                    div.className = 'bg-indigo-50 border border-indigo-200 rounded-lg p-3 flex items-center';
                    div.innerHTML = `
                        <span class="text-2xl mr-2">üõ°Ô∏è</span>
                        <span class="text-sm font-medium">${insText}</span>
                    `;
                    insuranceList.appendChild(div);
                });
                // ‰øùÈô∫„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„Åø„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
                const insSection = document.getElementById('preview-insurance');
                if (insSection) {
                    insSection.style.display = insuranceList.children.length > 0 ? 'block' : 'none';
                }
            }

            // „É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
            document.getElementById('companyPreviewModal').classList.remove('hidden');

            // „Éâ„É©„ÉÉ„Ç∞Ê©üËÉΩ„ÇíÂàùÊúüÂåñ
            setTimeout(initImageDrag, 100);

            // Google„Éû„ÉÉ„Éó„ÇíË™≠„ÅøËæº„Åø
            setTimeout(loadGoogleMap, 200);

            // ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„Å®ÊñΩÂ∑•‰∫ã‰æã„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
            updateGalleryDisplay();
            updateConstructionExamplesDisplay();
            updateReviewsList();
        }

        // „Éó„É¨„Éì„É•„Éº„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closePreviewModal() {
            document.getElementById('companyPreviewModal').classList.add('hidden');
        }

        // „Éó„É¨„Éì„É•„ÉºË®≠ÂÆö„Éë„Éç„É´„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
        function togglePreviewSettings() {
            const settings = document.getElementById('previewSettings');
            settings.classList.toggle('hidden');
        }

        // „Éó„É¨„Éì„É•„Éº„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
        function togglePreviewSection(sectionName) {
            const section = document.getElementById('preview-' + sectionName);
            if (section) {
                section.classList.toggle('hidden');
            }

            // ‰ºöÁ§æÊ¶ÇË¶Å„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÄÅË©≥Á¥∞Ë®≠ÂÆö„ÅÆË°®Á§∫„ÇÇÂàá„ÇäÊõø„Åà
            if (sectionName === 'basicInfo') {
                const detailSettings = document.getElementById('basicInfoDetailSettings');
                if (detailSettings) {
                    if (section && section.classList.contains('hidden')) {
                        detailSettings.style.display = 'none';
                    } else {
                        detailSettings.style.display = 'block';
                    }
                }
            }
        }

        // ‰ºöÁ§æÊ¶ÇË¶Å„ÅÆÂÄãÂà•„Éï„Ç£„Éº„É´„Éâ„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
        function toggleBasicInfoField(fieldName) {
            const field = document.getElementById('basicInfo-' + fieldName);
            if (field) {
                field.classList.toggle('hidden');
            }
        }

        // ÁØâÂπ¥Êï∞ÁØÑÂõ≤„ÅÆÊõ¥Êñ∞Ôºà‰ºöÁ§æÊÉÖÂ†±Áî®Ôºâ
        function updateAgeRange() {
            const minSlider = document.querySelector('#companySection input[type="range"][min="0"][max="50"]');
            const maxSlider = document.querySelector('#companySection input[type="range"][min="0"][max="100"]');
            if (minSlider && maxSlider) {
                const minElement = document.getElementById('ageRangeMin');
                const maxElement = document.getElementById('ageRangeMax');
                if (minElement) minElement.textContent = minSlider.value;
                if (maxElement) maxElement.textContent = maxSlider.value;
            }
        }

        // ÁØâÂπ¥Êï∞ÁØÑÂõ≤„ÅÆÊõ¥Êñ∞ÔºàËá™ÂãïÈÖç‰ø°Ë®≠ÂÆöÁî®Ôºâ
        function updateAgeRangeAuto() {
            const minSlider = document.querySelector('#autodeliverySection input[type="range"][min="0"][max="50"]');
            const maxSlider = document.querySelector('#autodeliverySection input[type="range"][min="0"][max="100"]');
            if (minSlider && maxSlider) {
                const minValue = parseInt(minSlider.value);
                const maxValue = parseInt(maxSlider.value);

                // ‰∏ãÈôê„Åå‰∏äÈôê„ÇíË∂Ö„Åà„ÅüÂ†¥Âêà„ÄÅ‰∏äÈôê„Çí‰∏ãÈôê„Å´Âêà„Çè„Åõ„Çã
                if (minValue > maxValue) {
                    maxSlider.value = minValue;
                }

                // ‰∏äÈôê„Åå‰∏ãÈôê„Çí‰∏ãÂõû„Å£„ÅüÂ†¥Âêà„ÄÅ‰∏ãÈôê„Çí‰∏äÈôê„Å´Âêà„Çè„Åõ„Çã
                if (maxValue < minValue) {
                    minSlider.value = maxValue;
                }

                const minElement = document.getElementById('ageRangeMinAuto');
                const maxElement = document.getElementById('ageRangeMaxAuto');
                if (minElement) minElement.textContent = minSlider.value;
                if (maxElement) maxElement.textContent = maxSlider.value;
            }
        }

        // „Çµ„Éº„Éì„Çπ„Ç´„Éº„Éâ„ÅÆÂàá„ÇäÊõø„Åà
        function toggleServiceCard(element) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            const card = element.querySelector('div');

            if (checkbox.checked) {
                checkbox.checked = false;
                card.classList.remove('border-blue-500', 'bg-blue-50');
            } else {
                checkbox.checked = true;
                card.classList.add('border-blue-500', 'bg-blue-50');
            }
        }

        // Êàª„Çã„Éú„Çø„É≥
        function goBack() {
            showSection('dashboard');
        }

        // Ë°®Á§∫„ÉªÈùûË°®Á§∫„ÅÆÂàá„ÇäÊõø„Åà
        function toggleVisibility(button) {
            const icon = button.querySelector('svg');
            const parent = button.closest('.border');

            if (parent.classList.contains('opacity-50')) {
                parent.classList.remove('opacity-50');
                icon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                `;
            } else {
                parent.classList.add('opacity-50');
                icon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>
                `;
            }
        }

        // „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂá¶ÁêÜÔºà„Éó„É¨„Éì„É•„Éº„ÅÆ„Åø„ÄÅ‰øùÂ≠ò„ÅØÂæå„ÅßÔºâ
        let mainVisualData = null;
        let mainVisualFileName = null;
        let mainVisualUrl = null;
        function handleMainVisualUpload(event) {
            const file = event.target.files[0];
            if (file) {
                mainVisualFileName = file.name;
                const reader = new FileReader();
                reader.onload = function(e) {
                    mainVisualData = e.target.result;
                    // „Éó„É¨„Éì„É•„ÉºË°®Á§∫„ÅÆ„Åø
                    document.getElementById('mainVisualImage').src = mainVisualData;
                    document.getElementById('mainVisualPreview').classList.remove('hidden');
                    document.getElementById('mainVisualPlaceholder').classList.add('hidden');
                    console.log('[handleMainVisualUpload] Image ready for upload on save');
                };
                reader.readAsDataURL(file);
            }
        }

        // „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´ÂâäÈô§
        function removeMainVisual() {
            mainVisualData = null;
            document.getElementById('mainVisualPreview').classList.add('hidden');
            document.getElementById('mainVisualPlaceholder').classList.remove('hidden');
            document.getElementById('mainVisualInput').value = '';
        }

        // ÁîªÂÉè‰ΩçÁΩÆË™øÊï¥
        let imagePositionX = 50;
        let imagePositionY = 50;
        let currentZoom = 100;

        function adjustImagePosition(position) {
            const image = document.getElementById('previewMainVisual');
            if (image) {
                switch(position) {
                    case 'top':
                        imagePositionY = 0;
                        break;
                    case 'center':
                        imagePositionX = 50;
                        imagePositionY = 50;
                        break;
                    case 'bottom':
                        imagePositionY = 100;
                        break;
                }
                updateImagePosition();
            }
        }

        function updateImagePosition() {
            const image = document.getElementById('previewMainVisual');
            if (image) {
                image.style.objectPosition = `${imagePositionX}% ${imagePositionY}%`;
            }
        }

        // „Éâ„É©„ÉÉ„Ç∞„ÅßÁîªÂÉè‰ΩçÁΩÆ„ÇíË™øÊï¥
        let isDragging = false;
        let startX, startY;
        let startPosX, startPosY;

        function initImageDrag() {
            const container = document.getElementById('mainVisualContainer');
            const image = document.getElementById('previewMainVisual');

            if (!container || !image) return;

            // Êó¢Â≠ò„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂâäÈô§
            const newContainer = container.cloneNode(true);
            container.parentNode.replaceChild(newContainer, container);

            newContainer.addEventListener('mousedown', (e) => {
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                startPosX = imagePositionX;
                startPosY = imagePositionY;
                newContainer.style.cursor = 'grabbing';
                e.preventDefault();
            });

            // mousemove„Å®mouseup„Ç§„Éô„É≥„Éà„ÅØ‰∏ÄÂ∫¶„Å†„ÅëËøΩÂä†
            if (!window.imageDragListenersAdded) {
                window.imageDragListenersAdded = true;

                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;

                    const containerRect = document.getElementById('mainVisualContainer')?.getBoundingClientRect();
                    if (!containerRect) return;

                    // „Éû„Ç¶„Çπ„ÅÆÁßªÂãïÈáè„ÇíË®àÁÆó
                    const deltaX = (e.clientX - startX) / containerRect.width * 100;
                    const deltaY = (e.clientY - startY) / containerRect.height * 100;

                    // Ê®™ÊñπÂêë„ÅÆÁßªÂãïÔºàÊÑüÂ∫¶„ÇíË™øÊï¥„Åó„Å¶ÁßªÂãï„Åó„ÇÑ„Åô„Åè„Åô„ÇãÔºâ
                    const sensitivityX = 1.0;
                    imagePositionX = Math.max(0, Math.min(100, startPosX - deltaX * sensitivityX));

                    // Á∏¶ÊñπÂêë„ÅÆÁßªÂãï
                    const sensitivityY = 1.0;
                    imagePositionY = Math.max(0, Math.min(100, startPosY - deltaY * sensitivityY));

                    updateImagePosition();
                });

                document.addEventListener('mouseup', () => {
                    if (isDragging) {
                        isDragging = false;
                        const newContainer = document.getElementById('mainVisualContainer');
                        if (newContainer) newContainer.style.cursor = 'move';
                    }
                });
            }
        }

        // ÁîªÂÉè„Ç∫„Éº„É†Ë™øÊï¥
        function adjustImageZoom(value) {
            const image = document.getElementById('previewMainVisual');
            if (image) {
                currentZoom = parseInt(value);
                const scale = currentZoom / 100;
                image.style.transform = `scale(${scale})`;
                // „Ç∫„Éº„É†Â§âÊõ¥Âæå„ÇÇ‰ΩçÁΩÆ„ÅØÁ∂≠ÊåÅ
            }
        }

        // ÁîªÂÉèÊòéÂ∫¶Ë™øÊï¥
        function adjustImageOpacity(value) {
            const overlay = document.querySelector('#mainVisualSection .absolute.inset-0');
            if (overlay) {
                const opacity = (100 - value) / 100;
                overlay.style.background = `linear-gradient(to bottom, transparent, transparent, rgba(0,0,0,${opacity * 0.5}))`;
            }
        }

        // ÁîªÂÉèË™øÊï¥„Éë„Éç„É´„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
        function toggleImageControls() {
            const controls = document.getElementById('visualControls');
            if (controls) {
                controls.classList.toggle('hidden');
            }
        }

        // „ÇÆ„É£„É©„É™„ÉºÁîªÂÉèÈÖçÂàó
        let galleryImages = [];
        let galleryFilesToUpload = []; // ‰øùÂ≠ò„Éú„Çø„É≥Êäº‰∏ãÊôÇ„Å´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åô„Çã„Éï„Ç°„Ç§„É´

        // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóË®≠ÂÆö
        function setupGalleryDragDrop() {
            const galleryList = document.getElementById('photoGalleryList');
            if (!galleryList) return;

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                galleryList.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                galleryList.addEventListener(eventName, () => {
                    galleryList.classList.add('border-blue-500', 'bg-blue-50');
                }, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                galleryList.addEventListener(eventName, () => {
                    galleryList.classList.remove('border-blue-500', 'bg-blue-50');
                }, false);
            });

            galleryList.addEventListener('drop', (e) => {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleGalleryFiles(files);
            }, false);
        }

        // „Éï„Ç°„Ç§„É´Âá¶ÁêÜ„ÇíÂÖ±ÈÄöÂåñ
        function handleGalleryFiles(files) {
            const galleryList = document.getElementById('photoGalleryList');
            const currentImages = galleryList.querySelectorAll('.gallery-item').length;

            if (currentImages >= 20) {
                showNotification('ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº‰∏äÈôê', 'ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„ÅØÊúÄÂ§ß20Êûö„Åæ„Åß„Åß„Åô„ÄÇ„Åì„Çå‰ª•‰∏äËøΩÂä†„Åß„Åç„Åæ„Åõ„Çì„ÄÇ', 'error');
                return;
            }

            const remainingSlots = 20 - currentImages;
            const filesToAdd = Array.from(files).slice(0, remainingSlots);

            if (files.length > remainingSlots) {
                showNotification('ÂÜôÁúü„ÇÆ„É£„É©„É™„ÉºÂà∂Èôê', `ÊÆã„Çä${remainingSlots}Êûö„Åæ„ÅßËøΩÂä†ÂèØËÉΩ„Åß„Åô„ÄÇÊúÄÂàù„ÅÆ${remainingSlots}Êûö„ÅÆ„ÅøËøΩÂä†„Åó„Åæ„Åô„ÄÇ`, 'warning');
            }

            filesToAdd.forEach(file => {
                if (file && file.type.startsWith('image/')) {
                    const imageId = 'gallery_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    const localUrl = URL.createObjectURL(file);
                    const addButton = galleryList.querySelector('.border-dashed');

                    const imageDiv = document.createElement('div');
                    imageDiv.className = 'relative group gallery-item';
                    imageDiv.id = imageId;
                    imageDiv.innerHTML = `
                        <img src="${localUrl}" class="w-full h-24 object-cover rounded-lg" alt="${file.name}">
                        <button type="button" onclick="removeGalleryImage('${imageId}')" class="absolute top-1 right-1 bg-red-500 text-white p-1 rounded opacity-0 group-hover:opacity-100 transition">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    `;

                    galleryList.insertBefore(imageDiv, addButton);

                    const reader = new FileReader();
                    reader.onload = function(e) {
                        galleryFilesToUpload.push({
                            id: imageId,
                            base64Data: e.target.result,
                            fileName: file.name
                        });
                        console.log('[handleGalleryFiles] File ready for upload on save:', file.name);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // „ÇÆ„É£„É©„É™„ÉºÁîªÂÉèËøΩÂä†Ôºà„Éó„É¨„Éì„É•„Éº„ÅÆ„Åø„ÄÅ‰øùÂ≠ò„ÅØÂæå„ÅßÔºâ
        function handleGalleryUpload(event) {
            handleGalleryFiles(event.target.files);
            event.target.value = '';
        }


        // „ÇÆ„É£„É©„É™„Éº„Éá„Éº„Çø„Çí‰øùÂ≠ò
        async function saveGalleryData() {
            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: JSON.stringify({
                        action: 'saveGalleryData',
                        merchantId: window.merchantId,
                        galleryData: galleryImages
                    })
                });

                const result = await response.json();
                if (!result.success) {
                    console.error('„ÇÆ„É£„É©„É™„Éº‰øùÂ≠ò„Ç®„É©„Éº:', result.error);
                }
            } catch (error) {
                console.error('„ÇÆ„É£„É©„É™„Éº‰øùÂ≠òÈÄö‰ø°„Ç®„É©„Éº:', error);
            }
        }

        // „ÇÆ„É£„É©„É™„ÉºÁîªÂÉè„ÇíÂâäÈô§
        function removeGalleryImage(imageId) {
            const element = document.getElementById(imageId);
            if (element) {
                element.remove();
                galleryImages = galleryImages.filter(img => img.id !== imageId);
                showNotification('ÂâäÈô§ÂÆå‰∫Ü', '„ÇÆ„É£„É©„É™„ÉºÁîªÂÉè„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
                updateGalleryPreview();
            }
        }

        // „Ç´„É´„Éº„Çª„É´ÁÆ°ÁêÜÂ§âÊï∞
        let currentGalleryIndex = 0;
        let currentExampleIndex = 0;

        // „Éó„É¨„Éì„É•„Éº„ÅÆ„ÇÆ„É£„É©„É™„Éº„ÇíÊõ¥Êñ∞Ôºà„Ç´„É´„Éº„Çª„É´ÂºèÔºâ
        function updateGalleryPreview() {
            const previewGalleryList = document.getElementById('previewGalleryList');
            const indicators = document.getElementById('galleryIndicators');

            if (previewGalleryList && galleryImages.length > 0) {
                // ÁÑ°Èôê„É´„Éº„ÉóÁî®„Å´Ë§áË£Ω„Çí‰ΩúÊàê
                const extendedImages = [...galleryImages, ...galleryImages, ...galleryImages];

                previewGalleryList.innerHTML = extendedImages.map((img, index) => `
                    <div class="flex-shrink-0 w-72 aspect-square overflow-hidden rounded-lg cursor-pointer" onclick="openImageModal('${img.src}', '${img.name || '„ÇÆ„É£„É©„É™„ÉºÁîªÂÉè'}')">
                        <img src="${img.src}" alt="${img.name}" class="w-full h-full object-cover hover:scale-110 transition-transform duration-300">
                    </div>
                `).join('');

                // „Ç§„É≥„Ç∏„Ç±„Éº„Çø„ÉºÁîüÊàê
                if (indicators) {
                    indicators.innerHTML = galleryImages.map((_, index) => `
                        <button onclick="goToGalleryImage(${index})" class="w-2 h-2 rounded-full transition ${index === currentGalleryIndex % galleryImages.length ? 'bg-blue-600' : 'bg-gray-300'}"></button>
                    `).join('');
                }

                document.getElementById('preview-gallery').style.display = 'block';
                currentGalleryIndex = galleryImages.length; // ÁÑ°Èôê„É´„Éº„Éó„ÅÆ‰∏≠Â§Æ„Åã„ÇâÈñãÂßã
                updateGalleryCarouselPosition();
            } else {
                document.getElementById('preview-gallery').style.display = 'none';
            }
        }

        // „ÇÆ„É£„É©„É™„Éº„Ç´„É´„Éº„Çª„É´„Çπ„ÇØ„É≠„Éº„É´
        function scrollGallery(direction) {
            if (galleryImages.length === 0) return;

            if (direction === 'left') {
                currentGalleryIndex--;
            } else {
                currentGalleryIndex++;
            }

            updateGalleryCarouselPosition();
        }

        // ÁâπÂÆö„ÅÆ„ÇÆ„É£„É©„É™„ÉºÁîªÂÉè„Å∏ÁßªÂãï
        function goToGalleryImage(index) {
            currentGalleryIndex = index + galleryImages.length;
            updateGalleryCarouselPosition();
        }

        // „ÇÆ„É£„É©„É™„Éº„Ç´„É´„Éº„Çª„É´‰ΩçÁΩÆÊõ¥Êñ∞
        function updateGalleryCarouselPosition() {
            const carousel = document.getElementById('previewGalleryList');
            const indicators = document.getElementById('galleryIndicators');

            if (carousel && galleryImages.length > 0) {
                const cardWidth = 288 + 16; // w-72 (18rem) + gap-4 (1rem)
                const offset = galleryImages.length * cardWidth;

                // ÁÑ°Èôê„É´„Éº„Éó„ÅÆ„Åü„ÇÅ„ÅÆ‰ΩçÁΩÆË™øÊï¥
                const position = -currentGalleryIndex * cardWidth - offset;
                carousel.style.transform = `translateX(${position}px)`;

                // „Çπ„É†„Éº„Ç∫„Å™ÁÑ°Èôê„É´„Éº„Éó
                if (currentGalleryIndex < 0) {
                    setTimeout(() => {
                        carousel.style.transition = 'none';
                        currentGalleryIndex = galleryImages.length - 1;
                        const newPosition = -currentGalleryIndex * cardWidth - offset;
                        carousel.style.transform = `translateX(${newPosition}px)`;
                        setTimeout(() => {
                            carousel.style.transition = 'transform 300ms';
                        }, 50);
                    }, 300);
                } else if (currentGalleryIndex >= galleryImages.length * 2) {
                    setTimeout(() => {
                        carousel.style.transition = 'none';
                        currentGalleryIndex = galleryImages.length;
                        const newPosition = -currentGalleryIndex * cardWidth - offset;
                        carousel.style.transform = `translateX(${newPosition}px)`;
                        setTimeout(() => {
                            carousel.style.transition = 'transform 300ms';
                        }, 50);
                    }, 300);
                }

                // „Ç§„É≥„Ç∏„Ç±„Éº„Çø„ÉºÊõ¥Êñ∞
                if (indicators) {
                    const actualIndex = ((currentGalleryIndex % galleryImages.length) + galleryImages.length) % galleryImages.length;
                    indicators.querySelectorAll('button').forEach((btn, index) => {
                        btn.className = `w-2 h-2 rounded-full transition ${index === actualIndex ? 'bg-blue-600' : 'bg-gray-300'}`;
                    });
                }
            }
        }

        // ÊñΩÂ∑•‰∫ã‰æãÈÖçÂàó
        let constructionExamples = [];
        let exampleIdCounter = 0;

        // ÊñΩÂ∑•‰∫ã‰æã„ÇíËøΩÂä†
        function addConstructionExample() {
            const exampleId = 'example_' + (++exampleIdCounter);
            const examplesList = document.getElementById('constructionExamplesList');

            const newExample = {
                id: exampleId,
                title: '',
                buildingAge: '',
                content: '',
                price: '',
                beforeImage: null,
                afterImage: null
            };
            constructionExamples.push(newExample);

            const exampleDiv = document.createElement('div');
            exampleDiv.className = 'border rounded-lg p-4';
            exampleDiv.id = exampleId;
            exampleDiv.innerHTML = `
                <input type="text" class="w-full px-3 py-2 border rounded mb-2" placeholder="ÊñΩÂ∑•„Çø„Ç§„Éà„É´Ôºà‰æãÔºöÊà∏Âª∫„Å¶Â§ñÂ£ÅÂ°óË£ÖÔºâ" onchange="updateConstructionExample('${exampleId}', 'title', this.value)">
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <div>
                        <label class="text-xs text-gray-600 mb-1 block">ÁØâÂπ¥Êï∞</label>
                        <div class="flex items-center">
                            <input type="number" class="w-full px-3 py-2 border rounded" placeholder="15" min="0" max="100" onchange="updateConstructionExample('${exampleId}', 'buildingAge', this.value)">
                            <span class="ml-2 text-sm text-gray-600">Âπ¥</span>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs text-gray-600 mb-1 block">ÊñΩÂ∑•ÈáëÈ°çÔºà‰∏áÂÜÜÔºâ</label>
                        <div class="flex items-center">
                            <input type="number" class="w-full px-3 py-2 border rounded" placeholder="150" min="0" onchange="updateConstructionExample('${exampleId}', 'price', this.value)">
                            <span class="ml-2 text-sm text-gray-600">‰∏áÂÜÜ</span>
                        </div>
                    </div>
                </div>
                <textarea class="w-full px-3 py-2 border rounded mb-2" rows="2" placeholder="ÊñΩÂ∑•ÂÜÖÂÆπÔºà‰æãÔºö„Ç∑„É™„Ç≥„É≥Â°óÊñô„Å´„Çà„Çã3ÂõûÂ°ó„Çä„ÄÅËâ≤Ë§™„Åõ„Å®Ê±ö„Çå„ÇíËß£Ê∂àÔºâ" onchange="updateConstructionExample('${exampleId}', 'content', this.value)"></textarea>

                <!-- „Éì„Éï„Ç©„Éº„Ç¢„Éï„Çø„ÉºÁîªÂÉè -->
                <div class="grid grid-cols-2 gap-4 mb-2">
                    <div>
                        <label class="text-xs font-semibold text-gray-600 mb-1 block">ÊñΩÂ∑•ÂâçÔºàBeforeÔºâ</label>
                        <input type="file" id="beforeImage_${exampleId}" accept="image/*" style="display: none;" onchange="handleExampleImage('${exampleId}', 'before', event)">
                        <div id="beforePreview_${exampleId}" class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer hover:border-blue-500" onclick="document.getElementById('beforeImage_${exampleId}').click()">
                            <svg class="w-8 h-8 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span class="text-xs text-gray-500">„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÁîªÂÉè„ÇíÈÅ∏Êäû</span>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs font-semibold text-gray-600 mb-1 block">ÊñΩÂ∑•ÂæåÔºàAfterÔºâ</label>
                        <input type="file" id="afterImage_${exampleId}" accept="image/*" style="display: none;" onchange="handleExampleImage('${exampleId}', 'after', event)">
                        <div id="afterPreview_${exampleId}" class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer hover:border-blue-500" onclick="document.getElementById('afterImage_${exampleId}').click()">
                            <svg class="w-8 h-8 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span class="text-xs text-gray-500">„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÁîªÂÉè„ÇíÈÅ∏Êäû</span>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end">
                    <button onclick="removeConstructionExample('${exampleId}')" class="text-red-600 hover:text-red-800 text-sm">
                        <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                        „Åì„ÅÆ‰∫ã‰æã„ÇíÂâäÈô§
                    </button>
                </div>
            `;

            examplesList.appendChild(exampleDiv);
            showNotification('ËøΩÂä†ÂÆå‰∫Ü', 'ÊñΩÂ∑•‰∫ã‰æã„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü');
        }

        // ÊñΩÂ∑•‰∫ã‰æã„ÇíÊõ¥Êñ∞
        function updateConstructionExample(exampleId, field, value) {
            const example = constructionExamples.find(e => e.id === exampleId);
            if (example) {
                example[field] = value;
                updateExamplesPreview();
            }
        }

        // ÊñΩÂ∑•‰∫ã‰æã„ÅÆÁîªÂÉè„ÇíÂá¶ÁêÜ
        function handleExampleImage(exampleId, type, event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const example = constructionExamples.find(ex => ex.id === exampleId);
                    if (example) {
                        if (type === 'before') {
                            example.beforeImage = e.target.result;
                            // „Éó„É¨„Éì„É•„Éº„ÇíÁîªÂÉè„Å´ÁΩÆ„ÅçÊèõ„Åà
                            const preview = document.getElementById(`beforePreview_${exampleId}`);
                            if (preview) {
                                preview.innerHTML = `<img src="${e.target.result}" class="w-full h-32 object-cover rounded" alt="ÊñΩÂ∑•Ââç">`;
                            }
                        } else {
                            example.afterImage = e.target.result;
                            // „Éó„É¨„Éì„É•„Éº„ÇíÁîªÂÉè„Å´ÁΩÆ„ÅçÊèõ„Åà
                            const preview = document.getElementById(`afterPreview_${exampleId}`);
                            if (preview) {
                                preview.innerHTML = `<img src="${e.target.result}" class="w-full h-32 object-cover rounded" alt="ÊñΩÂ∑•Âæå">`;
                            }
                        }
                        updateExamplesPreview();
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        // ÊñΩÂ∑•‰∫ã‰æã„ÇíÂâäÈô§
        function removeConstructionExample(exampleId) {
            const element = document.getElementById(exampleId);
            if (element) {
                element.remove();
                constructionExamples = constructionExamples.filter(e => e.id !== exampleId);
                showNotification('ÂâäÈô§ÂÆå‰∫Ü', 'ÊñΩÂ∑•‰∫ã‰æã„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
                updateExamplesPreview();
            }
        }

        // „Éó„É¨„Éì„É•„Éº„ÅÆÊñΩÂ∑•‰∫ã‰æã„ÇíÊõ¥Êñ∞Ôºà„Ç´„É´„Éº„Çª„É´ÂºèÔºâ
        function updateExamplesPreview() {
            const previewExamplesList = document.getElementById('previewExamplesList');
            const indicators = document.getElementById('examplesIndicators');

            if (previewExamplesList) {
                const validExamples = constructionExamples.filter(e => (e.title || e.content) && (e.beforeImage || e.afterImage));

                if (validExamples.length > 0) {
                    // ÁÑ°Èôê„É´„Éº„ÉóÁî®„Å´Ë§áË£Ω„Çí‰ΩúÊàê
                    const extendedExamples = [...validExamples, ...validExamples, ...validExamples];

                    previewExamplesList.innerHTML = extendedExamples.map(example => `
                        <div class="flex-shrink-0 w-full md:w-96 bg-white rounded-lg shadow-lg border overflow-hidden">
                            <div class="relative">
                                ${(example.beforeImage && example.afterImage) ? `
                                    <!-- „Éì„Éï„Ç©„Éº„Ç¢„Éï„Çø„ÉºÊØîËºÉ -->
                                    <div class="grid grid-cols-2 relative">
                                        <div class="relative cursor-pointer" onclick="openImageModal('${example.beforeImage}', 'ÊñΩÂ∑•Ââç')">
                                            <img src="${example.beforeImage}" alt="ÊñΩÂ∑•Ââç" class="w-full h-48 object-cover hover:opacity-90 transition">
                                            <div class="absolute top-2 left-2 bg-black bg-opacity-60 text-white px-2 py-1 text-xs rounded">
                                                BEFORE
                                            </div>
                                        </div>
                                        <div class="relative cursor-pointer" onclick="openImageModal('${example.afterImage}', 'ÊñΩÂ∑•Âæå')">
                                            <img src="${example.afterImage}" alt="ÊñΩÂ∑•Âæå" class="w-full h-48 object-cover hover:opacity-90 transition">
                                            <div class="absolute top-2 left-2 bg-blue-600 bg-opacity-90 text-white px-2 py-1 text-xs rounded">
                                                AFTER
                                            </div>
                                        </div>
                                    </div>
                                ` : (example.beforeImage || example.afterImage) ? `
                                    <!-- ÁâáÊñπ„ÅÆ„Åø„ÅÆÁîªÂÉè -->
                                    <div class="relative cursor-pointer" onclick="openImageModal('${example.beforeImage || example.afterImage}', '${example.beforeImage ? 'ÊñΩÂ∑•Ââç' : 'ÊñΩÂ∑•Âæå'}')">
                                        <img src="${example.beforeImage || example.afterImage}" alt="${example.beforeImage ? 'ÊñΩÂ∑•Ââç' : 'ÊñΩÂ∑•Âæå'}" class="w-full h-48 object-cover hover:opacity-90 transition">
                                    </div>
                                ` : ''}
                            </div>
                            <div class="p-4">
                                <div class="flex items-start justify-between mb-2">
                                    <h4 class="font-semibold text-gray-900">${example.title ? `${example.buildingAge ? `ÁØâ${example.buildingAge}Âπ¥ ` : ''}${example.title}` : 'ÊñΩÂ∑•‰∫ã‰æã'}</h4>
                                    ${example.price ? `
                                        <div class="text-right">
                                            <div class="text-xs font-medium text-gray-500">Â∑•‰∫ãÈáëÈ°ç</div>
                                            <span class="inline-block text-red-600 font-bold text-lg">
                                                ${Number(example.price).toLocaleString()}‰∏áÂÜÜ
                                            </span>
                                        </div>
                                    ` : ''}
                                </div>
                                <p class="text-sm text-gray-600">${example.content || 'Ë©≥Á¥∞ÊÉÖÂ†±'}</p>
                            </div>
                        </div>
                    `).join('');

                    // „Ç§„É≥„Ç∏„Ç±„Éº„Çø„ÉºÁîüÊàê
                    if (indicators) {
                        indicators.innerHTML = validExamples.map((_, index) => `
                            <button onclick="goToExample(${index})" class="w-2 h-2 rounded-full transition ${index === currentExampleIndex % validExamples.length ? 'bg-blue-600' : 'bg-gray-300'}"></button>
                        `).join('');
                    }

                    document.getElementById('preview-examples').style.display = 'block';
                    currentExampleIndex = validExamples.length;
                    updateExamplesCarouselPosition();
                } else {
                    document.getElementById('preview-examples').style.display = 'none';
                }
            }
        }

        // ÊñΩÂ∑•‰∫ã‰æã„Ç´„É´„Éº„Çª„É´„Çπ„ÇØ„É≠„Éº„É´
        function scrollExamples(direction) {
            const validExamples = constructionExamples.filter(e => (e.title || e.content) && (e.beforeImage || e.afterImage));
            if (validExamples.length === 0) return;

            if (direction === 'left') {
                currentExampleIndex--;
            } else {
                currentExampleIndex++;
            }

            updateExamplesCarouselPosition();
        }

        // ÁâπÂÆö„ÅÆÊñΩÂ∑•‰∫ã‰æã„Å∏ÁßªÂãï
        function goToExample(index) {
            const validExamples = constructionExamples.filter(e => (e.title || e.content) && (e.beforeImage || e.afterImage));
            currentExampleIndex = index + validExamples.length;
            updateExamplesCarouselPosition();
        }

        // ÊñΩÂ∑•‰∫ã‰æã„Ç´„É´„Éº„Çª„É´‰ΩçÁΩÆÊõ¥Êñ∞
        function updateExamplesCarouselPosition() {
            const carousel = document.getElementById('previewExamplesList');
            const indicators = document.getElementById('examplesIndicators');
            const validExamples = constructionExamples.filter(e => (e.title || e.content) && (e.beforeImage || e.afterImage));

            if (carousel && validExamples.length > 0) {
                const cardWidth = carousel.firstElementChild ? carousel.firstElementChild.offsetWidth + 16 : 400;
                const offset = validExamples.length * cardWidth;

                // ÁÑ°Èôê„É´„Éº„Éó„ÅÆ„Åü„ÇÅ„ÅÆ‰ΩçÁΩÆË™øÊï¥
                const position = -currentExampleIndex * cardWidth - offset;
                carousel.style.transform = `translateX(${position}px)`;

                // „Çπ„É†„Éº„Ç∫„Å™ÁÑ°Èôê„É´„Éº„Éó
                if (currentExampleIndex < 0) {
                    setTimeout(() => {
                        carousel.style.transition = 'none';
                        currentExampleIndex = validExamples.length - 1;
                        const newPosition = -currentExampleIndex * cardWidth - offset;
                        carousel.style.transform = `translateX(${newPosition}px)`;
                        setTimeout(() => {
                            carousel.style.transition = 'transform 300ms';
                        }, 50);
                    }, 300);
                } else if (currentExampleIndex >= validExamples.length * 2) {
                    setTimeout(() => {
                        carousel.style.transition = 'none';
                        currentExampleIndex = validExamples.length;
                        const newPosition = -currentExampleIndex * cardWidth - offset;
                        carousel.style.transform = `translateX(${newPosition}px)`;
                        setTimeout(() => {
                            carousel.style.transition = 'transform 300ms';
                        }, 50);
                    }, 300);
                }

                // „Ç§„É≥„Ç∏„Ç±„Éº„Çø„ÉºÊõ¥Êñ∞
                if (indicators) {
                    const actualIndex = ((currentExampleIndex % validExamples.length) + validExamples.length) % validExamples.length;
                    indicators.querySelectorAll('button').forEach((btn, index) => {
                        btn.className = `w-2 h-2 rounded-full transition ${index === actualIndex ? 'bg-blue-600' : 'bg-gray-300'}`;
                    });
                }
            }
        }

        // „Ç®„É™„Ç¢ÈÅ∏ÊäûÈñ¢ÈÄ£Èñ¢Êï∞
        const areaSelectionData = {
            prefectures: [],
            cities: {},
            priorities: [],
            totalCount: 0
        };
        const maxPrefectures = 5;
        const maxPriorityAreas = 3;

        // ÈÉΩÈÅìÂ∫úÁúå„É™„Çπ„Éà
        const allPrefectures = [
            'ÂåóÊµ∑ÈÅì', 'ÈùíÊ£ÆÁúå', 'Â≤©ÊâãÁúå', 'ÂÆÆÂüéÁúå', 'ÁßãÁî∞Áúå', 'Â±±ÂΩ¢Áúå', 'Á¶èÂ≥∂Áúå',
            'Ëå®ÂüéÁúå', 'Ê†ÉÊú®Áúå', 'Áæ§È¶¨Áúå', 'ÂüºÁéâÁúå', 'ÂçÉËëâÁúå', 'Êù±‰∫¨ÈÉΩ', 'Á•ûÂ•àÂ∑ùÁúå',
            'Êñ∞ÊΩüÁúå', 'ÂØåÂ±±Áúå', 'Áü≥Â∑ùÁúå', 'Á¶è‰∫ïÁúå', 'Â±±Ê¢®Áúå', 'Èï∑ÈáéÁúå', 'Â≤êÈòúÁúå',
            'ÈùôÂ≤°Áúå', 'ÊÑõÁü•Áúå', '‰∏âÈáçÁúå', 'ÊªãË≥ÄÁúå', '‰∫¨ÈÉΩÂ∫ú', 'Â§ßÈò™Â∫ú', 'ÂÖµÂ∫´Áúå',
            'Â•àËâØÁúå', 'ÂíåÊ≠åÂ±±Áúå', 'È≥•ÂèñÁúå', 'Â≥∂Ê†πÁúå', 'Â≤°Â±±Áúå', 'Â∫ÉÂ≥∂Áúå', 'Â±±Âè£Áúå',
            'Âæ≥Â≥∂Áúå', 'È¶ôÂ∑ùÁúå', 'ÊÑõÂ™õÁúå', 'È´òÁü•Áúå', 'Á¶èÂ≤°Áúå', '‰ΩêË≥ÄÁúå', 'Èï∑Â¥éÁúå',
            'ÁÜäÊú¨Áúå', 'Â§ßÂàÜÁúå', 'ÂÆÆÂ¥éÁúå', 'ÈπøÂÖêÂ≥∂Áúå', 'Ê≤ñÁ∏ÑÁúå'
        ];

        // Â∏ÇÂå∫Áî∫Êùë„Éá„Éº„Çø„Éô„Éº„Çπ
        // Â∏ÇÂå∫Áî∫Êùë„Éá„Éº„Çø„Éô„Éº„ÇπÔºà‰∏ªË¶Å11ÈÉΩÂ∫úÁúå„ÅÆÂÆåÂÖ®„Éá„Éº„ÇøÔºâ
        const cityDatabase = {
            'Êù±‰∫¨ÈÉΩ': [
                'ÂçÉ‰ª£Áî∞Âå∫', '‰∏≠Â§ÆÂå∫', 'Ê∏ØÂå∫', 'Êñ∞ÂÆøÂå∫', 'Êñá‰∫¨Âå∫', 'Âè∞Êù±Âå∫',
                'Â¢®Áî∞Âå∫', 'Ê±üÊù±Âå∫', 'ÂìÅÂ∑ùÂå∫', 'ÁõÆÈªíÂå∫', 'Â§ßÁî∞Âå∫', '‰∏ñÁî∞Ë∞∑Âå∫',
                'Ê∏ãË∞∑Âå∫', '‰∏≠ÈáéÂå∫', 'Êùâ‰∏¶Âå∫', 'Ë±äÂ≥∂Âå∫', 'ÂåóÂå∫', 'ËçíÂ∑ùÂå∫',
                'ÊùøÊ©ãÂå∫', 'Á∑¥È¶¨Âå∫', 'Ë∂≥Á´ãÂå∫', 'ËëõÈ£æÂå∫', 'Ê±üÊà∏Â∑ùÂå∫',
                'ÂÖ´ÁéãÂ≠êÂ∏Ç', 'Á´ãÂ∑ùÂ∏Ç', 'Ê≠¶ËîµÈáéÂ∏Ç', '‰∏âÈ∑πÂ∏Ç', 'ÈùíÊ¢ÖÂ∏Ç', 'Â∫ú‰∏≠Â∏Ç',
                'Êò≠Â≥∂Â∏Ç', 'Ë™øÂ∏ÉÂ∏Ç', 'Áî∫Áî∞Â∏Ç', 'Â∞èÈáë‰∫ïÂ∏Ç', 'Â∞èÂπ≥Â∏Ç', 'Êó•ÈáéÂ∏Ç',
                'Êù±ÊùëÂ±±Â∏Ç', 'ÂõΩÂàÜÂØ∫Â∏Ç', 'ÂõΩÁ´ãÂ∏Ç', 'Á¶èÁîüÂ∏Ç', 'ÁãõÊ±üÂ∏Ç', 'Êù±Â§ßÂíåÂ∏Ç',
                'Ê∏ÖÁÄ¨Â∏Ç', 'Êù±‰πÖÁïôÁ±≥Â∏Ç', 'Ê≠¶ËîµÊùëÂ±±Â∏Ç', 'Â§öÊë©Â∏Ç', 'Á®≤ÂüéÂ∏Ç', 'ÁæΩÊùëÂ∏Ç',
                '„ÅÇ„Åç„ÇãÈáéÂ∏Ç', 'Ë•øÊù±‰∫¨Â∏Ç', 'ÁëûÁ©ÇÁî∫', 'Êó•„ÅÆÂá∫Áî∫', 'Ê™úÂéüÊùë', 'Â••Â§öÊë©Áî∫'
            ],
            'Á•ûÂ•àÂ∑ùÁúå': [
                'Ê®™ÊµúÂ∏ÇÈ∂¥Ë¶ãÂå∫', 'Ê®™ÊµúÂ∏ÇÁ•ûÂ•àÂ∑ùÂå∫', 'Ê®™ÊµúÂ∏ÇË•øÂå∫', 'Ê®™ÊµúÂ∏Ç‰∏≠Âå∫',
                'Ê®™ÊµúÂ∏ÇÂçóÂå∫', 'Ê®™ÊµúÂ∏Ç‰øùÂúü„Ç±Ë∞∑Âå∫', 'Ê®™ÊµúÂ∏ÇÁ£ØÂ≠êÂå∫', 'Ê®™ÊµúÂ∏ÇÈáëÊ≤¢Âå∫',
                'Ê®™ÊµúÂ∏ÇÊ∏ØÂåóÂå∫', 'Ê®™ÊµúÂ∏ÇÊà∏Â°öÂå∫', 'Ê®™ÊµúÂ∏ÇÊ∏ØÂçóÂå∫', 'Ê®™ÊµúÂ∏ÇÊó≠Âå∫',
                'Ê®™ÊµúÂ∏ÇÁ∑ëÂå∫', 'Ê®™ÊµúÂ∏ÇÁÄ¨Ë∞∑Âå∫', 'Ê®™ÊµúÂ∏ÇÊ†ÑÂå∫', 'Ê®™ÊµúÂ∏ÇÊ≥âÂå∫',
                'Ê®™ÊµúÂ∏ÇÈùíËëâÂå∫', 'Ê®™ÊµúÂ∏ÇÈÉΩÁ≠ëÂå∫', 'Â∑ùÂ¥éÂ∏ÇÂ∑ùÂ¥éÂå∫', 'Â∑ùÂ¥éÂ∏ÇÂπ∏Âå∫',
                'Â∑ùÂ¥éÂ∏Ç‰∏≠ÂéüÂå∫', 'Â∑ùÂ¥éÂ∏ÇÈ´òÊ¥•Âå∫', 'Â∑ùÂ¥éÂ∏ÇÂ§öÊë©Âå∫', 'Â∑ùÂ¥éÂ∏ÇÂÆÆÂâçÂå∫',
                'Â∑ùÂ¥éÂ∏ÇÈ∫ªÁîüÂå∫', 'Áõ∏Ê®°ÂéüÂ∏ÇÁ∑ëÂå∫', 'Áõ∏Ê®°ÂéüÂ∏Ç‰∏≠Â§ÆÂå∫', 'Áõ∏Ê®°ÂéüÂ∏ÇÂçóÂå∫',
                'Ê®™È†àË≥ÄÂ∏Ç', 'Âπ≥Â°öÂ∏Ç', 'ÈéåÂÄâÂ∏Ç', 'Ëó§Ê≤¢Â∏Ç', 'Â∞èÁî∞ÂéüÂ∏Ç', 'ËåÖ„É∂Â¥éÂ∏Ç',
                'ÈÄóÂ≠êÂ∏Ç', '‰∏âÊµ¶Â∏Ç', 'Áß¶ÈáéÂ∏Ç', 'ÂéöÊú®Â∏Ç', 'Â§ßÂíåÂ∏Ç', '‰ºäÂã¢ÂéüÂ∏Ç',
                'Êµ∑ËÄÅÂêçÂ∏Ç', 'Â∫ßÈñìÂ∏Ç', 'ÂçóË∂≥ÊüÑÂ∏Ç', 'Á∂æÁÄ¨Â∏Ç'
            ],
            'ÂüºÁéâÁúå': [
                '„Åï„ÅÑ„Åü„ÅæÂ∏ÇË•øÂå∫', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂåóÂå∫', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂ§ßÂÆÆÂå∫', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇË¶ãÊ≤ºÂå∫',
                '„Åï„ÅÑ„Åü„ÅæÂ∏Ç‰∏≠Â§ÆÂå∫', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÊ°úÂå∫', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÊµ¶ÂíåÂå∫', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂçóÂå∫',
                '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÁ∑ëÂå∫', '„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂ≤©ÊßªÂå∫', 'Â∑ùË∂äÂ∏Ç', 'ÁÜäË∞∑Â∏Ç', 'Â∑ùÂè£Â∏Ç',
                'Ë°åÁî∞Â∏Ç', 'Áß©Áà∂Â∏Ç', 'ÊâÄÊ≤¢Â∏Ç', 'È£ØËÉΩÂ∏Ç', 'Âä†È†àÂ∏Ç', 'Êú¨Â∫ÑÂ∏Ç',
                'Êù±ÊùæÂ±±Â∏Ç', 'Êò•Êó•ÈÉ®Â∏Ç', 'Áã≠Â±±Â∏Ç', 'ÁæΩÁîüÂ∏Ç', 'È¥ªÂ∑£Â∏Ç', 'Ê∑±Ë∞∑Â∏Ç',
                '‰∏äÂ∞æÂ∏Ç', 'ËçâÂä†Â∏Ç', 'Ë∂äË∞∑Â∏Ç', 'Ëï®Â∏Ç', 'Êà∏Áî∞Â∏Ç', 'ÂÖ•ÈñìÂ∏Ç',
                'ÊúùÈúûÂ∏Ç', 'ÂøóÊú®Â∏Ç', 'ÂíåÂÖâÂ∏Ç', 'Êñ∞Â∫ßÂ∏Ç', 'Ê°∂Â∑ùÂ∏Ç', '‰πÖÂñúÂ∏Ç',
                'ÂåóÊú¨Â∏Ç', 'ÂÖ´ÊΩÆÂ∏Ç', 'ÂØåÂ£´Ë¶ãÂ∏Ç', '‰∏âÈÉ∑Â∏Ç', 'ËìÆÁî∞Â∏Ç', 'ÂùÇÊà∏Â∏Ç',
                'Âπ∏ÊâãÂ∏Ç', 'È∂¥„É∂Â≥∂Â∏Ç', 'Êó•È´òÂ∏Ç', 'ÂêâÂ∑ùÂ∏Ç', '„Åµ„Åò„ÅøÈáéÂ∏Ç', 'ÁôΩÂ≤°Â∏Ç'
            ],
            'ÂçÉËëâÁúå': [
                'ÂçÉËëâÂ∏Ç‰∏≠Â§ÆÂå∫', 'ÂçÉËëâÂ∏ÇËä±Ë¶ãÂ∑ùÂå∫', 'ÂçÉËëâÂ∏ÇÁ®≤ÊØõÂå∫', 'ÂçÉËëâÂ∏ÇËã•ËëâÂå∫',
                'ÂçÉËëâÂ∏ÇÁ∑ëÂå∫', 'ÂçÉËëâÂ∏ÇÁæéÊµúÂå∫', 'ÈäöÂ≠êÂ∏Ç', 'Â∏ÇÂ∑ùÂ∏Ç', 'ËàπÊ©ãÂ∏Ç',
                'È§®Â±±Â∏Ç', 'Êú®Êõ¥Ê¥•Â∏Ç', 'ÊùæÊà∏Â∏Ç', 'ÈáéÁî∞Â∏Ç', 'ËåÇÂéüÂ∏Ç', 'ÊàêÁî∞Â∏Ç',
                '‰ΩêÂÄâÂ∏Ç', 'Êù±ÈáëÂ∏Ç', 'Êó≠Â∏Ç', 'ÁøíÂøóÈáéÂ∏Ç', 'ÊüèÂ∏Ç', 'ÂãùÊµ¶Â∏Ç',
                'Â∏ÇÂéüÂ∏Ç', 'ÊµÅÂ±±Â∏Ç', 'ÂÖ´ÂçÉ‰ª£Â∏Ç', 'ÊàëÂ≠´Â≠êÂ∏Ç', 'È¥®Â∑ùÂ∏Ç', 'Èéå„Ç±Ë∞∑Â∏Ç',
                'ÂêõÊ¥•Â∏Ç', 'ÂØåÊ¥•Â∏Ç', 'Êµ¶ÂÆâÂ∏Ç', 'ÂõõË°óÈÅìÂ∏Ç', 'Ë¢ñ„Ç±Êµ¶Â∏Ç', 'ÂÖ´Ë°óÂ∏Ç',
                'Âç∞Ë•øÂ∏Ç', 'ÁôΩ‰∫ïÂ∏Ç', 'ÂØåÈáåÂ∏Ç', 'ÂçóÊàøÁ∑èÂ∏Ç', 'ÂåùÁë≥Â∏Ç', 'È¶ôÂèñÂ∏Ç',
                'Â±±Ê≠¶Â∏Ç', '„ÅÑ„Åô„ÅøÂ∏Ç', 'Â§ßÁ∂≤ÁôΩÈáåÂ∏Ç'
            ],
            'Â≤êÈòúÁúå': [
                'Â≤êÈòúÂ∏Ç', 'Â§ßÂû£Â∏Ç', 'È´òÂ±±Â∏Ç', 'Â§öÊ≤ªË¶ãÂ∏Ç', 'Èñ¢Â∏Ç', '‰∏≠Ê¥•Â∑ùÂ∏Ç',
                'ÁæéÊøÉÂ∏Ç', 'ÁëûÊµ™Â∏Ç', 'ÁæΩÂ≥∂Â∏Ç', 'ÊÅµÈÇ£Â∏Ç', 'ÁæéÊøÉÂä†ËåÇÂ∏Ç', 'ÂúüÂ≤êÂ∏Ç',
                'ÂêÑÂãôÂéüÂ∏Ç', 'ÂèØÂÖêÂ∏Ç', 'Â±±ÁúåÂ∏Ç', 'ÁëûÁ©ÇÂ∏Ç', 'È£õÈ®®Â∏Ç', 'Êú¨Â∑£Â∏Ç',
                'ÈÉ°‰∏äÂ∏Ç', '‰∏ãÂëÇÂ∏Ç', 'Êµ∑Ê¥•Â∏Ç'
            ],
            'ÊÑõÁü•Áúå': [
                'ÂêçÂè§Â±ãÂ∏ÇÂçÉÁ®ÆÂå∫', 'ÂêçÂè§Â±ãÂ∏ÇÊù±Âå∫', 'ÂêçÂè§Â±ãÂ∏ÇÂåóÂå∫', 'ÂêçÂè§Â±ãÂ∏ÇË•øÂå∫',
                'ÂêçÂè§Â±ãÂ∏Ç‰∏≠ÊùëÂå∫', 'ÂêçÂè§Â±ãÂ∏Ç‰∏≠Âå∫', 'ÂêçÂè§Â±ãÂ∏ÇÊò≠ÂíåÂå∫', 'ÂêçÂè§Â±ãÂ∏ÇÁëûÁ©ÇÂå∫',
                'ÂêçÂè§Â±ãÂ∏ÇÁÜ±Áî∞Âå∫', 'ÂêçÂè§Â±ãÂ∏Ç‰∏≠Â∑ùÂå∫', 'ÂêçÂè§Â±ãÂ∏ÇÊ∏ØÂå∫', 'ÂêçÂè§Â±ãÂ∏ÇÂçóÂå∫',
                'ÂêçÂè§Â±ãÂ∏ÇÂÆàÂ±±Âå∫', 'ÂêçÂè§Â±ãÂ∏ÇÁ∑ëÂå∫', 'ÂêçÂè§Â±ãÂ∏ÇÂêçÊù±Âå∫', 'ÂêçÂè§Â±ãÂ∏ÇÂ§©ÁôΩÂå∫',
                'Ë±äÊ©ãÂ∏Ç', 'Â≤°Â¥éÂ∏Ç', '‰∏ÄÂÆÆÂ∏Ç', 'ÁÄ¨Êà∏Â∏Ç', 'ÂçäÁî∞Â∏Ç', 'Êò•Êó•‰∫ïÂ∏Ç',
                'Ë±äÂ∑ùÂ∏Ç', 'Ê¥•Â≥∂Â∏Ç', 'Á¢ßÂçóÂ∏Ç', 'ÂààË∞∑Â∏Ç', 'Ë±äÁî∞Â∏Ç', 'ÂÆâÂüéÂ∏Ç',
                'Ë•øÂ∞æÂ∏Ç', 'Ëí≤ÈÉ°Â∏Ç', 'Áä¨Â±±Â∏Ç', 'Â∏∏ÊªëÂ∏Ç', 'Ê±üÂçóÂ∏Ç', 'Â∞èÁâßÂ∏Ç',
                'Á®≤Ê≤¢Â∏Ç', 'Êñ∞ÂüéÂ∏Ç', 'Êù±Êµ∑Â∏Ç', 'Â§ßÂ∫úÂ∏Ç', 'Áü•Â§öÂ∏Ç', 'Áü•Á´ãÂ∏Ç',
                'Â∞æÂºµÊó≠Â∏Ç', 'È´òÊµúÂ∏Ç', 'Â≤©ÂÄâÂ∏Ç', 'Ë±äÊòéÂ∏Ç', 'Êó•ÈÄ≤Â∏Ç', 'Áî∞ÂéüÂ∏Ç',
                'ÊÑõË•øÂ∏Ç', 'Ê∏ÖÈ†àÂ∏Ç', 'ÂåóÂêçÂè§Â±ãÂ∏Ç', 'Âº•ÂØåÂ∏Ç', '„Åø„Çà„ÅóÂ∏Ç', '„ÅÇ„ÅæÂ∏Ç',
                'Èï∑‰πÖÊâãÂ∏Ç'
            ],
            'Â§ßÈò™Â∫ú': [
                'Â§ßÈò™Â∏ÇÈÉΩÂ≥∂Âå∫', 'Â§ßÈò™Â∏ÇÁ¶èÂ≥∂Âå∫', 'Â§ßÈò™Â∏ÇÊ≠§Ëä±Âå∫', 'Â§ßÈò™Â∏ÇË•øÂå∫',
                'Â§ßÈò™Â∏ÇÊ∏ØÂå∫', 'Â§ßÈò™Â∏ÇÂ§ßÊ≠£Âå∫', 'Â§ßÈò™Â∏ÇÂ§©ÁéãÂØ∫Âå∫', 'Â§ßÈò™Â∏ÇÊµ™ÈÄüÂå∫',
                'Â§ßÈò™Â∏ÇË•øÊ∑ÄÂ∑ùÂå∫', 'Â§ßÈò™Â∏ÇÊù±Ê∑ÄÂ∑ùÂå∫', 'Â§ßÈò™Â∏ÇÊù±ÊàêÂå∫', 'Â§ßÈò™Â∏ÇÁîüÈáéÂå∫',
                'Â§ßÈò™Â∏ÇÊó≠Âå∫', 'Â§ßÈò™Â∏ÇÂüéÊù±Âå∫', 'Â§ßÈò™Â∏ÇÈòøÂÄçÈáéÂå∫', 'Â§ßÈò™Â∏Ç‰ΩèÂêâÂå∫',
                'Â§ßÈò™Â∏ÇÊù±‰ΩèÂêâÂå∫', 'Â§ßÈò™Â∏ÇË•øÊàêÂå∫', 'Â§ßÈò™Â∏ÇÊ∑ÄÂ∑ùÂå∫', 'Â§ßÈò™Â∏ÇÈ∂¥Ë¶ãÂå∫',
                'Â§ßÈò™Â∏Ç‰Ωè‰πãÊ±üÂå∫', 'Â§ßÈò™Â∏ÇÂπ≥ÈáéÂå∫', 'Â§ßÈò™Â∏ÇÂåóÂå∫', 'Â§ßÈò™Â∏Ç‰∏≠Â§ÆÂå∫',
                'Â†∫Â∏ÇÂ†∫Âå∫', 'Â†∫Â∏Ç‰∏≠Âå∫', 'Â†∫Â∏ÇÊù±Âå∫', 'Â†∫Â∏ÇË•øÂå∫', 'Â†∫Â∏ÇÂçóÂå∫',
                'Â†∫Â∏ÇÂåóÂå∫', 'Â†∫Â∏ÇÁæéÂéüÂå∫', 'Â≤∏ÂíåÁî∞Â∏Ç', 'Ë±ä‰∏≠Â∏Ç', 'Ê±†Áî∞Â∏Ç',
                'ÂêπÁî∞Â∏Ç', 'Ê≥âÂ§ßÊ¥•Â∏Ç', 'È´òÊßªÂ∏Ç', 'Ë≤ùÂ°öÂ∏Ç', 'ÂÆàÂè£Â∏Ç', 'ÊûöÊñπÂ∏Ç',
                'Ëå®Êú®Â∏Ç', 'ÂÖ´Â∞æÂ∏Ç', 'Ê≥â‰ΩêÈáéÂ∏Ç', 'ÂØåÁî∞ÊûóÂ∏Ç', 'ÂØùÂ±ãÂ∑ùÂ∏Ç', 'Ê≤≥ÂÜÖÈï∑ÈáéÂ∏Ç',
                'ÊùæÂéüÂ∏Ç', 'Â§ßÊù±Â∏Ç', 'ÂíåÊ≥âÂ∏Ç', 'ÁÆïÈù¢Â∏Ç', 'ÊüèÂéüÂ∏Ç', 'ÁæΩÊõ≥ÈáéÂ∏Ç',
                'ÈñÄÁúüÂ∏Ç', 'ÊëÇÊ¥•Â∏Ç', 'È´òÁü≥Â∏Ç', 'Ëó§‰∫ïÂØ∫Â∏Ç', 'Êù±Â§ßÈò™Â∏Ç', 'Ê≥âÂçóÂ∏Ç',
                'ÂõõÊ¢ùÁï∑Â∏Ç', '‰∫§ÈáéÂ∏Ç', 'Â§ßÈò™Áã≠Â±±Â∏Ç', 'Èò™ÂçóÂ∏Ç'
            ],
            '‰∫¨ÈÉΩÂ∫ú': [
                '‰∫¨ÈÉΩÂ∏ÇÂåóÂå∫', '‰∫¨ÈÉΩÂ∏Ç‰∏ä‰∫¨Âå∫', '‰∫¨ÈÉΩÂ∏ÇÂ∑¶‰∫¨Âå∫', '‰∫¨ÈÉΩÂ∏Ç‰∏≠‰∫¨Âå∫',
                '‰∫¨ÈÉΩÂ∏ÇÊù±Â±±Âå∫', '‰∫¨ÈÉΩÂ∏Ç‰∏ã‰∫¨Âå∫', '‰∫¨ÈÉΩÂ∏ÇÂçóÂå∫', '‰∫¨ÈÉΩÂ∏ÇÂè≥‰∫¨Âå∫',
                '‰∫¨ÈÉΩÂ∏Ç‰ºèË¶ãÂå∫', '‰∫¨ÈÉΩÂ∏ÇÂ±±ÁßëÂå∫', '‰∫¨ÈÉΩÂ∏ÇË•ø‰∫¨Âå∫', 'Á¶èÁü•Â±±Â∏Ç',
                'ËàûÈ∂¥Â∏Ç', 'Á∂æÈÉ®Â∏Ç', 'ÂÆáÊ≤ªÂ∏Ç', 'ÂÆÆÊ¥•Â∏Ç', '‰∫ÄÂ≤°Â∏Ç', 'ÂüéÈôΩÂ∏Ç',
                'ÂêëÊó•Â∏Ç', 'Èï∑Â≤°‰∫¨Â∏Ç', 'ÂÖ´Âπ°Â∏Ç', '‰∫¨Áî∞Ëæ∫Â∏Ç', '‰∫¨‰∏πÂæåÂ∏Ç', 'Âçó‰∏πÂ∏Ç',
                'Êú®Ê¥•Â∑ùÂ∏Ç'
            ],
            'ÂÖµÂ∫´Áúå': [
                'Á•ûÊà∏Â∏ÇÊù±ÁÅòÂå∫', 'Á•ûÊà∏Â∏ÇÁÅòÂå∫', 'Á•ûÊà∏Â∏ÇÂÖµÂ∫´Âå∫', 'Á•ûÊà∏Â∏ÇÈï∑Áî∞Âå∫',
                'Á•ûÊà∏Â∏ÇÈ†àÁ£®Âå∫', 'Á•ûÊà∏Â∏ÇÂûÇÊ∞¥Âå∫', 'Á•ûÊà∏Â∏ÇÂåóÂå∫', 'Á•ûÊà∏Â∏Ç‰∏≠Â§ÆÂå∫',
                'Á•ûÊà∏Â∏ÇË•øÂå∫', 'Âß´Ë∑ØÂ∏Ç', 'Â∞ºÂ¥éÂ∏Ç', 'ÊòéÁü≥Â∏Ç', 'Ë•øÂÆÆÂ∏Ç', 'Ê¥≤Êú¨Â∏Ç',
                'Ëä¶Â±ãÂ∏Ç', '‰ºä‰∏πÂ∏Ç', 'Áõ∏ÁîüÂ∏Ç', 'Ë±äÂ≤°Â∏Ç', 'Âä†Âè§Â∑ùÂ∏Ç', 'Ëµ§Á©ÇÂ∏Ç',
                'Ë•øËÑáÂ∏Ç', 'ÂÆùÂ°öÂ∏Ç', '‰∏âÊú®Â∏Ç', 'È´òÁ†ÇÂ∏Ç', 'Â∑ùË•øÂ∏Ç', 'Â∞èÈáéÂ∏Ç',
                '‰∏âÁî∞Â∏Ç', 'Âä†Ë•øÂ∏Ç', '‰∏πÊ≥¢ÁØ†Â±±Â∏Ç', 'È§äÁà∂Â∏Ç', '‰∏πÊ≥¢Â∏Ç', 'Âçó„ÅÇ„Çè„ÅòÂ∏Ç',
                'ÊúùÊù•Â∏Ç', 'Ê∑°Ë∑ØÂ∏Ç', 'ÂÆçÁ≤üÂ∏Ç', 'Âä†Êù±Â∏Ç', '„Åü„Å§„ÅÆÂ∏Ç'
            ],
            'Â•àËâØÁúå': [
                'Â•àËâØÂ∏Ç', 'Â§ßÂíåÈ´òÁî∞Â∏Ç', 'Â§ßÂíåÈÉ°Â±±Â∏Ç', 'Â§©ÁêÜÂ∏Ç', 'Ê©øÂéüÂ∏Ç', 'Ê°ú‰∫ïÂ∏Ç',
                '‰∫îÊ¢ùÂ∏Ç', 'Âæ°ÊâÄÂ∏Ç', 'ÁîüÈßíÂ∏Ç', 'È¶ôËäùÂ∏Ç', 'ËëõÂüéÂ∏Ç', 'ÂÆáÈôÄÂ∏Ç'
            ],
            'ÊÑõÂ™õÁúå': [
                'ÊùæÂ±±Â∏Ç', '‰ªäÊ≤ªÂ∏Ç', 'ÂÆáÂíåÂ≥∂Â∏Ç', 'ÂÖ´Âπ°ÊµúÂ∏Ç', 'Êñ∞Â±ÖÊµúÂ∏Ç', 'Ë•øÊù°Â∏Ç',
                'Â§ßÊ¥≤Â∏Ç', '‰ºä‰∫àÂ∏Ç', 'ÂõõÂõΩ‰∏≠Â§ÆÂ∏Ç', 'Ë•ø‰∫àÂ∏Ç', 'Êù±Ê∏©Â∏Ç'
            ]
        };

        // „Éá„Éï„Ç©„É´„Éà„ÅÆÂ∏ÇÂå∫Áî∫Êùë„É™„Çπ„ÉàÔºà‰∏ªË¶Å10Â∏ÇÔºâ- Âä†ÁõüÂ∫óÁôªÈå≤„Ç∑„Çπ„ÉÜ„É†„Å®ÂêåÊúü
        const defaultCities = {
            'ÂåóÊµ∑ÈÅì': ['Êú≠ÂπåÂ∏Ç', 'ÂáΩÈ§®Â∏Ç', 'Â∞èÊ®ΩÂ∏Ç', 'Êó≠Â∑ùÂ∏Ç', 'ÂÆ§Ëò≠Â∏Ç', 'ÈáßË∑ØÂ∏Ç', 'Â∏ØÂ∫ÉÂ∏Ç', 'ÂåóË¶ãÂ∏Ç', 'Â§ïÂºµÂ∏Ç', 'Â≤©Ë¶ãÊ≤¢Â∏Ç'],
            'ÈùíÊ£ÆÁúå': ['ÈùíÊ£ÆÂ∏Ç', 'ÂºòÂâçÂ∏Ç', 'ÂÖ´Êà∏Â∏Ç', 'ÈªíÁü≥Â∏Ç', '‰∫îÊâÄÂ∑ùÂéüÂ∏Ç', 'ÂçÅÂíåÁî∞Â∏Ç', '‰∏âÊ≤¢Â∏Ç', '„ÇÄ„Å§Â∏Ç', '„Å§„Åå„ÇãÂ∏Ç', 'Âπ≥Â∑ùÂ∏Ç'],
            'Â≤©ÊâãÁúå': ['ÁõõÂ≤°Â∏Ç', 'ÂÆÆÂè§Â∏Ç', 'Â§ßËàπÊ∏°Â∏Ç', 'Ëä±Â∑ªÂ∏Ç', 'Âåó‰∏äÂ∏Ç', '‰πÖÊÖàÂ∏Ç', 'ÈÅ†ÈáéÂ∏Ç', '‰∏ÄÈñ¢Â∏Ç', 'Èô∏ÂâçÈ´òÁî∞Â∏Ç', 'ÈáúÁü≥Â∏Ç'],
            'ÂÆÆÂüéÁúå': ['‰ªôÂè∞Â∏ÇÈùíËëâÂå∫', '‰ªôÂè∞Â∏ÇÂÆÆÂüéÈáéÂå∫', '‰ªôÂè∞Â∏ÇËã•ÊûóÂå∫', '‰ªôÂè∞Â∏ÇÂ§™ÁôΩÂå∫', '‰ªôÂè∞Â∏ÇÊ≥âÂå∫', 'Áü≥Â∑ªÂ∏Ç', 'Â°©Á´àÂ∏Ç', 'Ê∞ó‰ªôÊ≤ºÂ∏Ç', 'ÁôΩÁü≥Â∏Ç', 'ÂêçÂèñÂ∏Ç'],
            'ÁßãÁî∞Áúå': ['ÁßãÁî∞Â∏Ç', 'ËÉΩ‰ª£Â∏Ç', 'Ê®™ÊâãÂ∏Ç', 'Â§ßÈ§®Â∏Ç', 'Áî∑ÈπøÂ∏Ç', 'ÊπØÊ≤¢Â∏Ç', 'ÈπøËßíÂ∏Ç', 'Áî±Âà©Êú¨ËçòÂ∏Ç', 'ÊΩü‰∏äÂ∏Ç', 'Â§ß‰ªôÂ∏Ç'],
            'Â±±ÂΩ¢Áúå': ['Â±±ÂΩ¢Â∏Ç', 'Á±≥Ê≤¢Â∏Ç', 'È∂¥Â≤°Â∏Ç', 'ÈÖíÁî∞Â∏Ç', 'Êñ∞Â∫ÑÂ∏Ç', 'ÂØíÊ≤≥Ê±üÂ∏Ç', '‰∏äÂ±±Â∏Ç', 'ÊùëÂ±±Â∏Ç', 'Èï∑‰∫ïÂ∏Ç', 'Â§©Á´•Â∏Ç'],
            'Á¶èÂ≥∂Áúå': ['Á¶èÂ≥∂Â∏Ç', '‰ºöÊ¥•Ëã•ÊùæÂ∏Ç', 'ÈÉ°Â±±Â∏Ç', '„ÅÑ„Çè„ÅçÂ∏Ç', 'ÁôΩÊ≤≥Â∏Ç', 'È†àË≥ÄÂ∑ùÂ∏Ç', 'ÂñúÂ§öÊñπÂ∏Ç', 'Áõ∏È¶¨Â∏Ç', '‰∫åÊú¨ÊùæÂ∏Ç', 'Áî∞ÊùëÂ∏Ç']
        };

        // Â∏ÇÂå∫Áî∫Êùë„ÅÆÂèñÂæóÔºàÂä†ÁõüÂ∫óÁôªÈå≤„Ç∑„Çπ„ÉÜ„É†„Å®Âêå„Åò„É≠„Ç∏„ÉÉ„ÇØÔºâ
        function getCitiesForPrefecture(prefecture) {
            // „Åæ„ÅöÂÆåÂÖ®„Éá„Éº„Çø„ÇíÁ¢∫Ë™ç
            if (cityDatabase[prefecture]) {
                return cityDatabase[prefecture];
            }
            // „Éá„Éï„Ç©„É´„Éà„ÅÆ‰∏ªË¶Å10Â∏Ç„ÇíËøî„Åô
            if (defaultCities[prefecture]) {
                return defaultCities[prefecture];
            }
            // Ë©≤ÂΩì„Å™„Åó„ÅÆÂ†¥Âêà„ÅØ„ÄåÂÖ®Âüü„Äç
            return ['ÂÖ®Âüü'];
        }

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´ÈÉΩÈÅìÂ∫úÁúå„Éú„Çø„É≥„ÇíÁîüÊàê
        document.addEventListener('DOMContentLoaded', function() {
            initializeAreaSelection();
        });

        // „Ç®„É™„Ç¢ÈÅ∏Êäû„ÇíÂàùÊúüÂåñ
        function initializeAreaSelection() {
            const grid = document.getElementById('allPrefecturesGrid');
            if (!grid) return;

            grid.innerHTML = allPrefectures.map(pref => `
                <button class="area-item p-2 bg-white border rounded-lg cursor-pointer hover:bg-blue-50 transition-colors text-sm"
                        data-prefecture="${pref}"
                        onclick="togglePrefecture('${pref}')">
                    ${pref}
                </button>
            `).join('');
        }

        // ÈÉΩÈÅìÂ∫úÁúåÈÅ∏Êäû„Éà„Ç∞„É´
        function togglePrefecture(prefecture) {
            const button = document.querySelector(`[data-prefecture="${prefecture}"]`);
            const isSelected = button.classList.contains('selected');

            if (isSelected) {
                // ÈÅ∏ÊäûËß£Èô§
                button.classList.remove('selected', 'bg-blue-500', 'text-white');
                button.classList.add('bg-white');
                areaSelectionData.prefectures = areaSelectionData.prefectures.filter(p => p !== prefecture);
                delete areaSelectionData.cities[prefecture];
                areaSelectionData.priorities = areaSelectionData.priorities.filter(p => !p.startsWith(prefecture));
            } else {
                // ÈÅ∏Êäû‰∏äÈôê„ÉÅ„Çß„ÉÉ„ÇØ
                if (areaSelectionData.prefectures.length >= maxPrefectures) {
                    showNotification('‰∏äÈôê„ÇíË∂Ö„Åà„Åæ„Åó„Åü', `ÈÉΩÈÅìÂ∫úÁúå„ÅØÊúÄÂ§ß${maxPrefectures}„Å§„Åæ„ÅßÈÅ∏ÊäûÂèØËÉΩ„Åß„Åô`);
                    return;
                }
                // ÈÅ∏ÊäûËøΩÂä†
                button.classList.add('selected', 'bg-blue-500', 'text-white');
                button.classList.remove('bg-white');
                areaSelectionData.prefectures.push(prefecture);
                // „Éá„Éï„Ç©„É´„Éà„ÅßÂÖ®Â∏ÇÂå∫Áî∫Êùë„ÇíÈÅ∏Êäû
                areaSelectionData.cities[prefecture] = getCitiesForPrefecture(prefecture);
            }

            updateAreaSelectionUI();
        }

        // „Ç®„É™„Ç¢ÈÅ∏ÊäûUIÊõ¥Êñ∞
        function updateAreaSelectionUI() {
            // „Ç´„Ç¶„É≥„ÉàÊõ¥Êñ∞
            const prefCountEl = document.getElementById('selectedPrefCount');
            const cityCountEl = document.getElementById('selectedCityCount');

            if (prefCountEl) {
                prefCountEl.textContent = areaSelectionData.prefectures.length;
            }

            const totalCities = Object.values(areaSelectionData.cities).reduce((sum, cities) => sum + cities.length, 0);
            if (cityCountEl) {
                cityCountEl.textContent = totalCities;
            }
            areaSelectionData.totalCount = totalCities;

            // Â∏ÇÂå∫Áî∫ÊùëÈÅ∏Êäû„Ç®„É™„Ç¢„ÅÆË°®Á§∫/ÈùûË°®Á§∫
            const cityArea = document.getElementById('citySelectionArea');
            if (cityArea) {
                if (areaSelectionData.prefectures.length > 0) {
                    cityArea.classList.remove('hidden');
                    updateCitySelectionArea();
                } else {
                    cityArea.classList.add('hidden');
                }
            }

            // ÂÑ™ÂÖà„Ç®„É™„Ç¢Ë®≠ÂÆö„ÅÆË°®Á§∫/ÈùûË°®Á§∫
            const priorityArea = document.getElementById('priorityArea');
            if (priorityArea) {
                if (totalCities > 0) {
                    priorityArea.classList.remove('hidden');
                    updatePriorityArea();
                } else {
                    priorityArea.classList.add('hidden');
                }
            }

            // Á¢∫Ë™ç„Éú„Çø„É≥„ÅÆÊúâÂäπ/ÁÑ°Âäπ
            const confirmBtn = document.getElementById('areaConfirmBtn');
            if (confirmBtn) {
                confirmBtn.disabled = areaSelectionData.prefectures.length === 0;
            }
        }

        // Â∏ÇÂå∫Áî∫ÊùëÈÅ∏Êäû„Ç®„É™„Ç¢Êõ¥Êñ∞
        function updateCitySelectionArea() {
            const cityContainer = document.getElementById('cityListContainer');
            if (!cityContainer) return;

            cityContainer.innerHTML = areaSelectionData.prefectures.map(prefecture => {
                const allCities = getCitiesForPrefecture(prefecture);
                const selectedCities = areaSelectionData.cities[prefecture] || [];

                return `
                    <div class="border rounded-lg p-4">
                        <div class="mb-3">
                            <div class="flex justify-between items-center mb-2">
                                <h5 class="font-medium text-lg">${prefecture}</h5>
                                <span class="text-sm text-gray-600">
                                    ${selectedCities.length} / ${allCities.length} ÈÅ∏Êäû‰∏≠
                                </span>
                            </div>
                            <label class="flex items-center cursor-pointer hover:bg-gray-50 p-1 rounded">
                                <input type="checkbox"
                                       ${selectedCities.length === allCities.length ? 'checked' : ''}
                                       onchange="toggleAllCities('${prefecture}', this.checked)">
                                <span class="ml-2 text-sm font-medium">„Åô„Åπ„Å¶ÈÅ∏Êäû</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                            ${allCities.map(city => `
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox"
                                           value="${city}"
                                           ${selectedCities.includes(city) ? 'checked' : ''}
                                           onchange="toggleCity('${prefecture}', '${city}', this.checked)">
                                    <span class="ml-2 text-sm">${city}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Â∏ÇÂå∫Áî∫ÊùëÈÅ∏Êäû„Éà„Ç∞„É´
        function toggleCity(prefecture, city, checked) {
            if (!areaSelectionData.cities[prefecture]) {
                areaSelectionData.cities[prefecture] = [];
            }

            if (checked) {
                if (!areaSelectionData.cities[prefecture].includes(city)) {
                    areaSelectionData.cities[prefecture].push(city);
                }
            } else {
                areaSelectionData.cities[prefecture] = areaSelectionData.cities[prefecture].filter(c => c !== city);
                // ÂÑ™ÂÖà„Ç®„É™„Ç¢„Åã„Çâ„ÇÇÂâäÈô§
                const priorityKey = `${prefecture}_${city}`;
                areaSelectionData.priorities = areaSelectionData.priorities.filter(p => p !== priorityKey);
            }

            updateAreaSelectionUI();
        }

        // ÂÖ®Â∏ÇÂå∫Áî∫ÊùëÈÅ∏ÊäûÂàá„ÇäÊõø„Åà
        function toggleAllCities(prefecture, checked) {
            const allCities = getCitiesForPrefecture(prefecture);

            if (checked) {
                areaSelectionData.cities[prefecture] = [...allCities];
            } else {
                areaSelectionData.cities[prefecture] = [];
                // ÂÑ™ÂÖà„Ç®„É™„Ç¢„Åã„Çâ„ÇÇÂâäÈô§
                areaSelectionData.priorities = areaSelectionData.priorities.filter(
                    p => !p.startsWith(prefecture + '_')
                );
            }

            updateCitySelectionArea();
            updateAreaSelectionUI();
        }

        // ÂÑ™ÂÖà„Ç®„É™„Ç¢Êõ¥Êñ∞
        function updatePriorityArea() {
            const listContainer = document.getElementById('prioritySelectionList');
            if (!listContainer) return;

            // „Ç´„Ç¶„É≥„Çø„ÉºÊõ¥Êñ∞„ÅØtogglePriorityAreaÂÜÖ„ÅßË°å„ÅÜ„ÅÆ„Åß„Åì„Åì„Åß„ÅØ‰∏çË¶Å

            // ÈÉΩÈÅìÂ∫úÁúå„Åî„Å®„Å´„Ç∞„É´„Éº„ÉóÂåñ
            const groupedByPref = {};
            Object.keys(areaSelectionData.cities).forEach(pref => {
                if (!groupedByPref[pref]) {
                    groupedByPref[pref] = [];
                }
                areaSelectionData.cities[pref].forEach(city => {
                    groupedByPref[pref].push({
                        key: `${pref}_${city}`,
                        city: city
                    });
                });
            });

            if (Object.keys(groupedByPref).length === 0) {
                listContainer.innerHTML = '<p class="text-gray-500 text-sm">Â∏ÇÂå∫Áî∫Êùë„ÇíÈÅ∏Êäû„Åô„Çã„Å®„ÄÅÂÑ™ÂÖà„Ç®„É™„Ç¢„ÅÆË®≠ÂÆö„ÅåÂèØËÉΩ„Å´„Å™„Çä„Åæ„Åô</p>';
                return;
            }

            // Áúå„Åî„Å®„Å´„Ç´„Éº„ÉâÂΩ¢Âºè„ÅßË°®Á§∫Ôºà„É¢„Éê„Ç§„É´ÂØæÂøúÔºâ
            listContainer.innerHTML = `
                <div class="border border-gray-200 rounded-lg bg-white p-3 sm:p-4">
                    <h5 class="font-semibold text-sm sm:text-base mb-3 flex items-center">
                        <span class="text-red-500 mr-2">üìç</span>
                        <span class="flex-1">ÈÅ∏ÊäûÂèØËÉΩ„Å™„Ç®„É™„Ç¢</span>
                        <span class="text-xs sm:text-sm text-gray-600">ÂÖ®${Object.values(groupedByPref).reduce((sum, cities) => sum + cities.length, 0)}„Ç®„É™„Ç¢</span>
                    </h5>
                    <div class="space-y-3 sm:space-y-4 max-h-96 overflow-y-auto">
                        ${Object.entries(groupedByPref).map(([pref, cities]) => `
                            <div class="bg-gray-50 rounded-lg p-2 sm:p-3">
                                <h6 class="font-medium text-xs sm:text-sm mb-2 flex items-center text-gray-700">
                                    <span class="text-red-500 mr-1 sm:mr-2">üìç</span>
                                    ${pref}
                                </h6>
                                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1.5 sm:gap-2 ml-0 sm:ml-6">
                                    ${cities.map(city => `
                                        <label class="flex items-center p-1.5 sm:p-2 bg-white hover:bg-yellow-50 rounded cursor-pointer text-xs sm:text-sm transition-colors">
                                            <input type="checkbox"
                                                   class="w-4 h-4 sm:w-auto sm:h-auto"
                                                   value="${city.key}"
                                                   ${areaSelectionData.priorities.includes(city.key) ? 'checked' : ''}
                                                   onchange="togglePriorityArea('${city.key}', this.checked)">
                                            <span class="ml-1.5 sm:ml-2 leading-tight">${city.city}</span>
                                        </label>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // ÂÑ™ÂÖà„Ç®„É™„Ç¢„Éà„Ç∞„É´
        function togglePriorityArea(areaKey, checked) {
            console.log('togglePriorityArea called:', areaKey, checked, 'current priorities:', areaSelectionData.priorities.length);

            if (checked) {
                // 3„Å§‰ª•‰∏äÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÈÅ∏Êäû„ÇíÈò≤„Åê
                if (areaSelectionData.priorities.length >= 3) {
                    showNotification('‰∏äÈôê„ÇíË∂Ö„Åà„Åæ„Åó„Åü', 'ÂÑ™ÂÖà„Ç®„É™„Ç¢„ÅØÊúÄÂ§ß3„Å§„Åæ„ÅßÈÅ∏ÊäûÂèØËÉΩ„Åß„Åô');
                    // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÇíÂÖÉ„Å´Êàª„Åô
                    setTimeout(() => {
                        const checkbox = document.querySelector(`input[value="${areaKey}"]`);
                        if (checkbox) {
                            checkbox.checked = false;
                        }
                    }, 0);
                    return;
                }
                if (!areaSelectionData.priorities.includes(areaKey)) {
                    areaSelectionData.priorities.push(areaKey);
                }
            } else {
                areaSelectionData.priorities = areaSelectionData.priorities.filter(p => p !== areaKey);
            }

            console.log('After update, priorities:', areaSelectionData.priorities.length, areaSelectionData.priorities);

            // ÂÑ™ÂÖà„Ç®„É™„Ç¢„Ç´„Ç¶„É≥„Çø„Éº„ÇíÊõ¥Êñ∞
            const selectedCount = document.getElementById('selectedPriorityCount');
            if (selectedCount) {
                selectedCount.textContent = areaSelectionData.priorities.length;

                // „Ç´„Ç¶„É≥„Çø„Éº„ÅÆË¶ã„ÅüÁõÆ„ÇÇÊõ¥Êñ∞ÔºàÈÅ∏ÊäûÊï∞„Å´Âøú„Åò„Å¶Ëâ≤„ÇíÂ§âÊõ¥Ôºâ
                const countContainer = selectedCount.parentElement;
                if (countContainer) {
                    if (areaSelectionData.priorities.length >= 3) {
                        countContainer.classList.add('text-red-600');
                        countContainer.classList.remove('text-orange-500');
                    } else if (areaSelectionData.priorities.length > 0) {
                        countContainer.classList.add('text-orange-500');
                        countContainer.classList.remove('text-red-600');
                    } else {
                        countContainer.classList.remove('text-red-600', 'text-orange-500');
                    }
                }
            } else {
                console.error('selectedPriorityCount element not found!');
            }

            // „É™„Çπ„Éà„ÇíÂÜçÊèèÁîªÔºà„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÅÆÁä∂ÊÖã„ÇíÂèçÊò†Ôºâ
            updatePriorityArea();
        }

        // „Ç®„É™„Ç¢ÈÅ∏Êäû„Çí„É™„Çª„ÉÉ„Éà
        function resetAreaSelection() {
            areaSelectionData.prefectures = [];
            areaSelectionData.cities = {};
            areaSelectionData.priorities = [];
            areaSelectionData.totalCount = 0;

            // „Éú„Çø„É≥„ÅÆÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
            document.querySelectorAll('[data-prefecture]').forEach(button => {
                button.classList.remove('selected', 'bg-blue-500', 'text-white');
                button.classList.add('bg-white');
            });

            // ÂÑ™ÂÖà„Ç®„É™„Ç¢„Ç´„Ç¶„É≥„Çø„Éº„ÇÇ„É™„Çª„ÉÉ„Éà
            const selectedCount = document.getElementById('selectedPriorityCount');
            if (selectedCount) {
                selectedCount.textContent = '0';
                const countContainer = selectedCount.parentElement;
                if (countContainer) {
                    countContainer.classList.remove('text-red-600', 'text-orange-500');
                }
            }

            updateAreaSelectionUI();
        }

        // „Ç®„É™„Ç¢ÈÅ∏Êäû„ÇíÁ¢∫ÂÆö
        function confirmAreaSelection() {
            showNotification('ÊàêÂäü', `${areaSelectionData.prefectures.length}ÈÉΩÈÅìÂ∫úÁúå„ÄÅ${areaSelectionData.totalCount}Â∏ÇÂå∫Áî∫Êùë„ÇíÈÅ∏Êäû„Åó„Åæ„Åó„Åü`);
        }

        // Â∏ÇÂå∫Áî∫Êùë„É™„Çπ„Éà„ÇíÊõ¥Êñ∞
        function updateCityList() {
            const cityListElement = document.getElementById('cityList');
            let html = '';

            selectedPrefectures.forEach(pref => {
                if (cityData[pref]) {
                    cityData[pref].forEach(city => {
                        html += `
                            <label class="flex items-center p-2 bg-white border rounded hover:bg-gray-50 cursor-pointer">
                                <input type="checkbox" data-city="${city}" name="manual-city" value="${city}" class="mr-2" onchange="updateCompanyAreaDisplay();">
                                <span class="text-sm">${city}</span>
                            </label>
                        `;
                    });
                }
            });

            cityListElement.innerHTML = html || '<p class="text-gray-500 text-center py-4">ÈÉΩÈÅìÂ∫úÁúå„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>';
        }

        // ÂÑ™ÂÖà„Ç®„É™„Ç¢„ÅÆÂàá„ÇäÊõø„Åà
        // Âè§„ÅÑtogglePriorityAreaÈñ¢Êï∞„ÅØÂâäÈô§ÔºàÊñ∞„Åó„ÅÑ„Éê„Éº„Ç∏„Éß„É≥„Çí‰∏ä„ÅßÂÆöÁæ©Ê∏à„ÅøÔºâ

        // updatePriorityAreasDisplayÈñ¢Êï∞„ÅØÂâäÈô§

        // ÂÖ®ÈÉΩÈÅìÂ∫úÁúå„ÇíË°®Á§∫
        function showAllPrefectures() {
            const container = event.target.parentElement.querySelector('.grid');
            container.innerHTML = allPrefectures.map(pref => `
                <label class="flex items-center p-2 bg-white border rounded cursor-pointer hover:bg-blue-50">
                    <input type="checkbox" name="prefecture" value="${pref}" class="mr-2" onchange="updateSelectedAreas()"
                           ${selectedPrefectures.includes(pref) ? 'checked' : ''}>
                    <span class="text-sm">${pref}</span>
                </label>
            `).join('');
            event.target.textContent = 'Èñâ„Åò„Çã';
            event.target.onclick = () => location.reload();
        }

        // Â∏ÇÂå∫Áî∫ÊùëÊ§úÁ¥¢
        function searchCities(query) {
            const cityListElement = document.getElementById('cityList');
            const allButtons = cityListElement.querySelectorAll('button');

            allButtons.forEach(button => {
                const cityName = button.textContent.replace('‚≠ê ', '');
                if (cityName.toLowerCase().includes(query.toLowerCase())) {
                    button.style.display = '';
                } else {
                    button.style.display = 'none';
                }
            });
        }

        // ‰ºöÁ§æÊÉÖÂ†±„ÅÆ„Ç®„É™„Ç¢Ë°®Á§∫„ÇíÊõ¥Êñ∞
        function updateCompanyAreaDisplay() {
            const displayElement = document.getElementById('companyAreaDisplay');
            if (!displayElement) return;

            let html = '';

            // ÈÉΩÈÅìÂ∫úÁúå
            if (selectedPrefectures.length > 0) {
                html += `
                    <div>
                        <p class="text-sm font-medium text-gray-700 mb-2">ÂØæÂøúÈÉΩÈÅìÂ∫úÁúå</p>
                        <div class="flex flex-wrap gap-2">
                            ${selectedPrefectures.map(pref =>
                                `<span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">${pref}</span>`
                            ).join('')}
                        </div>
                    </div>
                `;
            }

            // ÈÅ∏Êäû„Åï„Çå„ÅüÂ∏ÇÂå∫Áî∫Êùë„ÇíË°®Á§∫ÔºàÊâãÂãïË®≠ÂÆö„ÅÆÂ†¥ÂêàÔºâ
            const manualCities = document.querySelectorAll('input[name="manual-city"]:checked');
            if (manualCities.length > 0) {
                html += `
                    <div>
                        <p class="text-sm font-medium text-gray-700 mb-2">ÂØæÂøúÂ∏ÇÂå∫Áî∫Êùë</p>
                        <div class="flex flex-wrap gap-2">
                            ${Array.from(manualCities).map(checkbox =>
                                `<span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm">${checkbox.value}</span>`
                            ).join('')}
                        </div>
                    </div>
                `;
            }

            displayElement.innerHTML = html || '<p class="text-gray-500">„Ç®„É™„Ç¢„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>';
        }

        // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Çí‰øùÂ≠ò
        // „Ç®„É™„Ç¢Ë®≠ÂÆö„ÅÆÂêåÊúüÂàá„ÇäÊõø„Åà
        function toggleAreaSync() {
            const isSync = document.getElementById('syncAreaSettings').checked;
            const autoDiv = document.getElementById('companyAreaAuto');
            const manualDiv = document.getElementById('companyAreaManual');

            if (isSync) {
                autoDiv.classList.remove('hidden');
                manualDiv.classList.add('hidden');
            } else {
                autoDiv.classList.add('hidden');
                manualDiv.classList.remove('hidden');
            }
        }

        // Â∑•‰∫ãÂÜÖÂÆπË®≠ÂÆö„ÅÆÂêåÊúüÂàá„ÇäÊõø„Åà
        function toggleConstructionSync() {
            const isSync = document.getElementById('syncConstructionSettings').checked;
            const autoDiv = document.getElementById('companyConstructionAuto');
            const manualDiv = document.getElementById('companyConstructionManual');

            if (isSync) {
                autoDiv.classList.remove('hidden');
                manualDiv.classList.add('hidden');
            } else {
                autoDiv.classList.add('hidden');
                manualDiv.classList.remove('hidden');
            }
        }

        // ‰ºöÁ§æÊÉÖÂ†±Áî®„ÅÆÂÖ®ÈÉΩÈÅìÂ∫úÁúåË°®Á§∫
        function showAllCompanyPrefectures() {
            const container = event.target.parentElement.querySelector('.grid');
            container.innerHTML = allPrefectures.map(pref => `
                <label class="flex items-center p-2 bg-white border rounded cursor-pointer hover:bg-blue-50">
                    <input type="checkbox" name="company-prefecture" value="${pref}" class="mr-2">
                    <span class="text-sm">${pref}</span>
                </label>
            `).join('');
            event.target.textContent = 'Èñâ„Åò„Çã';
            event.target.onclick = () => location.reload();
        }


        // „ÇØ„ÉÅ„Ç≥„ÉüÁÆ°ÁêÜÈñ¢Êï∞
        let collectedReviews = [
            {
                id: 1,
                rating: 5,
                source: '„Éå„É™„Ç´„Ç®',
                content: '‰∏ÅÂØß„Å™ÂØæÂøú„ÅßÂÆâÂøÉ„Åó„Å¶„Åä‰ªª„Åõ„Åß„Åç„Åæ„Åó„Åü„ÄÇË¶ãÁ©ç„ÇÇ„Çä„ÇÇÊòéÁ¢∫„Åß„ÄÅËøΩÂä†ÊñôÈáë„Å™„Åè‰∫àÂÆöÈÄö„Çä„Å´ÂÆåÊàê„Åó„Åæ„Åó„Åü„ÄÇ',
                customer: 'Êù±‰∫¨ÈÉΩ YÊßò',
                date: '2024Âπ¥1Êúà',
                collectedDate: '2024/01/15',
                visible: true,
                image: null
            },
            {
                id: 2,
                rating: 4,
                source: 'Â§ñÂ£ÅÂ°óË£Ö„ÅÆÁ™ìÂè£',
                content: 'ËÅ∑‰∫∫„Åï„Çì„ÅÆÊäÄË°ì„ÅåÈ´ò„Åè„ÄÅ‰ªï‰∏ä„Åå„Çä„Å´Ê∫ÄË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇËøëÈö£„Å∏„ÅÆÈÖçÊÖÆ„ÇÇ„Åó„Å£„Åã„Çä„Åó„Å¶„ÅÑ„Åæ„Åó„Åü„ÄÇ',
                customer: 'Á•ûÂ•àÂ∑ùÁúå TÊßò',
                date: '2024Âπ¥2Êúà',
                collectedDate: '2024/02/01',
                visible: true,
                image: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="150" height="100"%3E%3Crect width="100%25" height="100%25" fill="%23ddd"/%3E%3Ctext x="50%25" y="50%25" font-family="Arial" font-size="14" fill="%23999" text-anchor="middle" dy=".3em"%3E150x100%3C/text%3E%3C/svg%3E'
            },
            {
                id: 3,
                rating: 5,
                source: 'Ëá™Á§æ',
                content: '15Âπ¥Ââç„Å´Âª∫„Å¶„ÅüÂÆ∂„ÅÆÂ§ñÂ£Å„ÅåËâ≤Ë§™„Åõ„Å¶„Åç„Åü„ÅÆ„Åß‰æùÈ†º„Åó„Åæ„Åó„Åü„ÄÇË§áÊï∞Á§æ„Åã„ÇâË¶ãÁ©ç„ÇÇ„Çä„ÇíÂèñ„Çä„Åæ„Åó„Åü„Åå„ÄÅË™¨Êòé„Åå‰∏ÄÁï™‰∏ÅÂØß„ÅßÂÆâÂøÉÊÑü„Åå„ÅÇ„Çä„Åæ„Åó„Åü„ÄÇ',
                customer: 'ÂçÉËëâÁúå MÊßò',
                date: '2024Âπ¥2Êúà',
                collectedDate: '2024/02/10',
                visible: true,
                image: null
            },
            {
                id: 4,
                rating: 5,
                source: '„É™„Ç∑„Éß„ÉÉ„Éó„Éä„Éì',
                content: 'ËÅ∑‰∫∫„Åï„Çì„ÅÆÊå®Êã∂„Åã„ÇâÂßã„Åæ„Çä„ÄÅÊØéÊó•„ÅÆ‰ΩúÊ•≠Â†±Âëä„ÄÅËøëÈö£„Å∏„ÅÆÈÖçÊÖÆ„Å™„Å©„ÄÅ„Åô„Åπ„Å¶„Å´„Åä„ÅÑ„Å¶Ê∫ÄË∂≥„Åß„Åó„Åü„ÄÇ',
                customer: 'ÂüºÁéâÁúå KÊßò',
                date: '2024Âπ¥3Êúà',
                collectedDate: '2024/03/05',
                visible: true,
                image: null
            },
            {
                id: 5,
                rating: 4,
                source: '„Éõ„Éº„É†„Éó„É≠',
                content: 'Ë¶ãÁ©ç„ÇÇ„Çä„ÅåÊòéÁ¢∫„Åß„ÄÅËøΩÂä†ÊñôÈáë„ÇÇ„Å™„Åè‰∫àÂÆöÈÄö„Çä„Å´ÁµÇ„Çè„Çä„Åæ„Åó„Åü„ÄÇ‰ªï‰∏ä„Åå„Çä„ÇÇÊúüÂæÖ‰ª•‰∏ä„Åß„Åô„ÄÇ',
                customer: 'Êù±‰∫¨ÈÉΩ SÊßò',
                date: '2024Âπ¥3Êúà',
                collectedDate: '2024/03/10',
                visible: true,
                image: null
            },
            {
                id: 6,
                rating: 5,
                source: 'Ëá™Á§æ',
                content: 'Â±ãÊ†π„Å®Â§ñÂ£Å„ÅÆÂêåÊôÇÊñΩÂ∑•„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åó„Åü„ÄÇÂ∑•Êúü„ÇÇÁü≠Á∏Æ„Åß„Åç„ÄÅ‰ªï‰∏ä„Åå„Çä„ÇÇÂ§ßÂ§âÊ∫ÄË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ',
                customer: 'Á•ûÂ•àÂ∑ùÁúå AÊßò',
                date: '2024Âπ¥3Êúà',
                collectedDate: '2024/03/15',
                visible: false,
                image: null
            }
        ];

        // „Ç´„É´„Éº„Çª„É´ÁÆ°ÁêÜ
        let currentReviewIndex = 0;

        // „ÇØ„ÉÅ„Ç≥„Éü„É™„Çπ„Éà„ÇíÊõ¥Êñ∞
        function updateReviewsList() {
            const reviewsList = document.getElementById('reviewsList');
            if (reviewsList) {
                reviewsList.innerHTML = collectedReviews.map(review => `
                    <div class="border rounded-lg p-4 bg-white" data-review-id="${review.id}">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex items-center">
                                <div class="flex text-yellow-400 mr-2">
                                    ${Array(5).fill(0).map((_, i) => `
                                        <svg class="w-4 h-4 ${i < review.rating ? 'fill-current' : 'text-gray-300'}" viewBox="0 0 20 20">
                                            <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                        </svg>
                                    `).join('')}
                                </div>
                                <span class="text-sm text-gray-600">${review.rating}.0</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-xs bg-gray-100 px-2 py-1 rounded">${review.source === 'Ëá™Á§æ' ? 'Ëá™Á§æ' : review.source + 'ÂèÇÁÖß'}</span>
                                <label class="flex items-center">
                                    <input type="checkbox" ${review.visible ? 'checked' : ''} onchange="toggleReviewVisibility(${review.id})" class="mr-1">
                                    <span class="text-xs text-gray-600">Ë°®Á§∫</span>
                                </label>
                            </div>
                        </div>
                        <p class="text-sm text-gray-800 mb-2">${review.content}</p>
                        ${review.image ? `
                            <div class="mb-2">
                                <img src="${review.image}" class="h-20 rounded object-cover" alt="ÊñΩÂ∑•ÂÜôÁúü">
                            </div>
                        ` : ''}
                        <div class="flex justify-between items-center text-xs text-gray-500">
                            <span>${review.customer} / ${review.date}</span>
                            <span>ÂèéÈõÜÊó•: ${review.collectedDate}</span>
                        </div>
                    </div>
                `).join('');

                // Ë°®Á§∫‰ª∂Êï∞„ÇíÊõ¥Êñ∞
                const visibleCount = collectedReviews.filter(r => r.visible).length;
                const countElement = document.getElementById('visibleReviewCount');
                if (countElement) countElement.textContent = visibleCount;
            }
            updatePreviewReviews();
        }

        // „ÇØ„ÉÅ„Ç≥„Éü„ÅÆË°®Á§∫/ÈùûË°®Á§∫Âàá„ÇäÊõø„Åà
        function toggleReviewVisibility(reviewId) {
            const review = collectedReviews.find(r => r.id === reviewId);
            if (review) {
                review.visible = !review.visible;
                updateReviewsList();
            }
        }

        // „Éó„É¨„Éì„É•„Éº„ÅÆ„ÇØ„ÉÅ„Ç≥„Éü„ÇíÊõ¥Êñ∞Ôºà„Ç´„É´„Éº„Çª„É´ÂΩ¢ÂºèÔºâ
        function updatePreviewReviews() {
            const previewReviewsList = document.getElementById('previewReviewsList');
            const indicators = document.getElementById('reviewIndicators');

            if (previewReviewsList) {
                const visibleReviews = collectedReviews.filter(r => r.visible);

                if (visibleReviews.length > 0) {
                    // ÁÑ°Èôê„É´„Éº„ÉóÁî®„Å´Ë§áË£Ω„Çí‰ΩúÊàê
                    const extendedReviews = [...visibleReviews, ...visibleReviews, ...visibleReviews];

                    // „Ç´„É´„Éº„Çª„É´„Ç´„Éº„Éâ„ÇíÁîüÊàê
                    previewReviewsList.innerHTML = extendedReviews.map((review, index) => `
                        <div class="flex-shrink-0 w-full md:w-96 bg-white rounded-lg shadow-lg border p-6">
                            <div class="flex items-center mb-3">
                                <div class="flex text-yellow-400 mr-2">
                                    ${Array(5).fill(0).map((_, i) => `
                                        <svg class="w-5 h-5 ${i < review.rating ? 'fill-current' : 'text-gray-300'}" viewBox="0 0 20 20">
                                            <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                        </svg>
                                    `).join('')}
                                </div>
                                <span class="text-sm text-gray-600 font-semibold">${review.rating}.0</span>
                            </div>

                            <p class="text-gray-700 mb-4 line-clamp-3">${review.content}</p>

                            ${review.image ? `
                                <img src="${review.image}" class="h-24 w-full object-cover rounded mb-3" alt="ÊñΩÂ∑•ÂÜôÁúü">
                            ` : ''}

                            <div class="border-t pt-3">
                                <div class="flex justify-between items-center">
                                    <div class="text-sm text-gray-600">
                                        <div class="font-medium">${review.customer}</div>
                                        <div class="text-xs text-gray-500">${review.date}</div>
                                    </div>
                                    <span class="text-xs bg-gray-100 px-2 py-1 rounded">
                                        ${review.source === 'Ëá™Á§æ' ? 'Áõ¥Êé•„ÅÑ„Åü„Å†„ÅÑ„ÅüÂ£∞' : review.source + '„Çà„Çä'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    `).join('');

                    // „Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº„ÇíÁîüÊàê
                    if (indicators) {
                        indicators.innerHTML = visibleReviews.map((_, index) => `
                            <button onclick="goToReview(${index})" class="w-2 h-2 rounded-full transition ${index === currentReviewIndex ? 'bg-blue-600' : 'bg-gray-300'}"></button>
                        `).join('');
                    }

                    document.getElementById('preview-reviews').style.display = 'block';
                    currentReviewIndex = visibleReviews.length; // ÁÑ°Èôê„É´„Éº„Éó„ÅÆ‰∏≠Â§Æ„Åã„ÇâÈñãÂßã
                    updateCarouselPosition();
                } else {
                    document.getElementById('preview-reviews').style.display = 'none';
                }
            }
        }

        // „Ç´„É´„Éº„Çª„É´„Çπ„ÇØ„É≠„Éº„É´ÔºàÁÑ°Èôê„É´„Éº„ÉóÔºâ
        function scrollReviews(direction) {
            const visibleReviews = collectedReviews.filter(r => r.visible);
            if (visibleReviews.length === 0) return;

            if (direction === 'left') {
                currentReviewIndex--;
            } else {
                currentReviewIndex++;
            }

            updateCarouselPosition();
        }

        // ÁâπÂÆö„ÅÆ„ÇØ„ÉÅ„Ç≥„Éü„Å∏ÁßªÂãï
        function goToReview(index) {
            const visibleReviews = collectedReviews.filter(r => r.visible);
            currentReviewIndex = index + visibleReviews.length;
            updateCarouselPosition();
        }

        // „Ç´„É´„Éº„Çª„É´‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞ÔºàÁÑ°Èôê„É´„Éº„ÉóÂØæÂøúÔºâ
        function updateCarouselPosition() {
            const carousel = document.getElementById('previewReviewsList');
            const indicators = document.getElementById('reviewIndicators');
            const visibleReviews = collectedReviews.filter(r => r.visible);

            if (carousel && visibleReviews.length > 0) {
                const cardWidth = carousel.firstElementChild ? carousel.firstElementChild.offsetWidth + 16 : 400;
                const offset = visibleReviews.length * cardWidth;

                // ÁÑ°Èôê„É´„Éº„Éó„ÅÆ„Åü„ÇÅ„ÅÆ‰ΩçÁΩÆË™øÊï¥
                const position = -currentReviewIndex * cardWidth - offset;
                carousel.style.transform = `translateX(${position}px)`;

                // „Çπ„É†„Éº„Ç∫„Å™ÁÑ°Èôê„É´„Éº„Éó
                if (currentReviewIndex < 0) {
                    setTimeout(() => {
                        carousel.style.transition = 'none';
                        currentReviewIndex = visibleReviews.length - 1;
                        const newPosition = -currentReviewIndex * cardWidth - offset;
                        carousel.style.transform = `translateX(${newPosition}px)`;
                        setTimeout(() => {
                            carousel.style.transition = 'transform 300ms';
                        }, 50);
                    }, 300);
                } else if (currentReviewIndex >= visibleReviews.length * 2) {
                    setTimeout(() => {
                        carousel.style.transition = 'none';
                        currentReviewIndex = visibleReviews.length;
                        const newPosition = -currentReviewIndex * cardWidth - offset;
                        carousel.style.transform = `translateX(${newPosition}px)`;
                        setTimeout(() => {
                            carousel.style.transition = 'transform 300ms';
                        }, 50);
                    }, 300);
                }

                // „Ç§„É≥„Ç∏„Ç±„Éº„Çø„ÉºÊõ¥Êñ∞
                if (indicators) {
                    const actualIndex = ((currentReviewIndex % visibleReviews.length) + visibleReviews.length) % visibleReviews.length;
                    indicators.querySelectorAll('button').forEach((btn, index) => {
                        btn.className = `w-2 h-2 rounded-full transition ${index === actualIndex ? 'bg-blue-600' : 'bg-gray-300'}`;
                    });
                }
            }
        }

        // ÂàùÊúüÂåñÊôÇ„Å´„ÇØ„ÉÅ„Ç≥„Éü„É™„Çπ„Éà„ÇíË°®Á§∫
        setTimeout(() => {
            updateReviewsList();
        }, 100);

        // ‰ºöÁ§æÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂàùÊúüÂåñÔºà‰øùÂ≠ò„Éú„Çø„É≥ÊñπÂºè„Å´Â§âÊõ¥Ôºâ
        document.addEventListener('DOMContentLoaded', () => {
            const companySection = document.getElementById('companySection');
            if (companySection) {
                console.log('[‰ºöÁ§æÊÉÖÂ†±] „Çª„ÇØ„Ç∑„Éß„É≥ÂàùÊúüÂåñÂÆå‰∫Ü - ‰øùÂ≠ò„Éú„Çø„É≥ÊñπÂºè„Çí‰ΩøÁî®');

                // „Ç´„Çπ„Çø„É†Ë≥áÊ†ºÂÖ•Âäõ„ÅÆEnter„Ç≠„ÉºÂØæÂøú
                const customQualInput = document.getElementById('customQualificationInput');
                if (customQualInput) {
                    customQualInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            addCustomQualification();
                        }
                    });
                }

                // „Ç´„Çπ„Çø„É†‰øùÈô∫ÂÖ•Âäõ„ÅÆEnter„Ç≠„ÉºÂØæÂøú
                const customInsInput = document.getElementById('customInsuranceInput');
                if (customInsInput) {
                    customInsInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            addCustomInsurance();
                        }
                    });
                }

                // PRÊñá„ÅÆÊñáÂ≠óÊï∞„Ç´„Ç¶„É≥„Çø„Éº
                const prTextArea = document.getElementById('prText');
                const prTextCharCount = document.getElementById('prTextCharCount');
                if (prTextArea && prTextCharCount) {
                    // ÂàùÊúüË°®Á§∫
                    prTextCharCount.textContent = prTextArea.value.length;

                    // ÂÖ•ÂäõÊôÇ„ÅÆ„Ç´„Ç¶„É≥„ÉàÊõ¥Êñ∞„Å®„ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„ÅÆÈ´ò„ÅïËá™ÂãïË™øÊï¥
                    prTextArea.addEventListener('input', (e) => {
                        const length = e.target.value.length;
                        prTextCharCount.textContent = length;

                        // „ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„ÅÆÈ´ò„Åï„ÇíÂÜÖÂÆπ„Å´Âêà„Çè„Åõ„Å¶Ëá™ÂãïË™øÊï¥
                        e.target.style.height = 'auto';
                        e.target.style.height = Math.max(200, e.target.scrollHeight) + 'px';
                    });
                }
            }
        });

        // „Çµ„Éº„Éì„Çπ„Ç´„Éº„Éâ„ÅÆ„Éà„Ç∞„É´Ê©üËÉΩ
        function toggleServiceCard(element) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            const card = element.querySelector('div');

            checkbox.checked = !checkbox.checked;

            if (checkbox.checked) {
                card.classList.add('bg-blue-50', 'border-blue-500');
                card.classList.remove('bg-white');
            } else {
                card.classList.remove('bg-blue-50', 'border-blue-500');
                card.classList.add('bg-white');
            }
        }

        // Google„Éû„ÉÉ„Éó„ÇíÂüã„ÇÅËæº„Åø
        function loadGoogleMap() {
            const mapContainer = document.getElementById('googleMapContainer');
            const address = document.getElementById('previewAddress')?.textContent || '';

            if (!mapContainer) return;

            if (address && address !== '-') {
                const encodedAddress = encodeURIComponent(address);
                // Google Maps Embed API„Çí‰ΩøÁî®ÔºàÈÄöÂ∏∏„ÅØAPI„Ç≠„Éº„ÅåÂøÖË¶Å„Åß„Åô„Åå„ÄÅ„Ç∑„É≥„Éó„É´„Å™iframeÂüã„ÇÅËæº„Åø„Çí‰ΩøÁî®Ôºâ
                const mapHtml = `
                    <iframe
                        width="100%"
                        height="100%"
                        frameborder="0"
                        style="border:0"
                        src="https://www.google.com/maps?q=${encodedAddress}&output=embed"
                        allowfullscreen>
                    </iframe>
                `;
                mapContainer.innerHTML = mapHtml;
            } else {
                mapContainer.innerHTML = `
                    <div class="w-full h-full flex items-center justify-center text-gray-500 bg-gray-100">
                        <div class="text-center">
                            <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            <p class="text-sm">ÊâÄÂú®Âú∞ÊÉÖÂ†±„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                        </div>
                    </div>
                `;
            }
        }

        // ÈÄöÁü•Ë°®Á§∫
        function showNotification(title, body, type = 'info') {
            // „Éñ„É©„Ç¶„Ç∂ÈÄöÁü•
            if (Notification.permission === 'granted') {
                new Notification(title, {
                    body: body,
                    icon: '/favicon.ico',
                    badge: '/favicon.ico'
                });
            }

            // „Ç§„É≥„Ç¢„Éó„É™ÈÄöÁü•„ÇÇË°®Á§∫
            showInAppNotification(title, body, type);
        }

        // „Ç§„É≥„Ç¢„Éó„É™ÈÄöÁü•
        function showInAppNotification(title, body, type = 'info') {
            const colors = {
                'info': 'bg-blue-500',
                'success': 'bg-green-500',
                'warning': 'bg-yellow-500',
                'error': 'bg-red-500'
            };

            const notification = document.createElement('div');
            notification.className = `fixed top-20 right-4 ${colors[type]} text-white px-6 py-4 rounded-lg shadow-lg z-[60] animate-slide-in`;
            notification.innerHTML = `
                <div class="flex items-start gap-3">
                    <div class="flex-1">
                        <div class="font-semibold">${title}</div>
                        <div class="text-sm opacity-90">${body}</div>
                    </div>
                    <button onclick="this.closest('div').remove()" class="hover:opacity-70">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `;
            document.body.appendChild(notification);

            // 5ÁßíÂæå„Å´Ëá™Âãï„ÅßÊ∂àÂéª
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.classList.add('animate-slide-out');
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }

        // „Ç¢„É©„Éº„Éà„Éë„Éç„É´„ÅÆË°®Á§∫/ÈùûË°®Á§∫
        function toggleAlertPanel() {
            const panel = document.getElementById('alertPanel');
            if (panel.classList.contains('hidden')) {
                panel.classList.remove('hidden');
                loadAlerts();
                updateTotalBadgeCount();
            } else {
                panel.classList.add('hidden');
            }
        }

        // Êú¨ÈÉ®„Åã„Çâ„ÅÆÈÄöÁü•„Éë„Éç„É´Âàá„ÇäÊõø„Åà
        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            if (panel.classList.contains('hidden')) {
                panel.classList.remove('hidden');
                loadNotifications();
            } else {
                panel.classList.add('hidden');
            }
        }

        // Êú¨ÈÉ®„Åã„Çâ„ÅÆÈÄöÁü•„ÇíË™≠„ÅøËæº„ÇÄÔºà‰ªäÂæåÂÆüË£ÖÔºâ
        function loadNotifications() {
            // TODO: GAS„Åã„ÇâÊú¨ÈÉ®ÈÄöÁü•„ÇíÂèñÂæó
            console.log('Loading notifications from headquarters...');
        }

        // Âä†ÁõüÂ∫ó„Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞
        // updateMerchantStatusÈñ¢Êï∞„ÅØÂâäÈô§Ôºà„Çπ„ÉÜ„Éº„Çø„Çπ„ÅØË™≠„ÅøÂèñ„ÇäÂ∞ÇÁî®„ÄÅ„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÂãïÁöÑÂèñÂæóÔºâ

        // „Éê„ÉÉ„Ç∏„Ç´„Ç¶„É≥„Éà„ÇíÁµ±ÂêàÊõ¥Êñ∞
        function updateTotalBadgeCount() {
            // Êú™Ââ≤ÂΩìÊ°à‰ª∂Êï∞„ÇíÂèñÂæó
            const unassignedBadge = document.getElementById('unassignedBadge');
            const unassignedCount = unassignedBadge && !unassignedBadge.classList.contains('hidden')
                ? parseInt(unassignedBadge.textContent) || 0
                : 0;

            // „Ç¢„É©„Éº„ÉàÊï∞„ÇíÂèñÂæó
            const alertItems = document.querySelectorAll('#todayAlerts .alert-item').length || 0;

            // ÂêàË®à„Çí„Éô„É´„Éû„Éº„ÇØ„Å´Ë°®Á§∫
            const totalCount = unassignedCount + alertItems;
            const alertCountBadge = document.getElementById('alertCount');

            if (totalCount > 0) {
                alertCountBadge.textContent = totalCount;
                alertCountBadge.classList.remove('hidden');
            } else {
                alertCountBadge.classList.add('hidden');
            }
        }

        // „Ç¢„É©„Éº„ÉàË™≠„ÅøËæº„Åø
        function loadAlerts() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);

            // ‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ
            const todayTasks = [
                { time: '10:00', text: 'Áî∞‰∏≠Êßò„Å∏Êû∂Èõª', type: 'call', caseId: 1 },
                { time: '14:00', text: '‰ΩêËó§Êßò ÁèæÂú∞Ë™øÊüª', type: 'appointment', caseId: 2 },
                { time: '16:00', text: 'Èà¥Êú®Êßò Ë¶ãÁ©çÊõ∏ÊèêÂá∫ÊúüÈôê', type: 'estimate', caseId: 3 }
            ];

            const todayTasksHtml = todayTasks.map(task => `
                <div class="flex items-center justify-between p-2 bg-red-50 rounded-lg hover:bg-red-100 cursor-pointer"
                     onclick="handleAlertClick(${task.caseId}, '${task.type}')">
                    <div class="flex items-center gap-2">
                        <span class="text-xs font-medium text-red-600">${task.time}</span>
                        <span class="text-sm">${task.text}</span>
                    </div>
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </div>
            `).join('');
            document.getElementById('todayTasks').innerHTML = todayTasksHtml || '<div class="text-sm text-gray-500">„Çø„Çπ„ÇØ„Å™„Åó</div>';

            // ÊòéÊó•„ÅÆ‰∫àÂÆö
            const tomorrowTasks = [
                { time: '11:00', text: 'Â±±Áî∞Êßò „Ç¢„Éù„Ç§„É≥„Éà', type: 'appointment', caseId: 4 },
                { time: '15:00', text: 'È´òÊ©ãÊßò „Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó', type: 'followup', caseId: 5 }
            ];

            const tomorrowTasksHtml = tomorrowTasks.map(task => `
                <div class="flex items-center justify-between p-2 bg-yellow-50 rounded-lg hover:bg-yellow-100 cursor-pointer"
                     onclick="handleAlertClick(${task.caseId}, '${task.type}')">
                    <div class="flex items-center gap-2">
                        <span class="text-xs font-medium text-yellow-600">${task.time}</span>
                        <span class="text-sm">${task.text}</span>
                    </div>
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </div>
            `).join('');
            document.getElementById('tomorrowTasks').innerHTML = tomorrowTasksHtml || '<div class="text-sm text-gray-500">‰∫àÂÆö„Å™„Åó</div>';

            // Ëá™Âãï„Ç¢„É©„Éº„Éà
            const autoAlerts = [
                { text: 'Êú™ÂØæÂøúÊ°à‰ª∂3‰ª∂„ÅÇ„Çä„Åæ„Åô', type: 'warning' },
                { text: 'Ë¶ãÁ©çÊèêÂá∫Âæå7Êó•ÁµåÈÅé: 2‰ª∂', type: 'info' },
                { text: 'ÂÖ•Èáë‰∫àÂÆöÊó•: Áî∞‰∏≠Êßò', type: 'payment' }
            ];

            const autoAlertsHtml = autoAlerts.map(alert => `
                <div class="flex items-center justify-between p-2 bg-blue-50 rounded-lg">
                    <span class="text-sm">${alert.text}</span>
                    <button onclick="dismissAlert(this)" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `).join('');
            document.getElementById('autoAlerts').innerHTML = autoAlertsHtml || '<div class="text-sm text-gray-500">„Ç¢„É©„Éº„Éà„Å™„Åó</div>';
        }

        // „Ç¢„É©„Éº„Éà„ÇØ„É™„ÉÉ„ÇØÂá¶ÁêÜ
        function handleAlertClick(caseId, type) {
            toggleAlertPanel();

            if (type === 'call') {
                // ÈõªË©±Áô∫‰ø°
                const caseData = casesData.find(c => c.id === caseId);
                if (caseData && caseData.phone) {
                    callCustomer(caseData.phone);
                }
            } else if (type === 'appointment' || type === 'estimate') {
                // Ê°à‰ª∂Ë©≥Á¥∞„ÇíË°®Á§∫
                showSection('cases');
                setTimeout(() => {
                    const caseCard = document.querySelector(`[data-case-id="${caseId}"]`);
                    if (caseCard) {
                        caseCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        caseCard.classList.add('ring-2', 'ring-yellow-400');
                        setTimeout(() => {
                            caseCard.classList.remove('ring-2', 'ring-yellow-400');
                        }, 3000);
                    }
                }, 100);
            }
        }

        // „Ç¢„É©„Éº„ÉàÊ∂àÂéª
        function dismissAlert(button) {
            button.closest('div').remove();
        }


        // „Ç¢„É©„Éº„ÉàË®≠ÂÆöÊõ¥Êñ∞ÔºàË®≠ÂÆö„É°„Éã„É•„Éº„Å®„Ç¢„É©„Éº„Éà„Éë„Éç„É´„ÅÆÂêåÊúüÔºâ
        function updateAlertSetting(settingName, enabled) {
            // localStorage „Å´‰øùÂ≠ò
            let alertSettings = JSON.parse(localStorage.getItem('alertSettings') || '{}');
            alertSettings[settingName] = enabled;
            localStorage.setItem('alertSettings', JSON.stringify(alertSettings));

            // ÂØæÂøú„Åô„ÇãË®≠ÂÆö„É°„Éã„É•„Éº„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÇíÂêåÊúü
            const idMap = {
                'appointment_reminder': 'appointmentReminder',
                'call_reminder': 'callReminder',
                'estimate_followup': 'estimateFollowup',
                'payment_alert': 'paymentAlert'
            };

            const checkboxId = idMap[settingName];
            if (checkboxId) {
                const checkbox = document.getElementById(checkboxId);
                if (checkbox && checkbox.checked !== enabled) {
                    checkbox.checked = enabled;
                }
            }
        }

        // „Ç´„É¨„É≥„ÉÄ„Éº„ÅÆËá™ÂãïÂêåÊúüÔºàÊ°à‰ª∂„Éá„Éº„Çø„Åã„ÇâËá™ÂãïÁöÑ„Å´„Ç´„É¨„É≥„ÉÄ„Éº„Ç§„Éô„É≥„Éà„ÇíÁîüÊàêÔºâ
        function autoSyncToCalendar() {
            // Êó¢Â≠ò„ÅÆÊ°à‰ª∂Áî±Êù•„Ç§„Éô„É≥„Éà„Çí„ÇØ„É™„Ç¢
            calendarEvents = calendarEvents.filter(event => !event.fromCase);

            // ÂÖ®Ê°à‰ª∂„Åã„Çâ„Éç„ÇØ„Çπ„Éà„Çπ„ÉÜ„ÉÉ„Éó„ÇíÂèñÂæó„Åó„Å¶„Ç´„É¨„É≥„ÉÄ„Éº„Å´ËøΩÂä†
            const allCases = getCasesData();

            allCases.forEach(caseItem => {
                // „Éç„ÇØ„Çπ„Éà„Çπ„ÉÜ„ÉÉ„Éó„Åå„ÅÇ„ÇãÂ†¥Âêà
                if (caseItem.nextAction) {
                    const today = new Date();
                    const eventDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + Math.floor(Math.random() * 7));
                    const eventTitle = `${caseItem.nextAction}: ${caseItem.customer}Êßò`;

                    // „Ç§„Éô„É≥„Éà„Çø„Ç§„Éó„ÇíÂà§ÂÆö
                    let eventType = 'todo';
                    let eventColor = '#6b7280';

                    if (caseItem.nextAction.includes('ÁèæË™ø') || caseItem.nextAction.includes('„Ç¢„Éù')) {
                        eventType = 'meeting';
                        eventColor = '#3b82f6';
                    } else if (caseItem.nextAction.includes('Êû∂Èõª') || caseItem.nextAction.includes('ÈõªË©±')) {
                        eventType = 'call';
                        eventColor = '#10b981';
                    } else if (caseItem.nextAction.includes('Ë¶ãÁ©ç')) {
                        eventType = 'estimate';
                        eventColor = '#f59e0b';
                    }

                    calendarEvents.push({
                        id: `case-${caseItem.id}`,
                        title: eventTitle,
                        date: eventDate.toISOString().split('T')[0],
                        time: '10:00',
                        type: eventType,
                        color: eventColor,
                        fromCase: true,  // Ê°à‰ª∂Áî±Êù•„ÅÆ„Ç§„Éô„É≥„Éà„Éû„Éº„ÇØ
                        caseId: caseItem.id
                    });
                }
            });

            // „Ç´„É¨„É≥„ÉÄ„Éº„ÇíÂÜçÊèèÁîª
            if (typeof renderCalendar !== 'undefined') {
                renderCalendar();
            }
            if (typeof renderMiniCalendar !== 'undefined') {
                renderMiniCalendar();
            }
        }

        // Ê°à‰ª∂„Éá„Éº„ÇøÊõ¥Êñ∞ÊôÇ„Å´Ëá™ÂãïÁöÑ„Å´„Ç´„É¨„É≥„ÉÄ„Éº„ÇíÂêåÊúü
        function onCaseUpdate() {
            autoSyncToCalendar();
        }

        // Google„Ç´„É¨„É≥„ÉÄ„ÉºÂêåÊúüÔºàÂ∞ÜÊù•ÁöÑ„Å´ÂÆüË£ÖÔºâ
        function syncWithGoogleCalendar() {
            // Google Calendar API„Çí‰ΩøÁî®„Åó„ÅüÂêåÊúü
            showNotification('Ê©üËÉΩÈñãÁô∫‰∏≠', 'Google„Ç´„É¨„É≥„ÉÄ„ÉºÂêåÊúü„ÅØÊ¨°Âõû„Ç¢„ÉÉ„Éó„Éá„Éº„Éà„ÅßÊèê‰æõ‰∫àÂÆö', 'info');
        }

        // „Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥ÊôÇ„ÅÆËá™Âãï„Ç¢„É©„Éº„ÉàË®≠ÂÆö
        function scheduleStatusAlert(caseId, newStatus) {
            const alertTiming = {
                '„Ç¢„ÉùÊ∏à': { delay: 86400000, message: 'ÊòéÊó•„ÅÆÁèæÂú∞Ë™øÊüª‰∫àÂÆö' }, // 1Êó•Ââç
                'ÁèæË™øÊ∏à': { delay: 3600000, message: 'Ë¶ãÁ©çÊõ∏‰ΩúÊàê„ÇíÈñãÂßã' }, // 1ÊôÇÈñìÂæå
                'Ë¶ãÁ©çÊèêÂá∫Ê∏à': { delay: 604800000, message: '„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó„ÅåÂøÖË¶Å' }, // 7Êó•Âæå
                'ÂÖ•Èáë‰∫àÂÆö': { delay: 86400000, message: 'ÂÖ•ÈáëÁ¢∫Ë™ç„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô' } // 1Êó•Âæå
            };

            if (alertTiming[newStatus]) {
                const alert = alertTiming[newStatus];
                setTimeout(() => {
                    showNotification('„É™„Éû„Ç§„É≥„ÉÄ„Éº', alert.message, 'warning');
                    // „Ç¢„É©„Éº„Éà„Ç´„Ç¶„É≥„Éà„ÇíÂ¢ó„ÇÑ„Åô
                    const countBadge = document.getElementById('alertCount');
                    const currentCount = parseInt(countBadge.textContent) || 0;
                    countBadge.textContent = currentCount + 1;
                    countBadge.classList.remove('hidden');
                }, alert.delay);
            }
        }

        // „É°„Éã„É•„Éº„Éà„Ç∞„É´
        window.toggleMenu = function() {
            const sideMenu = document.getElementById('sideMenu');
            const isOpen = !sideMenu.classList.contains('-translate-x-full');

            if (isOpen) {
                // „É°„Éã„É•„Éº„ÇíÈñâ„Åò„Çã
                sideMenu.classList.add('-translate-x-full');
                document.removeEventListener('click', handleOutsideClick);
            } else {
                // „É°„Éã„É•„Éº„ÇíÈñã„Åè
                sideMenu.classList.remove('-translate-x-full');
                // Ê¨°„ÅÆ„Éï„É¨„Éº„É†„Åß„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†ÔºàtoggleMenu„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„ÇíÁÑ°Ë¶ñ„Åô„Çã„Åü„ÇÅÔºâ
                setTimeout(() => {
                    document.addEventListener('click', handleOutsideClick);
                }, 0);
            }
        }

        // „É°„Éã„É•„ÉºÂ§ñ„ÇØ„É™„ÉÉ„ÇØ„Åß„É°„Éã„É•„Éº„ÇíÈñâ„Åò„Çã
        function handleOutsideClick(event) {
            const sideMenu = document.getElementById('sideMenu');
            const menuButton = event.target.closest('button[onclick*="toggleMenu"]');

            // „É°„Éã„É•„Éº„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà„ÅØÁÑ°Ë¶ñ
            if (menuButton) return;

            // „É°„Éã„É•„ÉºÂÜÖ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà„ÅØÁÑ°Ë¶ñ
            if (sideMenu.contains(event.target)) return;

            // „É°„Éã„É•„ÉºÂ§ñ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà„ÅØÈñâ„Åò„Çã
            sideMenu.classList.add('-translate-x-full');
            document.removeEventListener('click', handleOutsideClick);
        }
        
        // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„É°„Éã„É•„Éº„ÅÆÊõ¥Êñ∞
        window.updateActiveMenu = function(sectionName) {
            // „Åô„Åπ„Å¶„ÅÆ„É°„Éã„É•„Éº„Ç¢„Ç§„ÉÜ„É†„Åã„Çâ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Çπ„Çø„Ç§„É´„ÇíÂâäÈô§
            document.querySelectorAll('#sideMenu a').forEach(link => {
                link.classList.remove('bg-gradient-to-r', 'from-blue-600', 'to-blue-500', 'text-gray-100');
                link.classList.add('text-gray-400', 'hover:bg-gray-800', 'hover:text-gray-100');
            });
            
            // ÂØæÂøú„Åô„Çã„É°„Éã„É•„Éº„Ç¢„Ç§„ÉÜ„É†„Å´„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
            const activeLink = document.querySelector(`#sideMenu a[onclick*="showSection('${sectionName}')"]`);
            if (activeLink) {
                activeLink.classList.remove('text-gray-400', 'hover:bg-gray-800', 'hover:text-gray-100');
                activeLink.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-blue-500', 'text-gray-100');
            }
        }
        
        // „Çª„ÇØ„Ç∑„Éß„É≥Âàá„ÇäÊõø„Åà
        // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅÆÂ§âÊõ¥Ê§úÁü•Áî®„Éï„É©„Ç∞
        let autodeliverySettingsChanged = false;

        // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅÆÂ§âÊõ¥„ÇíÊ§úÁü•
        function markAutodeliveryChanged() {
            autodeliverySettingsChanged = true;
            console.log('[Autodelivery] Settings changed, not saved yet');
        }

        // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅÆÂ§âÊõ¥„Çí„É™„Çª„ÉÉ„Éà
        function resetAutodeliveryChanged() {
            autodeliverySettingsChanged = false;
            console.log('[Autodelivery] Settings saved, change flag reset');
        }

        window.showSection = function(sectionName) {
            // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥„Åã„Çâ‰ªñ„ÅÆ„Çª„ÇØ„Ç∑„Éß„É≥„Å´ÁßªÂãï„Åô„ÇãÂ†¥Âêà„ÄÅÊú™‰øùÂ≠ò„ÉÅ„Çß„ÉÉ„ÇØ
            const currentSection = document.querySelector('.section[style*="display: block"]');
            if (currentSection && currentSection.id === 'autodeliverySection' && sectionName !== 'autodelivery') {
                if (autodeliverySettingsChanged) {
                    if (!confirm('Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Å´‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ§âÊõ¥„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ\n\n‰øùÂ≠ò„Åõ„Åö„Å´ÁßªÂãï„Åó„Åæ„Åô„ÅãÔºü')) {
                        return; // ÁßªÂãï„Çí„Ç≠„É£„É≥„Çª„É´
                    }
                    // ÁßªÂãï„ÇíË®±ÂèØ„Åó„ÅüÂ†¥Âêà„ÄÅ„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
                    autodeliverySettingsChanged = false;
                }
            }

            // „Åô„Åπ„Å¶„ÅÆ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈùûË°®Á§∫
            document.querySelectorAll('.section').forEach(section => {
                section.style.display = 'none';
            });

            // ÈÅ∏Êäû„Åï„Çå„Åü„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.style.display = 'block';

                // „É°„Éã„É•„Éº„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                updateActiveMenu(sectionName);

                // „Ç´„É¨„É≥„ÉÄ„Éº„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÅØÂàùÊúüÂåñ
                if (sectionName === 'calendar') {
                    setTimeout(() => {
                        renderCalendar();
                        renderMiniCalendar();
                    }, 10);
                }

                // ‰ºöÁ§æÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÄÅÂä†ÁõüÂ∫ó„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
                if (sectionName === 'company') {
                    console.log('==== COMPANY SECTION OPENED ====');
                    if (window.merchantId) {
                        console.log('Loading merchant data for:', window.merchantId);
                        setTimeout(() => loadMerchantData(window.merchantId), 100);
                    } else {
                        console.log('No merchantId available for data loading');
                    }
                }

                // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÄÅÂä†ÁõüÂ∫ó„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
                if (sectionName === 'autodelivery') {
                    console.log('==== AUTODELIVERY SECTION OPENED ====');

                    // merchantId„ÅÆÂèñÂæó„ÇíË©¶„Åø„ÇãÔºàË§áÊï∞„ÅÆ„ÇΩ„Éº„Çπ„Åã„ÇâÔºâ
                    const merchantId = window.merchantId || sessionStorage.getItem('currentUser');

                    if (merchantId) {
                        console.log('Loading merchant data for autodelivery:', merchantId);

                        // merchantData„ÅåÊó¢„Å´„ÅÇ„Çå„Å∞„Åù„Çå„Çí‰ΩøÁî®„ÄÅ„Å™„Åë„Çå„Å∞ÂÜçÂèñÂæó
                        if (window.merchantData) {
                            console.log('Using existing merchantData');
                            loadAutodeliverySettings(window.merchantData);
                        } else {
                            console.log('Fetching fresh merchantData');
                            // Áõ¥Êé•„Éá„Éº„Çø„ÇíÂÜçÂèñÂæó
                            fetchMerchantDataForAutodelivery(merchantId);
                        }
                    } else {
                        console.log('No merchantId available for autodelivery');
                        console.log('Trying to get from sessionStorage...');
                        const savedUser = sessionStorage.getItem('currentUser');
                        if (savedUser) {
                            window.merchantId = savedUser;
                            fetchMerchantDataForAutodelivery(savedUser);
                        }
                    }
                }

                // ‰ºöÁ§æÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÅØÊîØÂ∫ó„Éû„ÉÉ„Éó„ÇíÊõ¥Êñ∞
                if (sectionName === 'company') {
                    setTimeout(() => {
                        updateBranchMaps();
                        loadGoogleMap();
                    }, 100);
                }
            }

            // „É°„Éã„É•„Éº„ÇíÈñâ„Åò„Çã
            document.getElementById('sideMenu').classList.add('-translate-x-full');
        }

        // Ê®©Èôê„É¢„Éº„ÉÄ„É´
        function openPermissionModal(name = null, isNew = true) {
            const modal = document.getElementById('permissionModal');
            const modalTitle = document.getElementById('modalTitle');
            const newSalesFields = document.getElementById('newSalesFields');

            if (isNew) {
                // Êñ∞Ë¶èËøΩÂä†„É¢„Éº„Éâ
                modalTitle.textContent = 'Êñ∞Ë¶èÂñ∂Ê•≠ÊãÖÂΩìËÄÖËøΩÂä†';
                newSalesFields.classList.remove('hidden');
                // „Éï„Ç©„Éº„É†„Çí„ÇØ„É™„Ç¢
                document.getElementById('newSalesName').value = '';
                document.getElementById('newSalesEmail').value = '';
                document.getElementById('newSalesPhone').value = '';
                document.getElementById('newSalesRole').value = '‰∏ÄËà¨Âñ∂Ê•≠';
                // ÂÖ®Ê®©Èôê„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Çí„ÇØ„É™„Ç¢
                document.querySelectorAll('.permission-checkbox').forEach(cb => cb.checked = false);
            } else {
                // Á∑®ÈõÜ„É¢„Éº„Éâ
                modalTitle.textContent = `${name}„ÅÆÊ®©ÈôêË®≠ÂÆö`;
                newSalesFields.classList.add('hidden');
                // Êó¢Â≠ò„ÅÆÊ®©Èôê„ÇíË™≠„ÅøËæº„ÇÄÔºà„Éá„É¢Áî®„Å´„É©„É≥„ÉÄ„É†„Å´Ë®≠ÂÆöÔºâ
                loadExistingPermissions(name);
            }

            modal.classList.remove('hidden');
        }

        function closePermissionModal() {
            document.getElementById('permissionModal').classList.add('hidden');
        }

        function editPermissions(name) {
            openPermissionModal(name, false);
        }

        // Êó¢Â≠ò„ÅÆÊ®©Èôê„ÇíË™≠„ÅøËæº„ÇÄ
        function loadExistingPermissions(name) {
            // „Éá„É¢Áî®Ôºö„É©„É≥„ÉÄ„É†„Å´Ê®©Èôê„ÇíË®≠ÂÆö
            document.querySelectorAll('.permission-checkbox').forEach(cb => {
                cb.checked = Math.random() > 0.5;
            });
        }

        // Âñ∂Ê•≠ÊãÖÂΩìËÄÖÂâäÈô§Á¢∫Ë™ç
        function confirmDeleteSales(name) {
            // ÂâäÈô§Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´„Çí‰ΩúÊàê
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.id = 'deleteConfirmModal';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-md">
                    <div class="flex items-center mb-4">
                        <svg class="w-6 h-6 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                        <h3 class="text-lg font-bold text-gray-900">Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„ÅÆÂâäÈô§Á¢∫Ë™ç</h3>
                    </div>
                    <p class="text-gray-600 mb-4">
                        <span class="font-semibold">${name}</span>„Åï„Çì„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü
                    </p>
                    <div class="bg-yellow-50 border border-yellow-300 rounded-lg p-3 mb-4">
                        <p class="text-sm text-yellow-800">
                            <strong>Ê≥®ÊÑèÔºö</strong>„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ<br>
                            ÂâäÈô§„Åô„Çã„Å®‰ª•‰∏ã„ÅÆÊÉÖÂ†±„ÅåÂ§±„Çè„Çå„Åæ„ÅôÔºö
                        </p>
                        <ul class="mt-2 text-sm text-yellow-700 list-disc list-inside">
                            <li>Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„ÅÆÂü∫Êú¨ÊÉÖÂ†±</li>
                            <li>Ê®©ÈôêË®≠ÂÆö</li>
                            <li>ÈÅéÂéª„ÅÆÊ¥ªÂãïÂ±•Ê≠¥</li>
                            <li>ÊãÖÂΩìÊ°à‰ª∂„ÅÆÂâ≤„ÇäÂΩì„Å¶ÔºàÂÜçÂâ≤„ÇäÂΩì„Å¶„ÅåÂøÖË¶ÅÔºâ</li>
                        </ul>
                    </div>
                    <div class="flex items-center mb-4">
                        <input type="checkbox" id="reassignCases" class="rounded mr-2">
                        <label for="reassignCases" class="text-sm text-gray-700">
                            ÊãÖÂΩìÊ°à‰ª∂„Çí‰ªñ„ÅÆÂñ∂Ê•≠„Å´Âºï„ÅçÁ∂ô„Åê
                        </label>
                    </div>
                    <div id="reassignSection" class="hidden mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Âºï„ÅçÁ∂ô„ÅéÂÖà</label>
                        <select id="reassignTo" class="w-full px-3 py-2 border rounded-lg">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <option value="Áî∞‰∏≠Â§™ÈÉé">Áî∞‰∏≠Â§™ÈÉéÔºà„É™„Éº„ÉÄ„ÉºÔºâ</option>
                            <option value="‰ΩêËó§Ëä±Â≠ê">‰ΩêËó§Ëä±Â≠êÔºà‰∏ÄËà¨Âñ∂Ê•≠Ôºâ</option>
                            <option value="Èà¥Êú®Ê¨°ÈÉé">Èà¥Êú®Ê¨°ÈÉéÔºàÊñ∞‰∫∫Âñ∂Ê•≠Ôºâ</option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeDeleteModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                        <button onclick="deleteSales('${name}')" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            ÂâäÈô§„Åô„Çã
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Âºï„ÅçÁ∂ô„Åé„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÅÆ„Ç§„Éô„É≥„Éà
            document.getElementById('reassignCases').addEventListener('change', function(e) {
                const reassignSection = document.getElementById('reassignSection');
                if (e.target.checked) {
                    reassignSection.classList.remove('hidden');
                } else {
                    reassignSection.classList.add('hidden');
                }
            });

            // ÂâäÈô§ÂØæË±°„ÇíÈÅ∏ÊäûËÇ¢„Åã„ÇâÈô§Â§ñ
            const reassignSelect = document.getElementById('reassignTo');
            Array.from(reassignSelect.options).forEach(option => {
                if (option.value === name) {
                    option.remove();
                }
            });
        }

        // ÂâäÈô§„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeDeleteModal() {
            const modal = document.getElementById('deleteConfirmModal');
            if (modal) {
                modal.remove();
            }
        }

        // Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„ÇíÂâäÈô§
        function deleteSales(name) {
            const reassignCases = document.getElementById('reassignCases').checked;
            const reassignTo = document.getElementById('reassignTo').value;

            if (reassignCases && !reassignTo) {
                alert('Âºï„ÅçÁ∂ô„ÅéÂÖà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            // ÂâäÈô§Âá¶ÁêÜÔºàÂÆüÈöõ„Å´„ÅØAPI„ÇíÂëº„Å∂Ôºâ
            if (reassignCases) {
                showNotification('ÂâäÈô§ÂÆå‰∫Ü', `${name}„Åï„Çì„ÇíÂâäÈô§„Åó„ÄÅÊ°à‰ª∂„Çí${reassignTo}„Åï„Çì„Å´Âºï„ÅçÁ∂ô„Åé„Åæ„Åó„Åü`);
            } else {
                showNotification('ÂâäÈô§ÂÆå‰∫Ü', `${name}„Åï„Çì„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`);
            }

            // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
            closeDeleteModal();

            // „ÉÜ„Éº„Éñ„É´„Åã„ÇâË°å„ÇíÂâäÈô§Ôºà„Éá„É¢Áî®Ôºâ
            const rows = document.querySelectorAll('#salesSection tbody tr');
            rows.forEach(row => {
                if (row.textContent.includes(name)) {
                    row.style.transition = 'opacity 0.3s';
                    row.style.opacity = '0';
                    setTimeout(() => {
                        row.remove();
                    }, 300);
                }
            });
        }

        // Ê®©Èôê„Éó„É™„Çª„ÉÉ„ÉàË®≠ÂÆö
        function setPreset(preset) {
            const presets = {
                office: ['case.cancel', 'case.contract', 'automail.view', 'report.self', 'company.view'],
                standard: ['case.cancel', 'case.contract', 'automail.view', 'report.self', 'company.view'],
                leader: ['case.view.all', 'case.edit', 'case.hide', 'case.delete', 'case.cancel', 'case.contract', 'finance.view', 'automail.view', 'automail.edit', 'report.self', 'report.all', 'report.export', 'company.view'],
                admin: ['case.view.all', 'case.edit', 'case.hide', 'case.delete', 'case.cancel', 'case.contract', 'automail.view', 'automail.edit', 'finance.view', 'finance.export', 'report.self', 'report.all', 'report.export', 'sales.manage', 'company.view', 'company.edit']
            };
            
            // „Åô„Åπ„Å¶„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Çí„ÇØ„É™„Ç¢
            document.querySelectorAll('.permission-checkbox').forEach(cb => {
                cb.checked = false;
            });
            
            // „Éó„É™„Çª„ÉÉ„Éà„Å´Âü∫„Å•„ÅÑ„Å¶„ÉÅ„Çß„ÉÉ„ÇØ
            if (presets[preset]) {
                presets[preset].forEach(permission => {
                    const checkbox = document.querySelector(`[data-permission="${permission}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            
            // „Éú„Çø„É≥„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white');
            });
            event.target.classList.add('bg-blue-600', 'text-white');
        }

        function savePermissions() {
            const modalTitle = document.getElementById('modalTitle').textContent;
            const isNewSales = modalTitle.includes('Êñ∞Ë¶è');

            if (isNewSales) {
                // Êñ∞Ë¶èËøΩÂä†„ÅÆÂ†¥Âêà
                const name = document.getElementById('newSalesName').value;
                const email = document.getElementById('newSalesEmail').value;
                const phone = document.getElementById('newSalesPhone').value;
                const role = document.getElementById('newSalesRole').value;

                // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥
                if (!name || !email) {
                    alert('Ê∞èÂêç„Å®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅØÂøÖÈ†àÈ†ÖÁõÆ„Åß„Åô');
                    return;
                }

                // „ÉÜ„Éº„Éñ„É´„Å´Êñ∞„Åó„ÅÑË°å„ÇíËøΩÂä†
                addSalesPersonToTable(name, role, email, phone);

                showNotification('ËøΩÂä†ÂÆå‰∫Ü', `${name}„Åï„Çì„ÇíÂñ∂Ê•≠ÊãÖÂΩìËÄÖ„Å®„Åó„Å¶ËøΩÂä†„Åó„Åæ„Åó„Åü`);
            } else {
                // Á∑®ÈõÜ„ÅÆÂ†¥Âêà
                showNotification('Êõ¥Êñ∞ÂÆå‰∫Ü', 'Ê®©ÈôêË®≠ÂÆö„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü');
            }

            closePermissionModal();
        }

        // „ÉÜ„Éº„Éñ„É´„Å´Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„ÇíËøΩÂä†
        function addSalesPersonToTable(name, role, email, phone) {
            const tbody = document.querySelector('#salesSection tbody');
            const newRow = document.createElement('tr');

            // „É≠„Éº„É´„Å´Âøú„Åò„ÅüËâ≤„ÇíË®≠ÂÆö
            let roleColor = 'green';
            let statsDisplay = ['0', '0%'];

            if (role === '„É™„Éº„ÉÄ„Éº') {
                roleColor = 'purple';
            } else if (role === '‰∏ÄËà¨Âñ∂Ê•≠') {
                roleColor = 'blue';
            } else if (role === '‰∏ÄËà¨‰∫ãÂãô') {
                roleColor = 'green';
                statsDisplay = ['-', '-'];  // ‰∫ãÂãô„ÅØÊàêÁ¥ÑÊï∞„ÉªÊàêÁ¥ÑÁéá„Å™„Åó
            } else if (role === 'ÁèæÂ†¥Áõ£Áù£') {
                roleColor = 'yellow';
                statsDisplay = ['-', '-'];  // ÁèæÂ†¥Áõ£Áù£„ÇÇÊàêÁ¥ÑÊï∞„ÉªÊàêÁ¥ÑÁéá„Å™„Åó
            }

            newRow.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${name}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-${roleColor}-100 text-${roleColor}-800">${role}</span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${statsDisplay[0]}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${statsDisplay[1]}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">
                    <button onclick="editPermissions('${name}')" class="text-blue-600 hover:text-blue-900 mr-3">Ê®©ÈôêÁ∑®ÈõÜ</button>
                    <button onclick="confirmDeleteSales('${name}')" class="text-red-600 hover:text-red-900">ÂâäÈô§</button>
                </td>
            `;

            tbody.appendChild(newRow);
        }

        // „É≠„Ç∞„Ç¢„Ç¶„Éà
        window.logout = function() {
            // ‰∏°Êñπ„ÅÆ„Çπ„Éà„É¨„Éº„Ç∏„Çí„ÇØ„É™„Ç¢
            localStorage.removeItem('franchiseUser');
            localStorage.removeItem('franchiseRole');
            localStorage.removeItem('loginTime');
            localStorage.removeItem('rememberLogin');
            sessionStorage.clear();
            location.reload();
        }

        // „Éë„Çπ„ÉØ„Éº„ÉâÂøò„ÇåÂá¶ÁêÜ
        function showForgotPassword() {
            const email = prompt('ÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Çã„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:');
            if (email) {
                alert(`„Éë„Çπ„ÉØ„Éº„Éâ„É™„Çª„ÉÉ„Éà„É™„É≥„ÇØ„Çí ${email} „Å´ÈÄÅ‰ø°„Åó„Åæ„Åó„Åü„ÄÇ\nÔºà„Éá„É¢Áâà„ÅÆ„Åü„ÇÅÂÆüÈöõ„Å´„ÅØÈÄÅ‰ø°„Åï„Çå„Åæ„Åõ„ÇìÔºâ`);
            }
        }
        
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂá¶ÁêÜ
        window.addEventListener('DOMContentLoaded', function() {
            // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åæ„Åü„ÅØ„Çª„ÉÉ„Ç∑„Éß„É≥„Çπ„Éà„É¨„Éº„Ç∏„Åã„ÇâÂæ©ÂÖÉ
            let savedUser = localStorage.getItem('franchiseUser') || sessionStorage.getItem('franchiseUser');
            let savedRole = localStorage.getItem('franchiseRole') || sessionStorage.getItem('franchiseRole');

            if (savedUser && savedRole) {
                // „É≠„Ç∞„Ç§„É≥ÊôÇÈñì„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºà24ÊôÇÈñì„ÅßËá™Âãï„É≠„Ç∞„Ç¢„Ç¶„ÉàÔºâ
                const loginTime = localStorage.getItem('loginTime') || sessionStorage.getItem('loginTime');
                if (loginTime) {
                    const hoursSinceLogin = (new Date() - new Date(loginTime)) / (1000 * 60 * 60);
                    if (hoursSinceLogin > 24) {
                        // „Çª„ÉÉ„Ç∑„Éß„É≥ÊúüÈôêÂàá„Çå - „É≠„Ç∞„Ç§„É≥„Éö„Éº„Ç∏„Å∏
                        localStorage.removeItem('franchiseUser');
                        localStorage.removeItem('franchiseRole');
                        localStorage.removeItem('loginTime');
                        sessionStorage.removeItem('franchiseUser');
                        sessionStorage.removeItem('franchiseRole');
                        sessionStorage.removeItem('loginTime');
                        window.location.href = 'merchant-portal/login.html';
                        return;
                    }
                }

                // „É≠„Ç∞„Ç§„É≥Áä∂ÊÖãÊúâÂäπ - „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâË°®Á§∫
                currentUser = savedUser;
                userRole = savedRole;
                document.getElementById('mainApp').classList.remove('hidden');

                // Âä†ÁõüÂ∫ó„Éá„Éº„Çø„Å®„Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÂèñÂæó„Åó„Å¶„Åã„ÇâË°®Á§∫„ÇíÊõ¥Êñ∞
                Promise.all([
                    fetchMerchantData(savedUser),
                    loadMerchantStatus(savedUser)
                ]).then(() => {
                    updateRoleDisplay();
                    showSection('dashboard');

                    // ÂàùÂõû„É≠„Ç∞„Ç§„É≥ÊôÇ„ÅÆÂàùÊúüË®≠ÂÆöÔºà„Éá„Éº„ÇøÂèñÂæóÂæå„Å´ÂÆüË°åÔºâ
                    console.log('[DOMContentLoaded] merchantData loaded, calling initializeFirstLoginSettings');
                    console.log('[DOMContentLoaded] window.merchantData:', window.merchantData ? 'exists' : 'null');
                    initializeFirstLoginSettings();
                }).catch(error => {
                    console.error('Failed to fetch merchant data or status:', error);
                    updateRoleDisplay();
                    showSection('dashboard');

                    // „Ç®„É©„ÉºÊôÇ„Åß„ÇÇÂàùÊúüË®≠ÂÆö„ÇíÂÆüË°å
                    console.log('[DOMContentLoaded] Error occurred, calling initializeFirstLoginSettings anyway');
                    initializeFirstLoginSettings();
                });

                // Ê°à‰ª∂„Ç´„Éº„Éâ„ÇíÂàùÊúüÂåñ
                setTimeout(() => {
                    renderCaseCards();
                    updateCaseCounts();
                }, 50);

                // „Ç´„É¨„É≥„ÉÄ„Éº„ÇíÂàùÊúüÂåñ
                setTimeout(() => {
                    initCalendar();
                }, 100);

                // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Éú„Çø„É≥„Å´„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†Ôºà„Çπ„Éû„ÉõÂØæÂøúÔºâ
                setTimeout(() => {
                    const saveBtn = document.getElementById('saveAutodeliveryBtn');
                    if (saveBtn) {
                        const handleSave = async function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('Save button event triggered');
                            try {
                                await saveAutoDeliverySettings();
                            } catch (error) {
                                console.error('Error in saveAutoDeliverySettings:', error);
                                alert('„Ç®„É©„Éº: ' + error.message);
                            }
                        };
                        saveBtn.addEventListener('click', handleSave);
                        saveBtn.addEventListener('touchend', handleSave);
                        console.log('Save button event listeners attached');
                    } else {
                        console.error('Save button not found!');
                    }
                }, 200);
            } else {
                // Êú™„É≠„Ç∞„Ç§„É≥ - „É≠„Ç∞„Ç§„É≥„Éö„Éº„Ç∏„Å∏„É™„ÉÄ„Ç§„É¨„ÇØ„Éà
                window.location.href = 'merchant-portal/login.html';
            }
        });

        // Áµ±ÂêàË®≠ÂÆö‰øùÂ≠ò
        function saveAllSettings() {
            // „Éó„É≠„Éï„Ç£„Éº„É´‰øùÂ≠ò
            saveProfile();

            // ÈÄöÁü•Ë®≠ÂÆö‰øùÂ≠ò
            saveNotificationSettings();

            showNotification('Ë®≠ÂÆö‰øùÂ≠ò', '„Åô„Åπ„Å¶„ÅÆË®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü', 'success');
        }
        
        // ÈÄöÁü•„ÉÜ„Çπ„Éà
        function testNotification(type) {
            const messages = {
                'email': '„ÉÜ„Çπ„Éà„É°„Éº„É´„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü',
                'sms': '„ÉÜ„Çπ„ÉàSMS„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü',
                'line': '„ÉÜ„Çπ„ÉàLINE„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü',
                'browser': '„Éñ„É©„Ç¶„Ç∂ÈÄöÁü•„ÅÆ„ÉÜ„Çπ„Éà'
            };
            
            if (type === 'browser') {
                showNotification('ÈÄöÁü•„ÉÜ„Çπ„Éà', messages[type]);
            } else {
                alert(messages[type] + '\nÔºà„Éá„É¢Áâà„ÅÆ„Åü„ÇÅÂÆüÈöõ„Å´„ÅØÈÄÅ‰ø°„Åï„Çå„Åæ„Åõ„ÇìÔºâ');
            }
        }
        
        // ÈÄöÁü•ÊôÇÈñìË®≠ÂÆö„ÅÆË°®Á§∫/ÈùûË°®Á§∫
        function toggleQuietHours() {
            const enabled = document.getElementById('enableQuietHours').checked;
            const settings = document.getElementById('quietHoursSettings');
            settings.classList.toggle('hidden', !enabled);
        }

        // ‰ºëÊó•Ë®≠ÂÆö„ÅÆË°®Á§∫/ÈùûË°®Á§∫Âàá„ÇäÊõø„Åà
        function toggleHolidaySettings() {
            const enabled = document.getElementById('enableHolidays').checked;
            const settings = document.getElementById('holidaySettings');
            settings.classList.toggle('hidden', !enabled);
        }
        
        // „Éó„É≠„Éï„Ç£„Éº„É´‰øùÂ≠ò
        function saveProfile() {
            const profile = {
                name: document.getElementById('profileName').value,
                phone: document.getElementById('profilePhone').value,
                email: document.getElementById('profileEmail').value,
                lineId: document.getElementById('profileLineId').value
            };
            localStorage.setItem('userProfile', JSON.stringify(profile));
            alert('„Éó„É≠„Éï„Ç£„Éº„É´„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
        }
        
        // ÈÄöÁü•Ë®≠ÂÆö‰øùÂ≠ò
        function saveNotificationSettings() {
            const settings = {
                email: document.getElementById('notifyEmail').checked,
                sms: document.getElementById('notifySms').checked,
                line: document.getElementById('notifyLine').checked,
                browser: document.getElementById('notifyBrowser').checked,
                alerts: {
                    appointment_reminder: {
                        enabled: document.getElementById('appointmentReminder').checked,
                        time: document.getElementById('appointmentAlertTime').value
                    },
                    call_reminder: {
                        enabled: document.getElementById('callReminder').checked,
                        time: document.getElementById('callAlertTime').value
                    },
                    estimate_followup: {
                        enabled: document.getElementById('estimateFollowup').checked,
                        days: document.getElementById('followupDays').value
                    },
                    payment_alert: {
                        enabled: document.getElementById('paymentAlert').checked
                    }
                },
                holidays: {
                    enabled: document.getElementById('enableHolidays').checked,
                    mon: document.getElementById('holidayMon').checked,
                    tue: document.getElementById('holidayTue').checked,
                    wed: document.getElementById('holidayWed').checked,
                    thu: document.getElementById('holidayThu').checked,
                    fri: document.getElementById('holidayFri').checked,
                    sat: document.getElementById('holidaySat').checked,
                    sun: document.getElementById('holidaySun').checked
                },
                quietHours: {
                    enabled: document.getElementById('enableQuietHours').checked,
                    start: document.getElementById('quietStart').value,
                    end: document.getElementById('quietEnd').value
                }
            };
            localStorage.setItem('notificationSettings', JSON.stringify(settings));
        }
        
        // Ë°®Á§∫Ë®≠ÂÆö‰øùÂ≠ò
        function saveDisplaySettings() {
            alert('Ë°®Á§∫Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
        }
        
        // „Ç´„É¨„É≥„ÉÄ„ÉºÊ©üËÉΩ
        let currentDate = new Date();
        let currentView = 'month';
        
        // Êó•Êú¨„ÅÆÁ•ùÊó•„Éá„Éº„ÇøÔºà2024Âπ¥„Éª2025Âπ¥Ôºâ
        const japaneseHolidays = {
            '2024-01-01': 'ÂÖÉÊó•',
            '2024-01-08': 'Êàê‰∫∫„ÅÆÊó•',
            '2024-02-11': 'Âª∫ÂõΩË®òÂøµ„ÅÆÊó•',
            '2024-02-12': 'ÊåØÊõø‰ºëÊó•',
            '2024-02-23': 'Â§©ÁöáË™ïÁîüÊó•',
            '2024-03-20': 'Êò•ÂàÜ„ÅÆÊó•',
            '2024-04-29': 'Êò≠Âíå„ÅÆÊó•',
            '2024-05-03': 'ÊÜ≤Ê≥ïË®òÂøµÊó•',
            '2024-05-04': '„Åø„Å©„Çä„ÅÆÊó•',
            '2024-05-05': '„Åì„Å©„ÇÇ„ÅÆÊó•',
            '2024-05-06': 'ÊåØÊõø‰ºëÊó•',
            '2024-07-15': 'Êµ∑„ÅÆÊó•',
            '2024-08-11': 'Â±±„ÅÆÊó•',
            '2024-08-12': 'ÊåØÊõø‰ºëÊó•',
            '2024-09-16': 'Êï¨ËÄÅ„ÅÆÊó•',
            '2024-09-22': 'ÁßãÂàÜ„ÅÆÊó•',
            '2024-09-23': 'ÊåØÊõø‰ºëÊó•',
            '2024-10-14': '„Çπ„Éù„Éº„ÉÑ„ÅÆÊó•',
            '2024-11-03': 'ÊñáÂåñ„ÅÆÊó•',
            '2024-11-04': 'ÊåØÊõø‰ºëÊó•',
            '2024-11-23': 'Âã§Âä¥ÊÑüË¨ù„ÅÆÊó•',
            '2025-01-01': 'ÂÖÉÊó•',
            '2025-01-13': 'Êàê‰∫∫„ÅÆÊó•',
            '2025-02-11': 'Âª∫ÂõΩË®òÂøµ„ÅÆÊó•',
            '2025-02-23': 'Â§©ÁöáË™ïÁîüÊó•',
            '2025-02-24': 'ÊåØÊõø‰ºëÊó•',
            '2025-03-20': 'Êò•ÂàÜ„ÅÆÊó•',
            '2025-04-29': 'Êò≠Âíå„ÅÆÊó•',
            '2025-05-03': 'ÊÜ≤Ê≥ïË®òÂøµÊó•',
            '2025-05-04': '„Åø„Å©„Çä„ÅÆÊó•',
            '2025-05-05': '„Åì„Å©„ÇÇ„ÅÆÊó•',
            '2025-05-06': 'ÊåØÊõø‰ºëÊó•',
            '2025-07-21': 'Êµ∑„ÅÆÊó•',
            '2025-08-11': 'Â±±„ÅÆÊó•',
            '2025-09-15': 'Êï¨ËÄÅ„ÅÆÊó•',
            '2025-09-23': 'ÁßãÂàÜ„ÅÆÊó•',
            '2025-10-13': '„Çπ„Éù„Éº„ÉÑ„ÅÆÊó•',
            '2025-11-03': 'ÊñáÂåñ„ÅÆÊó•',
            '2025-11-23': 'Âã§Âä¥ÊÑüË¨ù„ÅÆÊó•',
            '2025-11-24': 'ÊåØÊõø‰ºëÊó•'
        };
        
        let calendarEvents = [
            {
                id: 1,
                title: 'Áî∞‰∏≠Êßò ÁèæÂú∞Ë™øÊüª',
                date: '2024-01-15',
                time: '14:00',
                type: 'hearing',
                color: 'blue'
            },
            {
                id: 2,
                title: '‰ΩêËó§Êßò Â∑•‰∫ãÈñãÂßã',
                date: '2024-01-20',
                time: '09:00',
                type: 'construction',
                color: 'green'
            },
            {
                id: 3,
                title: 'Èà¥Êú®Êßò Ë¶ãÁ©ç„ÇÇ„ÇäÊèêÂá∫',
                date: '2024-01-25',
                time: '16:00',
                type: 'estimate',
                color: 'yellow'
            }
        ];
        
        // „Ç´„É¨„É≥„ÉÄ„ÉºÂàùÊúüÂåñ
        function initCalendar() {
            renderCalendar();
            renderMiniCalendar();
        }
        
        // „Ç´„É¨„É≥„ÉÄ„ÉºÊèèÁîª
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // ÊúàË°®Á§∫„ÇíÊõ¥Êñ∞
            const monthNames = ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà', '7Êúà', '8Êúà', '9Êúà', '10Êúà', '11Êúà', '12Êúà'];
            const monthElement = document.getElementById('currentMonth');
            if (monthElement) {
                monthElement.textContent = `${year}Âπ¥${monthNames[month]}`;
            }
            
            // „Ç´„É¨„É≥„ÉÄ„Éº„Ç∞„É™„ÉÉ„Éâ„ÇíÁîüÊàê
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            const prevLastDate = new Date(year, month, 0).getDate();
            
            let html = '';
            let date = 1;
            
            // 6ÈÄ±ÈñìÂàÜ„ÅÆ„Ç∞„É™„ÉÉ„Éâ„ÇíÁîüÊàê
            for (let week = 0; week < 6; week++) {
                let weekHasDate = false;
                for (let day = 0; day < 7; day++) {
                    let cellDate = '';
                    let cellStyle = 'border: 1px solid #e5e7eb; padding: 8px; min-height: 100px; position: relative; background: white;';
                    let cellContent = '';
                    
                    if (week === 0 && day < firstDay) {
                        // ÂâçÊúà„ÅÆÊó•‰ªò
                        cellDate = prevLastDate - firstDay + day + 1;
                        cellStyle += ' color: #9ca3af; background: #f9fafb;';
                        html += `
                            <div style="${cellStyle}" data-date="${cellDate}">
                                <div style="font-weight: 500; font-size: 14px;">${cellDate}</div>
                            </div>
                        `;
                    } else if (date > lastDate) {
                        // Ê¨°Êúà„ÅÆÊó•‰ªò
                        cellDate = date - lastDate;
                        cellStyle += ' color: #9ca3af; background: #f9fafb;';
                        html += `
                            <div style="${cellStyle}" data-date="${cellDate}">
                                <div style="font-weight: 500; font-size: 14px;">${cellDate}</div>
                            </div>
                        `;
                        date++;
                    } else {
                        weekHasDate = true;
                        // ÂΩìÊúà„ÅÆÊó•‰ªò
                        cellDate = date;
                        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                        
                        // ÈÄ±Êú´„Å®Á•ùÊó•„ÅÆËÉåÊôØËâ≤Ë®≠ÂÆö
                        const isHoliday = japaneseHolidays[dateStr];
                        if (day === 0 || isHoliday) {
                            // Êó•ÊõúÊó•„Åæ„Åü„ÅØÁ•ùÊó•„ÅØËñÑ„ÅÑËµ§
                            cellStyle += ' background: #fee2e2;';
                        } else if (day === 6) {
                            // ÂúüÊõúÊó•„ÅØËñÑ„ÅÑÊ∞¥Ëâ≤
                            cellStyle += ' background: #e0f2fe;';
                        }
                        
                        // ‰ªäÊó•„ÅÆÊó•‰ªò„ÇíÂº∑Ë™ø
                        const today = new Date();
                        const isToday = year === today.getFullYear() && month === today.getMonth() && date === today.getDate();
                        if (isToday) {
                            cellStyle = cellStyle.replace(/background:[^;]+;/, 'background: #eff6ff;');
                            cellStyle += ' border: 2px solid #3b82f6;';
                        }
                        
                        // „Ç§„Éô„É≥„Éà„ÇíË°®Á§∫
                        const dayEvents = calendarEvents.filter(e => e.date === dateStr);
                        if (dayEvents.length > 0) {
                            cellContent = '<div class="mt-1 space-y-1">';
                            dayEvents.forEach(event => {
                                const bgColor = {
                                    'blue': 'bg-blue-500',
                                    'green': 'bg-green-500',
                                    'yellow': 'bg-yellow-500',
                                    'purple': 'bg-purple-500',
                                    'red': 'bg-red-500'
                                }[event.color] || 'bg-gray-500';
                                
                                cellContent += `
                                    <div class="text-xs p-1 ${bgColor} text-white rounded truncate cursor-pointer hover:opacity-80 event-item" 
                                         draggable="true"
                                         data-event-id="${event.id}"
                                         onclick="showEventDetail(${event.id})" 
                                         oncontextmenu="showEventMenu(event, ${event.id})"
                                         ondragstart="handleDragStart(event, ${event.id})"
                                         title="${event.title}">
                                        ${event.time ? event.time + ' ' : ''}${event.title}
                                    </div>
                                `;
                            });
                            cellContent += '</div>';
                        }
                        
                        // Á•ùÊó•Âêç„ÇíËøΩÂä†
                        let holidayLabel = '';
                        if (isHoliday) {
                            holidayLabel = `<div style="font-size: 10px; color: #dc2626; font-weight: 500;">${isHoliday}</div>`;
                        }
                        
                        // html„Å´ËøΩÂä†
                        const originalBg = isToday ? '#eff6ff' : (day === 0 || isHoliday ? '#fee2e2' : day === 6 ? '#e0f2fe' : 'white');
                        const hoverBg = isToday ? '#dbeafe' : (day === 0 || isHoliday ? '#fecaca' : day === 6 ? '#bae6fd' : '#f9fafb');
                        
                        html += `
                            <div style="${cellStyle}" 
                                 data-date="${cellDate}"
                                 data-full-date="${dateStr}"
                                 ondrop="handleDrop(event)"
                                 ondragover="handleDragOver(event)"
                                 ondragleave="handleDragLeave(event)"
                                 onclick="handleCellClick(event)"
                                 onmouseover="this.style.background='${hoverBg}'"
                                 onmouseout="this.style.background='${originalBg}'">
                                <div style="font-weight: 500; font-size: 14px; ${day === 0 || isHoliday ? 'color: #dc2626;' : day === 6 ? 'color: #0284c7;' : ''}">${cellDate}</div>
                                ${holidayLabel}
                                ${cellContent}
                            </div>
                        `;
                        
                        date++;
                    }
                }
                
                // ÈÄ±„Å´Êó•‰ªò„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÁµÇ‰∫Ü
                if (!weekHasDate && date > lastDate) break;
            }
            
            const calendarGrid = document.getElementById('calendarGrid');
            if (calendarGrid) {
                calendarGrid.innerHTML = html;
            }
        }
        
        // „Éü„Éã„Ç´„É¨„É≥„ÉÄ„ÉºÊèèÁîª
        function renderMiniCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const today = new Date();
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            
            let html = '<div class="grid grid-cols-7 gap-1 text-xs">';
            
            // ÊõúÊó•„Éò„ÉÉ„ÉÄ„Éº
            const weekDays = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            weekDays.forEach(day => {
                html += `<div class="text-center font-medium text-gray-500 py-1">${day}</div>`;
            });
            
            // Á©∫ÁôΩ„Çª„É´
            for (let i = 0; i < firstDay; i++) {
                html += '<div></div>';
            }
            
            // Êó•‰ªò„Çª„É´
            for (let date = 1; date <= lastDate; date++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const hasEvent = calendarEvents.some(e => e.date === dateStr);
                const isToday = year === today.getFullYear() && month === today.getMonth() && date === today.getDate();
                
                let cellClass = 'text-center py-1 cursor-pointer hover:bg-gray-100 rounded';
                if (isToday) cellClass += ' bg-blue-500 text-white hover:bg-blue-600';
                else if (hasEvent) cellClass += ' font-bold text-blue-600';
                
                html += `<div class="${cellClass}" onclick="goToDate('${dateStr}')">${date}</div>`;
            }
            
            html += '</div>';
            
            const miniCalendar = document.getElementById('miniCalendar');
            if (miniCalendar) {
                miniCalendar.innerHTML = html;
            }
        }
        
        // „Ç´„É¨„É≥„ÉÄ„Éº„Éì„É•„ÉºÂàá„ÇäÊõø„Åà
        function changeCalendarView(view) {
            currentView = view;
            
            // „Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.calendar-view-btn').forEach(btn => {
                btn.classList.remove('text-blue-600', 'bg-blue-50');
                btn.classList.add('text-gray-600');
            });
            
            // „ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åü„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÊõ¥Êñ∞
            if (event && event.target) {
                event.target.classList.remove('text-gray-600');
                event.target.classList.add('text-blue-600', 'bg-blue-50');
            }
            
            // „Éì„É•„Éº„ÇíÂàá„ÇäÊõø„Åà
            document.getElementById('calendarMonthView').classList.toggle('hidden', view !== 'month');
            document.getElementById('calendarWeekView').classList.toggle('hidden', view !== 'week');
            document.getElementById('calendarDayView').classList.toggle('hidden', view !== 'day');
            
            // ÂØæÂøú„Åô„Çã„Éì„É•„Éº„ÇíÊèèÁîª
            if (view === 'month') {
                renderCalendar();
            } else if (view === 'week') {
                renderWeekView();
            } else if (view === 'day') {
                renderDayView();
            }
        }

        // ÈÄ±Ë°®Á§∫„ÇíÊèèÁîª
        function renderWeekView() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const date = currentDate.getDate();
            
            // ‰ªäÈÄ±„ÅÆÊó•ÊõúÊó•„ÇíË®àÁÆó
            const today = new Date(year, month, date);
            const dayOfWeek = today.getDay();
            const weekStart = new Date(today);
            weekStart.setDate(date - dayOfWeek);
            
            // ÈÄ±Ë°®Á§∫„ÅÆ„Éò„ÉÉ„ÉÄ„Éº
            let html = '';
            
            // ÊôÇÈñìËª∏„Éò„ÉÉ„ÉÄ„Éº
            html += '<div class="border-b border-r p-2 bg-gray-50 font-medium text-center">ÊôÇÈñì</div>';
            
            // ÊõúÊó•„Éò„ÉÉ„ÉÄ„Éº
            const weekDays = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            for (let i = 0; i < 7; i++) {
                const dayDate = new Date(weekStart);
                dayDate.setDate(weekStart.getDate() + i);
                const dayStr = `${dayDate.getMonth() + 1}/${dayDate.getDate()}`;
                const isToday = dayDate.toDateString() === new Date().toDateString();
                
                html += `<div class="border-b border-r p-2 bg-gray-50 text-center ${isToday ? 'bg-blue-50 text-blue-600 font-bold' : ''}">
                    <div class="text-xs text-gray-500">${weekDays[i]}</div>
                    <div class="font-medium">${dayStr}</div>
                </div>`;
            }
            
            // ÊôÇÈñì„Çπ„É≠„ÉÉ„ÉàÔºà8:00-20:00Ôºâ
            for (let hour = 8; hour <= 20; hour++) {
                // ÊôÇÈñì„É©„Éô„É´
                html += `<div class="border-b border-r p-2 bg-gray-50 text-xs text-center">${String(hour).padStart(2, '0')}:00</div>`;
                
                // ÂêÑÊõúÊó•„ÅÆ„Çª„É´
                for (let i = 0; i < 7; i++) {
                    const dayDate = new Date(weekStart);
                    dayDate.setDate(weekStart.getDate() + i);
                    const dateStr = dayDate.toISOString().split('T')[0];
                    
                    // „Åù„ÅÆÊôÇÈñìÂ∏Ø„ÅÆ„Ç§„Éô„É≥„Éà„ÇíÂèñÂæó
                    const hourEvents = calendarEvents.filter(e => {
                        if (e.date !== dateStr || !e.time) return false;
                        const eventHour = parseInt(e.time.split(':')[0]);
                        return eventHour === hour;
                    });
                    
                    let cellContent = '';
                    if (hourEvents.length > 0) {
                        hourEvents.forEach(event => {
                            const bgColor = {
                                'blue': 'bg-blue-500',
                                'green': 'bg-green-500',
                                'yellow': 'bg-yellow-500',
                                'purple': 'bg-purple-500',
                                'red': 'bg-red-500'
                            }[event.color] || 'bg-gray-500';
                            
                            cellContent += `<div class="text-xs p-1 ${bgColor} text-white rounded mb-1 cursor-pointer hover:opacity-80" 
                                onclick="showEventDetail(${event.id})" title="${event.title}">
                                ${event.time} ${event.title}
                            </div>`;
                        });
                    }
                    
                    html += `<div class="border-b border-r p-1 h-12 hover:bg-gray-50 cursor-pointer" 
                        data-date="${dateStr}" data-hour="${hour}" onclick="createEventAtTime('${dateStr}', ${hour})">
                        ${cellContent}
                    </div>`;
                }
            }
            
            document.getElementById('weekGrid').innerHTML = html;
        }

        // Êó•Ë°®Á§∫„ÇíÊèèÁîª
        function renderDayView() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const date = currentDate.getDate();
            
            const dayDate = new Date(year, month, date);
            const dateStr = dayDate.toISOString().split('T')[0];
            const weekDays = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            const dayOfWeek = dayDate.getDay();
            
            // Êó•‰ªòË°®Á§∫„ÇíÊõ¥Êñ∞
            document.getElementById('dayViewDate').textContent = 
                `${year}Âπ¥${month + 1}Êúà${date}Êó•Ôºà${weekDays[dayOfWeek]}Ôºâ`;
            
            // ÊôÇÈñì„Çπ„É≠„ÉÉ„Éà„ÇíÁîüÊàê
            let html = '';
            for (let hour = 6; hour <= 22; hour++) {
                const hourEvents = calendarEvents.filter(e => {
                    if (e.date !== dateStr || !e.time) return false;
                    const eventHour = parseInt(e.time.split(':')[0]);
                    return eventHour === hour;
                });
                
                let eventContent = '';
                if (hourEvents.length > 0) {
                    hourEvents.forEach(event => {
                        const bgColor = {
                            'blue': 'bg-blue-500',
                            'green': 'bg-green-500',
                            'yellow': 'bg-yellow-500',
                            'purple': 'bg-purple-500',
                            'red': 'bg-red-500'
                        }[event.color] || 'bg-gray-500';
                        
                        eventContent += `<div class="p-2 ${bgColor} text-white rounded mb-2 cursor-pointer hover:opacity-80" 
                            onclick="showEventDetail(${event.id})">
                            <div class="font-medium">${event.time} ${event.title}</div>
                            <div class="text-sm opacity-90">${event.type}</div>
                        </div>`;
                    });
                }
                
                html += `
                    <div class="flex border-b hover:bg-gray-50">
                        <div class="w-20 p-3 bg-gray-50 text-sm font-medium text-center border-r">
                            ${String(hour).padStart(2, '0')}:00
                        </div>
                        <div class="flex-1 p-3 min-h-16 cursor-pointer" 
                             data-date="${dateStr}" data-hour="${hour}" 
                             onclick="createEventAtTime('${dateStr}', ${hour})">
                            ${eventContent}
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('dayTimeSlots').innerHTML = html;
        }

        // ÁâπÂÆö„ÅÆÊôÇÈñì„Å´Êñ∞Ë¶è„Ç§„Éô„É≥„Éà„Çí‰ΩúÊàê
        function createEventAtTime(date, hour) {
            const time = `${String(hour).padStart(2, '0')}:00`;
            showEventModal(null, date, time);
        }
        
        // ÂâçÊúà„Å∏
        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }
        
        // Ê¨°Êúà„Å∏
        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }
        
        // ÁâπÂÆö„ÅÆÊó•‰ªò„Å∏„Ç∏„É£„É≥„Éó
        function goToDate(dateStr) {
            const [year, month, day] = dateStr.split('-').map(Number);
            currentDate = new Date(year, month - 1, day);
            showSection('calendar');
            renderCalendar();
        }
        
        // „Ç§„Éô„É≥„ÉàË©≥Á¥∞Ë°®Á§∫
        function showEventDetail(eventId) {
            const event = calendarEvents.find(e => e.id === eventId);
            if (event) {
                alert(`${event.title}\nÊó•ÊôÇ: ${event.date} ${event.time || ''}\nÁ®ÆÂà•: ${event.type}`);
            }
        }
        
        // „Éâ„É©„ÉÉ„Ç∞ & „Éâ„É≠„ÉÉ„ÉóÊ©üËÉΩ
        let draggedEventId = null;

        function handleDragStart(e, eventId) {
            draggedEventId = eventId;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.outerHTML);
            e.target.classList.add('opacity-50');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            const cell = e.currentTarget;
            if (cell.dataset.fullDate) {
                cell.classList.add('bg-blue-100', 'border-2', 'border-blue-400');
            }
        }

        function handleDragLeave(e) {
            const cell = e.currentTarget;
            cell.classList.remove('bg-blue-100', 'border-2', 'border-blue-400');
        }

        function handleDrop(e) {
            e.preventDefault();
            const cell = e.currentTarget;
            cell.classList.remove('bg-blue-100', 'border-2', 'border-blue-400');
            
            const newDate = cell.dataset.fullDate;
            if (newDate && draggedEventId) {
                // „Ç§„Éô„É≥„Éà„ÅÆÊó•‰ªò„ÇíÊõ¥Êñ∞
                const eventIndex = calendarEvents.findIndex(event => event.id === draggedEventId);
                if (eventIndex !== -1) {
                    calendarEvents[eventIndex].date = newDate;
                    renderCalendar();
                    renderMiniCalendar();
                    showNotification('‰∫àÂÆöÁßªÂãï', `‰∫àÂÆö„Çí${newDate}„Å´ÁßªÂãï„Åó„Åæ„Åó„Åü`);
                }
            }
            draggedEventId = null;
        }

        // „Çª„É´„ÇØ„É™„ÉÉ„ÇØÔºàÊñ∞Ë¶è„Ç§„Éô„É≥„Éà‰ΩúÊàêÔºâ
        function handleCellClick(e) {
            if (e.target.classList.contains('event-item')) return; // „Ç§„Éô„É≥„Éà„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà„ÅØÁÑ°Ë¶ñ
            
            const cell = e.currentTarget;
            const date = cell.dataset.fullDate;
            if (date) {
                showEventModal(null, date);
            }
        }

        // „Ç§„Éô„É≥„ÉàÂè≥„ÇØ„É™„ÉÉ„ÇØ„É°„Éã„É•„Éº
        function showEventMenu(e, eventId) {
            e.preventDefault();
            if (confirm('„Åì„ÅÆ‰∫àÂÆö„ÇíÁ∑®ÈõÜ„Åó„Åæ„Åô„ÅãÔºü')) {
                const event = calendarEvents.find(ev => ev.id === eventId);
                if (event) {
                    showEventModal(event);
                }
            }
        }


        // „Ç§„Éô„É≥„Éà„É¢„Éº„ÉÄ„É´Ë°®Á§∫
        function showEventModal(event = null, date = null, time = '') {
            const isEdit = !!event;
            const modalTitle = isEdit ? '‰∫àÂÆö„ÇíÁ∑®ÈõÜ' : 'Êñ∞Ë¶è‰∫àÂÆö„ÇíËøΩÂä†';
            
            const title = isEdit ? event.title : '';
            const eventDate = isEdit ? event.date : (date || new Date().toISOString().split('T')[0]);
            const eventTime = isEdit ? (event.time || '') : time;
            const type = isEdit ? event.type : 'custom';
            const color = isEdit ? event.color : 'blue';
            
            const modal = `
                <div id="eventModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-lg p-6 w-96 max-w-full mx-4">
                        <h3 class="text-lg font-semibold mb-4">${modalTitle}</h3>
                        <form id="eventForm" onsubmit="saveEvent(event, ${isEdit ? event.id : 'null'})">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">„Çø„Ç§„Éà„É´</label>
                                    <input type="text" id="eventTitle" value="${title}" class="w-full px-3 py-2 border rounded-md" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Êó•‰ªò</label>
                                    <input type="date" id="eventDate" value="${eventDate}" class="w-full px-3 py-2 border rounded-md" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ÊôÇÈñì</label>
                                    <input type="time" id="eventTime" value="${eventTime}" class="w-full px-3 py-2 border rounded-md">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Á®ÆÂà•</label>
                                    <select id="eventType" class="w-full px-3 py-2 border rounded-md">
                                        <option value="hearing" ${type === 'hearing' ? 'selected' : ''}>ÁèæÂú∞Ë™øÊüª</option>
                                        <option value="construction" ${type === 'construction' ? 'selected' : ''}>Â∑•‰∫ã</option>
                                        <option value="estimate" ${type === 'estimate' ? 'selected' : ''}>Ë¶ãÁ©ç„ÇÇ„Çä</option>
                                        <option value="meeting" ${type === 'meeting' ? 'selected' : ''}>Êâì„Å°Âêà„Çè„Åõ</option>
                                        <option value="custom" ${type === 'custom' ? 'selected' : ''}>„Åù„ÅÆ‰ªñ</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Ëâ≤</label>
                                    <div class="flex space-x-2">
                                        <button type="button" onclick="selectColor('blue')" class="w-8 h-8 rounded-full bg-blue-500 ${color === 'blue' ? 'ring-2 ring-offset-2 ring-blue-400' : ''}"></button>
                                        <button type="button" onclick="selectColor('green')" class="w-8 h-8 rounded-full bg-green-500 ${color === 'green' ? 'ring-2 ring-offset-2 ring-green-400' : ''}"></button>
                                        <button type="button" onclick="selectColor('yellow')" class="w-8 h-8 rounded-full bg-yellow-500 ${color === 'yellow' ? 'ring-2 ring-offset-2 ring-yellow-400' : ''}"></button>
                                        <button type="button" onclick="selectColor('purple')" class="w-8 h-8 rounded-full bg-purple-500 ${color === 'purple' ? 'ring-2 ring-offset-2 ring-purple-400' : ''}"></button>
                                        <button type="button" onclick="selectColor('red')" class="w-8 h-8 rounded-full bg-red-500 ${color === 'red' ? 'ring-2 ring-offset-2 ring-red-400' : ''}"></button>
                                    </div>
                                    <input type="hidden" id="eventColor" value="${color}">
                                </div>
                            </div>
                            <div class="flex justify-end space-x-3 mt-6">
                                ${isEdit ? '<button type="button" onclick="deleteEvent(' + event.id + ')" class="px-4 py-2 text-red-600 hover:bg-red-50 rounded-md">ÂâäÈô§</button>' : ''}
                                <button type="button" onclick="closeEventModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">„Ç≠„É£„É≥„Çª„É´</button>
                                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">‰øùÂ≠ò</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
        }

        // Ëâ≤ÈÅ∏Êäû
        let selectedColor = 'blue';
        function selectColor(color) {
            selectedColor = color;
            document.getElementById('eventColor').value = color;
            
            // „Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÊõ¥Êñ∞
            document.querySelectorAll('#eventModal button[onclick^="selectColor"]').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-offset-2');
            });
            event.target.classList.add('ring-2', 'ring-offset-2');
        }

        // „Ç§„Éô„É≥„Éà‰øùÂ≠ò
        function saveEvent(e, eventId) {
            e.preventDefault();
            
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const type = document.getElementById('eventType').value;
            const color = document.getElementById('eventColor').value;
            
            if (eventId) {
                // Á∑®ÈõÜ
                const eventIndex = calendarEvents.findIndex(event => event.id === eventId);
                if (eventIndex !== -1) {
                    calendarEvents[eventIndex] = {
                        ...calendarEvents[eventIndex],
                        title, date, time, type, color
                    };
                }
            } else {
                // Êñ∞Ë¶è‰ΩúÊàê
                const newEvent = {
                    id: Math.max(...calendarEvents.map(e => e.id), 0) + 1,
                    title, date, time, type, color
                };
                calendarEvents.push(newEvent);
            }
            
            renderCalendar();
            renderMiniCalendar();
            closeEventModal();
            showNotification('‰∫àÂÆö‰øùÂ≠ò', eventId ? '‰∫àÂÆö„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü' : 'Êñ∞„Åó„ÅÑ‰∫àÂÆö„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü');
        }

        // „Ç§„Éô„É≥„ÉàÂâäÈô§
        function deleteEvent(eventId) {
            if (confirm('„Åì„ÅÆ‰∫àÂÆö„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                const eventIndex = calendarEvents.findIndex(event => event.id === eventId);
                if (eventIndex !== -1) {
                    calendarEvents.splice(eventIndex, 1);
                    renderCalendar();
                    renderMiniCalendar();
                    closeEventModal();
                    showNotification('‰∫àÂÆöÂâäÈô§', '‰∫àÂÆö„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
                }
            }
        }

        // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeEventModal() {
            const modal = document.getElementById('eventModal');
            if (modal) {
                modal.remove();
            }
        }

        // Êñ∞Ë¶è„Ç§„Éô„É≥„ÉàËøΩÂä†Ôºà„Éú„Çø„É≥„Åã„ÇâÔºâ
        function addNewEvent() {
            const today = new Date().toISOString().split('T')[0];
            showEventModal(null, today);
        }
        
        // ========== Ë´ãÊ±ÇÁÆ°ÁêÜÊ©üËÉΩ ==========
        
        // Ë´ãÊ±ÇÁÆ°ÁêÜ„Çø„ÉñÂàá„ÇäÊõø„Åà
        function showBillingTab(tabName) {
            // ÂÖ®„Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÈùûË°®Á§∫
            document.querySelectorAll('.billing-tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // ÂÖ®„Çø„Éñ„Éú„Çø„É≥„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíËß£Èô§
            document.querySelectorAll('.billing-tab').forEach(tab => {
                tab.classList.remove('billing-tab-active', 'text-blue-600', 'border-blue-600');
                tab.classList.add('text-gray-500', 'border-transparent');
            });
            
            // „Çø„ÉñÂêç„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞ÔºàÊñ∞„Åó„ÅÑ„Çø„ÉñÂêç„Å´ÂØæÂøúÔºâ
            const tabMapping = {
                'purchase': 'purchaseTab',
                'commission': 'commissionTab',
                'payment': 'paymentTab',
                'analysis': 'analysisTab',
                // ‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅÂè§„ÅÑ„Çø„ÉñÂêç„ÇÇÊÆã„Åô
                'referral': 'purchaseTab',
                'success': 'commissionTab',
                'invoices': 'paymentTab',
                'schedule': 'analysisTab'
            };

            // ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Éñ„ÇíË°®Á§∫
            const tabId = tabMapping[tabName] || (tabName + 'Tab');
            const selectedContent = document.getElementById(tabId);
            if (selectedContent) {
                selectedContent.style.display = 'block';
            }
            
            // ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Éñ„Éú„Çø„É≥„Çí„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´
            const selectedTab = document.querySelector(`[data-tab="${tabName}"]`);
            if (selectedTab) {
                selectedTab.classList.remove('text-gray-500', 'border-transparent');
                selectedTab.classList.add('billing-tab-active', 'text-blue-600', 'border-blue-600');
            }
        }

        // Ë≤°Âãô„Éá„Éº„ÇøÊõ¥Êñ∞Èñ¢Êï∞
        function updateFinancialData(month) {
            const date = new Date(month + '-01');
            const monthNum = date.getMonth() + 1;
            const year = date.getFullYear();

            // „Çµ„Éû„É™„Éº„Ç´„Éº„Éâ„ÇíÊõ¥Êñ∞
            const referralFeeMonth = document.getElementById('referralFeeMonth');
            if (referralFeeMonth) {
                referralFeeMonth.textContent = `${monthNum}ÊúàÁ¥π‰ªãÊñô`;
            }
            const commissionMonth = document.getElementById('commissionMonth');
            if (commissionMonth) {
                commissionMonth.textContent = `${monthNum}ÊúàÊàêÁ¥ÑÊâãÊï∞Êñô`;
            }
            const roiLabel = document.getElementById('roiLabel');
            if (roiLabel) {
                roiLabel.textContent = `${monthNum}ÊúàROI`;
            }

            // „ÉÜ„Éº„Éñ„É´„Éá„Éº„Çø„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞ÔºàÂÆüÈöõ„Å´„ÅØ„Çµ„Éº„Éê„Éº„Åã„ÇâÂèñÂæóÔºâ
            const tbody = document.getElementById('referralFeeTableBody');
            if (tbody) {
                const rows = tbody.getElementsByTagName('tr');
                for (let row of rows) {
                    const dateCell = row.cells[0];
                    if (dateCell) {
                        const rowDate = new Date(dateCell.textContent);
                        const rowMonth = rowDate.getMonth() + 1;
                        const rowYear = rowDate.getFullYear();
                        if (rowMonth === monthNum && rowYear === year) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    }
                }
            }

            // ÂêÑ„Çø„Éñ„ÅÆ„Éá„Éº„Çø„ÇÇÊõ¥Êñ∞
            updateAllFinancialTabs(month);
        }

        // „Éá„Éù„Ç∏„ÉÉ„ÉàÁÆ°ÁêÜÈñ¢Êï∞
        function showDepositModal() {
            const quantity = prompt('Ë≥ºÂÖ•„Åô„Çã„Éá„Éù„Ç∏„ÉÉ„ÉàÊï∞Ôºà‰ª∂Êï∞Ôºâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:', '10');
            if (quantity && !isNaN(quantity) && quantity > 0) {
                const total = parseInt(quantity) * 22000;
                const today = new Date();
                const dueDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 7);
                const message = `
„Éá„Éù„Ç∏„ÉÉ„Éà${quantity}‰ª∂ÂàÜÔºà¬•${total.toLocaleString()}Ôºâ„ÅÆË´ãÊ±ÇÊõ∏„ÇíÁô∫Ë°å„Åó„Åæ„Åô„ÄÇ

„ÄêË´ãÊ±ÇÂÜÖÂÆπ„Äë
„Éª„Éá„Éù„Ç∏„ÉÉ„ÉàÔºö${quantity}‰ª∂ √ó ¬•22,000 = ¬•${total.toLocaleString()}
„ÉªÊîØÊâïÊúüÈôêÔºö${dueDate.getFullYear()}Âπ¥${dueDate.getMonth() + 1}Êúà${dueDate.getDate()}Êó•
„ÉªÊúâÂäπÊúüÈôêÔºöÂÖ•ÈáëÁ¢∫Ë™ç„ÅÆÁøå„ÄÖÊúàÊú´„Åæ„Åß

„Äê„ÅîÊ≥®ÊÑè‰∫ãÈ†Ö„Äë
„ÉªÂÖ•ÈáëÁ¢∫Ë™çÂæå„Å´„Éá„Éù„Ç∏„ÉÉ„Éà„ÅåÂèçÊò†„Åï„Çå„Åæ„Åô
„ÉªÂèçÊò†Âæå„ÄÅ„É©„É≥„Ç≠„É≥„Ç∞„Åå1„É©„É≥„ÇØUP„Åó„Åæ„Åô
„ÉªËøîÈáëÊôÇ„ÅÆÊåØËæºÊâãÊï∞Êñô„ÅØ„ÅäÂÆ¢ÊßòË≤†ÊãÖ„Å®„Å™„Çä„Åæ„Åô

Ë´ãÊ±ÇÊõ∏„ÇíÁô∫Ë°å„Åó„Å¶„Çà„Çç„Åó„ÅÑ„Åß„Åó„Çá„ÅÜ„ÅãÔºü`;

                if (confirm(message)) {
                    // Ë´ãÊ±ÇÊõ∏Áô∫Ë°å„ÅÆÂá¶ÁêÜ
                    const invoiceNo = 'INV-' + Date.now().toString().slice(-8);
                    alert(`Ë´ãÊ±ÇÊõ∏„ÇíÁô∫Ë°å„Åó„Åæ„Åó„Åü„ÄÇ\n\nË´ãÊ±ÇÊõ∏Áï™Âè∑Ôºö${invoiceNo}\n„Éá„Éù„Ç∏„ÉÉ„ÉàÊï∞Ôºö${quantity}‰ª∂\nË´ãÊ±ÇÈáëÈ°çÔºö¬•${total.toLocaleString()}\n\nÂÖ•ÈáëÁ¢∫Ë™çÂæå„ÄÅ1Âñ∂Ê•≠Êó•‰ª•ÂÜÖ„Å´„Éá„Éù„Ç∏„ÉÉ„Éà„ÅåÂèçÊò†„Åï„Çå„Åæ„Åô„ÄÇ`);
                    // Ë≥ºÂÖ•Áî≥Ë´ãÂ±•Ê≠¥„Å´ËøΩÂä†ÔºàÂÆüÈöõ„ÅØ„Çµ„Éº„Éê„ÉºÂÅ¥„ÅßÂá¶ÁêÜÔºâ
                    location.reload();
                }
            }
        }

        function updateDepositSetting() {
            const selectedValue = document.querySelector('input[name="depositHandling"]:checked').value;
            const message = selectedValue === 'rollover'
                ? 'Áπ∞Ë∂äË®≠ÂÆö„Å´Â§âÊõ¥„Åó„Åæ„Åó„Åü„ÄÇÊúüÈôêÂàá„ÇåÂæå„ÇÇÁ∂ôÁ∂ö„Åó„Å¶Âà©Áî®„Åß„Åç„Åæ„Åô„ÄÇ'
                : 'ËøîÈáëË®≠ÂÆö„Å´Â§âÊõ¥„Åó„Åæ„Åó„Åü„ÄÇÊúüÈôêÂàá„ÇåÊôÇ„Å´Êú™‰ΩøÁî®ÂàÜ„ÅåËøîÈáë„Åï„Çå„Åæ„Åô„ÄÇ';
            alert(message);
        }

        // Ë´ãÊ±ÇÊõ∏„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÊ©üËÉΩ
        function downloadInvoice(invoiceNo) {
            alert(`Ë´ãÊ±ÇÊõ∏Ôºà${invoiceNo}Ôºâ„ÅÆ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„ÇíÈñãÂßã„Åó„Åæ„Åô„ÄÇ\n\n‚ÄªÂÆüÈöõ„ÅÆÂÆüË£Ö„Åß„ÅØ„ÄÅ„Çµ„Éº„Éê„Éº„Åã„ÇâË´ãÊ±ÇÊõ∏PDF„ÇíÂèñÂæó„Åó„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åô„ÄÇ`);
            // ÂÆüÈöõ„ÅÆÂÆüË£Ö„Åß„ÅØ‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å™Âá¶ÁêÜ„ÇíË°å„ÅÜ
            // window.location.href = `/api/invoices/${invoiceNo}/download`;
        }

        // „Éá„Éù„Ç∏„ÉÉ„ÉàÂ±•Ê≠¥„Éï„Ç£„É´„Çø„ÉºÊ©üËÉΩ
        function filterDepositHistory() {
            const typeFilter = document.getElementById('depositTypeFilter').value;
            const monthFilter = document.getElementById('depositMonthFilter').value;
            const rows = document.querySelectorAll('.deposit-row');

            rows.forEach(row => {
                const rowType = row.getAttribute('data-type');
                const rowDate = row.getAttribute('data-date');

                let showRow = true;

                // Á®ÆÂà•„Éï„Ç£„É´„Çø„Éº
                if (typeFilter !== 'all' && rowType !== typeFilter) {
                    showRow = false;
                }

                // Êúà„Éï„Ç£„É´„Çø„Éº
                if (monthFilter && rowDate !== monthFilter) {
                    showRow = false;
                }

                // Ë°®Á§∫/ÈùûË°®Á§∫
                row.style.display = showRow ? '' : 'none';
            });
        }

        // „Éá„Éù„Ç∏„ÉÉ„ÉàÈáëÈ°çË®àÁÆó
        document.addEventListener('DOMContentLoaded', function() {
            const depositInput = document.getElementById('depositAmount');
            const depositTotal = document.getElementById('depositTotal');
            if (depositInput && depositTotal) {
                depositInput.addEventListener('input', function() {
                    const amount = parseInt(this.value) || 0;
                    const total = amount * 22000;
                    depositTotal.textContent = '¬•' + total.toLocaleString();
                });
            }
        })

        // ÂÖ®Ë≤°Âãô„Çø„Éñ„ÅÆ„Éá„Éº„ÇøÊõ¥Êñ∞
        function updateAllFinancialTabs(month) {
            // ÊàêÁ¥ÑÊâãÊï∞Êñô„ÄÅÊîØÊâïÂ±•Ê≠¥„ÄÅÂèéÊîØÂàÜÊûê„Çø„Éñ„ÇÇÊõ¥Êñ∞
            console.log('ÂÖ®Ë≤°Âãô„Çø„Éñ„Çí' + month + '„Å´Êõ¥Êñ∞');
        }

        // Á¥π‰ªãÊñôË®àÁÆó
        function calculateReferralFee(projectType, buildingType, floors, competitors) {
            let baseFee = 0;
            const TAX_RATE = 0.10;
            
            // „Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥3Èöé‰ª•‰∏ä„ÅÆÁâπÂà•ÊñôÈáë
            if (buildingType === 'apartment' && floors >= 3) {
                if (projectType.includes('Â§ñÂ£Å')) {
                    baseFee = 30000;
                }
            }
            // ÂçòÂìÅÈ†ÖÁõÆÔºàÁõ∏Ë¶ãÁ©ç„ÇÇ„ÇäÔºâ
            else if (competitors > 1) {
                if (projectType === 'Â±ãÊ†πÂ°óË£Ö' || projectType === 'Â±ã‰∏äÈò≤Ê∞¥') {
                    baseFee = 10000;
                } else if (projectType === 'Â§ñÂ£ÅË£ú‰øÆ' || projectType === 'Â±ãÊ†πË£ú‰øÆ' || projectType === '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥') {
                    baseFee = 5000;
                }
            }
            // Âü∫Êú¨È†ÖÁõÆ
            else {
                baseFee = 20000;
            }
            
            const tax = Math.floor(baseFee * TAX_RATE);
            return {
                base: baseFee,
                tax: tax,
                total: baseFee + tax
            };
        }
        
        // ÊàêÁ¥ÑÊâãÊï∞ÊñôË®àÁÆó
        function calculateSuccessFee(contractAmount, rate = 0.10) {
            const TAX_RATE = 0.10;
            const baseFee = Math.floor(contractAmount * rate);
            const tax = Math.floor(baseFee * TAX_RATE);
            
            return {
                base: baseFee,
                tax: tax,
                total: baseFee + tax,
                rate: rate
            };
        }
        
        // ÊîØÊâï‰∫àÂÆöÊó•Ë®àÁÆóÔºàÂúüÊó•Á•ùÊó•„ÅÆÂæå„ÇçÂÄí„ÅóÔºâ
        function calculatePaymentDate(paymentMethod) {
            const today = new Date();
            const nextMonth = new Date(today.getFullYear(), today.getMonth() + 1, 1);
            let paymentDate;
            
            if (paymentMethod === 'BANK_TRANSFER') {
                // ÁøåÊúà15Êó•
                paymentDate = new Date(nextMonth.getFullYear(), nextMonth.getMonth(), 15);
            } else {
                // ÁøåÊúà27Êó•ÔºàÂè£Â∫ßÊåØÊõøÔºâ
                paymentDate = new Date(nextMonth.getFullYear(), nextMonth.getMonth(), 27);
            }
            
            // ÂúüÊó•Á•ùÊó•„ÉÅ„Çß„ÉÉ„ÇØÔºàÁ∞°ÊòìÁâàÔºâ
            while (paymentDate.getDay() === 0 || paymentDate.getDay() === 6) {
                paymentDate.setDate(paymentDate.getDate() + 1);
            }
            
            // Á•ùÊó•„ÉÅ„Çß„ÉÉ„ÇØ
            const holidayStr = paymentDate.toISOString().split('T')[0];
            if (japaneseHolidays[holidayStr]) {
                paymentDate.setDate(paymentDate.getDate() + 1);
                // ÂÜçÂ∫¶ÂúüÊó•„ÉÅ„Çß„ÉÉ„ÇØ
                while (paymentDate.getDay() === 0 || paymentDate.getDay() === 6) {
                    paymentDate.setDate(paymentDate.getDate() + 1);
                }
            }
            
            return paymentDate;
        }
        
        // Ë´ãÊ±ÇÊõ∏Áô∫Ë°å
        function issueInvoice(invoiceId) {
            if (confirm('Ë´ãÊ±ÇÊõ∏„ÇíÁô∫Ë°å„Åó„Åæ„Åô„ÅãÔºü')) {
                // „Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÊõ¥Êñ∞Ôºà„Éá„É¢Ôºâ
                const statusCell = document.querySelector(`[value="${invoiceId}"]`).closest('tr').querySelector('.bg-yellow-100');
                if (statusCell) {
                    statusCell.classList.remove('bg-yellow-100', 'text-yellow-800');
                    statusCell.classList.add('bg-green-100', 'text-green-800');
                    statusCell.textContent = 'Áô∫Ë°åÊ∏à';
                }
                
                showNotification('Ë´ãÊ±ÇÊõ∏Áô∫Ë°å', `Ë´ãÊ±ÇÊõ∏ ${invoiceId} „ÇíÁô∫Ë°å„Åó„Åæ„Åó„Åü`);
            }
        }
        
        // ÊàêÁ¥ÑÊâãÊï∞ÊñôË´ãÊ±ÇÊõ∏Áô∫Ë°å
        function issueSuccessFee(feeId) {
            if (confirm('ÊàêÁ¥ÑÊâãÊï∞Êñô„ÅÆË´ãÊ±ÇÊõ∏„ÇíÁô∫Ë°å„Åó„Åæ„Åô„ÅãÔºü')) {
                showNotification('ÊàêÁ¥ÑÊâãÊï∞ÊñôË´ãÊ±Ç', `Ë´ãÊ±ÇÊõ∏„ÇíÁô∫Ë°å„Åó„Åæ„Åó„ÅüÔºà${feeId}Ôºâ`);
                
                // Ë°å„ÇíÈùûË°®Á§∫„Å´Ôºà„Éá„É¢Ôºâ
                const row = document.querySelector(`button[onclick="issueSuccessFee('${feeId}')"]`).closest('tr');
                if (row) {
                    row.style.opacity = '0.5';
                    setTimeout(() => {
                        row.style.display = 'none';
                    }, 500);
                }
            }
        }
        
        // ÊâãÂãïÁô∫Ë°å
        function manualIssueSuccessFee(feeId) {
            const reason = prompt('ÊâãÂãïÁô∫Ë°å„ÅÆÁêÜÁî±„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö');
            if (reason) {
                issueSuccessFee(feeId);
                console.log('ÊâãÂãïÁô∫Ë°åÁêÜÁî±:', reason);
            }
        }
        
        // ÊúàÊ¨°Ë´ãÊ±ÇÊõ∏‰∏ÄÊã¨Áô∫Ë°å
        function generateMonthlyInvoices() {
            const checkedBoxes = document.querySelectorAll('.invoice-checkbox:checked');
            if (checkedBoxes.length === 0) {
                alert('Áô∫Ë°å„Åô„ÇãË´ãÊ±ÇÊõ∏„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            if (confirm(`${checkedBoxes.length}‰ª∂„ÅÆË´ãÊ±ÇÊõ∏„Çí‰∏ÄÊã¨Áô∫Ë°å„Åó„Åæ„Åô„ÅãÔºü`)) {
                checkedBoxes.forEach(checkbox => {
                    issueInvoice(checkbox.value);
                });
                showNotification('‰∏ÄÊã¨Áô∫Ë°åÂÆå‰∫Ü', `${checkedBoxes.length}‰ª∂„ÅÆË´ãÊ±ÇÊõ∏„ÇíÁô∫Ë°å„Åó„Åæ„Åó„Åü`);
            }
        }
        
        // ÂÖ®ÈÅ∏Êäû
        function selectAllInvoices(checkbox) {
            document.querySelectorAll('.invoice-checkbox').forEach(cb => {
                cb.checked = checkbox.checked;
            });
        }
        
        // Ë´ãÊ±ÇÊõ∏Ë©≥Á¥∞Ë°®Á§∫
        function showInvoiceDetail(invoiceId) {
            alert(`Ë´ãÊ±ÇÊõ∏Ë©≥Á¥∞: ${invoiceId}\n\nÂÆüË£Ö‰∫àÂÆöÔºö\n- ÊòéÁ¥∞Ë°®Á§∫\n- Á∑®ÈõÜÊ©üËÉΩ\n- „É°„Éº„É´ÈÄÅ‰ø°`);
        }
        
        // PDFÂá∫Âäõ
        function downloadPDF(invoiceId) {
            showNotification('PDFÂá∫Âäõ', `${invoiceId}.pdf „Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü`);
        }
        
        // Ë≤°Âãô„É¨„Éù„Éº„Éà CSVÂá∫Âäõ
        function exportFinancialReport() {
            const data = [
                ['Ë≥ºÂÖ•Êó•', 'Ê°à‰ª∂ID', 'È°ßÂÆ¢Âêç', '„Ç®„É™„Ç¢', 'Ë≥ºÂÖ•ÈáëÈ°ç', 'ÊàêÁ¥ÑÈáëÈ°ç', 'ÊâãÊï∞Êñô', 'ROI'],
                ['2025-01-15', 'C2025-001', 'Áî∞‰∏≠Êßò', 'Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫', '85000', '', '', ''],
                ['2025-01-10', 'C2025-002', '‰ΩêËó§Êßò', 'Á•ûÂ•àÂ∑ùÁúåÂ∑ùÂ¥éÂ∏Ç', '22000', '1200000', '132000', '475%'],
                ['2025-01-08', 'C2025-003', 'Èà¥Êú®Êßò', 'ÂüºÁéâÁúåË∂äË∞∑Â∏Ç', '80000', '800000', '80000', '100%']
            ];
            
            const csv = data.map(row => row.join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `invoices_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            
            showNotification('CSVÂá∫Âäõ', 'Ë´ãÊ±ÇÊõ∏‰∏ÄË¶ß„ÇíCSV„ÅßÂá∫Âäõ„Åó„Åæ„Åó„Åü');
        }

        // „É¨„Éù„Éº„ÉàÁî®„ÅÆ„Ç∞„É©„ÉïÂàùÊúüÂåñ
        let salesChart = null;
        let conversionChart = null;
        let leadTimeChart = null;

        // „É¨„Éù„Éº„ÉàÊõ¥Êñ∞Èñ¢Êï∞
        function updateReports() {
            const period = document.getElementById('reportPeriod').value;
            // ÊúüÈñì„Å´Âøú„Åò„Åü„Éá„Éº„ÇøÂèñÂæó„Å®Êõ¥Êñ∞Âá¶ÁêÜ
            renderCharts();
        }

        // „Ç∞„É©„ÉïÊèèÁîªÈñ¢Êï∞
        function renderCharts() {
            // Â£≤‰∏äÊé®Áßª„Ç∞„É©„Éï
            const salesCtx = document.getElementById('salesChart');
            if (salesCtx) {
                if (salesChart) {
                    salesChart.destroy();
                }
                salesChart = new Chart(salesCtx, {
                    type: 'line',
                    data: {
                        labels: ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà'],
                        datasets: [{
                            label: 'Â£≤‰∏äÔºàÂçÉÂÜÜÔºâ',
                            data: [6200, 7500, 6800, 8450, 7900, 8450],
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '¬•' + value.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // ÊàêÁ¥ÑÁéáÊé®Áßª„Ç∞„É©„Éï
            const conversionCtx = document.getElementById('conversionChart');
            if (conversionCtx) {
                if (conversionChart) {
                    conversionChart.destroy();
                }
                conversionChart = new Chart(conversionCtx, {
                    type: 'bar',
                    data: {
                        labels: ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà'],
                        datasets: [{
                            label: 'ÊàêÁ¥ÑÁéáÔºà%Ôºâ',
                            data: [65, 62, 68, 70, 67, 68.5],
                            backgroundColor: [
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(34, 197, 94, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // „É™„Éº„Éâ„Çø„Ç§„É†„ÉÅ„É£„Éº„Éà
            const leadTimeCtx = document.getElementById('leadTimeChart');
            if (leadTimeCtx) {
                if (leadTimeChart) {
                    leadTimeChart.destroy();
                }
                leadTimeChart = new Chart(leadTimeCtx, {
                    type: 'line',
                    data: {
                        labels: ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà'],
                        datasets: [
                            {
                                label: 'ÂïèÂêà„Åõ‚ÜíË™øÊüª',
                                data: [3.5, 3.8, 3.2, 3.0, 3.1, 3.2],
                                borderColor: 'rgb(59, 130, 246)',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.3
                            },
                            {
                                label: 'Ë™øÊüª‚ÜíË¶ãÁ©ç',
                                data: [3.0, 2.9, 3.1, 2.7, 2.8, 2.8],
                                borderColor: 'rgb(34, 197, 94)',
                                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                tension: 0.3
                            },
                            {
                                label: 'Ë¶ãÁ©ç‚ÜíÊàêÁ¥Ñ',
                                data: [6.0, 5.8, 5.5, 5.2, 5.3, 5.5],
                                borderColor: 'rgb(168, 85, 247)',
                                backgroundColor: 'rgba(168, 85, 247, 0.1)',
                                tension: 0.3
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: {
                                        size: 10
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + context.parsed.y + 'Êó•';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value + 'Êó•';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        // „É™„Éº„Éâ„Çø„Ç§„É†Ë°®Á§∫ÂàáÊõøÔºàÂπ≥Âùá/‰∏≠Â§ÆÂÄ§Ôºâ
        function updateLeadTimeDisplay() {
            const showMedian = document.getElementById('showMedian').checked;

            if (showMedian) {
                document.getElementById('leadTime1').textContent = '3.0Êó•';
                document.getElementById('leadTime2').textContent = '2.5Êó•';
                document.getElementById('leadTime3').textContent = '5.0Êó•';
            } else {
                document.getElementById('leadTime1').textContent = '3.2Êó•';
                document.getElementById('leadTime2').textContent = '2.8Êó•';
                document.getElementById('leadTime3').textContent = '5.5Êó•';
            }
        }

        // „É¨„Éù„Éº„Éà„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÈñ¢Êï∞
        function exportReport() {
            const period = document.getElementById('reportPeriod').value;
            const periodText = document.getElementById('reportPeriod').options[document.getElementById('reportPeriod').selectedIndex].text;

            // CSVÂΩ¢Âºè„Åß„Éá„Éº„Çø„ÇíÁîüÊàê
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Âä†ÁõüÂ∫óÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É† „É¨„Éù„Éº„Éà - " + periodText + "\n\n";

            // KPI„Çµ„Éû„É™„Éº
            csvContent += "KPI„Çµ„Éû„É™„Éº\n";
            csvContent += "È†ÖÁõÆ,Êï∞ÂÄ§,ÂâçÊúàÊØî\n";
            csvContent += "Á∑èÂ£≤‰∏ä,¬•8450000,+12%\n";
            csvContent += "ÊàêÁ¥ÑÁéá,68.5%,+5.2%\n";
            csvContent += "Âπ≥ÂùáÂçò‰æ°,¬•952000,-3%\n";
            csvContent += "Êñ∞Ë¶èÊ°à‰ª∂,42‰ª∂,+8‰ª∂\n\n";

            // Âñ∂Ê•≠Âà•ÊàêÁ∏æ
            csvContent += "Âñ∂Ê•≠Âà•ÊàêÁ∏æ\n";
            csvContent += "Âñ∂Ê•≠Âêç,ÊàêÁ¥ÑÊï∞,ÊàêÁ¥ÑÁéá,Â£≤‰∏ä\n";
            csvContent += "Áî∞‰∏≠Â§™ÈÉé,12,75%,¬•3200000\n";
            csvContent += "‰ΩêËó§Ëä±Â≠ê,8,62%,¬•2100000\n";
            csvContent += "Èà¥Êú®Ê¨°ÈÉé,5,45%,¬•1450000\n\n";

            // „Ç®„É™„Ç¢Âà•ÊàêÁ∏æ
            csvContent += "„Ç®„É™„Ç¢Âà•ÊàêÁ∏æ\n";
            csvContent += "„Ç®„É™„Ç¢,Ê°à‰ª∂Êï∞,ÊàêÁ¥ÑÁéá,Â£≤‰∏ä\n";
            csvContent += "Êù±‰∫¨ÈÉΩ,18,72%,¬•4200000\n";
            csvContent += "Á•ûÂ•àÂ∑ùÁúå,12,65%,¬•2800000\n";
            csvContent += "ÂüºÁéâÁúå,8,58%,¬•1450000\n";

            // „ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÂÆüË°å
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "report_" + new Date().toISOString().split('T')[0] + ".csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showNotification('„É¨„Éù„Éº„ÉàÂá∫Âäõ', 'CSV„Éï„Ç°„Ç§„É´„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü');
        }

        // „Çª„ÇØ„Ç∑„Éß„É≥Ë°®Á§∫ÊôÇ„Å´„Ç∞„É©„Éï„ÇíÂàùÊúüÂåñ
        const originalShowSection = showSection;
        showSection = function(section) {
            originalShowSection(section);
            if (section === 'reports') {
                setTimeout(() => {
                    renderCharts();
                }, 100);
            }
        }

        // Ê°à‰ª∂ÁÆ°ÁêÜÊ©üËÉΩ
        let currentCaseView = 'card'; // 'card' or 'list'

        // Ê°à‰ª∂„Éá„Éº„ÇøÔºà„Çµ„É≥„Éó„É´Ôºâ
        const casesData = [
            { id: 1, name: 'Â±±Áî∞Â§™ÈÉé', location: 'Êù±‰∫¨ÈÉΩ‰∏ñÁî∞Ë∞∑Âå∫', propertyType: 'Êà∏Âª∫„Å¶„ÉªÁØâ15Âπ¥', phone: '03-1234-5678', status: 'Êú™ÂØæÂøú', assignee: 'Áî∞‰∏≠Â§™ÈÉé', area: 'Êù±‰∫¨ÈÉΩ‰∏ñÁî∞Ë∞∑Âå∫', temperature: 4, lastContact: '2024/01/15 ÂàùÂõûÂïè„ÅÑÂêà„Çè„Åõ', nextAction: '2024/01/18 14:00 ÈõªË©±„Éï„Ç©„É≠„Éº', age: 15 },
            { id: 2, name: 'Èà¥Êú®Ëä±Â≠ê', location: 'Á•ûÂ•àÂ∑ùÁúåÊ®™ÊµúÂ∏Ç', propertyType: 'Êà∏Âª∫„Å¶„ÉªÁØâ10Âπ¥', phone: '045-9876-5432', status: '„Ç¢„ÉùÊ∏à', assignee: '‰ΩêËó§Ëä±Â≠ê', area: 'Á•ûÂ•àÂ∑ùÁúåÊ®™ÊµúÂ∏Ç', temperature: 3, lastContact: '2024/01/16 ÈõªË©±„Åß„Ç¢„ÉùÂèñÂæó', nextAction: '2024/01/20 14:00 ÁèæÂú∞Ë™øÊüª', age: 10 },
            { id: 3, name: '‰ΩêËó§‰∏ÄÈÉé', location: 'ÂüºÁéâÁúå„Åï„ÅÑ„Åü„ÅæÂ∏Ç', propertyType: '„Ç¢„Éë„Éº„Éà„ÉªÁØâ20Âπ¥', phone: '048-1111-2222', status: 'Ë¶ãÁ©çÊèêÂá∫Ê∏à', assignee: 'Áî∞‰∏≠Â§™ÈÉé', area: 'ÂüºÁéâÁúå„Åï„ÅÑ„Åü„ÅæÂ∏Ç', temperature: 5, lastContact: '2024/01/14 Ë¶ãÁ©çÊõ∏„É°„Éº„É´ÈÄÅ‰ªò', nextAction: '2024/01/22 10:00 Ë¶ãÁ©çË™¨ÊòéË®™Âïè', age: 20 },
            { id: 4, name: 'Áî∞‰∏≠ÁæéÂí≤', location: 'ÂçÉËëâÁúåÂçÉËëâÂ∏Ç', propertyType: 'Êà∏Âª∫„Å¶„ÉªÁØâ25Âπ¥', phone: '043-3333-4444', status: 'ÁèæË™øÊ∏à', assignee: '‰ΩêËó§Ëä±Â≠ê', area: 'ÂçÉËëâÁúåÂçÉËëâÂ∏Ç', temperature: 2, lastContact: '2024/01/10 ÁèæÂú∞Ë™øÊüªÂÆüÊñΩ', nextAction: 'Ë¶ãÁ©ç‰ΩúÊàê‰∏≠', age: 25 },
            { id: 5, name: 'È´òÊ©ãÂÅ•Â§™', location: 'Êù±‰∫¨ÈÉΩÊñ∞ÂÆøÂå∫', propertyType: '„Éû„É≥„Ç∑„Éß„É≥„ÉªÁØâ8Âπ¥', phone: '03-5555-6666', status: 'ÊàêÁ¥Ñ', assignee: 'Áî∞‰∏≠Â§™ÈÉé', area: 'Êù±‰∫¨ÈÉΩÊñ∞ÂÆøÂå∫', temperature: 5, lastContact: '2024/01/17 Â•ëÁ¥ÑÁ∑†Áµê', nextAction: '2024/01/25 Â∑•‰∫ãÈñãÂßã', age: 8 },
            // Êú™ÊåØ„ÇäÂàÜ„ÅëÊ°à‰ª∂
            { id: 101, name: 'Êñ∞Ë¶èÈ°ßÂÆ¢A', location: 'Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫', propertyType: 'Êà∏Âª∫„Å¶„ÉªÁØâ12Âπ¥', phone: '03-0000-0000', status: 'Êú™ÂØæÂøú', assignee: null, area: 'Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫', temperature: 4, source: '„Åè„Çâ„Åπ„Çã', registeredDate: '2025-01-15 10:30' },
            { id: 102, name: 'Êñ∞Ë¶èÈ°ßÂÆ¢B', location: 'Á•ûÂ•àÂ∑ùÁúåÂ∑ùÂ¥éÂ∏Ç', propertyType: '„Éû„É≥„Ç∑„Éß„É≥„ÉªÁØâ5Âπ¥', phone: '044-0000-0000', status: 'Êú™ÂØæÂøú', assignee: null, area: 'Á•ûÂ•àÂ∑ùÁúåÂ∑ùÂ¥éÂ∏Ç', temperature: 3, source: '„Åè„Çâ„Åπ„Çã', registeredDate: '2025-01-15 11:45' },
            { id: 103, name: 'Êñ∞Ë¶èÈ°ßÂÆ¢C', location: 'ÂüºÁéâÁúåË∂äË∞∑Â∏Ç', propertyType: 'Êà∏Âª∫„Å¶„ÉªÁØâ20Âπ¥', phone: '048-0000-0000', status: 'Êú™ÂØæÂøú', assignee: null, area: 'ÂüºÁéâÁúåË∂äË∞∑Â∏Ç', temperature: 5, source: '„Åè„Çâ„Åπ„Çã', registeredDate: '2025-01-15 14:00' }
        ];

        // Ê°à‰ª∂„Éá„Éº„Çø„ÇíÂèñÂæó„Åô„ÇãÈñ¢Êï∞
        function getCasesData() {
            return casesData;
        }

        // Âä†ÁõüÂ∫ó„Éá„Éº„Çø„Çí„Éï„Ç©„Éº„É†„Å´Ëá™ÂãïÂÖ•Âäõ„Åô„ÇãÈñ¢Êï∞
        function loadMerchantData(merchantId, merchantData = null) {
            console.log('===== loadMerchantData START =====');
            console.log('merchantId:', merchantId);
            console.log('merchantData from login:', merchantData || window.merchantData);

            const data = merchantData || window.merchantData;
            if (!data) {
                console.log('No merchant data available');
                return;
            }

            console.log('=== APPLYING MERCHANT DATA TO FORMS ===');
            console.log('Data keys:', Object.keys(data));
            console.log('Full data:', data);

            console.log('==== POPULATING FORM FIELDS ====');

            // Ë®≠Á´ãÂπ¥Êúà„Å®PR„ÉÜ„Ç≠„Çπ„Éà„ÅÆÁõ¥Êé•ÂèñÂæóÔºà„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆÂàóÂêç„ÅßÂèñÂæóÔºâ
            if (data['Ë®≠Á´ãÂπ¥Êúà']) {
                const establishedEl = document.getElementById('established');
                if (establishedEl) {
                    establishedEl.value = data['Ë®≠Á´ãÂπ¥Êúà'];
                    console.log(`‚úì Ë®≠Á´ãÂπ¥Êúà„ÇíË®≠ÂÆö: ${data['Ë®≠Á´ãÂπ¥Êúà']}`);
                }
            }

            if (data['PR„ÉÜ„Ç≠„Çπ„Éà']) {
                const prTextEl = document.getElementById('prText');
                if (prTextEl) {
                    prTextEl.value = data['PR„ÉÜ„Ç≠„Çπ„Éà'];
                    console.log(`‚úì PRÊñá„ÇíË®≠ÂÆö: [${data['PR„ÉÜ„Ç≠„Çπ„Éà'].length}ÊñáÂ≠ó]`);
                    console.log(`  ÂÆåÂÖ®„Å™PRÊñá: ${data['PR„ÉÜ„Ç≠„Çπ„Éà']}`);

                    // „ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„ÅÆÈ´ò„Åï„ÇíËá™ÂãïË™øÊï¥
                    prTextEl.style.height = 'auto';
                    prTextEl.style.height = Math.max(200, prTextEl.scrollHeight) + 'px';

                    // ÊñáÂ≠óÊï∞„Ç´„Ç¶„É≥„Çø„ÉºÊõ¥Êñ∞
                    const charCount = document.getElementById('prTextCharCount');
                    if (charCount) {
                        charCount.textContent = data['PR„ÉÜ„Ç≠„Çπ„Éà'].length;
                    }
                }
            }

            // ‰ºöÁ§æÊÉÖÂ†±„Éï„Ç©„Éº„É†„Éï„Ç£„Éº„É´„Éâ„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞Ôºà„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆÂàóÂêç„Å´ÂÆåÂÖ®ÂØæÂøúÔºâ
            const fieldMappings = {
                companyName: ['‰ºöÁ§æÂêç', 'companyName', 'company_name'],
                companyNameKana: ['‰ºöÁ§æÂêç„Ç´„Éä', 'companyNameKana', 'company_name_kana'],
                tradeName: ['Â±ãÂè∑', 'tradeName', 'trade_name'],
                tradeNameKana: ['Â±ãÂè∑„Ç´„Éä', 'tradeNameKana', 'trade_name_kana'],
                representative: ['‰ª£Ë°®ËÄÖÂêç', 'representative', 'representative_name'],
                representativeKana: ['‰ª£Ë°®ËÄÖÂêç„Ç´„Éä', 'representativeKana', 'representative_kana'],
                zipCode: ['ÈÉµ‰æøÁï™Âè∑', 'postalCode', 'zipCode', 'postal_code'],
                address: ['‰ΩèÊâÄ', 'address'],
                phone: ['ÈõªË©±Áï™Âè∑', 'phone', 'tel'],
                website: ['„Ç¶„Çß„Éñ„Çµ„Ç§„ÉàURL', 'website', 'url'],
                established: ['Ë®≠Á´ãÂπ¥Êúà', 'established', 'establishment_date'],
                prText: ['PR„ÉÜ„Ç≠„Çπ„Éà', 'prText', 'pr_text'],
                billingEmail: ['Ë´ãÊ±ÇÁî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ', 'billingEmail', 'billing_email'],
                salesEmail: ['Âñ∂Ê•≠Áî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ', 'salesEmail', 'sales_email'],
                salesPersonName: ['Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç', 'salesPersonName', 'sales_person_name'],
                salesPersonKana: ['Âñ∂Ê•≠ÊãÖÂΩìËÄÖ„Ç´„Éä', 'salesPersonKana', 'sales_person_kana'],
                employees: ['ÂæìÊ•≠Âì°Êï∞', 'employees', 'employee_count'],
                salesScale: ['Â£≤‰∏äË¶èÊ®°', 'salesScale', 'sales_scale'],
                maxFloors: ['ÊúÄÂ§ßÂØæÂøúÈöéÊï∞', 'maxFloors', 'max_floors'],
                buildingAge: ['ÁØâÂπ¥Êï∞ÂØæÂøúÁØÑÂõ≤', 'buildingAge', 'building_age'],
                specialItems: ['ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ', 'specialItems', 'special_items'],
                cities: ['ÂØæÂøúÂ∏ÇÂå∫Áî∫Êùë', 'cities', 'service_areas'],
                priorityAreas: ['ÂÑ™ÂÖà„Ç®„É™„Ç¢', 'priorityAreas', 'priority_areas']
            };

            // „Éï„Ç£„Éº„É´„Éâ„Å´ÂÄ§„ÇíË®≠ÂÆö
            Object.keys(fieldMappings).forEach(fieldId => {
                const possibleKeys = fieldMappings[fieldId];
                let value = null;

                // „Éá„Éº„Çø„Åã„ÇâÂÄ§„ÇíÊ§úÁ¥¢
                for (const key of possibleKeys) {
                    if (data[key] !== undefined && data[key] !== null && data[key] !== '') {
                        value = data[key];
                        break;
                    }
                }

                const element = document.getElementById(fieldId) ||
                               document.querySelector(`input[placeholder*="${fieldId}"]`) ||
                               document.querySelector(`input[name="${fieldId}"]`);

                if (element && value) {
                    // PRÊñá„ÅÆÁâπÂà•„Å™Âá¶ÁêÜÔºàÁúÅÁï•„Åï„Çå„ÅüÈÉ®ÂàÜ„ÇÇÂê´„ÇÅ„Å¶ÂÆåÂÖ®„Å´ÂèñÂæóÔºâ
                    if (fieldId === 'prText') {
                        // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅßÁúÅÁï•„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅÂÆåÂÖ®„Å™„ÉÜ„Ç≠„Çπ„Éà„ÇíÂèñÂæó
                        let fullText = value;

                        // "..."„ÅßÁµÇ„Çè„Å£„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅÂÆåÂÖ®„Å™„ÉÜ„Ç≠„Çπ„Éà„Åå„ÅÇ„Çã„ÅØ„Åö„Å™„ÅÆ„ÅßÊé¢„Åô
                        if (value && value.endsWith('...')) {
                            // PR„ÉÜ„Ç≠„Çπ„ÉàÂàó„ÅÆÂÆåÂÖ®„Å™„Éá„Éº„Çø„ÇíÂèñÂæó
                            const fullPrText = data['PR„ÉÜ„Ç≠„Çπ„Éà'] || data.prText || data.pr_text;
                            if (fullPrText) {
                                fullText = fullPrText;
                                console.log('‚úì PRÊñá„ÅÆÂÆåÂÖ®Áâà„ÇíÂèñÂæó„Åó„Åæ„Åó„Åü');
                            }
                        }

                        element.value = fullText;
                        console.log(`‚úì Set ${fieldId} = [${fullText.length}ÊñáÂ≠ó]`);
                        console.log(`  ÂÆåÂÖ®„Å™PRÊñá: ${fullText}`);

                        // „ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„ÅÆÈ´ò„Åï„ÇíËá™ÂãïË™øÊï¥
                        element.style.height = 'auto';
                        element.style.height = Math.max(200, element.scrollHeight) + 'px';

                        // ÊñáÂ≠óÊï∞„Ç´„Ç¶„É≥„Çø„Éº„ÇÇÊõ¥Êñ∞
                        const charCount = document.getElementById('prTextCharCount');
                        if (charCount) {
                            charCount.textContent = fullText.length;
                        }
                    } else if (fieldId === 'established') {
                        // Ë®≠Á´ãÂπ¥Êúà„ÇíÂèñÂæó
                        const establishedData = data['Ë®≠Á´ãÂπ¥Êúà'] || data.established || data['establishment_date'];
                        if (establishedData) {
                            // ISOÂΩ¢Âºè„ÅÆÊó•‰ªò„ÇíYYYYÂπ¥MÊúàÂΩ¢Âºè„Å´Â§âÊèõ
                            let formattedDate = establishedData;
                            if (establishedData.includes('T') || establishedData.includes('Z')) {
                                // ISOÂΩ¢Âºè„ÅÆÂ†¥ÂêàÔºà‰æã: 2000-03-31T15:00:00.000ZÔºâ
                                const date = new Date(establishedData);
                                const year = date.getFullYear();
                                const month = date.getMonth() + 1; // 0-indexed
                                formattedDate = `${year}Âπ¥${month}Êúà`;
                                console.log(`‚úì Converted ISO date to Japanese format: ${establishedData} ‚Üí ${formattedDate}`);
                            }
                            element.value = formattedDate;
                            console.log(`‚úì Set ${fieldId} = ${formattedDate}`);
                        } else if (value) {
                            // value„ÇÇISOÂΩ¢Âºè„ÅÆÂèØËÉΩÊÄß„Åå„ÅÇ„Çã„ÅÆ„Åß„ÉÅ„Çß„ÉÉ„ÇØ
                            let formattedValue = value;
                            if (value.includes('T') || value.includes('Z')) {
                                const date = new Date(value);
                                const year = date.getFullYear();
                                const month = date.getMonth() + 1;
                                formattedValue = `${year}Âπ¥${month}Êúà`;
                                console.log(`‚úì Converted ISO date to Japanese format: ${value} ‚Üí ${formattedValue}`);
                            }
                            element.value = formattedValue;
                            console.log(`‚úì Set ${fieldId} = ${formattedValue}`);
                        }
                    } else if (fieldId === 'employees' || fieldId === 'salesScale') {
                        // selectË¶ÅÁ¥†„ÅÆÂ†¥Âêà„ÅØ„ÄÅoption„ÇíÈÅ∏Êäû
                        if (element.tagName === 'SELECT') {
                            // ÂÄ§„ÇíÊ≠£Ë¶èÂåñÔºàÂâçÂæå„ÅÆÁ©∫ÁôΩ„ÇíÂâäÈô§„ÄÅÂÖ®ËßíËã±Êï∞Â≠ó„ÇíÂçäËßí„Å´Â§âÊèõÔºâ
                            let normalizedValue = String(value).trim();

                            // ÂæìÊ•≠Âì°Êï∞„ÅåISOÊó•‰ªòÂΩ¢Âºè„ÅßÊù•„ÅüÂ†¥ÂêàÔºà‰æã: 2025-03-04T15:00:00.000Z ‚Üí 3-4Ôºâ
                            if (fieldId === 'employees' && (normalizedValue.includes('T') || normalizedValue.includes('Z'))) {
                                const date = new Date(normalizedValue);
                                const month = date.getMonth() + 1; // 0-indexed
                                const day = date.getDate();
                                normalizedValue = `${month}-${day}`;
                            }

                            // ÂÖ®ËßíËã±Êï∞Â≠ó„ÇíÂçäËßí„Å´Â§âÊèõ
                            normalizedValue = normalizedValue.replace(/[Ôº°-Ôº∫ÔΩÅ-ÔΩöÔºê-Ôºô]/g, function(s) {
                                return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
                            });

                            // „Åæ„ÅöÊ≠£Ë¶èÂåñ„Åó„ÅüÂÄ§„ÅßÁõ¥Êé•Ë®≠ÂÆö„Åó„Å¶„Åø„Çã
                            element.value = normalizedValue;

                            // Áõ¥Êé•„Éû„ÉÉ„ÉÅ„Åó„Å™„Åã„Å£„ÅüÂ†¥Âêà
                            if (!element.value && normalizedValue) {
                                const options = Array.from(element.options);

                                // „Çà„ÇäÊüîËªü„Å™„Éû„ÉÉ„ÉÅ„É≥„Ç∞
                                const matchedOption = options.find(opt => {
                                    // option value „Å®ÂÆåÂÖ®‰∏ÄËá¥
                                    if (opt.value === normalizedValue) return true;

                                    // option value „ÅÆÊ≠£Ë¶èÂåñÁâà„Å®‰∏ÄËá¥
                                    const normalizedOptValue = opt.value.trim().toLowerCase();
                                    const normalizedSearchValue = normalizedValue.toLowerCase();
                                    if (normalizedOptValue === normalizedSearchValue) return true;

                                    // option text „Å´Âê´„Åæ„Çå„Çã
                                    const optText = opt.text.replace(/\s/g, '').toLowerCase();
                                    const valueText = normalizedValue.replace(/\s/g, '').toLowerCase();
                                    if (optText.includes(valueText) || valueText.includes(optText)) return true;

                                    return false;
                                });

                                if (matchedOption) {
                                    element.value = matchedOption.value;
                                }
                            }
                        } else {
                            element.value = value;
                        }
                    } else {
                        element.value = value;
                        console.log(`‚úì Set ${fieldId} = ${value}`);
                    }
                } else if (element) {
                    console.log(`‚ö™ Empty data for ${fieldId}`);
                } else {
                    console.log(`‚ùå Element not found for ${fieldId}`);
                }
            });

            console.log('=== AUTO-POPULATING DELIVERY SETTINGS ===');

            // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞
            if (data.deliverySettings || data.delivery_settings) {
                const deliveryData = data.deliverySettings || data.delivery_settings;
                console.log('Auto delivery settings:', deliveryData);

                // Âπ¥ÈΩ¢ÁØÑÂõ≤
                if (deliveryData.ageMin !== undefined) {
                    const ageMinEl = document.getElementById('ageMin');
                    if (ageMinEl) {
                        ageMinEl.value = deliveryData.ageMin;
                        console.log(`‚úì Set age range min: ${deliveryData.ageMin}`);
                    }
                }
                if (deliveryData.ageMax !== undefined) {
                    const ageMaxEl = document.getElementById('ageMax');
                    if (ageMaxEl) {
                        ageMaxEl.value = deliveryData.ageMax;
                        console.log(`‚úì Set age range max: ${deliveryData.ageMax}`);
                    }
                }

                // „Åù„ÅÆ‰ªñ„ÅÆËá™ÂãïÈÖç‰ø°Ë®≠ÂÆö...
            } else {
                // „Éá„Éï„Ç©„É´„ÉàÂÄ§Ë®≠ÂÆö
                const ageMinEl = document.getElementById('ageMin');
                const ageMaxEl = document.getElementById('ageMax');
                if (ageMinEl && !ageMinEl.value) {
                    ageMinEl.value = '10';
                    console.log('‚úì Set age range min: 10');
                }
                if (ageMaxEl && !ageMaxEl.value) {
                    ageMaxEl.value = '100';
                    console.log('‚úì Set age range max: 100');
                }
            }

            console.log('=== UPDATING COMPANY DISPLAYS ===');
            // ‰ºöÁ§æÂêçË°®Á§∫„ÅÆÊõ¥Êñ∞
            if (data.companyName || data.company_name) {
                const companyDisplays = document.querySelectorAll('.company-name-display');
                companyDisplays.forEach(el => {
                    el.textContent = data.companyName || data.company_name;
                });
            }

            console.log('=== LOADING BRANCH DATA ===');
            // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆOÂàóÔºàÊîØÂ∫óÂêçÔºâ„Å®PÂàóÔºàÊîØÂ∫ó‰ΩèÊâÄÔºâ„Åã„ÇâÊîØÂ∫óÊÉÖÂ†±„ÇíÂèñÂæó
            const branchNameRaw = data['ÊîØÂ∫óÂêç'] || data.branchName || data.branch_name || '';
            const branchAddressRaw = data['ÊîØÂ∫ó‰ΩèÊâÄ'] || data.branchAddress || data.branch_address || '';

            console.log('Branch name from spreadsheet:', branchNameRaw);
            console.log('Branch address from spreadsheet:', branchAddressRaw);

            // ÊîØÂ∫óÂêç„Åæ„Åü„ÅØÊîØÂ∫ó‰ΩèÊâÄ„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥Âêà
            if (branchNameRaw || branchAddressRaw) {
                // ÂÖ®Ëßí„Ç´„É≥„Éû„Äé„ÄÅ„Äè„ÅßÂàÜÂâ≤ÔºàË§áÊï∞„ÅÆÊîØÂ∫ó„Å´ÂØæÂøúÔºâ
                const branchNames = branchNameRaw ? branchNameRaw.split('„ÄÅ').map(s => s.trim()).filter(s => s) : [];
                const branchAddresses = branchAddressRaw ? branchAddressRaw.split('„ÄÅ').map(s => s.trim()).filter(s => s) : [];

                console.log('Split branch names:', branchNames);
                console.log('Split branch addresses:', branchAddresses);

                // ÊîØÂ∫ó„ÅÆÊï∞„ÇíÊ±∫ÂÆöÔºàÂêçÂâç„Å®‰ΩèÊâÄ„ÅÆÂ§ö„ÅÑÊñπ„ÇíÂü∫Ê∫ñ„Å´„Åô„ÇãÔºâ
                const branchCount = Math.max(branchNames.length, branchAddresses.length);

                if (branchCount > 0) {
                    // Êó¢Â≠ò„ÅÆÊîØÂ∫ó„Çí„ÇØ„É™„Ç¢
                    window.branches = [];
                    branchIdCounter = 0;
                    const branchList = document.getElementById('branchList');
                    if (branchList) {
                        branchList.innerHTML = '';
                    }

                    // ÂêÑÊîØÂ∫ó„ÇíËøΩÂä†
                    for (let i = 0; i < branchCount; i++) {
                        const branchId = ++branchIdCounter;
                        const branchInfo = {
                            id: branchId,
                            name: branchNames[i] || '',
                            address: branchAddresses[i] || ''
                        };

                        window.branches.push(branchInfo);

                        const branchDiv = document.createElement('div');
                        branchDiv.id = `branch-${branchId}`;
                        branchDiv.className = 'border rounded-lg p-4 mb-3 bg-gray-50';
                        branchDiv.innerHTML = `
                            <div class="flex justify-between items-start mb-3">
                                <h4 class="font-medium text-gray-700">ÊîØÂ∫ó ${i + 1}</h4>
                                <button onclick="removeBranch(${branchId})" class="text-red-600 hover:text-red-800">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ÊîØÂ∫óÂêç</label>
                                    <input type="text" class="w-full px-3 py-2 border rounded-lg" placeholder="‰æã: Ê®™ÊµúÊîØÂ∫ó"
                                           value="${branchInfo.name}"
                                           onchange="updateBranch(${branchId}, 'name', this.value)">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ÊîØÂ∫ó‰ΩèÊâÄ</label>
                                    <input type="text" class="w-full px-3 py-2 border rounded-lg" placeholder="‰æã: Á•ûÂ•àÂ∑ùÁúåÊ®™ÊµúÂ∏Ç..."
                                           value="${branchInfo.address}"
                                           onchange="updateBranch(${branchId}, 'address', this.value)">
                                </div>
                            </div>
                        `;

                        if (branchList) {
                            branchList.appendChild(branchDiv);
                        }

                        console.log(`‚úì Loaded branch ${i + 1}: ${branchInfo.name} - ${branchInfo.address}`);
                    }

                    // ÊîØÂ∫ó„Éû„ÉÉ„Éó„ÇíÊõ¥Êñ∞
                    setTimeout(() => updateBranchMaps(), 100);
                } else {
                    console.log('No valid branch data after splitting');
                }
            } else {
                console.log('No branch data found in spreadsheet');
            }

            console.log('=== LOADING AREA DATA ===');
            // ÂØæÂøúÈÉΩÈÅìÂ∫úÁúåÔºàAGÂàóÔºâ„ÄÅÂØæÂøúÂ∏ÇÂå∫Áî∫ÊùëÔºàAHÂàóÔºâ„ÄÅÂÑ™ÂÖà„Ç®„É™„Ç¢ÔºàAIÂàóÔºâ„ÇíÂèñÂæó
            const prefecturesRaw = data['ÂØæÂøúÈÉΩÈÅìÂ∫úÁúå'] || data.prefectures || '';
            const citiesRaw = data['ÂØæÂøúÂ∏ÇÂå∫Áî∫Êùë'] || data.cities || '';
            const prioritiesRaw = data['ÂÑ™ÂÖà„Ç®„É™„Ç¢'] || data.priorities || data.priority_areas || '';

            console.log('Prefectures from spreadsheet:', prefecturesRaw);
            console.log('Cities from spreadsheet:', citiesRaw);
            console.log('Priorities from spreadsheet:', prioritiesRaw);

            // ÈÉΩÈÅìÂ∫úÁúå„ÇíË°®Á§∫
            const prefecturesDisplay = document.getElementById('companyPrefecturesDisplay');
            if (prefecturesDisplay) {
                if (prefecturesRaw) {
                    const prefectures = prefecturesRaw.split(',').map(s => s.trim()).filter(s => s);
                    prefecturesDisplay.innerHTML = prefectures.map(pref =>
                        `<span class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg text-sm font-medium shadow-sm hover:shadow-md transition-shadow">
                            ${pref}
                        </span>`
                    ).join('');
                    console.log(`‚úì Loaded ${prefectures.length} prefectures`);
                } else {
                    prefecturesDisplay.innerHTML = '<span class="text-sm text-gray-400 italic">Êú™Ë®≠ÂÆö</span>';
                }
            }

            // Â∏ÇÂå∫Áî∫Êùë„ÇíË°®Á§∫
            const citiesDisplay = document.getElementById('companyCitiesDisplay');
            if (citiesDisplay) {
                if (citiesRaw) {
                    // JSONÂΩ¢Âºè„ÅÆÂ†¥Âêà„Å®„Ç´„É≥„ÉûÂå∫Âàá„Çä„ÅÆÂ†¥Âêà„Å´ÂØæÂøú
                    let cities = [];
                    try {
                        const parsed = JSON.parse(citiesRaw);
                        if (parsed.type === 'compressed' && parsed.full) {
                            cities = parsed.full.split(',').map(s => s.trim()).filter(s => s);
                        } else if (parsed.type === 'compressed' && parsed.preview) {
                            cities = parsed.preview.split(',').map(s => s.trim()).filter(s => s);
                        }
                    } catch (e) {
                        // JSONÂΩ¢Âºè„Åß„Å™„ÅÑÂ†¥Âêà„ÄÅ„Ç´„É≥„ÉûÂå∫Âàá„Çä„Å®„Åó„Å¶Âá¶ÁêÜ
                        cities = citiesRaw.split(',').map(s => s.trim()).filter(s => s);
                    }

                    citiesDisplay.innerHTML = cities.map(city =>
                        `<span class="inline-block px-2.5 py-1 bg-green-50 text-green-700 border border-green-200 rounded text-xs font-medium hover:bg-green-100 transition-colors">
                            ${city}
                        </span>`
                    ).join('');
                    console.log(`‚úì Loaded ${cities.length} cities`);
                } else {
                    citiesDisplay.innerHTML = '<span class="text-sm text-gray-400 italic">Êú™Ë®≠ÂÆö</span>';
                }
            }

            // ÂÑ™ÂÖà„Ç®„É™„Ç¢„ÇíË°®Á§∫
            const prioritiesDisplay = document.getElementById('companyPrioritiesDisplay');
            if (prioritiesDisplay) {
                if (prioritiesRaw) {
                    const priorities = prioritiesRaw.split(',').map(s => s.trim()).filter(s => s);
                    prioritiesDisplay.innerHTML = priorities.map(priority =>
                        `<span class="inline-flex items-center gap-1 px-4 py-2 bg-gradient-to-r from-amber-400 to-yellow-400 text-amber-900 rounded-lg text-sm font-semibold shadow-sm hover:shadow-md transition-shadow">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                            </svg>
                            ${priority}
                        </span>`
                    ).join('');
                    console.log(`‚úì Loaded ${priorities.length} priority areas`);
                } else {
                    prioritiesDisplay.innerHTML = '<span class="text-sm text-gray-400 italic">Êú™Ë®≠ÂÆö</span>';
                }
            }

            console.log('=== LOADING CONSTRUCTION DATA ===');
            // ÊñΩÂ∑•ÁÆáÊâÄ„Éá„Éº„Çø„ÇíÂèñÂæóÔºàAEÂàóÔºâ
            const constructionRaw = data['ÊñΩÂ∑•ÁÆáÊâÄ'] || data.construction_types || '';
            console.log('Construction types from spreadsheet:', constructionRaw);

            // ÊñΩÂ∑•ÁÆáÊâÄ„Ç¢„Ç§„Ç≥„É≥„Éû„ÉÉ„Éî„É≥„Ç∞
            const constructionIcons = {
                'Â§ñÂ£ÅÂ°óË£Ö': 'üé®',
                'Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï': 'üèóÔ∏è',
                'Â§ñÂ£ÅÂºµÊõø„Åà': 'üî®',
                'Â±ãÊ†πÂ°óË£ÖÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üè†',
                'Â±ã‰∏äÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': '‚òî',
                'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚Äª„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠â': 'üîß',
                'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚ÄªÁì¶': 'üèØ',
                'Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï': 'üõ†Ô∏è',
                'Â§ñÂ£ÅË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üîß',
                'Â±ãÊ†πË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üõ†Ô∏è',
                '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üíß',
                'ÂÜÖË£ÖÊ∞¥Âõû„ÇäÔºà„Éê„Çπ„Éª„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éà„Ç§„É¨ÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üöø',
                'ÂÜÖË£ÖÔºà„Éï„É≠„Éº„É™„É≥„Ç∞„ÇÑÁï≥„Å™„Å©„ÅÆÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üè°',
                'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': '‚òî',
                'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÔºàÂ±ãÊ†πÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'üåßÔ∏è',
                'Â±ãÊ†πÂ°óË£ÖÂçòÂìÅ': 'üè†',
                'Â±ã‰∏äÈò≤Ê∞¥ÂçòÂìÅ': '‚òî',
                'Â§ñÂ£ÅË£ú‰øÆÂçòÂìÅ': 'üîß',
                'Â±ãÊ†πË£ú‰øÆÂçòÂìÅ': 'üõ†Ô∏è',
                '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÂçòÂìÅ': 'üíß',
                'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅ': '‚òî',
                'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅ': 'üåßÔ∏è'
            };

            const constructionDisplay = document.getElementById('companyConstructionDisplay');
            if (constructionDisplay) {
                if (constructionRaw) {
                    const constructions = constructionRaw.split(',').map(s => s.trim()).filter(s => s);

                    // ÈáçË§á„ÇíÂâäÈô§„Åô„Çã„Åü„ÇÅ„ÄÅÊ≠£Ë¶èÂåñÂæå„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Åß„É¶„Éã„Éº„ÇØÂåñ
                    const uniqueConstructions = [];
                    const seenTexts = new Set();

                    constructions.forEach(construction => {
                        // Á∞°Áï•Ë°®Á§∫Áî®„Å´ÊñáÂ≠óÂàó„ÇíÁü≠Á∏Æ
                        let displayText = construction
                            .replace('ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ', '')
                            .replace('ÔºàÂ±ãÊ†πÂ∑•‰∫ãÂê´„ÇÄÔºâ', '')
                            .replace('Ôºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ', '')
                            .replace('ÂçòÂìÅ', '')
                            .trim();

                        // „Åæ„Å†Ë¶ã„Å¶„ÅÑ„Å™„ÅÑ„ÉÜ„Ç≠„Çπ„Éà„ÅÆÂ†¥Âêà„ÅÆ„ÅøËøΩÂä†
                        if (!seenTexts.has(displayText)) {
                            seenTexts.add(displayText);
                            uniqueConstructions.push({
                                original: construction,
                                display: displayText
                            });
                        }
                    });

                    constructionDisplay.innerHTML = uniqueConstructions.map(item => {
                        const icon = constructionIcons[item.original] || 'üî®';

                        return `<div class="flex items-center gap-2 p-2 bg-gray-50 hover:bg-gray-100 border border-gray-200 rounded-lg transition-colors">
                            <span class="text-lg">${icon}</span>
                            <span class="text-sm font-medium text-gray-700">${item.display}</span>
                        </div>`;
                    }).join('');
                    console.log(`‚úì Loaded ${uniqueConstructions.length} unique construction types (${constructions.length} total)`);
                } else {
                    constructionDisplay.innerHTML = '<span class="text-sm text-gray-400 italic">Êú™Ë®≠ÂÆö</span>';
                }
            }

            console.log('=== LOADING APPEAL POINTS DATA ===');
            // ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ„Éá„Éº„Çø„ÇíÂèñÂæóÔºàAFÂàóÔºâ
            const appealPointsRaw = data['ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ'] || data.appeal_points || data.special_services || '';
            console.log('Appeal points from spreadsheet:', appealPointsRaw);

            // „Ç¢„Éî„Éº„É´„Éù„Ç§„É≥„Éà„Ç¢„Ç§„Ç≥„É≥„Éû„ÉÉ„Éî„É≥„Ç∞
            const appealPointIcons = {
                'ÈÅÆÁÜ±„ÉªÊñ≠ÁÜ±Â°óÊñôÊèêÊ°àÂèØËÉΩ': 'üå°Ô∏è',
                '„ÇØ„É¨„Ç∏„ÉÉ„Éà„Ç´„Éº„ÉâÊâï„ÅÑÂèØ': 'üí≥',
                'ÊèêÊê∫ÂÖà„É≠„Éº„É≥Êúâ„Çä': 'üè¶',
                'ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà': 'üî•',
                'Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà': 'üí∞',
                'Âç≥Êó•Ë¶ãÁ©ç„ÇÇ„ÇäÂØæÂøú': '‚ö°',
                'Ëá™Á§æËÅ∑‰∫∫ÊñΩÂ∑•': 'üë∑',
                '‰øùË®ºÊúüÈñì10Âπ¥‰ª•‰∏ä': 'üõ°Ô∏è',
                '24ÊôÇÈñìÁ∑äÊÄ•ÂØæÂøú': 'üö®',
                '„Éâ„É≠„Éº„É≥Ë™øÊüªÂØæÂøú': 'üöÅ',
                'ÁÑ°ÊñôÁÇπÊ§ú„Çµ„Éº„Éì„Çπ': 'üîç',
                '„Ç´„É©„Éº„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥ÁÑ°Êñô': 'üé®',
                'ËøëÈö£Êå®Êã∂‰ª£Ë°å': 'üôá',
                'Â∑•‰∫ãÂÜôÁúüÂ†±ÂëäÊõ∏Êèê‰æõ': 'üì∏',
                'ÂÆåÂ∑•Âæå„Ç¢„Éï„Çø„Éº„Éï„Ç©„É≠„Éº': '‚úÖ'
            };

            const appealPointsDisplay = document.getElementById('companyAppealPointsDisplay');
            if (appealPointsDisplay) {
                if (appealPointsRaw) {
                    // Èô§Â§ñ„Åô„Çã„Ç¢„Éî„Éº„É´„Éù„Ç§„É≥„Éà
                    const excludedPoints = [
                        'Á´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÊâãÊ∏°„ÅóÂ∏åÊúõ',
                        'ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÈÉµÈÄÅ„ÉªÈõªË©±„ÅßÂïÜË´áÂèØ'
                    ];

                    const appealPoints = appealPointsRaw
                        .split(',')
                        .map(s => s.trim())
                        .filter(s => s && !excludedPoints.includes(s)); // Èô§Â§ñ„É™„Çπ„Éà„Å´Âê´„Åæ„Çå„Å¶„ÅÑ„Å™„ÅÑ„ÇÇ„ÅÆ„ÅÆ„Åø

                    if (appealPoints.length > 0) {
                        appealPointsDisplay.innerHTML = appealPoints.map(point => {
                            const icon = appealPointIcons[point] || '‚≠ê';

                            return `<div class="flex items-center gap-2 p-2 bg-gradient-to-r from-amber-50 to-yellow-50 hover:from-amber-100 hover:to-yellow-100 border border-yellow-200 rounded-lg transition-all">
                                <span class="text-lg">${icon}</span>
                                <span class="text-sm font-medium text-gray-700">${point}</span>
                            </div>`;
                        }).join('');
                        console.log(`‚úì Loaded ${appealPoints.length} appeal points`);
                    } else {
                        appealPointsDisplay.innerHTML = '<span class="text-sm text-gray-400 italic">Êú™Ë®≠ÂÆö</span>';
                    }
                } else {
                    appealPointsDisplay.innerHTML = '<span class="text-sm text-gray-400 italic">Êú™Ë®≠ÂÆö</span>';
                }
            }

            console.log('=== LOADING QUALIFICATIONS DATA ===');
            // ‰øùÊúâË≥áÊ†º„Éá„Éº„Çø„ÇíÂèñÂæóÔºàATÂàóÔºâ
            const qualificationsRaw = data['‰øùÊúâË≥áÊ†º'] || '';
            console.log('Qualifications from spreadsheet:', qualificationsRaw);

            if (qualificationsRaw) {
                const qualificationsList = qualificationsRaw.split(',').map(q => q.trim()).filter(q => q);
                console.log('Parsed qualifications:', qualificationsList);

                // ÂÖ®„Å¶„ÅÆ‰øùÊúâË≥áÊ†º„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Çí„ÇØ„É™„Ç¢
                document.querySelectorAll('input[name="qualifications"]').forEach(cb => {
                    cb.checked = false;
                });

                // „Ç´„Çπ„Çø„É†Ë≥áÊ†º„É™„Çπ„Éà„Çí„ÇØ„É™„Ç¢
                const customQualList = document.getElementById('customQualificationsList');
                if (customQualList) {
                    customQualList.innerHTML = '';
                }

                // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆ„Éá„Éº„Çø„Å´Âü∫„Å•„ÅÑ„Å¶„ÉÅ„Çß„ÉÉ„ÇØ
                qualificationsList.forEach(qual => {
                    const checkbox = document.querySelector(`input[name="qualifications"][value="${qual}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                        console.log(`‚úì Checked qualification: ${qual}`);
                    } else {
                        // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Å´„Å™„ÅÑË≥áÊ†º„ÅØ„Äå„Åù„ÅÆ‰ªñ„Äç„Å®„Åó„Å¶„Ç´„Çπ„Çø„É†„É™„Çπ„Éà„Å´ËøΩÂä†
                        console.log(`‚ö† Qualification not found in checkboxes, adding as custom: ${qual}`);
                        if (customQualList) {
                            const tag = document.createElement('div');
                            tag.className = 'inline-flex items-center bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm';
                            tag.innerHTML = `
                                <span>${qual}</span>
                                <button onclick="this.parentElement.remove()" class="ml-2 text-blue-600 hover:text-blue-800">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            `;
                            customQualList.appendChild(tag);
                        }
                    }
                });
            }

            console.log('=== LOADING INSURANCE DATA ===');
            // Âä†ÂÖ•‰øùÈô∫„Éá„Éº„Çø„ÇíÂèñÂæóÔºàAUÂàóÔºâ
            const insuranceRaw = data['Âä†ÂÖ•‰øùÈô∫'] || '';
            console.log('Insurance from spreadsheet:', insuranceRaw);

            if (insuranceRaw) {
                const insuranceList = insuranceRaw.split(',').map(i => i.trim()).filter(i => i);
                console.log('Parsed insurance:', insuranceList);

                // ÂÖ®„Å¶„ÅÆÂä†ÂÖ•‰øùÈô∫„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Çí„ÇØ„É™„Ç¢
                document.querySelectorAll('input[name="insurance"]').forEach(cb => {
                    cb.checked = false;
                });

                // „Ç´„Çπ„Çø„É†‰øùÈô∫„É™„Çπ„Éà„Çí„ÇØ„É™„Ç¢
                const customInsList = document.getElementById('customInsuranceList');
                if (customInsList) {
                    customInsList.innerHTML = '';
                }

                // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆ„Éá„Éº„Çø„Å´Âü∫„Å•„ÅÑ„Å¶„ÉÅ„Çß„ÉÉ„ÇØ
                insuranceList.forEach(ins => {
                    const checkbox = document.querySelector(`input[name="insurance"][value="${ins}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                        console.log(`‚úì Checked insurance: ${ins}`);
                    } else {
                        // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Å´„Å™„ÅÑ‰øùÈô∫„ÅØ„Äå„Åù„ÅÆ‰ªñ„Äç„Å®„Åó„Å¶„Ç´„Çπ„Çø„É†„É™„Çπ„Éà„Å´ËøΩÂä†
                        console.log(`‚ö† Insurance not found in checkboxes, adding as custom: ${ins}`);
                        if (customInsList) {
                            const tag = document.createElement('div');
                            tag.className = 'inline-flex items-center bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm';
                            tag.innerHTML = `
                                <span>${ins}</span>
                                <button onclick="this.parentElement.remove()" class="ml-2 text-green-600 hover:text-green-800">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            `;
                            customInsList.appendChild(tag);
                        }
                    }
                });
            }

            // Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêçÔºàXÂàóÔºâ„Çíwindow.merchantData„Å´‰øùÂ≠ò
            const salesPersonName = data['Âñ∂Ê•≠ÊãÖÂΩìËÄÖÊ∞èÂêç'] || data.salesPersonName || data.sales_person_name || '';
            if (salesPersonName) {
                if (!window.merchantData) {
                    window.merchantData = {};
                }
                window.merchantData.salesPerson = salesPersonName;
                console.log(`‚úì Sales person name: ${salesPersonName}`);

                // „Éò„ÉÉ„ÉÄ„Éº„ÅÆÂñ∂Ê•≠ÊãÖÂΩìËÄÖË°®Á§∫„ÇíÊõ¥Êñ∞
                const userRoleElement = document.getElementById('userRole');
                if (userRoleElement) {
                    userRoleElement.textContent = salesPersonName;
                    console.log(`‚úì Updated header with sales person: ${salesPersonName}`);
                }
            }

            // „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´„ÅÆË™≠„ÅøËæº„Åø
            const mainVisualUrlFromSheet = data['„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´'] || data.mainVisual;
            if (mainVisualUrlFromSheet) {
                mainVisualUrl = mainVisualUrlFromSheet;
                document.getElementById('mainVisualImage').src = mainVisualUrlFromSheet;
                document.getElementById('mainVisualPreview').classList.remove('hidden');
                document.getElementById('mainVisualPlaceholder').classList.add('hidden');
                console.log('‚úì Loaded main visual:', mainVisualUrlFromSheet);
            }

            // ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº„ÅÆË™≠„ÅøËæº„ÅøÔºàÈÅÖÂª∂Ë™≠„ÅøËæº„Åø + ËªΩÈáè„Çµ„É†„Éç„Ç§„É´Ôºâ
            const galleryUrlsFromSheet = data['ÂÜôÁúü„ÇÆ„É£„É©„É™„Éº'] || data.photoGallery;
            if (galleryUrlsFromSheet) {
                // HYPERLINKÈñ¢Êï∞„ÅÆÁµêÊûú„ÇíÂá¶ÁêÜ
                let urls = [];
                if (typeof galleryUrlsFromSheet === 'string') {
                    // „Ç´„É≥„ÉûÂå∫Âàá„Çä„ÅÆURLÊñáÂ≠óÂàó„ÇíÂàÜÂâ≤
                    urls = galleryUrlsFromSheet.split(',').map(url => url.trim()).filter(url => url && url.startsWith('http'));
                }

                const galleryList = document.getElementById('photoGalleryList');
                const addButton = galleryList.querySelector('.border-dashed');

                urls.forEach((url, index) => {
                    const imageId = 'gallery_loaded_' + index;
                    // „Çµ„É†„Éç„Ç§„É´Áî®„Å´ËªΩÈáèÂåñÔºàw1000 ‚Üí w200Ôºâ
                    const thumbnailUrl = url.replace(/sz=w\d+/, 'sz=w200');

                    const imageDiv = document.createElement('div');
                    imageDiv.className = 'relative group gallery-item';
                    imageDiv.id = imageId;
                    imageDiv.innerHTML = `
                        <img loading="lazy" src="${thumbnailUrl}" class="w-full h-24 object-cover rounded-lg" alt="„ÇÆ„É£„É©„É™„ÉºÁîªÂÉè${index + 1}">
                        <button type="button" onclick="removeGalleryImage('${imageId}')" class="absolute top-1 right-1 bg-red-500 text-white p-1 rounded opacity-0 group-hover:opacity-100 transition">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    `;
                    galleryList.insertBefore(imageDiv, addButton);
                });

                console.log('‚úì Loaded gallery:', urls.length, 'images (lazy loading enabled)');
            }

            console.log('===== loadMerchantData COMPLETE =====');

            // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóÂàùÊúüÂåñ
            setupGalleryDragDrop();
        }

        // Ê°à‰ª∂„Ç´„Éº„Éâ„ÇíÂãïÁöÑ„Å´ÁîüÊàê
        function renderCaseCards() {
            const cardView = document.getElementById('caseCardView');
            if (!cardView) return;

            // Êó¢Â≠ò„ÅÆ„Ç´„Éº„Éâ„Çí„ÇØ„É™„Ç¢
            cardView.innerHTML = '';

            // casesData„Åã„ÇâÊ°à‰ª∂„Ç´„Éº„Éâ„ÇíÁîüÊàê
            const filteredCases = casesData.filter(c => c.assignee); // ÊåØ„ÇäÂàÜ„ÅëÊ∏à„Åø„ÅÆÊ°à‰ª∂„ÅÆ„Åø

            filteredCases.forEach(caseItem => {
                const card = createCaseCard(caseItem);
                cardView.innerHTML += card;
            });
        }

        // ÂÄãÂà•„ÅÆÊ°à‰ª∂„Ç´„Éº„ÉâHTMLÁîüÊàê
        function createCaseCard(caseItem) {
            const statusColor = getStatusColor(caseItem.status);

            return `
                <div class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow cursor-pointer" onclick="showCaseDetail(${caseItem.id})" data-case-id="${caseItem.id}">
                    <div class="flex justify-between items-start mb-3">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusColor}">${caseItem.status}</span>
                        <div class="flex gap-1">
                            <button onclick="event.stopPropagation(); showMemo(${caseItem.id})" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors" title="„É°„É¢">
                                <span class="text-lg">üìù</span>
                            </button>
                            <button onclick="event.stopPropagation(); scheduleCase(${caseItem.id})" class="p-1.5 rounded-lg hover:bg-yellow-100 transition-colors" title="„Çπ„Ç±„Ç∏„É•„Éº„É´">
                                <span class="text-lg">üìÖ</span>
                            </button>
                            <button onclick="event.stopPropagation(); passCase(${caseItem.id})" class="p-1.5 rounded-lg hover:bg-blue-100 transition-colors" title="ÊãÖÂΩì„Éë„Çπ">
                                <span class="text-lg">üîÑ</span>
                            </button>
                            <button onclick="event.stopPropagation(); openCancelRequest(${caseItem.id})" class="p-1.5 rounded-lg hover:bg-red-100 transition-colors" title="„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã">
                                <span class="text-lg">‚ùå</span>
                            </button>
                        </div>
                    </div>
                    <h3 class="font-bold text-lg mb-1">${caseItem.name}</h3>
                    <div class="mb-2">
                        <span class="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded">üë§ ÊãÖÂΩì: ${caseItem.assignee}</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">${caseItem.location || caseItem.area}</p>
                    <p class="text-sm text-gray-600 mb-3">${caseItem.propertyType}</p>
                    <div class="flex justify-between items-center text-xs text-gray-500 mb-3">
                        <span>ÊúÄÁµÇÈÄ£Áµ°: ${caseItem.lastContact || 'Êú™ÈÄ£Áµ°'}</span>
                        <span>Ê¨°Âõû‰∫àÂÆö: ${caseItem.nextAction || 'Êú™ÂÆö'}</span>
                    </div>
                    <div class="flex gap-1">
                        <button onclick="event.stopPropagation(); callCustomer('${caseItem.phone}')" class="flex-1 px-2 py-2 bg-green-100 text-green-700 rounded text-sm hover:bg-green-200 transition-colors">
                            üìû
                        </button>
                        <button onclick="event.stopPropagation(); sendSMS('${caseItem.phone}')" class="flex-1 px-2 py-2 bg-yellow-100 text-yellow-700 rounded text-sm hover:bg-yellow-200 transition-colors">
                            üì©
                        </button>
                        <button onclick="event.stopPropagation(); quickStatusChange(${caseItem.id})" class="flex-1 px-2 py-2 bg-orange-100 text-orange-700 rounded text-sm hover:bg-orange-200 transition-colors">
                            „Çπ„ÉÜ„Éº„Çø„Çπ
                        </button>
                        <button onclick="event.stopPropagation(); showCaseDetail(${caseItem.id})" class="flex-1 px-2 py-2 bg-blue-100 text-blue-700 rounded text-sm hover:bg-blue-200 transition-colors">
                            Ë©≥Á¥∞
                        </button>
                    </div>
                </div>
            `;
        }

        // Ë°®Á§∫ÂàáÊõø
        function toggleCaseView() {
            currentCaseView = currentCaseView === 'card' ? 'list' : 'card';
            const cardView = document.getElementById('caseCardView');
            const listView = document.getElementById('caseListView');
            const viewIcon = document.getElementById('viewIcon');

            if (currentCaseView === 'card') {
                cardView.style.display = 'grid';
                listView.style.display = 'none';
                viewIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>';
            } else {
                cardView.style.display = 'none';
                listView.style.display = 'block';
                viewIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>';
            }
        }

        // ÁèæÂú®„ÅÆ„Éï„Ç£„É´„Çø„ÉºÁä∂ÊÖã
        let currentFilter = 'all';
        let currentSearchTerm = '';
        let currentSort = 'date_desc';

        // Ê°à‰ª∂„Ç´„Ç¶„É≥„Éà„ÇíÊõ¥Êñ∞
        function updateCaseCounts() {
            const counts = {
                'all': casesData.filter(c => c.assignee).length,
                'Êú™ÂØæÂøú': casesData.filter(c => c.assignee && c.status === 'Êú™ÂØæÂøú').length,
                '„Ç¢„ÉùÊ∏à': casesData.filter(c => c.assignee && c.status === '„Ç¢„ÉùÊ∏à').length,
                'Ë¶ãÁ©çÊèêÂá∫Ê∏à': casesData.filter(c => c.assignee && c.status === 'Ë¶ãÁ©çÊèêÂá∫Ê∏à').length,
                'ÊàêÁ¥Ñ': casesData.filter(c => c.assignee && c.status === 'ÊàêÁ¥Ñ').length
            };

            // ID„Çí‰ΩøÁî®„Åó„Å¶„Ç´„Ç¶„É≥„Éà„ÇíÊõ¥Êñ∞
            Object.keys(counts).forEach(key => {
                const el = document.getElementById(`count-${key}`);
                if (el) {
                    el.textContent = counts[key];
                }
            });
        }

        // „Éï„Ç£„É´„Çø„ÉºÊ©üËÉΩ
        function filterCases(status) {
            currentFilter = status;

            // „Éï„Ç£„É´„Çø„Éº„Éú„Çø„É≥„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.filter-stat-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-blue-500');
            });
            event.target.closest('.filter-stat-btn').classList.add('ring-2', 'ring-blue-500');

            // „Ç´„Éº„Éâ„ÇíÂÜçÊèèÁîª
            renderFilteredAndSortedCards();
        }

        // Ê§úÁ¥¢Ê©üËÉΩ
        function searchCases() {
            currentSearchTerm = document.getElementById('caseSearchInput').value.toLowerCase();
            renderFilteredAndSortedCards();
        }

        // „ÇΩ„Éº„ÉàÊ©üËÉΩ
        function sortCases() {
            currentSort = document.getElementById('caseSortSelect').value;
            renderFilteredAndSortedCards();
        }

        // „Éï„Ç£„É´„Çø„Éº„ÄÅÊ§úÁ¥¢„ÄÅ„ÇΩ„Éº„Éà„ÇíÈÅ©Áî®„Åó„Å¶„Ç´„Éº„Éâ„ÇíÂÜçÊèèÁîª
        function renderFilteredAndSortedCards() {
            const cardView = document.getElementById('caseCardView');
            if (!cardView) return;

            // „Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            let filteredCases = casesData.filter(c => c.assignee);

            // „Çπ„ÉÜ„Éº„Çø„Çπ„Éï„Ç£„É´„Çø„Éº
            if (currentFilter !== 'all') {
                filteredCases = filteredCases.filter(c => c.status === currentFilter);
            }

            // Ê§úÁ¥¢„Éï„Ç£„É´„Çø„Éº
            if (currentSearchTerm) {
                filteredCases = filteredCases.filter(c =>
                    c.name.toLowerCase().includes(currentSearchTerm) ||
                    c.location.toLowerCase().includes(currentSearchTerm)
                );
            }

            // „ÇΩ„Éº„Éà
            filteredCases.sort((a, b) => {
                switch(currentSort) {
                    case 'date_desc':
                        return (b.id || 0) - (a.id || 0); // ID„ÇíÊó•‰ªò„ÅÆ‰ª£„Çè„Çä„Å´‰ΩøÁî®
                    case 'date_asc':
                        return (a.id || 0) - (b.id || 0);
                    case 'status':
                        const statusOrder = ['Êú™ÂØæÂøú', 'Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù', '„Ç¢„ÉùÊ∏à', 'ÁèæË™øÊ∏à', 'Ë¶ãÁ©çÊèêÂá∫Ê∏à', 'ÊàêÁ¥Ñ'];
                        return statusOrder.indexOf(a.status) - statusOrder.indexOf(b.status);
                    default:
                        return 0;
                }
            });

            // „Ç´„Éº„Éâ„Çí„ÇØ„É™„Ç¢„Åó„Å¶ÂÜçÊèèÁîª
            cardView.innerHTML = '';
            filteredCases.forEach(caseItem => {
                const card = createCaseCard(caseItem);
                cardView.innerHTML += card;
            });
        }

        // Ê°à‰ª∂„Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„ÅüËâ≤„ÇíÂèñÂæó
        function getStatusColor(status) {
            const statusColors = {
                'Êú™ÂØæÂøú': 'bg-red-100 text-red-800',
                'Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù': 'bg-orange-100 text-orange-800',
                '„Ç¢„ÉùÊ∏à': 'bg-blue-100 text-blue-800',
                'ÁèæË™øÊ∏à': 'bg-indigo-100 text-indigo-800',
                'ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´': 'bg-gray-100 text-gray-800',
                'ÁèæË™øÂæåÂ§±Ê≥®': 'bg-gray-100 text-gray-800',
                'Ë¶ãÁ©çÊèêÂá∫Ê∏à': 'bg-yellow-100 text-yellow-800',
                'ÊàêÁ¥Ñ': 'bg-green-100 text-green-800',
                '‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à': 'bg-gray-100 text-gray-800',
                'Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à': 'bg-purple-100 text-purple-800',
                'ÂÖ•Èáë‰∫àÂÆö': 'bg-cyan-100 text-cyan-800',
                'ÂÖ•ÈáëÊ∏à': 'bg-emerald-100 text-emerald-800',
                '„ÇØ„É¨„Éº„É† or Â§±Ê≥®': 'bg-red-100 text-red-800'
            };
            return statusColors[status] || 'bg-gray-100 text-gray-800';
        }

        // Ê°à‰ª∂ÊåØ„ÇäÂàÜ„Åë„É¢„Éº„ÉÄ„É´
        function openAssignmentModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.id = 'assignmentModal';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-4 sm:p-6 w-full max-w-6xl max-h-[90vh] overflow-y-auto mx-2 sm:mx-4">
                    <div class="flex justify-between items-center mb-4 sm:mb-6">
                        <h3 class="text-lg sm:text-xl font-bold">Ê°à‰ª∂ÊåØ„ÇäÂàÜ„Åë</h3>
                        <button onclick="closeAssignmentModal()" class="text-gray-500 hover:text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- ÊåØ„ÇäÂàÜ„ÅëË®≠ÂÆö -->
                    <div class="bg-gray-50 rounded-lg p-3 sm:p-4 mb-4 sm:mb-6">
                        <h4 class="font-semibold mb-2 sm:mb-3 text-sm sm:text-base">ÊåØ„ÇäÂàÜ„ÅëÊñπÊ≥ï</h4>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3">
                            <div>
                                <label class="flex items-center">
                                    <input type="radio" name="assignMethod" value="area" class="mr-1 sm:mr-2" onchange="updateAssignmentSuggestion()">
                                    <span class="text-xs sm:text-sm">„Ç®„É™„Ç¢ÂÑ™ÂÖà</span>
                                </label>
                            </div>
                            <div>
                                <label class="flex items-center">
                                    <input type="radio" name="assignMethod" value="workload" class="mr-1 sm:mr-2" onchange="updateAssignmentSuggestion()">
                                    <span class="text-xs sm:text-sm">Ê°à‰ª∂Êï∞ÂÑ™ÂÖà</span>
                                </label>
                            </div>
                            <div>
                                <label class="flex items-center">
                                    <input type="radio" name="assignMethod" value="performance" class="mr-1 sm:mr-2" onchange="updateAssignmentSuggestion()">
                                    <span class="text-xs sm:text-sm">ÊàêÁ¥ÑÁéáÂÑ™ÂÖà</span>
                                </label>
                            </div>
                            <div>
                                <label class="flex items-center">
                                    <input type="radio" name="assignMethod" value="auto" class="mr-1 sm:mr-2" checked onchange="updateAssignmentSuggestion()">
                                    <span class="text-xs sm:text-sm">Á∑èÂêàÂà§ÂÆö</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-2 sm:gap-4 lg:gap-6">
                        <!-- Â∑¶ÂÅ¥ÔºöÂñ∂Ê•≠ÊãÖÂΩìËÄÖÔºà„Éâ„É©„ÉÉ„Ç∞ÂÖÉÔºâ -->
                        <div>
                            <h4 class="font-semibold mb-2 sm:mb-3 text-xs sm:text-sm lg:text-base">Âñ∂Ê•≠ÊãÖÂΩìËÄÖ</h4>
                            <div class="space-y-2 sm:space-y-3">
                                <!-- Áî∞‰∏≠Â§™ÈÉé -->
                                <div class="assignee-card bg-white border rounded-lg p-2 sm:p-3 cursor-move hover:shadow-md transition-shadow" draggable="true" data-assignee-id="tanaka" data-assignee-name="Áî∞‰∏≠Â§™ÈÉé">
                                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-1 sm:mb-2">
                                        <div>
                                            <span class="font-medium text-xs sm:text-sm">üë§ Áî∞‰∏≠Â§™ÈÉé</span>
                                            <span class="hidden sm:inline text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded ml-2">„É™„Éº„ÉÄ„Éº</span>
                                        </div>
                                        <div class="text-xs text-gray-500">
                                            <span class="font-bold">3‰ª∂</span>
                                        </div>
                                    </div>
                                    <div class="hidden sm:block text-xs text-gray-600">
                                        ‰∏ñÁî∞Ë∞∑Âå∫ | 75%
                                    </div>
                                </div>
                                <!-- ‰ΩêËó§Ëä±Â≠ê -->
                                <div class="assignee-card bg-white border rounded-lg p-2 sm:p-3 cursor-move hover:shadow-md transition-shadow" draggable="true" data-assignee-id="sato" data-assignee-name="‰ΩêËó§Ëä±Â≠ê">
                                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-1 sm:mb-2">
                                        <div>
                                            <span class="font-medium text-xs sm:text-sm">üë§ ‰ΩêËó§Ëä±Â≠ê</span>
                                            <span class="hidden sm:inline text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded ml-2">‰∏ÄËà¨Âñ∂Ê•≠</span>
                                        </div>
                                        <div class="text-xs text-gray-500">
                                            <span class="font-bold">5‰ª∂</span>
                                        </div>
                                    </div>
                                    <div class="hidden sm:block text-xs text-gray-600">
                                        Ê®™ÊµúÂ∏Ç | 62%
                                    </div>
                                </div>
                                <!-- Â±±Áî∞Ê¨°ÈÉé -->
                                <div class="assignee-card bg-white border rounded-lg p-2 sm:p-3 cursor-move hover:shadow-md transition-shadow" draggable="true" data-assignee-id="yamada" data-assignee-name="Â±±Áî∞Ê¨°ÈÉé">
                                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-1 sm:mb-2">
                                        <div>
                                            <span class="font-medium text-xs sm:text-sm">üë§ Â±±Áî∞Ê¨°ÈÉé</span>
                                            <span class="hidden sm:inline text-xs bg-gray-100 text-gray-800 px-2 py-1 rounded ml-2">Êñ∞‰∫∫</span>
                                        </div>
                                        <div class="text-xs text-gray-500">
                                            <span class="font-bold">2‰ª∂</span>
                                        </div>
                                    </div>
                                    <div class="hidden sm:block text-xs text-gray-600">
                                        ÂçÉËëâÂ∏Ç | 40%
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Âè≥ÂÅ¥ÔºöÊú™Ââ≤ÂΩìÊ°à‰ª∂Ôºà„Éâ„É≠„ÉÉ„ÉóÂÖàÔºâ -->
                        <div>
                            <h4 class="font-semibold mb-2 sm:mb-3 text-xs sm:text-sm lg:text-base">Êú™Ââ≤ÂΩìÊ°à‰ª∂</h4>
                            <div class="bg-gray-50 border rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 min-h-[400px] overflow-y-auto" id="unassignedCases">
                                <!-- Êú™Ââ≤ÂΩìÊ°à‰ª∂„Ç´„Éº„Éâ -->
                                <div class="case-drop-zone bg-yellow-50 border-2 border-yellow-200 rounded-lg p-2 sm:p-3 hover:bg-yellow-100 transition-colors" data-case-id="101">
                                    <div class="flex justify-between items-start mb-1 sm:mb-2">
                                        <span class="text-xs sm:text-sm font-semibold">È´òÊ©ãÊßò</span>
                                        <span class="text-xs bg-yellow-100 text-yellow-800 px-1 sm:px-2 py-0.5 sm:py-1 rounded">Êñ∞Ë¶è</span>
                                    </div>
                                    <p class="text-xs text-gray-600 mb-0.5 sm:mb-1">üìç ‰∏ñÁî∞Ë∞∑Âå∫</p>
                                    <p class="text-xs text-gray-600 mb-0.5 sm:mb-1 hidden sm:block">üè† Êà∏Âª∫„Å¶„ÉªÁØâ12Âπ¥</p>
                                    <p class="text-xs text-gray-600 mb-1 sm:mb-2 hidden sm:block">üìû 090-1234-5678</p>
                                    <!-- ÊãÖÂΩìËÄÖ„Éâ„É≠„ÉÉ„Éó„Ç®„É™„Ç¢ -->
                                    <div class="assignee-drop-area bg-white border-2 border-dashed border-gray-300 rounded-lg p-1 sm:p-2 min-h-[30px] sm:min-h-[40px]">
                                        <p class="text-xs text-gray-400 text-center">„Éâ„É≠„ÉÉ„Éó</p>
                                    </div>
                                    <div class="mt-1 sm:mt-2 pt-1 sm:pt-2 border-t hidden sm:block">
                                        <p class="text-xs text-blue-600 font-medium">
                                            Êé®Â•®: Áî∞‰∏≠Â§™ÈÉé
                                        </p>
                                    </div>
                                </div>
                                <div class="case-drop-zone bg-yellow-50 border-2 border-yellow-200 rounded-lg p-2 sm:p-3 hover:bg-yellow-100 transition-colors" data-case-id="102">
                                    <div class="flex justify-between items-start mb-1 sm:mb-2">
                                        <span class="text-xs sm:text-sm font-semibold">ÊñéËó§Êßò</span>
                                        <span class="text-xs bg-yellow-100 text-yellow-800 px-1 sm:px-2 py-0.5 sm:py-1 rounded">Êñ∞Ë¶è</span>
                                    </div>
                                    <p class="text-xs text-gray-600 mb-0.5 sm:mb-1">üìç Ê®™ÊµúÂ∏Ç</p>
                                    <p class="text-xs text-gray-600 mb-0.5 sm:mb-1 hidden sm:block">üè¢ „Ç¢„Éë„Éº„Éà„ÉªÁØâ18Âπ¥</p>
                                    <p class="text-xs text-gray-600 mb-1 sm:mb-2 hidden sm:block">üìû 045-9876-5432</p>
                                    <!-- ÊãÖÂΩìËÄÖ„Éâ„É≠„ÉÉ„Éó„Ç®„É™„Ç¢ -->
                                    <div class="assignee-drop-area bg-white border-2 border-dashed border-gray-300 rounded-lg p-1 sm:p-2 min-h-[30px] sm:min-h-[40px]">
                                        <p class="text-xs text-gray-400 text-center">„Éâ„É≠„ÉÉ„Éó</p>
                                    </div>
                                    <div class="mt-1 sm:mt-2 pt-1 sm:pt-2 border-t hidden sm:block">
                                        <p class="text-xs text-blue-600 font-medium">
                                            Êé®Â•®: ‰ΩêËó§Ëä±Â≠ê
                                        </p>
                                    </div>
                                </div>
                                <div class="case-drop-zone bg-yellow-50 border-2 border-yellow-200 rounded-lg p-2 sm:p-3 hover:bg-yellow-100 transition-colors" data-case-id="103">
                                    <div class="flex justify-between items-start mb-1 sm:mb-2">
                                        <span class="text-xs sm:text-sm font-semibold">Ê∏°Ëæ∫Êßò</span>
                                        <span class="text-xs bg-yellow-100 text-yellow-800 px-1 sm:px-2 py-0.5 sm:py-1 rounded">Êñ∞Ë¶è</span>
                                    </div>
                                    <p class="text-xs text-gray-600 mb-0.5 sm:mb-1">üìç „Åï„ÅÑ„Åü„ÅæÂ∏Ç</p>
                                    <p class="text-xs text-gray-600 mb-0.5 sm:mb-1 hidden sm:block">üè† Êà∏Âª∫„Å¶„ÉªÁØâ20Âπ¥</p>
                                    <p class="text-xs text-gray-600 mb-1 sm:mb-2 hidden sm:block">üìû 048-5555-6666</p>
                                    <!-- ÊãÖÂΩìËÄÖ„Éâ„É≠„ÉÉ„Éó„Ç®„É™„Ç¢ -->
                                    <div class="assignee-drop-area bg-white border-2 border-dashed border-gray-300 rounded-lg p-1 sm:p-2 min-h-[30px] sm:min-h-[40px]">
                                        <p class="text-xs text-gray-400 text-center">„Éâ„É≠„ÉÉ„Éó</p>
                                    </div>
                                    <div class="mt-1 sm:mt-2 pt-1 sm:pt-2 border-t hidden sm:block">
                                        <p class="text-xs text-orange-600 font-medium">
                                            Êé®Â•®: Ë§áÊï∞ÊãÖÂΩì
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
                    <div class="flex flex-col sm:flex-row justify-between items-center mt-4 sm:mt-6 pt-4 sm:pt-6 border-t gap-3">
                        <button onclick="autoAssignAll()" class="w-full sm:w-auto px-3 sm:px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm sm:text-base">
                            ‰∏ÄÊã¨Ëá™ÂãïÊåØ„ÇäÂàÜ„Åë
                        </button>
                        <div class="flex w-full sm:w-auto space-x-2 sm:space-x-3">
                            <button onclick="closeAssignmentModal()" class="flex-1 sm:flex-none px-3 sm:px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 text-sm sm:text-base">
                                „Ç≠„É£„É≥„Çª„É´
                            </button>
                            <button onclick="confirmAssignment()" class="flex-1 sm:flex-none px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm sm:text-base">
                                ÊåØ„ÇäÂàÜ„Åë„ÇíÁ¢∫ÂÆö
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            initDragAndDrop();
        }

        // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeAssignmentModal() {
            const modal = document.getElementById('assignmentModal');
            if (modal) modal.remove();
        }

        // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóÂàùÊúüÂåñ
        function initDragAndDrop() {
            let draggedElement = null;

            // ÊãÖÂΩìËÄÖ„Ç´„Éº„Éâ„ÅÆ„Éâ„É©„ÉÉ„Ç∞ÈñãÂßã
            document.querySelectorAll('.assignee-card').forEach(card => {
                card.addEventListener('dragstart', (e) => {
                    draggedElement = e.target.closest('.assignee-card');
                    e.target.style.opacity = '0.5';
                    e.dataTransfer.effectAllowed = 'copy';
                });

                card.addEventListener('dragend', (e) => {
                    e.target.style.opacity = '';
                });
            });

            // Ê°à‰ª∂„Ç´„Éº„ÉâÂÖ®‰Ωì„Çí„Éâ„É≠„ÉÉ„Éó„Ç®„É™„Ç¢„Å´Ë®≠ÂÆö
            document.querySelectorAll('.case-drop-zone').forEach(caseCard => {
                const dropArea = caseCard.querySelector('.assignee-drop-area');
                caseCard.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'copy';
                    caseCard.classList.add('bg-blue-50', 'border-blue-400');
                });

                caseCard.addEventListener('dragleave', (e) => {
                    // Â≠êË¶ÅÁ¥†„Å∏„ÅÆÁßªÂãï„ÅØÁÑ°Ë¶ñ
                    if (!caseCard.contains(e.relatedTarget)) {
                        caseCard.classList.remove('bg-blue-50', 'border-blue-400');
                    }
                });

                caseCard.addEventListener('drop', (e) => {
                    e.preventDefault();
                    caseCard.classList.remove('bg-blue-50', 'border-blue-400');

                    if (draggedElement) {
                        const assigneeId = draggedElement.dataset.assigneeId;
                        const assigneeName = draggedElement.dataset.assigneeName;
                        const caseId = caseCard.dataset.caseId;

                        // ÈÄöÂ∏∏„ÅÆÊãÖÂΩìËÄÖ„ÇíËøΩÂä†ÔºàË§áÊï∞ÂèØÔºâ
                        const newTag = document.createElement('div');
                        newTag.className = 'assignee-tag bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-medium flex items-center justify-between mb-1';
                        newTag.innerHTML = `
                            <span>üë§ ${assigneeName}</span>
                            <button onclick="removeAssignee(this)" class="ml-2 text-blue-600 hover:text-blue-800">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        `;

                        // „Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº„ÉÜ„Ç≠„Çπ„Éà„Åå„ÅÇ„Çå„Å∞ÂâäÈô§
                        const placeholder = dropArea.querySelector('.text-gray-400');
                        if (placeholder) {
                            placeholder.remove();
                        }

                        // Âêå„ÅòÊãÖÂΩìËÄÖ„ÅåÊó¢„Å´Ââ≤„ÇäÂΩì„Å¶„Çâ„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                        const existingAssignees = Array.from(dropArea.querySelectorAll('.assignee-tag')).map(tag =>
                            tag.querySelector('span').textContent.replace('üë§ ', '')
                        );

                        if (!existingAssignees.includes(assigneeName)) {
                            dropArea.appendChild(newTag);
                            caseCard.classList.add('border-blue-400');
                        } else {
                            showNotification('Êó¢„Å´Ââ≤„ÇäÂΩì„Å¶Ê∏à„Åø', `${assigneeName}„ÅØÊó¢„Å´„Åì„ÅÆÊ°à‰ª∂„Å´Ââ≤„ÇäÂΩì„Å¶„Çâ„Çå„Å¶„ÅÑ„Åæ„Åô`);
                        }
                    }
                });
            });
        }

        // ÊãÖÂΩìËÄÖ„ÇíÂâäÈô§
        function removeAssignee(button) {
            const tag = button.closest('.assignee-tag');
            const dropArea = tag.closest('.assignee-drop-area');
            tag.remove();

            // ÊãÖÂΩìËÄÖ„Åå„ÅÑ„Å™„Åè„Å™„Å£„Åü„Çâ„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº„ÇíË°®Á§∫
            if (dropArea.querySelectorAll('.assignee-tag').length === 0) {
                dropArea.innerHTML = '<p class="text-xs text-gray-400 text-center">ÊãÖÂΩìËÄÖ„Çí„Åì„Åì„Å´„Éâ„É≠„ÉÉ„Éó</p>';
                const caseCard = dropArea.closest('.case-drop-zone');
                caseCard.classList.remove('border-blue-400');
            }
        }

        // ÊåØ„ÇäÂàÜ„ÅëÊñπÊ≥ïÂ§âÊõ¥ÊôÇ„ÅÆÊé®Â•®Êõ¥Êñ∞
        function updateAssignmentSuggestion() {
            const method = document.querySelector('input[name="assignMethod"]:checked').value;
            const caseCards = document.querySelectorAll('.case-card');

            caseCards.forEach(card => {
                const suggestionEl = card.querySelector('.text-blue-600, .text-orange-600');
                if (suggestionEl) {
                    switch(method) {
                        case 'area':
                            suggestionEl.textContent = 'Êé®Â•®: „Ç®„É™„Ç¢„Éû„ÉÉ„ÉÅ„Åô„ÇãÊãÖÂΩìËÄÖ';
                            break;
                        case 'workload':
                            suggestionEl.textContent = 'Êé®Â•®: Ê°à‰ª∂Êï∞„ÅåÂ∞ë„Å™„ÅÑÊãÖÂΩìËÄÖ';
                            break;
                        case 'performance':
                            suggestionEl.textContent = 'Êé®Â•®: ÊàêÁ¥ÑÁéá„ÅåÈ´ò„ÅÑÊãÖÂΩìËÄÖ';
                            break;
                        case 'auto':
                            // ÂÖÉ„ÅÆÊé®Â•®„Å´Êàª„Åô
                            break;
                    }
                }
            });
        }

        // ‰∏ÄÊã¨Ëá™ÂãïÊåØ„ÇäÂàÜ„Åë
        function autoAssignAll() {
            const method = document.querySelector('input[name="assignMethod"]:checked').value;
            const caseCards = document.querySelectorAll('.case-drop-zone');

            caseCards.forEach(caseCard => {
                const caseId = caseCard.dataset.caseId;
                const dropArea = caseCard.querySelector('.assignee-drop-area');

                // Êó¢„Å´ÊãÖÂΩìËÄÖ„ÅåÂâ≤„ÇäÂΩì„Å¶„Çâ„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„Çπ„Ç≠„ÉÉ„Éó
                if (dropArea.querySelector('.assignee-tag')) {
                    return;
                }

                // Á∞°ÊòìÁöÑ„Å™Ëá™ÂãïÊåØ„ÇäÂàÜ„Åë„É≠„Ç∏„ÉÉ„ÇØÔºà„Éá„É¢Áî®Ôºâ
                let assigneeName = '';
                let assigneeType = 'normal';

                if (caseId === '101') {
                    assigneeName = 'Áî∞‰∏≠Â§™ÈÉé';
                } else if (caseId === '102') {
                    assigneeName = '‰ΩêËó§Ëä±Â≠ê';
                } else if (caseId === '103') {
                    // 3Áï™ÁõÆ„ÅÆÊ°à‰ª∂„ÇÇÈÄöÂ∏∏„ÅÆÊãÖÂΩìËÄÖ„ÇíÂâ≤„ÇäÂΩì„Å¶
                    assigneeName = 'Â±±Áî∞Ê¨°ÈÉé';
                }

                // ÊãÖÂΩìËÄÖ„Çø„Ç∞„ÇíËøΩÂä†
                if (assigneeName) {
                    dropArea.innerHTML = `
                        <div class="assignee-tag bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-medium flex items-center justify-between">
                            <span>üë§ ${assigneeName}</span>
                            <button onclick="removeAssignee(this)" class="ml-2 text-blue-600 hover:text-blue-800">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    `;
                    caseCard.classList.add('border-blue-400');
                }
            });

            showNotification('Ëá™ÂãïÊåØ„ÇäÂàÜ„ÅëÂÆå‰∫Ü', 'Êé®Â•®ÊãÖÂΩìËÄÖ„Å´Ê°à‰ª∂„ÇíÊåØ„ÇäÂàÜ„Åë„Åæ„Åó„Åü');
        }

        // ÊåØ„ÇäÂàÜ„ÅëÁ¢∫ÂÆö
        function confirmAssignment() {
            const assignments = [];
            const caseCards = document.querySelectorAll('.case-drop-zone');

            caseCards.forEach(caseCard => {
                const caseId = caseCard.dataset.caseId;
                const dropArea = caseCard.querySelector('.assignee-drop-area');
                const assigneeTags = dropArea.querySelectorAll('.assignee-tag');

                if (assigneeTags.length > 0) {
                    const customerName = caseCard.querySelector('.font-semibold').textContent;
                    const assignees = Array.from(assigneeTags).map(tag =>
                        tag.querySelector('span').textContent.replace('üë§ ', '')
                    );

                    assignments.push({
                        caseId: caseId,
                        customerName: customerName,
                        assignees: assignees
                    });
                }
            });

            if (assignments.length > 0) {
                let message = '‰ª•‰∏ã„ÅÆÊåØ„ÇäÂàÜ„Åë„ÇíÁ¢∫ÂÆö„Åó„Åæ„Åó„Åü:\n';
                assignments.forEach(a => {
                    message += `${a.customerName} ‚Üí ${a.assignees.join(', ')}\n`;
                });

                showNotification('ÊåØ„ÇäÂàÜ„ÅëÂÆå‰∫Ü', message);

                // Êú™ÊåØ„ÇäÂàÜ„ÅëÊ°à‰ª∂„Åã„ÇâÂâäÈô§
                assignments.forEach(a => {
                    const index = unassignedCases.findIndex(c => c.id == a.caseId);
                    if (index !== -1) {
                        unassignedCases.splice(index, 1);
                    }
                });
                displayUnassignedCases();
                closeAssignmentModal();
            } else {
                alert('ÊåØ„ÇäÂàÜ„Åë„ÇãÊ°à‰ª∂„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            }
        }

        // Ê°à‰ª∂Ë©≥Á¥∞Ë°®Á§∫
        function showCaseDetail(caseId) {
            const caseData = casesData.find(c => c.id === caseId);
            if (!caseData) return;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-start mb-4">
                        <h2 class="text-2xl font-bold">${caseData.name}Êßò</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥ -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">„Çπ„ÉÜ„Éº„Çø„Çπ</label>
                        <select id="caseStatus" onchange="updateCaseStatus(${caseId}, this.value)" class="w-full md:w-auto px-4 py-2 border rounded-lg">
                            <option value="Êú™ÂØæÂøú" ${caseData.status === 'Êú™ÂØæÂøú' ? 'selected' : ''}>Êú™ÂØæÂøú</option>
                            <option value="Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù" ${caseData.status === 'Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù' ? 'selected' : ''}>Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù</option>
                            <option value="„Ç¢„ÉùÊ∏à" ${caseData.status === '„Ç¢„ÉùÊ∏à' ? 'selected' : ''}>„Ç¢„ÉùÊ∏à</option>
                            <option value="ÁèæË™øÊ∏à" ${caseData.status === 'ÁèæË™øÊ∏à' ? 'selected' : ''}>ÁèæË™øÊ∏à</option>
                            <option value="ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´" ${caseData.status === 'ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´' ? 'selected' : ''}>ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´</option>
                            <option value="ÁèæË™øÂæåÂ§±Ê≥®" ${caseData.status === 'ÁèæË™øÂæåÂ§±Ê≥®' ? 'selected' : ''}>ÁèæË™øÂæåÂ§±Ê≥®</option>
                            <option value="Ë¶ãÁ©çÊèêÂá∫Ê∏à" ${caseData.status === 'Ë¶ãÁ©çÊèêÂá∫Ê∏à' ? 'selected' : ''}>Ë¶ãÁ©çÊèêÂá∫Ê∏à</option>
                            <option value="ÊàêÁ¥Ñ" ${caseData.status === 'ÊàêÁ¥Ñ' ? 'selected' : ''}>ÊàêÁ¥Ñ</option>
                            <option value="‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à" ${caseData.status === '‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à' ? 'selected' : ''}>‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à</option>
                            <option value="Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à" ${caseData.status === 'Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à' ? 'selected' : ''}>Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à</option>
                            <option value="ÂÖ•Èáë‰∫àÂÆö" ${caseData.status === 'ÂÖ•Èáë‰∫àÂÆö' ? 'selected' : ''}>ÂÖ•Èáë‰∫àÂÆö</option>
                            <option value="ÂÖ•ÈáëÊ∏à" ${caseData.status === 'ÂÖ•ÈáëÊ∏à' ? 'selected' : ''}>ÂÖ•ÈáëÊ∏à</option>
                            <option value="„ÇØ„É¨„Éº„É† or Â§±Ê≥®" ${caseData.status === '„ÇØ„É¨„Éº„É† or Â§±Ê≥®' ? 'selected' : ''}>„ÇØ„É¨„Éº„É† or Â§±Ê≥®</option>
                        </select>
                    </div>

                    <!-- Âü∫Êú¨ÊÉÖÂ†± -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <p class="text-sm text-gray-600">‰ΩèÊâÄ</p>
                            <p class="font-medium">${caseData.location}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Áâ©‰ª∂Á®ÆÂà•</p>
                            <p class="font-medium">${caseData.propertyType}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">ÈõªË©±Áï™Âè∑</p>
                            <p class="font-medium">${caseData.phone}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">ÊãÖÂΩìËÄÖ</p>
                            <p class="font-medium">${caseData.assignee || 'Êú™Ââ≤ÂΩì'}</p>
                        </div>
                    </div>

                    <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
                    <div class="flex flex-wrap gap-2 mb-6">
                        <button onclick="callCustomer('${caseData.phone}')" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
                            üìû ÈõªË©±
                        </button>
                        <button onclick="sendSMS('${caseData.phone}', ${caseData.id})" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                            üì© SMS
                        </button>
                        <button onclick="showMemo(${caseId})" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600">
                            üìù „É°„É¢
                        </button>
                        <button onclick="passCase(${caseId})" class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600">
                            üîÑ Âºï„ÅçÁ∂ô„Åé
                        </button>
                    </div>

                    <!-- Ê¥ªÂãïÂ±•Ê≠¥ -->
                    <div class="border-t pt-4">
                        <h3 class="font-bold mb-3">Ê¥ªÂãïÂ±•Ê≠¥</h3>
                        <div class="space-y-2 max-h-48 overflow-y-auto">
                            ${getActivityHistory(caseId)}
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // „Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞
        function updateCaseStatus(caseId, newStatus) {
            const currentUser = getCurrentUser();
            const timestamp = new Date().toLocaleString('ja-JP', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            }).replace(/\//g, '/');

            // „Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥Â±•Ê≠¥„ÇíË®òÈå≤ÔºàÂÆüÈöõ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅØAPI„Å´ÈÄÅ‰ø°Ôºâ
            const statusChangeEntry = {
                timestamp: timestamp,
                type: 'status_change',
                user: currentUser.name,
                oldStatus: casesData.find(c => c.id === caseId)?.status,
                newStatus: newStatus,
                caseId: caseId
            };

            // „Åì„Åì„ÅßAPI„Å´ÈÄÅ‰ø°
            console.log('Recording status change:', statusChangeEntry);

            // „É≠„Éº„Ç´„É´„Éá„Éº„Çø„ÇíÊõ¥Êñ∞
            const caseData = casesData.find(c => c.id === caseId);
            if (caseData) {
                caseData.status = newStatus;
            }

            // UI„ÇíÊõ¥Êñ∞
            updateCaseCard(caseId);

            // „Ç´„É¨„É≥„ÉÄ„Éº„ÅÆËá™ÂãïÂêåÊúü
            autoSyncToCalendar();

            showNotification('„Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞', `„Çπ„ÉÜ„Éº„Çø„Çπ„Çí„Äå${newStatus}„Äç„Å´Â§âÊõ¥„Åó„Åæ„Åó„Åü`);
        }

        // Ê¥ªÂãïÂ±•Ê≠¥ÂèñÂæó
        function getActivityHistory(caseId) {
            // „Çµ„É≥„Éó„É´„Éá„Éº„ÇøÔºàÂÆüÈöõ„ÅØAPI„Åã„ÇâÂèñÂæóÔºâ
            const histories = {
                1: `
                    <div class="text-sm border-l-2 border-gray-300 pl-3">
                        <div class="text-xs text-gray-500">2024/03/16 14:00</div>
                        <div>„Äê„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥„ÄëÊú™ÂØæÂøú ‚Üí „Ç¢„ÉùÊ∏àÔºàÁî∞‰∏≠Â§™ÈÉéÔºâ</div>
                    </div>
                    <div class="text-sm border-l-2 border-gray-300 pl-3">
                        <div class="text-xs text-gray-500">2024/03/16 13:30</div>
                        <div>„ÄêÊû∂Èõª„Äë03-1234-5678ÔºàÁî∞‰∏≠Â§™ÈÉéÔºâ</div>
                    </div>
                    <div class="text-sm border-l-2 border-gray-300 pl-3">
                        <div class="text-xs text-gray-500">2024/03/15 16:00</div>
                        <div>„Äê„É°„É¢ËøΩÂä†„Äë‰∫àÁÆóÊÑüÁ¢∫Ë™çÊ∏à„ÅøÔºàÁî∞‰∏≠Â§™ÈÉéÔºâ</div>
                    </div>
                `
            };

            return histories[caseId] || '<div class="text-gray-400 text-sm">Â±•Ê≠¥„Å™„Åó</div>';
        }

        // Ê°à‰ª∂„Ç´„Éº„ÉâUIÊõ¥Êñ∞
        function updateCaseCard(caseId) {
            const caseData = casesData.find(c => c.id === caseId);
            if (!caseData) return;

            const cards = document.querySelectorAll(`[onclick="showCaseDetail(${caseId})"]`);
            cards.forEach(card => {
                // „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„ÉÉ„Ç∏„ÇíÊõ¥Êñ∞
                const statusBadge = card.querySelector('span[class*="rounded-full"]');
                if (statusBadge) {
                    const statusColors = {
                        'Êú™ÂØæÂøú': 'bg-red-100 text-red-800',
                        'Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù': 'bg-orange-100 text-orange-800',
                        '„Ç¢„ÉùÊ∏à': 'bg-blue-100 text-blue-800',
                        'ÁèæË™øÊ∏à': 'bg-indigo-100 text-indigo-800',
                        'ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´': 'bg-gray-100 text-gray-800',
                        'ÁèæË™øÂæåÂ§±Ê≥®': 'bg-gray-100 text-gray-800',
                        'Ë¶ãÁ©çÊèêÂá∫Ê∏à': 'bg-yellow-100 text-yellow-800',
                        'ÊàêÁ¥Ñ': 'bg-green-100 text-green-800',
                        '‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à': 'bg-gray-100 text-gray-800',
                        'Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à': 'bg-purple-100 text-purple-800',
                        'ÂÖ•Èáë‰∫àÂÆö': 'bg-cyan-100 text-cyan-800',
                        'ÂÖ•ÈáëÊ∏à': 'bg-emerald-100 text-emerald-800',
                        '„ÇØ„É¨„Éº„É† or Â§±Ê≥®': 'bg-red-100 text-red-800'
                    };

                    statusBadge.className = `px-2 py-1 text-xs font-semibold rounded-full ${statusColors[caseData.status] || 'bg-gray-100 text-gray-800'}`;
                    statusBadge.textContent = caseData.status;
                }
            });
        }

        // „Çπ„Ç±„Ç∏„É•„Éº„É´Ë®≠ÂÆö
        function scheduleCase(caseId) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
                    <h3 class="text-lg font-bold mb-4">üìÖ „Çπ„Ç±„Ç∏„É•„Éº„É´Ë®≠ÂÆö</h3>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Êó•‰ªò</label>
                        <input type="date" id="scheduleDate" class="w-full p-2 border rounded-lg" value="${new Date().toISOString().split('T')[0]}">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÊôÇÈñì</label>
                        <input type="time" id="scheduleTime" class="w-full p-2 border rounded-lg" value="14:00">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">‰∫àÂÆöÂÜÖÂÆπ</label>
                        <select id="scheduleType" class="w-full p-2 border rounded-lg">
                            <option value="Êû∂Èõª">Êû∂Èõª</option>
                            <option value="Ë®™Âïè">Ë®™Âïè</option>
                            <option value="ÁèæÂú∞Ë™øÊüª">ÁèæÂú∞Ë™øÊüª</option>
                            <option value="Ë¶ãÁ©çÊèêÂá∫">Ë¶ãÁ©çÊèêÂá∫</option>
                            <option value="Â•ëÁ¥Ñ">Â•ëÁ¥Ñ</option>
                            <option value="Â∑•‰∫ã">Â∑•‰∫ã</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">„É°„É¢</label>
                        <textarea id="scheduleMemo" class="w-full p-2 border rounded-lg" rows="2" placeholder="ÂÇôËÄÉ..."></textarea>
                    </div>
                    <div class="flex justify-end gap-2">
                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                        <button onclick="saveSchedule(${caseId})" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            ‰øùÂ≠ò
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // „Çπ„Ç±„Ç∏„É•„Éº„É´‰øùÂ≠ò
        function saveSchedule(caseId) {
            const date = document.getElementById('scheduleDate').value;
            const time = document.getElementById('scheduleTime').value;
            const type = document.getElementById('scheduleType').value;
            const memo = document.getElementById('scheduleMemo').value;

            // „Çπ„Ç±„Ç∏„É•„Éº„É´„Çí‰øùÂ≠òÔºàÂÆüÈöõ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅØAPI„Å´ÈÄÅ‰ø°Ôºâ
            console.log('Saving schedule:', { caseId, date, time, type, memo });

            showNotification('„Çπ„Ç±„Ç∏„É•„Éº„É´ÁôªÈå≤', `${date} ${time} „Å´${type}„Çí‰∫àÂÆö„Åó„Åæ„Åó„Åü`);
            document.querySelector('.fixed').remove();
        }

        // „ÇØ„Ç§„ÉÉ„ÇØ„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥
        function quickStatusChange(caseId) {
            const caseData = casesData.find(c => c.id === caseId);
            if (!caseData) return;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
                    <h3 class="text-lg font-bold mb-4">„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥</h3>
                    <div class="mb-4">
                        <p class="text-sm text-gray-600 mb-2">ÁèæÂú®: <span class="font-medium">${caseData.status}</span></p>
                    </div>
                    <div class="grid grid-cols-2 gap-2 mb-4 max-h-96 overflow-y-auto">
                        <button onclick="updateStatusAndClose(${caseId}, 'Êú™ÂØæÂøú')" class="px-3 py-2 bg-red-100 text-red-800 rounded-lg hover:bg-red-200 text-sm">
                            Êú™ÂØæÂøú
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, 'Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù')" class="px-3 py-2 bg-orange-100 text-orange-800 rounded-lg hover:bg-orange-200 text-sm">
                            Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, '„Ç¢„ÉùÊ∏à')" class="px-3 py-2 bg-blue-100 text-blue-800 rounded-lg hover:bg-blue-200 text-sm">
                            „Ç¢„ÉùÊ∏à
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, 'ÁèæË™øÊ∏à')" class="px-3 py-2 bg-indigo-100 text-indigo-800 rounded-lg hover:bg-indigo-200 text-sm">
                            ÁèæË™øÊ∏à
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, 'ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´')" class="px-3 py-2 bg-gray-100 text-gray-800 rounded-lg hover:bg-gray-200 text-sm">
                            ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, 'ÁèæË™øÂæåÂ§±Ê≥®')" class="px-3 py-2 bg-gray-100 text-gray-800 rounded-lg hover:bg-gray-200 text-sm">
                            ÁèæË™øÂæåÂ§±Ê≥®
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, 'Ë¶ãÁ©çÊèêÂá∫Ê∏à')" class="px-3 py-2 bg-yellow-100 text-yellow-800 rounded-lg hover:bg-yellow-200 text-sm">
                            Ë¶ãÁ©çÊèêÂá∫Ê∏à
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, 'ÊàêÁ¥Ñ')" class="px-3 py-2 bg-green-100 text-green-800 rounded-lg hover:bg-green-200 text-sm">
                            ÊàêÁ¥Ñ
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, '‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à')" class="px-3 py-2 bg-gray-100 text-gray-800 rounded-lg hover:bg-gray-200 text-sm">
                            ‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, 'Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à')" class="px-3 py-2 bg-purple-100 text-purple-800 rounded-lg hover:bg-purple-200 text-sm">
                            Âà•Âä†ÁõüÂ∫óÂ•ëÁ¥ÑÊ∏à
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, 'ÂÖ•Èáë‰∫àÂÆö')" class="px-3 py-2 bg-cyan-100 text-cyan-800 rounded-lg hover:bg-cyan-200 text-sm">
                            ÂÖ•Èáë‰∫àÂÆö
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, 'ÂÖ•ÈáëÊ∏à')" class="px-3 py-2 bg-emerald-100 text-emerald-800 rounded-lg hover:bg-emerald-200 text-sm">
                            ÂÖ•ÈáëÊ∏à
                        </button>
                        <button onclick="updateStatusAndClose(${caseId}, '„ÇØ„É¨„Éº„É† or Â§±Ê≥®')" class="col-span-2 px-3 py-2 bg-red-100 text-red-800 rounded-lg hover:bg-red-200 text-sm">
                            „ÇØ„É¨„Éº„É† or Â§±Ê≥®
                        </button>
                    </div>
                    <div class="flex justify-end">
                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // „Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞„Åó„Å¶Èñâ„Åò„Çã
        function updateStatusAndClose(caseId, newStatus) {
            updateCaseStatus(caseId, newStatus);
            document.querySelector('.fixed').remove();
        }

        // ÈõªË©±Áô∫‰ø°
        function callCustomer(phone) {
            if (confirm(`${phone} „Å´ÈõªË©±„Çí„Åã„Åë„Åæ„Åô„ÅãÔºü`)) {
                window.location.href = `tel:${phone}`;
                // Êû∂ÈõªÂ±•Ê≠¥„ÇíË®òÈå≤
                showNotification('Êû∂Èõª', `${phone} „Å∏„ÅÆÊû∂Èõª„ÇíË®òÈå≤„Åó„Åæ„Åó„Åü`);
            }
        }

        // SMSÈÄÅ‰ø°„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
        function sendSMS(phone, caseId) {
            // Ê°à‰ª∂ÊÉÖÂ†±„ÇíÂèñÂæó
            const caseData = caseId ? casesData.find(c => c.id === caseId) : null;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold">SMS„É°„ÉÉ„Çª„Éº„Ç∏‰ΩúÊàê</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- „Åì„ÅÆ„Éö„Éº„Ç∏„ÅÆÂÜÖÂÆπ -->
                    <div class="mb-4 p-4 bg-gray-50 rounded-lg">
                        <div class="text-sm text-gray-600 mb-2">„Åì„ÅÆ„Éö„Éº„Ç∏„ÅÆÂÜÖÂÆπ</div>
                        <div class="text-sm font-medium">SMS„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ:</div>
                    </div>

                    ${caseData ? `
                    <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÊÉÖÂ†± -->
                    <div class="mb-4 p-4 bg-blue-50 rounded-lg">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-blue-900">ÁèæÂú®„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ: ${caseData.status || 'Êú™ÂØæÂøú'}</span>
                            <span class="text-sm text-gray-600">„ÅäÂÆ¢Êßò: ${caseData.name}</span>
                        </div>
                    </div>

                    <!-- ÈÅ∏ÊäûËÇ¢„Çª„ÇØ„Ç∑„Éß„É≥ -->
                    <div class="mb-4">
                        <div class="text-sm font-medium mb-2">Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÇíÈÅ∏Êäû:</div>
                        <div id="nextStepOptions" class="space-y-2">
                            <!-- „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„ÅüÈÅ∏ÊäûËÇ¢„ÇíÂãïÁöÑ„Å´ÁîüÊàê -->
                        </div>
                    </div>
                    ` : ''}

                    <!-- AIÁîüÊàê„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫ -->
                    <div class="mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <label class="text-sm font-medium">${caseData ? 'AIÁîüÊàê„É°„ÉÉ„Çª„Éº„Ç∏' : '„É°„ÉÉ„Çª„Éº„Ç∏'}:</label>
                            ${caseData ? `
                            <button onclick="regenerateSmsMessage(${caseId})" class="text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                ÂÜçÁîüÊàê
                            </button>
                            ` : ''}
                        </div>
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-3">
                            <div class="text-xs text-yellow-800 mb-1">üí° SMS„ÅØ70ÊñáÂ≠ó‰ª•ÂÜÖ„ÅåÊé®Â•®„Åï„Çå„Åæ„Åô</div>
                            <div class="text-xs text-gray-600">ÁèæÂú®: <span id="charCount">0</span>ÊñáÂ≠ó</div>
                        </div>
                        <textarea id="smsMessage" class="w-full p-3 border rounded-lg" rows="6"
                                  placeholder="${caseData ? 'AI„Åå„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÁîüÊàê‰∏≠...' : '„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ...'}"
                                  onkeyup="updateCharCount()"></textarea>

                        <!-- „ÉÜ„É≥„Éó„É¨„Éº„Éà„Éú„Çø„É≥ -->
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button onclick="loadSmsTemplate('greeting')" class="text-xs px-3 py-1 bg-gray-100 rounded-lg hover:bg-gray-200">
                                üëã Êå®Êã∂
                            </button>
                            <button onclick="loadSmsTemplate('appointment')" class="text-xs px-3 py-1 bg-green-100 rounded-lg hover:bg-green-200">
                                üìÖ „Ç¢„ÉùÁ¢∫Ë™ç
                            </button>
                            <button onclick="loadSmsTemplate('estimate')" class="text-xs px-3 py-1 bg-blue-100 rounded-lg hover:bg-blue-200">
                                üìù Ë¶ãÁ©çÊèêÂá∫
                            </button>
                            <button onclick="loadSmsTemplate('followup')" class="text-xs px-3 py-1 bg-yellow-100 rounded-lg hover:bg-yellow-200">
                                üîî „Éï„Ç©„É≠„Éº
                            </button>
                        </div>
                    </div>

                    <!-- Áõ¥Êé•ÂÖ•Âäõ„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ -->
                    <div class="flex items-center mb-4">
                        <input type="checkbox" id="manualInput" class="mr-2" onchange="toggleManualInput(${caseId || 'null'})">
                        <label for="manualInput" class="text-sm text-gray-700">„Åæ„Åü„ÅØÁõ¥Êé•ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</label>
                    </div>

                    <div class="flex justify-end gap-2">
                        <button onclick="this.closest('.fixed').remove()" class="px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                        <button onclick="sendSmsMessage('${phone}')" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            OK
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            if (caseData) {
                // „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„ÅüÈÅ∏ÊäûËÇ¢„ÇíË°®Á§∫
                generateNextStepOptions(caseData.status, caseId);
                // ÂàùÂõû„ÅÆAI„É°„ÉÉ„Çª„Éº„Ç∏ÁîüÊàê
                generateAiSmsMessage(caseId, null);
            }
        }

        // ÊñáÂ≠óÊï∞„Ç´„Ç¶„É≥„ÉàÊõ¥Êñ∞
        function updateCharCount() {
            const textarea = document.getElementById('smsMessage');
            const countSpan = document.getElementById('charCount');
            if (textarea && countSpan) {
                const count = textarea.value.length;
                countSpan.textContent = count;
                countSpan.className = count > 70 ? 'text-red-600 font-bold' : '';
            }
        }

        // „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„ÅüÊ¨°„Çπ„ÉÜ„ÉÉ„Éó„ÅÆÈÅ∏ÊäûËÇ¢„ÇíÁîüÊàê
        function generateNextStepOptions(currentStatus, caseId) {
            const optionsContainer = document.getElementById('nextStepOptions');
            if (!optionsContainer) return;

            let options = [];

            // „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„ÅüÈÅ∏ÊäûËÇ¢„ÇíÂÆöÁæ©
            const statusOptions = {
                'Êú™ÂØæÂøú': [
                    { label: 'ÂàùÂõû„Ç¢„Éù„Ç§„É≥„Éà„ÅÆ„ÅäÈ°ò„ÅÑ', value: 'initial_appointment' },
                    { label: '„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Å∏„ÅÆ„ÅäÁ§º', value: 'thank_inquiry' },
                    { label: 'Ë≥áÊñôÈÄÅ‰ªò„ÅÆ„ÅäÁü•„Çâ„Åõ', value: 'send_materials' }
                ],
                'Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù': [
                    { label: 'ÂÜçÂ∫¶„Ç¢„Éù„Ç§„É≥„Éà„ÅÆ„ÅäÈ°ò„ÅÑ', value: 'retry_appointment' },
                    { label: 'Ë≥áÊñôÈÄÅ‰ªò„ÅÆ„ÅîÊ°àÂÜÖ', value: 'material_guide' },
                    { label: '„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó„ÅÆ„ÅîÈÄ£Áµ°', value: 'followup_call' }
                ],
                '„Ç¢„ÉùÊ∏à': [
                    { label: 'ÁèæÂú∞Ë™øÊüªÊó•ÊôÇ„ÅÆÁ¢∫Ë™ç', value: 'confirm_survey' },
                    { label: 'ÁèæË™øÂâçÊó•„ÅÆ„É™„Éû„Ç§„É≥„ÉÄ„Éº', value: 'survey_reminder' },
                    { label: 'ÊåÅ„Å°Áâ©„ÉªÊ∫ñÂÇô‰∫ãÈ†Ö„ÅÆ„ÅîÈÄ£Áµ°', value: 'preparation_info' }
                ],
                'ÁèæË™øÊ∏à': [
                    { label: 'ÁèæË™ø„ÅÆ„ÅäÁ§º', value: 'thank_survey' },
                    { label: 'Ë¶ãÁ©çÊõ∏‰ΩúÊàê‰∏≠„ÅÆ„ÅîÈÄ£Áµ°', value: 'estimate_progress' },
                    { label: 'Ë¶ãÁ©çÊõ∏ÂÆåÊàê„ÅÆ„ÅäÁü•„Çâ„Åõ', value: 'estimate_ready' }
                ],
                'Ë¶ãÁ©çÊèêÂá∫Ê∏à': [
                    { label: 'Ë¶ãÁ©çÊõ∏„ÅÆ„ÅîÁ¢∫Ë™ç„ÅäÈ°ò„ÅÑ', value: 'estimate_check' },
                    { label: '„ÅîË≥™Âïè„Å∏„ÅÆÂõûÁ≠î', value: 'answer_questions' },
                    { label: '„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó', value: 'estimate_followup' },
                    { label: 'ÁâπÂà•„Ç≠„É£„É≥„Éö„Éº„É≥„ÅÆ„ÅîÊ°àÂÜÖ', value: 'special_campaign' }
                ],
                'ÊàêÁ¥Ñ': [
                    { label: '„ÅîÂ•ëÁ¥Ñ„ÅÆ„ÅäÁ§º', value: 'contract_thanks' },
                    { label: 'Â∑•‰∫ãÊó•Á®ã„ÅÆ„ÅîÈÄ£Áµ°', value: 'construction_schedule' },
                    { label: 'ÂøÖË¶ÅÊõ∏È°û„ÅÆ„ÅîÊ°àÂÜÖ', value: 'required_documents' }
                ],
                'ÂÖ•Èáë‰∫àÂÆö': [
                    { label: 'ÂÖ•ÈáëÁ¢∫Ë™ç„ÅÆ„ÅäÈ°ò„ÅÑ', value: 'payment_confirmation' },
                    { label: 'ÊåØËæºÂÖà„ÅÆ„ÅîÊ°àÂÜÖ', value: 'bank_info' },
                    { label: 'Â∑•‰∫ãÈñãÂßã„ÅÆ„ÅîÊ°àÂÜÖ', value: 'construction_start' }
                ],
                'ÂÖ•ÈáëÊ∏à': [
                    { label: 'ÂÖ•ÈáëÁ¢∫Ë™ç„ÅÆ„ÅäÁ§º', value: 'payment_thanks' },
                    { label: 'Â∑•‰∫ãÈñãÂßã„ÅÆ„ÅîÊ°àÂÜÖ', value: 'construction_info' },
                    { label: 'ÂÆåÂ∑•Âæå„ÅÆ„Éï„Ç©„É≠„Éº', value: 'completion_follow' }
                ]
            };

            // „Éá„Éï„Ç©„É´„Éà„ÅÆÈÅ∏ÊäûËÇ¢
            options = statusOptions[currentStatus] || [
                { label: '„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Å∏„ÅÆ„ÅäÁ§º', value: 'general_thanks' },
                { label: '„ÅîÈÄ£Áµ°', value: 'general_contact' },
                { label: '„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó', value: 'general_followup' }
            ];

            // ÈÅ∏ÊäûËÇ¢„ÇíHTML„Å´Â§âÊèõ
            optionsContainer.innerHTML = options.map((opt, index) => `
                <label class="flex items-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                    <input type="radio" name="nextStep" value="${opt.value}"
                           ${index === 0 ? 'checked' : ''}
                           onchange="generateAiSmsMessage(${caseId}, '${opt.value}')"
                           class="mr-3">
                    <span class="text-sm">${opt.label}</span>
                </label>
            `).join('');
        }

        // AI„ÅßSMS„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÁîüÊàêÔºà„É¢„ÉÉ„ÇØÁâà - 65ÊñáÂ≠ó‰ª•ÂÜÖÔºâ
        function generateAiSmsMessage(caseId, messageType) {
            const caseData = casesData.find(c => c.id === caseId);
            if (!caseData) return;

            const messageTextarea = document.getElementById('smsMessage');
            if (!messageTextarea) return;

            // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
            messageTextarea.value = 'AI„Åå„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÁîüÊàê‰∏≠...';
            messageTextarea.disabled = true;

            // „É°„ÉÉ„Çª„Éº„Ç∏„Çø„Ç§„Éó„ÇíÂèñÂæóÔºàÊú™ÈÅ∏Êäû„ÅÆÂ†¥Âêà„ÅØÊúÄÂàù„ÅÆÈÅ∏ÊäûËÇ¢Ôºâ
            if (!messageType) {
                const selectedOption = document.querySelector('input[name="nextStep"]:checked');
                messageType = selectedOption ? selectedOption.value : 'general_contact';
            }

            // Êï∞ÁßíÂæå„Å´AIÁîüÊàê„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫Ôºà„É¢„ÉÉ„ÇØ - 65ÊñáÂ≠ó‰ª•ÂÜÖÔºâ
            setTimeout(() => {
                const customerName = caseData.name ? caseData.name.split(' ')[0] : '„ÅäÂÆ¢'; // ËãóÂ≠ó„ÅÆ„Åø
                const salesName = 'Áî∞‰∏≠'; // ÁèæÂú®„ÅÆ„É≠„Ç∞„Ç§„É≥„É¶„Éº„Ç∂„ÉºÂêç

                // 65ÊñáÂ≠ó‰ª•ÂÜÖ„ÅÆ„ÉÜ„É≥„Éó„É¨„Éº„Éà
                const templates = {
                    'initial_appointment': `${customerName}Êßò\nÂ§ñÂ£ÅÂ°óË£Ö„ÅÆ‰ª∂„Åß„ÅîÈÄ£Áµ°„Åó„Åæ„Åó„Åü„ÄÇÁèæÂú∞Ë™øÊüª„ÅÆ„ÅîÈÉΩÂêà„ÅØ„ÅÑ„Åã„Åå„Åß„Åó„Çá„ÅÜ„ÅãÔºü\n${salesName}`,
                    'thank_inquiry': `${customerName}Êßò\n„ÅäÂïèÂêà„Åõ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇÂ§ñÂ£ÅÂ°óË£Ö„ÅÆË©≥Á¥∞„Çí„ÅîÊ°àÂÜÖ„Åó„Åæ„Åô„ÄÇ\n${salesName}`,
                    'send_materials': `${customerName}Êßò\nË≥áÊñô„Çí„ÅäÈÄÅ„Çä„Åó„Åæ„Åó„Åü„ÄÇ„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ„ÄÇ„ÅîË≥™Âïè„ÅØ„ÅäÊ∞óËªΩ„Å´„ÄÇ\n${salesName}`,
                    'retry_appointment': `${customerName}Êßò\nÂÖàÊó•„ÅØÂ§±Á§º„Åó„Åæ„Åó„Åü„ÄÇÁèæË™øÊó•„ÇíÂÜçË™øÊï¥„Åï„Åõ„Å¶„ÅÑ„Åü„Å†„Åë„Åæ„Åô„ÅãÔºü\n${salesName}`,
                    'material_guide': `${customerName}Êßò\nË©≥„Åó„ÅÑË≥áÊñô„Çí„ÅäÈÄÅ„Çä„Åó„Åæ„Åô„ÄÇ„Åî‰∏çÊòéÁÇπ„Åå„ÅÇ„Çå„Å∞„ÅîÈÄ£Áµ°„Åè„Å†„Åï„ÅÑ„ÄÇ\n${salesName}`,
                    'followup_call': `${customerName}Êßò\nÂÖàÊó•„ÅÆ‰ª∂„ÅÑ„Åã„Åå„Åß„Åó„Åü„ÅãÔºü„ÅîÈÉΩÂêà„Å§„ÅèÊôÇ„Å´„ÅîÈÄ£Áµ°„Åè„Å†„Åï„ÅÑ„ÄÇ\n${salesName}`,
                    'confirm_survey': `${customerName}Êßò\nÊòéÊó•‚óãÊôÇ„ÅÆÁèæË™ø„Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇÂ§âÊõ¥„ÅÇ„Çå„Å∞„ÅîÈÄ£Áµ°„Çí„ÄÇ\n${salesName}`,
                    'survey_reminder': `${customerName}Êßò\nÊòéÊó•„ÅÆÁèæË™ø„Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ„Çπ„Çø„ÉÉ„Éï„Åå‰º∫„ÅÑ„Åæ„Åô„ÄÇ\n${salesName}`,
                    'preparation_info': `${customerName}Êßò\nÁèæË™øÂΩìÊó•„ÅØÁâπ„Å´„ÅîÊ∫ñÂÇô‰∏çË¶Å„Åß„Åô„ÄÇ„ÅäÊ∞ó„Çí„Å§„Åë„Å¶„ÅäÂæÖ„Å°‰∏ã„Åï„ÅÑ„ÄÇ\n${salesName}`,
                    'thank_survey': `${customerName}Êßò\nÊú¨Êó•„ÅØ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åó„Åü„ÄÇË¶ãÁ©çÊõ∏„Çí‰ΩúÊàê„Åó„ÅîÈÄ£Áµ°„Åó„Åæ„Åô„ÄÇ\n${salesName}`,
                    'estimate_progress': `${customerName}Êßò\nË¶ãÁ©çÊõ∏‰ΩúÊàê‰∏≠„Åß„Åô„ÄÇ„ÇÇ„ÅÜÂ∞ë„Åó„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ„ÄÇ\n${salesName}`,
                    'estimate_ready': `${customerName}Êßò\nË¶ãÁ©çÊõ∏„ÅåÂÆåÊàê„Åó„Åæ„Åó„Åü„ÄÇ„ÅîÈÉΩÂêà„Çà„ÅÑÊôÇ„Å´„ÅîË™¨Êòé„Åó„Åæ„Åô„ÄÇ\n${salesName}`,
                    'estimate_check': `${customerName}Êßò\nË¶ãÁ©çÊõ∏„ÅØ„ÅîÁ¢∫Ë™ç„ÅÑ„Åü„Å†„Åë„Åæ„Åó„Åü„ÅãÔºü„Åî‰∏çÊòéÁÇπ„ÅäÊ∞óËªΩ„Å´„ÄÇ\n${salesName}`,
                    'answer_questions': `${customerName}Êßò\n„ÅîË≥™Âïè„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇË©≥Á¥∞ÂõûÁ≠î„Çí„ÅäÈÄÅ„Çä„Åó„Åæ„Åô„ÄÇ\n${salesName}`,
                    'estimate_followup': `${customerName}Êßò\nË¶ãÁ©çÊõ∏„ÅÆ‰ª∂„ÅÑ„Åã„Åå„Åß„Åó„Çá„ÅÜ„ÅãÔºü„Åî‰∏çÊòéÁÇπ„ÅÇ„Çå„Å∞„ÅîÈÄ£Áµ°„Çí„ÄÇ\n${salesName}`,
                    'special_campaign': `${customerName}Êßò\n‰ªäÊúàÈôêÂÆöÁâπÂà•‰æ°Ê†º„ÅîÁî®ÊÑè„Åó„Åæ„Åó„Åü„ÄÇ„Åì„ÅÆÊ©ü‰ºö„Å´„ÅÑ„Åã„Åå„Åß„Åô„ÅãÔºü\n${salesName}`,
                    'contract_thanks': `${customerName}Êßò\n„ÅîÂ•ëÁ¥Ñ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ‰∏ÅÂØß„Å™Â∑•‰∫ã„ÇíÂøÉ„Åå„Åë„Åæ„Åô„ÄÇ\n${salesName}`,
                    'construction_schedule': `${customerName}Êßò\nÂ∑•‰∫ãÊó•Á®ã„Åå‚óãÊúà‚óãÊó•„Å´Ê±∫„Åæ„Çä„Åæ„Åó„Åü„ÄÇ„Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ\n${salesName}`,
                    'required_documents': `${customerName}Êßò\nÂøÖË¶ÅÊõ∏È°û„Çí„ÅäÈÄÅ„Çä„Åó„Åæ„Åó„Åü„ÄÇ„ÅîÁ¢∫Ë™ç„Éª„ÅîË®òÂÖ•„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ\n${salesName}`,
                    'payment_confirmation': `${customerName}Êßò\nÂÖ•ÈáëÁ¢∫Ë™ç„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇÊåØËæº‰∫àÂÆöÊó•„Çí„ÅäÊïô„Åà„Åè„Å†„Åï„ÅÑ„ÄÇ\n${salesName}`,
                    'bank_info': `${customerName}Êßò\nÊåØËæºÂÖà„Çí„ÅäÈÄÅ„Çä„Åó„Åæ„Åô„ÄÇ„ÅîÁ¢∫Ë™ç„ÅÆ‰∏ä„ÅäÊâãÁ∂ö„Åç„Åè„Å†„Åï„ÅÑ„ÄÇ\n${salesName}`,
                    'construction_start': `${customerName}Êßò\nÊù•ÈÄ±„Åã„ÇâÂ∑•‰∫ãÈñãÂßã„Åß„Åô„ÄÇ„Åî‰∏ç‰æø„Åä„Åã„Åë„Åó„Åæ„Åô„Åå„Çà„Çç„Åó„Åè„ÄÇ\n${salesName}`,
                    'payment_thanks': `${customerName}Êßò\nÂÖ•ÈáëÁ¢∫Ë™ç„Åó„Åæ„Åó„Åü„ÄÇ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇÂ∑•‰∫ãÈÄ≤„ÇÅ„Åæ„Åô„ÄÇ\n${salesName}`,
                    'construction_info': `${customerName}Êßò\nÂ∑•‰∫ã„Çπ„Ç±„Ç∏„É•„Éº„É´„ÅäÈÄÅ„Çä„Åó„Åæ„Åô„ÄÇ„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ„ÄÇ\n${salesName}`,
                    'completion_follow': `${customerName}Êßò\nÂ∑•‰∫ãÂÆå‰∫ÜÂæå„ÇÇ„Çµ„Éù„Éº„Éà„Åó„Åæ„Åô„ÄÇ‰Ωï„Åã„ÅÇ„Çå„Å∞„ÅîÈÄ£Áµ°„Çí„ÄÇ\n${salesName}`,
                    'general_contact': `${customerName}Êßò\nÂ§ñÂ£ÅÂ°óË£Ö„ÅÆ‰ª∂„Åß„ÅîÈÄ£Áµ°„Åó„Åæ„Åó„Åü„ÄÇ„ÅîÈÉΩÂêà„Çà„ÅÑÊôÇ„Å´„ÅäË©±„Åó„Åæ„Åõ„Çì„ÅãÔºü\n${salesName}`,
                    'general_thanks': `${customerName}Êßò\n„ÅäÂïèÂêà„Åõ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇË©≥Á¥∞„ÅîÊ°àÂÜÖ„Åó„Åæ„Åô„ÄÇ\n${salesName}`,
                    'general_followup': `${customerName}Êßò\nÂÖàÊó•„ÅÆ‰ª∂„Å©„ÅÜ„Åß„Åó„Åü„ÅãÔºü„ÅäÊ∞óËªΩ„Å´„ÅîÈÄ£Áµ°„Åè„Å†„Åï„ÅÑ„ÄÇ\n${salesName}`
                };

                const message = templates[messageType] || templates['general_contact'];
                messageTextarea.value = message;
                messageTextarea.disabled = false;
                updateCharCount();
            }, 1000); // 1ÁßíÂæå„Å´ÁîüÊàê
        }

        // SMS„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÂÜçÁîüÊàê
        function regenerateSmsMessage(caseId) {
            const selectedOption = document.querySelector('input[name="nextStep"]:checked');
            const messageType = selectedOption ? selectedOption.value : null;
            generateAiSmsMessage(caseId, messageType);
        }

        // „ÉÜ„É≥„Éó„É¨„Éº„Éà„Çí„É≠„Éº„Éâ
        function loadSmsTemplate(templateType) {
            const messageTextarea = document.getElementById('smsMessage');
            if (!messageTextarea) return;

            const templates = {
                'greeting': '„Åä‰∏ñË©±„Å´„Å™„Å£„Å¶„Åä„Çä„Åæ„Åô„ÄÇÂ§ñÂ£ÅÂ°óË£Ö„ÅÆ‰ª∂„Åß„ÅîÈÄ£Áµ°„Åó„Åæ„Åó„Åü„ÄÇÁî∞‰∏≠',
                'appointment': 'ÊòéÊó•„ÅÆÁèæË™ø„Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇÁî∞‰∏≠',
                'estimate': 'Ë¶ãÁ©çÊõ∏ÂÆåÊàê„Åó„Åæ„Åó„Åü„ÄÇ„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ„ÄÇÁî∞‰∏≠',
                'followup': 'ÂÖàÊó•„ÅÆ‰ª∂„ÅÑ„Åã„Åå„Åß„Åó„Åü„ÅãÔºü„ÅäÊ∞óËªΩ„Å´„ÅîÈÄ£Áµ°„Åè„Å†„Åï„ÅÑ„ÄÇÁî∞‰∏≠'
            };

            messageTextarea.value = templates[templateType] || '';
            updateCharCount();
        }

        // ÊâãÂãïÂÖ•Âäõ„ÅÆÂàá„ÇäÊõø„Åà
        function toggleManualInput(caseId) {
            const checkbox = document.getElementById('manualInput');
            const messageTextarea = document.getElementById('smsMessage');
            if (checkbox.checked) {
                messageTextarea.value = '';
                messageTextarea.placeholder = '„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...';
                messageTextarea.disabled = false;
                updateCharCount();
            } else if (caseId) {
                generateAiSmsMessage(caseId, null);
            }
        }

        // SMS„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈÄÅ‰ø°
        function sendSmsMessage(phone) {
            const message = document.getElementById('smsMessage').value;
            if (message) {
                window.location.href = `sms:${phone}?body=${encodeURIComponent(message)}`;
                showNotification('SMSÈÄÅ‰ø°', `${phone} „Å∏SMS„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü`);
                // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
                document.querySelector('.fixed').remove();
            } else {
                showNotification('„Ç®„É©„Éº', '„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
            }
        }

        // „É°„É¢Ë°®Á§∫„ÉªÁ∑®ÈõÜ
        function showMemo(caseId) {
            // Êó¢Â≠ò„ÅÆ„É°„É¢„ÇíÂèñÂæóÔºàÂÆüÈöõ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅØAPI„Åã„ÇâÂèñÂæóÔºâ
            const existingMemo = getCaseMemo(caseId);

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[80vh] overflow-y-auto">
                    <h3 class="text-lg font-bold mb-4">üìù Ê°à‰ª∂„É°„É¢</h3>

                    <!-- Â±•Ê≠¥Ë°®Á§∫ -->
                    <div class="mb-4 max-h-48 overflow-y-auto bg-gray-50 rounded-lg p-3">
                        <div class="text-sm font-medium text-gray-600 mb-2">Â±•Ê≠¥:</div>
                        <div id="memoHistory" class="space-y-2 text-sm">
                            ${existingMemo.history || '<div class="text-gray-400">Â±•Ê≠¥„Å™„Åó</div>'}
                        </div>
                    </div>

                    <!-- Êñ∞Ë¶è„É°„É¢ÂÖ•Âäõ -->
                    <div class="mb-2">
                        <label class="text-sm font-medium text-gray-700">Êñ∞„Åó„ÅÑ„É°„É¢„ÇíËøΩÂä†:</label>
                    </div>
                    <textarea id="caseMemo" class="w-full p-3 border rounded-lg" rows="4" placeholder="Áî≥„ÅóÈÄÅ„Çä‰∫ãÈ†Ö„ÇÑÊ≥®ÊÑèÁÇπ„ÇíË®òÂÖ•..."></textarea>

                    <div class="flex justify-end gap-2 mt-4">
                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                        <button onclick="saveMemo(${caseId})" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            ‰øùÂ≠ò
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // „É°„É¢ÂèñÂæóÔºàÂÆüÈöõ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅØAPI„Åã„ÇâÂèñÂæóÔºâ
        function getCaseMemo(caseId) {
            // „Çµ„É≥„Éó„É´„Éá„Éº„Çø
            const memoData = {
                1: {
                    history: `
                        <div class="border-l-2 border-blue-400 pl-3 mb-2">
                            <div class="text-xs text-gray-500">2024/03/15 14:30 - Áî∞‰∏≠Â§™ÈÉé</div>
                            <div class="text-gray-700">‰∫àÁÆóÊÑüÔºö200‰∏áÂÜÜÂâçÂæå</div>
                        </div>
                        <div class="border-l-2 border-green-400 pl-3 mb-2">
                            <div class="text-xs text-gray-500">2024/03/15 16:45 - ‰ΩêËó§Ëä±Â≠ê</div>
                            <div class="text-gray-700">Á´∂Âêà‰ªñÁ§æ„ÇÇÊ§úË®é‰∏≠„ÄÅÂ••Êßò„ÅåÊ±∫ÂÆöÊ®©ËÄÖ</div>
                        </div>
                        <div class="border-l-2 border-yellow-400 pl-3 mb-2">
                            <div class="text-xs text-gray-500">2024/03/16 10:00 - „Ç∑„Çπ„ÉÜ„É†</div>
                            <div class="text-gray-700">„ÄêÂºï„ÅçÁ∂ô„Åé„ÄëÁî∞‰∏≠Â§™ÈÉé ‚Üí ‰ΩêËó§Ëä±Â≠ê</div>
                        </div>
                    `
                },
                4: {
                    history: `
                        <div class="border-l-2 border-blue-400 pl-3 mb-2">
                            <div class="text-xs text-gray-500">2024/03/14 09:00 - Â±±Áî∞Ê¨°ÈÉé</div>
                            <div class="text-gray-700">ÂàùÂõûË®™ÂïèÊ∏à„Åø„ÄÅË¶ãÁ©ç„ÇÇ„ÇäÂæÖ„Å°</div>
                        </div>
                    `
                }
            };

            return memoData[caseId] || { history: '' };
        }

        // „É°„É¢‰øùÂ≠ò
        function saveMemo(caseId) {
            const memoText = document.getElementById('caseMemo').value;

            if (!memoText.trim()) {
                showNotification('„Ç®„É©„Éº', '„É°„É¢„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            // ÁèæÂú®„ÅÆ„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±ÔºàÂÆüÈöõ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅØ„Çª„ÉÉ„Ç∑„Éß„É≥„Åã„ÇâÂèñÂæóÔºâ
            const currentUser = getCurrentUser();
            const timestamp = new Date().toLocaleString('ja-JP', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            }).replace(/\//g, '/');

            // „É°„É¢„Çí‰øùÂ≠òÔºàÂÆüÈöõ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅØAPI„Å´ÈÄÅ‰ø°Ôºâ
            const newMemoEntry = {
                timestamp: timestamp,
                user: currentUser.name,
                text: memoText,
                caseId: caseId
            };

            // „Åì„Åì„ÅßAPI„Å´ÈÄÅ‰ø°
            console.log('Saving memo:', newMemoEntry);

            showNotification('„É°„É¢‰øùÂ≠ò', '„É°„É¢„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
            document.querySelector('.fixed').remove();

            // UI„ÇíÊõ¥Êñ∞„Åó„Å¶„É°„É¢„Ç¢„Ç§„Ç≥„É≥„ÇíÈªÑËâ≤„Å´„Åô„Çã
            updateMemoIcon(caseId, true);
        }

        // „É°„É¢„Ç¢„Ç§„Ç≥„É≥„ÅÆÊõ¥Êñ∞
        function updateMemoIcon(caseId, hasMemo) {
            const caseElements = document.querySelectorAll(`[data-case-id="${caseId}"]`);
            caseElements.forEach(element => {
                const memoButton = element.querySelector('button[onclick*="showMemo"]');
                if (memoButton) {
                    const memoIcon = memoButton.querySelector('span');
                    if (memoIcon) {
                        if (hasMemo) {
                            memoIcon.classList.remove('text-gray-400');
                            memoIcon.classList.add('text-yellow-500');
                        } else {
                            memoIcon.classList.remove('text-yellow-500');
                            memoIcon.classList.add('text-gray-400');
                        }
                    }
                }
            });
        }

        // ÊãÖÂΩì„Éë„ÇπÔºàÂºï„ÅçÁ∂ô„ÅéÔºâ
        function passCase(caseId) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
                    <h3 class="text-lg font-bold mb-4">üîÑ ÊãÖÂΩìËÄÖ„ÇíÂ§âÊõ¥</h3>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Âºï„ÅçÁ∂ô„ÅéÂÖà</label>
                        <select id="passToSelect" class="w-full p-2 border rounded-lg">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <option value="Áî∞‰∏≠Â§™ÈÉé">Áî∞‰∏≠Â§™ÈÉé</option>
                            <option value="‰ΩêËó§Ëä±Â≠ê">‰ΩêËó§Ëä±Â≠ê</option>
                            <option value="Â±±Áî∞Ê¨°ÈÉé">Â±±Áî∞Ê¨°ÈÉé</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Âºï„ÅçÁ∂ô„Åé„É°„É¢Ôºà‰ªªÊÑèÔºâ</label>
                        <textarea id="passMemo" class="w-full p-2 border rounded-lg" rows="3" placeholder="Áî≥„ÅóÈÄÅ„Çä‰∫ãÈ†Ö„Åå„ÅÇ„Çå„Å∞Ë®òÂÖ•..."></textarea>
                    </div>
                    <div class="flex justify-end gap-2">
                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                        <button onclick="confirmPass(${caseId})" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            Âºï„ÅçÁ∂ô„Åé„É™„ÇØ„Ç®„Çπ„Éà
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Âºï„ÅçÁ∂ô„ÅéÁ¢∫ÂÆö
        function confirmPass(caseId) {
            const passTo = document.getElementById('passToSelect').value;
            const passMemo = document.getElementById('passMemo').value;

            if (!passTo) {
                alert('Âºï„ÅçÁ∂ô„ÅéÂÖà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            // Âºï„ÅçÁ∂ô„Åé„É™„ÇØ„Ç®„Çπ„Éà„ÇíÈÄÅ‰ø°
            showNotification('Âºï„ÅçÁ∂ô„Åé„É™„ÇØ„Ç®„Çπ„ÉàÈÄÅ‰ø°', `${passTo}„Å∏ÊâøË™ç‰æùÈ†º„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü`);

            // „Ç´„Éº„Éâ„Å´ÊâøË™çÂæÖ„Å°„Éê„ÉÉ„Ç∏„ÇíËøΩÂä†
            const card = document.querySelector(`[onclick="showCaseDetail(${caseId})"]`);
            if (card) {
                const titleElement = card.querySelector('h3');
                if (titleElement && !titleElement.querySelector('.pending-badge')) {
                    const badge = document.createElement('span');
                    badge.className = 'pending-badge text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded ml-2';
                    badge.textContent = '‚è≥ ÊâøË™çÂæÖ„Å°';
                    titleElement.appendChild(badge);
                }
            }

            document.querySelector('.fixed').remove();

            // ÈÄöÁü•„ÇíË°®Á§∫ÔºàÂÆüÈöõ„ÅÆÂÆüË£Ö„Åß„ÅØÁõ∏Êâã„ÅÆÁîªÈù¢„Å´ÈÄöÁü•Ôºâ
            setTimeout(() => {
                showPassNotification(passTo, caseId, passMemo);
            }, 1000);
        }

        // Âºï„ÅçÁ∂ô„ÅéÈÄöÁü•„ÇíË°®Á§∫
        function showPassNotification(assignee, caseId, memo) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-white rounded-lg shadow-lg p-4 max-w-sm z-50 border-l-4 border-blue-500';

            const memoHtml = memo ? `
                <div class="mt-2 p-2 bg-gray-50 rounded text-xs text-gray-600">
                    <p class="font-medium">Âºï„ÅçÁ∂ô„Åé„É°„É¢:</p>
                    <p>${memo}</p>
                </div>
            ` : '';

            notification.innerHTML = `
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <span class="text-2xl">üîî</span>
                    </div>
                    <div class="ml-3 flex-1">
                        <p class="text-sm font-medium text-gray-900">
                            Ê°à‰ª∂Âºï„ÅçÁ∂ô„Åé„É™„ÇØ„Ç®„Çπ„Éà
                        </p>
                        <p class="mt-1 text-sm text-gray-500">
                            Áî∞‰∏≠Â§™ÈÉé„Åã„ÇâÊ°à‰ª∂„ÅåÂºï„ÅçÁ∂ô„Åå„Çå„Åæ„Åó„Åü
                        </p>
                        ${memoHtml}
                        <div class="mt-3 flex gap-2">
                            <button onclick="acceptPass(${caseId}, this)" class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700">
                                ÊâøË™ç
                            </button>
                            <button onclick="rejectPass(${caseId}, this)" class="px-3 py-1 bg-gray-200 text-gray-800 text-sm rounded hover:bg-gray-300">
                                ÊãíÂê¶
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(notification);

            // 5ÁßíÂæå„Å´Ëá™Âãï„ÅßÊ∂à„Åà„Çã
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 10000);
        }

        // Âºï„ÅçÁ∂ô„ÅéÊâøË™ç
        function acceptPass(caseId, button) {
            // „É¢„Éº„ÉÄ„É´„Åã„Çâ„É°„É¢„ÇíÂèñÂæó
            const modal = button.closest('.fixed');
            const passMemo = modal.querySelector('p:last-of-type')?.textContent.replace('„É°„É¢: ', '') || '';

            // ÁèæÂú®„ÅÆ„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±ÔºàÂÆüÈöõ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅØ„Çª„ÉÉ„Ç∑„Éß„É≥„Åã„ÇâÂèñÂæóÔºâ
            const currentUser = getCurrentUser();
            const timestamp = new Date().toLocaleString('ja-JP', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            }).replace(/\//g, '/');

            // Âºï„ÅçÁ∂ô„ÅéÂ±•Ê≠¥„Çí„É°„É¢„Å´Ëá™ÂãïËøΩÂä†ÔºàÂÆüÈöõ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅØAPI„Å´ÈÄÅ‰ø°Ôºâ
            const handoverEntry = {
                timestamp: timestamp,
                type: 'handover',
                from: 'Áî∞‰∏≠Â§™ÈÉé', // ÂÆüÈöõ„ÅØÂâç„ÅÆÊãÖÂΩìËÄÖ„ÇíÂèñÂæó
                to: currentUser.name,
                memo: passMemo,
                caseId: caseId
            };

            // „Åì„Åì„ÅßAPI„Å´ÈÄÅ‰ø°„Åó„Å¶Â±•Ê≠¥„Çí‰øùÂ≠ò
            console.log('Recording handover:', handoverEntry);

            showNotification('ÊâøË™çÂÆå‰∫Ü', 'Ê°à‰ª∂„ÇíÂºï„ÅçÁ∂ô„Åé„Åæ„Åó„Åü');

            // ÊâøË™çÂæÖ„Å°„Éê„ÉÉ„Ç∏„ÇíÂâäÈô§
            const pendingBadge = document.querySelector('.pending-badge');
            if (pendingBadge) {
                pendingBadge.remove();
            }

            // ÊãÖÂΩìËÄÖÂêç„ÇíÊõ¥Êñ∞
            const card = document.querySelector(`[onclick="showCaseDetail(${caseId})"]`);
            if (card) {
                const assigneeSpan = card.querySelector('.text-blue-700');
                if (assigneeSpan) {
                    assigneeSpan.textContent = `üë§ ÊãÖÂΩì: ${currentUser.name}`;
                }
            }

            // „É°„É¢„Ç¢„Ç§„Ç≥„É≥„ÇíÈªÑËâ≤„Å´„Åô„ÇãÔºàÂºï„ÅçÁ∂ô„ÅéÂ±•Ê≠¥„Åå„ÅÇ„Çã„Åü„ÇÅÔºâ
            updateMemoIcon(caseId, true);

            modal.remove();
        }

        // Âºï„ÅçÁ∂ô„ÅéÊãíÂê¶
        function rejectPass(caseId, button) {
            showNotification('Âºï„ÅçÁ∂ô„ÅéÊãíÂê¶', 'Âºï„ÅçÁ∂ô„Åé„ÇíÊãíÂê¶„Åó„Åæ„Åó„Åü');

            // ÊâøË™çÂæÖ„Å°„Éê„ÉÉ„Ç∏„ÇíÂâäÈô§
            const pendingBadge = document.querySelector('.pending-badge');
            if (pendingBadge) {
                pendingBadge.remove();
            }

            button.closest('.fixed').remove();
        }

        // Ê°à‰ª∂Ë©≥Á¥∞Ë°®Á§∫
        function openCaseDetail(caseId) {
            const caseData = casesData.find(c => c.id == caseId);
            if (!caseData) return;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[80vh] overflow-y-auto">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-xl font-bold">Ê°à‰ª∂Ë©≥Á¥∞ #${caseData.id}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <div class="space-y-4">
                        <!-- È°ßÂÆ¢ÊÉÖÂ†± -->
                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold mb-2">È°ßÂÆ¢ÊÉÖÂ†±</h4>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div><span class="text-gray-500">Ê∞èÂêç:</span> ${caseData.name} Êßò</div>
                                <div><span class="text-gray-500">ÈõªË©±:</span> ${caseData.phone}</div>
                                <div><span class="text-gray-500">‰ΩèÊâÄ:</span> ${caseData.area}</div>
                                <div><span class="text-gray-500">Áâ©‰ª∂:</span> ${caseData.propertyType}„ÉªÁØâ${caseData.age}Âπ¥</div>
                            </div>
                        </div>

                        <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÊÉÖÂ†± -->
                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold mb-2">„Çπ„ÉÜ„Éº„Çø„Çπ</h4>
                            <select class="w-full p-2 border rounded">
                                <option ${caseData.status === 'Êú™ÂØæÂøú' ? 'selected' : ''}>Êú™ÂØæÂøú</option>
                                <option ${caseData.status === 'Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù' ? 'selected' : ''}>Êû∂ÈõªÊ∏à/Êú™„Ç¢„Éù</option>
                                <option ${caseData.status === '„Ç¢„ÉùÊ∏à' ? 'selected' : ''}>„Ç¢„ÉùÊ∏à</option>
                                <option ${caseData.status === 'ÁèæË™øÊ∏à' ? 'selected' : ''}>ÁèæË™øÊ∏à</option>
                                <option ${caseData.status === 'Ë¶ãÁ©çÊèêÂá∫Ê∏à' ? 'selected' : ''}>Ë¶ãÁ©çÊèêÂá∫Ê∏à</option>
                                <option ${caseData.status === 'ÊàêÁ¥Ñ' ? 'selected' : ''}>ÊàêÁ¥Ñ</option>
                                <option ${caseData.status === '‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à' ? 'selected' : ''}>‰ªñÁ§æÂ•ëÁ¥ÑÊ∏à</option>
                                <option ${caseData.status === 'Â§±Ê≥®' ? 'selected' : ''}>Â§±Ê≥®</option>
                            </select>
                        </div>

                        <!-- Ê¥ªÂãïÂ±•Ê≠¥ -->
                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold mb-2">Ê¥ªÂãïÂ±•Ê≠¥</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center text-gray-600">
                                    <span class="text-xs text-gray-400 w-20">2024/01/15</span>
                                    <span>ÂàùÂõûÊû∂Èõª - ‰∏çÂú®</span>
                                </div>
                                <div class="flex items-center text-gray-600">
                                    <span class="text-xs text-gray-400 w-20">2024/01/16</span>
                                    <span>2ÂõûÁõÆÊû∂Èõª - „Ç¢„ÉùÂèñÂæóÊàêÂäü</span>
                                </div>
                                <div class="flex items-center text-gray-600">
                                    <span class="text-xs text-gray-400 w-20">2024/01/18</span>
                                    <span>ÁèæÂú∞Ë™øÊüªÂÆüÊñΩ</span>
                                </div>
                            </div>
                        </div>

                        <!-- „É°„É¢ -->
                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold mb-2">„É°„É¢</h4>
                            <textarea class="w-full p-2 border rounded h-24" placeholder="„É°„É¢„ÇíÂÖ•Âäõ..."></textarea>
                        </div>
                    </div>

                    <div class="flex justify-end gap-2 mt-6">
                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300">
                            Èñâ„Åò„Çã
                        </button>
                        <button onclick="saveCaseDetail(${caseData.id})" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                            ‰øùÂ≠ò
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Êñ∞Ë¶èÊ°à‰ª∂„É¢„Éº„ÉÄ„É´
        function openNewCaseModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-lg mx-4">
                    <h3 class="text-xl font-bold mb-4">Êñ∞Ë¶èÊ°à‰ª∂ÁôªÈå≤</h3>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">È°ßÂÆ¢Âêç</label>
                            <input type="text" class="w-full p-2 border rounded" placeholder="‰æã: Â±±Áî∞Â§™ÈÉé">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ÈõªË©±Áï™Âè∑</label>
                            <input type="tel" class="w-full p-2 border rounded" placeholder="‰æã: 03-1234-5678">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‰ΩèÊâÄ</label>
                            <input type="text" class="w-full p-2 border rounded" placeholder="‰æã: Êù±‰∫¨ÈÉΩ‰∏ñÁî∞Ë∞∑Âå∫">
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Áâ©‰ª∂Á®ÆÂà•</label>
                                <select class="w-full p-2 border rounded">
                                    <option>Êà∏Âª∫„Å¶</option>
                                    <option>„Ç¢„Éë„Éº„Éà</option>
                                    <option>„Éû„É≥„Ç∑„Éß„É≥</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ÁØâÂπ¥Êï∞</label>
                                <input type="number" class="w-full p-2 border rounded" placeholder="‰æã: 15">
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-end gap-2 mt-6">
                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                        <button onclick="saveNewCase()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                            ÁôªÈå≤
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // ‰øùÂ≠òÂá¶ÁêÜ
        function saveCaseDetail(caseId) {
            showNotification('‰øùÂ≠ò', `Ê°à‰ª∂ #${caseId} „Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü`);
            document.querySelector('.fixed').remove();
        }

        function saveNewCase() {
            showNotification('ÁôªÈå≤', 'Êñ∞Ë¶èÊ°à‰ª∂„ÇíÁôªÈå≤„Åó„Åæ„Åó„Åü');
            document.querySelector('.fixed').remove();
        }

        // Êú™ÊåØ„ÇäÂàÜ„ÅëÊ°à‰ª∂„ÅÆ„ÉÄ„Éü„Éº„Éá„Éº„Çø
        const unassignedCases = [
            {
                id: 101,
                name: 'Êñ∞Ë¶èÈ°ßÂÆ¢A',
                address: 'Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫',
                type: 'Êà∏Âª∫„Å¶„ÉªÁØâ12Âπ¥',
                temperature: 4,
                source: '„Åè„Çâ„Åπ„Çã',
                registeredDate: '2025-01-15 10:30'
            },
            {
                id: 102,
                name: 'Êñ∞Ë¶èÈ°ßÂÆ¢B',
                address: 'Á•ûÂ•àÂ∑ùÁúåÂ∑ùÂ¥éÂ∏Ç',
                type: '„Éû„É≥„Ç∑„Éß„É≥„ÉªÁØâ5Âπ¥',
                temperature: 3,
                source: '„Åè„Çâ„Åπ„Çã',
                registeredDate: '2025-01-15 11:45'
            },
            {
                id: 103,
                name: 'Êñ∞Ë¶èÈ°ßÂÆ¢C',
                address: 'ÂüºÁéâÁúåË∂äË∞∑Â∏Ç',
                type: 'Êà∏Âª∫„Å¶„ÉªÁØâ20Âπ¥',
                temperature: 5,
                source: '„Åè„Çâ„Åπ„Çã',
                registeredDate: '2025-01-15 14:00'
            }
        ];

        // Êú™ÊåØ„ÇäÂàÜ„ÅëÊ°à‰ª∂„ÇíË°®Á§∫
        function displayUnassignedCases() {
            const unassignedSection = document.getElementById('unassignedCasesSection');
            const unassignedList = document.getElementById('unassignedCasesList');
            const badge = document.getElementById('unassignedBadge');

            if (unassignedCases.length > 0) {
                // „Éê„ÉÉ„Ç∏„ÇíË°®Á§∫
                badge.textContent = unassignedCases.length;
                badge.classList.remove('hidden');

                // „Éà„Éº„Çø„É´„Éê„ÉÉ„Ç∏„Ç´„Ç¶„É≥„Éà„ÇíÊõ¥Êñ∞
                updateTotalBadgeCount();

                // Êú™ÊåØ„ÇäÂàÜ„Åë„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
                unassignedSection.classList.remove('hidden');

                // Ê°à‰ª∂„Ç´„Éº„Éâ„ÇíÁîüÊàê
                unassignedList.innerHTML = unassignedCases.map(caseItem => {
                    return `
                        <div class="bg-white rounded-lg border border-yellow-300 p-3 hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-start mb-2">
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">Êú™ÂØæÂøú</span>
                            </div>
                            <h4 class="font-bold text-sm mb-1">${caseItem.name}</h4>
                            <p class="text-xs text-gray-600">${caseItem.address}</p>
                            <p class="text-xs text-gray-600 mb-2">${caseItem.type}</p>
                            <div class="flex justify-between items-center text-xs text-gray-500">
                                <span>ÁôªÈå≤: ${caseItem.registeredDate}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                // „Éê„ÉÉ„Ç∏„ÇíÈùûË°®Á§∫
                badge.classList.add('hidden');

                // Êú™ÊåØ„ÇäÂàÜ„Åë„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈùûË°®Á§∫
                unassignedSection.classList.add('hidden');
            }
        }


        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´Êú™ÊåØ„ÇäÂàÜ„ÅëÊ°à‰ª∂„ÇíË°®Á§∫
        document.addEventListener('DOMContentLoaded', function() {
            displayUnassignedCases();

            // ÂàùÊúü„Éê„ÉÉ„Ç∏„Ç´„Ç¶„É≥„Éà„ÇíÊõ¥Êñ∞
            setTimeout(updateTotalBadgeCount, 500);

            // „Ç´„É¨„É≥„ÉÄ„Éº„ÅÆËá™ÂãïÂêåÊúü„ÇíÂÆüË°å
            setTimeout(autoSyncToCalendar, 1000);

            // showSectionÈñ¢Êï∞„Çí„Ç™„Éº„Éê„Éº„É©„Ç§„ÉâÔºàÊó¢Â≠ò„ÅÆoriginalShowSection„Çí‰ΩøÁî®Ôºâ
            const prevShowSection = window.showSection;
            window.showSection = function(sectionName) {
                prevShowSection(sectionName);

                // Ê°à‰ª∂ÁÆ°ÁêÜ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫„Åó„ÅüÂ†¥Âêà„ÄÅÊú™ÊåØ„ÇäÂàÜ„ÅëÊ°à‰ª∂„ÇíÊõ¥Êñ∞
                if (sectionName === 'cases') {
                    displayUnassignedCases();
                    renderCaseCards(); // ÂãïÁöÑ„Å´Ê°à‰ª∂„Ç´„Éº„Éâ„ÇíÁîüÊàê
                    updateCaseCounts(); // ‰ª∂Êï∞„ÇíÊõ¥Êñ∞
                }
            };
        });
    </script>
    <!-- ÁîªÂÉèÊã°Â§ßË°®Á§∫„É¢„Éº„ÉÄ„É´ -->
    <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-90 z-[200] hidden flex items-center justify-center" onclick="closeImageModal()">
        <div class="relative max-w-7xl max-h-full p-4">
            <button onclick="closeImageModal()" class="absolute top-4 right-4 text-white hover:text-gray-300 z-10">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            <img id="modalImage" src="" alt="" class="max-w-full max-h-[90vh] object-contain">
            <p id="modalImageTitle" class="text-white text-center mt-4"></p>
        </div>
    </div>

    <script>
        // ÁîªÂÉè„É¢„Éº„ÉÄ„É´Ê©üËÉΩ
        function openImageModal(src, title) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalTitle = document.getElementById('modalImageTitle');

            modalImage.src = src;
            modalTitle.textContent = title || '';
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // ESC„Ç≠„Éº„Åß„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeImageModal();
            }
        });

        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ãÊ©üËÉΩ
        let selectedCancelCase = null;
        let cancelQuestions = [
            {
                question: '„Ç≠„É£„É≥„Çª„É´„ÅÆ‰∏ª„Å™ÁêÜÁî±„Çí„ÅäÈÅ∏„Å≥„Åè„Å†„Åï„ÅÑ',
                options: ['‰æ°Ê†º„ÅåÂêà„Çè„Å™„ÅÑ', '‰ªñÁ§æ„ÅßÂ•ëÁ¥Ñ„Åó„Åü', '„Åô„Åß„Å´‰ªñÁ§æ„ÅßÊ§úË®é‰∏≠', 'Â∑•‰∫ã„ÅÆÂøÖË¶Å„Åå„Å™„Åè„Å™„Å£„Åü', 'ÈÄ£Áµ°„ÅåÁπã„Åå„Çâ„Å™„ÅÑ', '„Åù„ÅÆ‰ªñ']
            }
        ];
        let cancelAnswers = [];

        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ãÁîªÈù¢„ÇíÈñã„Åè
        function openCancelRequest(caseId) {
            selectedCancelCase = casesData.find(c => c.id === caseId);
            if (selectedCancelCase) {
                showSection('cancel');
                setTimeout(() => {
                    displayCancelCases();
                    // ÈÅ∏Êäû„Åï„Çå„ÅüÊ°à‰ª∂„Çí„Éè„Ç§„É©„Ç§„Éà
                    const caseCard = document.querySelector(`[data-cancel-case-id="${caseId}"]`);
                    if (caseCard) {
                        caseCard.classList.add('ring-2', 'ring-blue-500');
                        caseCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 100);
            }
        }

        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ãÁî®„ÅÆÊ°à‰ª∂„Ç´„Éº„Éâ‰ΩúÊàê
        function createCancelCaseCard(caseItem) {
            const statusColor = getStatusColor(caseItem.status);
            return `
                <div class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow cursor-pointer"
                     onclick="selectCancelCase(${caseItem.id})"
                     data-cancel-case-id="${caseItem.id}">
                    <div class="flex justify-between items-start mb-3">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusColor}">${caseItem.status}</span>
                        <button onclick="event.stopPropagation(); selectCancelCase(${caseItem.id})"
                                class="p-1.5 rounded-lg bg-red-100 hover:bg-red-200 transition-colors" title="ÈÅ∏Êäû">
                            <span class="text-lg">‚úÖ</span>
                        </button>
                    </div>
                    <h3 class="font-bold text-lg mb-1">${caseItem.name}</h3>
                    <div class="mb-2">
                        <span class="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded">üë§ ÊãÖÂΩì: ${caseItem.assignee || 'Êú™Ââ≤ÂΩì'}</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">${caseItem.location || caseItem.area || ''}</p>
                    <p class="text-sm text-gray-600 mb-3">${caseItem.propertyType || ''}</p>
                    <p class="text-sm text-gray-600 mb-3">üìû ${caseItem.phone || ''}</p>
                    <div class="flex justify-between items-center text-xs text-gray-500">
                        <span>ÊúÄÁµÇÈÄ£Áµ°: ${caseItem.lastContact || 'Êú™ÈÄ£Áµ°'}</span>
                        <span>Ê¨°Âõû‰∫àÂÆö: ${caseItem.nextAction || 'Êú™ÂÆö'}</span>
                    </div>
                </div>
            `;
        }

        // ÊàêÁ¥ÑÂ†±ÂëäÁî®„ÅÆÊ°à‰ª∂„Ç´„Éº„Éâ‰ΩúÊàê
        function createContractCaseCard(caseItem) {
            const statusColor = getStatusColor(caseItem.status);
            return `
                <div class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow cursor-pointer"
                     onclick="selectContractCase(${caseItem.id})"
                     data-contract-case-id="${caseItem.id}">
                    <div class="flex justify-between items-start mb-3">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusColor}">${caseItem.status}</span>
                        <button onclick="event.stopPropagation(); selectContractCase(${caseItem.id})"
                                class="p-1.5 rounded-lg bg-green-100 hover:bg-green-200 transition-colors" title="ÈÅ∏Êäû">
                            <span class="text-lg">‚úÖ</span>
                        </button>
                    </div>
                    <h3 class="font-bold text-lg mb-1">${caseItem.name}</h3>
                    <div class="mb-2">
                        <span class="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded">üë§ ÊãÖÂΩì: ${caseItem.assignee || 'Êú™Ââ≤ÂΩì'}</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">${caseItem.location || caseItem.area || ''}</p>
                    <p class="text-sm text-gray-600 mb-3">${caseItem.propertyType || ''}</p>
                    <p class="text-sm text-gray-600 mb-3">üìû ${caseItem.phone || ''}</p>
                    <div class="flex justify-between items-center text-xs text-gray-500">
                        <span>ÊúÄÁµÇÈÄ£Áµ°: ${caseItem.lastContact || 'Êú™ÈÄ£Áµ°'}</span>
                        <span>Ê¨°Âõû‰∫àÂÆö: ${caseItem.nextAction || 'Êú™ÂÆö'}</span>
                    </div>
                </div>
            `;
        }

        // Êó•‰ªòÁØÑÂõ≤Ë®≠ÂÆöÔºà„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ãÁî®Ôºâ
        function setCancelDateRange(range) {
            const today = new Date();
            const startInput = document.getElementById('cancelStartDate');
            const endInput = document.getElementById('cancelEndDate');

            switch(range) {
                case 'today':
                    startInput.valueAsDate = today;
                    endInput.valueAsDate = today;
                    break;
                case 'week':
                    const weekStart = new Date(today);
                    weekStart.setDate(today.getDate() - today.getDay());
                    startInput.valueAsDate = weekStart;
                    endInput.valueAsDate = today;
                    break;
                case 'month':
                    const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                    startInput.valueAsDate = monthStart;
                    endInput.valueAsDate = today;
                    break;
            }
            searchCancelCases();
        }

        // Êó•‰ªòÁØÑÂõ≤Ë®≠ÂÆöÔºàÊàêÁ¥ÑÂ†±ÂëäÁî®Ôºâ
        function setContractDateRange(range) {
            const today = new Date();
            const startInput = document.getElementById('contractStartDate');
            const endInput = document.getElementById('contractEndDate');

            switch(range) {
                case 'today':
                    startInput.valueAsDate = today;
                    endInput.valueAsDate = today;
                    break;
                case 'week':
                    const weekStart = new Date(today);
                    weekStart.setDate(today.getDate() - today.getDay());
                    startInput.valueAsDate = weekStart;
                    endInput.valueAsDate = today;
                    break;
                case 'month':
                    const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                    startInput.valueAsDate = monthStart;
                    endInput.valueAsDate = today;
                    break;
            }
            searchContractCases();
        }

        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÅÆÊ°à‰ª∂Ê§úÁ¥¢
        function searchCancelCases() {
            const searchTerm = document.getElementById('cancelSearchInput').value.toLowerCase().trim();
            const assigneeFilter = document.getElementById('cancelAssigneeFilter').value;
            const startDate = document.getElementById('cancelStartDate').value;
            const endDate = document.getElementById('cancelEndDate').value;
            const cancelList = document.getElementById('cancelCasesList');

            let filteredCases = casesData;

            // „ÉÜ„Ç≠„Çπ„ÉàÊ§úÁ¥¢
            if (searchTerm) {
                filteredCases = filteredCases.filter(c => {
                    return (c.name && c.name.toLowerCase().includes(searchTerm)) ||
                           (c.phone && c.phone.toLowerCase().includes(searchTerm)) ||
                           (c.location && c.location.toLowerCase().includes(searchTerm)) ||
                           (c.area && c.area.toLowerCase().includes(searchTerm)) ||
                           (c.address && c.address.toLowerCase().includes(searchTerm));
                });
            }


            // ÊãÖÂΩìËÄÖ„Éï„Ç£„É´„Çø„Éº
            if (assigneeFilter) {
                if (assigneeFilter === 'self') {
                    // Ëá™ÂàÜ„ÅÆÊ°à‰ª∂Ôºà„É≠„Ç∞„Ç§„É≥„É¶„Éº„Ç∂„Éº„ÇíÁî∞‰∏≠Â§™ÈÉé„Å®‰ªÆÂÆöÔºâ
                    filteredCases = filteredCases.filter(c => c.assignee === 'Áî∞‰∏≠Â§™ÈÉé');
                } else if (assigneeFilter === 'Êú™Ââ≤ÂΩì') {
                    filteredCases = filteredCases.filter(c => !c.assignee);
                } else {
                    filteredCases = filteredCases.filter(c => c.assignee === assigneeFilter);
                }
            }

            // ÊúüÈñì„Éï„Ç£„É´„Çø„ÉºÔºà„ÉÄ„Éü„Éº„Éá„Éº„Çø„Å®„Åó„Å¶ID„Çí‰ΩøÁî®Ôºâ
            if (startDate || endDate) {
                const start = startDate ? new Date(startDate) : new Date('2000-01-01');
                const end = endDate ? new Date(endDate + 'T23:59:59') : new Date();

                // „ÉÄ„Éü„ÉºÂÆüË£ÖÔºöID„ÇíÊó•‰ªò„ÅÆ‰ª£„Çè„Çä„Å´‰ΩøÁî®
                filteredCases = filteredCases.filter(c => {
                    // ÂÆüÈöõ„ÅÆÂÆüË£Ö„Åß„ÅØc.registeredDate„ÇíDate„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Å´Â§âÊèõ„Åó„Å¶ÊØîËºÉ
                    return true; // ‰ªä„ÅØÂÖ®„Å¶Ë°®Á§∫
                });
            }

            // Êñ∞„Åó„ÅÑÈ†Ü„Å´„ÇΩ„Éº„ÉàÔºàID„ÅåÂ§ß„Åç„ÅÑÈ†ÜÔºâ
            filteredCases.sort((a, b) => b.id - a.id);

            // „Ç´„Éº„ÉâË°®Á§∫
            if (filteredCases.length > 0) {
                cancelList.innerHTML = filteredCases.map(c => createCancelCaseCard(c)).join('');
            } else {
                cancelList.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">Ë©≤ÂΩì„Åô„ÇãÊ°à‰ª∂„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</div>';
            }
        }

        // ÊàêÁ¥ÑÂ†±Âëä„ÅÆÊ°à‰ª∂Ê§úÁ¥¢
        function searchContractCases() {
            const searchTerm = document.getElementById('contractSearchInput').value.toLowerCase().trim();
            const assigneeFilter = document.getElementById('contractAssigneeFilter').value;
            const startDate = document.getElementById('contractStartDate').value;
            const endDate = document.getElementById('contractEndDate').value;
            const contractList = document.getElementById('contractCasesList');

            let filteredCases = casesData;

            // „ÉÜ„Ç≠„Çπ„ÉàÊ§úÁ¥¢
            if (searchTerm) {
                filteredCases = filteredCases.filter(c => {
                    return (c.name && c.name.toLowerCase().includes(searchTerm)) ||
                           (c.phone && c.phone.toLowerCase().includes(searchTerm)) ||
                           (c.location && c.location.toLowerCase().includes(searchTerm)) ||
                           (c.area && c.area.toLowerCase().includes(searchTerm)) ||
                           (c.address && c.address.toLowerCase().includes(searchTerm));
                });
            }


            // ÊãÖÂΩìËÄÖ„Éï„Ç£„É´„Çø„Éº
            if (assigneeFilter) {
                if (assigneeFilter === 'self') {
                    // Ëá™ÂàÜ„ÅÆÊ°à‰ª∂Ôºà„É≠„Ç∞„Ç§„É≥„É¶„Éº„Ç∂„Éº„ÇíÁî∞‰∏≠Â§™ÈÉé„Å®‰ªÆÂÆöÔºâ
                    filteredCases = filteredCases.filter(c => c.assignee === 'Áî∞‰∏≠Â§™ÈÉé');
                } else if (assigneeFilter === 'Êú™Ââ≤ÂΩì') {
                    filteredCases = filteredCases.filter(c => !c.assignee);
                } else {
                    filteredCases = filteredCases.filter(c => c.assignee === assigneeFilter);
                }
            }

            // ÊúüÈñì„Éï„Ç£„É´„Çø„ÉºÔºà„ÉÄ„Éü„Éº„Éá„Éº„Çø„Å®„Åó„Å¶ID„Çí‰ΩøÁî®Ôºâ
            if (startDate || endDate) {
                const start = startDate ? new Date(startDate) : new Date('2000-01-01');
                const end = endDate ? new Date(endDate + 'T23:59:59') : new Date();

                // „ÉÄ„Éü„ÉºÂÆüË£ÖÔºöID„ÇíÊó•‰ªò„ÅÆ‰ª£„Çè„Çä„Å´‰ΩøÁî®
                filteredCases = filteredCases.filter(c => {
                    // ÂÆüÈöõ„ÅÆÂÆüË£Ö„Åß„ÅØc.registeredDate„ÇíDate„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Å´Â§âÊèõ„Åó„Å¶ÊØîËºÉ
                    return true; // ‰ªä„ÅØÂÖ®„Å¶Ë°®Á§∫
                });
            }

            // Êñ∞„Åó„ÅÑÈ†Ü„Å´„ÇΩ„Éº„ÉàÔºàID„ÅåÂ§ß„Åç„ÅÑÈ†ÜÔºâ
            filteredCases.sort((a, b) => b.id - a.id);

            // „Ç´„Éº„ÉâË°®Á§∫
            if (filteredCases.length > 0) {
                contractList.innerHTML = filteredCases.map(c => createContractCaseCard(c)).join('');
            } else {
                contractList.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">Ë©≤ÂΩì„Åô„ÇãÊ°à‰ª∂„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</div>';
            }
        }

        // ÂàùÊúüË°®Á§∫Áî®
        function displayCancelCases() {
            searchCancelCases();
        }

        function displayContractCases() {
            searchContractCases();
        }

        // „Ç≠„É£„É≥„Çª„É´Ê°à‰ª∂ÈÅ∏Êäû
        function selectCancelCase(caseId) {
            selectedCancelCase = casesData.find(c => c.id === caseId);
            if (selectedCancelCase) {
                cancelAnswers = [];
                showCancelQuestions();
                document.getElementById('cancelModal').classList.remove('hidden');
            }
        }

        // ÊàêÁ¥ÑÂ†±Âëä„ÅÆË≥™ÂïèÂÆöÁæ©
        let contractQuestions = [
            {
                question: 'Â†±ÂëäÁ®ÆÂà•„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
                options: ['ÊàêÁ¥ÑÂ†±Âëä', 'ËøΩÂä†Â∑•‰∫ãÂ†±Âëä']
            },
            {
                question: 'ÁèæÂú®„ÅÆÁä∂Ê≥Å„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
                options: ['Â•ëÁ¥ÑÂâç„ÉªÂè£È†≠Á¢∫Á¥ÑÊ∏à', 'Â•ëÁ¥ÑÂæå„ÉªÂ∑•‰∫ãÂâç', 'Â∑•‰∫ã‰∏≠', 'Â∑•‰∫ãÂÆå‰∫ÜÂæå']
            }
        ];
        let contractAnswers = [];
        let selectedContractCase = null;

        // ÊàêÁ¥ÑÊ°à‰ª∂ÈÅ∏Êäû
        function selectContractCase(caseId) {
            selectedContractCase = casesData.find(c => c.id === caseId);
            if (selectedContractCase) {
                // È°ßÂÆ¢ÊÉÖÂ†±„ÇíË°®Á§∫
                document.getElementById('contractCustomerInfo').classList.remove('hidden');
                document.getElementById('contractCustomerName').textContent = selectedContractCase.name || '';
                document.getElementById('contractCustomerAddress').textContent =
                    selectedContractCase.address || selectedContractCase.location || selectedContractCase.area || '';

                contractAnswers = [];
                showContractQuestions();
                document.getElementById('contractModal').classList.remove('hidden');
            }
        }

        // ÊàêÁ¥ÑÂ†±ÂëäË≥™ÂïèË°®Á§∫
        function showContractQuestions() {
            const container = document.getElementById('contractQuestionContainer');
            const currentQuestion = contractQuestions[contractAnswers.length];

            if (currentQuestion) {
                container.innerHTML = `
                    <div class="mb-4">
                        <h4 class="text-lg font-medium mb-3">${currentQuestion.question}</h4>
                        <div class="grid grid-cols-2 gap-3">
                            ${currentQuestion.options.map(option => `
                                <button onclick="answerContractQuestion('${option}')"
                                        class="p-3 text-left border rounded-lg hover:bg-green-50 hover:border-green-500 transition-colors">
                                    ${option}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
        }

        // ÊàêÁ¥ÑË≥™ÂïèÂõûÁ≠î
        function answerContractQuestion(answer) {
            contractAnswers.push(answer);

            if (contractAnswers.length < contractQuestions.length) {
                showContractQuestions();
            } else {
                // „Éï„Ç©„Éº„É†„Éï„Çß„Éº„Ç∫„Å´ÁßªË°å
                document.getElementById('contractQuestionContainer').classList.add('hidden');
                document.getElementById('contractFormPhase').classList.remove('hidden');

                // Â•ëÁ¥ÑÁä∂Ê≥Å„Å´Âøú„Åò„Å¶Êó•‰ªò„É©„Éô„É´„ÇíÂ§âÊõ¥
                updateDateLabels(contractAnswers[1]);
            }
        }

        // Â•ëÁ¥ÑÁä∂Ê≥Å„Å´Âøú„Åò„Å¶Êó•‰ªò„É©„Éô„É´„ÇíÊõ¥Êñ∞
        function updateDateLabels(status) {
            const completionLabel = document.getElementById('completionDateLabel');
            const paymentLabel = document.getElementById('paymentDateLabel');

            switch(status) {
                case 'Â•ëÁ¥ÑÂâç„ÉªÂè£È†≠Á¢∫Á¥ÑÊ∏à':
                case 'Â•ëÁ¥ÑÂæå„ÉªÂ∑•‰∫ãÂâç':
                    completionLabel.textContent = 'ÂÆåÂ∑•‰∫àÂÆöÊó•';
                    paymentLabel.textContent = 'ÁùÄÈáë‰∫àÂÆöÊó•';
                    break;
                case 'Â∑•‰∫ã‰∏≠':
                    completionLabel.textContent = 'ÂÆåÂ∑•‰∫àÂÆöÊó•';
                    paymentLabel.textContent = 'ÁùÄÈáëÊó•';
                    break;
                case 'Â∑•‰∫ãÂÆå‰∫ÜÂæå':
                    completionLabel.textContent = 'ÂÆåÂ∑•Êó•';
                    paymentLabel.textContent = 'ÁùÄÈáëÊó•';
                    break;
                default:
                    completionLabel.textContent = 'ÂÆåÂ∑•‰∫àÂÆöÊó•';
                    paymentLabel.textContent = 'ÁùÄÈáë‰∫àÂÆöÊó•';
            }
        }

        // „Åù„ÅÆ‰ªñ„ÉÅ„Çß„ÉÉ„ÇØÊôÇ„ÅÆË©≥Á¥∞ÂÖ•ÂäõÊ¨ÑË°®Á§∫
        function toggleOtherWorkDetails() {
            const otherCheckbox = document.querySelector('input[name="workType"][value="„Åù„ÅÆ‰ªñ"]');
            const detailsTextarea = document.getElementById('workDetails');

            if (otherCheckbox && otherCheckbox.checked) {
                detailsTextarea.classList.remove('hidden');
            } else {
                detailsTextarea.classList.add('hidden');
                detailsTextarea.value = '';
            }
        }

        // „Åù„ÅÆ‰ªñÁâ©‰ª∂„Çø„Ç§„Éó„ÅÆË©≥Á¥∞ÂÖ•ÂäõÊ¨ÑË°®Á§∫
        function toggleOtherPropertyDetails() {
            const otherCheckbox = document.querySelector('input[name="propertyType"][value="„Åù„ÅÆ‰ªñ"]');
            const detailsInput = document.getElementById('otherPropertyDetails');

            if (otherCheckbox && otherCheckbox.checked) {
                detailsInput.classList.remove('hidden');
            } else {
                detailsInput.classList.add('hidden');
                detailsInput.value = '';
            }
        }

        // ÊàêÁ¥Ñ„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeContractModal() {
            document.getElementById('contractModal').classList.add('hidden');
            document.getElementById('contractQuestionContainer').classList.remove('hidden');
            document.getElementById('contractFormPhase').classList.add('hidden');
            document.getElementById('contractCustomerInfo').classList.add('hidden');
            selectedContractCase = null;
            contractAnswers = [];
            resetContractForm();
        }

        // „Ç≠„É£„É≥„Çª„É´Ë≥™ÂïèË°®Á§∫
        function showCancelQuestions() {
            const container = document.getElementById('cancelQuestionContainer');
            const currentQuestion = cancelQuestions[cancelAnswers.length];

            if (currentQuestion) {
                container.innerHTML = `
                    <div class="mb-4">
                        <h4 class="text-lg font-medium mb-3">${currentQuestion.question}</h4>
                        <div class="grid grid-cols-2 gap-3">
                            ${currentQuestion.options.map(option => `
                                <button onclick="answerCancelQuestion('${option}')"
                                        class="p-3 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-500 transition-colors">
                                    ${option}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
        }

        // „Åù„ÅÆ‰ªñ„ÅÆÁêÜÁî±„ÇíÈÄÅ‰ø°
        function submitOtherReason() {
            const reasonInput = document.getElementById('otherReasonInput');
            if (reasonInput && reasonInput.value.trim()) {
                cancelAnswers.otherReason = reasonInput.value.trim();
                showAdditionalInfoInput();
            } else {
                alert('ÁêÜÁî±„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            }
        }

        // ËøΩÂä†ÊÉÖÂ†±ÂÖ•ÂäõÁîªÈù¢„ÇíË°®Á§∫
        function showAdditionalInfoInput() {
            const container = document.getElementById('cancelQuestionContainer');
            container.innerHTML = `
                <div class="mb-4">
                    <h4 class="text-lg font-medium mb-3">ËøΩÂä†ÊÉÖÂ†±„Åå„ÅÇ„Çå„Å∞„ÅîË®òÂÖ•„Åè„Å†„Åï„ÅÑÔºà‰ªªÊÑèÔºâ</h4>
                    <textarea id="additionalInfoInput" class="w-full px-3 py-2 border rounded-lg" rows="4"
                              placeholder="‰æãÔºö„ÅäÂÆ¢Êßò„ÅÆË©≥„Åó„ÅÑÁä∂Ê≥Å„ÄÅ‰ªäÂæå„ÅÆÂØæÂøú‰∫àÂÆö„ÄÅ„Åù„ÅÆ‰ªñË£úË∂≥‰∫ãÈ†Ö„Å™„Å©"></textarea>
                    <div class="flex gap-3 mt-3">
                        <button onclick="skipAdditionalInfo()" class="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                            „Çπ„Ç≠„ÉÉ„Éó
                        </button>
                        <button onclick="submitAdditionalInfo()" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                            ÂÆå‰∫Ü
                        </button>
                    </div>
                </div>
            `;
        }

        // ËøΩÂä†ÊÉÖÂ†±„Çí„Çπ„Ç≠„ÉÉ„Éó
        function skipAdditionalInfo() {
            cancelAnswers.additionalInfo = '';
            generateCancelText();
        }

        // ËøΩÂä†ÊÉÖÂ†±„ÇíÈÄÅ‰ø°
        function submitAdditionalInfo() {
            const infoInput = document.getElementById('additionalInfoInput');
            cancelAnswers.additionalInfo = infoInput ? infoInput.value.trim() : '';
            generateCancelText();
        }

        // „Ç≠„É£„É≥„Çª„É´Ë≥™ÂïèÂõûÁ≠î
        function answerCancelQuestion(answer) {
            const container = document.getElementById('cancelQuestionContainer');

            // ÊúÄÂàù„ÅÆÂõûÁ≠î„Çí‰øùÂ≠ò
            if (cancelAnswers.length === 0) {
                cancelAnswers.push(answer);

                // ÈÅ∏Êäû„Å´Âøú„Åò„ÅüËøΩÂä†Ë≥™Âïè„ÇíË°®Á§∫
                if (answer === 'ÈÄ£Áµ°„ÅåÁπã„Åå„Çâ„Å™„ÅÑ') {
                    container.innerHTML = `
                        <div class="mb-4">
                            <h4 class="text-lg font-medium mb-3">ÈÄ£Áµ°„ÅÆÁä∂Ê≥Å„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h4>
                            <div class="grid grid-cols-1 gap-2">
                                <button onclick="submitContactStatus('‰∏ÄÂ∫¶„ÇÇÁπã„Åå„Çâ„Å™„ÅÑ')" class="p-3 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-500">‰∏ÄÂ∫¶„ÇÇÁπã„Åå„Çâ„Å™„ÅÑ</button>
                                <button onclick="submitContactStatus('Áπã„Åå„Å£„Åü„Åå„Ç¢„Éù„ÅåÂèñ„Çå„Å™„ÅÑ')" class="p-3 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-500">Áπã„Åå„Å£„Åü„Åå„Ç¢„Éù„ÅåÂèñ„Çå„Å™„ÅÑ</button>
                                <button onclick="submitContactStatus('ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´')" class="p-3 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-500">ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´</button>
                                <button onclick="submitContactStatus('ÁèæË™øÂæåË¶ãÁ©ç„ÇÇ„Çä„ÅäÊ∏°„ÅóÂâç„Ç≠„É£„É≥„Çª„É´')" class="p-3 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-500">ÁèæË™øÂæåË¶ãÁ©ç„ÇÇ„Çä„ÅäÊ∏°„ÅóÂâç„Ç≠„É£„É≥„Çª„É´</button>
                                <button onclick="submitContactStatus('Ë¶ãÁ©ç„ÇÇ„Çä„ÅäÊ∏°„ÅóÂæå„Ç≠„É£„É≥„Çª„É´')" class="p-3 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-500">Ë¶ãÁ©ç„ÇÇ„Çä„ÅäÊ∏°„ÅóÂæå„Ç≠„É£„É≥„Çª„É´</button>
                            </div>
                        </div>
                    `;
                } else if (answer === '‰ªñÁ§æ„ÅßÂ•ëÁ¥Ñ„Åó„Åü' || answer === '„Åô„Åß„Å´‰ªñÁ§æ„ÅßÊ§úË®é‰∏≠') {
                    container.innerHTML = `
                        <div class="mb-4">
                            <h4 class="text-lg font-medium mb-3">${answer === '‰ªñÁ§æ„ÅßÂ•ëÁ¥Ñ„Åó„Åü' ? '„Å©„Å°„Çâ„ÅßÂ•ëÁ¥Ñ„Åï„Çå„Åæ„Åó„Åü„ÅãÔºü' : '„Å©„Å°„Çâ„ÅßÊ§úË®é„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÅãÔºü'}</h4>
                            <div class="grid grid-cols-1 gap-2">
                                <button onclick="submitCompetitor('„Åè„Çâ„Åπ„ÇãÂä†ÁõüÂ∫ó')" class="p-3 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-500">„Åè„Çâ„Åπ„ÇãÂä†ÁõüÂ∫ó</button>
                                <button onclick="submitCompetitor('‰∏çÊòé')" class="p-3 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-500">‰∏çÊòé</button>
                                <button onclick="showCompetitorInput()" class="p-3 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-500">„Åù„ÅÆ‰ªñÔºà‰ºöÁ§æÂêç„ÇíÂÖ•ÂäõÔºâ</button>
                            </div>
                        </div>
                    `;
                } else if (answer === '„Åù„ÅÆ‰ªñ') {
                    container.innerHTML = `
                        <div class="mb-4">
                            <h4 class="text-lg font-medium mb-3">„Åù„ÅÆ‰ªñ„ÅÆÁêÜÁî±„ÇíÂÖ∑‰ΩìÁöÑ„Å´ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h4>
                            <textarea id="otherReasonInput" class="w-full px-3 py-2 border rounded-lg" rows="3" placeholder="„Ç≠„É£„É≥„Çª„É´ÁêÜÁî±„ÇíÂÖ•Âäõ"></textarea>
                            <button onclick="submitOtherReason()" class="mt-3 px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                Ê¨°„Å∏
                            </button>
                        </div>
                    `;
                } else {
                    // „Åù„ÅÆ‰ªñ„ÅÆÁêÜÁî±„ÅÆÂ†¥Âêà„ÅØËøΩÂä†ÊÉÖÂ†±ÂÖ•ÂäõÁîªÈù¢„Å∏
                    showAdditionalInfoInput();
                }
            }
        }

        // ÈÄ£Áµ°Áä∂Ê≥Å„ÇíÈÄÅ‰ø°
        function submitContactStatus(status) {
            cancelAnswers.contactStatus = status;
            showAdditionalInfoInput();
        }

        // Á´∂Âêà‰ªñÁ§æ„ÇíÈÄÅ‰ø°
        function submitCompetitor(competitor) {
            cancelAnswers.competitor = competitor;
            showAdditionalInfoInput();
        }

        // Á´∂Âêà‰ªñÁ§æÂêçÂÖ•ÂäõÊ¨Ñ„ÇíË°®Á§∫
        function showCompetitorInput() {
            const container = document.getElementById('cancelQuestionContainer');
            container.innerHTML = `
                <div class="mb-4">
                    <h4 class="text-lg font-medium mb-3">Â•ëÁ¥ÑÂÖà„ÅÆ‰ºöÁ§æÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h4>
                    <input type="text" id="competitorNameInput" class="w-full px-3 py-2 border rounded-lg" placeholder="‰ºöÁ§æÂêç„ÇíÂÖ•Âäõ">
                    <button onclick="submitCompetitorName()" class="mt-3 px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                        Ê¨°„Å∏
                    </button>
                </div>
            `;
        }

        // Á´∂Âêà‰ªñÁ§æÂêç„ÇíÈÄÅ‰ø°
        function submitCompetitorName() {
            const nameInput = document.getElementById('competitorNameInput');
            if (nameInput && nameInput.value.trim()) {
                cancelAnswers.competitor = nameInput.value.trim();
                showAdditionalInfoInput();
            } else {
                alert('‰ºöÁ§æÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            }
        }

        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ãÊñáÁîüÊàê
        function generateCancelText() {
            const aiResponse = document.getElementById('cancelAIResponse');
            const aiText = document.getElementById('cancelAIText');

            // „É°„Ç§„É≥ÁêÜÁî±„ÅÆÂèñÂæó
            let mainReason = cancelAnswers[0];
            let detailText = '';

            if (cancelAnswers[0] === '„Åù„ÅÆ‰ªñ' && cancelAnswers.otherReason) {
                mainReason = cancelAnswers.otherReason;
            } else if (cancelAnswers[0] === 'ÈÄ£Áµ°„ÅåÁπã„Åå„Çâ„Å™„ÅÑ' && cancelAnswers.contactStatus) {
                detailText = `\nÈÄ£Áµ°Áä∂Ê≥Å: ${cancelAnswers.contactStatus}`;
            } else if ((cancelAnswers[0] === '‰ªñÁ§æ„ÅßÂ•ëÁ¥Ñ„Åó„Åü' || cancelAnswers[0] === '„Åô„Åß„Å´‰ªñÁ§æ„ÅßÊ§úË®é‰∏≠') && cancelAnswers.competitor) {
                const label = cancelAnswers[0] === '‰ªñÁ§æ„ÅßÂ•ëÁ¥Ñ„Åó„Åü' ? 'Â•ëÁ¥ÑÂÖà' : 'Ê§úË®éÂÖà';
                detailText = `\n${label}: ${cancelAnswers.competitor}`;
            }

            // ËøΩÂä†ÊÉÖÂ†±„Åå„ÅÇ„Çå„Å∞Âê´„ÇÅ„Çã
            let additionalSection = '';
            if (cancelAnswers.additionalInfo) {
                additionalSection = `\n\n„ÄêËøΩÂä†ÊÉÖÂ†±„Äë\n${cancelAnswers.additionalInfo}`;
            }

            // ÁêÜÁî±„Å´Âøú„Åò„ÅüË©≥Á¥∞Êñá„ÇíÁîüÊàê
            let detailDescription = '';

            if (cancelAnswers[0] === 'ÈÄ£Áµ°„ÅåÁπã„Åå„Çâ„Å™„ÅÑ') {
                if (cancelAnswers.contactStatus === '‰∏ÄÂ∫¶„ÇÇÁπã„Åå„Çâ„Å™„ÅÑ') {
                    detailDescription = `„ÅäÂÆ¢Êßò„Å´„ÅîÈÄ£Áµ°„ÇíË©¶„Åø„Åæ„Åó„Åü„Åå„ÄÅÊÆãÂøµ„Å™„Åå„Çâ‰∏ÄÂ∫¶„ÇÇ„ÅäÈõªË©±„ÅåÁπã„Åå„Çâ„Å™„ÅÑÁä∂Ê≥Å„Åß„Åô„ÄÇ`;
                } else if (cancelAnswers.contactStatus === 'Áπã„Åå„Å£„Åü„Åå„Ç¢„Éù„ÅåÂèñ„Çå„Å™„ÅÑ') {
                    detailDescription = `„ÅäÂÆ¢Êßò„Å®„ÅäÈõªË©±„ÅØÁπã„Åå„Çä„Åæ„Åó„Åü„Åå„ÄÅÁèæÂú∞Ë™øÊüª„ÅÆ„Ç¢„Éù„Ç§„É≥„Éà„É°„É≥„Éà„ÅåÂèñ„Çå„Å™„ÅÑÁä∂Ê≥Å„Åß„Åô„ÄÇ`;
                } else if (cancelAnswers.contactStatus === 'ÁèæË™øÂâç„Ç≠„É£„É≥„Çª„É´') {
                    detailDescription = `ÁèæÂú∞Ë™øÊüªÂâç„ÅÆÊÆµÈöé„Åß„ÄÅ„ÅäÂÆ¢Êßò„Åã„Çâ„Ç≠„É£„É≥„Çª„É´„ÅÆ„ÅäÁî≥„ÅóÂá∫„Åå„ÅÇ„Çä„Åæ„Åó„Åü„ÄÇ`;
                } else if (cancelAnswers.contactStatus === 'ÁèæË™øÂæåË¶ãÁ©ç„ÇÇ„Çä„ÅäÊ∏°„ÅóÂâç„Ç≠„É£„É≥„Çª„É´') {
                    detailDescription = `ÁèæÂú∞Ë™øÊüª„ÅØÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„Åå„ÄÅ„ÅäË¶ãÁ©ç„ÇÇ„Çä„Çí„ÅäÊ∏°„Åó„Åô„ÇãÂâç„Å´„Ç≠„É£„É≥„Çª„É´„Å®„Å™„Çä„Åæ„Åó„Åü„ÄÇ`;
                } else if (cancelAnswers.contactStatus === 'Ë¶ãÁ©ç„ÇÇ„Çä„ÅäÊ∏°„ÅóÂæå„Ç≠„É£„É≥„Çª„É´') {
                    detailDescription = `„ÅäË¶ãÁ©ç„ÇÇ„Çä„Çí„ÅäÊ∏°„Åó„Åó„ÅüÂæå„ÄÅ„ÅäÂÆ¢Êßò„ÅÆ„ÅîÈÉΩÂêà„Å´„Çà„Çä„Ç≠„É£„É≥„Çª„É´„Å®„Å™„Çä„Åæ„Åó„Åü„ÄÇ`;
                }
            } else if (cancelAnswers[0] === '‰æ°Ê†º„ÅåÂêà„Çè„Å™„ÅÑ') {
                detailDescription = `„ÅäË¶ãÁ©ç„ÇÇ„Çä„Çí„ÅîÊ§úË®é„ÅÑ„Åü„Å†„Åç„Åæ„Åó„Åü„Åå„ÄÅ„Åî‰∫àÁÆó„Å®„ÅÆÂÖº„Å≠Âêà„ÅÑ„Åß‰ªäÂõû„ÅØË¶ãÈÄÅ„Çä„Å®„Å™„Çä„Åæ„Åó„Åü„ÄÇ`;
            } else if (cancelAnswers[0] === '‰ªñÁ§æ„ÅßÂ•ëÁ¥Ñ„Åó„Åü') {
                detailDescription = `„ÅäÂÆ¢Êßò„ÅØ‰ªñÁ§æ„Åß„ÅÆÂ•ëÁ¥Ñ„ÇíÈÅ∏Êäû„Åï„Çå„Åæ„Åó„Åü„ÄÇ`;
            } else if (cancelAnswers[0] === '„Åô„Åß„Å´‰ªñÁ§æ„ÅßÊ§úË®é‰∏≠') {
                detailDescription = `„ÅäÂÆ¢Êßò„ÅØÊó¢„Å´‰ªñÁ§æ„ÅßÊ§úË®é„ÇíÈÄ≤„ÇÅ„Å¶„Åä„Çä„ÄÅ„Åù„Å°„Çâ„ÅßÊ±∫ÂÆö„Åï„Çå„Çã‰∫àÂÆö„Åß„Åô„ÄÇ`;
            } else if (cancelAnswers[0] === 'Â∑•‰∫ã„ÅÆÂøÖË¶Å„Åå„Å™„Åè„Å™„Å£„Åü') {
                detailDescription = `„ÅäÂÆ¢Êßò„ÅÆ„Åî‰∫ãÊÉÖ„Å´„Çà„Çä„ÄÅÂ∑•‰∫ãËá™‰Ωì„Åå‰∏çË¶Å„Å®„Å™„Çä„Åæ„Åó„Åü„ÄÇ`;
            } else if (cancelAnswers[0] === '„Åù„ÅÆ‰ªñ' && cancelAnswers.otherReason) {
                detailDescription = `${cancelAnswers.otherReason}`;
            } else {
                detailDescription = `„ÅäÂÆ¢Êßò„ÅÆ„ÅîÈÉΩÂêà„Å´„Çà„Çä„ÄÅÊ°à‰ª∂„Çí„Ç≠„É£„É≥„Çª„É´„Åï„Åõ„Å¶„ÅÑ„Åü„Å†„Åè„Åì„Å®„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇ`;
            }

            // „ÉÜ„Ç≠„Çπ„ÉàÁîüÊàê
            const cancelText = `„Äê„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„Äë\n\n` +
                `Ê°à‰ª∂Âêç: ${selectedCancelCase.name}\n` +
                `Áâ©‰ª∂: ${selectedCancelCase.propertyType || 'Êú™Ë®≠ÂÆö'}\n` +
                `„Ç®„É™„Ç¢: ${selectedCancelCase.location || selectedCancelCase.area || 'Êú™Ë®≠ÂÆö'}\n\n` +
                `„Äê„Ç≠„É£„É≥„Çª„É´ÁêÜÁî±„Äë\n` +
                `${mainReason}${detailText}\n\n` +
                `„ÄêË©≥Á¥∞„Äë\n` +
                `${detailDescription}\n\n` +
                `‰ªäÂæå„ÇÇËâØÂ•Ω„Å™Èñ¢‰øÇ„ÇíÁ∂≠ÊåÅ„Åß„Åç„Çã„Çà„ÅÜ„ÄÅÈÅ©Âàá„Å™„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó„ÇíÂøÉ„Åå„Åë„Åæ„Åô„ÄÇ` +
                additionalSection;

            aiText.textContent = cancelText;
            aiResponse.classList.remove('hidden');
            document.getElementById('cancelQuestionContainer').innerHTML = '';
        }

        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ãÊñáÂÜçÁîüÊàê
        function regenerateCancelText() {
            // ÂÜçÂ∫¶Ë≥™Âïè„Åã„ÇâÈñãÂßã
            cancelAnswers = [];
            document.getElementById('cancelAIResponse').classList.add('hidden');
            showCancelQuestions();
        }

        // „Ç≠„É£„É≥„Çª„É´Áî≥Ë´ãÈÄÅ‰ø°
        function submitCancelRequest() {
            alert('„Ç≠„É£„É≥„Çª„É´Áî≥Ë´ã„ÅåÈÄÅ‰ø°„Åï„Çå„Åæ„Åó„Åü');
            closeCancelModal();
            // ÂÆüÈöõ„ÅÆÂá¶ÁêÜ„Çí„Åì„Åì„Å´ËøΩÂä†
        }

        // „Ç≠„É£„É≥„Çª„É´„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeCancelModal() {
            document.getElementById('cancelModal').classList.add('hidden');
            selectedCancelCase = null;
            cancelAnswers = [];
        }

        // „Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂá¶ÁêÜ
        function handleFileUpload(event, type) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewId = type === 'estimate' ? 'estimatePreview' : 'receiptPreview';
                    const preview = document.getElementById(previewId);

                    if (file.type.includes('image')) {
                        preview.innerHTML = `<img src="${e.target.result}" class="w-full h-32 object-cover rounded">`;
                    } else {
                        preview.innerHTML = `
                            <div class="flex items-center justify-center">
                                <svg class="w-12 h-12 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="ml-2 text-sm">${file.name}</span>
                            </div>
                        `;
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        // ÊàêÁ¥ÑÂ†±Âëä„Éï„Ç©„Éº„É†„É™„Çª„ÉÉ„Éà
        function resetContractForm() {
            const form = document.getElementById('contractReportForm');
            if (form) {
                form.reset();
            }
            document.getElementById('workDetails').classList.add('hidden');
            document.getElementById('otherPropertyDetails').classList.add('hidden');
            document.getElementById('estimatePreview').innerHTML = `
                <svg class="w-12 h-12 text-gray-400 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
            `;
            document.getElementById('receiptPreview').innerHTML = `
                <svg class="w-12 h-12 text-gray-400 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
            `;
        }

        // ÊàêÁ¥ÑÂ†±Âëä„Éï„Ç©„Éº„É†ÈÄÅ‰ø°
        document.addEventListener('DOMContentLoaded', function() {
            const contractForm = document.getElementById('contractReportForm');
            if (contractForm) {
                contractForm.addEventListener('submit', function(e) {
                    e.preventDefault();

                    // ÈÅ∏Êäû„Åï„Çå„ÅüÊñΩÂ∑•ÂÜÖÂÆπ„ÇíÂèñÂæó
                    const selectedWorkTypes = [];
                    document.querySelectorAll('input[name="workType"]:checked').forEach(checkbox => {
                        selectedWorkTypes.push(checkbox.value);
                    });

                    // ÈÅ∏Êäû„Åï„Çå„ÅüÁâ©‰ª∂„Çø„Ç§„Éó„ÇíÂèñÂæó
                    const selectedPropertyTypes = [];
                    document.querySelectorAll('input[name="propertyType"]:checked').forEach(checkbox => {
                        selectedPropertyTypes.push(checkbox.value);
                    });

                    // „Éï„Ç©„Éº„É†„Éá„Éº„Çø„ÇíÂèéÈõÜ
                    const formData = {
                        reportType: contractAnswers[0],
                        status: contractAnswers[1],
                        caseName: selectedContractCase ? selectedContractCase.name : '',
                        caseAddress: selectedContractCase ? (selectedContractCase.address || selectedContractCase.location || selectedContractCase.area) : '',
                        amount: document.getElementById('contractAmount').value,
                        paymentDate: document.getElementById('paymentDate').value,
                        completionDate: document.getElementById('completionDate').value,
                        buildingFloors: document.getElementById('buildingFloors').value,
                        propertyTypes: selectedPropertyTypes,
                        otherPropertyDetails: document.getElementById('otherPropertyDetails').value,
                        workTypes: selectedWorkTypes,
                        workDetails: document.getElementById('workDetails').value,
                        notes: document.getElementById('contractNotes').value
                    };

                    console.log('ÊàêÁ¥ÑÂ†±Âëä„Éá„Éº„Çø:', formData);
                    alert(`${contractAnswers[0]}„ÅåÈÄÅ‰ø°„Åï„Çå„Åæ„Åó„Åü`);
                    closeContractModal();
                });
            }

            // ‰∏ÄÊôÇÂÅúÊ≠¢„ÅÆÊó•‰ªòÂ§âÊõ¥ÊôÇ„Å´Âç≥ÊôÇ‰øùÂ≠ò

            // „Çª„ÇØ„Ç∑„Éß„É≥Ë°®Á§∫ÊôÇ„Å´Ê°à‰ª∂„ÇíË™≠„ÅøËæº„ÇÄ
            const originalShowSection = window.showSection;
            window.showSection = function(sectionName) {
                if (typeof originalShowSection === 'function') {
                    originalShowSection(sectionName);
                }

                if (sectionName === 'cancel') {
                    displayCancelCases();
                } else if (sectionName === 'contract') {
                    displayContractCases();
                }
            };
        });
    </script>
    <style>
        @keyframes slide-in {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slide-out {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        .animate-slide-in { animation: slide-in 0.3s ease-out; }
        .animate-slide-out { animation: slide-out 0.3s ease-out; }
    </style>

    <!-- Â§ßÂûãÁâ©‰ª∂„ÅÆÁ¥π‰ªãÊñô„Å´„Å§„ÅÑ„Å¶„ÅÆ„É¢„Éº„ÉÄ„É´ -->
    <div id="largePropertyModal" class="fixed inset-0 z-50 hidden">
        <!-- „Ç™„Éº„Éê„Éº„É¨„Ç§ -->
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>

        <!-- „É¢„Éº„ÉÄ„É´Êú¨‰Ωì -->
        <div class="flex items-center justify-center h-full p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full relative">
                <!-- Èñâ„Åò„Çã„Éú„Çø„É≥ -->
                <button onclick="closeLargePropertyModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 z-10">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>

                <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                <div class="bg-white border-b px-8 py-6 rounded-t-xl">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        üîä Â§ßÂûãÁâ©‰ª∂„ÅÆÁ¥π‰ªãÊñô„Å´„Å§„ÅÑ„Å¶
                    </h3>
                </div>

                <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
                <div class="px-8 py-6 space-y-4">
                    <!-- 3Èöé‰ª•‰∏ä„ÇíÈÅ∏Êäû„Åó„ÅüÂ†¥Âêà -->
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded">
                        <div class="flex items-start">
                            <span class="text-yellow-500 mr-2">‚ö†Ô∏è</span>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2">3Èöé‰ª•‰∏ä„ÇíÈÅ∏Êäû„Åó„ÅüÂ†¥Âêà</h4>
                                <p class="text-gray-700">
                                    Âü∫Êú¨Á¥π‰ªãÊñô„Åå <span class="line-through text-gray-500">¬•20,000</span> „Åã„Çâ <span class="font-bold text-green-600 text-lg">¬•30,000</span> „Å´„Å™„Çä„Åæ„Åô
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- 3Èöé‰ª•‰∏ä„ÇíÈÅ∏Êäû„Åó„Å¶„ÅÑ„Çã„Å® -->
                    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                        <div class="flex items-start">
                            <span class="text-yellow-500 mr-2">‚ö†Ô∏è</span>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2">3Èöé‰ª•‰∏ä„ÇíÈÅ∏Êäû„Åó„Å¶„ÅÑ„Çã„Å®</h4>
                                <p class="text-gray-700">
                                    2Èöé‰ª•‰∏ã„Åß„ÇÇÂ§ßÂûã„Å®Âà§Êñ≠„Åï„Çå„Çå„Å∞Ëá™Âãï„ÅßÁ¥π‰ªãÊñô„Åå<span class="font-bold text-red-600">¬•30,000</span>„Å´„Å™„Çä„Åæ„Åô
                                </p>
                                <p class="text-sm text-gray-600 mt-2">
                                    Ôºà3Èöé‰ª•‰∏ä„Åß„ÇÇË¶ãÁ©ç„ÇÇ„ÇäÂ∏åÊúõÁÆáÊâÄ„ÅåÂ∞è„Åï„ÅÑÂ†¥Âêà„ÄÅËá™ÂãïÁöÑ„Å´Ê∏õÈ°ç„Åï„Çå„Å¶Ëá™ÂãïÈÖç‰ø°„Åï„Çå„Çã‰∫ã„Åå„ÅÇ„Çä„Åæ„Åô„Åå„ÄÅÊúÄÁµÇÁöÑ„Å™ÈáëÈ°çË®≠ÂÆö„ÅØÊ†™Âºè‰ºöÁ§æÂ§ñÂ£ÅÂ°óË£Ö„Åè„Çâ„Åπ„ÇãÈÅãÂñ∂Êú¨ÈÉ®„ÅÆÂà§Êñ≠„Å´„Çà„Çã„ÇÇ„ÅÆ„Å®„Åó„ÄÅÂä†ÁõüÂ∫ó„ÅØ„Åì„Çå„Å´ÂêåÊÑè„Åô„Çã„ÇÇ„ÅÆ„Å®„Åó„Åæ„ÅôÔºâ
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- 2Èöé‰ª•‰∏ã„ÇíÈÅ∏Êäû„Åó„Å¶„ÅÑ„Çå„Å∞ -->
                    <div class="bg-green-50 border-l-4 border-green-400 p-4 rounded">
                        <div class="flex items-start">
                            <span class="text-yellow-500 mr-2">‚ö†Ô∏è</span>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2">2Èöé‰ª•‰∏ã„ÇíÈÅ∏Êäû„Åó„Å¶„ÅÑ„Çå„Å∞</h4>
                                <p class="text-gray-700">
                                    ÈÄöÂ∏∏„ÅÆÊà∏Âª∫„ÅßÊñôÈáëÈÅ©Áî®„Å®„Å™„Çä„ÄÅ<span class="font-bold text-green-600">¬•30,000„ÅßËá™ÂãïÈÖç‰ø°„Åï„Çå„Çã„Åì„Å®„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- „Éï„ÉÉ„Çø„Éº -->
                <div class="px-8 pb-6">
                    <button onclick="closeLargePropertyModal()" class="w-full bg-blue-500 text-white py-3 px-6 rounded-lg hover:bg-blue-600 transition-colors font-semibold text-base">
                        ÁêÜËß£„Åó„Åæ„Åó„Åü
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÂçòÂìÅÈ†ÖÁõÆÈÅ∏ÊäûÊôÇ„ÅÆ„É¢„Éº„ÉÄ„É´ -->
    <div id="singleItemModal" class="fixed inset-0 z-50 hidden">
        <!-- „Ç™„Éº„Éê„Éº„É¨„Ç§ -->
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>

        <!-- „É¢„Éº„ÉÄ„É´Êú¨‰Ωì -->
        <div class="flex items-center justify-center h-full p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full relative">
                <!-- Èñâ„Åò„Çã„Éú„Çø„É≥ -->
                <button onclick="closeSingleItemModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 z-10">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>

                <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                <div class="bg-white border-b px-8 py-6 rounded-t-xl">
                    <h3 class="text-xl font-bold text-gray-800">
                        üí∞ 1Á§æÁ¥π‰ªãÊôÇ„ÅÆÊñôÈáë„Å´„Å§„ÅÑ„Å¶
                    </h3>
                </div>

                <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
                <div class="px-8 py-6">
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded">
                        <p class="text-gray-700 text-base">
                            ÂçòÂìÅÈ†ÖÁõÆ„ÅØÁõ∏Ë¶ãÁ©ç„ÇÇ„ÇäÊôÇ„ÅÆÊñôÈáë„Åß„Åô„ÄÇ
                        </p>
                        <p class="text-gray-700 text-base mt-2">
                            1Á§æÁ¥π‰ªãÊôÇ„ÅØ„Åô„Åπ„Å¶<span class="font-bold text-black text-lg">¬•20,000</span>„Å®„Å™„Çä„Åæ„Åô„ÄÇ
                        </p>
                    </div>
                </div>

                <!-- „Éï„ÉÉ„Çø„Éº -->
                <div class="px-8 pb-6">
                    <button onclick="closeSingleItemModal()" class="w-full bg-blue-500 text-white py-3 px-6 rounded-lg hover:bg-blue-600 transition-colors font-semibold text-base">
                        Á¢∫Ë™ç„Åó„Åæ„Åó„Åü
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ÂàùÂõû„É≠„Ç∞„Ç§„É≥ÊôÇ„ÅÆÂàùÊúüË®≠ÂÆö
        function initializeFirstLoginSettings() {
            console.log('[initializeFirstLoginSettings] ÈñãÂßã');
            console.log('[initializeFirstLoginSettings] window.merchantData:', window.merchantData ? 'exists' : 'null');

            // ÂàùÂõû„É≠„Ç∞„Ç§„É≥„Åã„Å©„ÅÜ„Åã„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºàlocalStorage„Å´‰øùÂ≠òÔºâ
            const isInitialized = localStorage.getItem('autodeliveryInitialized');

            if (!isInitialized) {
                console.log('[ÂàùÂõû„É≠„Ç∞„Ç§„É≥] Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÇíÂàùÊúüÂåñ„Åó„Åæ„Åô');

                // „Çπ„ÉÜ„Éº„Çø„Çπ„Çí‰∏ÄÊôÇÂÅúÊ≠¢‰∏≠„Å´Ë®≠ÂÆöÔºàÊó¢„Å´HTML„Åß„Éá„Éï„Ç©„É´„ÉàË®≠ÂÆöÊ∏à„ÅøÔºâ
                const statusSelect = document.getElementById('merchantStatus');
                if (statusSelect) {
                    statusSelect.value = 'paused';
                    updateMerchantStatus();
                }

                // ÂàùÊúüÂåñÂÆå‰∫Ü„Éï„É©„Ç∞„Çí‰øùÂ≠ò
                localStorage.setItem('autodeliveryInitialized', 'true');
                console.log('[ÂàùÂõû„É≠„Ç∞„Ç§„É≥] ÂàùÊúüÂåñÂÆå‰∫Ü');
            }

            // ÊØéÂõûÂÆüË°å: ‰∏ÄÊôÇÂÅúÊ≠¢ÈñãÂßãÊó•„Çí‰ªäÊó•„Å´Ë®≠ÂÆöÔºà„Éá„Éï„Ç©„É´„ÉàË°®Á§∫Ôºâ
            const today = new Date().toISOString().split('T')[0];
            const startDateInput = document.getElementById('pauseStartDate');
            if (startDateInput && !startDateInput.value) {
                startDateInput.value = today;
            }

            // ÊØéÂõûÂÆüË°å: Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„Çí„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâË™≠„ÅøËæº„Åø
            if (window.merchantData) {
                console.log('[initializeFirstLoginSettings] window.merchantData„ÅåÂ≠òÂú®„Åó„Åæ„Åô„ÄÇloadAutodeliverySettings„ÇíÂëº„Å≥Âá∫„Åó„Åæ„Åô„ÄÇ');
                loadAutodeliverySettings(window.merchantData);
            } else {
                console.warn('[initializeFirstLoginSettings] window.merchantData„ÅåÂ≠òÂú®„Åó„Åæ„Åõ„ÇìÔºÅ');
                // merchantData„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÁ©∫„Éá„Éº„Çø„ÅßÂàùÊúüÂåñ
                loadAutodeliverySettings({});
            }
        }

        // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆöÁî®„Å´„Éá„Éº„Çø„ÇíÂèñÂæó
        async function fetchMerchantDataForAutodelivery(merchantId) {
            console.log('[fetchMerchantDataForAutodelivery] Fetching data for:', merchantId);

            try {
                // JSONP „Åß„Éá„Éº„ÇøÂèñÂæó
                const result = await new Promise((resolve, reject) => {
                    const callbackName = 'jsonp_autodelivery_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    const script = document.createElement('script');

                    window[callbackName] = (data) => {
                        delete window[callbackName];
                        if (script.parentNode) {
                            script.parentNode.removeChild(script);
                        }
                        resolve(data);
                    };

                    script.src = `${GAS_URL}?action=getMerchantData&merchantId=${encodeURIComponent(merchantId)}&callback=${callbackName}`;
                    script.onerror = () => {
                        delete window[callbackName];
                        if (script.parentNode) {
                            script.parentNode.removeChild(script);
                        }
                        reject(new Error('JSONP request failed'));
                    };
                    document.body.appendChild(script);
                });

                if (result.success && result.data) {
                    window.merchantData = result.data;
                    window.merchantId = merchantId;
                    console.log('[fetchMerchantDataForAutodelivery] Data loaded successfully');
                    console.log('[fetchMerchantDataForAutodelivery] Data:', result.data);

                    // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÇíË™≠„ÅøËæº„ÇÄ
                    loadAutodeliverySettings(result.data);
                } else {
                    console.error('[fetchMerchantDataForAutodelivery] Failed to load data:', result.error);
                    // „Ç®„É©„ÉºÊôÇ„ÇÇ„Éá„Éï„Ç©„É´„ÉàË®≠ÂÆö„ÅßÂàùÊúüÂåñ
                    loadAutodeliverySettings({});
                }
            } catch (error) {
                console.error('[fetchMerchantDataForAutodelivery] Error:', error);
                // „Ç®„É©„ÉºÊôÇ„ÇÇ„Éá„Éï„Ç©„É´„ÉàË®≠ÂÆö„ÅßÂàùÊúüÂåñ
                loadAutodeliverySettings({});
            }
        }

        // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâËá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÇíË™≠„ÅøËæº„ÇÄ
        function loadAutodeliverySettings(data) {
            console.log('[loadAutodeliverySettings] Loading settings:', data);
            console.log('[loadAutodeliverySettings] ÊúÄÂ§ßÂØæÂøúÈöéÊï∞ key check:', data['ÊúÄÂ§ßÂØæÂøúÈöéÊï∞']);
            console.log('[loadAutodeliverySettings] All keys:', Object.keys(data));

            // ÂØæÂøúÁâ©‰ª∂Á®ÆÂà•ÔºàË§áÊï∞„ÅÆÂàóÂêç„Å´ÂØæÂøúÔºâ
            // „Åæ„ÅöÂÖ®„Å¶„ÅÆÁâ©‰ª∂Á®ÆÂà•„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Çí„É™„Çª„ÉÉ„Éà
            const autodeliverySection = document.getElementById('autodeliverySection');
            if (autodeliverySection) {
                autodeliverySection.querySelectorAll('input[name="propertyType"]').forEach(cb => {
                    cb.checked = false;
                });
            }

            // ABÂàó„ÅÆ„Éá„Éº„Çø„ÇíÂèñÂæóÔºàË§áÊï∞„ÅÆÂàóÂêç„Éë„Çø„Éº„É≥„Å´ÂØæÂøúÔºâ
            const propertyTypesData = data['ÂØæÂøúÂèØËÉΩÁâ©‰ª∂Á®ÆÂà•'] || data['ÂØæÂøúÁâ©‰ª∂Á®ÆÂà•'] || '';
            console.log('[loadAutodeliverySettings] ÂØæÂøúÂèØËÉΩÁâ©‰ª∂Á®ÆÂà• data:', propertyTypesData);
            console.log('[loadAutodeliverySettings] data["ÂØæÂøúÂèØËÉΩÁâ©‰ª∂Á®ÆÂà•"]:', data['ÂØæÂøúÂèØËÉΩÁâ©‰ª∂Á®ÆÂà•']);
            console.log('[loadAutodeliverySettings] data["ÂØæÂøúÁâ©‰ª∂Á®ÆÂà•"]:', data['ÂØæÂøúÁâ©‰ª∂Á®ÆÂà•']);

            if (propertyTypesData) {
                const propertyTypes = propertyTypesData.split(',').map(s => s.trim());
                console.log('[loadAutodeliverySettings] Property types array:', propertyTypes);
                console.log('[loadAutodeliverySettings] Property types length:', propertyTypes.length);
                console.log('[loadAutodeliverySettings] Property types JSON:', JSON.stringify(propertyTypes));

                const propertyMap = {
                    'Êà∏Âª∫„Å¶‰ΩèÂÆÖ': 'house',
                    '„Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥': 'apartment',
                    'Â∫óËàó„Éª‰∫ãÂãôÊâÄ': 'commercial',
                    'Â∫óËàó': 'commercial',  // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„ÇãÁü≠Á∏ÆÂΩ¢
                    'Â∑•Â†¥„ÉªÂÄâÂ∫´': 'factory',
                    'Â∑•Â†¥': 'factory'  // Áü≠Á∏ÆÂΩ¢„ÇÇ„Çµ„Éù„Éº„Éà
                };
                propertyTypes.forEach(type => {
                    const value = propertyMap[type];
                    if (value) {
                        const checkbox = autodeliverySection ?
                            autodeliverySection.querySelector(`input[name="propertyType"][value="${value}"]`) :
                            document.querySelector(`input[name="propertyType"][value="${value}"]`);
                        if (checkbox) {
                            checkbox.checked = true;
                            console.log('[loadAutodeliverySettings] Checked property type:', type, '‚Üí', value);
                        } else {
                            console.warn('[loadAutodeliverySettings] Checkbox not found for:', type, '‚Üí', value);
                        }
                    } else {
                        console.warn('[loadAutodeliverySettings] No mapping for:', type);
                    }
                });
            }

            // ÊúÄÂ§ßÂØæÂøúÈöéÊï∞Ôºà‰æã: "Êà∏Âª∫„Å¶‰ΩèÂÆÖ(3Èöé„Åæ„Åß),„Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥(3Èöé„Åæ„Åß)"Ôºâ
            if (data['ÊúÄÂ§ßÂØæÂøúÈöéÊï∞']) {
                let maxFloorsData = data['ÊúÄÂ§ßÂØæÂøúÈöéÊï∞'];
                console.log('[loadAutodeliverySettings] Raw max floors data:', maxFloorsData);

                // compressedÂΩ¢Âºè„ÅÆÂ†¥Âêà„ÅØfull„ÅÆÂÄ§„ÇíÊäΩÂá∫
                if (maxFloorsData.includes('{"type":"compressed","full":"')) {
                    const match = maxFloorsData.match(/"full":"([^"]+)"/);
                    if (match) {
                        maxFloorsData = match[1];
                        console.log('[loadAutodeliverySettings] Extracted max floors:', maxFloorsData);
                    }
                }

                console.log('[loadAutodeliverySettings] Final max floors data:', maxFloorsData);

                const propertyTypeMap = {
                    'Êà∏Âª∫„Å¶‰ΩèÂÆÖ': 'house',
                    '„Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥': 'apartment',
                    'Â∫óËàó„Éª‰∫ãÂãôÊâÄ': 'commercial',
                    'Â∑•Â†¥„ÉªÂÄâÂ∫´': 'factory'
                };

                // "Êà∏Âª∫„Å¶‰ΩèÂÆÖ(3Èöé„Åæ„Åß),„Ç¢„Éë„Éº„Éà„Éª„Éû„É≥„Ç∑„Éß„É≥(10Èöé‰ª•‰∏ä„Åæ„Åß)" „Çí„Éë„Éº„Çπ
                maxFloorsData.split(',').forEach(entry => {
                    const match = entry.trim().match(/^(.+?)\((.+?)„Åæ„Åß\)$/);
                    if (match) {
                        const propertyType = match[1];
                        const floorText = match[2]; // "3Èöé" or "10Èöé‰ª•‰∏ä" or "4Èöé‰ª•‰∏ä"
                        const checkboxValue = propertyTypeMap[propertyType];

                        if (checkboxValue) {
                            // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÇíË¶ã„Å§„Åë„Å¶„ÄÅ„Åù„ÅÆÈö£„ÅÆselect„ÇíÂèñÂæó
                            const checkbox = document.querySelector(`input[name="propertyType"][value="${checkboxValue}"]`);
                            if (checkbox) {
                                const label = checkbox.closest('label');
                                const select = label.querySelector('select');
                                if (select) {
                                    // option„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Åß‰∏ÄËá¥„Åô„Çã„ÇÇ„ÅÆ„ÇíÊé¢„Åô
                                    let matched = false;
                                    for (let i = 0; i < select.options.length; i++) {
                                        if (select.options[i].text === floorText) {
                                            select.selectedIndex = i;
                                            matched = true;
                                            console.log('[loadAutodeliverySettings] Set max floors:', propertyType, '=', floorText, '(option text match)');
                                            break;
                                        }
                                    }
                                    if (!matched) {
                                        console.warn('[loadAutodeliverySettings] No matching option for:', propertyType, floorText);
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // ÁØâÂπ¥Êï∞ÂØæÂøúÁØÑÂõ≤Ôºà‰æã: "{min=0, max=50}"Ôºâ
            if (data['ÁØâÂπ¥Êï∞ÂØæÂøúÁØÑÂõ≤']) {
                try {
                    const ageRange = data['ÁØâÂπ¥Êï∞ÂØæÂøúÁØÑÂõ≤'];
                    // JSONÈ¢®„ÅÆÊñáÂ≠óÂàó„Çí„Éë„Éº„Çπ
                    const minMatch = ageRange.match(/min=(\d+)/);
                    const maxMatch = ageRange.match(/max=(\d+)/);
                    if (minMatch && maxMatch) {
                        const min = parseInt(minMatch[1]);
                        const max = parseInt(maxMatch[1]);
                        document.getElementById('ageRangeMinAuto').textContent = min;
                        document.getElementById('ageRangeMaxAuto').textContent = max;

                        // „Çπ„É©„Ç§„ÉÄ„Éº„ÅÆÂÄ§„ÇÇË®≠ÂÆöÔºàmin/maxÂ±ûÊÄß„ÅßÁ¢∫ÂÆü„Å´Ë≠òÂà•Ôºâ
                        const minSlider = document.querySelector('#autodeliverySection input[type="range"][min="0"][max="50"]');
                        const maxSlider = document.querySelector('#autodeliverySection input[type="range"][min="0"][max="100"]');

                        console.log('[loadAutodeliverySettings] Found minSlider:', !!minSlider, 'maxSlider:', !!maxSlider);

                        if (minSlider && maxSlider) {
                            minSlider.value = min;
                            maxSlider.value = max;

                            console.log('[loadAutodeliverySettings] Set slider values - min:', min, 'max:', max);

                            // DOM„ÅåÂÆåÂÖ®„Å´Êõ¥Êñ∞„Åï„Çå„Å¶„Åã„Çâ„Ç§„Éô„É≥„Éà„ÇíÁô∫ÁÅ´
                            setTimeout(() => {
                                minSlider.dispatchEvent(new Event('input', { bubbles: true }));
                                maxSlider.dispatchEvent(new Event('input', { bubbles: true }));
                                minSlider.dispatchEvent(new Event('change', { bubbles: true }));
                                maxSlider.dispatchEvent(new Event('change', { bubbles: true }));

                                // Âº∑Âà∂ÁöÑ„Å´updateAgeRangeAuto()„ÇíÂëº„Å≥Âá∫„Åó
                                if (typeof updateAgeRangeAuto === 'function') {
                                    updateAgeRangeAuto();
                                }

                                console.log('[loadAutodeliverySettings] Triggered events and updateAgeRangeAuto');
                            }, 100);
                        } else {
                            console.error('[loadAutodeliverySettings] Sliders not found!');
                        }
                    }
                } catch (e) {
                    console.error('ÁØâÂπ¥Êï∞„Éë„Éº„Çπ„Ç®„É©„Éº:', e);
                }
            }

            // ÊñΩÂ∑•ÁÆáÊâÄÔºà„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆÂÄ§ ‚Üí HTML value „ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞Ôºâ
            if (data['ÊñΩÂ∑•ÁÆáÊâÄ']) {
                let locationsStr = data['ÊñΩÂ∑•ÁÆáÊâÄ'];
                console.log('[loadAutodeliverySettings] Raw construction types data:', locationsStr);

                // compressedÂΩ¢Âºè„ÅÆÂ†¥Âêà„ÅØfull„ÅÆÂÄ§„ÇíÊäΩÂá∫
                if (locationsStr.includes('{"type":"compressed","full":"')) {
                    const match = locationsStr.match(/"full":"([^"]+)"/);
                    if (match) {
                        locationsStr = match[1];
                        console.log('[loadAutodeliverySettings] Extracted full data:', locationsStr);
                    }
                }

                const locations = locationsStr.split(',').map(s => s.trim()).filter(l => l);
                console.log('[loadAutodeliverySettings] Parsed locations:', locations);

                // „Çπ„Éó„Ç∑„ÅÆÊñΩÂ∑•ÁÆáÊâÄ„Éá„Éº„Çø ‚Üí HTML„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπvalue„Å∏„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞
                // Êñ∞„Ç∑„Çπ„ÉÜ„É†: „Çπ„Éó„Ç∑„Å´„ÅØÂÆåÂÖ®„Å™ÂΩ¢Âºè„Åß‰øùÂ≠ò„Åï„Çå„Çã„Åü„ÇÅ„ÄÅÂü∫Êú¨ÁöÑ„Å´ÂÆåÂÖ®‰∏ÄËá¥
                // Êóß„Éá„Éº„Çø„Å®„ÅÆ‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅ„ÄÅÁï•Áß∞„Éû„ÉÉ„Éî„É≥„Ç∞„ÇÇ‰øùÊåÅ
                const locationMap = {
                    // ÂÆåÂÖ®‰∏ÄËá¥ÔºàÊñ∞„Éï„Ç©„Éº„Éû„ÉÉ„ÉàÔºâ- „Çπ„Éó„Ç∑„ÅÆÂÄ§ = HTML„ÅÆÂÄ§
                    'Â§ñÂ£ÅÂ°óË£Ö': 'Â§ñÂ£ÅÂ°óË£Ö',
                    'Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï': 'Â§ñÂ£Å„Ç´„Éê„ÉºÂ∑•Ê≥ï',
                    'Â§ñÂ£ÅÂºµÊõø„Åà': 'Â§ñÂ£ÅÂºµÊõø„Åà',
                    'Â±ãÊ†πÂ°óË£ÖÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'Â±ãÊ†πÂ°óË£ÖÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â±ã‰∏äÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'Â±ã‰∏äÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚Äª„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠â': 'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚Äª„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠â',
                    'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚ÄªÁì¶': 'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚ÄªÁì¶',
                    'Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï': 'Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï',
                    'Â§ñÂ£ÅË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'Â§ñÂ£ÅË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â±ãÊ†πË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'Â±ãÊ†πË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'ÂÜÖË£ÖÊ∞¥Âõû„ÇäÔºà„Éê„Çπ„Éª„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éà„Ç§„É¨ÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'ÂÜÖË£ÖÊ∞¥Âõû„ÇäÔºà„Éê„Çπ„Éª„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éà„Ç§„É¨ÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'ÂÜÖË£ÖÔºà„Éï„É≠„Éº„É™„É≥„Ç∞„ÇÑÁï≥„Å™„Å©„ÅÆÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'ÂÜÖË£ÖÔºà„Éï„É≠„Éº„É™„É≥„Ç∞„ÇÑÁï≥„Å™„Å©„ÅÆÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÔºàÂ±ãÊ†πÂ∑•‰∫ãÂê´„ÇÄÔºâ': 'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÔºàÂ±ãÊ†πÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â±ãÊ†πÂ°óË£ÖÂçòÂìÅ': 'Â±ãÊ†πÂ°óË£ÖÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â±ã‰∏äÈò≤Ê∞¥ÂçòÂìÅ': 'Â±ã‰∏äÈò≤Ê∞¥ÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â§ñÂ£ÅË£ú‰øÆÂçòÂìÅ': 'Â§ñÂ£ÅË£ú‰øÆÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â±ãÊ†πË£ú‰øÆÂçòÂìÅ': 'Â±ãÊ†πË£ú‰øÆÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÂçòÂìÅ': '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅ': 'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅ': 'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',

                    // Êóß„Éá„Éº„Çø„Å®„ÅÆ‰∫íÊèõÊÄßÔºàÁï•Áß∞ ‚Üí ÂÆåÂÖ®ÂêçÁß∞Ôºâ
                    'Â±ãÊ†πÂ°óË£Ö': 'Â±ãÊ†πÂ°óË£ÖÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â±ã‰∏äÈò≤Ê∞¥': 'Â±ã‰∏äÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â§ñÂ£ÅË£ú‰øÆ': 'Â§ñÂ£ÅË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â±ãÊ†πË£ú‰øÆ': 'Â±ãÊ†πË£ú‰øÆÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥': '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'ÂÜÖË£ÖÊ∞¥Âõû„Çä': 'ÂÜÖË£ÖÊ∞¥Âõû„ÇäÔºà„Éê„Çπ„Éª„Ç≠„ÉÉ„ÉÅ„É≥„Éª„Éà„Ç§„É¨ÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'ÂÜÖË£Ö': 'ÂÜÖË£ÖÔºà„Éï„É≠„Éº„É™„É≥„Ç∞„ÇÑÁï≥„Å™„Å©„ÅÆÂ∫ä„Éª„ÇØ„É≠„ÇπÁ≠âÔºâÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπï': 'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÔºàÂ±ãÊ†πÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπï': 'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÔºàÂ§ñÂ£ÅÂ∑•‰∫ãÂê´„ÇÄÔºâ',
                    'Â±ãÊ†πÂºµ„ÇäÊõø„Åà„Éª„Ç´„Éê„Éº': 'Â±ãÊ†π„Ç´„Éê„ÉºÂ∑•Ê≥ï',
                    'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø': 'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚Äª„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠â',
                    'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà': 'Â±ãÊ†πËë∫„ÅçÊõø„Åà„ÉªÂºµ„ÇäÊõø„Åà‚Äª„Çπ„É¨„Éº„Éà„Éª„Ç¨„É´„Éê„É™„Ç¶„É†Á≠â'
                };
                locations.forEach(loc => {
                    const mappedValue = locationMap[loc] || loc;
                    const checkbox = document.querySelector(`input[name="constructionTypes"][value="${mappedValue}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                        console.log('[loadAutodeliverySettings] Checked:', mappedValue);
                    } else {
                        console.warn('[loadAutodeliverySettings] Not found:', loc, '‚Üí', mappedValue);
                    }
                });
            }

            // ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆÔºà„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆÂÄ§ ‚Üí HTML value „ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞Ôºâ
            if (data['ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ']) {
                let specialStr = data['ÁâπÊÆäÂØæÂøúÈ†ÖÁõÆ'];
                console.log('[loadAutodeliverySettings] Raw special services data:', specialStr);

                // compressedÂΩ¢Âºè„ÅÆÂ†¥Âêà„ÅØfull„ÅÆÂÄ§„ÇíÊäΩÂá∫
                if (specialStr.includes('{"type":"compressed","full":"')) {
                    const match = specialStr.match(/"full":"([^"]+)"/);
                    if (match) {
                        specialStr = match[1];
                        console.log('[loadAutodeliverySettings] Extracted special services:', specialStr);
                    }
                }

                const specialItems = specialStr.split(',').map(s => s.trim()).filter(s => s);
                const specialMap = {
                    // ÂÆåÂÖ®‰∏ÄËá¥ÔºàÊñ∞„Éï„Ç©„Éº„Éû„ÉÉ„ÉàÔºâ - „Çπ„Éó„Ç∑„ÅÆÂÄ§ = HTML„ÅÆÂÄ§ÔºàÁµµÊñáÂ≠ó‰ªò„ÅçÔºâ
                    'ÈÅÆÁÜ±„ÉªÊñ≠ÁÜ±Â°óÊñôÊèêÊ°àÂèØËÉΩ': 'üå° ÈÅÆÁÜ±„ÉªÊñ≠ÁÜ±Â°óÊñôÊèêÊ°àÂèØËÉΩ',
                    'Á´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÊâãÊ∏°„ÅóÂ∏åÊúõ': 'üëÄ Á´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÊâãÊ∏°„ÅóÂ∏åÊúõ',
                    'ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÈÉµÈÄÅ„ÉªÈõªË©±„ÅßÂïÜË´áÂèØ': 'üìÆ ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÈÉµÈÄÅ„ÉªÈõªË©±„ÅßÂïÜË´áÂèØ',
                    '„Ç®„ÇØ„Çπ„ÉÜ„É™„Ç¢ÔºàÂ∫≠„ÉªÈßêËªäÂ†¥„ÉªÂ§ñÊßãÔºâ': 'üè° „Ç®„ÇØ„Çπ„ÉÜ„É™„Ç¢ÔºàÂ∫≠„ÉªÈßêËªäÂ†¥„ÉªÂ§ñÊßãÔºâ',
                    'Â§™ÈôΩÂÖâ„Éë„Éç„É´ËÑ±ÁùÄÔºàÊí§ÂéªÂê´„ÇÄÔºâ': '‚òÄÔ∏è Â§™ÈôΩÂÖâ„Éë„Éç„É´ËÑ±ÁùÄÔºàÊí§ÂéªÂê´„ÇÄÔºâ',
                    'ÊèêÊê∫ÂÖà„É≠„Éº„É≥Êúâ„Çä': 'üè¶ ÊèêÊê∫ÂÖà„É≠„Éº„É≥Êúâ„Çä',
                    '„ÇØ„É¨„Ç∏„ÉÉ„Éà„Ç´„Éº„ÉâÊâï„ÅÑÂèØ': 'üí≥ „ÇØ„É¨„Ç∏„ÉÉ„Éà„Ç´„Éº„ÉâÊâï„ÅÑÂèØ',
                    'ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà': 'üî• ÁÅ´ÁÅΩ‰øùÈô∫Áî≥Ë´ã„Çµ„Éù„Éº„Éà',
                    'Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà': 'üí∞ Âä©ÊàêÈáëÁî≥Ë´ã„Çµ„Éù„Éº„Éà',
                    'Âª∫ÁØâË®±ÂèØË®º': 'üèó Âª∫ÁØâË®±ÂèØË®º',
                    'ÂÖâËß¶Â™íÂ°óÊñôÊèêÊ°àÂèØ': '‚ú® ÂÖâËß¶Â™íÂ°óÊñôÊèêÊ°àÂèØ',
                    'ÂàÜÂâ≤Êâï„ÅÑ„Éó„É©„É≥Êúâ': 'üí¥ ÂàÜÂâ≤Êâï„ÅÑ„Éó„É©„É≥Êúâ',

                    // Êóß„Éá„Éº„Çø„Å®„ÅÆ‰∫íÊèõÊÄßÔºàÊã¨Âºß„Å™„Åó ‚Üí Êã¨Âºß‰ªò„Åç„ÄÅ‰∏≠ÁÇπ„Å™„Åó ‚Üí ‰∏≠ÁÇπ„ÅÇ„ÇäÔºâ
                    'ÈÅÆÁÜ±Êñ≠ÁÜ±Â°óÊñôÊèêÊ°àÂèØËÉΩ': 'üå° ÈÅÆÁÜ±„ÉªÊñ≠ÁÜ±Â°óÊñôÊèêÊ°àÂèØËÉΩ',
                    'Á´ã„Å°‰ºö„ÅÑ„Å™„ÅóË¶ãÁ©ç„ÇÇ„ÇäÊâãÊ∏°': 'üëÄ Á´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÊâãÊ∏°„ÅóÂ∏åÊúõ',
                    'ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„ÅóË¶ãÁ©ç„ÇÇ„ÇäÈÉµÈÄÅ': 'üìÆ ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÈÉµÈÄÅ„ÉªÈõªË©±„ÅßÂïÜË´áÂèØ',
                    'ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„ÅóË¶ã': 'üìÆ ÈÅ†Êñπ„Å´„Å§„ÅçÁ´ã„Å°‰ºö„ÅÑ„Å™„Åó„ÉªË¶ãÁ©ç„ÇÇ„ÇäÈÉµÈÄÅ„ÉªÈõªË©±„ÅßÂïÜË´áÂèØ',
                    '„Ç®„ÇØ„Çπ„ÉÜ„É™„Ç¢': 'üè° „Ç®„ÇØ„Çπ„ÉÜ„É™„Ç¢ÔºàÂ∫≠„ÉªÈßêËªäÂ†¥„ÉªÂ§ñÊßãÔºâ',
                    'Â§™ÈôΩÂÖâ„Éë„Éç„É´ËÑ±ÁùÄ': '‚òÄÔ∏è Â§™ÈôΩÂÖâ„Éë„Éç„É´ËÑ±ÁùÄÔºàÊí§ÂéªÂê´„ÇÄÔºâ'
                };
                specialItems.forEach(item => {
                    const mappedValue = specialMap[item] || item;
                    const checkbox = document.querySelector(`input[name="specialServices"][value="${mappedValue}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                        console.log('[loadAutodeliverySettings] Special checked:', mappedValue);
                    } else {
                        console.warn('[loadAutodeliverySettings] Special not found:', item);
                    }
                });
            }

            // ÂØæÂøúÈÉΩÈÅìÂ∫úÁúå„ÉªÂ∏ÇÂå∫Áî∫Êùë„Çí„É≠„Éº„Éâ
            if (data['ÂØæÂøúÈÉΩÈÅìÂ∫úÁúå']) {
                let prefecturesStr = data['ÂØæÂøúÈÉΩÈÅìÂ∫úÁúå'];
                console.log('[loadAutodeliverySettings] Raw prefectures data:', prefecturesStr);

                // compressedÂΩ¢Âºè„ÅÆÂ†¥Âêà„ÅØfull„ÅÆÂÄ§„ÇíÊäΩÂá∫
                if (prefecturesStr.includes('{"type":"compressed","full":"')) {
                    const match = prefecturesStr.match(/"full":"([^"]+)"/);
                    if (match) {
                        prefecturesStr = match[1];
                        console.log('[loadAutodeliverySettings] Extracted prefectures:', prefecturesStr);
                    }
                }

                // ÂÖ®Ëßí„ÉªÂçäËßí„Ç´„É≥„Éû„ÅÆ‰∏°Êñπ„Å´ÂØæÂøú
                const prefectures = prefecturesStr.split(/[,„ÄÅ]/).map(s => s.trim()).filter(s => s);
                areaSelectionData.prefectures = prefectures;

                // ÈÉΩÈÅìÂ∫úÁúå„Éú„Çø„É≥„ÇíÈÅ∏ÊäûÁä∂ÊÖã„Å´„Åô„Çã
                prefectures.forEach(pref => {
                    const button = document.querySelector(`button[data-prefecture="${pref}"]`);
                    if (button) {
                        button.classList.add('selected', 'bg-blue-500', 'text-white');
                        button.classList.remove('bg-white');
                    }
                });

                console.log('[loadAutodeliverySettings] Loaded prefectures:', prefectures);
            }

            if (data['ÂØæÂøúÂ∏ÇÂå∫Áî∫Êùë']) {
                try {
                    let citiesStr = data['ÂØæÂøúÂ∏ÇÂå∫Áî∫Êùë'];
                    console.log('[loadAutodeliverySettings] Raw cities data:', citiesStr);

                    // compressedÂΩ¢Âºè„ÅÆÂ†¥Âêà„ÅØfull„ÅÆÂÄ§„ÇíÊäΩÂá∫
                    if (citiesStr.includes('{"type":"compressed","full":"')) {
                        const match = citiesStr.match(/"full":"([^"]+)"/);
                        if (match) {
                            citiesStr = match[1];
                            console.log('[loadAutodeliverySettings] Extracted cities:', citiesStr);
                        }
                    }

                    // „Éá„Éº„ÇøÂΩ¢Âºè„ÉÅ„Çß„ÉÉ„ÇØ: „Çª„Éü„Ç≥„É≠„É≥„Åå„ÅÇ„Çå„Å∞ "Êù±‰∫¨ÈÉΩ:Ê∏ãË∞∑Âå∫,Êñ∞ÂÆøÂå∫;Á•ûÂ•àÂ∑ùÁúå:Ê®™ÊµúÂ∏Ç,Â∑ùÂ¥éÂ∏Ç" ÂΩ¢Âºè
                    // „Çª„Éü„Ç≥„É≠„É≥„Åå„Å™„Åë„Çå„Å∞„ÄÅÂçòÁ¥î„Å™„Ç´„É≥„ÉûÂå∫Âàá„Çä„É™„Çπ„ÉàÔºàÈÉΩÈÅìÂ∫úÁúåÊÉÖÂ†±„Å™„ÅóÔºâ
                    if (citiesStr.includes(';') && citiesStr.includes(':')) {
                        // „Çª„Éü„Ç≥„É≠„É≥Âå∫Âàá„Çä„ÅßÈÉΩÈÅìÂ∫úÁúå„Åî„Å®„Å´ÂàÜÂâ≤
                        citiesStr.split(';').forEach(prefEntry => {
                            const parts = prefEntry.split(':');
                            if (parts.length === 2) {
                                const pref = parts[0].trim();
                                const citiesStr = parts[1].trim();
                                if (pref && citiesStr) {
                                    // ÂÖ®Ëßí„ÉªÂçäËßí„Ç´„É≥„Éû„ÅÆ‰∏°Êñπ„Å´ÂØæÂøú
                                    const cities = citiesStr.split(/[,„ÄÅ]/).map(s => s.trim()).filter(c => c);
                                    if (cities.length > 0) {
                                        areaSelectionData.cities[pref] = cities;
                                        console.log(`[loadAutodeliverySettings] ${pref}:`, cities);
                                    }
                                }
                            }
                        });
                    } else {
                        // ÈÉΩÈÅìÂ∫úÁúåÊÉÖÂ†±„Åå„Å™„ÅÑÂ†¥Âêà ‚Üí Êñ∞„Åó„ÅÑ„É≠„Ç∏„ÉÉ„ÇØ: „Éá„Éº„Çø„Éô„Éº„Çπ„Åã„ÇâÂ∏ÇÂå∫Áî∫Êùë„ÇíÂæ©ÂÖÉ
                        // ÂÖ®Ëßí„ÉªÂçäËßí„Ç´„É≥„Éû„ÅÆ‰∏°Êñπ„Å´ÂØæÂøú
                        const allCities = citiesStr.split(/[,„ÄÅ]/).map(s => s.trim()).filter(c => c);
                        console.log('[loadAutodeliverySettings] Parsed cities (unstructured):', allCities.length, 'cities');
                        console.log('[loadAutodeliverySettings] Current prefectures:', areaSelectionData.prefectures);

                        if (allCities.length > 0 && areaSelectionData.prefectures.length > 0) {
                            console.log('[loadAutodeliverySettings] Â∏ÇÂå∫Áî∫Êùë„ÇíÈÉΩÈÅìÂ∫úÁúåÂà•„Å´ÂÜç„Éû„ÉÉ„Éî„É≥„Ç∞‰∏≠...');
                            // ÂêÑÈÉΩÈÅìÂ∫úÁúå„ÅÆÂ∏ÇÂå∫Áî∫Êùë„Éá„Éº„Çø„Éô„Éº„Çπ„Åã„Çâ„ÄÅ‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„ÇãÂ∏ÇÂå∫Áî∫Êùë„ÇíÊäΩÂá∫
                            areaSelectionData.prefectures.forEach(pref => {
                                const dbCities = getCitiesForPrefecture(pref);
                                const matchedCities = allCities.filter(city => dbCities.includes(city));
                                if (matchedCities.length > 0) {
                                    areaSelectionData.cities[pref] = matchedCities;
                                    console.log(`[loadAutodeliverySettings] ${pref}: ${matchedCities.length} cities matched`);
                                } else {
                                    console.warn(`[loadAutodeliverySettings] ${pref}: No matching cities found`);
                                }
                            });
                        } else {
                            console.error('[loadAutodeliverySettings] Cannot assign cities: allCities.length =', allCities.length, ', prefectures.length =', areaSelectionData.prefectures.length);
                        }
                    }

                    console.log('[loadAutodeliverySettings] Loaded cities:', areaSelectionData.cities);
                } catch (e) {
                    console.error('Â∏ÇÂå∫Áî∫Êùë„Éë„Éº„Çπ„Ç®„É©„Éº:', e);
                }
            }

            // ÂÑ™ÂÖà„Ç®„É™„Ç¢„Çí„É≠„Éº„Éâ
            if (data['ÂÑ™ÂÖà„Ç®„É™„Ç¢']) {
                try {
                    let prioritiesStr = data['ÂÑ™ÂÖà„Ç®„É™„Ç¢'];
                    console.log('[loadAutodeliverySettings] Raw priorities data:', prioritiesStr);

                    // compressedÂΩ¢Âºè„ÅÆÂ†¥Âêà„ÅØfull„ÅÆÂÄ§„ÇíÊäΩÂá∫
                    if (prioritiesStr.includes('{"type":"compressed","full":"')) {
                        const match = prioritiesStr.match(/"full":"([^"]+)"/);
                        if (match) {
                            prioritiesStr = match[1];
                            console.log('[loadAutodeliverySettings] Extracted priorities:', prioritiesStr);
                        }
                    }

                    // ÂÖ®Ëßí„ÉªÂçäËßí„Ç´„É≥„Éû„ÅÆ‰∏°Êñπ„Å´ÂØæÂøú
                    const priorities = prioritiesStr.split(/[,„ÄÅ]/).map(s => s.trim()).filter(p => p);

                    // „Çπ„Éó„Ç∑„ÅÆ„Éá„Éº„ÇøÂΩ¢Âºè„Å´Âøú„Åò„Å¶Â§âÊèõ
                    // "Êù±‰∫¨ÈÉΩ Ê∏ãË∞∑Âå∫" ÂΩ¢Âºè ‚Üí "Êù±‰∫¨ÈÉΩ_Ê∏ãË∞∑Âå∫" „Å´Â§âÊèõ
                    // "Êù±‰∫¨ÈÉΩ_Ê∏ãË∞∑Âå∫" ÂΩ¢Âºè ‚Üí „Åù„ÅÆ„Åæ„Åæ‰ΩøÁî®
                    areaSelectionData.priorities = priorities.map(p => {
                        if (p.includes('_')) {
                            return p; // „Åô„Åß„Å´„Ç¢„É≥„ÉÄ„Éº„Çπ„Ç≥„Ç¢ÂΩ¢Âºè
                        } else {
                            return p.replace(/\s+/, '_'); // „Çπ„Éö„Éº„Çπ„Çí„Ç¢„É≥„ÉÄ„Éº„Çπ„Ç≥„Ç¢„Å´Â§âÊèõ
                        }
                    });

                    console.log('[loadAutodeliverySettings] Loaded priorities:', areaSelectionData.priorities);
                } catch (e) {
                    console.error('ÂÑ™ÂÖà„Ç®„É™„Ç¢„Éë„Éº„Çπ„Ç®„É©„Éº:', e);
                }
            }

            // „Ç®„É™„Ç¢ÈÅ∏ÊäûUI„ÇíÊõ¥Êñ∞
            if (areaSelectionData.prefectures.length > 0) {
                updateAreaSelectionUI();
            }

            // ÂÑ™ÂÖà„Ç®„É™„Ç¢„Ç´„Ç¶„É≥„Çø„Éº„ÇíÊõ¥Êñ∞
            const selectedPriorityCount = document.getElementById('selectedPriorityCount');
            if (selectedPriorityCount && areaSelectionData.priorities) {
                selectedPriorityCount.textContent = areaSelectionData.priorities.length;
                console.log('[loadAutodeliverySettings] Updated priority count:', areaSelectionData.priorities.length);
            }

            console.log('[loadAutodeliverySettings] Final areaSelectionData:', JSON.stringify(areaSelectionData, null, 2));

            // ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆö„ÇíË™≠„ÅøËæº„Åø
            const autoPauseToggle = document.getElementById('autoPauseToggle');
            const pauseStartDate = document.getElementById('pauseStartDate');
            const pauseEndDate = document.getElementById('pauseEndDate');
            const indefinitePause = document.getElementById('indefinitePause');
            const pauseSettings = document.getElementById('pauseSettings');

            // ‰∏ÄÊôÇÂÅúÊ≠¢„Éï„É©„Ç∞„ÇíË™≠„ÅøËæº„ÅøÔºàundefined„ÅÆÂ†¥Âêà„ÅØFALSE„Å®„Åó„Å¶Êâ±„ÅÜÔºâ
            const pauseFlag = data['‰∏ÄÊôÇÂÅúÊ≠¢„Éï„É©„Ç∞'] === 'TRUE' || data['‰∏ÄÊôÇÂÅúÊ≠¢„Éï„É©„Ç∞'] === true;
            console.log('[loadAutodeliverySettings] Pause flag from sheet:', data['‰∏ÄÊôÇÂÅúÊ≠¢„Éï„É©„Ç∞'], '‚Üí', pauseFlag);
            console.log('[loadAutodeliverySettings] Pause start date raw:', data['‰∏ÄÊôÇÂÅúÊ≠¢ÈñãÂßãÊó•']);
            console.log('[loadAutodeliverySettings] Pause end date raw:', data['‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñã‰∫àÂÆöÊó•']);

            if (autoPauseToggle) {
                autoPauseToggle.checked = pauseFlag;
            }

            // ‰∏ÄÊôÇÂÅúÊ≠¢ÈñãÂßãÊó•ÔºàAPÂàóÔºâ- „Éï„É©„Ç∞„Å´Èñ¢„Çè„Çâ„ÅöÂ∏∏„Å´„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÇÄ
            if (data['‰∏ÄÊôÇÂÅúÊ≠¢ÈñãÂßãÊó•'] && pauseStartDate) {
                let startDateValue = data['‰∏ÄÊôÇÂÅúÊ≠¢ÈñãÂßãÊó•'];

                // Êßò„ÄÖ„Å™Êó•‰ªò„Éï„Ç©„Éº„Éû„ÉÉ„Éà„Çí yyyy-MM-dd „Å´Â§âÊèõÔºàÊó•Êú¨ÊôÇÈñì„ÅßÂá¶ÁêÜÔºâ
                if (typeof startDateValue === 'string') {
                    // ISO 8601ÂΩ¢Âºè (2025-10-03T15:00:00.000Z) „ÅÆÂ†¥Âêà„ÄÅDate„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Å´Â§âÊèõ„Åó„Å¶„Åã„ÇâÊó•Êú¨ÊôÇÈñì„ÅßÂèñÂæó
                    if (startDateValue.includes('T') || startDateValue.includes('Z')) {
                        const dateObj = new Date(startDateValue);
                        const year = dateObj.getFullYear();
                        const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                        const day = String(dateObj.getDate()).padStart(2, '0');
                        startDateValue = `${year}-${month}-${day}`;
                    }
                    // "yyyy-MM-dd HH:mm" ÂΩ¢Âºè„Çí yyyy-MM-dd „Å´Â§âÊèõ
                    else if (startDateValue.includes(' ')) {
                        startDateValue = startDateValue.split(' ')[0];
                    }
                    // "yyyy/MM/dd" ÂΩ¢Âºè„Çí yyyy-MM-dd „Å´Â§âÊèõ
                    else if (startDateValue.includes('/')) {
                        startDateValue = startDateValue.replace(/\//g, '-');
                    }
                } else if (startDateValue instanceof Date) {
                    // Date„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅÆÂ†¥Âêà
                    const year = startDateValue.getFullYear();
                    const month = String(startDateValue.getMonth() + 1).padStart(2, '0');
                    const day = String(startDateValue.getDate()).padStart(2, '0');
                    startDateValue = `${year}-${month}-${day}`;
                }

                pauseStartDate.value = startDateValue;
                console.log('[loadAutodeliverySettings] Pause start date set:', startDateValue);
            } else {
                console.warn('[loadAutodeliverySettings] Pause start date not found in data or element missing');
            }

            // ‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñã‰∫àÂÆöÊó•ÔºàAQÂàóÔºâ- „Éï„É©„Ç∞„Å´Èñ¢„Çè„Çâ„ÅöÂ∏∏„Å´„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÇÄ
            if (data['‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñã‰∫àÂÆöÊó•']) {
                if (data['‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñã‰∫àÂÆöÊó•'] === 'Êú™ÂÆö') {
                    if (indefinitePause) {
                        indefinitePause.checked = true;
                    }
                    if (pauseEndDateDisplay) {
                        pauseEndDateDisplay.value = 'Êú™ÂÆö';
                        pauseEndDateDisplay.classList.remove('hidden');
                    }
                    if (pauseEndDate) {
                        pauseEndDate.classList.add('hidden');
                        pauseEndDate.value = '';
                    }
                    console.log('[loadAutodeliverySettings] Pause end date: Êú™ÂÆö (from spreadsheet)');
                } else {
                    // Êó•‰ªòÂΩ¢Âºè„ÅÆÂ§âÊèõÔºàÊó•Êú¨ÊôÇÈñì„ÅßÂá¶ÁêÜÔºâ
                    let endDateValue = data['‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñã‰∫àÂÆöÊó•'];

                    if (typeof endDateValue === 'string') {
                        // ISO 8601ÂΩ¢Âºè (2025-10-03T15:00:00.000Z) „ÅÆÂ†¥Âêà„ÄÅDate„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Å´Â§âÊèõ„Åó„Å¶„Åã„ÇâÊó•Êú¨ÊôÇÈñì„ÅßÂèñÂæó
                        if (endDateValue.includes('T') || endDateValue.includes('Z')) {
                            const dateObj = new Date(endDateValue);
                            const year = dateObj.getFullYear();
                            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                            const day = String(dateObj.getDate()).padStart(2, '0');
                            endDateValue = `${year}-${month}-${day}`;
                        }
                        // "yyyy-MM-dd HH:mm" ÂΩ¢Âºè„Çí yyyy-MM-dd „Å´Â§âÊèõ
                        else if (endDateValue.includes(' ')) {
                            endDateValue = endDateValue.split(' ')[0];
                        }
                        // "yyyy/MM/dd" ÂΩ¢Âºè„Çí yyyy-MM-dd „Å´Â§âÊèõ
                        else if (endDateValue.includes('/')) {
                            endDateValue = endDateValue.replace(/\//g, '-');
                        }
                    } else if (endDateValue instanceof Date) {
                        // Date„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅÆÂ†¥Âêà
                        const year = endDateValue.getFullYear();
                        const month = String(endDateValue.getMonth() + 1).padStart(2, '0');
                        const day = String(endDateValue.getDate()).padStart(2, '0');
                        endDateValue = `${year}-${month}-${day}`;
                    }

                    if (pauseEndDate) {
                        pauseEndDate.value = endDateValue;
                        pauseEndDate.classList.remove('hidden');
                    }
                    if (pauseEndDateDisplay) {
                        pauseEndDateDisplay.classList.add('hidden');
                    }
                    if (indefinitePause) {
                        indefinitePause.checked = false;
                    }
                    console.log('[loadAutodeliverySettings] Pause end date set:', endDateValue);
                }
            } else {
                console.warn('[loadAutodeliverySettings] Pause end date not found in data');
            }

            // ‰∏ÄÊôÇÔøΩÔøΩÔøΩÊ≠¢Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆË°®Á§∫/ÈùûË°®Á§∫
            if (pauseFlag && pauseSettings) {
                pauseSettings.classList.remove('hidden');
            } else if (pauseSettings) {
                pauseSettings.classList.add('hidden');
            }

            console.log('[loadAutodeliverySettings] Settings loaded');

            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†„Åó„Å¶Â§âÊõ¥„ÇíÊ§úÁü•
            attachAutodeliveryChangeListeners();

            // Ë™≠„ÅøËæº„ÅøÂÆå‰∫ÜÂæå„ÄÅÂ§âÊõ¥„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„ÉàÔºàË™≠„ÅøËæº„ÅøÊôÇ„ÅÆ„Ç§„Éô„É≥„ÉàÁô∫ÁÅ´„ÇíÁÑ°Ë¶ñÔºâ
            // setTimeout„ÅßÂ∞ë„ÅóÈÅÖÂª∂„Åï„Åõ„Å¶„ÄÅÂàùÊúüÂåñÊôÇ„ÅÆ„Ç§„Éô„É≥„ÉàÁô∫ÁÅ´„ÇíÁ¢∫ÂÆü„Å´ÁÑ°Ë¶ñ
            setTimeout(() => {
                resetAutodeliveryChanged();
            }, 100);
        }

        // Ëá™ÂãïÈÖç‰ø°Ë®≠ÂÆö„ÅÆÂÖ®ÂÖ•ÂäõË¶ÅÁ¥†„Å´Â§âÊõ¥Ê§úÁü•„É™„Çπ„Éä„Éº„ÇíËøΩÂä†
        function attachAutodeliveryChangeListeners() {
            console.log('[attachAutodeliveryChangeListeners] Attaching change listeners...');

            const autodeliverySection = document.getElementById('autodeliverySection');
            if (!autodeliverySection) {
                console.warn('[attachAutodeliveryChangeListeners] autodeliverySection not found');
                return;
            }

            // ÂÖ®„Å¶„ÅÆinputË¶ÅÁ¥†Ôºàcheckbox, radio, text, rangeÔºâ
            const inputs = autodeliverySection.querySelectorAll('input');
            inputs.forEach(input => {
                // input„Å®change„ÅÆ‰∏°Êñπ„ÇíÁõ£Ë¶ñÔºàrange„ÅØinput„ÄÅcheckbox„ÅØchangeÔºâ
                input.addEventListener('input', markAutodeliveryChanged);
                input.addEventListener('change', markAutodeliveryChanged);
            });

            // ÂÖ®„Å¶„ÅÆselectË¶ÅÁ¥†
            const selects = autodeliverySection.querySelectorAll('select');
            selects.forEach(select => {
                select.addEventListener('change', markAutodeliveryChanged);
            });

            // ÂÖ®„Å¶„ÅÆtextareaË¶ÅÁ¥†
            const textareas = autodeliverySection.querySelectorAll('textarea');
            textareas.forEach(textarea => {
                textarea.addEventListener('input', markAutodeliveryChanged);
            });

            // ÈÉΩÈÅìÂ∫úÁúå„ÉªÂ∏ÇÂå∫Áî∫Êùë„Éú„Çø„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØ
            const prefButtons = autodeliverySection.querySelectorAll('button[data-prefecture]');
            prefButtons.forEach(button => {
                button.addEventListener('click', markAutodeliveryChanged);
            });

            console.log('[attachAutodeliveryChangeListeners] Attached listeners to:', {
                inputs: inputs.length,
                selects: selects.length,
                textareas: textareas.length,
                prefButtons: prefButtons.length
            });
        }

        // ‰∏ÄÊôÇÂÅúÊ≠¢Ë®≠ÂÆöÈñ¢Êï∞ÔºàÂç≥ÊôÇÂèçÊò†Ôºâ
        async function toggleAutoPause() {
            const toggle = document.getElementById('autoPauseToggle');
            const settings = document.getElementById('pauseSettings');

            if (toggle.checked) {
                settings.classList.remove('hidden');
                // ÈñãÂßãÊó•„Çí‰ªäÊó•„Å´„Çª„ÉÉ„Éà
                const startDate = document.getElementById('pauseStartDate');
                if (startDate && !startDate.value) {
                    startDate.value = new Date().toISOString().split('T')[0];
                }
            } else {
                settings.classList.add('hidden');
            }

            // Â§âÊõ¥„Éï„É©„Ç∞„ÇíÁ´ã„Å¶„ÇãÔºà‰øùÂ≠ò„Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ„Åß‰øùÂ≠ò„Åï„Çå„ÇãÔºâ
            markAutodeliveryChanged();
        }

        async function toggleIndefinitePause() {
            const indefinite = document.getElementById('indefinitePause');
            const endDateInput = document.getElementById('pauseEndDate');
            const endDateDisplay = document.getElementById('pauseEndDateDisplay');

            if (indefinite.checked) {
                // ÁÑ°ÊúüÈôêÂÅúÊ≠¢: „ÄåÊú™ÂÆö„Äç„Å®Ë°®Á§∫
                endDateDisplay.value = 'Êú™ÂÆö';
                endDateDisplay.classList.remove('hidden');
                endDateInput.classList.add('hidden');
            } else {
                // ÊúüÈôê„ÅÇ„Çä: Êó•‰ªòÂÖ•ÂäõÊ¨Ñ„ÇíË°®Á§∫
                endDateDisplay.classList.add('hidden');
                endDateInput.classList.remove('hidden');
            }

            // Â§âÊõ¥„Éï„É©„Ç∞„ÇíÁ´ã„Å¶„ÇãÔºà‰øùÂ≠ò„Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ„Åß‰øùÂ≠ò„Åï„Çå„ÇãÔºâ
            markAutodeliveryChanged();
        }


        // ÂçòÂìÅÈ†ÖÁõÆ„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØÁä∂ÊÖã„ÇíÁÆ°ÁêÜ

        function checkSingleItemSelection(checkbox) {
            // „ÉÅ„Çß„ÉÉ„ÇØ„ÅåÂÖ•„Å£„ÅüÂ†¥Âêà„ÅÆ„Åø„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
            if (checkbox.checked) {
                const singleItems = [
                    'Â±ãÊ†πÂ°óË£ÖÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â±ã‰∏äÈò≤Ê∞¥ÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â§ñÂ£ÅË£ú‰øÆÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â±ãÊ†πË£ú‰øÆÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    '„Éô„É©„É≥„ÉÄÈò≤Ê∞¥ÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â§ñÂ£ÅÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ',
                    'Â±ãÊ†πÈõ®Êºè„Çä‰øÆÁπïÂçòÂìÅÔºà‰ΩÜ„Åó1Á§æÁ¥π‰ªãÊôÇ„ÅØÂÆö‰æ°Ôºâ'
                ];

                if (singleItems.includes(checkbox.value)) {
                    showSingleItemModal();
                }
            }
        }

        function showSingleItemModal() {
            const modal = document.getElementById('singleItemModal');
            modal.classList.remove('hidden');
        }

        function closeSingleItemModal() {
            const modal = document.getElementById('singleItemModal');
            modal.classList.add('hidden');
        }

        // Â§ßÂûãÁâ©‰ª∂„ÅÆ„É¢„Éº„ÉÄ„É´Ë°®Á§∫ÁÆ°ÁêÜ
        function checkLargeProperty(checkbox) {
            if (checkbox.checked) {
                // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Å´„Éï„É©„Ç∞„ÇíË®≠ÂÆöÔºàÂàùÂõû„ÉÅ„Çß„ÉÉ„ÇØÂà§ÂÆöÁî®Ôºâ
                checkbox.dataset.shownModal = 'true';
                showLargePropertyModal();
            } else {
                // „ÉÅ„Çß„ÉÉ„ÇØ„ÇíÂ§ñ„Åó„Åü„Çâ„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
                delete checkbox.dataset.shownModal;
            }
        }

        function checkFloorSelection(selectElement) {
            const value = parseInt(selectElement.value);
            const parentLabel = selectElement.closest('label');
            const checkbox = parentLabel.querySelector('input[type="checkbox"]');

            // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÅåON„Åß„ÄÅ„Åã„Å§„Åæ„Å†„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅÆ„ÅøË°®Á§∫
            if ((value >= 3 || selectElement.value === 'unlimited') && checkbox.checked && !checkbox.dataset.shownModal) {
                checkbox.dataset.shownModal = 'true';
                showLargePropertyModal();
            }
        }

        function showLargePropertyModal() {
            const modal = document.getElementById('largePropertyModal');
            modal.classList.remove('hidden');
        }

        function closeLargePropertyModal() {
            const modal = document.getElementById('largePropertyModal');
            modal.classList.add('hidden');
        }
    </script>
</body>
</html>